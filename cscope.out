cscope 15 /media/audy_huang/MyCode_inBuilder/v3.1/utility/sysutils/raid_manager -q 0000003668 0000513928
	@../../../system/VolumeMgnService/NuDiskStat.h

1 #iâdef 
__NU_DISK_STAT__


2 
	#__NU_DISK_STAT__


	)

5 #ifdeà
__TITAN


6 #ifdeà
__TITAN_R2


7 
	#NU_SATA_NUM
 10

	)

8 
	#NU_ESATA_INDEX
 8

	)

10 
	#NU_SATA_NUM
 6

	)

11 
	#NU_ESATA_INDEX
 4

	)

15 
	#NU_SATA_NUM
 6

	)

16 
	#NU_ESATA_INDEX
 4

	)

19 #ifdeà
__NU_ISCSI


20 
	#NU_ISCSI_NUM
 6

	)

22 
	#MAX_DISK_NUM
 
NU_ISCSI_NUM
 + 48

23 #–£

	)

24 
	#MAX_DISK_NUM
 
NU_SATA_NUM


	)

28 
	#NU_DEV_PATH_LEN
 32

	)

29 
	#NU_MOUNT_PATH_LEN
 32

	)

34 
	snu_disk_šfo_msg


36 
	mchdev
[
NU_DEV_PATH_LEN
];

38 
	mv’dÜ
[12];

39 
	mMod–
[20];

40 
	mFwRev
[8];

41 
	m£rŸÊo
[20];

43 
	miS©aPÜt
;

44 
	miLšk
;

45 
	miS³ed
;

46 
	ms¡©us
;

47 
	mscÚŒŞ
;

49 
	miIsA‰ach
;

51 
	miRaidStus
;

59 
	mbRaidSu³rBlock
;

61 
	mdsize
;

63 
	miE¼Ü
;

66 
	m»s_commªd
;

67 
	mcmd_commªd
;

68 
	m»s_ã©u»
;

72 
	snu_g‘_disk_msg


74 
	miDeviûs
;

75 
nu_disk_šfo_msg
 
	mDiskInfo
[
MAX_DISK_NUM
];

79 
	snu_¿id_šfo_msg


81 
	mchdev
[
NU_DEV_PATH_LEN
];

82 
	mchMouÁP©h
[
NU_MOUNT_PATH_LEN
];

84 
	m¿id_Ëv–
;

85 
	m¿id_size
;

86 
	mu£d_size
;

87 
	m¿id_utime
;

88 
	mdisk_aùives
;

89 
	mdisk_çeds
;

90 
	mdisk_¥¬es
;

91 
	m¿id_disks
;

92 
	mNuDiskInfoIndexs
[
MAX_DISK_NUM
];

93 
	m£t_uuid
[16];

95 
	mucFÜm©St
;

96 
	mucRecoveSt_š‹g”
;

97 
	mucRecoveSt_decim®
;

98 
	m³rûÁ
;

100 
	mbIsFÜm©
;

101 
	mbIsMouÁ
;

103 
	miE¼Ü
;

107 
	snu_g‘_¿id_msg


109 
	miRaids
;

110 
nu_¿id_šfo_msg
 
	mRaidInfo
[
MAX_DISK_NUM
];

113 
	snu_¿id_add_msg


115 
	mËv–
;

116 
	miDeviûs
;

117 
	mch¿id
[
NU_DEV_PATH_LEN
];

118 
	mchdev
[
MAX_DISK_NUM
][
NU_DEV_PATH_LEN
];

121 
	snu_¿id_d–_msg


123 
	mch¿id
[
NU_DEV_PATH_LEN
];

127 
	snu_¿id_modify_msg


129 
	miModifyTy³
;

130 
	mch¿id
[
NU_DEV_PATH_LEN
];

131 
	mchdev
[
NU_DEV_PATH_LEN
];

135 
	snu_¿id_fÜm©_msg


137 
	mch¿id
[
NU_DEV_PATH_LEN
];

	@../../../system/VolumeMgnService/NuHWMgn.cpp

1 
	~<¡dio.h
>

2 
	~<com¶ex.h
>

4 
	~"NuHWMgn.h
"

5 
	~"£rviû.h
"

6 
	~"´Ùo_d©a.h
"

7 
	~"nu¿id.pb.h
"

9 
	~"commÚ/nusy¦og.h
"

10 
	~"¶©fÜm/šşude/¶©fÜm_¥ec.h
"

11 
	~"debugMsg/Debug.h
"

13 
	#LOG_LABEL
 "NuHWMgn"

	)

15 
	gCNuHWMgn
::
	$CNuHWMgn
()

16 : 
	`m_RaidMgn
(
NULL
)

17 , 
	`m_bQu™
(
çl£
)

18 , 
	$m_IPChªdË
(
NULL
)

20 
vŞume_¥ec
 
¥ec
;

21 
	`G‘VŞumeS³c
(&
¥ec
);

23 
Œy
 {

24 
m_RaidMgn
 = 
Ãw
 
	`CNuRaidMgn
(&
m_csSt
,

25 
¥ec
.
e§_idx
,

26 
¥ec
.
§_num
,

27 
¥ec
.
max_vŞumes
);

29 ifĞ
m_RaidMgn
 )

31 
m_RaidMgn
->
	`C»©eTh»ad
();

33 } 
	`ÿtch
 (
bad_®loc
&) {

34 
m_RaidMgn
 = 
NULL
;

35 
	`ASSERT2
(0, "Failo‡llocate memory.\n");

38 
m_IPChªdË
 = 
	`ü—‹_£rviû_š¡ªû
();

39 ià(
NULL
 =ğ
m_IPChªdË
)

41 
	`årštf
(
¡d”r
, "create_service_instance failed.\n");

45 ià(0 !ğ
	`£t_uds_´İ”ty
(
m_IPChªdË
, 
UDS_SERVICE_NAME
))

47 
	`årštf
(
¡d”r
, "set uds…roperty failed.\n");

51 ià(1 !ğ
	`’abË_uds
(
m_IPChªdË
, 1))

53 
	`årštf
(
¡d”r
, "enable uds failed.\n");

56 
	}
}

58 
	gCNuHWMgn
::~
	$CNuHWMgn
()

60 ifĞ
m_IPChªdË
 )

62 
	`¡İ_£rviû
(
m_IPChªdË
);

63 
	`»Ëa£_£rviû_š¡ªû
(
m_IPChªdË
);

64 
m_IPChªdË
 = 
NULL
;

66 ifĞ
m_RaidMgn
 )

68 ià(
m_RaidMgn
->
	`Th»adExi¡s
()) {

69 
m_RaidMgn
->
	`Clo£Th»ad
();

72 
d–‘e
 
m_RaidMgn
;

73 
m_RaidMgn
 = 
NULL
;

75 
	}
}

77 
	gCNuHWMgn
::
	$RunLoİ
()

79 
»t
 = -1;

80 
n
 = 1 , 
út
 = 0;

81 
´Ùo_un™
 *
´Ùo_un™_buf
 = 
NULL
;

84 ifĞ
m_IPChªdË
 =ğ
NULL
 )

87 
»t
 = 
	`¡¬t_£rviû
(
m_IPChªdË
);

88 ià(
»t
!=0)

90 
	`årštf
(
¡d”r
, "start_service failed.\n");

94 !
m_bQu™
)

96 
acû±_»tuº
 = 
	`acû±_ş›Ás
(
m_IPChªdË
, 1000);

97 
	`´štf
("fšish‡cû±_ş›Á »tuº %d...\n",
acû±_»tuº
);

98 
út
 = 
	`g‘_»que¡
(
m_IPChªdË
, 1000, 
n
, &
´Ùo_un™_buf
);

99 ifĞ
út
 <= 0 )

103 
	`´štf
("g‘ %d„eque¡(s)...\n", 
út
);

105 
ušt32_t
 
cmd
 = 0;

106 
msg_Ën
 = -1;

107 cÚ¡ *
buf
 = 
NULL
;

108 
j
;

109 *
pPrÙoBuf
 = 
NULL
;

110 
S”L’
;

112 
	`g‘_´Ùo_un™_cmd
(
´Ùo_un™_buf
,&
cmd
);

113 
	`g‘_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,&
msg_Ën
);

114 
	`g‘_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,&
buf
);

115 
	`´štf
("cmd i %u , mes§gsizi %d , mes§gi % \n",
cmd
,
msg_Ën
,
buf
);

117 ià(
NULL
 =ğ
m_RaidMgn
) {

121 
cmd
)

123 
NUHW_GET_DISK_INFO
:

125 
m_RaidMgn
->
	`G‘DisksInfo
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

128 
NUHW_GET_FREE_DISK_INFO
:

130 
m_RaidMgn
->
	`G‘F»eDisksInfo
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

133 
NUHW_GET_RAID_INFO
:

135 
m_RaidMgn
->
	`G‘RaidsInfo
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

138 
NUHW_ADD_RAID
:

140 
m_RaidMgn
->
	`AddRaid
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

143 
NUHW_DEL_RAID
:

145 
m_RaidMgn
->
	`D–Raid
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

148 
NUHW_MODIFY_RAID
:

150 
m_RaidMgn
->
	`ModifyRaid
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

153 
NUHW_FORMAT_RAID
:

155 
m_RaidMgn
->
	`FÜm©Raid
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

158 
NUHW_ADD_DISK
:

160 
m_RaidMgn
->
	`AddDisk
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
,0);

163 
NUHW_REMOVE_DISK
:

165 
m_RaidMgn
->
	`RemoveDisk
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
,0);

168 
NUHW_ADD_ISCSI
:

170 
m_RaidMgn
->
	`AddDisk
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
,1);

173 
NUHW_REMOVE_ISCSI
:

175 
m_RaidMgn
->
	`RemoveDisk
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
,1);

178 
K”ÃlIOE¼Ü1
:

180 
m_RaidMgn
->
	`HªdËIOE¼Ü1
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

183 
K”ÃlIOE¼Ü2
:

185 
m_RaidMgn
->
	`HªdËIOE¼Ü2
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

188 
K”ÃlEXT3_fsE¼Ü
:

190 
m_RaidMgn
->
	`HªdËEXT3_fsE¼Ü
(
m_IPChªdË
,
buf
,
msg_Ën
,
´Ùo_un™_buf
);

197 
	}
}

199 
	gCNuHWMgn
::
	$Qu™Loİ
()

201 
m_bQu™
 = 1;

202 
	}
}

	@../../../system/VolumeMgnService/NuHWMgn.h

1 #iâdef 
__NUHWMGN__


2 
	#__NUHWMGN__


	)

4 
	~"NuRaidMgn.h
"

5 
	~"c_commªd.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 şas 
	cCNuHWMgn


13 
	mpublic
:

14 
CNuHWMgn
();

15 
	mvœtu®
 ~
CNuHWMgn
();

17 
RunLoİ
();

18 
Qu™Loİ
();

20 
	m´iv©e
:

21 
CNuRaidMgn
 *
m_RaidMgn
;

23 
Cr™iÿlSeùiÚ
 
	mm_csSt
;

24 
boŞ
 
	mm_bQu™
;

25 *
	mm_IPChªdË
;

	@../../../system/VolumeMgnService/NuLedsCtrl.cpp

2 
	~<¡dio.h
>

3 
	~<fú.h
>

4 
	~<uni¡d.h
>

5 
	~<sys/ioùl.h
>

7 
	~"NuLedsCŒl.h
"

10 #ià
defšed
(
__MINI_II
è|| defšed(
__MINI_II_4
)

11 
	#__MARVELL_LED_CTRL


	)

15 #ifdeà
__MARVELL_LED_CTRL


16 
	~"../NuLED/driv”/nuËds.h
"

20 
	gCNuLedsCŒl
::
	$CNuLedsCŒl
()

22 
m_¶ed_deviû
 = -1;

23 #ifdeà
__MARVELL_LED_CTRL


24 
m_¶ed_deviû
 = 
	`İ’
("/dev/nu_Ëds", 
O_RDONLY
);

27 
	`In™Leds
();

28 
	}
}

30 
	gCNuLedsCŒl
::~
	$CNuLedsCŒl
()

32 ifĞ
m_¶ed_deviû
 >= 0)

34 
	`şo£
(
m_¶ed_deviû
);

35 
m_¶ed_deviû
 = -1;

37 
	}
}

39 
	gCNuLedsCŒl
::
	$In™Leds
()

41 ifĞ
m_¶ed_deviû
 < 0)

46 #ifdeà
__MARVELL_LED_CTRL


47 
	`ioùl
(
m_¶ed_deviû
, 
NU_SYSTEM_NORMAL_CMD
, 
NULL
);

48 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA0_DISABLE_CMD
, 
NULL
);

49 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA1_DISABLE_CMD
, 
NULL
);

50 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA2_DISABLE_CMD
, 
NULL
);

51 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA3_DISABLE_CMD
, 
NULL
);

52 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA4_DISABLE_CMD
, 
NULL
);

53 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA5_DISABLE_CMD
, 
NULL
);

55 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_DISABLE_CMD
, 
NULL
);

56 
	`ioùl
(
m_¶ed_deviû
, 
NU_BUZZER_DISABLE_CMD
, 
NULL
);

58 
	}
}

60 
	gCNuLedsCŒl
::
	$S©aNÜm®Stus
(
šdex
, 
bblšk
, 
bnÜm®
)

62 ifĞ
m_¶ed_deviû
 < 0)

67 #ifdeà
__MARVELL_LED_CTRL


68 
šdex
)

71 ifĞ
bnÜm®
 )

73 ifĞ
bblšk
 )

74 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA0_NORMAL_BLINK_CMD
, 
NULL
);

76 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA0_NORMAL_CMD
, 
NULL
);

80 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA0_DISABLE_CMD
, 
NULL
);

84 ifĞ
bnÜm®
 )

86 ifĞ
bblšk
 )

87 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA1_NORMAL_BLINK_CMD
, 
NULL
);

89 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA1_NORMAL_CMD
, 
NULL
);

93 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA1_DISABLE_CMD
, 
NULL
);

97 ifĞ
bnÜm®
 )

99 ifĞ
bblšk
 )

100 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA2_NORMAL_BLINK_CMD
, 
NULL
);

102 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA2_NORMAL_CMD
, 
NULL
);

106 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA2_DISABLE_CMD
, 
NULL
);

110 ifĞ
bnÜm®
 )

112 ifĞ
bblšk
 )

113 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA3_NORMAL_BLINK_CMD
, 
NULL
);

115 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA3_NORMAL_CMD
, 
NULL
);

119 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA3_DISABLE_CMD
, 
NULL
);

123 ifĞ
bnÜm®
 )

125 ifĞ
bblšk
 )

126 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA4_NORMAL_BLINK_CMD
, 
NULL
);

128 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA4_NORMAL_CMD
, 
NULL
);

132 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA4_DISABLE_CMD
, 
NULL
);

151 ifĞ
bnÜm®
 )

153 ifĞ
bblšk
 )

154 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_ENABLE_BLINK_CMD
, 
NULL
);

156 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_ENABLE_CMD
, 
NULL
);

160 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_DISABLE_CMD
, 
NULL
);

164 ifĞ
bnÜm®
 )

166 ifĞ
bblšk
 )

167 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_ENABLE_BLINK_CMD
, 
NULL
);

169 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_ENABLE_CMD
, 
NULL
);

173 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_DISABLE_CMD
, 
NULL
);

178 
	}
}

180 
	gCNuLedsCŒl
::
	$S©aE¼ÜStus
(
šdex
, 
bblšk
)

182 ifĞ
m_¶ed_deviû
 < 0)

187 #ifdeà
__MARVELL_LED_CTRL


188 
šdex
)

191 ifĞ
bblšk
 )

192 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA0_ERROR_BLINK_CMD
, 
NULL
);

194 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA0_ERROR_CMD
, 
NULL
);

197 ifĞ
bblšk
 )

198 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA1_ERROR_BLINK_CMD
, 
NULL
);

200 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA1_ERROR_CMD
, 
NULL
);

203 ifĞ
bblšk
 )

204 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA2_ERROR_BLINK_CMD
, 
NULL
);

206 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA2_ERROR_CMD
, 
NULL
);

209 ifĞ
bblšk
 )

210 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA3_ERROR_BLINK_CMD
, 
NULL
);

212 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA3_ERROR_CMD
, 
NULL
);

215 ifĞ
bblšk
 )

216 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA4_ERROR_BLINK_CMD
, 
NULL
);

218 
	`ioùl
(
m_¶ed_deviû
, 
NU_SATA4_ERROR_CMD
, 
NULL
);

229 ifĞ
bblšk
 )

230 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_ENABLE_BLINK_CMD
, 
NULL
);

232 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_ENABLE_CMD
, 
NULL
);

235 ifĞ
bblšk
 )

236 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_ENABLE_BLINK_CMD
, 
NULL
);

238 
	`ioùl
(
m_¶ed_deviû
, 
NU_USB_ENABLE_CMD
, 
NULL
);

242 
	}
}

244 
	gCNuLedsCŒl
::
	$Sy¡emNÜm®Stus
(
bblšk
, 
bnÜm®
)

246 #ifdeà
__MARVELL_LED_CTRL


247 ifĞ
bnÜm®
 )

249 ifĞ
bblšk
 )

250 
	`ioùl
(
m_¶ed_deviû
, 
NU_SYSTEM_NORMAL_BLINK_CMD
, 
NULL
);

252 
	`ioùl
(
m_¶ed_deviû
, 
NU_SYSTEM_NORMAL_CMD
, 
NULL
);

256 
	`ioùl
(
m_¶ed_deviû
, 
NU_SYSTEM_DISABLE
, 
NULL
);

259 
	}
}

261 
	gCNuLedsCŒl
::
	$Sy¡emE¼ÜStus
(
bblšk
)

263 #ifdeà
__MARVELL_LED_CTRL


264 ifĞ
bblšk
 )

265 
	`ioùl
(
m_¶ed_deviû
, 
NU_SYSTEM_ERROR_BLINK_CMD
, 
NULL
);

267 
	`ioùl
(
m_¶ed_deviû
, 
NU_SYSTEM_ERROR_CMD
, 
NULL
);

269 
	}
}

271 
	gCNuLedsCŒl
::
	$Buzz”CÚŒŞ
(
mli£cÚd
)

273 #ifdeà
__MARVELL_LED_CTRL


274 
	`ioùl
(
m_¶ed_deviû
, 
NU_BUZZER_ENABLE_CMD
, 
NULL
);

275 
	`u¦“p
(
mli£cÚd
 * 1000);

276 
	`ioùl
(
m_¶ed_deviû
, 
NU_BUZZER_DISABLE_CMD
, 
NULL
);

278 
	}
}

280 
	gCNuLedsCŒl
::
	$Buzz”CÚŒŞ1
(
mli£cÚd
, 
š‹rv®_ms
)

282 #ifdeà
__MARVELL_LED_CTRL


283 
	`ioùl
(
m_¶ed_deviû
, 
NU_BUZZER_ENABLE_CMD
, 
NULL
);

284 
	`u¦“p
(
mli£cÚd
 * 1000);

285 
	`ioùl
(
m_¶ed_deviû
, 
NU_BUZZER_DISABLE_CMD
, 
NULL
);

286 
	`u¦“p
(
š‹rv®_ms
 * 1000);

287 
	`ioùl
(
m_¶ed_deviû
, 
NU_BUZZER_ENABLE_CMD
, 
NULL
);

288 
	`u¦“p
(
mli£cÚd
 * 1000);

289 
	`ioùl
(
m_¶ed_deviû
, 
NU_BUZZER_DISABLE_CMD
, 
NULL
);

291 
	}
}

	@../../../system/VolumeMgnService/NuLedsCtrl.h

1 #iâdef 
__NU_LEDS_CTRL__


2 
	#__NU_LEDS_CTRL__


	)

8 şas 
	cCNuLedsCŒl


10 
	mpublic
:

11 
CNuLedsCŒl
();

12 
	mvœtu®
 ~
CNuLedsCŒl
();

14 
In™Leds
();

15 
S©aNÜm®Stus
(
šdex
, 
bblšk
, 
bnÜm®
);

16 
S©aE¼ÜStus
(
šdex
, 
bblšk
);

18 
Sy¡emNÜm®Stus
(
bblšk
, 
bnÜm®
);

19 
Sy¡emE¼ÜStus
(
bblšk
);

21 
Buzz”CÚŒŞ
(
mli£cÚd
);

22 
Buzz”CÚŒŞ1
(
mli£cÚd
, 
š‹rv®_ms
);

24 
	m´iv©e
:

25 
m_¶ed_deviû
;

	@../../../system/VolumeMgnService/NuRaidMgn.cpp

1 
	~<lim™s.h
>

2 
	~<sys/io.h
>

3 
	~<dœ’t.h
>

5 
	~<scsi/sg.h
>

6 
	~<scsi/scsi.h
>

7 
	~<sys/vfs.h
>

8 
	~<m©h.h
>

10 
	~"NuRaidMgn.h
"

11 
	~"debugMsg/Debug.h
"

13 
	~"commÚ/fsu§ge64.h
"

15 
	~"£rviû.h
"

16 
	~"nfsS”v”/nfsS”v”.h
"

18 
	#NP_DISK_TIMEOUT
 "/tmp/disk_timeout"

	)

19 
	#NP_DISK_TIMEOUT_FLAG
 "/tmp/æag_disk_timeout"

	)

20 
	#NP_DISK_ERROR
 "/tmp/disk_”rÜ"

	)

21 
	#NP_DISK_ERROR_FLAG
 "/tmp/æag_disk_”rÜ"

	)

23 
	gCNuRaidMgn
::
	$CNuRaidMgn
(
Cr™iÿlSeùiÚ
 *
pcsSt
, 
e§_idx
, 
§_num
, 
max_vŞumes
, 
iscsi_num
)

24 : 
	`m_bFÜm©tšg
(
çl£
)

25 , 
	`m_pcsSt
(
pcsSt
)

26 , 
	`m_e§_idx
(
e§_idx
)

27 , 
	`m_§_num
(
§_num
)

28 , 
	$m_max_vŞumes
(
max_vŞumes
)

30 
m_pcsSt
 = 
pcsSt
;

33 
	`mkdœ
(
NP_DISK_TIMEOUT
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

34 
	`mkdœ
(
NP_DISK_ERROR
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

36 
	`kl_´oc
();

37 
	}
}

39 
	gCNuRaidMgn
::~
	$CNuRaidMgn
()

42 
	}
}

44 
	gCNuRaidMgn
::
	$Th»adProc
()

46 
chcommªd
[260] = {0};

47 
i
;

48 
bCheckDisk
 = 0;

51 
¡©fs64
 
tmp¡fs
;

52 ià(
	`¡©fs64
 ("/v¬/checkdisk", &
tmp¡fs
) == 0) {

53 
	`¥rštf
(
chcommªd
,"/etc/init.d/lighttpd„estart");

54 
	`sy¡em
(
chcommªd
);

55 
bCheckDisk
 = 1;

59 
m_¿idMgr
.
	`Upd©eRAIDInfo
();

60 
m_¿idMgr
.
	`G‘RAIDInfo
(
m_vP»vRAIDInfoLi¡
);

62 ià(
bCheckDisk
) {

63 
	`uÆšk
("/var/checkdisk");

64 
bCheckDisk
 = 0;

65 
	`¥rštf
(
chcommªd
,"/etc/init.d/lighttpd„estart");

66 
	`sy¡em
(
chcommªd
);

69 ifĞ
m_pcsSt
 )

70 
m_pcsSt
->
	`Lock
();

71 
	`¡¬t_´oc
();

72 ifĞ
m_pcsSt
 )

73 
m_pcsSt
->
	`UÆock
();

75 
	`¦“p
(3);

78 
m_¿idMgr
.
	`Upd©eRAIDInfo
();

79 
m_bFÜm©tšg
 = 
çl£
;

81 iàĞ
m_pcsSt
 )

82 
m_pcsSt
->
	`Lock
();

84 
	`´štf
("Monithread\n");

86 iàĞ
m_pcsSt
 )

87 
m_pcsSt
->
	`UÆock
();

88 
	`¦“p
(3);

90 
	}
}

92 
	gCNuRaidMgn
::
	$G‘Info
()

94 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

95 
veùÜ
<
RAIDInfo
> 
li¡
;

97 
m_¿idMgr
.
	`Upd©eRAIDInfo
();

98 
m_¿idMgr
.
	`G‘RAIDInfo
(
li¡
);

99 
i
 = 0; i < 
li¡
.
	`size
(); i++) {

100 
li¡
[
i
].
	`Dump
();

102 
	}
}

104 
	gCNuRaidMgn
::
	$nu_£t_diskšfo_to_´Ùo
(
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
, cÚ¡ 
RAIDDiskInfo
 &
šfo
)

106 
iS©aNum
 = 0;

107 
šfo
.
m_miscInfo
.
m_diskTy³
) {

108 
DISK_TYPE_SATA
:

109 
	`ssÿnf
(
šfo
.
m_miscInfo
.
m_¡rSymLšk
.
	`c_¡r
(), "/dev/nuuo_§%d", &
iS©aNum
);

110 
iS©aNum
 += 1;

112 
DISK_TYPE_ESATA
:

113 
	`ssÿnf
(
šfo
.
m_miscInfo
.
m_¡rSymLšk
.
	`c_¡r
(), "/dev/nuuo_e§%d", &
iS©aNum
);

114 
iS©aNum
 +ğ
m_e§_idx
;

116 
DISK_TYPE_ISCSI
:

118 
	`ssÿnf
(
šfo
.
m_miscInfo
.
m_¡rSymLšk
.
	`c_¡r
(), "/dev/nuuo_iscsi%d", &
iS©aNum
);

120 
DISK_TYPE_NFS
:

125 
pdiskšfo
->
	`£t_i§pÜt
(
iS©aNum
);

126 
pdiskšfo
->
	`£t_chdev
(
šfo
.
m_miscInfo
.
m_¡rSymLšk
);

127 
pdiskšfo
->
	`£t_ii§‰ach
(1);

129 
	`´štf
("S‘ Disk %s\n", 
šfo
.
m_¡rDevName
.
	`c_¡r
());

130 ià(
šfo
.
m_bHasMDSB
) {

131 
pdiskšfo
->
	`£t_œaid¡©us
(
šfo
.
m_iS‹
);

132 
pdiskšfo
->
	`£t_¡¼aid¡©e
(
šfo
.
m_¡rS‹
);

134 
pdiskšfo
->
	`£t_œaid¡©us
(0);

135 
pdiskšfo
->
	`£t_¡¼aid¡©e
("Free");

138 
pdiskšfo
->
	`£t_dsize
(
šfo
.
m_ÎC­ac™y
);

140 
pdiskšfo
->
	`£t_v’dÜ
(
šfo
.
m_¡rV’dÜ
);

141 
pdiskšfo
->
	`£t_mod–
(
šfo
.
m_¡rMod–
);

142 
pdiskšfo
->
	`£t_fw»v
(
šfo
.
m_¡rFœmw¬eV”siÚ
);

143 
pdiskšfo
->
	`£t_£rŸÊo
(
šfo
.
m_¡rS”ŸlNum
);

145 
	`´štf
("HwMgn: info.m_diskTy³ = %d\n", 
šfo
.
m_miscInfo
.
m_diskTy³
);

146 
šfo
.
m_miscInfo
.
m_diskTy³
) {

147 
DISK_TYPE_UNKNOWN
:

148 
pdiskšfo
->
	`£t_ty³
(
nu¿id¡©
::
nu_disk_šfo
::
UNKNOWN
);

150 
DISK_TYPE_SATA
:

151 
pdiskšfo
->
	`£t_ty³
(
nu¿id¡©
::
nu_disk_šfo
::
SATA
);

153 
DISK_TYPE_ESATA
:

154 
pdiskšfo
->
	`£t_ty³
(
nu¿id¡©
::
nu_disk_šfo
::
ESATA
);

156 
DISK_TYPE_ISCSI
:

157 
pdiskšfo
->
	`£t_ty³
(
nu¿id¡©
::
nu_disk_šfo
::
ISCSI
);

159 
DISK_TYPE_NFS
:

160 
pdiskšfo
->
	`£t_ty³
(
nu¿id¡©
::
nu_disk_šfo
::
NFS
);

162 
	}
}

165 
	gCNuRaidMgn
::
	$G‘DisksInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

167 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

169 
út
 = 0;

170 
iDeviûs
 = 0;

171 *
pPrÙoBuf
 = 
NULL
;

172 
S”L’
 = 0;

173 
nu¿id¡©
::
nu_g‘_disks_msg
 
g‘_disks_šfo
;

174 
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
 = 
NULL
;

176 
	`TRACE
("IPC GetDisksInfo method call ! \n");

178 
g‘_disks_šfo
.
	`£t_max_disk_num
(
m_§_num
 + 
m_iscsi_num
);

179 
g‘_disks_šfo
.
	`£t_nu_§_num
(
m_§_num
);

180 
g‘_disks_šfo
.
	`£t_nu_e§_num
(
m_§_num
 - 
m_e§_idx
);

181 
g‘_disks_šfo
.
	`£t_nu_iscsi_num
(
m_iscsi_num
);

183 
veùÜ
<
RAIDDiskInfo
> 
vDiskLi¡
;

184 
m_¿idMgr
.
	`G‘DisksInfo
(
vDiskLi¡
);

186 
size_t
 
i
 = 0; i < 
vDiskLi¡
.
	`size
(); i++) {

188 
pdiskšfo
 = 
g‘_disks_šfo
.
	`add_diskšfo
();

189 ifĞ
pdiskšfo
 ) {

190 
	`nu_£t_diskšfo_to_´Ùo
(
pdiskšfo
, 
vDiskLi¡
[
i
]);

195 
g‘_disks_šfo
.
	`£t_ideviûs
(
vDiskLi¡
.
	`size
());

197 
S”L’
 = 
g‘_disks_šfo
.
	`By‹Size
();

198 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

200 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

201 ià(
pPrÙoBuf
) {

202 
g‘_disks_šfo
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

204 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

205 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

206 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

207 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

209 
	`ä“
(
pPrÙoBuf
);

212 
	`´štf
("Can't‡lloc memory !\n");

214 
	}
}

216 
	gCNuRaidMgn
::
	$G‘F»eDisksInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

218 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

220 
út
;

221 *
pPrÙoBuf
 = 
NULL
;

222 
S”L’
;

223 
nu¿id¡©
::
nu_g‘_disks_msg
 
g‘_disks_šfo
;

224 
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
 = 
NULL
;

226 
	`TRACE
("IPC GetDisksInfo method call ! \n");

228 
g‘_disks_šfo
.
	`£t_max_disk_num
(
m_§_num
 + 
m_iscsi_num
);

229 
g‘_disks_šfo
.
	`£t_nu_§_num
(
m_§_num
);

230 
g‘_disks_šfo
.
	`£t_nu_e§_num
(
m_§_num
 - 
m_e§_idx
);

231 
g‘_disks_šfo
.
	`£t_nu_iscsi_num
(
m_iscsi_num
);

233 
veùÜ
<
RAIDDiskInfo
> 
vDiskLi¡
;

234 
m_¿idMgr
.
	`G‘DisksInfo
(
vDiskLi¡
);

236 
size_t
 
i
 = 0; i < 
vDiskLi¡
.
	`size
(); i++) {

237 ià(!
vDiskLi¡
[
i
].
m_bHasMDSB
) {

238 
pdiskšfo
 = 
g‘_disks_šfo
.
	`add_diskšfo
();

239 iàĞ
pdiskšfo
 ) {

240 
	`nu_£t_diskšfo_to_´Ùo
(
pdiskšfo
, 
vDiskLi¡
[
i
]);

245 
g‘_disks_šfo
.
	`£t_ideviûs
(
vDiskLi¡
.
	`size
());

247 
S”L’
 = 
g‘_disks_šfo
.
	`By‹Size
();

248 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

250 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

251 ià(
pPrÙoBuf
) {

252 
g‘_disks_šfo
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

254 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

255 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

256 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

257 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

259 
	`ä“
(
pPrÙoBuf
);

261 
	`´štf
("Can't‡lloc memory !\n");

263 
	}
}

265 
	gCNuRaidMgn
::
	$G‘RaidsInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

267 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

269 
RaidS‹
 *
¡
;

270 
k
,
út
;

271 *
pPrÙoBuf
 = 
NULL
;

272 
S”L’
;

273 
boŞ
 
bMouÁed
 = 
çl£
;

274 
boŞ
 
bFÜm©tšg
 = 
çl£
;

276 
nu¿id¡©
::
nu_g‘_¿ids_msg
 
g‘_¿ids_šfo
;

277 
nu¿id¡©
::
nu_¿id_šfo
 *
´aidšfo
 = 
NULL
;

278 
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
 = 
NULL
;

280 
	`TRACE
("IPC GetRaidsInfo method call ! \n");

282 
veùÜ
<
RAIDInfo
> 
li¡
;

283 
m_¿idMgr
.
	`G‘RAIDInfo
(
li¡
);

285 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i++) {

286 
´aidšfo
 = 
g‘_¿ids_šfo
.
	`add_¿idšfo
();

287 ifĞ
´aidšfo
 ) {

288 
´aidšfo
->
	`£t_šdex
(
li¡
[
i
].
m_iMDNum
);

289 
´aidšfo
->
	`£t_chdev
(
li¡
[
i
].
m_¡rDevNodeName
);

291 
¡ršg
 
¡rMouÁPošt
;

292 ià(
NULL
 !ğ
li¡
[
i
].
m_fsMgr
.
	`g‘
()) {

293 ià(
li¡
[
i
].
m_fsMgr
->
	`IsMouÁed
(
¡rMouÁPošt
)) {

294 
´aidšfo
->
	`£t_bismouÁ
(1);

295 
bMouÁed
 = 
Œue
;

297 
´aidšfo
->
	`£t_bismouÁ
(0);

299 
´aidšfo
->
	`£t_chmouÁ·th
(
¡rMouÁPošt
);

302 
´aidšfo
->
	`£t_¿id_Ëv–
(
li¡
[
i
].
m_iRAIDLev–
);

303 
´aidšfo
->
	`£t_¿id_size
(
li¡
[
i
].
m_uÎTÙ®C­ac™y
);

304 
´aidšfo
->
	`£t_u£d_size
(
li¡
[
i
].
m_uÎU£dSize
);

305 
´aidšfo
->
	`£t_¿id_utime
(
li¡
[
i
].
m_Upd©eTime
);

306 
´aidšfo
->
	`£t_disk_aùives
(
li¡
[
i
].
m_iAùiveDiskNum
);

307 
´aidšfo
->
	`£t_disk_çeds
(
li¡
[
i
].
m_iFaedDiskNum
);

308 
´aidšfo
->
	`£t_disk_¥¬es
(
li¡
[
i
].
m_iS·»DiskNum
);

309 
´aidšfo
->
	`£t_¿id_disks
(
li¡
[
i
].
m_iTÙ®DiskNum
);

310 
size_t
 
j
 = 0; j < 
li¡
[
i
].
m_vDiskLi¡
.
	`size
(); j++) {

311 
pdiskšfo
 = 
´aidšfo
->
	`add_diskšfo
();

312 iàĞ
pdiskšfo
 ) {

313 
	`nu_£t_diskšfo_to_´Ùo
(
pdiskšfo
, 
li¡
[
i
].
m_vDiskLi¡
[
j
]);

316 
´aidšfo
->
	`£t_£t_uuid
(
li¡
[
i
].
m_UUID
, (list[i].m_UUID));

318 ià(
NULL
 !ğ
li¡
[
i
].
m_fsMgr
.
	`g‘
()) {

319 
´og»ss
, 
¡©
;

320 if(!
li¡
[
i
].
m_fsMgr
->
	`IsFÜm©šg
(
´og»ss
, 
¡©
)) {

321 
´aidšfo
->
	`£t_bisfÜm©
(0);

322 
´aidšfo
->
	`£t_ucfÜm©¡©
(0);

324 
bFÜm©tšg
 = 
Œue
;

325 
´aidšfo
->
	`£t_bisfÜm©
(1);

326 
´aidšfo
->
	`£t_ucfÜm©¡©
(
´og»ss
);

330 
	`´štf
("Rebudšg Prog»ss: %d\n", 
li¡
[
i
].
m_iRebudšgProg»ss
);

331 ià(
li¡
[
i
].
m_bRebudšg
)

332 
´aidšfo
->
	`£t_³rûÁ
(
li¡
[
i
].
m_iRebudšgProg»ss
);

334 
´aidšfo
->
	`£t_³rûÁ
(-1);

336 ià(!
bFÜm©tšg
) {

337 ià(!
li¡
[
i
].
m_fsMgr
->
	`IsFÜm©ed
()) {

338 
li¡
[
i
].
m_¡rS‹
 += ",UNFORMATED";

339 } ià(!
bMouÁed
) {

340 
li¡
[
i
].
m_¡rS‹
 += ",UNMOUNTED";

344 
´aidšfo
->
	`£t_¡r¡©e
(
li¡
[
i
].
m_¡rS‹
);

345 
´aidšfo
->
	`£t_›¼Ü
(0);

349 
S”L’
 = 
g‘_¿ids_šfo
.
	`By‹Size
();

350 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

352 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

353 ià(
pPrÙoBuf
) {

354 
g‘_¿ids_šfo
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

356 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

357 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

358 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

359 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

361 
	`ä“
(
pPrÙoBuf
);

363 
	`´štf
("Can't‡lloc memory !\n");

365 
	}
}

367 
	gCNuRaidMgn
::
	$AddRaid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

369 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

371 
¡ršg
 
¡rMDName
;

372 
út
;

373 *
pPrÙoBuf
 = 
NULL
;

374 
S”L’
;

375 
boŞ
 
»¶y_¡©
 = 
çl£
;

376 
nu¿id¡©
::
nu_¿id_add_msg
 
add_¿id
;

378 
	`TRACE
("IPC AddRaid method call ! \n");

380 iàĞ
buf
 =ğ
NULL
 )

383 ià(! 
add_¿id
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !‡dd_¿id.
	`IsIn™Ÿlized
() ) {

384 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

388 
	`kl_´oc
();

392 iàĞ
add_¿id
.
	`Ëv–
() != 0 &&‡dd_raid.level() != 1 &&‡dd_raid.level() != 5 &&‡dd_raid.level() != 6 &&‡dd_raid.level() != 10 ) {

393 
	`ASSERT2
(0,"AddRaid : IÅuˆËv– %dƒ¼Ü !\n",
add_¿id
.
	`Ëv–
());

396 iàĞ
add_¿id
.
	`chdevs_size
(è<ğ0 ||‡dd_¿id.chdevs_size(è> 
MAX_DISK_NUM
 ) {

397 
	`ASSERT2
(0,"AddRaid : iÅuˆdeviû %dƒ¼Ü !\n",
add_¿id
.
	`chdevs_size
());

400 iàĞ
add_¿id
.
	`Ëv–
(è=ğ1 &&‡dd_¿id.
	`chdevs_size
() < 2 ) {

401 
	`ASSERT2
(0,"AddRaid : input†evel 1 devices must be morehan 1 !\n");

404 iàĞ
add_¿id
.
	`Ëv–
(è=ğ5 &&‡dd_¿id.
	`chdevs_size
() < 3 ) {

405 
	`ASSERT2
(0,"AddRaid : input†evel 5 devices must be morehan 3 !\n");

408 iàĞ
add_¿id
.
	`Ëv–
(è=ğ6 &&‡dd_¿id.
	`chdevs_size
() < 4 ) {

409 
	`ASSERT2
(0,"AddRaid : input†evel 5 devices must be morehan 4 !\n");

412 ifĞ
add_¿id
.
	`Ëv–
(è=ğ10 &&‡dd_¿id.
	`chdevs_size
() != 4 )

414 
	`ASSERT2
(0,"AddRaid : input†evel 10 devices must be 4 !\n");

418 
veùÜ
<
¡ršg
> 
vDevLi¡
;

419 
size_t
 
i
 = 0; i < 
add_¿id
.
	`chdevs_size
(); i++) {

420 
»¶y_¡©
 = 
çl£
;

422 
RAIDDiskInfo
 
šfo
;

423 ià(
m_¿idMgr
.
	`G‘DisksInfo
(
add_¿id
.
	`chdevs
(
i
).
	`c_¡r
(), 
šfo
)) {

424 
»¶y_¡©
 = 
Œue
;

425 
vDevLi¡
.
	`push_back
(
add_¿id
.
	`chdevs
(
i
));

428 ifĞ! 
»¶y_¡©
 ) {

429 
	`ASSERT2
(0,"AddRaid : iÅuˆdeviû % ”rÜ !\n",
add_¿id
.
	`chdevs
(
i
).
	`c_¡r
());

434 ifĞ! 
»¶y_¡©
 )

448 
m_¿idMgr
.
	`C»©eRAID
(
vDevLi¡
, 
add_¿id
.
	`Ëv–
(), 
¡rMDName
);

449 
m_¿idMgr
.
	`FÜm©
(
¡rMDName
);

453 
	`¡¬t_´oc
();

455 
nu¿id¡©
::
nu_g’”®_»¥Ú£_msg
 
»¥Ú£_msg
;

457 iàĞ
»¶y_¡©
 ) {

458 
»¥Ú£_msg
.
	`£t_”rÜ
(1);

459 
»¥Ú£_msg
.
	`£t_”r_msg
(
¡rMDName
);

461 
»¥Ú£_msg
.
	`£t_”rÜ
(0);

464 
S”L’
 = 
»¥Ú£_msg
.
	`By‹Size
();

465 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

467 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

468 ià(
pPrÙoBuf
) {

469 
»¥Ú£_msg
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

471 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

472 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

473 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

474 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

476 
	`ä“
(
pPrÙoBuf
);

478 
	`ASSERT2
(0,"Can't‡lloc memory !\n");

480 
	}
}

482 
	gCNuRaidMgn
::
	$D–Raid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

484 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

486 
	`TRACE
("IPC DelRaid method call ! \n");

488 iàĞ
buf
 =ğ
NULL
 )

491 
nu¿id¡©
::
nu_¿id_d–_msg
 
»que¡_d–_¿id
;

493 iàĞ! 
»que¡_d–_¿id
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_d–_¿id.
	`IsIn™Ÿlized
() ) {

494 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

498 iàĞ
»que¡_d–_¿id
.
	`has_ch¿id
() ) {

499 
	`TRACE
("d–‘¿id i % \n",
»que¡_d–_¿id
.
	`ch¿id
().
	`c_¡r
());

501 
	`ASSERT2
(0,"Message Has No Parameters\n");

505 
	`kl_´oc
();

507 
út
;

508 *
pPrÙoBuf
 = 
NULL
;

509 
S”L’
;

510 
boŞ
 
»¶y_¡©
 = 
çl£
;

512 
RAIDInfo
 
šfo
;

513 ià(
m_¿idMgr
.
	`G‘RAIDInfo
(
»que¡_d–_¿id
.
	`ch¿id
(), 
šfo
)) {

514 
»¶y_¡©
 = 
Œue
;

515 
m_¿idMgr
.
	`D–‘eRAID
(
šfo
.
m_¡rDevNodeName
);

518 
	`¡¬t_´oc
();

520 
nu¿id¡©
::
nu_g’”®_»¥Ú£_msg
 
»¥Ú£_msg
;

522 iàĞ
»¶y_¡©
 ) {

523 
»¥Ú£_msg
.
	`£t_”rÜ
(1);

525 
»¥Ú£_msg
.
	`£t_”rÜ
(0);

528 
S”L’
 = 
»¥Ú£_msg
.
	`By‹Size
();

529 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

531 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

532 ià(
pPrÙoBuf
) {

533 
»¥Ú£_msg
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

535 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

536 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

537 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

538 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

540 
	`ä“
(
pPrÙoBuf
);

542 
	`ASSERT2
(0,"Can't‡lloc memory !\n");

544 
	}
}

546 
	gCNuRaidMgn
::
	$FÜm©Raid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

548 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

549 
	`TRACE
("IPC FormatRaid method call ! \n");

551 ifĞ
buf
 =ğ
NULL
 )

554 
boŞ
 
»¶y_¡©
 = 
çl£
;

555 *
pPrÙoBuf
 = 
NULL
;

556 
S”L’
, 
út
;

558 
nu¿id¡©
::
nu_¿id_fÜm©_msg
 
»que¡_fÜm©_¿id
;

560 iàĞ! 
»que¡_fÜm©_¿id
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_fÜm©_¿id.
	`IsIn™Ÿlized
() ) {

561 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

565 iàĞ
»que¡_fÜm©_¿id
.
	`has_ch¿id
() ) {

566 
	`TRACE
("fÜm©„aid i % \n",
»que¡_fÜm©_¿id
.
	`ch¿id
().
	`c_¡r
());

568 
	`ASSERT2
(0,"Message Has No Parameters\n");

572 
	`kl_´oc
();

574 
RAIDInfo
 
šfo
;

575 ià(
m_¿idMgr
.
	`G‘RAIDInfo
(
»que¡_fÜm©_¿id
.
	`ch¿id
(), 
šfo
)) {

576 ià(!
m_¿idMgr
.
	`UnmouÁ
(
»que¡_fÜm©_¿id
.
	`ch¿id
())) {

579 ià(!
m_¿idMgr
.
	`FÜm©
(
»que¡_fÜm©_¿id
.
	`ch¿id
())) {

584 
»¶y_¡©
 = 
Œue
;

587 
	`¡¬t_´oc
();

589 
nu¿id¡©
::
nu_g’”®_»¥Ú£_msg
 
»¥Ú£_msg
;

591 iàĞ
»¶y_¡©
 ) {

592 
»¥Ú£_msg
.
	`£t_”rÜ
(1);

593 
»¥Ú£_msg
.
	`£t_”r_msg
(
»que¡_fÜm©_¿id
.
	`ch¿id
());

595 
»¥Ú£_msg
.
	`£t_”rÜ
(0);

598 
S”L’
 = 
»¥Ú£_msg
.
	`By‹Size
();

599 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

601 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

602 ià(
pPrÙoBuf
) {

603 
»¥Ú£_msg
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

605 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

606 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

607 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

608 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

610 
	`ä“
(
pPrÙoBuf
);

613 
	`ASSERT2
(0,"Can't‡lloc memory !\n");

615 
	}
}

617 
	gCNuRaidMgn
::
	$ModifyRaid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

619 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

621 
	`TRACE
("IPC ModifyRaid method call ! \n");

623 ifĞ
buf
 =ğ
NULL
 )

626 
boŞ
 
»¶y_¡©
 = 
çl£
;

627 *
pPrÙoBuf
 = 
NULL
;

628 
S”L’
, 
út
;

629 
i
;

631 
nu¿id¡©
::
nu_¿id_modify_msg
 
»que¡_modify_¿id
;

633 ifĞ! 
»que¡_modify_¿id
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_modify_¿id.
	`IsIn™Ÿlized
() )

635 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

639 ifĞ
»que¡_modify_¿id
.
	`has_ch¿id
() )

641 
	`TRACE
("modify„aid i % \n",
»que¡_modify_¿id
.
	`ch¿id
().
	`c_¡r
());

645 
	`ASSERT2
(0,"Message Has No Parameters\n");

649 
	`kl_´oc
();

651 
RaidS‹
 *
¡
;

652 
chcommªd
[260] = {0};

653 
NuDiskInfo
 *
pDItmp
 = 
NULL
;

655 
RAIDInfo
 
šfo
;

656 ià(
m_¿idMgr
.
	`G‘RAIDInfo
(
»que¡_modify_¿id
.
	`ch¿id
(), 
šfo
)) {

657 ià(
m_¿idMgr
.
	`IsFÜm©ed
(
»que¡_modify_¿id
.
	`ch¿id
())) {

661 
veùÜ
<
¡ršg
> 
vDevLi¡
;

662 
boŞ
 
bR‘
 = 
çl£
;

664 
vDevLi¡
.
	`push_back
(
»que¡_modify_¿id
.
	`chdev
());

666  
»que¡_modify_¿id
.
	`imodifyty³
()) {

669 
bR‘
 = 
m_¿idMgr
.
	`M¬kFauÉyMDDisks
(
»que¡_modify_¿id
.
	`ch¿id
(),

670 
vDevLi¡
);

674 
bR‘
 = 
m_¿idMgr
.
	`RemoveMDDisks
(
»que¡_modify_¿id
.
	`ch¿id
(),

675 
vDevLi¡
);

680 
bR‘
 = 
m_¿idMgr
.
	`AddMDDisks
(
»que¡_modify_¿id
.
	`ch¿id
(),

681 
vDevLi¡
);

685 ià(
bR‘
) {

686 
»¶y_¡©
 = 
Œue
;

690 
	`¡¬t_´oc
();

692 
nu¿id¡©
::
nu_g’”®_»¥Ú£_msg
 
»¥Ú£_msg
;

694 iàĞ
»¶y_¡©
 ) {

695 
»¥Ú£_msg
.
	`£t_”rÜ
(1);

696 
»¥Ú£_msg
.
	`£t_”r_msg
(
»que¡_modify_¿id
.
	`ch¿id
());

698 
»¥Ú£_msg
.
	`£t_”rÜ
(0);

701 
S”L’
 = 
»¥Ú£_msg
.
	`By‹Size
();

702 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

704 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

705 ià(
pPrÙoBuf
) {

706 
»¥Ú£_msg
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

708 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

709 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

710 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

711 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

713 
	`ä“
(
pPrÙoBuf
);

715 
	`ASSERT2
(0,"Can't‡lloc memory !\n");

717 
	}
}

719 
	gCNuRaidMgn
::
	$AddDisk
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
, 
IsiSCSI
)

721 
	`TRACE
("IPC AddDisk signal call ! \n");

723 ifĞ
buf
 =ğ
NULL
 )

726 *
pPrÙoBuf
 = 
NULL
;

727 
S”L’
, 
út
;

729 
nu¿id¡©
::
nu_add_»move_disk_msg
 
»que¡_add_disk
;

731 ifĞ! 
»que¡_add_disk
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_add_disk.
	`IsIn™Ÿlized
() )

733 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

737 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

738 
	`´štf
("%s, %d\n", 
__func__
, 
__LINE__
);

739 ià(
»que¡_add_disk
.
	`chdev
().
	`fšd
("/dev/nuuo_iscsi"è!ğ
¡ršg
::
Åos
) {

740 
	`´štf
("%s, %d\n", 
__func__
, 
__LINE__
);

741 
m_¿idMgr
.
	`AddDisk
(
»que¡_add_disk
.
	`chdev
());

742 
m_¿idMgr
.
	`AddDiskSymLšk
(
»que¡_add_disk
.
	`chdev
(), 
DISK_TYPE_ISCSI
);

743 } ià(
»que¡_add_disk
.
	`chdev
().
	`fšd
("/dev/nuuo_e§"è!ğ
¡ršg
::
Åos
) {

744 
m_¿idMgr
.
	`AddDisk
(
»que¡_add_disk
.
	`chdev
());

745 
m_¿idMgr
.
	`AddDiskSymLšk
(
»que¡_add_disk
.
	`chdev
(), 
DISK_TYPE_ESATA
);

746 } ià(
»que¡_add_disk
.
	`chdev
().
	`fšd
("/dev/nuuo_§"è!ğ
¡ršg
::
Åos
) {

747 
m_¿idMgr
.
	`AddDisk
(
»que¡_add_disk
.
	`chdev
());

748 
m_¿idMgr
.
	`AddDiskSymLšk
(
»que¡_add_disk
.
	`chdev
(), 
DISK_TYPE_SATA
);

750 
	`´štf
("%s, %d\n", 
__func__
, 
__LINE__
);

752 
	}
}

754 
	gCNuRaidMgn
::
	$RemoveDisk
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
, 
IsiSCSI
)

756 
	`TRACE
("IPC RemoveDisk signal call ! \n");

758 ifĞ
buf
 =ğ
NULL
 )

761 *
pPrÙoBuf
 = 
NULL
;

762 
S”L’
, 
út
;

764 
nu¿id¡©
::
nu_add_»move_disk_msg
 
»que¡_»move_disk
;

766 ifĞ! 
»que¡_»move_disk
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_»move_disk.
	`IsIn™Ÿlized
() )

768 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

772 
	`TRACE
("RemovDisk‚amğ% \n",
»que¡_»move_disk
.
	`chdev
().
	`c_¡r
());

774 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

775 
m_¿idMgr
.
	`RemoveDisk
(
»que¡_»move_disk
.
	`chdev
());

776 
m_¿idMgr
.
	`RemoveDiskSymLšk
(
»que¡_»move_disk
.
	`chdev
());

777 
	}
}

779 
	gCNuRaidMgn
::
	$HªdËIOE¼Ü1
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

782 
	`TRACE
("IPC KernelIOError1 signal call ! \n");

783 ifĞ
buf
 =ğ
NULL
 )

786 
	`TRACE
("K”ÃlIOE¼Ü1 = % \n",
buf
);

787 *
pch1
 = 
NULL
, *
pch2
 = NULL;

788 ifĞ
buf
 )

789 
pch1
 = 
	`¡¹ok
((*)
buf
,",");

790 ifĞ
pch1
 )

793 
pch1
 = 
	`¡¹ok
(
NULL
,",");

794 ifĞ
pch1
 )

797 
pch2
 = 
	`¡¹ok
(
NULL
,",");

798 ifĞ
pch2
 )

800 *
pdev
 = 
	`¡r¡r
(
pch1
,"sd");

801 
chLog
[260];

802 ifĞ
pdev
 =ğ
NULL
 )

804 
pdev
 = 
	`¡r¡r
(
pch1
,"md");

805 ifĞ
pdev
 )

808 
	`¥rštf
(
chLog
,"E¼Ü occur Ú VOLUME%d (I/Oƒ¼Ü, %s)",
	`©oi
(
pdev
 + 2è+ 1,
pch2
);

809 
	`MYLOG
("k”Ãl",0,
LOG_LOCAL0
,
LOG_ERR
,
chLog
);

810 
	`Wr™eDiskE¼Ü
(0,
	`©oi
(
pdev
 + 2è+ 1,
chLog
);

815 *
phd
 = 
	`G‘NuS©aName
(
pdev
);

817 ifĞ
phd
 )

820 
	`¥rštf
(
chLog
,"E¼Ü occur Ú % (I/Oƒ¼Ü, %s)",
	`HumªDisk
(
phd
),
pch2
);

821 
	`MYLOG
("k”Ãl",0,
LOG_LOCAL0
,
LOG_ERR
,
chLog
);

822 
	`Wr™eDiskE¼Ü
(1,
	`©oi
(
phd
 + 14è+ 1,
chLog
);

829 
	}
}

831 
	gCNuRaidMgn
::
	$HªdËIOE¼Ü2
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

834 
	`TRACE
("IPC KernelIOError2 signal call ! \n");

835 ifĞ
buf
 =ğ
NULL
 )

838 
	`TRACE
("K”ÃlIOE¼Ü2 = % \n",
buf
);

839 *
pch1
, *
pch2
;

841 
pch1
 = 
	`¡¹ok
((*)
buf
,",");

842 ifĞ
pch1
 )

845 
pch2
 = 
	`¡¹ok
(
NULL
,",");

846 ifĞ
pch2
 )

849 *
pdev
 = 
	`¡r¡r
(
pch1
,"sd");

850 
chLog
[260];

851 ifĞ
pdev
 =ğ
NULL
 )

853 
pdev
 = 
	`¡r¡r
(
pch1
,"md");

854 ifĞ
pdev
 )

857 
	`¥rštf
(
chLog
,"E¼Ü occur Ú VOLUME%d (bufã¸I/Oƒ¼Ü, %s)",
	`©oi
(
pdev
 + 2è+ 1,
pch2
);

858 
	`MYLOG
("k”Ãl",0,
LOG_LOCAL0
,
LOG_ERR
,
chLog
);

859 
	`Wr™eDiskE¼Ü
(0,
	`©oi
(
pdev
 + 2è+ 1,
chLog
);

864 *
phd
 = 
	`G‘NuS©aName
(
pdev
);

865 ifĞ
phd
 )

868 
	`¥rštf
(
chLog
,"E¼Ü occur Ú % (bufã¸I/Oƒ¼Ü, %s)",
	`HumªDisk
(
phd
),
pch2
);

869 
	`MYLOG
("k”Ãl",0,
LOG_LOCAL0
,
LOG_ERR
,
chLog
);

870 
	`Wr™eDiskE¼Ü
(1,
	`©oi
(
phd
 + 14è+ 1,
chLog
);

876 
	}
}

878 
	gCNuRaidMgn
::
	$HªdËEXT3_fsE¼Ü
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

881 
	`TRACE
("IPC KernelEXT3_fsError signal call ! \n");

882 ifĞ
buf
 =ğ
NULL
 )

885 
	`TRACE
("K”ÃlEXT3_fsE¼Ü = % \n",
buf
);

886 *
pch1
 = 
NULL
, *
pch2
;

887 
i
;

888 
chLog
[260];

889 
loÿl_buf
[1024];

892 
	`¡ºıy
(
loÿl_buf
, (cÚ¡ *)
buf
, 1024);

893 
pch1
 = 
	`¡r¡r
(
loÿl_buf
,"device");

894 ifĞ
pch1
 )

896 
pch1
 += 6;

897 *
pch1
 == ' ')

899 
pch1
++;

901 
pch2
 = 
pch1
;

902 *
pch2
 != ')')

904 
pch2
++;

905 if(*
pch2
 == '\0')

908 *
pch2
 = '\0';

909 
pch2
 = 
	`¡r¡r
(
pch1
,"md");

910 ifĞ
pch2
 )

912 ifĞ
m_pcsSt
 )

913 
m_pcsSt
->
	`Lock
();

914 
RaidS‹
 *
¡
;

915 
¡
=
m_¡©–i¡
; st; st=¡->
Ãxt
)

917 ifĞ
	`¡rcmp
(
¡
->
devÇme
 + 5,
pch2
) == 0 )

919 
¡
->
iK”ÃlE¼Ü
 = 1;

920 
	`¥rštf
(
chLog
,"Fsy¡emƒ¼Ü occur Ú VOLUME%d\n",
	`©oi
(
pch2
+2)+1);

921 
	`TRACE
("%s\n",
chLog
);

922 
	`Wr™eDiskE¼Ü
(0,
	`©oi
(
pch2
+2)+1,
chLog
);

926 ifĞ
m_pcsSt
 )

927 
m_pcsSt
->
	`UÆock
();

929 ifĞ(
pch2
 = 
	`¡r¡r
(
pch1
,"sd")è!ğ
NULL
 )

931 *
phd
 = 
	`G‘NuS©aName
(
pch2
);

932 ifĞ
phd
 )

934 
	`¥rštf
(
chLog
,"% fsy¡emƒ¼Ü",
	`HumªDisk
(
phd
));

935 
	`TRACE
("%s\n",
chLog
);

942 
	}
}

944 
	gCNuRaidMgn
::
	$Wr™eDiskE¼Ü
(
bIsDisk
, 
šdex
, *
msg
)

947 
	`sy¡em
("touch " 
NP_DISK_ERROR_FLAG
 );

950 
tm
 *
timešfo
 = 
NULL
;

951 
bufãr
[128],
bufãr1
[128];

952 
timev®
 
tv
;

954 
	`g‘timeofday
(&
tv
, 
NULL
);

955 
timešfo
 = 
	`loÿÉime
(&
tv
.
tv_£c
);

957 ifĞ! 
timešfo
 )

963 
ä“S·û
, 
tÙ®S·û
;

964 ià(0 =ğ
SYSUTILS_SPACE
::
	`G‘DiskS·ûStus64
("/", &
ä“S·û
, &
tÙ®S·û
))

967 
u£dR©io
 = 
	`û
Ğ(()(
tÙ®S·û
-
ä“S·û
)*100.0)/()totalSpace );

968 
	`TRACE
("roÙf : f»eS·û = %lu ,Ù®S·û = %lu , u£dR©iØğ%d \n",
ä“S·û
,
tÙ®S·û
,
u£dR©io
);

970 ifĞ
u£dR©io
 > 95 )

972 
	`MYLOG
("¿id",0,
LOG_LOCAL2
,
LOG_WARNING
,"Usage of file system capacity of„ootfs is over 95%%");

979 ifĞ
bIsDisk
 )

980 
	`¡ráime
(
bufãr1
,128, 
NP_DISK_ERROR
 "/DISK-%F_%H%M%S.%%03u",
timešfo
);

982 
	`¡ráime
(
bufãr1
,128, 
NP_DISK_ERROR
 "/VOLUME-%F_%H%M%S.%%03u",
timešfo
);

983 
	`¢´štf
(
bufãr
, (bufãr), 
bufãr1
, 
tv
.
tv_u£c
);

986 
FILE
 *
fe1
 = 
NULL
;

987 
fe1
 = 
	`fİ’
(
bufãr
,"w");

988 ifĞ
fe1
 )

990 
	`årštf
(
fe1
,"%d\n",
bIsDisk
);

991 
	`årštf
(
fe1
,"%d\n",
šdex
);

992 
	`årštf
(
fe1
,"%s\n",
msg
);

993 
	`fşo£
(
fe1
);

996 
	}
}

998 
	gCNuRaidMgn
::
	$kl_´oc
()

1001 
CNFSS”v”Mªag”
 
	`nfsS”v”Mgr
(
çl£
);

1003 ià(
nfsS”v”Mgr
.
	`IsNFSS”viûEÇbË
()) {

1004 
nfsS”v”Mgr
.
	`UÃxpÜtAÎVŞumesInLi¡
();

1006 
	`sy¡em
("/etc/init.d/nagent stop");

1009 
	}
}

1011 
	gCNuRaidMgn
::
	$¡¬t_´oc
()

1014 ifĞ! 
m_bFÜm©tšg
 )

1016 
CNFSS”v”Mªag”
 
	`nfsS”v”Mgr
(
çl£
);

1018 ià(
nfsS”v”Mgr
.
	`IsNFSS”viûEÇbË
()) {

1020 
CNFSS”viûMªagem’t
::
	`Re¡¬tNFSS”viû
();

1023 
	`sy¡em
("/etc/init.d/nagent„estart");

1027 
	}
}

	@../../../system/VolumeMgnService/NuRaidMgn.h

1 #iâdef 
__NU_RAID_MGN__


2 
	#__NU_RAID_MGN__


	)

4 
	~<veùÜ
>

5 
	~<com¶ex.h
>

7 
	~"NuLedsCŒl.h
"

9 
	~"´Ùo_d©a.h
"

10 
	~"nu¿id.pb.h
"

12 
	~"­r/­r_th»ad_wÜk”.h
"

13 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

14 
	~"¿id_mªag”/RAIDMªag”.h
"

16 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

17 
usšg
 
Çme¥aû
 
	g¡d
;

19 şas 
	cCNuRaidMgn
 : 
public
 
A´Th»adWÜk”


21 
public
:

23 
RAID_STATUS_FUNCTIONAL
= 0,

24 
	mRAID_STATUS_CRITITCAL
,

25 
	mRAID_STATUS_OFFLINE
,

26 
	mRAID_STATUS_FILE_SYS_ERR


29 
CNuRaidMgn
(
Cr™iÿlSeùiÚ
 *
pcsSt
, 
e§_idx
 = 4, 
§_num
 = 6, 
max_vŞumes
 = 11, 
iscsi_num
 = 6);

30 
	gvœtu®
 ~
CNuRaidMgn
();

33 
G‘Info
();

35 
G‘DisksInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

36 
G‘RaidsInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

37 
AddRaid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

38 
D–Raid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

39 
ModifyRaid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

40 
FÜm©Raid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

42 
AddDisk
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
, 
IsiSCSI
);

43 
RemoveDisk
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
, 
IsiSCSI
);

45 
HªdËIOE¼Ü1
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

46 
HªdËIOE¼Ü2
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

47 
HªdËEXT3_fsE¼Ü
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

49 
G‘F»eDisksInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
);

51 
S‘FÜm©Stus
(
bIsFÜm©
);

53 
	g´Ùeùed
:

54 
Th»adProc
();

56 
	g´iv©e
:

57 
In™Disks
();

58 
In™Raids
();

59 
kl_´oc
();

60 
¡¬t_´oc
();

61 
Wr™eUUID
(*
pP©h
, *
uuid
);

62 
S‘UUID
(
fd
, 
RaidS‹
 *
¡
);

65 
CheckRaidFromF»eDisks
();

68 
S‘DiskRaidStus
(*
chsymLšk
, 
iRaidStus
, 
iRecov”y
);

69 * 
G‘NuS©aName
(*
chsymLšk
);

70 
FšdNuS©aIndex
(*
chdev
);

72 
Wr™eDiskE¼Ü
(
bIsDisk
, 
šdex
, *
msg
);

73 
	g¡d
::
¡ršg
 
HumªDisk_¡d
(* 
dev
);

74 cÚ¡ * 
HumªVŞume
(* 
md
);

75 
CheckMouÁªdKÍroc
(*
·th
);

77 
nu_£t_diskšfo_to_´Ùo
(
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
, cÚ¡ 
RAIDDiskInfo
 &
šfo
);

80 
boŞ
 
	gm_bFÜm©tšg
;

86 
CNuLedsCŒl
 
	gm_LedCŒl
;

88 
Cr™iÿlSeùiÚ
 *
	gm_pcsSt
;

90 
	gm_e§_idx
;

91 
	gm_§_num
;

92 
	gm_max_vŞumes
;

93 
	gm_iscsi_num
;

96 
	gveùÜ
<
	gRAIDInfo
> 
	gm_vP»vRAIDInfoLi¡
;

97 
RAIDMªag”
 
	gm_¿idMgr
;

	@../../../system/VolumeMgnService/NuTitanStatIPC.cpp

2 
	~"ş›Á.h
"

3 
	~"´Ùo_d©a.h
"

5 
	~"NuT™ªStIPC.h
"

7 
	~<sys/ty³s.h
>

8 
	~<uni¡d.h
>

10 #ifdeà
NDEBUG


11 
	#DEBUG_MSG
(
fmt
, ...)

	)

13 
	#DEBUG_MSG
(
fmt
, ...è
	`årštf
(
¡d”r
, "[%s:%d %s] " fmt, 
__FILE__
, 
__LINE__
, 
__PRETTY_FUNCTION__
, ##
__VA_ARGS__
)

	)

17 
	~"c_commªd.h
"

19 *
	$NuT_Reque¡IPC
(
ušt32_t
 
c_cmd
, *
msg_buf
, 
msg_size
, *
iE¼Ü
, 
timeout
)

21 *
şi
 = 
NULL
;

22 
´Ùo_un™
 *
u
 = 
NULL
;

23 
şi
 = 
	`ü—‹_ş›Á_š¡ªû
();

24 ià(
NULL
 =ğ
şi
)

26 
	`DEBUG_MSG
("create_client_instance failed.\n");

27  
NULL
;

30 ià(0 !ğ
	`£t_uds_cÚn_´İ”ty
(
şi
, 
UDS_SERVICE_NAME
))

32 
	`DEBUG_MSG
("set_uds_conn_property failed.\n");

33 
»que¡_c_”rÜ
;

36 
u
 = 
	`ü—‹_´Ùo_un™
();

37 ià(
NULL
 =ğ
u
)

39 
	`DEBUG_MSG
("create_proto_unit failed.\n");

40 
»que¡_c_”rÜ
;

43 ià(0 !ğ
	`£t_´Ùo_un™_tok’
(
u
, 
	`g‘pid
()))

45 
	`DEBUG_MSG
("set_proto_unit_token failed.\n");

46 
»que¡_c_”rÜ
;

49 ià(0 !ğ
	`£t_´Ùo_un™_cmd
(
u
, 
c_cmd
))

51 
	`DEBUG_MSG
("set_proto_unit_cmd failed.\n");

52 
»que¡_c_”rÜ
;

57 ifĞ
msg_buf
 )

59 ià(0 !ğ
	`£t_´Ùo_un™_mes§ge
(
u
, 
msg_buf
))

61 
	`DEBUG_MSG
("set_proto_unit_message failed.\n");

62 
»que¡_c_”rÜ
;

65 ià(0 !ğ
	`£t_´Ùo_un™_mes§ge_size
(
u
, 
msg_size
))

67 
	`DEBUG_MSG
("set_proto_unit_message_size failed.\n");

68 
»que¡_c_”rÜ
;

72 ià(0 !ğ
	`£nd_»que¡
(
şi
, 
u
, 
timeout
))

74 
	`DEBUG_MSG
("send_request failed.\n");

75 
»que¡_c_”rÜ
;

79 
	`»Ëa£_´Ùo_un™
(
u
);

80 
u
 = 
NULL
;

84  
şi
;

86 
»que¡_c_”rÜ
:

88 ià(
şi
!=
NULL
)

90 
	`»Ëa£_ş›Á_š¡ªû
(
şi
);

91 
şi
 = 
NULL
;

94 ià(
u
!=
NULL
)

96 
	`»Ëa£_´Ùo_un™
(
u
);

97 
u
 = 
NULL
;

100  
NULL
;

102 
	}
}

104 
´Ùo_un™
* 
	$NuT_G‘R•ly
(*
şi
, 
ušt32_t
 *
cmd
, *
msg_Ën
, cÚ¡ **
buf
, 
timeout
)

106 
´Ùo_un™
 *
u
 = 
NULL
;

109 if(
şi
 =ğ
NULL
 || 
cmd
 =ğNULL || 
msg_Ën
 =ğNULL || 
buf
 == NULL)

110  
NULL
;

112 ià(0 !ğ
	`g‘_»¶y
(
şi
, &
u
, 
timeout
))

114 
	`DEBUG_MSG
("get_reply failed.\n");

115 
»¶y_c_”rÜ
;

118 
	`g‘_´Ùo_un™_cmd
(
u
,
cmd
);

119 
	`g‘_´Ùo_un™_mes§ge_size
(
u
,
msg_Ën
);

120 
	`g‘_´Ùo_un™_mes§ge
(
u
,
buf
);

121 
	`DEBUG_MSG
("»¶ay = cmd i %u , mes§gsizi %d , mes§gi %°\n",*
cmd
,*
msg_Ën
,*
buf
);

124  
u
;

126 
»¶y_c_”rÜ
:

128 ià(
u
!=
NULL
)

130 
	`»Ëa£_´Ùo_un™
(
u
);

131 
u
 = 
NULL
;

134  
NULL
;

135 
	}
}

137 
	$NuT_R–—£IPC
(*
şi
)

139 ià(
şi
!=
NULL
)

141 
	`»Ëa£_ş›Á_š¡ªû
(
şi
);

142 
şi
 = 
NULL
;

144 
	}
}

146 
	$NuT_R–—£Un™
(
´Ùo_un™
 *
u
)

148 ià(
u
!=
NULL
)

150 
	`»Ëa£_´Ùo_un™
(
u
);

151 
u
 = 
NULL
;

153 
	}
}

158 
	$T™ªG‘DiskInfo
(
nu¿id¡©
::
nu_g‘_disks_msg
 &
»¥Ú£_disks_šfo
, 
timeout_mli£cÚds
)

160 *
şi
 = 
NULL
;

161 
´Ùo_un™
 *
u
 = 
NULL
;

162 
iE¼Ü
 = 0;

167 
şi
 = 
	`NuT_Reque¡IPC
(
NUHW_GET_DISK_INFO
,
NULL
,0,&
iE¼Ü
,
timeout_mli£cÚds
);

168 ifĞ
şi
 =ğ
NULL
 )

170 
	`DEBUG_MSG
("Connection Null\n");

175 
ušt32_t
 
cmd
 = 0;

176 
msg_Ën
 = 0;

177 cÚ¡ *
buf
 = 
NULL
;

179 
u
 = 
	`NuT_G‘R•ly
(
şi
,&
cmd
,&
msg_Ën
,&
buf
,
timeout_mli£cÚds
);

180 ifĞ
u
 =ğ
NULL
 )

182 
	`DEBUG_MSG
("Get Reply Error !\n");

183 
	`NuT_R–—£IPC
(
şi
);

187 
»¥Ú£_disks_šfo
.
	`P¬£FromA¼ay
(
buf
,
msg_Ën
);

189 
	`NuT_R–—£Un™
(
u
);

190 
	`NuT_R–—£IPC
(
şi
);

193 
	}
}

195 
	$T™ªG‘F»eDiskInfo
(
nu¿id¡©
::
nu_g‘_disks_msg
 &
»¥Ú£_disks_šfo
, 
timeout_mli£cÚds
)

197 *
şi
 = 
NULL
;

198 
´Ùo_un™
 *
u
 = 
NULL
;

199 
iE¼Ü
 = 0;

204 
şi
 = 
	`NuT_Reque¡IPC
(
NUHW_GET_FREE_DISK_INFO
,
NULL
,0,&
iE¼Ü
,
timeout_mli£cÚds
);

205 ifĞ
şi
 =ğ
NULL
 )

207 
	`DEBUG_MSG
("Connection Null\n");

212 
ušt32_t
 
cmd
 = 0;

213 
msg_Ën
 = 0;

214 cÚ¡ *
buf
 = 
NULL
;

216 
u
 = 
	`NuT_G‘R•ly
(
şi
,&
cmd
,&
msg_Ën
,&
buf
,
timeout_mli£cÚds
);

217 ifĞ
u
 =ğ
NULL
 )

219 
	`DEBUG_MSG
("Get Reply Error !\n");

220 
	`NuT_R–—£IPC
(
şi
);

224 
»¥Ú£_disks_šfo
.
	`P¬£FromA¼ay
(
buf
,
msg_Ën
);

226 
	`NuT_R–—£Un™
(
u
);

227 
	`NuT_R–—£IPC
(
şi
);

230 
	}
}

232 
	$T™ªG‘RaidInfo
(
nu¿id¡©
::
nu_g‘_¿ids_msg
 &
»¥Ú£_¿ids_šfo
, 
timeout_mli£cÚds
)

234 *
şi
 = 
NULL
;

235 
´Ùo_un™
 *
u
 = 
NULL
;

236 
iE¼Ü
 = 0;

241 
şi
 = 
	`NuT_Reque¡IPC
(
NUHW_GET_RAID_INFO
,
NULL
,0,&
iE¼Ü
,
timeout_mli£cÚds
);

242 ifĞ
şi
 =ğ
NULL
 )

244 
	`DEBUG_MSG
("Connection Null\n");

249 
ušt32_t
 
cmd
 = 0;

250 
msg_Ën
 = 0;

251 cÚ¡ *
buf
 = 
NULL
;

253 
u
 = 
	`NuT_G‘R•ly
(
şi
,&
cmd
,&
msg_Ën
,&
buf
,
timeout_mli£cÚds
);

254 ifĞ
u
 =ğ
NULL
 )

256 
	`DEBUG_MSG
("Get Reply Error !\n");

257 
	`NuT_R–—£IPC
(
şi
);

261 
»¥Ú£_¿ids_šfo
.
	`P¬£FromA¼ay
(
buf
,
msg_Ën
);

263 
	`NuT_R–—£Un™
(
u
);

264 
	`NuT_R–—£IPC
(
şi
);

267 
	}
}

269 
	$T™ªAddRaid
(
nu¿id¡©
::
nu_¿id_add_msg
 &
»que¡_add_¿id
,‚u¿id¡©::
nu_g’”®_»¥Ú£_msg
 &
»¥Ú£_msg
, 
timeout_mli£cÚds
)

271 *
şi
 = 
NULL
;

272 
´Ùo_un™
 *
u
 = 
NULL
;

273 
iE¼Ü
 = 0;

274 *
msg_buf
 = 
NULL
;

275 
msg_size
 = 0;

278 
msg_size
 = 
»que¡_add_¿id
.
	`By‹Size
();

279 
	`DEBUG_MSG
(" s”Ÿlized sizi %d \n",
msg_size
);

281 
msg_buf
 = (*)
	`m®loc
(
msg_size
);

282 if(
msg_buf
)

284 
»que¡_add_¿id
.
	`S”ŸlizeToA¼ay
(
msg_buf
,
msg_size
);

288 
	`DEBUG_MSG
("Can't‡lloc memory!\n");

292 
şi
 = 
	`NuT_Reque¡IPC
(
NUHW_ADD_RAID
,
msg_buf
,
msg_size
,&
iE¼Ü
,
timeout_mli£cÚds
);

293 ifĞ
şi
 =ğ
NULL
 )

295 
	`ä“
(
msg_buf
);

296 
	`DEBUG_MSG
("Connection Null\n");

299 
	`ä“
(
msg_buf
);

302 
ušt32_t
 
cmd
 = 0;

303 
msg_Ën
 = 0;

304 cÚ¡ *
buf
 = 
NULL
;

306 
u
 = 
	`NuT_G‘R•ly
(
şi
,&
cmd
,&
msg_Ën
,&
buf
,
timeout_mli£cÚds
);

307 ifĞ
u
 =ğ
NULL
 )

309 
	`DEBUG_MSG
("Get Reply Error !\n");

310 
	`NuT_R–—£IPC
(
şi
);

314 
»¥Ú£_msg
.
	`P¬£FromA¼ay
(
buf
,
msg_Ën
);

316 
	`NuT_R–—£Un™
(
u
);

317 
	`NuT_R–—£IPC
(
şi
);

320 
	}
}

322 
	$T™ªD–Raid
(
nu¿id¡©
::
nu_¿id_d–_msg
 &
»que¡_d–_¿id
,‚u¿id¡©::
nu_g’”®_»¥Ú£_msg
 &
»¥Ú£_msg
, 
timeout_mli£cÚds
)

324 *
şi
 = 
NULL
;

325 
´Ùo_un™
 *
u
 = 
NULL
;

326 
iE¼Ü
 = 0;

327 *
msg_buf
 = 
NULL
;

328 
msg_size
 = 0;

331 
msg_size
 = 
»que¡_d–_¿id
.
	`By‹Size
();

332 
	`DEBUG_MSG
(" s”Ÿlized sizi %d \n",
msg_size
);

334 
msg_buf
 = (*)
	`m®loc
(
msg_size
);

335 if(
msg_buf
)

337 
»que¡_d–_¿id
.
	`S”ŸlizeToA¼ay
(
msg_buf
,
msg_size
);

341 
	`DEBUG_MSG
("Can't‡lloc memory!\n");

345 
şi
 = 
	`NuT_Reque¡IPC
(
NUHW_DEL_RAID
,
msg_buf
,
msg_size
,&
iE¼Ü
,
timeout_mli£cÚds
);

346 ifĞ
şi
 =ğ
NULL
 )

348 
	`ä“
(
msg_buf
);

349 
	`DEBUG_MSG
("Connection Null\n");

352 
	`ä“
(
msg_buf
);

355 
ušt32_t
 
cmd
 = 0;

356 
msg_Ën
 = 0;

357 cÚ¡ *
buf
 = 
NULL
;

359 
u
 = 
	`NuT_G‘R•ly
(
şi
,&
cmd
,&
msg_Ën
,&
buf
,
timeout_mli£cÚds
);

360 ifĞ
u
 =ğ
NULL
 )

362 
	`DEBUG_MSG
("Get Reply Error !\n");

363 
	`NuT_R–—£IPC
(
şi
);

367 
»¥Ú£_msg
.
	`P¬£FromA¼ay
(
buf
,
msg_Ën
);

369 
	`NuT_R–—£Un™
(
u
);

370 
	`NuT_R–—£IPC
(
şi
);

373 
	}
}

375 
	$T™ªModifyRaid
(
nu¿id¡©
::
nu_¿id_modify_msg
 &
»que¡_modify_¿id
,‚u¿id¡©::
nu_g’”®_»¥Ú£_msg
 &
»¥Ú£_msg
, 
timeout_mli£cÚds
)

377 *
şi
 = 
NULL
;

378 
´Ùo_un™
 *
u
 = 
NULL
;

379 
iE¼Ü
 = 0;

380 *
msg_buf
 = 
NULL
;

381 
msg_size
 = 0;

384 
msg_size
 = 
»que¡_modify_¿id
.
	`By‹Size
();

385 
	`DEBUG_MSG
(" s”Ÿlized sizi %d \n",
msg_size
);

387 
msg_buf
 = (*)
	`m®loc
(
msg_size
);

388 if(
msg_buf
)

390 
»que¡_modify_¿id
.
	`S”ŸlizeToA¼ay
(
msg_buf
,
msg_size
);

394 
	`DEBUG_MSG
("Can't‡lloc memory!\n");

398 
şi
 = 
	`NuT_Reque¡IPC
(
NUHW_MODIFY_RAID
,
msg_buf
,
msg_size
,&
iE¼Ü
,
timeout_mli£cÚds
);

399 ifĞ
şi
 =ğ
NULL
 )

401 
	`ä“
(
msg_buf
);

402 
	`DEBUG_MSG
("Connection Null\n");

405 
	`ä“
(
msg_buf
);

408 
ušt32_t
 
cmd
 = 0;

409 
msg_Ën
 = 0;

410 cÚ¡ *
buf
 = 
NULL
;

412 
u
 = 
	`NuT_G‘R•ly
(
şi
,&
cmd
,&
msg_Ën
,&
buf
,
timeout_mli£cÚds
);

413 ifĞ
u
 =ğ
NULL
 )

415 
	`DEBUG_MSG
("Get Reply Error !\n");

416 
	`NuT_R–—£IPC
(
şi
);

420 
»¥Ú£_msg
.
	`P¬£FromA¼ay
(
buf
,
msg_Ën
);

422 
	`NuT_R–—£Un™
(
u
);

423 
	`NuT_R–—£IPC
(
şi
);

426 
	}
}

428 
	$T™ªFÜamtRaid
(
nu¿id¡©
::
nu_¿id_fÜm©_msg
 &
»que¡_fÜm©_¿id
,‚u¿id¡©::
nu_g’”®_»¥Ú£_msg
 &
»¥Ú£_msg
, 
timeout_mli£cÚds
)

430 *
şi
 = 
NULL
;

431 
´Ùo_un™
 *
u
 = 
NULL
;

432 
iE¼Ü
 = 0;

433 *
msg_buf
 = 
NULL
;

434 
msg_size
 = 0;

437 
msg_size
 = 
»que¡_fÜm©_¿id
.
	`By‹Size
();

438 
	`DEBUG_MSG
(" s”Ÿlized sizi %d \n",
msg_size
);

440 
msg_buf
 = (*)
	`m®loc
(
msg_size
);

441 if(
msg_buf
)

443 
»que¡_fÜm©_¿id
.
	`S”ŸlizeToA¼ay
(
msg_buf
,
msg_size
);

447 
	`DEBUG_MSG
("Can't‡lloc memory!\n");

451 
şi
 = 
	`NuT_Reque¡IPC
(
NUHW_FORMAT_RAID
,
msg_buf
,
msg_size
,&
iE¼Ü
,
timeout_mli£cÚds
);

452 ifĞ
şi
 =ğ
NULL
 )

454 
	`ä“
(
msg_buf
);

455 
	`DEBUG_MSG
("Connection Null\n");

458 
	`ä“
(
msg_buf
);

461 
ušt32_t
 
cmd
 = 0;

462 
msg_Ën
 = 0;

463 cÚ¡ *
buf
 = 
NULL
;

465 
u
 = 
	`NuT_G‘R•ly
(
şi
,&
cmd
,&
msg_Ën
,&
buf
,
timeout_mli£cÚds
);

466 ifĞ
u
 =ğ
NULL
 )

468 
	`DEBUG_MSG
("Get Reply Error !\n");

469 
	`NuT_R–—£IPC
(
şi
);

473 
»¥Ú£_msg
.
	`P¬£FromA¼ay
(
buf
,
msg_Ën
);

475 
	`NuT_R–—£Un™
(
u
);

476 
	`NuT_R–—£IPC
(
şi
);

479 
	}
}

	@../../../system/VolumeMgnService/NuTitanStatIPC.h

1 #iâdef 
__NU_TITAN_STAT_IPC__


2 
	#__NU_TITAN_STAT_IPC__


	)

4 
	~"nu¿id.pb.h
"

7 
	#NU_DEFAULT_CMD_TIMEOUT
 30000

	)

11 
T™ªG‘DiskInfo
(
nu¿id¡©
::
nu_g‘_disks_msg
 &
»¥Ú£_disks_šfo
, 
timeout_mli£cÚds
 = 
NU_DEFAULT_CMD_TIMEOUT
);

13 
T™ªG‘RaidInfo
(
nu¿id¡©
::
nu_g‘_¿ids_msg
 &
»¥Ú£_¿ids_šfo
, 
timeout_mli£cÚds
 = 
NU_DEFAULT_CMD_TIMEOUT
);

14 
T™ªG‘F»eDiskInfo
(
nu¿id¡©
::
nu_g‘_disks_msg
 &
»¥Ú£_disks_šfo
, 
timeout_mli£cÚds
 = 
NU_DEFAULT_CMD_TIMEOUT
);

18 
T™ªAddRaid
(
nu¿id¡©
::
nu_¿id_add_msg
 &
»que¡_add_¿id
,‚u¿id¡©::
nu_g’”®_»¥Ú£_msg
 &
»¥Ú£_msg
, 
timeout_mli£cÚds
 = 
NU_DEFAULT_CMD_TIMEOUT
);

20 
T™ªD–Raid
(
nu¿id¡©
::
nu_¿id_d–_msg
 &
»que¡_d–_¿id
,‚u¿id¡©::
nu_g’”®_»¥Ú£_msg
 &
»¥Ú£_msg
, 
timeout_mli£cÚds
 = 
NU_DEFAULT_CMD_TIMEOUT
);

22 
T™ªModifyRaid
(
nu¿id¡©
::
nu_¿id_modify_msg
 &
»que¡_modify_¿id
,‚u¿id¡©::
nu_g’”®_»¥Ú£_msg
 &
»¥Ú£_msg
, 
timeout_mli£cÚds
 = 
NU_DEFAULT_CMD_TIMEOUT
);

24 
T™ªFÜamtRaid
(
nu¿id¡©
::
nu_¿id_fÜm©_msg
 &
»que¡_fÜm©_¿id
,‚u¿id¡©::
nu_g’”®_»¥Ú£_msg
 &
»¥Ú£_msg
, 
timeout_mli£cÚds
 = 
NU_DEFAULT_CMD_TIMEOUT
);

	@../../../system/VolumeMgnService/_NuRaidMgn.cpp

1 
	~<lim™s.h
>

2 
	~<sys/io.h
>

3 
	~<dœ’t.h
>

5 
	~<scsi/sg.h
>

6 
	~<scsi/scsi.h
>

7 
	~<sys/vfs.h
>

8 
	~<m©h.h
>

10 
	~"NuRaidMgn.h
"

11 
	~"Debug.h
"

13 
	~"¿id_ut.h
"

15 
	~"commÚ/fsu§ge64.h
"

17 
	~"£rviû.h
"

18 
	~"nfsS”v”/nfsS”v”.h
"

20 
	#NP_DISK_TIMEOUT
 "/tmp/disk_timeout"

	)

21 
	#NP_DISK_TIMEOUT_FLAG
 "/tmp/æag_disk_timeout"

	)

22 
	#NP_DISK_ERROR
 "/tmp/disk_”rÜ"

	)

23 
	#NP_DISK_ERROR_FLAG
 "/tmp/æag_disk_”rÜ"

	)

25 *
	g³rûÁ®”ts
[] = {

33 
	gabuf
[4096+4096];

34 
	$¬—d
(
fd
, *
buf
, 
Ën
)

41 
bsize
;

42 *
b
;

43 
n
;

44 ià(
	`ioùl
(
fd
, 
BLKSSZGET
, &
bsize
) != 0 ||

45 
bsize
 <ğ
Ën
)

46  
	`»ad
(
fd
, 
buf
, 
Ën
);

47 ià(
bsize
 > 4096)

49 
b
 = (*)((()(
abuf
+4096))&~4095UL);

51 
n
 = 
	`»ad
(
fd
, 
b
, 
bsize
);

52 ià(
n
 <= 0)

53  
n
;

54 
	`l£ek
(
fd
, 
Ën
 - 
n
, 1);

55 ià(
n
 > 
Ën
)

56 
n
 = 
Ën
;

57 
	`memıy
(
buf
, 
b
, 
n
);

58  
n
;

59 
	}
}

62 
	$cÚv”t_ascii
(
__u16
 *
p
, *
o
, 
__u8
 
Ëngth
)

64 
__u8
 
ii
;

65 
ş
;

67 
ii
 = 0; ii< 
Ëngth
; ii++)

69 if(((è0x00ff&((*
p
)>>8)) != ' ')

71 if((
ş
 = (è0x00ff&(*
p
)) != ' ')

73 if(
ş
 != '\0')

75 *
o
++ = 
ş
;

76 
p
++; 
ii
++;

79 
p
++;

82 ; 
ii
 < 
Ëngth
; ii++)

84 
__u8
 
c
;

86 
c
 = (*
p
) >> 8;

87 ià(
c
)

89 *
o
++ = 
c
;

90 
c
 = (*
p
);

91 ià(
c
)

93 *
o
++ = 
c
;

94 
p
++;

97 
	}
}

99 
	gCNuRaidMgn
::
	$CNuRaidMgn
(
CNuCr™Sec
 *
pcsSt
, 
e§_idx
, 
§_num
, 
max_vŞumes
)

100 : 
	`m_e§_idx
(
e§_idx
)

101 , 
	`m_§_num
(
§_num
)

102 , 
	$m_max_vŞumes
(
max_vŞumes
)

104 
m_pcsSt
 = 
pcsSt
;

105 
m_¡©–i¡
 = 
NULL
;

106 
m_bIsFÜm©
 = 0;

108 
	`mkdœ
(
NP_DISK_TIMEOUT
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

109 
	`mkdœ
(
NP_DISK_ERROR
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

111 
	`kl_´oc
();

113 
	`In™Disks
();

114 
	`In™Raids
();

115 
	}
}

117 
	gCNuRaidMgn
::~
	$CNuRaidMgn
()

120 
	}
}

122 
	gCNuRaidMgn
::
	$CheckDiskšfo
(
šdex
, 
NuDiskInfo
 *
pDiskšfo
, 
iü—‹¿id
)

124 ifĞ
pDiskšfo
 =ğ
NULL
 )

128 
fd
 = -1;

129 
off£t
;

130 
sb_off£t
;

131 
b™m­_su³r_s
 *
bsb
 = 
NULL
;

133 
	`TRACE
("Deviû Nam: % , symbŞ†šk i % \n",
pDiskšfo
->
chdev
,pDiskšfo->
chsymLšk
);

135 
fd
 = 
	`İ’
(
pDiskšfo
->
chdev
,
O_RDONLY
 | 
O_NONBLOCK
);

136 if(
fd
 >= 0 )

138 
m_LedCŒl
.
	`S©aNÜm®Stus
(
šdex
,0,1);

140 
sg_io_hdr_t
 
io_hdr
 = {0};

141 
šq_»¥
[
INQUIRY_RESP_INITIAL_LEN
] = {0};

142 
šqCmdBlk
[
INQUIRY_CMDLEN
] = {
INQUIRY_CMD
, 0, 0, 0, 0, 0};

143 
£n£_b
[
SENSE_BUFF_LEN
] = {0}, *
desc
 = 
NULL
;

145 
šq_»¥
[0] = 0x7f;

146 
šqCmdBlk
[4] = ()(
šq_»¥
);

147 
io_hdr
.
š‹rçû_id
 = 'S';

148 
io_hdr
.
dxã½
 = 
šq_»¥
;

149 
io_hdr
.
dxãr_Ën
 = (
šq_»¥
);

150 
io_hdr
.
dxãr_dœeùiÚ
 = 
SG_DXFER_FROM_DEV
;

151 
io_hdr
.
cmdp
 = (*)
šqCmdBlk
;

152 
io_hdr
.
cmd_Ën
 = (
šqCmdBlk
);

153 
io_hdr
.
sbp
 = 
£n£_b
;

154 
io_hdr
.
mx_sb_Ën
 = (
£n£_b
);

156 
io_hdr
.
timeout
 = 10000;

160 ià(
	`ioùl
(
fd
, 
SG_IO
, &
io_hdr
) < 0)

162 
	`ASSERT2
(0, " SG_IO ioùÈnÙ suµÜ‹d : % \n",
	`¡»¼Ü
(
”ºo
));

166 
	`memıy
(
pDiskšfo
->
v’dÜ
, 
šq_»¥
 + 8, 8);

167 
	`memıy
(
pDiskšfo
->
Mod–
, 
šq_»¥
 + 16, 16);

168 
	`memıy
(
pDiskšfo
->
FwRev
, 
šq_»¥
 + 32, 4);

170 
	`TRACE
("\ˆv’dÜ = % \n",
pDiskšfo
->
v’dÜ
);

171 
	`TRACE
("\ˆMod– = % \n",
pDiskšfo
->
Mod–
);

172 
	`TRACE
("\ˆFwRev = % \n",
pDiskšfo
->
FwRev
);

177 
cdb
[
SG_ATA_16_LEN
] = { 0 };

178 
__u8
 
d©a
[512] = { 0 };

179 
d©a_by‹s
 = 512;

181 
cdb
[0] = 
SG_ATA_16
;

182 
cdb
[1] = 
SG_ATA_PROTO_PIO_IN
;

183 
cdb
[2] = 
SG_CDB2_CHECK_COND
;

184 
cdb
[2] |ğ
SG_CDB2_TLEN_NSECT
 | 
SG_CDB2_TLEN_SECTORS
;

185 
cdb
[2] |ğ
SG_CDB2_TDIR_FROM_DEV
;

186 
cdb
[13] = 
ATA_USING_LBA
;

187 
cdb
[14] = 
ATA_OP_IDENTIFY
;

190 
	`mem£t
(&
io_hdr
, 0, (
sg_io_hdr
));

191 
io_hdr
.
š‹rçû_id
 = 'S';

192 
io_hdr
.
cmd_Ën
 = 
SG_ATA_16_LEN
;

193 
io_hdr
.
mx_sb_Ën
 = (
£n£_b
);

194 
io_hdr
.
dxãr_dœeùiÚ
 = 
SG_DXFER_FROM_DEV
;

195 
io_hdr
.
dxãr_Ën
 = 
d©a_by‹s
;

196 
io_hdr
.
dxã½
 = 
d©a
;

197 
io_hdr
.
cmdp
 = 
cdb
;

198 
io_hdr
.
sbp
 = 
£n£_b
;

199 
io_hdr
.
timeout
 = 10000;

202 ià(
	`ioùl
(
fd
, 
SG_IO
, &
io_hdr
) == -1)

204 
	`ASSERT2
(0," SG_IO ioùÈnÙ suµÜ‹d : % \n",
	`¡»¼Ü
(
”ºo
));

208 
	#SG_DRIVER_SENSE
 0x08

	)

209 
desc
 = 
£n£_b
 + 8;

210 ià(
io_hdr
.
driv”_¡©us
 !ğ
SG_DRIVER_SENSE
)

211 
	`TRACE
("io_hdr.driver_status != SG_DRIVER_SENSE\n");

212 ià(
£n£_b
[0] !ğ0x72 || s’£_b[7] < 14 || 
desc
[0] != 0x09 || desc[1] < 0x0c)

214 
	`TRACE
("SG_IO: bad/missing sense data, sense_b[]\n");

218 
__u16
 *
id
 = (__u16 *)(
d©a
);

219 
	`cÚv”t_ascii
(&
id
[10],
pDiskšfo
->
£rŸÊo
,10);

220 
	`TRACE
("\ˆS”ŸÈNØğ% \n",
pDiskšfo
->
£rŸÊo
);

227 
pDiskšfo
->
iIsA‰ach
 = 1;

228 
	`MYLOG
("disk",0,
LOG_LOCAL0
,
LOG_INFO
,"% i found",
	`HumªDisk
(
pDiskšfo
->
chdev
));

230 
dsize
 = 0;

231 iàĞ!
	`g‘_dev_size
(
fd
, 
pDiskšfo
->
chdev
, &
dsize
) )

233 
	`ASSERT2
(0," % Cª'ˆg‘ deviû siz\n",
pDiskšfo
->
chdev
);

234 
	`şo£
(
fd
);

238 
pDiskšfo
->
dsize
 = dsize;

240 
dsize
 >>= 9;

241 ifĞ
dsize
 < 24 )

243 
	`ASSERT2
(0," % i toØsm®ÈfÜ md: sizi %Îu seùÜs.\n",
pDiskšfo
->
chdev
, 
dsize
);

244 
	`şo£
(
fd
);

249 
off£t
 = 
	`MD_NEW_SIZE_SECTORS
(
dsize
>>9);

250 
off£t
 *= 512;

251 
sb_off£t
 = 4*2;

252 
	`ioùl
(
fd
, 
BLKFLSBUF
, 0);

254 ià(
	`l£ek64
(
fd
, 
sb_off£t
 << 9 , 0)< 0LL)

256 
	`ASSERT2
(0," CªnÙ s“kØsu³rblock oÀ%s: %s\n", 
pDiskšfo
->
chdev
, 
	`¡»¼Ü
(
”ºo
));

257 
	`şo£
(
fd
);

261 
mdp_su³rblock_1
 *
psu³r
;

262 
	smisc_dev_šfo
 {

263 
__u64
 
deviû_size
;

266 ià(
	`posix_mem®ign
((**)&
psu³r
, 512,

268 (
misc_dev_šfo
)) != 0)

270 
	`ASSERT2
(0," % could‚Ù‡Îoÿ‹ su³rblock\n", 
__func__
);

271 
	`şo£
(
fd
);

275 ià(
	`¬—d
(
fd
, 
psu³r
, 1024) != 1024)

277 
	`ASSERT2
(0, " CªnÙ„—d su³rblock oÀ%s\n",
pDiskšfo
->
chdev
);

278 
	`ä“
(
psu³r
);

279 
	`şo£
(
fd
);

283 ià(
	`__Ë32_to_ıu
(
psu³r
->
magic
è!ğ
MD_SB_MAGIC
)

285 
	`TRACE
(" NØsu³¸block found oÀ% (Ex³ùed magiø%08x, gÙ %08x)\n", 
pDiskšfo
->
chdev
, 
MD_SB_MAGIC
, 
	`__Ë32_to_ıu
(
psu³r
->
magic
));

286 
	`ä“
(
psu³r
);

287 
	`şo£
(
fd
);

291 ià(
	`__Ë32_to_ıu
(
psu³r
->
majÜ_v”siÚ
) != 1)

293 
	`TRACE
(" CªnÙ iÁ”´‘ su³rblock oÀ% - v”siÚ i %d\n",
pDiskšfo
->
chdev
, 
	`__Ë32_to_ıu
(
psu³r
->
majÜ_v”siÚ
));

294 
	`ä“
(
psu³r
);

295 
	`şo£
(
fd
);

298 ià(
	`__Ë64_to_ıu
(
psu³r
->
su³r_off£t
è!ğ
sb_off£t
) {

299 
	`TRACE
(" NØsu³rblock found oÀ% (su³r_off£ˆi wrÚg)\n",
pDiskšfo
->
chdev
);

300 
	`ä“
(
psu³r
);

301 
	`şo£
(
fd
);

305 ifĞ
psu³r
->
Ëv–
 != 0 &&…super->level != 1 &&…super->level != 5 &&…super->level != 10 )

307 
	`TRACE
(" % ha wrÚg„aid†ev– (%d)\n",
pDiskšfo
->
chdev
,
psu³r
->
Ëv–
);

308 
	`ä“
(
psu³r
);

309 
	`şo£
(
fd
);

313 
pDiskšfo
->
bRaidSu³rBlock
 = 1;

315 
	`memıy
(&(
pDiskšfo
->
su³r
),
psu³r
,(pDiskinfo->super));

317 
Ën
 = 32 , 
jj
;

319 
	`´štf
("MD_LEVEL=%d\n", 
	`__Ë32_to_ıu
(
psu³r
->
Ëv–
));

320 
	`´štf
("MD_DEVICES=%d\n", 
	`__Ë32_to_ıu
(
psu³r
->
¿id_disks
));

321 
jj
=0; jj<32; jj++)

322 ià(
psu³r
->
£t_Çme
[
jj
] == '\n' ||

323 
psu³r
->
£t_Çme
[
jj
] == '\0') {

324 
Ën
 = 
jj
;

327 ià(
Ën
)

328 
	`´štf
("MD_NAME=%.*s\n", 
Ën
, 
psu³r
->
£t_Çme
);

329 
	`´štf
("MD_UUID=");

330 
uuid
[64] = {0};

331 *
puuid
 = 
uuid
;

332 
jj
=0; jj<16; jj++) {

333 ià((
jj
&3)==0 && jj != 0)

335 
	`´štf
(":");

336 
	`¥rštf
(
puuid
,":");

337 
puuid
++;

339 
	`´štf
("%02x", 
psu³r
->
£t_uuid
[
jj
]);

340 
	`¥rštf
(
puuid
,"%02x", 
psu³r
->
£t_uuid
[
jj
]);

341 
puuid
+=2;

343 
	`´štf
("\n");

344 
	`´štf
("MD_UPDATE_TIME=%llu\n",

345 
	`__Ë64_to_ıu
(
psu³r
->
utime
) & 0xFFFFFFFFFFULL);

346 
	`´štf
("MD_DEV_UUID=");

347 
jj
=0; jj<16; jj++) {

348 ià((
jj
&3)==0 && jj !ğ0è
	`´štf
(":");

349 
	`´štf
("%02x", 
psu³r
->
deviû_uuid
[
jj
]);

351 
	`´štf
("\n");

352 
	`´štf
("MD_EVENTS=%llu\n",

353 ()
	`__Ë64_to_ıu
(
psu³r
->
ev’ts
));

357 
	`MYLOG
("disk",0,
LOG_LOCAL0
,
LOG_INFO
,"RAID infØoà%s:†ev– %d, uuid %s, %d deviû(s)",
	`HumªDisk
(
pDiskšfo
->
chdev
),

358 
	`__Ë32_to_ıu
(
psu³r
->
Ëv–
),
uuid
,__Ë32_to_ıuÕsu³r->
¿id_disks
));

360 
	`ä“
(
psu³r
);

361 
	`şo£
(
fd
);

368 
	}
}

370 
	gCNuRaidMgn
::
	$In™Disks
()

372 
i
;

374 
Cr™™ÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

376 
	`mem£t
(
m_DiskInfo
,0,(m_DiskInfo));

377 
i
=0;i<
m_§_num
;i++)

379 ifĞ
i
 >ğ
m_e§_idx
 )

380 
	`¥rštf
(
m_DiskInfo
[
i
].
chdev
,"/dev/nuuo_e§%d",i-
m_e§_idx
);

382 
	`¥rštf
(
m_DiskInfo
[
i
].
chdev
,"/dev/nuuo_sata%d",i);

384 
	`»adlšk
(
m_DiskInfo
[
i
].
chdev
,m_DiskInfo[i].
chsymLšk
,
NU_DEV_PATH_LEN
);

385 
	`TRACE
("Deviû Nam: % , symbŞ†šk i % \n",
m_DiskInfo
[
i
].
chdev
,m_DiskInfo[i].
chsymLšk
);

387 
	`CheckDiskšfo
(
i
,&(
m_DiskInfo
[i]),0);

388 ià(
m_DiskInfo
[
i
]->
iIsA‰ach
) {

389 
m_¿idMgr
->
	`AddDisk
(
m_DiskInfo
[
i
].
chsymLšk
, 
DISK_TYPE_LOCAL
);

393 #ifdeà
__NU_ISCSI


394 
dœ’t
 **
Çm–i¡
;

395 
n
;

397 
n
 = 
	`sÿndœ
("/dev/nu_iscsi", &
Çm–i¡
, 0, 
®phasÜt
);

398 ià(
n
 < 0)

400 
	`ASSERT2
(0,"iscsi scandirƒrror!\n");

404 
i
 = 
m_§_num
;

405 
n
--)

407 ifĞ
Çm–i¡
[
n
]->
d_ty³
 !ğ
DT_LNK
 )

409 
	`ä“
(
Çm–i¡
[
n
]);

412 
	`TRACE
("% , %d \n", 
Çm–i¡
[
n
]->
d_Çme
,Çm–i¡[n]->
d_ty³
);

413 ifĞ
	`¡rcmp
(
Çm–i¡
[
n
]->
d_Çme
,"."è!ğ0 && sŒcmpÒam–i¡[n]->d_Çme,".."è!ğ0 && 
i
 < 
MAX_DISK_NUM
 )

415 
	`¥rštf
(
m_DiskInfo
[
i
].
chdev
,"/dev/nu_iscsi/%s",
Çm–i¡
[
n
]->
d_Çme
);

416 
	`¥rštf
(
m_DiskInfo
[
i
].
chsymLšk
,"%s",
Çm–i¡
[
n
]->
d_Çme
);

418 
	`TRACE
("Deviû Nam: % , symbŞ†šk i % \n",
m_DiskInfo
[
i
].
chdev
,m_DiskInfo[i].
chsymLšk
);

420 
	`CheckDiskšfo
(
i
,&(
m_DiskInfo
[i]),0);

421 ià(
m_DiskInfo
[
i
]->
iIsA‰ach
) {

422 
m_¿idMgr
->
	`AddDisk
(
m_DiskInfo
[
i
].
chsymLšk
, 
DISK_TYPE_ISCSI
);

424 
i
++;

427 
	`ä“
(
Çm–i¡
[
n
]);

429 
	`ä“
(
Çm–i¡
);

432 
	}
}

434 
	gCNuRaidMgn
::
	$Th»adProc
()

436 
chcommªd
[260] = {0};

437 
i
;

438 
bCheckDisk
 = 0;

441 
md¡©_’t
 *
m£
;

444 
¡©fs64
 
tmp¡fs
;

445 if(
	`¡©fs64
 ("/v¬/checkdisk", &
tmp¡fs
) == 0)

447 
	`¥rštf
(
chcommªd
,"/etc/init.d/lighttpd„estart");

448 
	`sy¡em
(
chcommªd
);

449 
bCheckDisk
 = 1;

453 
m_¿idMgr
.
	`Upd©eRAIDInfo
();

454 
m_¿idMgr
.
	`G‘RAIDInfo
(
m_vP»vRAIDInfoLi¡
);

456 if(
bCheckDisk
)

458 
	`uÆšk
("/var/checkdisk");

459 
bCheckDisk
 = 0;

460 
	`¥rštf
(
chcommªd
,"/etc/init.d/lighttpd„estart");

461 
	`sy¡em
(
chcommªd
);

464 ifĞ
m_pcsSt
 )

465 
m_pcsSt
->
	`Lock
();

466 
	`¡¬t_´oc
();

467 ifĞ
m_pcsSt
 )

468 
m_pcsSt
->
	`UÆock
();

470 
	`¦“p
(3);

474 
	`Upd©eRAIDInfo
();

475 
m_bFÜm©tšg
 = 
çl£
;

477 ifĞ
m_pcsSt
 )

478 
m_pcsSt
->
	`Lock
();

480 
Ãw_found
 = 0;

481 
boŞ
 
bFÜm©tšg
 = 
çl£
;

482 
bTryS¹Proc
 = 0;

483 
RaidS‹
 *
¡
;

485 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vP»vRAIDInfoLi¡
.
	`begš
();

486 
™
 !ğ
m_vP»vRAIDInfoLi¡
.
	`’d
()) {

487 
RAIDInfo
 
šfo
;

488 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™_tmp
;

490 ià(!
m_¿idMgr
.
	`G‘RAIDInfo
(
™
->
m_¡rDevNodeName
, 
šfo
)) {

491 
™_tmp
 = 
™
++;

492 
m_vP»vRAIDInfoLi¡
.
	`”a£
(
™_tmp
);

497 ià(
šfo
.
m_fsMgr
.
	`g‘
(è!ğ
NULL
) {

498 
´og»ss
 = -1, 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
;

499 ià(!
šfo
.
m_fsMgr
->
	`IsFÜm©tšg
(
´og»ss
, 
¡©
)) {

501 
m_bFÜm©tšg
 = 
Œue
;

505 
šfo
.
	`Dump
();

508 ià(
šfo
.
m_iRAIDLev–
 =ğ
UnS‘
) {

517 ià(!
šfo
.
	`IsRAIDStusChªged
(*
™
)) {

527 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ALERT
, 
LOG_LABEL
, "%s's status changeo %s\n",

528 
™
->
m_¡rDevNodeName
.
	`c_¡r
(),

529 
šfo
.
m_¡rS‹
.
	`c_¡r
());

531 ià(
šfo
.
m_bRebudšg
) {

532 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ALERT
, 
LOG_LABEL
, "%s is„ebuilding,…rogress %02d%%\n",

533 
™
->
m_¡rDevNodeName
.
	`c_¡r
(),

534 
šfo
.
m_iRebudšgProg»ss
);

538 
size_t
 
i
 = 0; i < 
šfo
.
m_vDiskLi¡
.
	`size
(); i++) {

539 
boŞ
 
bFound
 = 
çl£
;

540 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™_disk
 = 
™
->
m_vDiskLi¡
.
	`begš
();

541 
™_disk
 !ğ
™
->
m_vDiskLi¡
.
	`’d
()) {

542 ià(*
™_disk
 =ğ
šfo
.
m_vDiskLi¡
[
i
]) {

543 
bFound
 = 
Œue
;

544 
chªge
 = 
™_disk
->
m_iS‹
 ^ 
šfo
.
m_vDiskLi¡
[
i
].m_iState;

545 ià(
šfo
.
m_Upd©eTime
 && 
chªge
) {

546 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ALERT
, 
LOG_LABEL
, "[%s] %s's state changeo %s\n",

547 
™
->
m_¡rDevNodeName
.
	`c_¡r
(),

548 
™_disk
->
¡rSoáLškName
.
	`c_¡r
(),

549 
šfo
.
m_¡rS‹
.
	`c_¡r
());

554 
™_disk
++;

557 ià(
bFound
)

560 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ALERT
, 
LOG_LABEL
, "[%s] %s is‚ewly‡dded, its state is %s.\n",

561 
™
->
m_¡rDevNodeName
.
	`c_¡r
(),

562 
™_disk
->
¡rSoáLškName
.
	`c_¡r
(),

563 
šfo
.
m_¡rS‹
.
	`c_¡r
());

567 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™_disk
 = 
™
->
m_vDiskLi¡
.
	`begš
();

568 
™_disk
 !ğ
™
->
m_vDiskLi¡
.
	`’d
()) {

569 
boŞ
 
bFound
 = 
çl£
;

570 
size_t
 
i
 = 0; i < 
šfo
.
m_vDiskLi¡
.
	`size
(); i++) {

571 ià(*
™_disk
 =ğ
šfo
.
m_vDiskLi¡
[
i
]) {

572 
bFound
 = 
Œue
;

577 ià(
bFound
) {

578 
™_disk
++;

582 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ALERT
, 
LOG_LABEL
, "[%s] %s is missing.\n",

583 
™
->
m_¡rDevNodeName
.
	`c_¡r
(),

584 
™_disk
->
¡rSoáLškName
.
	`c_¡r
());

585 
™_disk
++;

590 *
™
 = 
šfo
;

594 ià(!
m_bFÜm©tšg
) {

595 
	`TRACE
("Tryo start APP !!! \n");

596 
	`¡¬t_´oc
();

614 
iSy¡emAbnÜm®Stus
 = 0;

615 
iCheckAÎDiskA‰ach
;

616 
iDiskCouÁ
;

617 
i
=0;i<
MAX_DISK_NUM
;i++)

619 
m_DiskInfo
[
i
].
iRaidStus
 = 0;

621 
¡
=
m_¡©–i¡
; st; st=¡->
Ãxt
)

623 
iCheckAÎDiskA‰ach
 = 0;

624 
iDiskCouÁ
 = 0;

625 
i
=0;i<
MaxDisks
;i++)

627 *
dv
 = 
NULL
;

628 ifĞ
¡
->
devid
[
i
] )

630 
dv
 = 
	`m­_dev
(
	`majÜ
(
¡
->
devid
[
i
]),
	`mšÜ
(st->devid[i]), 0);

631 ifĞ
dv
 )

633 
iR–
 = 0;

634 
	`TRACE
("DISK % ¡©u %d \n",
dv
,
¡
->
dev¡©e
[
i
]);

635 iàĞ(
¡
->
dev¡©e
[
i
] & (1<<
MD_DISK_ACTIVE
)è&& (¡->dev¡©e[i] & (1<<
MD_DISK_SYNC
)) )

637 
iR–
 = 
	`S‘DiskRaidStus
(
dv
 + 5,1,
¡
->
³rûÁ
);

638 
	`TRACE
("DISK % i MD_DISK_ACTIVE | MD_DISK_SYNC , check„– = %d \n",
dv
,
iR–
);

639 ifĞ
iR–
 && 
¡
->
¬¿y
.
aùive_disks
 > 0 )

640 
¡
->
¬¿y
.
aùive_disks
--;

642 ià(
¡
->
dev¡©e
[
i
] & (1<<
MD_DISK_FAULTY
))

644 
iR–
 = 
	`S‘DiskRaidStus
(
dv
 + 5,2,
¡
->
³rûÁ
);

645 
	`TRACE
("DISK % i MD_DISK_FAULTY , check„– = %d \n",
dv
,
iR–
);

646 
iR–
 = 0;

648 ià(
¡
->
dev¡©e
[
i
] & (1<<
MD_DISK_REMOVED
))

650 
iR–
 = 
	`S‘DiskRaidStus
(
dv
 + 5,4,
¡
->
³rûÁ
);

651 
	`TRACE
("DISK % i MD_DISK_REMOVED , check„– = %d \n",
dv
,
iR–
);

652 
iR–
 = 0;

654 ià(
¡
->
dev¡©e
[
i
] & (1<<
MD_DISK_WRITEMOSTLY
))

656 
iR–
 = 
	`S‘DiskRaidStus
(
dv
 + 5,5,
¡
->
³rûÁ
);

657 
	`TRACE
("DISK % i MD_DISK_WRITEMOSTLY , check„– = %d \n",
dv
,
iR–
);

659 ià(
¡
->
dev¡©e
[
i
] == 0 )

661 
iR–
 = 
	`S‘DiskRaidStus
(
dv
 + 5,6,
¡
->
³rûÁ
);

662 
	`TRACE
("DISK % i ¥¬, check„– = %d \n",
dv
,
iR–
);

663 ifĞ
iR–
 && 
¡
->
¬¿y
.
¥¬e_disks
 > 0 )

664 
¡
->
¬¿y
.
¥¬e_disks
--;

668 
iR–
 = 
	`S‘DiskRaidStus
(
dv
 + 5,7,
¡
->
³rûÁ
);

669 
	`TRACE
("DISK % i unknowÀ, check„– = %d \n",
dv
,
iR–
);

671 ifĞ
iR–
 )

673 
iCheckAÎDiskA‰ach
 = -1;

676 
iDiskCouÁ
++;

681 
	`TRACE
("%s iDiskCount = %d , iKernelError = %d ,ƒrr = %d , st->array.level = %d , st->array.raid_disks = %d , st->array.active_disks = %d , st->array.spare_disks = %d\n",

682 
¡
->
devÇme
,
iDiskCouÁ
,¡->
iK”ÃlE¼Ü
,¡->
”r
,

683 
¡
->
¬¿y
.
Ëv–
,¡->¬¿y.
¿id_disks
,¡->¬¿y.
aùive_disks
,¡->¬¿y.
¥¬e_disks
);

689 ifĞ
¡
->
¬¿y
.
Ëv–
 == 0 )

691 ifĞ
iCheckAÎDiskA‰ach
 || 
iDiskCouÁ
 < 
¡
->
¬¿y
.
¿id_disks
 )

693 
¡
->
iE¼Ü
 = 2;

694 
iSy¡emAbnÜm®Stus
 = 2;

696 
¡
->
¬¿y
.
aùive_disks
 = 
iDiskCouÁ
;

697 
¡
->
¬¿y
.
çed_disks
 = st->¬¿y.
¿id_disks
 - 
iDiskCouÁ
;

699 ifĞ
¡
->
¬¿y
.
¿id_disks
 !ğ¡->¬¿y.
aùive_disks
 )

701 
¡
->
iE¼Ü
 = 2;

702 
iSy¡emAbnÜm®Stus
 = 2;

706 ifĞ
¡
->
iK”ÃlE¼Ü
 == 1 )

708 
¡
->
iE¼Ü
 = 3;

709 
iSy¡emAbnÜm®Stus
 = 2;

712 
¡
->
iE¼Ü
 = 0;

715 ifĞ
¡
->
¬¿y
.
Ëv–
 == 1 || st->array.level == 5 || st->array.level == 10 )

717 ifĞ
iCheckAÎDiskA‰ach
 )

719 
¡
->
iE¼Ü
 = 2;

720 
iSy¡emAbnÜm®Stus
 = 2;

722 ifĞ
¡
->
¬¿y
.
¿id_disks
 <ğ(¡->¬¿y.
aùive_disks
 + st->¬¿y.
¥¬e_disks
) )

724 ifĞ
¡
->
iK”ÃlE¼Ü
 == 1 )

726 
¡
->
iE¼Ü
 = 3;

727 
iSy¡emAbnÜm®Stus
 = 2;

730 
¡
->
iE¼Ü
 = 0;

733 ifĞ(
¡
->
¬¿y
.
¿id_disks
 - 1è=ğ¡->¬¿y.
aùive_disks
 )

735 ifĞ
¡
->
iK”ÃlE¼Ü
 == 1 )

737 
¡
->
iE¼Ü
 = 3;

738 
iSy¡emAbnÜm®Stus
 = 2;

742 
¡
->
iE¼Ü
 = 1;

743 ifĞ
iSy¡emAbnÜm®Stus
 == 0 )

744 
iSy¡emAbnÜm®Stus
 = 1;

749 
¡
->
iE¼Ü
 = 2;

750 
iSy¡emAbnÜm®Stus
 = 2;

753 ifĞ
¡
->
¬¿y
.
¿id_disks
 > st->¬¿y.
aùive_disks
 )

755 
¡
->
iE¼Ü
 = 2;

756 
iSy¡emAbnÜm®Stus
 = 2;

760 ifĞ
¡
->
iK”ÃlE¼Ü
 == 1 )

762 
¡
->
iE¼Ü
 = 3;

763 
iSy¡emAbnÜm®Stus
 = 2;

766 
¡
->
iE¼Ü
 = 0;

768 ifĞĞ
¡
->
iE¼Ü
 =ğ0 || st->iE¼Ü =ğ1 ) && st->
bIsMouÁ
 =ğ0 && st->
ucFÜm©St
 == 0 )

770 
¡
->
iE¼Ü
 = 3;

771 
iSy¡emAbnÜm®Stus
 = 2;

777 ifĞ
¡
->
bIsMouÁ
 )

779 
ä“S·û
, 
tÙ®S·û
;

780 ià(0 =ğ
SYSUTILS_SPACE
::
	`G‘DiskS·ûStus64
(
¡
->
chMouÁP©h
, &
ä“S·û
, &
tÙ®S·û
))

783 
u£dR©io
 = 
	`û
Ğ(()(
tÙ®S·û
-
ä“S·û
)*100.0)/()totalSpace );

784 
	`TRACE
("P©h % : f»eS·û = %lu ,Ù®S·û = %lu , u£dR©iØğ%d \n",
¡
->
chMouÁP©h
,
ä“S·û
,
tÙ®S·û
,
u£dR©io
);

786 ifĞ
¡
->
u£dR©io
 < 100 && usedRatio > 99 )

788 
	`MYLOG
("¿id",0,
LOG_LOCAL0
,
LOG_WARNING
,"U§goàfsy¡em c­ac™y oà% i 100%%",
	`HumªVŞume
(
¡
->
devÇme
));

790 ifĞ
¡
->
u£dR©io
 < 90 && usedRatio >= 90 )

794 
¡
->
u£dR©io
 = usedRatio;

802 ifĞ
iSy¡emAbnÜm®Stus
 == 1 )

804 
m_LedCŒl
.
	`Sy¡emE¼ÜStus
(0);

805 
m_LedCŒl
.
	`Buzz”CÚŒŞ
(250);

807 ifĞ
iSy¡emAbnÜm®Stus
 == 2 )

809 
m_LedCŒl
.
	`Sy¡emE¼ÜStus
(0);

810 
m_LedCŒl
.
	`Buzz”CÚŒŞ
(500);

813 
m_LedCŒl
.
	`Sy¡emNÜm®Stus
(0,1);

816 
i
=0;i<
MAX_DISK_NUM
;i++)

818 ifĞ
m_DiskInfo
[
i
].
iIsA‰ach
 )

820 ifĞ! 
m_DiskInfo
[
i
].
iRaidStus
 )

821 
m_LedCŒl
.
	`S©aNÜm®Stus
(
i
,0,1);

824 
m_LedCŒl
.
	`S©aNÜm®Stus
(
i
,0,0);

831 
m£
=
md¡©
; m£; m£=m£->
Ãxt
)

833 ià(
m£
->
devnum
 !ğ
INT_MAX


839 
RaidS‹
 *
¡
 = (RaidS‹*)
	`m®loc
( *st);

840 
mdu_¬¿y_šfo_t
 
¬¿y
;

841 
fd1
;

842 ià(
¡
 =ğ
NULL
)

844 
	`mem£t
(
¡
,0, *st);

845 
¡
->
devÇme
 = 
	`¡rdup
(
	`g‘_md_Çme
(
m£
->
devnum
));

846 ià((
fd1
 = 
	`İ’
(
¡
->
devÇme
, 
O_RDONLY
)) < 0 ||

847 
	`ioùl
(
fd1
, 
GET_ARRAY_INFO
, &
¬¿y
)< 0) {

849 ià(
fd1
 >=0è
	`şo£
(fd1);

850 
	`put_md_Çme
(
¡
->
devÇme
);

851 
	`ä“
(
¡
->
devÇme
);

852 
	`ä“
(
¡
);

856 
	`S‘UUID
(
fd1
,
¡
);

858 
	`şo£
(
fd1
);

860 
¡
->
Ãxt
 = 
m_¡©–i¡
;

861 
¡
->
”r
 = 1;

862 
¡
->
devnum
 = 
m£
->devnum;

863 
¡
->
³rûÁ
 = -2;

864 
¡
->
ex³ùed_¥¬es
 = -1;

866 ifĞ! 
¡
->
bIsMouÁ
 && ! st->
bIsfsck
 )

869 
	`kl_´oc
();

870 
	`¥rštf
(
¡
->
chMouÁP©h
,"/mÁ/VOLUME%d",
	`©oi
(¡->
devÇme
 + 7)+1);

871 
	`mkdœ
(
¡
->
chMouÁP©h
,
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

872 ifĞ
	`mouÁ
(
¡
->
devÇme
, st->
chMouÁP©h
, "ext4", 0 , "") == -1 )

874 
	`MYLOG
("¿id",0,
LOG_LOCAL0
,
LOG_ERR
,"Fsy¡emƒ¼Ü occur Ú %s",
	`HumªVŞume
(
¡
->
devÇme
));

875 
¡
->
bIsfsck
 = 1;

879 
	`Wr™eUUID
(
¡
->
chMouÁP©h
, st->
£t_uuid
);

881 
	`¥rštf
(
chcommªd
,"%s/VIDEODATA",
¡
->
chMouÁP©h
);

882 
	`mkdœ
(
chcommªd
,
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

884 
	`¥rštf
(
chcommªd
,"%s/LOG",
¡
->
chMouÁP©h
);

885 
	`mkdœ
(
chcommªd
,
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

887 
	`¥rštf
(
chcommªd
,"tuÃ2f -m 1 %s",
¡
->
devÇme
);

888 
	`sy¡em
(
chcommªd
);

890 
¡
->
bIsMouÁ
 = 1;

892 
	`TRACE
("% mouÁ sucûs !! \n",
¡
->
chMouÁP©h
);

894 
	`MYLOG
("¿id",0,
LOG_LOCAL0
,
LOG_INFO
,"% i »ady",
	`HumªVŞume
(
¡
->
devÇme
));

897 
	`¡¬t_´oc
();

901 
m_¡©–i¡
 = 
¡
;

906 ifĞ
m_pcsSt
 )

907 
m_pcsSt
->
	`UÆock
();

908 
	`¦“p
(3);

913 
	}
}

915 
	gCNuRaidMgn
::
	$S‘DiskRaidStus
(*
chsymLšk
, 
iRaidStus
, 
iRecov”y
)

917 
i
;

919 ifĞ
chsymLšk
 =ğ
NULL
 )

922 
i
=0;i<
MAX_DISK_NUM
;i++)

924 ifĞ
m_DiskInfo
[
i
].
iIsA‰ach
 && 
	`¡rcmp
(
chsymLšk
,m_DiskInfo[i].chsymLink) == 0 )

926 
m_DiskInfo
[
i
].
iRaidStus
 = iRaidStatus;

927 ifĞ
iRecov”y
 >= 0 )

928 
m_LedCŒl
.
	`S©aE¼ÜStus
(
i
,1);

930 
m_LedCŒl
.
	`S©aNÜm®Stus
(
i
,0,1);

938 
	}
}

940 * 
	gCNuRaidMgn
::
	$G‘NuS©aName
(*
chsymLšk
)

942 
i
;

944 ifĞ
chsymLšk
 =ğ
NULL
 )

945  
NULL
;

948 
i
=0;i<
MAX_DISK_NUM
;i++)

950 ifĞ
m_DiskInfo
[
i
].
iIsA‰ach
 && 
	`¡rcmp
(
chsymLšk
,m_DiskInfo[i].chsymLink) == 0 )

952  
m_DiskInfo
[
i
].
chdev
;

957  
NULL
;

958 
	}
}

961 
	gCNuRaidMgn
::
	$G‘Info
()

963 
CNuAutoLock
 
	`lock
(
m_pcsSt
);

965 
RaidS‹
 *
¡
;

966 
i
;

968 
¡
=
m_¡©–i¡
; st; st=¡->
Ãxt
)

970 
	`TRACE
("GetInfo : devname = %s , devnum = %d , utime = %lu ,ƒrr = %d ,‡ctive = %d , working = %d , failed = %d , spare = %d ,„aid = %d ,…ercent = %d \n",

971 
¡
->
devÇme
,¡->
devnum
, st->
¬¿y
.
utime
,¡->
”r
,¡->¬¿y.
aùive_disks
,¡->¬¿y.
wÜkšg_disks
,¡->¬¿y.
çed_disks
,¡->¬¿y.
¥¬e_disks
,¡->¬¿y.
¿id_disks
,¡->
³rûÁ
);

974 
i
=0;i<
¡
->
¬¿y
.
¿id_disks
;i++)

976 *
dv
 = 
NULL
;

977 
dv
 = 
	`m­_dev
(
	`majÜ
(
¡
->
devid
[
i
]),
	`mšÜ
(st->devid[i]), 0);

978 
	`TRACE
("deviû Çm: % , stu ğ%d \n",
dv
,
¡
->
dev¡©e
[
i
]);

982 
	}
}

984 
	gCNuRaidMgn
::
	$nu_£t_diskšfo_to_´Ùo
(
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
, cÚ¡ 
RAIDDiskInfo
 &
šfo
)

986 
pdiskšfo
->
	`£t_i§pÜt
(
šfo
.
m_iNumb”
 + 1);

987 
pdiskšfo
->
	`£t_chdev
(
šfo
.
m_¡rDevName
);

988 
pdiskšfo
->
	`£t_ii§‰ach
(1);

998 
pdiskšfo
->
	`£t_ty³
(
šfo
.
m_diskTy³
);

999 
	}
}

1001 
	gCNuRaidMgn
::
	$G‘DisksInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1003 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1005 
út
 = 0;

1006 
iDeviûs
 = 0;

1007 *
pPrÙoBuf
 = 
NULL
;

1008 
S”L’
 = 0;

1009 
nu¿id¡©
::
nu_g‘_disks_msg
 
g‘_disks_šfo
;

1010 
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
 = 
NULL
;

1012 
	`TRACE
("IPC GetDisksInfo method call ! \n");

1014 
g‘_disks_šfo
.
	`£t_max_disk_num
(
MAX_DISK_NUM
);

1015 
g‘_disks_šfo
.
	`£t_nu_§_num
(
m_§_num
);

1016 
g‘_disks_šfo
.
	`£t_nu_e§_num
(
m_§_num
 - 
m_e§_idx
);

1017 
g‘_disks_šfo
.
	`£t_nu_iscsi_num
(
NU_ISCSI_NUM
);

1019 
veùÜ
<
RAIDDiskInfo
> 
vDiskLi¡
;

1020 
m_¿idMgr
.
	`G‘DisksInfo
(
vDiskLi¡
);

1022 
size_t
 
i
 = 0; i < 
vDiskLi¡
.
	`size
(); i++) {

1024 
pdiskšfo
 = 
g‘_disks_šfo
.
	`add_diskšfo
();

1025 ifĞ
pdiskšfo
 ) {

1026 
	`nu_£t_diskšfo_to_´Ùo
(
pdiskšfo
, 
vDiskLi¡
[
i
]);

1031 
g‘_disks_šfo
.
	`£t_ideviûs
(
vDiskLi¡
.
	`size
());

1033 
S”L’
 = 
g‘_disks_šfo
.
	`By‹Size
();

1034 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

1036 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

1037 ià(
pPrÙoBuf
) {

1038 
g‘_disks_šfo
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

1040 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

1041 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

1042 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

1043 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

1045 
	`ä“
(
pPrÙoBuf
);

1048 
	`´štf
("Can't‡lloc memory !\n");

1050 
	}
}

1052 
	gCNuRaidMgn
::
	$G‘F»eDisksInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1054 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1056 
út
;

1057 *
pPrÙoBuf
 = 
NULL
;

1058 
S”L’
;

1059 
nu¿id¡©
::
nu_g‘_disks_msg
 
g‘_disks_šfo
;

1060 
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
 = 
NULL
;

1062 
	`TRACE
("IPC GetDisksInfo method call ! \n");

1064 
g‘_disks_šfo
.
	`£t_max_disk_num
(
MAX_DISK_NUM
);

1065 
g‘_disks_šfo
.
	`£t_nu_§_num
(
m_§_num
);

1066 
g‘_disks_šfo
.
	`£t_nu_e§_num
(
m_§_num
, 
m_e§_idx
);

1067 
g‘_disks_šfo
.
	`£t_nu_iscsi_num
(
NU_ISCSI_NUM
);

1069 
veùÜ
<
RAIDDiskInfo
> 
vDiskLi¡
;

1070 
m_¿idMgr
.
	`G‘DisksInfo
(
vDiskLi¡
);

1072 
size_t
 
i
 = 0; i < 
vDiskLi¡
.
	`size
(); i++) {

1073 ià(
vDiskLi¡
[
i
].
m_bHasMDSB
) {

1074 
pdiskšfo
 = 
g‘_disks_šfo
.
	`add_diskšfo
();

1075 iàĞ
pdiskšfo
 ) {

1076 
	`nu_£t_diskšfo_to_´Ùo
(
pdiskšfo
, 
vDiskLi¡
[
i
]);

1081 
g‘_disks_šfo
.
	`£t_ideviûs
(
vDiskLi¡
.
	`size
());

1083 
S”L’
 = 
g‘_disks_šfo
.
	`By‹Size
();

1084 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

1086 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

1087 ià(
pPrÙoBuf
) {

1088 
g‘_disks_šfo
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

1090 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

1091 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

1092 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

1093 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

1095 
	`ä“
(
pPrÙoBuf
);

1097 
	`´štf
("Can't‡lloc memory !\n");

1099 
	}
}

1101 
	gCNuRaidMgn
::
	$G‘RaidsInfo
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1103 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1105 
RaidS‹
 *
¡
;

1106 
k
,
út
;

1107 *
pPrÙoBuf
 = 
NULL
;

1108 
S”L’
;

1110 
nu¿id¡©
::
nu_g‘_¿ids_msg
 
g‘_¿ids_šfo
;

1111 
nu¿id¡©
::
nu_¿id_šfo
 *
´aidšfo
 = 
NULL
;

1112 
nu¿id¡©
::
nu_disk_šfo
 *
pdiskšfo
 = 
NULL
;

1114 
	`TRACE
("IPC GetRaidsInfo method call ! \n");

1116 
veùÜ
<
RAIDInfo
> 
li¡
;

1117 
m_¿idMgr
.
	`G‘RAIDInfo
(
li¡
);

1119 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i++) {

1120 
´aidšfo
 = 
g‘_¿ids_šfo
.
	`add_¿idšfo
();

1121 ifĞ
´aidšfo
 ) {

1122 
´aidšfo
->
	`£t_šdex
(
li¡
[
i
].
m_iMDNum
);

1123 
´aidšfo
->
	`£t_chdev
(
li¡
[
i
].
m_¡rDevNodeName
);

1125 
¡ršg
 
¡rMouÁPošt
;

1126 ià(
NULL
 !ğ
li¡
[
i
].
m_fsMgr
.
	`g‘
()) {

1127 ià(
li¡
[
i
].
m_fsMgr
->
	`IsMouÁed
(
¡rMouÁPošt
)) {

1128 
´aidšfo
->
	`£t_chmouÁ·th
(
¡rMouÁPošt
);

1129 
´aidšfo
->
	`£t_bismouÁ
(1);

1131 
´aidšfo
->
	`£t_bismouÁ
(0);

1136 
´aidšfo
->
	`£t_¿id_Ëv–
(
li¡
[
i
].
m_iRAIDLev–
);

1137 
´aidšfo
->
	`£t_¿id_size
(
li¡
[
i
].
m_uÎTÙ®C­ac™y
);

1139 
´aidšfo
->
	`£t_¿id_utime
(
li¡
[
i
].
m_Upd©eTime
);

1140 
´aidšfo
->
	`£t_disk_aùives
(
li¡
[
i
].
m_iAùiveDiskNum
);

1141 
´aidšfo
->
	`£t_disk_çeds
(
li¡
[
i
].
m_iFaedDiskNum
);

1142 
´aidšfo
->
	`£t_disk_¥¬es
(
li¡
[
i
].
m_iS·»DiskNum
);

1143 
´aidšfo
->
	`£t_¿id_disks
(
li¡
[
i
].
m_iRaidDiskNum
);

1144 
size_t
 
j
 = 0; j < 
li¡
[
i
].
m_vDiskLi¡
.
	`size
(); j++) {

1145 
pdiskšfo
 = 
´aidšfo
->
	`add_diskšfo
();

1146 iàĞ
pdiskšfo
 ) {

1147 
	`nu_£t_diskšfo_to_´Ùo
(
pdiskšfo
, 
li¡
[
i
].
m_vDiskLi¡
[
j
]);

1150 
´aidšfo
->
	`£t_£t_uuid
(
li¡
[
i
].
m_UUID
, (list[i].m_UUID));

1152 ià(
NULL
 !ğ
li¡
[
i
].
m_fsMgr
.
	`g‘
()) {

1153 
´og»ss
, 
¡©
;

1154 
li¡
[
i
].
m_fsMgr
->
	`IsFÜm©šg
(
´og»ss
, 
¡©
);

1155 
´aidšfo
->
	`£t_ucfÜm©¡©
(
¡©
);

1156 ià(
¡©
 =ğ
WRITE_INODE_TABLE_DONE
 ||

1157 
¡©
 =ğ
WRITE_INODE_TABLE_UNKOWN
 ||

1158 
¡©
 =ğ
WRITE_INODE_TABLE_ERROR
)

1159 
´aidšfo
->
	`£t_bisfÜm©
(0);

1161 
´aidšfo
->
	`£t_bisfÜm©
(1);

1166 
´aidšfo
->
	`£t_³rûÁ
(
li¡
[
i
].
m_iRebudšgProg»ss
);

1171 
S”L’
 = 
g‘_¿ids_šfo
.
	`By‹Size
();

1172 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

1174 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

1175 ià(
pPrÙoBuf
) {

1176 
g‘_¿ids_šfo
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

1178 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

1179 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

1180 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

1181 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

1183 
	`ä“
(
pPrÙoBuf
);

1185 
	`´štf
("Can't‡lloc memory !\n");

1187 
	}
}

1189 
	gCNuRaidMgn
::
	$AddRaid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1191 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1193 
út
;

1194 *
pPrÙoBuf
 = 
NULL
;

1195 
S”L’
;

1196 
boŞ
 
»¶y_¡©
 = 
çl£
;

1197 
nu¿id¡©
::
nu_¿id_add_msg
 
add_¿id
;

1199 
	`TRACE
("IPC AddRaid method call ! \n");

1201 iàĞ
buf
 =ğ
NULL
 )

1204 ià(! 
add_¿id
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !‡dd_¿id.
	`IsIn™Ÿlized
() ) {

1205 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

1209 
	`kl_´oc
();

1211 iàĞ
add_¿id
.
	`Ëv–
() != 0 &&‡dd_raid.level() != 1 &&‡dd_raid.level() != 5 &&‡dd_raid.level() != 6 &&‡dd_raid.level() != 10 ) {

1212 
	`ASSERT2
(0,"AddRaid : IÅuˆËv– %dƒ¼Ü !\n",
add_¿id
.
	`Ëv–
());

1215 iàĞ
add_¿id
.
	`chdevs_size
(è<ğ0 ||‡dd_¿id.chdevs_size(è> 
MAX_DISK_NUM
 ) {

1216 
	`ASSERT2
(0,"AddRaid : iÅuˆdeviû %dƒ¼Ü !\n",
add_¿id
.
	`chdevs_size
());

1219 iàĞ
add_¿id
.
	`Ëv–
(è=ğ1 &&‡dd_¿id.
	`chdevs_size
() < 2 ) {

1220 
	`ASSERT2
(0,"AddRaid : input†evel 1 devices must be morehan 1 !\n");

1223 iàĞ
add_¿id
.
	`Ëv–
(è=ğ5 &&‡dd_¿id.
	`chdevs_size
() < 3 ) {

1224 
	`ASSERT2
(0,"AddRaid : input†evel 5 devices must be morehan 3 !\n");

1227 iàĞ
add_¿id
.
	`Ëv–
(è=ğ6 &&‡dd_¿id.
	`chdevs_size
() < 4 ) {

1228 
	`ASSERT2
(0,"AddRaid : input†evel 5 devices must be morehan 4 !\n");

1231 ifĞ
add_¿id
.
	`Ëv–
(è=ğ10 &&‡dd_¿id.
	`chdevs_size
() != 4 )

1233 
	`ASSERT2
(0,"AddRaid : input†evel 10 devices must be 4 !\n");

1237 
veùÜ
<
¡ršg
> 
vDevLi¡
;

1238 
size_t
 
i
 = 0; i < 
add_¿id
.
	`chdevs_size
(); i++) {

1239 
»¶y_¡©
 = 
çl£
;

1241 
RAIDDiskInfo
 
šfo
;

1242 iàĞ
m_¿idMgr
.
	`G‘DiskInfo
(
add_¿id
.
	`chdevs
(
i
).
	`c_¡r
(), 
šfo
è&& !šfo.
m_bHasMDSB
 ) {

1243 
»¶y_¡©
 = 
Œue
;

1244 
vDevLi¡
.
	`push_back
(
add_¿id
.
	`chdevs
(
i
));

1247 ifĞ! 
»¶y_¡©
 ) {

1248 
	`ASSERT2
(0,"AddRaid : iÅuˆdeviû % ”rÜ !\n",
add_¿id
.
	`chdevs
(
i
).
	`c_¡r
());

1253 ifĞ! 
»¶y_¡©
 )

1267 
¡ršg
 
¡rMDName
;

1268 
m_¿idMgr
.
	`C»©eRaid
(
vDevLi¡
, 
add_¿id
.
	`Ëv–
(), 
¡rMDName
);

1270 
	`¡¬t_´oc
();

1272 
nu¿id¡©
::
nu_g’”®_»¥Ú£_msg
 
»¥Ú£_msg
;

1274 iàĞ
»¶y_¡©
 ) {

1275 
»¥Ú£_msg
.
	`£t_”rÜ
(1);

1276 
»¥Ú£_msg
.
	`£t_”r_msg
(
¡rMDName
);

1278 
»¥Ú£_msg
.
	`£t_”rÜ
(0);

1281 
S”L’
 = 
»¥Ú£_msg
.
	`By‹Size
();

1282 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

1284 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

1285 ià(
pPrÙoBuf
) {

1286 
»¥Ú£_msg
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

1288 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

1289 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

1290 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

1291 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

1293 
	`ä“
(
pPrÙoBuf
);

1295 
	`ASSERT2
(0,"Can't‡lloc memory !\n");

1297 
	}
}

1299 
	gCNuRaidMgn
::
	$D–Raid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1301 
Cr™™ÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1303 
	`TRACE
("IPC DelRaid method call ! \n");

1305 iàĞ
buf
 =ğ
NULL
 )

1308 
nu¿id¡©
::
nu_¿id_d–_msg
 
»que¡_d–_¿id
;

1310 iàĞ! 
»que¡_d–_¿id
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_d–_¿id.
	`IsIn™Ÿlized
() ) {

1311 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

1315 iàĞ
»que¡_d–_¿id
.
	`has_ch¿id
() ) {

1316 
	`TRACE
("d–‘¿id i % \n",
»que¡_d–_¿id
.
	`ch¿id
().
	`c_¡r
());

1318 
	`ASSERT2
(0,"Message Has No Parameters\n");

1322 
	`kl_´oc
();

1324 
út
;

1325 *
pPrÙoBuf
 = 
NULL
;

1326 
S”L’
;

1327 
boŞ
 
»¶y_¡©
 = 
çl£
;

1329 
RAIDInfo
 
šfo
;

1330 ià(
m_¿idMgr
.
	`G‘RAIDInfo
(
»que¡_d–_¿id
.
	`ch¿id
(), 
šfo
)) {

1331 
»¶y_¡©
 = 
Œue
;

1332 
m_¿idMgr
->
	`D–‘eRAID
(
li¡
[
i
].
m_¡rDevNodeName
);

1335 
	`¡¬t_´oc
();

1337 
nu¿id¡©
::
nu_g’”®_»¥Ú£_msg
 
»¥Ú£_msg
;

1339 iàĞ
»¶y_¡©
 ) {

1340 
»¥Ú£_msg
.
	`£t_”rÜ
(1);

1342 
»¥Ú£_msg
.
	`£t_”rÜ
(0);

1345 
S”L’
 = 
»¥Ú£_msg
.
	`By‹Size
();

1346 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

1348 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

1349 ià(
pPrÙoBuf
) {

1350 
»¥Ú£_msg
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

1352 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

1353 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

1354 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

1355 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

1357 
	`ä“
(
pPrÙoBuf
);

1359 
	`ASSERT2
(0,"Can't‡lloc memory !\n");

1361 
	}
}

1363 
	gCNuRaidMgn
::
	$FÜm©Raid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1365 
Cr™™ÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1366 
	`TRACE
("IPC FormatRaid method call ! \n");

1368 ifĞ
buf
 =ğ
NULL
 )

1371 
boŞ
 
»¶y_¡©
 = 
çl£
;

1372 *
pPrÙoBuf
 = 
NULL
;

1373 
S”L’
, 
út
;

1375 
nu¿id¡©
::
nu_¿id_fÜm©_msg
 
»que¡_fÜm©_¿id
;

1377 iàĞ! 
»que¡_fÜm©_¿id
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_fÜm©_¿id.
	`IsIn™Ÿlized
() ) {

1378 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

1382 iàĞ
»que¡_fÜm©_¿id
.
	`has_ch¿id
() ) {

1383 
	`TRACE
("fÜm©„aid i % \n",
»que¡_fÜm©_¿id
.
	`ch¿id
().
	`c_¡r
());

1385 
	`ASSERT2
(0,"Message Has No Parameters\n");

1389 
	`kl_´oc
();

1391 
RAIDInfo
 
šfo
;

1392 ià(
m_¿idMgr
.
	`G‘RAIDInfo
(
»que¡_fÜm©_¿id
.
	`ch¿id
(), 
šfo
)) {

1393 ià(!
m_¿idMgr
.
	`UnmouÁ
(
»que¡_fÜm©_¿id
.
	`ch¿id
())) {

1397 ià(!
m_¿idMgr
.
	`FÜm©
(
»que¡_fÜm©_¿id
.
	`ch¿id
())) {

1401 
»¶y_¡©
 = 
Œue
;

1404 
	`¡¬t_´oc
();

1406 
nu¿id¡©
::
nu_g’”®_»¥Ú£_msg
 
»¥Ú£_msg
;

1408 iàĞ
»¶y_¡©
 ) {

1409 
»¥Ú£_msg
.
	`£t_”rÜ
(1);

1410 
»¥Ú£_msg
.
	`£t_”r_msg
(
»que¡_fÜm©_¿id
.
	`ch¿id
());

1412 
»¥Ú£_msg
.
	`£t_”rÜ
(0);

1415 
S”L’
 = 
»¥Ú£_msg
.
	`By‹Size
();

1416 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

1418 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

1419 ià(
pPrÙoBuf
) {

1420 
»¥Ú£_msg
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

1422 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

1423 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

1424 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

1425 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

1427 
	`ä“
(
pPrÙoBuf
);

1430 
	`ASSERT2
(0,"Can't‡lloc memory !\n");

1432 
	}
}

1434 
	gCNuRaidMgn
::
	$ModifyRaid
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1436 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1438 
	`TRACE
("IPC ModifyRaid method call ! \n");

1440 ifĞ
buf
 =ğ
NULL
 )

1443 
boŞ
 
»¶y_¡©
 = 
çl£
;

1444 *
pPrÙoBuf
 = 
NULL
;

1445 
S”L’
, 
út
;

1446 
i
;

1448 
nu¿id¡©
::
nu_¿id_modify_msg
 
»que¡_modify_¿id
;

1450 ifĞ! 
»que¡_modify_¿id
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_modify_¿id.
	`IsIn™Ÿlized
() )

1452 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

1456 ifĞ
»que¡_modify_¿id
.
	`has_ch¿id
() )

1458 
	`TRACE
("modify„aid i % \n",
»que¡_modify_¿id
.
	`ch¿id
().
	`c_¡r
());

1462 
	`ASSERT2
(0,"Message Has No Parameters\n");

1466 
	`kl_´oc
();

1468 
RaidS‹
 *
¡
;

1469 
chcommªd
[260] = {0};

1470 
NuDiskInfo
 *
pDItmp
 = 
NULL
;

1472 
RAIDInfo
 
šfo
;

1473 ià(
m_¿idMgr
.
	`G‘RAIDInfo
(
»que¡_fÜm©_¿id
.
	`ch¿id
(), 
šfo
)) {

1474 ià(
m_¿idMgr
.
	`IsFÜm©ed
(
»que¡_fÜm©_¿id
.
	`ch¿id
())) {

1478 
veùÜ
<
¡ršg
>& 
vDevLi¡
;

1479 
boŞ
 
bR‘
 = 
çl£
;

1481 
vDevLi¡
.
	`push_back
(
»que¡_modify_¿id
.
	`chdev
());

1483  
»que¡_modify_¿id
.
	`imodifyty³
()) {

1486 
bR‘
 = 
m_¿idMgr
.
	`M¬kFauÉyMDDisks
(
»que¡_fÜm©_¿id
.
	`ch¿id
(),

1487 
vDevLi¡
);

1491 
bR‘
 = 
m_¿idMgr
.
	`RemoveMDDisks
(
»que¡_fÜm©_¿id
.
	`ch¿id
(),

1492 
vDevLi¡
);

1497 
bR‘
 = 
m_¿idMgr
.
	`AddMDDisks
(
»que¡_fÜm©_¿id
.
	`ch¿id
(),

1498 
vDevLi¡
);

1502 ià(
bR‘
) {

1503 
»¶y_¡©
 = 
Œue
;

1507 
	`¡¬t_´oc
();

1509 
nu¿id¡©
::
nu_g’”®_»¥Ú£_msg
 
»¥Ú£_msg
;

1511 iàĞ
»¶y_¡©
 ) {

1512 
»¥Ú£_msg
.
	`£t_”rÜ
(1);

1513 
»¥Ú£_msg
.
	`£t_”r_msg
(
»que¡_modify_¿id
.
	`ch¿id
());

1515 
»¥Ú£_msg
.
	`£t_”rÜ
(0);

1518 
S”L’
 = 
»¥Ú£_msg
.
	`By‹Size
();

1519 
	`´štf
(" s”Ÿlized sizi %d \n",
S”L’
);

1521 
pPrÙoBuf
 = 
	`m®loc
(
S”L’
);

1522 ià(
pPrÙoBuf
) {

1523 
»¥Ú£_msg
.
	`S”ŸlizeToA¼ay
(
pPrÙoBuf
,
S”L’
);

1525 
	`£t_´Ùo_un™_mes§ge_size
(
´Ùo_un™_buf
,
S”L’
);

1526 
	`£t_´Ùo_un™_mes§ge
(
´Ùo_un™_buf
,
pPrÙoBuf
);

1527 
út
 = 
	`»¶y_»que¡
(
pIPChªdË
, 5000, 1, 
´Ùo_un™_buf
);

1528 
	`´štf
("»¶y %d„eque¡(s)...\n", 
út
);

1530 
	`ä“
(
pPrÙoBuf
);

1532 
	`ASSERT2
(0,"Can't‡lloc memory !\n");

1534 
	}
}

1536 
	gCNuRaidMgn
::
	$AddDisk
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
, 
IsiSCSI
)

1538 
	`TRACE
("IPC AddDisk signal call ! \n");

1540 ifĞ
buf
 =ğ
NULL
 )

1543 *
pPrÙoBuf
 = 
NULL
;

1544 
S”L’
, 
út
;

1546 
nu¿id¡©
::
nu_add_»move_disk_msg
 
»que¡_add_disk
;

1548 ifĞ! 
»que¡_add_disk
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_add_disk.
	`IsIn™Ÿlized
() )

1550 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

1554 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1555 
m_¿idMgr
.
	`AddDisk
(
»que¡_add_disk
.
	`chdev
(), 
IsiSCSI
 ? 
DISK_TYPE_ISCSI
 : 
DISK_TYPE_LOCAL
);

1557 
	}
}

1559 
	gCNuRaidMgn
::
	$RemoveDisk
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
, 
IsiSCSI
)

1561 
	`TRACE
("IPC RemoveDisk signal call ! \n");

1563 ifĞ
buf
 =ğ
NULL
 )

1566 *
pPrÙoBuf
 = 
NULL
;

1567 
S”L’
, 
út
;

1569 
nu¿id¡©
::
nu_add_»move_disk_msg
 
»que¡_»move_disk
;

1571 ifĞ! 
»que¡_»move_disk
.
	`P¬£FromA¼ay
(
buf
,
Ën
è|| !„eque¡_»move_disk.
	`IsIn™Ÿlized
() )

1573 
	`ASSERT2
(0,"protocol bufferƒrror!\n");

1577 
	`TRACE
("RemovDisk‚amğ% \n",
»que¡_»move_disk
.
	`chdev
().
	`c_¡r
());

1579 
Cr™iÿlSeùiÚLock
 
	`lock
(
m_pcsSt
);

1580 
m_¿idMgr
.
	`RemoveDisk
(
»que¡_»move_disk
.
	`chdev
());

1581 
	}
}

1583 
	gCNuRaidMgn
::
	$HªdËIOE¼Ü1
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1585 
	`TRACE
("IPC KernelIOError1 signal call ! \n");

1586 ifĞ
buf
 =ğ
NULL
 )

1589 
	`TRACE
("K”ÃlIOE¼Ü1 = % \n",
buf
);

1590 *
pch1
 = 
NULL
, *
pch2
 = NULL;

1591 ifĞ
buf
 )

1592 
pch1
 = 
	`¡¹ok
((*)
buf
,",");

1593 ifĞ
pch1
 )

1596 
pch1
 = 
	`¡¹ok
(
NULL
,",");

1597 ifĞ
pch1
 )

1600 
pch2
 = 
	`¡¹ok
(
NULL
,",");

1601 ifĞ
pch2
 )

1603 *
pdev
 = 
	`¡r¡r
(
pch1
,"sd");

1604 
chLog
[260];

1605 ifĞ
pdev
 =ğ
NULL
 )

1607 
pdev
 = 
	`¡r¡r
(
pch1
,"md");

1608 ifĞ
pdev
 )

1611 
	`¥rštf
(
chLog
,"E¼Ü occur Ú VOLUME%d (I/Oƒ¼Ü, %s)",
	`©oi
(
pdev
 + 2è+ 1,
pch2
);

1612 
	`MYLOG
("k”Ãl",0,
LOG_LOCAL0
,
LOG_ERR
,
chLog
);

1613 
	`Wr™eDiskE¼Ü
(0,
	`©oi
(
pdev
 + 2è+ 1,
chLog
);

1618 *
phd
 = 
	`G‘NuS©aName
(
pdev
);

1620 ifĞ
phd
 )

1623 
	`¥rštf
(
chLog
,"E¼Ü occur Ú % (I/Oƒ¼Ü, %s)",
	`HumªDisk
(
phd
),
pch2
);

1624 
	`MYLOG
("k”Ãl",0,
LOG_LOCAL0
,
LOG_ERR
,
chLog
);

1625 
	`Wr™eDiskE¼Ü
(1,
	`©oi
(
phd
 + 14è+ 1,
chLog
);

1631 
	}
}

1633 
	gCNuRaidMgn
::
	$HªdËIOE¼Ü2
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1635 
	`TRACE
("IPC KernelIOError2 signal call ! \n");

1636 ifĞ
buf
 =ğ
NULL
 )

1639 
	`TRACE
("K”ÃlIOE¼Ü2 = % \n",
buf
);

1640 *
pch1
, *
pch2
;

1642 
pch1
 = 
	`¡¹ok
((*)
buf
,",");

1643 ifĞ
pch1
 )

1646 
pch2
 = 
	`¡¹ok
(
NULL
,",");

1647 ifĞ
pch2
 )

1650 *
pdev
 = 
	`¡r¡r
(
pch1
,"sd");

1651 
chLog
[260];

1652 ifĞ
pdev
 =ğ
NULL
 )

1654 
pdev
 = 
	`¡r¡r
(
pch1
,"md");

1655 ifĞ
pdev
 )

1658 
	`¥rštf
(
chLog
,"E¼Ü occur Ú VOLUME%d (bufã¸I/Oƒ¼Ü, %s)",
	`©oi
(
pdev
 + 2è+ 1,
pch2
);

1659 
	`MYLOG
("k”Ãl",0,
LOG_LOCAL0
,
LOG_ERR
,
chLog
);

1660 
	`Wr™eDiskE¼Ü
(0,
	`©oi
(
pdev
 + 2è+ 1,
chLog
);

1665 *
phd
 = 
	`G‘NuS©aName
(
pdev
);

1666 ifĞ
phd
 )

1669 
	`¥rštf
(
chLog
,"E¼Ü occur Ú % (bufã¸I/Oƒ¼Ü, %s)",
	`HumªDisk
(
phd
),
pch2
);

1670 
	`MYLOG
("k”Ãl",0,
LOG_LOCAL0
,
LOG_ERR
,
chLog
);

1671 
	`Wr™eDiskE¼Ü
(1,
	`©oi
(
phd
 + 14è+ 1,
chLog
);

1676 
	}
}

1678 
	gCNuRaidMgn
::
	$HªdËEXT3_fsE¼Ü
(*
pIPChªdË
, cÚ¡ *
buf
, 
Ën
, 
´Ùo_un™
 *
´Ùo_un™_buf
)

1680 
	`TRACE
("IPC KernelEXT3_fsError signal call ! \n");

1681 ifĞ
buf
 =ğ
NULL
 )

1684 
	`TRACE
("K”ÃlEXT3_fsE¼Ü = % \n",
buf
);

1685 *
pch1
 = 
NULL
, *
pch2
;

1686 
i
;

1687 
chLog
[260];

1688 
loÿl_buf
[1024];

1691 
	`¡ºıy
(
loÿl_buf
, (cÚ¡ *)
buf
, 1024);

1692 
pch1
 = 
	`¡r¡r
(
loÿl_buf
,"device");

1693 ifĞ
pch1
 )

1695 
pch1
 += 6;

1696 *
pch1
 == ' ')

1698 
pch1
++;

1700 
pch2
 = 
pch1
;

1701 *
pch2
 != ')')

1703 
pch2
++;

1704 if(*
pch2
 == '\0')

1707 *
pch2
 = '\0';

1708 
pch2
 = 
	`¡r¡r
(
pch1
,"md");

1709 ifĞ
pch2
 )

1711 ifĞ
m_pcsSt
 )

1712 
m_pcsSt
->
	`Lock
();

1713 
RaidS‹
 *
¡
;

1714 
¡
=
m_¡©–i¡
; st; st=¡->
Ãxt
)

1716 ifĞ
	`¡rcmp
(
¡
->
devÇme
 + 5,
pch2
) == 0 )

1718 
¡
->
iK”ÃlE¼Ü
 = 1;

1719 
	`¥rštf
(
chLog
,"Fsy¡emƒ¼Ü occur Ú VOLUME%d\n",
	`©oi
(
pch2
+2)+1);

1720 
	`TRACE
("%s\n",
chLog
);

1721 
	`Wr™eDiskE¼Ü
(0,
	`©oi
(
pch2
+2)+1,
chLog
);

1725 ifĞ
m_pcsSt
 )

1726 
m_pcsSt
->
	`UÆock
();

1728 ifĞ(
pch2
 = 
	`¡r¡r
(
pch1
,"sd")è!ğ
NULL
 )

1730 *
phd
 = 
	`G‘NuS©aName
(
pch2
);

1731 ifĞ
phd
 )

1733 
	`¥rštf
(
chLog
,"% fsy¡emƒ¼Ü",
	`HumªDisk
(
phd
));

1734 
	`TRACE
("%s\n",
chLog
);

1740 
	}
}

1742 
	gCNuRaidMgn
::
	$Wr™eDiskE¼Ü
(
bIsDisk
, 
šdex
, *
msg
)

1744 
	`sy¡em
("touch " 
NP_DISK_ERROR_FLAG
 );

1747 
tm
 *
timešfo
 = 
NULL
;

1748 
bufãr
[128],
bufãr1
[128];

1749 
timev®
 
tv
;

1751 
	`g‘timeofday
(&
tv
, 
NULL
);

1752 
timešfo
 = 
	`loÿÉime
(&
tv
.
tv_£c
);

1754 ifĞ! 
timešfo
 )

1760 
ä“S·û
, 
tÙ®S·û
;

1761 ià(0 =ğ
SYSUTILS_SPACE
::
	`G‘DiskS·ûStus64
("/", &
ä“S·û
, &
tÙ®S·û
))

1764 
u£dR©io
 = 
	`û
Ğ(()(
tÙ®S·û
-
ä“S·û
)*100.0)/()totalSpace );

1765 
	`TRACE
("roÙf : f»eS·û = %lu ,Ù®S·û = %lu , u£dR©iØğ%d \n",
ä“S·û
,
tÙ®S·û
,
u£dR©io
);

1767 ifĞ
u£dR©io
 > 95 )

1769 
	`MYLOG
("¿id",0,
LOG_LOCAL2
,
LOG_WARNING
,"Usage of file system capacity of„ootfs is over 95%%");

1776 ifĞ
bIsDisk
 )

1777 
	`¡ráime
(
bufãr1
,128, 
NP_DISK_ERROR
 "/DISK-%F_%H%M%S.%%03u",
timešfo
);

1779 
	`¡ráime
(
bufãr1
,128, 
NP_DISK_ERROR
 "/VOLUME-%F_%H%M%S.%%03u",
timešfo
);

1780 
	`¢´štf
(
bufãr
, (bufãr), 
bufãr1
, 
tv
.
tv_u£c
);

1783 
FILE
 *
fe1
 = 
NULL
;

1784 
fe1
 = 
	`fİ’
(
bufãr
,"w");

1785 ifĞ
fe1
 )

1787 
	`årštf
(
fe1
,"%d\n",
bIsDisk
);

1788 
	`årštf
(
fe1
,"%d\n",
šdex
);

1789 
	`årštf
(
fe1
,"%s\n",
msg
);

1790 
	`fşo£
(
fe1
);

1792 
	}
}

1794 
	gCNuRaidMgn
::
	$kl_´oc
()

1796 
CNFSS”v”Mªag”
 
	`nfsS”v”Mgr
(
çl£
);

1798 ià(
nfsS”v”Mgr
.
	`IsNFSS”viûEÇbË
()) {

1799 
nfsS”v”Mgr
.
	`UÃxpÜtAÎVŞumesInLi¡
();

1801 
	`sy¡em
("/etc/init.d/nagent stop");

1803 
	}
}

1805 
	gCNuRaidMgn
::
	$¡¬t_´oc
()

1807 ifĞ! 
m_bFÜm©tšg
 )

1809 
CNFSS”v”Mªag”
 
	`nfsS”v”Mgr
(
çl£
);

1811 ià(
nfsS”v”Mgr
.
	`IsNFSS”viûEÇbË
()) {

1813 
CNFSS”viûMªagem’t
::
	`Re¡¬tNFSS”viû
();

1816 
	`sy¡em
("/etc/init.d/nagent„estart");

1819 
	}
}

	@../../../system/VolumeMgnService/ipc_command.h

1 #iâdef 
__IPC_COMMAND__


2 
	#__IPC_COMMAND__


	)

5 
	#UDS_SERVICE_NAME
 "/tmp/NuHWMgn_£rviû"

	)

7 
	eNU_HW_MGN_CMD
{

8 
	mNUHW_GET_DISK_INFO
 = 1,

9 
	mNUHW_GET_FREE_DISK_INFO
,

10 
	mNUHW_GET_RAID_INFO
,

11 
	mNUHW_ADD_RAID
,

12 
	mNUHW_DEL_RAID
,

13 
	mNUHW_MODIFY_RAID
,

14 
	mNUHW_FORMAT_RAID
,

15 
	mNUHW_ADD_DISK
,

16 
	mNUHW_REMOVE_DISK
,

17 
	mNUHW_ADD_ISCSI
,

18 
	mNUHW_REMOVE_ISCSI
,

19 
	mK”ÃlIOE¼Ü1
,

20 
	mK”ÃlIOE¼Ü2
,

21 
	mK”ÃlEXT3_fsE¼Ü


	@../../../system/VolumeMgnService/main.cpp

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<”ºo.h
>

5 
	~<¡ršg.h
>

6 
	~<uni¡d.h
>

8 
	~<sigÇl.h
>

9 
	~<sy¦og.h
>

10 
	~<wa™.h
>

11 
	~<execšfo.h
>

13 
	~"debugMsg/Debug.h
"

14 
	~"commÚ/nusy¦og.h
"

16 
	~"NuHWMgn.h
"

18 
	~"ş›Á.h
"

19 
	~"´Ùo_d©a.h
"

20 
	~"nu¿id.pb.h
"

22 
	#LOG_LABEL
 "VŞumeMgnS”viû"

	)

24 
CNuHWMgn
 *
	gg_²uHWmgn
 = 
NULL
;

25 
	gg_bIsMaš
 = 0;

26 
pid_t
 
	gg_ch_pid
 = -1;

28 
	#IPC_SEND_TIMEOUT
 30

29 

	)

30 
	$g‘_backŒaû_¡ršg
(**
s
)

32 *
bt_bufãr
[128];

33 **
symbŞ_Çmes
;

34 
bt_d•th
;

36 *
»suÉ_buf
 = 
NULL
;

37 
»suÉ_size
;

38 
tÙ®_Ëngth
;

40 
tmp_buf
[16], *
tmp_±r
 = 
NULL
;

41 
i
, 
Ën
;

43 ià(
NULL
 =ğ
s
)

46 
bt_d•th
 = 
	`backŒaû
(
bt_bufãr
, (bt_buffer));

47 
symbŞ_Çmes
 = 
	`backŒaû_symbŞs
(
bt_bufãr
, 
bt_d•th
);

49 
»suÉ_size
 = (
symbŞ_Çmes
!=
NULL
 && 
bt_d•th
>0) ? bt_depth*128 : 0;

50 ià(
»suÉ_size
>0)

51 
»suÉ_buf
 = (*è
	`m®loc
(
»suÉ_size
);

53 ià(
NULL
 =ğ
»suÉ_buf
)

56 
tÙ®_Ëngth
 = 0;

57 
»suÉ_buf
[0] = '\0';

58 
i
=1; i<
bt_d•th
; ++i)

60 ià(
symbŞ_Çmes
[
i
]!=
NULL
)

62 
Ën
 = 
	`¡¾’
(
symbŞ_Çmes
[
i
]);

63 
tmp_±r
 = 
symbŞ_Çmes
[
i
];

67 
	`¥rštf
(
tmp_buf
, "[0x%p]", 
bt_bufãr
[
i
]);

68 
Ën
 = 
	`¡¾’
(
tmp_buf
);

69 
tmp_±r
 = 
tmp_buf
;

72 ià((
tÙ®_Ëngth
+
Ën
è>ğ
»suÉ_size
)

76 ià(
tÙ®_Ëngth
>0)

78 
»suÉ_buf
[ 
tÙ®_Ëngth
++ ] = ',';

79 
»suÉ_buf
[ 
tÙ®_Ëngth
 ] = '\0';

81 
	`¡rÿt
(
»suÉ_buf
 + 
tÙ®_Ëngth
, 
tmp_±r
);

82 
tÙ®_Ëngth
 +ğ
Ën
;

85 *
s
 = 
»suÉ_buf
;

86  
bt_d•th
-1;

87 
	}
}

89 
	$sig‹rm_hªdËr
(
sig
)

91 
	`TRACE
("SIGPIPE sig=%d , I maš = %d\n", 
sig
, 
g_bIsMaš
);

93 *
r
 = 
NULL
;

94 
bt_d•th
 = 
	`g‘_backŒaû_¡ršg
(&
r
);

95 *
cmd_buf
 = 
NULL
;

96 
»t
;

98 ià(
bt_d•th
>=0 && 
r
!=
NULL
)

99 
»t
 = 
	`a¥rštf
(&
cmd_buf
, "logg” -°d«mÚ.nÙiû -ˆNuHWMgÀ\"bad sigÇÈoccu¼ed: %d, bt: %s\"", 
sig
, 
r
);

101 
»t
 = 
	`a¥rštf
(&
cmd_buf
, "logg” -°d«mÚ.nÙiû -ˆNuHWMgÀ\"bad sigÇÈoccu¼ed: %d\"", 
sig
);

103 ià(
»t
>0 && 
cmd_buf
!=
NULL
)

104 
	`sy¡em
(
cmd_buf
);

106 ià(
cmd_buf
!=
NULL
)

108 
	`ä“
(
cmd_buf
);

109 
cmd_buf
 = 
NULL
;

111 ià(
r
!=
NULL
)

113 
	`ä“
(
r
);

114 
r
 = 
NULL
;

117 ifĞ
g_bIsMaš
 )

119 
	`kl
(
g_ch_pid
, 2);

120 
	`´štf
("kÈ2 chd…id = %d \n",
g_ch_pid
);

121 
	`kl
(
g_ch_pid
, 9);

122 
	`´štf
("kÈ9 chd…id = %d \n",
g_ch_pid
);

123 
	`ex™
(0);

127 ifĞ
g_²uHWmgn
 )

129 
g_²uHWmgn
->
	`Qu™Loİ
();

130 
g_²uHWmgn
 = 
NULL
;

134 
	}
}

136 
	$pe_´og
(
sig
)

138 
	`TRACE
("SIGPIPE sig=%d\n", 
sig
);

139 
	}
}

141 
	$NuS’dIPCMsg
(
ušt32_t
 
c_cmd
, *
msg_buf
 , 
msg_size
 )

143 
»l
 = -1;

144 *
şi
 = 
NULL
;

145 
´Ùo_un™
 *
u
 = 
NULL
;

147 
şi
 = 
	`ü—‹_ş›Á_š¡ªû
();

148 ià(
NULL
 =ğ
şi
)

150 
	`´štf
("create_client_instance failed.\n");

151 
£nd_msg_ex™
;

154 ià(0 !ğ
	`£t_uds_cÚn_´İ”ty
(
şi
, 
UDS_SERVICE_NAME
))

156 
	`´štf
("set_uds_conn_property failed.\n");

157 
£nd_msg_ex™
;

160 
u
 = 
	`ü—‹_´Ùo_un™
();

161 ià(
NULL
 =ğ
u
)

163 
	`´štf
("create_proto_unit failed.\n");

164 
£nd_msg_ex™
;

167 ià(0 !ğ
	`£t_´Ùo_un™_tok’
(
u
, 
	`g‘pid
()))

169 
	`´štf
("set_proto_unit_token failed.\n");

170 
£nd_msg_ex™
;

173 ià(0 !ğ
	`£t_´Ùo_un™_cmd
(
u
, 
c_cmd
))

175 
	`´štf
("set_proto_unit_cmd failed.\n");

176 
£nd_msg_ex™
;

179 ià(0 !ğ
	`£t_´Ùo_un™_mes§ge
(
u
, 
msg_buf
))

181 
	`´štf
("set_proto_unit_message failed.\n");

182 
£nd_msg_ex™
;

185 ià(0 !ğ
	`£t_´Ùo_un™_mes§ge_size
(
u
, 
msg_size
))

187 
	`´štf
("set_proto_unit_message_size failed.\n");

188 
£nd_msg_ex™
;

192 ià(0 !ğ
	`£nd_»que¡
(
şi
, 
u
, 
IPC_SEND_TIMEOUT
 * 1000))

194 
	`´štf
("send_request failed.\n");

195 
£nd_msg_ex™
;

198 
»l
 = 0;

200 
£nd_msg_ex™
:

202 ià(
u
!=
NULL
)

204 
	`»Ëa£_´Ùo_un™
(
u
);

205 
u
 = 
NULL
;

208 ià(
şi
!=
NULL
)

210 
	`»Ëa£_ş›Á_š¡ªû
(
şi
);

211 
şi
 = 
NULL
;

215  
»l
;

216 
	}
}

218 
	$NuAddDiskCmd
(*
disk
, 
IsiSCSI
)

220 
ušt32_t
 
c_cmd
 = -1;

221 *
msg_buf
 = 
NULL
;

222 
msg_size
 = 0;

224 
c_cmd
 = 
NUHW_ADD_DISK
;

227 
nu¿id¡©
::
nu_add_»move_disk_msg
 
»que¡_add_disk
;

228 
»que¡_add_disk
.
	`£t_chdev
(
disk
);

230 
msg_size
 = 
»que¡_add_disk
.
	`By‹Size
();

231 
	`´štf
(" s”Ÿlized sizi %d \n",
msg_size
);

233 
msg_buf
 = (*)
	`m®loc
(
msg_size
);

234 if(
msg_buf
)

236 
»que¡_add_disk
.
	`S”ŸlizeToA¼ay
(
msg_buf
,
msg_size
);

239 
	`NuS’dIPCMsg
(
c_cmd
,
msg_buf
,
msg_size
);

241 
	`ä“
(
msg_buf
);

244 
	}
}

246 
	$NuRemoveDiskCmd
(*
disk
, 
IsiSCSI
)

248 
ušt32_t
 
c_cmd
 = -1;

249 *
msg_buf
 = 
NULL
;

250 
msg_size
 = 0;

251 
c_cmd
 = 
NUHW_REMOVE_DISK
;

254 
nu¿id¡©
::
nu_add_»move_disk_msg
 
»que¡_add_disk
;

255 
»que¡_add_disk
.
	`£t_chdev
(
disk
);

257 
msg_size
 = 
»que¡_add_disk
.
	`By‹Size
();

258 
	`´štf
(" s”Ÿlized sizi %d \n",
msg_size
);

260 
msg_buf
 = (*)
	`m®loc
(
msg_size
);

261 if(
msg_buf
)

263 
»que¡_add_disk
.
	`S”ŸlizeToA¼ay
(
msg_buf
,
msg_size
);

266 
	`NuS’dIPCMsg
(
c_cmd
,
msg_buf
,
msg_size
);

268 
	`ä“
(
msg_buf
);

271 
	}
}

274 
	$maš
(
¬gc
, *
¬gv
[])

277 
c
,
i
;

278 
bIsd«mÚ
 = 0;

279 
v®ue
[32];

280 
bIsAddRemoveCmd
 = 0;

281 
bI¢ÚfÜk
 = 0;

282 
bIsiSCSI
 = 0;

283 
FILE
 *
å
 = 
	`fİ’
("/tmp/NuHwMgn.log", "w+");

285 
İ‹¼
 = 0;

286 (
c
 = 
	`g‘İt
 (
¬gc
, 
¬gv
, "a:r:dni")) != -1)

288 
c
)

291 
bIsd«mÚ
 = 1;

294 
bIsAddRemoveCmd
 = 1;

295 
	`årštf
(
å
, "İrg†’ %d", 
	`¡¾’
(
İrg
));

296 
	`¡ºıy
(
v®ue
, 
İrg
, 32);

299 
bIsAddRemoveCmd
 = 2;

300 
	`årštf
(
å
, "İrg†’ %d", 
	`¡¾’
(
İrg
));

301 
	`¡ºıy
(
v®ue
, 
İrg
, 32);

304 
bI¢ÚfÜk
 = 1;

307 
bIsiSCSI
 = 1;

310 ià(
İtİt
 == 'a')

311 
	`årštf
 (
¡d”r
, "O±iÚ -%ø»quœe ª‡rgum’t.\n", 
İtİt
);

312 ià(
	`i¥ršt
 (
İtİt
))

313 
	`årštf
 (
¡d”r
, "UnknowÀİtiÚ `-%c'.\n", 
İtİt
);

315 
	`årštf
 (
¡d”r
, "UnknowÀİtiÚ ch¬aù” `\\x%x'.\n", 
İtİt
);

318 
	`abÜt
();

324 
i
 = 
İtšd
; i < 
¬gc
; i++)

325 
	`´štf
 ("NÚ-İtiÚ‡rgum’ˆ%s\n", 
¬gv
[
i
]);

327 ifĞ
İtšd
 < 
¬gc
 )

333 ifĞ
bIsAddRemoveCmd
 )

335 ifĞ
bIsAddRemoveCmd
 == 1 )

337 
	`NuAddDiskCmd
(
v®ue
,
bIsiSCSI
);

339 ifĞ
bIsAddRemoveCmd
 == 2 )

341 
	`NuRemoveDiskCmd
(
v®ue
,
bIsiSCSI
);

349 ifĞ
bIsd«mÚ
 )

352 ifĞ
	`d«mÚ
(0,0) == -1 )

354 
	`årštf
(
¡d”r
," : can't daemon\n" );

355 
	`ex™
(
EXIT_FAILURE
);

365 
	`sigÇl
(
SIGTERM
, 
sig‹rm_hªdËr
);

366 
	`sigÇl
(
SIGQUIT
, 
sig‹rm_hªdËr
);

367 
	`sigÇl
(
SIGINT
, 
sig‹rm_hªdËr
);

369 
	`sigÇl
(
SIGILL
, 
sig‹rm_hªdËr
);

370 
	`sigÇl
(
SIGSEGV
, 
sig‹rm_hªdËr
);

371 
	`sigÇl
(
SIGABRT
, 
sig‹rm_hªdËr
);

372 
	`sigÇl
(
SIGFPE
, 
sig‹rm_hªdËr
);

373 
	`sigÇl
(
SIGBUS
, 
sig‹rm_hªdËr
);

375 
	`sigÇl
(
SIGPIPE
, 
pe_´og
);

377 ifĞ
bI¢ÚfÜk
 )

379 
CNuHWMgn
 *
²uHWmgn
 = 
NULL
;

382 
²uHWmgn
 = 
Ãw
 
	`CNuHWMgn
();

384 ifĞ
²uHWmgn
 )

386 
g_²uHWmgn
 = 
²uHWmgn
;

387 
²uHWmgn
->
	`RunLoİ
();

390 
d–‘e
 
²uHWmgn
;

392 
²uHWmgn
 = 
NULL
;

393 
g_²uHWmgn
 = 
NULL
;

400 
pid_t
 
´oc_pid
 = -1;

402 
´oc_pid
 = 
	`g‘pid
();

405 
RETRY_AGAIN
:

407 
g_bIsMaš
 = 0;

408 
g_ch_pid
 = 
	`fÜk
();

410 
g_ch_pid
)

413 
	`TRACE
("fork failure!\n");

417 ifĞ
bIsd«mÚ
 )

418 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

421 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

424 ifĞ
g_²uHWmgn
 )

426 
g_²uHWmgn
->
	`Qu™Loİ
();

427 
g_²uHWmgn
 = 
NULL
;

429 
CNuHWMgn
 *
²uHWmgn
 = 
NULL
;

430 
²uHWmgn
 = 
Ãw
 
	`CNuHWMgn
();

432 ifĞ
²uHWmgn
 )

434 
g_²uHWmgn
 = 
²uHWmgn
;

435 
²uHWmgn
->
	`RunLoİ
();

436 
d–‘e
 
²uHWmgn
;

437 
²uHWmgn
 = 
NULL
;

438 
g_²uHWmgn
 = 
NULL
;

444 
	`TRACE
("my chd…id i %d\n",
g_ch_pid
);

445 
g_bIsMaš
 = 1;

448 
¡©us
 = 0;

450 
»l
 = 
	`wa™pid
(
g_ch_pid
,&
¡©us
,
WUNTRACED
 | 
WCONTINUED
);

452 
	`TRACE
("„‘uº stu ğ%d ,…¬’ˆkÈchd wa™pid = %d\n",
¡©us
,
»l
);

453 
	`¦“p
(1);

456 
RETRY_AGAIN
;

461 
	`TRACE
("NuHWMgnƒxit ! \n");

462 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

466 
	}
}

	@../../../system/VolumeMgnService/nu_sata.h

1 #iâdef 
__NU_SATA__


2 
	#__NU_SATA__


	)

7 #ifdeà
__ılu¥lus


11 
	#expÜt
 
AAAA


	)

13 
	~"mdadm.h
"

14 
	~"md_p.h
"

15 
	~"md_u.h
"

17 #undeà
expÜt


19 #ifdeà
__ılu¥lus


28 
	~"NuDiskSt.h
"

34 
	#MaxDisks
 32

	)

38 
	#INQUIRY_RESP_INITIAL_LEN
 36

	)

39 
	#INQUIRY_CMDLEN
 6

	)

40 
	#INQUIRY_CMD
 0x12

	)

41 
	#SENSE_BUFF_LEN
 32

	)

46 
	#SG_ATA_16
 0x85

	)

47 
	#SG_ATA_16_LEN
 16

	)

49 
	#SG_ATA_LBA48
 1

	)

50 
	#SG_ATA_PROTO_NON_DATA
 ( 3 << 1)

	)

51 
	#SG_ATA_PROTO_PIO_IN
 ( 4 << 1)

	)

52 
	#SG_ATA_PROTO_PIO_OUT
 ( 5 << 1)

	)

53 
	#SG_ATA_PROTO_DMA
 ( 6 << 1)

	)

54 
	#SG_ATA_PROTO_UDMA_IN
 (11 << 1)

	)

55 
	#SG_ATA_PROTO_UDMA_OUT
 (12 << 1)

	)

57 
	#ATA_USING_LBA
 (1 << 6)

	)

63 
ATA_OP_CHECKPOWERMODE1
 = 0xe5,

64 
ATA_OP_CHECKPOWERMODE2
 = 0x98,

65 
ATA_OP_DOORLOCK
 = 0xde,

66 
ATA_OP_DOORUNLOCK
 = 0xdf,

67 
ATA_OP_FLUSHCACHE
 = 0xe7,

68 
ATA_OP_FLUSHCACHE_EXT
 = 0xea,

69 
ATA_OP_IDENTIFY
 = 0xec,

70 
ATA_OP_PIDENTIFY
 = 0xa1,

71 
ATA_OP_SECURITY_DISABLE
 = 0xf6,

72 
ATA_OP_SECURITY_ERASE_PREPARE
 = 0xf3,

73 
ATA_OP_SECURITY_ERASE_UNIT
 = 0xf4,

74 
ATA_OP_SECURITY_FREEZE_LOCK
 = 0xf5,

75 
ATA_OP_SECURITY_SET_PASS
 = 0xf1,

76 
ATA_OP_SECURITY_UNLOCK
 = 0xf2,

77 
ATA_OP_SETFEATURES
 = 0xef,

78 
ATA_OP_SETIDLE1
 = 0xe3,

79 
ATA_OP_SETIDLE2
 = 0x97,

80 
ATA_OP_SLEEPNOW1
 = 0xe5,

81 
ATA_OP_SLEEPNOW2
 = 0x99,

82 
ATA_OP_SMART
 = 0xb0,

83 
ATA_OP_STANDBYNOW1
 = 0xe0,

84 
ATA_OP_STANDBYNOW2
 = 0x94,

88 
	mSG_CDB2_TLEN_NODATA
 = 0 << 0,

89 
	mSG_CDB2_TLEN_FEAT
 = 1 << 0,

90 
	mSG_CDB2_TLEN_NSECT
 = 2 << 0,

92 
	mSG_CDB2_TLEN_BYTES
 = 0 << 2,

93 
	mSG_CDB2_TLEN_SECTORS
 = 1 << 2,

95 
	mSG_CDB2_TDIR_TO_DEV
 = 0 << 3,

96 
	mSG_CDB2_TDIR_FROM_DEV
 = 1 << 3,

98 
	mSG_CDB2_CHECK_COND
 = 1 << 5,

102 
	smdp_su³rblock_1
 {

104 
__u32
 
	mmagic
;

105 
__u32
 
	mmajÜ_v”siÚ
;

106 
__u32
 
	mã©u»_m­
;

107 
__u32
 
	m·d0
;

109 
__u8
 
	m£t_uuid
[16];

110 
	m£t_Çme
[32];

112 
__u64
 
	mùime
;

113 
__u32
 
	mËv–
;

114 
__u32
 
	mÏyout
;

115 
__u64
 
	msize
;

117 
__u32
 
	mchunksize
;

118 
__u32
 
	m¿id_disks
;

119 
__u32
 
	mb™m­_off£t
;

125 
__u32
 
	mÃw_Ëv–
;

126 
__u64
 
	m»sh­e_pos™iÚ
;

127 
__u32
 
	md–_disks
;

128 
__u32
 
	mÃw_Ïyout
;

129 
__u32
 
	mÃw_chunk
;

130 
__u8
 
	m·d1
[128-124];

133 
__u64
 
	md©a_off£t
;

134 
__u64
 
	md©a_size
;

135 
__u64
 
	msu³r_off£t
;

136 
__u64
 
	m»cov”y_off£t
;

137 
__u32
 
	mdev_numb”
;

138 
__u32
 
	mút_cÜ»ùed_»ad
;

139 
__u8
 
	mdeviû_uuid
[16];

140 
__u8
 
	mdevæags
;

141 
	#Wr™eMo¡ly1
 1

	)

142 
__u8
 
	m·d2
[64-57];

145 
__u64
 
	mutime
;

146 
__u64
 
	mev’ts
;

147 
__u64
 
	m»sync_off£t
;

148 
__u32
 
	msb_csum
;

149 
__u32
 
	mmax_dev
;

150 
__u8
 
	m·d3
[64-32];

158 
__u16
 
	mdev_rŞes
[0];

165 
	sRaidS‹
 {

166 *
	mdevÇme
;

167 
	mdevnum
;

168 
	m”r
;

170 
	m¿id_size
;

171 
	mu£d_size
;

172 
mdu_¬¿y_šfo_t
 
	m¬¿y
;

175 
	mex³ùed_¥¬es
;

176 
	mdev¡©e
[
MaxDisks
];

177 
	mdevid
[
MaxDisks
];

178 
	m³rûÁ
;

180 *
	mpFÜm©Th»ad
;

181 
	mchMouÁP©h
[
NU_MOUNT_PATH_LEN
];

182 
	mucFÜm©St
;

183 
	mucRecoveSt_š‹g”
;

184 
	mucRecoveSt_decim®
;

186 
	mbFÜm©Cªûl
;

187 
	mbIsMouÁ
;

188 
	mbIsfsck
;

189 
	miE¼Ü
;

191 
	miK”ÃlE¼Ü
;

192 
	mu£dR©io
;

194 
	m£t_uuid
[16];

196 
RaidS‹
 *
	mÃxt
;

236 
	sNuDiskInfo


238 
	mchdev
[
NU_DEV_PATH_LEN
];

239 
	mchsymLšk
[
NU_DEV_PATH_LEN
];

242 
	mv’dÜ
[12];

243 
	mMod–
[20];

244 
	mFwRev
[8];

245 
	m£rŸÊo
[20];

247 
	miS©aPÜt
;

248 
	miLšk
;

249 
	miS³ed
;

250 
	ms¡©us
;

251 
	mscÚŒŞ
;

253 
	miIsA‰ach
;

254 
	miTÙ®FÏshTime
;

255 
	miFÏshSË•Time
;

257 
	miRaidStus
;

258 
	mbRaidSu³rBlock
;

261 
	mdsize
;

264 
	miE¼Ü
;

266 
	m»s_commªd
;

267 
	mcmd_commªd
;

268 
	m»s_ã©u»
;

271 
mdp_su³rblock_1
 
	msu³r
;

	@../../../system/VolumeMgnService/nudaemon.c

2 
	~<¡dio.h
>

3 
	~<”ºo.h
>

7 
	$maš
(
¬gc
, ** 
¬gv
)

9 ifĞ
¬gc
 < 2 )

11 
	`årštf
(
¡d”r
,"Please input !!! \n");

15 ifĞ
	`d«mÚ
(0,0) == -1 )

17 
	`årštf
(
¡d”r
," : can't daemon\n" );

24 
	`sy¡em
(
¬gv
[1]);

27 
	}
}

	@../../../system/VolumeMgnService/nuhwmon.c

2 
	~<¡dio.h
>

3 
	~<”ºo.h
>

4 
	~<¡dlib.h
>

5 
	~<uni¡d.h
>

6 
	~<sigÇl.h
>

7 
	~<wa™.h
>

11 
	gg_maš
 = 0;

12 
pid_t
 
	gch_pid
 = -1;

14 
	$sig‹rm_hªdËr
(
sig
)

16 
	`´štf
("SIGPIPE sig=%d , g_maš = %d\n", 
sig
,
g_maš
);

17 ifĞ
g_maš
 == 1 )

19 
	`kl
(
ch_pid
, 9);

20 
	`´štf
("kÈ9 chd…id = %d \n",
ch_pid
);

22 
	`ex™
(0);

23 
	}
}

26 
	$maš
(
¬gc
, ** 
¬gv
)

28 
c
,
i
;

29 
bIsd«mÚ
 = 0;

32 
	`sigÇl
(
SIGTERM
, 
sig‹rm_hªdËr
);

33 
	`sigÇl
(
SIGQUIT
, 
sig‹rm_hªdËr
);

34 
	`sigÇl
(
SIGINT
, 
sig‹rm_hªdËr
);

35 
	`sigÇl
(
SIGPIPE
, 
sig‹rm_hªdËr
);

38 
İ‹¼
 = 0;

39 (
c
 = 
	`g‘İt
 (
¬gc
, 
¬gv
, "d")) != -1)

41 
c
)

44 
bIsd«mÚ
 = 1;

47 
	`årštf
 (
¡d”r
, "UnknowÀİtiÚ ch¬aù” `\\x%x'.\n", 
İtİt
);

50 
	`abÜt
();

56 
i
 = 
İtšd
; i < 
¬gc
; i++)

57 
	`´štf
 ("NÚ-İtiÚ‡rgum’ˆ%s\n", 
¬gv
[
i
]);

59 ifĞ
İtšd
 < 
¬gc
 )

66 ifĞ
bIsd«mÚ
 )

69 ifĞ
	`d«mÚ
(0,0) == -1 )

71 
	`årštf
(
¡d”r
," : can't daemon\n" );

72 
	`ex™
(
EXIT_FAILURE
);

84 
¦“p_£c
, 
¦“p_miüo
, 
¦“p_Çno
;

85 
ch
;

86 
pid_t
 
´oc_pid
;

88 
mÚ_log
[40];

89 *
´_Çme
 = 
NULL
, **
cmd¬gs
 = NULL;

91 *
pidfe
 = 
NULL
;

95 
´oc_pid
 = 
	`g‘pid
();

96 
	`´štf
("PID…roc_pid %d\n", (è
´oc_pid
);

98 
iCuÚt
 = 0;

103 
GGG
:

104 
g_maš
 = 0;

105 
ch_pid
 = 
	`fÜk
();

107 
ch_pid
)

110 
	`´štf
("failure!\n");

113 
	`´štf
("I‡m child!\n");

118 
	`´štf
("child sleep !!!\n");

124 
	`¦“p
(1);

128 
	`´štf
("my chd i %d\n",
ch_pid
);

129 
g_maš
 = 1;

134 
¡©us
 = 0;

135 
	`´štf
("·»Á kÈchd wa™pid = %d\n",
	`wa™pid
(
ch_pid
,&
¡©us
,
WUNTRACED
 | 
WCONTINUED
));

137 
	`´štf
("„‘uº stu ğ%d \n",
¡©us
);

138 
	`¦“p
(1);

141 
iCuÚt
++;

142 ifĞ
iCuÚt
 < 3 )

143 
GGG
;

154 
	}
}

	@FilesystemManager.cpp

1 
	~"Fesy¡emMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/fe.h
"

5 
	~"commÚ/nusy¦og.h
"

6 
	~"commÚ/¡ršg.h
"

7 
	~"commÚ/sy¡em.h
"

9 
	~"‹¡_uts.h
"

12 
	~<®gÜ™hm
>

13 
	~<sys/mouÁ.h
>

14 
	~<sys/¡©.h
>

15 
	~<”ºo.h
>

17 
	#LOG_LABEL
 "FSMªag”"

	)

19 
	gFesy¡emMªag”
::
	$Fesy¡emMªag”
(cÚ¡ 
¡ršg
& 
dev
)

20 : 
	`m_¡rMouÁPošt
("")

21 , 
	`m_¡rDevNode
(
dev
)

22 , 
	`m_¡rUUID
("")

23 , 
	`m_¡rFSTy³
("")

24 , 
	`m_iVŞumeNum
(-1)

25 , 
	`m_iFÜm©šgS‹
(
WRITE_INODE_TABLES_UNKNOWN
)

26 , 
	`m_iFÜm©Prog»ss
(0)

27 , 
	`m_bFÜm©
(
çl£
)

28 , 
	$m_bMouÁ
(
çl£
)

30 
	`In™Ÿlize
();

31 
	}
}

33 
	gFesy¡emMªag”
::
	$Fesy¡emMªag”
()

34 : 
	`m_¡rMouÁPošt
("")

35 , 
	`m_¡rDevNode
("")

36 , 
	`m_¡rUUID
("")

37 , 
	`m_¡rFSTy³
("")

38 , 
	`m_iVŞumeNum
(-1)

39 , 
	`m_iFÜm©šgS‹
(
WRITE_INODE_TABLES_UNKNOWN
)

40 , 
	`m_iFÜm©Prog»ss
(0)

41 , 
	`m_bFÜm©
(
çl£
)

42 , 
	$m_bMouÁ
(
çl£
)

44 
	}
}

46 
	gFesy¡emMªag”
::~
	$Fesy¡emMªag”
()

49 
	}
}

51 
boŞ
 
Fesy¡emMªag”
::
	$S‘DeviûNode
(cÚ¡ 
¡ršg
 &
dev
)

53 
m_¡rDevNode
 = 
dev
;

54  
	`In™Ÿlize
();

55 
	}
}

57 
boŞ
 
	gFesy¡emMªag”
::
	$In™Ÿlize
()

59 ià(
m_¡rDevNode
.
	`em±y
()) {

60 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

62  
çl£
;

65 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

66 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

68 
m_¡rDevNode
.
	`c_¡r
());

69  
çl£
;

72 ià(
	`blkid
() != 0) {

73 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

75 
m_¡rDevNode
.
	`c_¡r
());

76  
çl£
;

79  
Œue
;

80 
	}
}

82 
	gFesy¡emMªag”
::
	$S‘MouÁPošt
(cÚ¡ 
¡ršg
 &
mouÁpošt
)

84 
m_¡rMouÁPošt
 = 
mouÁpošt
;

85 
	}
}

87 #ifdeà
NUUO


88 
	gFesy¡emMªag”
::
	$Th»adProc
()

90 ià(!
	`FÜm©
()) {

94 
	`SË•MS
(100);

96 ià(!
	`MouÁ
(
m_¡rMouÁPošt
)) {

100 
	`G’”©eUUIDFe
();

101 
	`C»©eDeçuÉFŞd”s
();

102 
	`Dump
();

103 
	}
}

106 
boŞ
 
	gFesy¡emMªag”
::
	$FÜm©
(
boŞ
 
fÜû
)

108 
»t
 = 0;

110 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csFÜm©
);

112 ià(
m_bFÜm©
 && !
fÜû
)

113 
fÜm©_dÚe
;

115 
	`In™ŸlizeMke2fsHªdË
();

116 
»t
 = 
	`mke2fs
(&
m_mkfsHªdË
);

117 ià(0 !ğ
»t
) {

118 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

119 "FaØfÜm© % [%d]\n", 
m_¡rDevNode
.
	`c_¡r
(), 
»t
);

120  
çl£
;

123 
fÜm©_dÚe
:

124 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

125 "FÜm© % sucûssfuÎy.\n", 
m_¡rDevNode
.
	`c_¡r
());

126  
Œue
;

127 
	}
}

129 
boŞ
 
	gFesy¡emMªag”
::
	$MouÁ
(cÚ¡ 
¡ršg
& 
¡rMouÁPošt
)

131 
¡ršg
 
¡rE¼ÜLog
;

133 ià(
¡rMouÁPošt
.
	`em±y
()) {

134 
¡rE¼ÜLog
 = "Invalid mount…oint.";

135 
mouÁ_check_”r
;

138 ià(
m_¡rDevNode
.
	`em±y
()) {

139 
¡rE¼ÜLog
 = "Invalid device.";

140 
mouÁ_check_”r
;

143 
m_csFÜm©
.
	`Lock
();

144 ià(!
m_bFÜm©
) {

145 
¡rE¼ÜLog
 = "The device isn't formated.";

146 
m_csFÜm©
.
	`UÆock
();

147 
mouÁ_check_”r
;

149 
m_csFÜm©
.
	`UÆock
();

151 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

152 
¡rE¼ÜLog
 = "The device is‚ot‡ block device.";

153 
mouÁ_check_”r
;

156 
m_csMouÁ
.
	`Lock
();

157 ià(
m_bMouÁ


158 && !
m_¡rMouÁPošt
.
	`em±y
()

159 && 
m_¡rMouÁPošt
 =ğ
¡rMouÁPošt


160 && 
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

161 #ifdeà
NUUO


162 && 
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

165 
mouÁ_ok
;

168 ià(
m_bMouÁ
 &&

169 !
m_¡rMouÁPošt
.
	`em±y
() &&

170 
m_¡rMouÁPošt
 !ğ
¡rMouÁPošt
) {

173 
¡rE¼ÜLog
 = "The device has‡lready be mounted. Why„equesto mount‡gain with‡ different mount…oint?";

174 
mouÁ_”r
;

177 ià(!
	`CheckDœeùÜyExi¡
(
¡rMouÁPošt
)) {

178 ià(!
	`MakeDœeùÜy
(
¡rMouÁPošt
)) {

179 
¡rE¼ÜLog
 = "Failo create mount…oint.";

180 
mouÁ_”r
;

182 } ià(
	`IsMouÁPošt
(
¡rMouÁPošt
)) {

185 
¡rE¼ÜLog
 = "The mount…oint is using by‡nother device..";

186 
mouÁ_”r
;

189 ià(
	`mouÁ
(
m_¡rDevNode
.
	`c_¡r
(), 
¡rMouÁPošt
.c_str(),

190 
m_¡rFSTy³
.
	`c_¡r
(), 0, "") < 0) {

191 
¡rE¼ÜLog
 = 
	`¡ršg_fÜm©
("Failo mount %so %s. (%s)",

192 
m_¡rDevNode
.
	`c_¡r
(),

193 
m_¡rMouÁPošt
.
	`c_¡r
(),

194 
	`¡»¼Ü
(
”ºo
));

195 
mouÁ_”r
;

198 
mouÁ_ok
:

199 
m_bMouÁ
 = 
Œue
;

200 
m_¡rMouÁPošt
 = 
¡rMouÁPošt
;

201 
m_csMouÁ
.
	`UÆock
();

202 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

204 
m_¡rDevNode
.
	`c_¡r
(),

205 
m_¡rMouÁPošt
.
	`c_¡r
());

207  
Œue
;

209 
mouÁ_”r
:

210 
m_csMouÁ
.
	`UÆock
();

211 
mouÁ_check_”r
:

212 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

213 "%s", 
¡rE¼ÜLog
.
	`c_¡r
());

214  
çl£
;

215 
	}
}

217 
boŞ
 
	gFesy¡emMªag”
::
	$UnmouÁ
()

219 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

221 ià(!
m_bMouÁ
)

222 
unmouÁ_dÚe
;

224 ià(
m_¡rMouÁPošt
.
	`em±y
())

225 
unmouÁ_dÚe
;

227 ià(!
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
))

228 
unmouÁ_dÚe
;

230 ià(!
	`IsMouÁPošt
(
m_¡rMouÁPošt
))

231 
unmouÁ_dÚe
;

233 ià(
	`umouÁ2
(
m_¡rMouÁPošt
.
	`c_¡r
(), 
UMOUNT_NOFOLLOW
 | 
MNT_DETACH
) < 0) {

234 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
, "Failo unmount %s (%s)\n",

235 
m_¡rMouÁPošt
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

236  
çl£
;

243 
unmouÁ_dÚe
:

244 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

246 
m_¡rMouÁPošt
.
	`c_¡r
());

247 
m_bMouÁ
 = 
çl£
;

248 
m_¡rMouÁPošt
 = "";

249 
m_iVŞumeNum
 = -1;

251  
Œue
;

252 
	}
}

254 
boŞ
 
	gFesy¡emMªag”
::
	$IsFÜm©ed
()

256  
m_bFÜm©
;

257 
	}
}

259 
boŞ
 
	gFesy¡emMªag”
::
	$IsFÜm©šg
(& 
´og»ss
, & 
¡©
)

261 
´og»ss
 = 
m_iFÜm©Prog»ss
;

262 
¡©
 = 
m_iFÜm©šgS‹
;

263 ià(
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_WRITING
 ||

264 
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_WRITING_DONE
 ||

265 
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_INIT
)

266  
Œue
;

268  
çl£
;

269 
	}
}

271 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁed
(
¡ršg
& 
¡rMouÁPošt
)

273 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

274 
¡rMouÁPošt
 = 
m_¡rMouÁPošt
;

275  
m_bMouÁ
;

276 
	}
}

278 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁed
(& 
num
)

280 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

281 
num
 = 
m_iVŞumeNum
;

282  
m_bMouÁ
;

283 
	}
}

285 
	gFesy¡emMªag”
::
	$S‘FÜm©Info
(
boŞ
 
fÜm©
, 
´og»ss
, 
¡©
)

287 
m_bFÜm©
 = 
fÜm©
;

288 
m_iFÜm©Prog»ss
 = 
´og»ss
;

289 
m_iFÜm©šgS‹
 = 
¡©
;

290 
	}
}

292 
	gFesy¡emMªag”
::
	$MakeFesy¡emProg»ss
(*
pD©a
, 
¡©
,

293 
cu¼’t
, 
tÙ®
)

295 ià(
pD©a
 =ğ
NULL
)

297 
Fesy¡emMªag”
 *
pFSMgr
 = (Fesy¡emMªag”*è
pD©a
;

299 
¡©
) {

300 
WRITE_INODE_TABLES_INIT
:

301 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, 0, 
¡©
);

303 
WRITE_INODE_TABLES_WRITING
:

304 
WRITE_INODE_TABLES_WRITING_DONE
:

305 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, ()(()
cu¼’t
 / ()
tÙ®
 * 100), 
¡©
);

307 
WRITE_INODE_TABLES_DONE
:

308 
pFSMgr
->
	`S‘FÜm©Info
(
Œue
, 100, 
¡©
);

310 
WRITE_INODE_TABLES_ERROR
:

311 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, 0, 
¡©
);

314 
	}
}

316 
	gFesy¡emMªag”
::
	$G’”©eUUIDFe
()

318 
Cr™iÿlSeùiÚLock
 
	`cs_mouÁ
(&
m_csMouÁ
);

320 ià(!
m_bMouÁ
 || 
m_¡rMouÁPošt
.
	`em±y
() ||

321 !
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

322 #ifdeà
NUUO


323 || !
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

328 
¡ršg
 
¡rUUIDFeName
 = 
m_¡rMouÁPošt
 + "/uuid";

329 ià(
	`CheckFeExi¡
(
¡rUUIDFeName
) &&

330 
	`G‘FeStÜageSize
(
¡rUUIDFeName
) == 32)

333 
Cr™iÿlSeùiÚLock
 
	`cs_fÜm©
(&
m_csFÜm©
);

335 ià(
m_¡rUUID
.
	`em±y
())

338 
FILE
 *
pf
 = 
	`fİ’
(
¡rUUIDFeName
.
	`c_¡r
(), "w+");

339 ià(
pf
) {

340 
	`årštf
(
pf
, "%s", 
m_¡rUUID
.
	`c_¡r
());

341 
	`fşo£
(
pf
);

343 
	}
}

345 
boŞ
 
	gFesy¡emMªag”
::
	$C»©eDeçuÉFŞd”s
()

347 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

349 ià(!
m_bMouÁ
 || 
m_¡rMouÁPošt
.
	`em±y
() ||

350 !
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

351 #ifdeà
NUUO


352 || !
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

355  
çl£
;

357 
¡ršg
 
¡rFŞd”Name
 = 
m_¡rMouÁPošt
 + "/VIDEODATA";

358 ià(!
	`CheckDœeùÜyExi¡
(
¡rFŞd”Name
)) {

359 ià(!
	`MakeDœeùÜy
(
¡rFŞd”Name
))

360  
çl£
;

363 
¡rFŞd”Name
 = 
m_¡rMouÁPošt
 + "/LOG";

364 ià(!
	`CheckDœeùÜyExi¡
(
¡rFŞd”Name
)) {

365 ià(!
	`MakeDœeùÜy
(
¡rFŞd”Name
))

366  
çl£
;

369  
Œue
;

370 
	}
}

372 
	gFesy¡emMªag”
::
	$blkid
()

374 
blkid_ÿche
 
ÿche
 = 
NULL
;

375 
»tv®
 = 0;

377 ià(
»tv®
 = 
	`blkid_g‘_ÿche
(&
ÿche
, 
NULL
) < 0) {

378 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

379 "[%d] FaØg‘ blkid cache.", 
__LINE__
);

380  
MKE2FS_FAIL_TO_GET_BLKID_CACHE
;

383 
m_csFÜm©
.
	`Lock
();

384 
blkid_dev
 
dev
 = 
	`blkid_g‘_dev
(
ÿche
, 
m_¡rDevNode
.
	`c_¡r
(), 
BLKID_DEV_NORMAL
);

385 cÚ¡ *
devÇme
 = 
	`blkid_dev_devÇme
(
dev
);

386 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

387 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

388 "[%d] % i nÙ‡ block deviû.", 
__LINE__
, 
m_¡rDevNode
.
	`c_¡r
());

389 
m_csFÜm©
.
	`UÆock
();

390  
MKE2FS_NOT_BLOCK_DEV
;

393 
blkid_g_™”©e
 
™”
;

394 cÚ¡ * 
ty³
 = 
NULL
;

395 cÚ¡ * 
v®ue
 = 
NULL
;

396 
™”
 = 
	`blkid_g_™”©e_begš
(
dev
);

397 
	`blkid_g_Ãxt
(
™”
, &
ty³
, &
v®ue
) == 0) {

398 ià(!
	`¡rcmp
(
ty³
, "UUID")) {

399 
m_¡rUUID
 = 
v®ue
;

400 
m_¡rUUID
.
	`”a£
(
¡d
::
	`»move
(m_¡rUUID.
	`begš
(), m_¡rUUID.
	`’d
(), '-'), m_strUUID.end());

402 ià(!
	`¡rcmp
(
ty³
, "TYPE")) {

403 
m_¡rFSTy³
 = 
v®ue
;

404 ià(
m_¡rFSTy³
 == "ext4" ||

405 
m_¡rFSTy³
 == "ext3")

406 
m_bFÜm©
 = 
Œue
;

407 } ià(!
	`¡rcmp
(
ty³
, "LABEL"))

410 
	`blkid_g_™”©e_’d
(
™”
);

411 
m_csFÜm©
.
	`UÆock
();

413 
mt
[256];

414 
mouÁ_æags
 = 0;

415 
mt
[0] = '\0';

416 
»tv®
 = 
	`ext2fs_check_mouÁ_pošt
(
m_¡rDevNode
.
	`c_¡r
(), &
mouÁ_æags
,

417 
mt
, (mtpt));

418 ià(
»tv®
 == 0) {

419 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

420 
»t
 = 0;

421 
m_¡rMouÁPošt
 = 
mt
;

422 ià(
mouÁ_æags
 & 
EXT2_MF_MOUNTED
) {

423 
m_bMouÁ
 = 
Œue
;

424 } ià(
mouÁ_æags
 & 
EXT2_MF_BUSY
) {

425 
m_bMouÁ
 = 
Œue
;

427 
m_bMouÁ
 = 
çl£
;

434 ià(
m_bMouÁ
) {

435 
»t
 = 
	`ssÿnf
(
mt
, "/mÁ/VOLUME%d", &
m_iVŞumeNum
);

436 ià(
»t
 < 0 ||„‘ =ğ
EOF
 || 
m_iVŞumeNum
 > 128 ||

437 
m_iVŞumeNum
 < 1) {

438 
m_iVŞumeNum
 = -1;

439 ià(
	`umouÁ2
(
m_¡rMouÁPošt
.
	`c_¡r
(),

440 
UMOUNT_NOFOLLOW
 | 
MNT_DETACH
) < 0) {

441 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
, "Failo unmount %s (%s)\n",

442 
m_¡rMouÁPošt
.
	`c_¡r
(),

443 
	`¡»¼Ü
(
”ºo
));

445 
m_bMouÁ
 = 
çl£
;

446 
m_¡rMouÁPošt
 = "";

453 
m_iVŞumeNum
--;

457 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

458 "[%d] FaØcheck mouÁ…ošt.", 
__LINE__
);

459  
MKE2FS_CHECK_MOUNT_POINT_FAIL
;

463 
	}
}

465 
	gFesy¡emMªag”
::
	$Dump
()

467 
	`årštf
(
¡dout
, "\tMount Point: %s(%s), Filesystem: %s(%s)\n"

469 
m_¡rMouÁPošt
.
	`c_¡r
(), 
m_bMouÁ
?"Mounted":"Not mounted",

470 
m_¡rFSTy³
.
	`c_¡r
(), 
m_bFÜm©
?"Formated":"Not Formated",

471 
m_¡rUUID
.
	`c_¡r
());

472 
	}
}

474 
boŞ
 
	gFesy¡emMªag”
::
	$do¡©
(cÚ¡ 
¡ršg
& 
·th
, 
¡©
 *
¡
,

475 
do_l¡©
, 
qu›t
)

477 
n
 = 0;

479 ià(
do_l¡©
)

480 
n
 = 
	`l¡©
(
·th
.
	`c_¡r
(), 
¡
);

482 
n
 = 
	`¡©
(
·th
.
	`c_¡r
(), 
¡
);

484 ià(
n
 != 0) {

485 ià(!
qu›t
)

486 
	`årštf
(
¡d”r
, "mountpoint: %s: %s\n",

487 
·th
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

488  
çl£
;

491  
Œue
;

492 
	}
}

494 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁPošt
(cÚ¡ 
¡ršg
& 
·th
)

496 
¡©
 
¡
, 
¡2
;

497 ià(!
	`do¡©
(
·th
, &
¡
, 1, 0))

498  
çl£
;

500 ià(!
	`do¡©
(
·th
 + "/..", &
¡2
, 1, 0))

501  
çl£
;

503 ià((
¡
.
¡_dev
 !ğ
¡2
.st_dev) ||

504 (
¡
.
¡_dev
 =ğ
¡2
.¡_dev && st.
¡_šo
 == st2.st_ino)) {

505  
Œue
;

508  
çl£
;

509 
	}
}

511 
	gFesy¡emMªag”
::
	$In™ŸlizeMke2fsHªdË
()

513 
	`mem£t
(&
m_mkfsHªdË
.
cfg
, 0x00, (
e2fs_cfg
));

514 
	`¡ºıy
(
m_mkfsHªdË
.
deviû_Çme
, 
m_¡rDevNode
.
	`c_¡r
(),

515 (
m_mkfsHªdË
.
deviû_Çme
));

516 
m_mkfsHªdË
.
cb_func
 = 
MakeFesy¡emProg»ss
;

517 
m_mkfsHªdË
.
buf
 = 
NULL
;

518 
m_mkfsHªdË
.
pD©a
 = 
this
;

520 
m_mkfsHªdË
.
cfg
.
blocksize
 = 4096;

521 
m_mkfsHªdË
.
cfg
.
»£rved_¿tio
 = 1;

522 
m_mkfsHªdË
.
cfg
.
r_İt
 = -1;

523 
m_mkfsHªdË
.
cfg
.
fÜû
 = 1;

524 
m_mkfsHªdË
.
cfg
.
qu›t
 = 1;

525 #ifdeà
DEBUG


526 
m_mkfsHªdË
.
cfg
.
v”bo£
 = 1;

528 
m_mkfsHªdË
.
cfg
.
v”bo£
 = 0;

530 
m_mkfsHªdË
.
cfg
.
ü—tÜ_os
 = 
EXT2_OS_LINUX
;

531 
	`¡ºıy
(
m_mkfsHªdË
.
cfg
.
fs_ty³
, "ext4", 
	`¡¾’
("ext4"));

532 
	}
}

534 
	gFesy¡emMªag”
::
	$S‘VŞumeNum
(cÚ¡ &
num
)

536 
m_iVŞumeNum
 = 
num
;

537 
m_¡rMouÁPošt
 = 
	`¡ršg_fÜm©
("/mÁ/VOLUME%d", 
m_iVŞumeNum
 + 1);

538 
	}
}

	@FilesystemManager.cpp

1 
	~"Fesy¡emMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/fe.h
"

5 
	~"commÚ/nusy¦og.h
"

6 
	~"commÚ/¡ršg.h
"

7 
	~"commÚ/sy¡em.h
"

9 
	~"‹¡_uts.h
"

12 
	~<®gÜ™hm
>

13 
	~<sys/mouÁ.h
>

14 
	~<sys/¡©.h
>

15 
	~<”ºo.h
>

17 
	#LOG_LABEL
 "FSMªag”"

	)

19 
	gFesy¡emMªag”
::
	$Fesy¡emMªag”
(cÚ¡ 
¡ršg
& 
dev
)

20 : 
	`m_¡rMouÁPošt
("")

21 , 
	`m_¡rDevNode
(
dev
)

22 , 
	`m_¡rUUID
("")

23 , 
	`m_¡rFSTy³
("")

24 , 
	`m_iVŞumeNum
(-1)

25 , 
	`m_iFÜm©šgS‹
(
WRITE_INODE_TABLES_UNKNOWN
)

26 , 
	`m_iFÜm©Prog»ss
(0)

27 , 
	`m_bFÜm©
(
çl£
)

28 , 
	$m_bMouÁ
(
çl£
)

30 
	`In™Ÿlize
();

31 
	}
}

33 
	gFesy¡emMªag”
::
	$Fesy¡emMªag”
()

34 : 
	`m_¡rMouÁPošt
("")

35 , 
	`m_¡rDevNode
("")

36 , 
	`m_¡rUUID
("")

37 , 
	`m_¡rFSTy³
("")

38 , 
	`m_iVŞumeNum
(-1)

39 , 
	`m_iFÜm©šgS‹
(
WRITE_INODE_TABLES_UNKNOWN
)

40 , 
	`m_iFÜm©Prog»ss
(0)

41 , 
	`m_bFÜm©
(
çl£
)

42 , 
	$m_bMouÁ
(
çl£
)

44 
	}
}

46 
	gFesy¡emMªag”
::~
	$Fesy¡emMªag”
()

49 
	}
}

51 
boŞ
 
Fesy¡emMªag”
::
	$S‘DeviûNode
(cÚ¡ 
¡ršg
 &
dev
)

53 
m_¡rDevNode
 = 
dev
;

54  
	`In™Ÿlize
();

55 
	}
}

57 
boŞ
 
	gFesy¡emMªag”
::
	$In™Ÿlize
()

59 ià(
m_¡rDevNode
.
	`em±y
()) {

60 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

62  
çl£
;

65 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

66 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

68 
m_¡rDevNode
.
	`c_¡r
());

69  
çl£
;

72 ià(
	`blkid
() != 0) {

73 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

75 
m_¡rDevNode
.
	`c_¡r
());

76  
çl£
;

79  
Œue
;

80 
	}
}

82 
	gFesy¡emMªag”
::
	$S‘MouÁPošt
(cÚ¡ 
¡ršg
 &
mouÁpošt
)

84 
m_¡rMouÁPošt
 = 
mouÁpošt
;

85 
	}
}

87 #ifdeà
NUUO


88 
	gFesy¡emMªag”
::
	$Th»adProc
()

90 ià(!
	`FÜm©
()) {

94 
	`SË•MS
(100);

96 ià(!
	`MouÁ
(
m_¡rMouÁPošt
)) {

100 
	`G’”©eUUIDFe
();

101 
	`C»©eDeçuÉFŞd”s
();

102 
	`Dump
();

103 
	}
}

106 
boŞ
 
	gFesy¡emMªag”
::
	$FÜm©
(
boŞ
 
fÜû
)

108 
»t
 = 0;

110 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csFÜm©
);

112 ià(
m_bFÜm©
 && !
fÜû
)

113 
fÜm©_dÚe
;

115 
	`In™ŸlizeMke2fsHªdË
();

116 
»t
 = 
	`mke2fs
(&
m_mkfsHªdË
);

117 ià(0 !ğ
»t
) {

118 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

119 "FaØfÜm© % [%d]\n", 
m_¡rDevNode
.
	`c_¡r
(), 
»t
);

120  
çl£
;

123 
fÜm©_dÚe
:

124 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

125 "FÜm© % sucûssfuÎy.\n", 
m_¡rDevNode
.
	`c_¡r
());

126  
Œue
;

127 
	}
}

129 
boŞ
 
	gFesy¡emMªag”
::
	$MouÁ
(cÚ¡ 
¡ršg
& 
¡rMouÁPošt
)

131 
¡ršg
 
¡rE¼ÜLog
;

133 ià(
¡rMouÁPošt
.
	`em±y
()) {

134 
¡rE¼ÜLog
 = "Invalid mount…oint.";

135 
mouÁ_check_”r
;

138 ià(
m_¡rDevNode
.
	`em±y
()) {

139 
¡rE¼ÜLog
 = "Invalid device.";

140 
mouÁ_check_”r
;

143 
m_csFÜm©
.
	`Lock
();

144 ià(!
m_bFÜm©
) {

145 
¡rE¼ÜLog
 = "The device isn't formated.";

146 
m_csFÜm©
.
	`UÆock
();

147 
mouÁ_check_”r
;

149 
m_csFÜm©
.
	`UÆock
();

151 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

152 
¡rE¼ÜLog
 = "The device is‚ot‡ block device.";

153 
mouÁ_check_”r
;

156 
m_csMouÁ
.
	`Lock
();

157 ià(
m_bMouÁ


158 && !
m_¡rMouÁPošt
.
	`em±y
()

159 && 
m_¡rMouÁPošt
 =ğ
¡rMouÁPošt


160 && 
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

161 #ifdeà
NUUO


162 && 
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

165 
mouÁ_ok
;

168 ià(
m_bMouÁ
 &&

169 !
m_¡rMouÁPošt
.
	`em±y
() &&

170 
m_¡rMouÁPošt
 !ğ
¡rMouÁPošt
) {

173 
¡rE¼ÜLog
 = "The device has‡lready be mounted. Why„equesto mount‡gain with‡ different mount…oint?";

174 
mouÁ_”r
;

177 ià(!
	`CheckDœeùÜyExi¡
(
¡rMouÁPošt
)) {

178 ià(!
	`MakeDœeùÜy
(
¡rMouÁPošt
)) {

179 
¡rE¼ÜLog
 = "Failo create mount…oint.";

180 
mouÁ_”r
;

182 } ià(
	`IsMouÁPošt
(
¡rMouÁPošt
)) {

185 
¡rE¼ÜLog
 = "The mount…oint is using by‡nother device..";

186 
mouÁ_”r
;

189 ià(
	`mouÁ
(
m_¡rDevNode
.
	`c_¡r
(), 
¡rMouÁPošt
.c_str(),

190 
m_¡rFSTy³
.
	`c_¡r
(), 0, "") < 0) {

191 
¡rE¼ÜLog
 = 
	`¡ršg_fÜm©
("Failo mount %so %s. (%s)",

192 
m_¡rDevNode
.
	`c_¡r
(),

193 
m_¡rMouÁPošt
.
	`c_¡r
(),

194 
	`¡»¼Ü
(
”ºo
));

195 
mouÁ_”r
;

198 
mouÁ_ok
:

199 
m_bMouÁ
 = 
Œue
;

200 
m_¡rMouÁPošt
 = 
¡rMouÁPošt
;

201 
m_csMouÁ
.
	`UÆock
();

202 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

204 
m_¡rDevNode
.
	`c_¡r
(),

205 
m_¡rMouÁPošt
.
	`c_¡r
());

207  
Œue
;

209 
mouÁ_”r
:

210 
m_csMouÁ
.
	`UÆock
();

211 
mouÁ_check_”r
:

212 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

213 "%s", 
¡rE¼ÜLog
.
	`c_¡r
());

214  
çl£
;

215 
	}
}

217 
boŞ
 
	gFesy¡emMªag”
::
	$UnmouÁ
()

219 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

221 ià(!
m_bMouÁ
)

222 
unmouÁ_dÚe
;

224 ià(
m_¡rMouÁPošt
.
	`em±y
())

225 
unmouÁ_dÚe
;

227 ià(!
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
))

228 
unmouÁ_dÚe
;

230 ià(!
	`IsMouÁPošt
(
m_¡rMouÁPošt
))

231 
unmouÁ_dÚe
;

233 ià(
	`umouÁ2
(
m_¡rMouÁPošt
.
	`c_¡r
(), 
UMOUNT_NOFOLLOW
 | 
MNT_DETACH
) < 0) {

234 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
, "Failo unmount %s (%s)\n",

235 
m_¡rMouÁPošt
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

236  
çl£
;

243 
unmouÁ_dÚe
:

244 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

246 
m_¡rMouÁPošt
.
	`c_¡r
());

247 
m_bMouÁ
 = 
çl£
;

248 
m_¡rMouÁPošt
 = "";

249 
m_iVŞumeNum
 = -1;

251  
Œue
;

252 
	}
}

254 
boŞ
 
	gFesy¡emMªag”
::
	$IsFÜm©ed
()

256  
m_bFÜm©
;

257 
	}
}

259 
boŞ
 
	gFesy¡emMªag”
::
	$IsFÜm©šg
(& 
´og»ss
, & 
¡©
)

261 
´og»ss
 = 
m_iFÜm©Prog»ss
;

262 
¡©
 = 
m_iFÜm©šgS‹
;

263 ià(
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_WRITING
 ||

264 
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_WRITING_DONE
 ||

265 
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_INIT
)

266  
Œue
;

268  
çl£
;

269 
	}
}

271 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁed
(
¡ršg
& 
¡rMouÁPošt
)

273 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

274 
¡rMouÁPošt
 = 
m_¡rMouÁPošt
;

275  
m_bMouÁ
;

276 
	}
}

278 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁed
(& 
num
)

280 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

281 
num
 = 
m_iVŞumeNum
;

282  
m_bMouÁ
;

283 
	}
}

285 
	gFesy¡emMªag”
::
	$S‘FÜm©Info
(
boŞ
 
fÜm©
, 
´og»ss
, 
¡©
)

287 
m_bFÜm©
 = 
fÜm©
;

288 
m_iFÜm©Prog»ss
 = 
´og»ss
;

289 
m_iFÜm©šgS‹
 = 
¡©
;

290 
	}
}

292 
	gFesy¡emMªag”
::
	$MakeFesy¡emProg»ss
(*
pD©a
, 
¡©
,

293 
cu¼’t
, 
tÙ®
)

295 ià(
pD©a
 =ğ
NULL
)

297 
Fesy¡emMªag”
 *
pFSMgr
 = (Fesy¡emMªag”*è
pD©a
;

299 
¡©
) {

300 
WRITE_INODE_TABLES_INIT
:

301 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, 0, 
¡©
);

303 
WRITE_INODE_TABLES_WRITING
:

304 
WRITE_INODE_TABLES_WRITING_DONE
:

305 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, ()(()
cu¼’t
 / ()
tÙ®
 * 100), 
¡©
);

307 
WRITE_INODE_TABLES_DONE
:

308 
pFSMgr
->
	`S‘FÜm©Info
(
Œue
, 100, 
¡©
);

310 
WRITE_INODE_TABLES_ERROR
:

311 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, 0, 
¡©
);

314 
	}
}

316 
	gFesy¡emMªag”
::
	$G’”©eUUIDFe
()

318 
Cr™iÿlSeùiÚLock
 
	`cs_mouÁ
(&
m_csMouÁ
);

320 ià(!
m_bMouÁ
 || 
m_¡rMouÁPošt
.
	`em±y
() ||

321 !
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

322 #ifdeà
NUUO


323 || !
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

328 
¡ršg
 
¡rUUIDFeName
 = 
m_¡rMouÁPošt
 + "/uuid";

329 ià(
	`CheckFeExi¡
(
¡rUUIDFeName
) &&

330 
	`G‘FeStÜageSize
(
¡rUUIDFeName
) == 32)

333 
Cr™iÿlSeùiÚLock
 
	`cs_fÜm©
(&
m_csFÜm©
);

335 ià(
m_¡rUUID
.
	`em±y
())

338 
FILE
 *
pf
 = 
	`fİ’
(
¡rUUIDFeName
.
	`c_¡r
(), "w+");

339 ià(
pf
) {

340 
	`årštf
(
pf
, "%s", 
m_¡rUUID
.
	`c_¡r
());

341 
	`fşo£
(
pf
);

343 
	}
}

345 
boŞ
 
	gFesy¡emMªag”
::
	$C»©eDeçuÉFŞd”s
()

347 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

349 ià(!
m_bMouÁ
 || 
m_¡rMouÁPošt
.
	`em±y
() ||

350 !
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

351 #ifdeà
NUUO


352 || !
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

355  
çl£
;

357 
¡ršg
 
¡rFŞd”Name
 = 
m_¡rMouÁPošt
 + "/VIDEODATA";

358 ià(!
	`CheckDœeùÜyExi¡
(
¡rFŞd”Name
)) {

359 ià(!
	`MakeDœeùÜy
(
¡rFŞd”Name
))

360  
çl£
;

363 
¡rFŞd”Name
 = 
m_¡rMouÁPošt
 + "/LOG";

364 ià(!
	`CheckDœeùÜyExi¡
(
¡rFŞd”Name
)) {

365 ià(!
	`MakeDœeùÜy
(
¡rFŞd”Name
))

366  
çl£
;

369  
Œue
;

370 
	}
}

372 
	gFesy¡emMªag”
::
	$blkid
()

374 
blkid_ÿche
 
ÿche
 = 
NULL
;

375 
»tv®
 = 0;

377 ià(
»tv®
 = 
	`blkid_g‘_ÿche
(&
ÿche
, 
NULL
) < 0) {

378 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

379 "[%d] FaØg‘ blkid cache.", 
__LINE__
);

380  
MKE2FS_FAIL_TO_GET_BLKID_CACHE
;

383 
m_csFÜm©
.
	`Lock
();

384 
blkid_dev
 
dev
 = 
	`blkid_g‘_dev
(
ÿche
, 
m_¡rDevNode
.
	`c_¡r
(), 
BLKID_DEV_NORMAL
);

385 cÚ¡ *
devÇme
 = 
	`blkid_dev_devÇme
(
dev
);

386 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

387 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

388 "[%d] % i nÙ‡ block deviû.", 
__LINE__
, 
m_¡rDevNode
.
	`c_¡r
());

389 
m_csFÜm©
.
	`UÆock
();

390  
MKE2FS_NOT_BLOCK_DEV
;

393 
blkid_g_™”©e
 
™”
;

394 cÚ¡ * 
ty³
 = 
NULL
;

395 cÚ¡ * 
v®ue
 = 
NULL
;

396 
™”
 = 
	`blkid_g_™”©e_begš
(
dev
);

397 
	`blkid_g_Ãxt
(
™”
, &
ty³
, &
v®ue
) == 0) {

398 ià(!
	`¡rcmp
(
ty³
, "UUID")) {

399 
m_¡rUUID
 = 
v®ue
;

400 
m_¡rUUID
.
	`”a£
(
¡d
::
	`»move
(m_¡rUUID.
	`begš
(), m_¡rUUID.
	`’d
(), '-'), m_strUUID.end());

402 ià(!
	`¡rcmp
(
ty³
, "TYPE")) {

403 
m_¡rFSTy³
 = 
v®ue
;

404 ià(
m_¡rFSTy³
 == "ext4" ||

405 
m_¡rFSTy³
 == "ext3")

406 
m_bFÜm©
 = 
Œue
;

407 } ià(!
	`¡rcmp
(
ty³
, "LABEL"))

410 
	`blkid_g_™”©e_’d
(
™”
);

411 
m_csFÜm©
.
	`UÆock
();

413 
mt
[256];

414 
mouÁ_æags
 = 0;

415 
mt
[0] = '\0';

416 
»tv®
 = 
	`ext2fs_check_mouÁ_pošt
(
m_¡rDevNode
.
	`c_¡r
(), &
mouÁ_æags
,

417 
mt
, (mtpt));

418 ià(
»tv®
 == 0) {

419 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

420 
»t
 = 0;

421 
m_¡rMouÁPošt
 = 
mt
;

422 ià(
mouÁ_æags
 & 
EXT2_MF_MOUNTED
) {

423 
m_bMouÁ
 = 
Œue
;

424 } ià(
mouÁ_æags
 & 
EXT2_MF_BUSY
) {

425 
m_bMouÁ
 = 
Œue
;

427 
m_bMouÁ
 = 
çl£
;

434 ià(
m_bMouÁ
) {

435 
»t
 = 
	`ssÿnf
(
mt
, "/mÁ/VOLUME%d", &
m_iVŞumeNum
);

436 ià(
»t
 < 0 ||„‘ =ğ
EOF
 || 
m_iVŞumeNum
 > 128 ||

437 
m_iVŞumeNum
 < 1) {

438 
m_iVŞumeNum
 = -1;

439 ià(
	`umouÁ2
(
m_¡rMouÁPošt
.
	`c_¡r
(),

440 
UMOUNT_NOFOLLOW
 | 
MNT_DETACH
) < 0) {

441 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
, "Failo unmount %s (%s)\n",

442 
m_¡rMouÁPošt
.
	`c_¡r
(),

443 
	`¡»¼Ü
(
”ºo
));

445 
m_bMouÁ
 = 
çl£
;

446 
m_¡rMouÁPošt
 = "";

453 
m_iVŞumeNum
--;

457 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

458 "[%d] FaØcheck mouÁ…ošt.", 
__LINE__
);

459  
MKE2FS_CHECK_MOUNT_POINT_FAIL
;

463 
	}
}

465 
	gFesy¡emMªag”
::
	$Dump
()

467 
	`årštf
(
¡dout
, "\tMount Point: %s(%s), Filesystem: %s(%s)\n"

469 
m_¡rMouÁPošt
.
	`c_¡r
(), 
m_bMouÁ
?"Mounted":"Not mounted",

470 
m_¡rFSTy³
.
	`c_¡r
(), 
m_bFÜm©
?"Formated":"Not Formated",

471 
m_¡rUUID
.
	`c_¡r
());

472 
	}
}

474 
boŞ
 
	gFesy¡emMªag”
::
	$do¡©
(cÚ¡ 
¡ršg
& 
·th
, 
¡©
 *
¡
,

475 
do_l¡©
, 
qu›t
)

477 
n
 = 0;

479 ià(
do_l¡©
)

480 
n
 = 
	`l¡©
(
·th
.
	`c_¡r
(), 
¡
);

482 
n
 = 
	`¡©
(
·th
.
	`c_¡r
(), 
¡
);

484 ià(
n
 != 0) {

485 ià(!
qu›t
)

486 
	`årštf
(
¡d”r
, "mountpoint: %s: %s\n",

487 
·th
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

488  
çl£
;

491  
Œue
;

492 
	}
}

494 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁPošt
(cÚ¡ 
¡ršg
& 
·th
)

496 
¡©
 
¡
, 
¡2
;

497 ià(!
	`do¡©
(
·th
, &
¡
, 1, 0))

498  
çl£
;

500 ià(!
	`do¡©
(
·th
 + "/..", &
¡2
, 1, 0))

501  
çl£
;

503 ià((
¡
.
¡_dev
 !ğ
¡2
.st_dev) ||

504 (
¡
.
¡_dev
 =ğ
¡2
.¡_dev && st.
¡_šo
 == st2.st_ino)) {

505  
Œue
;

508  
çl£
;

509 
	}
}

511 
	gFesy¡emMªag”
::
	$In™ŸlizeMke2fsHªdË
()

513 
	`mem£t
(&
m_mkfsHªdË
.
cfg
, 0x00, (
e2fs_cfg
));

514 
	`¡ºıy
(
m_mkfsHªdË
.
deviû_Çme
, 
m_¡rDevNode
.
	`c_¡r
(),

515 (
m_mkfsHªdË
.
deviû_Çme
));

516 
m_mkfsHªdË
.
cb_func
 = 
MakeFesy¡emProg»ss
;

517 
m_mkfsHªdË
.
buf
 = 
NULL
;

518 
m_mkfsHªdË
.
pD©a
 = 
this
;

520 
m_mkfsHªdË
.
cfg
.
blocksize
 = 4096;

521 
m_mkfsHªdË
.
cfg
.
»£rved_¿tio
 = 1;

522 
m_mkfsHªdË
.
cfg
.
r_İt
 = -1;

523 
m_mkfsHªdË
.
cfg
.
fÜû
 = 1;

524 
m_mkfsHªdË
.
cfg
.
qu›t
 = 1;

525 #ifdeà
DEBUG


526 
m_mkfsHªdË
.
cfg
.
v”bo£
 = 1;

528 
m_mkfsHªdË
.
cfg
.
v”bo£
 = 0;

530 
m_mkfsHªdË
.
cfg
.
ü—tÜ_os
 = 
EXT2_OS_LINUX
;

531 
	`¡ºıy
(
m_mkfsHªdË
.
cfg
.
fs_ty³
, "ext4", 
	`¡¾’
("ext4"));

532 
	}
}

534 
	gFesy¡emMªag”
::
	$S‘VŞumeNum
(cÚ¡ &
num
)

536 
m_iVŞumeNum
 = 
num
;

537 
m_¡rMouÁPošt
 = 
	`¡ršg_fÜm©
("/mÁ/VOLUME%d", 
m_iVŞumeNum
 + 1);

538 
	}
}

	@FilesystemManager.h

1 #iâdeà
__FILESYSTEM_MANAGER_H__


2 
	#__FILESYSTEM_MANAGER_H__


	)

4 #ifdeà
__ılu¥lus


8 
	~"libmke2fs/mke2fs.h
"

11 
	~"blkid/blkid.h
"

12 #ifdeà
__ılu¥lus


16 
	~<¡ršg
>

18 
usšg
 
Çme¥aû
 
¡d
;

20 #ifdeà
NUUO


21 
	~"­r/­r_th»ad_wÜk”.h
"

22 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

23 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

25 
şass
 
	gFesy¡emMªag”
: 
public
 
A´Th»adWÜk”


27 
	~"‹¡_uts.h
"

29 
şass
 
Fesy¡emMªag”


32 
´iv©e
:

33 
Cr™iÿlSeùiÚ
 
m_csFÜm©
;

34 
Cr™iÿlSeùiÚ
 
	gm_csMouÁ
;

35 
mke2fs_hªdË
 
	gm_mkfsHªdË
;

38 
¡ršg
 
	gm_¡rMouÁPošt
;

39 
¡ršg
 
	gm_¡rDevNode
;

40 
¡ršg
 
	gm_¡rUUID
;

41 
¡ršg
 
	gm_¡rFSTy³
;

42 
	gm_iVŞumeNum
;

43 
	gm_iFÜm©šgS‹
;

44 
	gm_iFÜm©Prog»ss
;

45 
boŞ
 
	gm_bFÜm©
;

46 
boŞ
 
	gm_bMouÁ
;

48 
	g´Ùeùed
:

49 #ifdeà
NUUO


50 
Th»adProc
();

53 
	g´iv©e
:

54 
In™ŸlizeMke2fsHªdË
();

55 
boŞ
 
In™Ÿlize
();

56 
blkid
();

58 
	gpublic
:

59 
Fesy¡emMªag”
();

60 
Fesy¡emMªag”
(cÚ¡ 
¡ršg
& 
dev
);

61 
	gvœtu®
 ~
Fesy¡emMªag”
();

63 
MakeFesy¡emProg»ss
(*
pD©a
, 
¡©
,

64 
cu¼’t
, 
tÙ®
);

67 
boŞ
 
FÜm©
(boŞ 
fÜû
 = 
Œue
);

72 
boŞ
 
S‘DeviûNode
(cÚ¡ 
¡ršg
 &
dev
);

73 
S‘MouÁPošt
(cÚ¡ 
¡ršg
 &
mouÁpošt
);

74 
S‘VŞumeNum
(cÚ¡ &
num
);

75 
boŞ
 
MouÁ
(cÚ¡ 
¡ršg
& 
¡rMouÁPošt
);

76 
boŞ
 
UnmouÁ
();

78 
boŞ
 
IsFÜm©ed
();

79 
boŞ
 
IsFÜm©šg
(& 
´og»ss
, & 
¡©
);

80 
boŞ
 
IsMouÁed
(
¡ršg
& 
¡rMouÁPošt
);

81 
boŞ
 
IsMouÁed
(& 
num
);

82 
S‘FÜm©Info
(
boŞ
 
fÜm©
, 
´og»ss
,

83 
¡©
);

85 
G’”©eUUIDFe
();

86 
boŞ
 
C»©eDeçuÉFŞd”s
();

88 
Dump
();

90 
boŞ
 
do¡©
(cÚ¡ 
¡ršg
& 
·th
, 
¡©
 *
¡
,

91 
do_l¡©
, 
qu›t
);

92 
boŞ
 
IsMouÁPošt
(cÚ¡ 
¡ršg
& 
·th
);

	@FilesystemManager.h

1 #iâdeà
__FILESYSTEM_MANAGER_H__


2 
	#__FILESYSTEM_MANAGER_H__


	)

4 #ifdeà
__ılu¥lus


8 
	~"libmke2fs/mke2fs.h
"

11 
	~"blkid/blkid.h
"

12 #ifdeà
__ılu¥lus


16 
	~<¡ršg
>

18 
usšg
 
Çme¥aû
 
¡d
;

20 #ifdeà
NUUO


21 
	~"­r/­r_th»ad_wÜk”.h
"

22 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

23 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

25 
şass
 
	gFesy¡emMªag”
: 
public
 
A´Th»adWÜk”


27 
	~"‹¡_uts.h
"

29 
şass
 
Fesy¡emMªag”


32 
´iv©e
:

33 
Cr™iÿlSeùiÚ
 
m_csFÜm©
;

34 
Cr™iÿlSeùiÚ
 
	gm_csMouÁ
;

35 
mke2fs_hªdË
 
	gm_mkfsHªdË
;

38 
¡ršg
 
	gm_¡rMouÁPošt
;

39 
¡ršg
 
	gm_¡rDevNode
;

40 
¡ršg
 
	gm_¡rUUID
;

41 
¡ršg
 
	gm_¡rFSTy³
;

42 
	gm_iVŞumeNum
;

43 
	gm_iFÜm©šgS‹
;

44 
	gm_iFÜm©Prog»ss
;

45 
boŞ
 
	gm_bFÜm©
;

46 
boŞ
 
	gm_bMouÁ
;

48 
	g´Ùeùed
:

49 #ifdeà
NUUO


50 
Th»adProc
();

53 
	g´iv©e
:

54 
In™ŸlizeMke2fsHªdË
();

55 
boŞ
 
In™Ÿlize
();

56 
blkid
();

58 
	gpublic
:

59 
Fesy¡emMªag”
();

60 
Fesy¡emMªag”
(cÚ¡ 
¡ršg
& 
dev
);

61 
	gvœtu®
 ~
Fesy¡emMªag”
();

63 
MakeFesy¡emProg»ss
(*
pD©a
, 
¡©
,

64 
cu¼’t
, 
tÙ®
);

67 
boŞ
 
FÜm©
(boŞ 
fÜû
 = 
Œue
);

72 
boŞ
 
S‘DeviûNode
(cÚ¡ 
¡ršg
 &
dev
);

73 
S‘MouÁPošt
(cÚ¡ 
¡ršg
 &
mouÁpošt
);

74 
S‘VŞumeNum
(cÚ¡ &
num
);

75 
boŞ
 
MouÁ
(cÚ¡ 
¡ršg
& 
¡rMouÁPošt
);

76 
boŞ
 
UnmouÁ
();

78 
boŞ
 
IsFÜm©ed
();

79 
boŞ
 
IsFÜm©šg
(& 
´og»ss
, & 
¡©
);

80 
boŞ
 
IsMouÁed
(
¡ršg
& 
¡rMouÁPošt
);

81 
boŞ
 
IsMouÁed
(& 
num
);

82 
S‘FÜm©Info
(
boŞ
 
fÜm©
, 
´og»ss
,

83 
¡©
);

85 
G’”©eUUIDFe
();

86 
boŞ
 
C»©eDeçuÉFŞd”s
();

88 
Dump
();

90 
boŞ
 
do¡©
(cÚ¡ 
¡ršg
& 
·th
, 
¡©
 *
¡
,

91 
do_l¡©
, 
qu›t
);

92 
boŞ
 
IsMouÁPošt
(cÚ¡ 
¡ršg
& 
·th
);

	@RAIDManager.cpp

1 
	~"RAIDMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/fe.h
"

5 
	~"commÚ/¡ršg.h
"

6 
	~"commÚ/dœeùÜy_Œav”£.h
"

9 
	#LOG_LABEL
 "RAIDMªag”"

	)

11 
	gRAIDMªag”
::
	$RAIDMªag”
()

13 
i
 = 0; i < 128; i++)

14 
m_bU£dMD
[
i
] = 
çl£
;

15 
i
 = 0; i < 128; i++)

16 
m_bU£dVŞume
[
i
] = 
çl£
;

18 #ifdeà
NUUO


19 
DœeùÜyT¿v”£
 
	`dt
("/dev");

24 
dt
.
	`Next
()) {

25 ià(
dt
.
	`G‘P©hName
().
	`fšd
("/dev/md"è!ğ
¡ršg
::
Åos
) {

26 ià(
	`CheckBlockDeviû
(
dt
.
	`G‘P©hName
())) {

27 
num
 = 0;

28 
»t
 = 
	`ssÿnf
(
dt
.
	`G‘P©hName
().
	`c_¡r
(), "/dev/md%d", &
num
);

29 ià(
»t
 < 1 ||„‘ =ğ
EOF
 || 
num
 > 127 ||‚um < 0)

36 ià(
	`Upd©eRAIDInfo
(
dt
.
	`G‘P©hName
(), 
num
)) {

37 
m_bU£dMD
[
num
] = 
Œue
;

40 
vŞumeNum
;

41 ià(
	`IsFÜm©ed
(
dt
.
	`G‘P©hName
())) {

42 ià(
	`IsMouÁed
(
dt
.
	`G‘P©hName
(), 
vŞumeNum
)) {

43 
m_bU£dVŞume
[
vŞumeNum
] = 
Œue
;

45 
	`MouÁ
(
dt
.
	`G‘P©hName
());

51 
dt
.
	`Re£t
();

63 
dt
.
	`Next
()) {

64 ià(
dt
.
	`G‘FÏgs
(è& 
DœeùÜyT¿v”£
::
FLAG_SYMBOLIC
) {

65 ià(
dt
.
	`G‘P©hName
().
	`fšd
("/dev/nuuo_sata") !=

66 
¡ršg
::
Åos
) {

67 ià(
dt
.
	`G‘P©hName
() != "/dev/nuuo_satadom") {

68 
	`AddDiskSymLšk
(
dt
.
	`G‘P©hName
(), 
DISK_TYPE_SATA
);

69 
	`AddDisk
(
dt
.
	`G‘P©hName
());

71 } ià(
dt
.
	`G‘P©hName
().
	`fšd
("/dev/nuuo_e§"è!ğ
¡ršg
::
Åos
) {

72 
	`AddDiskSymLšk
(
dt
.
	`G‘P©hName
(), 
DISK_TYPE_ESATA
);

73 
	`AddDisk
(
dt
.
	`G‘P©hName
());

74 } ià(
dt
.
	`G‘P©hName
().
	`fšd
("/dev/nuuo_iscsi"è!ğ
¡ršg
::
Åos
) {

75 
	`AddDiskSymLšk
(
dt
.
	`G‘P©hName
(), 
DISK_TYPE_ISCSI
);

76 
	`AddDisk
(
dt
.
	`G‘P©hName
());

80 
dt
.
	`Clo£
();

82 
	}
}

84 
	gRAIDMªag”
::~
	$RAIDMªag”
()

87 
	}
}

89 
RAIDMªag”
::
	$G‘F»eMDNum
()

91 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

92 
i
 = 0 ; i < 128; i++) {

93 ià(!
m_bU£dMD
[
i
]) {

94 
m_bU£dMD
[
i
] = 
Œue
;

95  
i
;

100 
	}
}

102 
	gRAIDMªag”
::
	$F»eMDNum
(
n
)

104 ià(
n
 < 0 ||‚ > 127)

107 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

108 
m_bU£dMD
[
n
] = 
çl£
;

109 
	}
}

111 
	gRAIDMªag”
::
	$S‘MDNum
(
n
)

113 ià(
n
 < 0 ||‚ > 127)

116 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

117 
m_bU£dMD
[
n
] = 
Œue
;

118 
	}
}

120 
	gRAIDMªag”
::
	$G‘F»eVŞumeNum
()

122 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

123 
i
 = 0 ; i < 128; i++) {

124 ià(!
m_bU£dVŞume
[
i
]) {

125 
m_bU£dVŞume
[
i
] = 
Œue
;

126  
i
;

131 
	}
}

133 
	gRAIDMªag”
::
	$F»eVŞumeNum
(
n
)

135 ià(
n
 < 0 ||‚ > 127)

138 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

139 
m_bU£dVŞume
[
n
] = 
çl£
;

140 
	}
}

142 
	gRAIDMªag”
::
	$S‘VŞumeNum
(
n
)

144 ià(
n
 < 0 ||‚ > 127)

147 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

148 
m_bU£dVŞume
[
n
] = 
Œue
;

149 
	}
}

151 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
RAIDMªag”
::
	$IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
, 
RAIDInfo
& 
šfo
)

153 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

154 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

155 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

156 ià(*
™
 =ğ
mddev
) {

157 
šfo
 = *
™
;

161 
™
 ++;

164  
™
;

165 
	}
}

167 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
RAIDMªag”
::
	$IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
)

169 
RAIDInfo
 
šfo
;

170  
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
);

171 
	}
}

173 
boŞ
 
	gRAIDMªag”
::
	$IsDiskExi¡InRAIDDiskLi¡
(cÚ¡ 
¡ršg
& 
dev
)

175 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDDiskLi¡
);

176 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™_disk
 = 
m_vRAIDDiskLi¡
.
	`begš
();

177 
™_disk
 !ğ
m_vRAIDDiskLi¡
.
	`’d
()) {

181 
¡ršg
 
¡rDevNode
 = 
	`G‘DeviûNodeBySymLšk
(
dev
);

182 ià(*
™_disk
 =ğ
¡rDevNode
) {

183  
Œue
;

185 
™_disk
++;

188  
çl£
;

189 
	}
}

191 
boŞ
 
	gRAIDMªag”
::
IsDiskExi¡InRAIDDiskLi¡
(
veùÜ
<
¡ršg
>& 
vDevLi¡
)

193 
veùÜ
<
¡ršg
>::
™”©Ü
 
™_devli¡
 = 
vDevLi¡
.
begš
();

194 
	g™_devli¡
 !ğ
vDevLi¡
.
’d
()) {

195 if(!
IsDiskExi¡InRAIDDiskLi¡
(*
™_devli¡
)) {

196  
çl£
;

199 
	g™_devli¡
++;

202  
	gŒue
;

205 
boŞ
 
	gRAIDMªag”
::
	$IsDiskHaveMDSu³rBlock
(cÚ¡ 
¡ršg
& 
dev
, 
examše_»suÉ
 &
»suÉ
, &
”r
)

207 
veùÜ
<
¡ršg
> 
vDevLi¡
;

208 
mddev_dev
* 
devli¡
 = 
NULL
;

209 
cÚ‹xt
 
c
;

211 
vDevLi¡
.
	`push_back
(
dev
);

212 ià(
NULL
 =ğ(
devli¡
 = 
	`In™ŸlizeDevLi¡
(
vDevLi¡
))) {

213 
”r
 = 
EXAMINE_MEM_ALLOC_FAIL
;

214  
çl£
;

217 
	`In™ŸlizeCÚ‹xt
(
c
);

218 
”r
 = 
	`Examše_ToResuÉ
(
devli¡
, &
c
, 
NULL
, &
»suÉ
);

219 
	`F»eDevLi¡
(
devli¡
);

221  !(
”r
 =ğ
EXAMINE_NO_MD_SUPERBLOCK
);

222 
	}
}

224 
boŞ
 
	gRAIDMªag”
::
	$AddDiskSymLšk
(cÚ¡ 
¡ršg
& 
symlšk
, 
eDiskTy³
 
ty³
)

226 ià(
symlšk
.
	`em±y
())

227  
çl£
;

229 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csSymLškTabË
);

231 
¡ršg
 
¡rDevNode
 = 
	`G‘DeviûNodeBySymLšk
(
symlšk
);

232 
MiscDiskInfo
 
	`šfo
(
symlšk
, 
ty³
);

233 
šfo
.
	`Dump
();

234 
m_m­SymLškTabË
[
¡rDevNode
] = 
šfo
;

235  
Œue
;

236 
	}
}

238 
boŞ
 
	gRAIDMªag”
::
	$RemoveDiskSymLšk
(cÚ¡ 
¡ršg
& 
symlšk
)

240 ià(
symlšk
.
	`em±y
())

241  
çl£
;

243 
¡ršg
 
¡rDevNode
 = 
	`G‘DeviûNodeBySymLšk
(
symlšk
);

245 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csSymLškTabË
);

247 
m­
<
¡ršg
, 
MiscDiskInfo
>::
™”©Ü
 
™
 = 
m_m­SymLškTabË
.
	`fšd
(
¡rDevNode
);

248 ià(
™
 !ğ
m_m­SymLškTabË
.
	`’d
())

249 
m_m­SymLškTabË
.
	`”a£
(
™
);

251  
Œue
;

252 
	}
}

254 
boŞ
 
	gRAIDMªag”
::
	$AddDisk
(cÚ¡ 
¡ršg
& 
dev
)

257 ià(
dev
.
	`em±y
())

258  
çl£
;

263 ià(!
	`CheckBlockDeviû
(
dev
)) {

264 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

265 "% i nÙ‡ block deviû.\n", 
dev
.
	`c_¡r
());

266  
çl£
;

277 
examše_»suÉ
 
»suÉ
;

278 
»t
 = 
SUCCESS
;

279 
RAIDDiskInfo
 
šfo
;

280 
boŞ
 
bExi¡
 = 
	`IsDiskExi¡InRAIDDiskLi¡
(
dev
);

282 
šfo
.
m_bHasMDSB
 = 
	`IsDiskHaveMDSu³rBlock
(
dev
, 
»suÉ
, 
»t
);

283 
šfo
.
m_¡rDevName
 = 
	`G‘DeviûNodeBySymLšk
(
dev
);

284 
šfo
.
	`S‘HDDV’dÜInfom©iÚ
();

285 
šfo
.
m_iRaidDiskNum
 = 
»suÉ
.
uRaidDiskNum
;

286 
	`memıy
(
šfo
.
m_RaidUUID
, 
»suÉ
.
¬¿yUUID
, () * 4);

289 ià(!
bExi¡
) {

290 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDDiskLi¡
);

291 
m_vRAIDDiskLi¡
.
	`push_back
(
šfo
);

292 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

293 "% added sucûssfuÎy .\n", 
dev
.
	`c_¡r
());

298 ià(!
šfo
.
m_bHasMDSB
) {

299 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

300 "% ha nØMD su³rblock .\n", 
dev
.
	`c_¡r
());

301  
Œue
;

302 } ià(
»t
 > 0) {

303 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

304 "[%d] ExamšE¼Ü Cod%s: (%d)\n", 
__LINE__
,

305 
dev
.
	`c_¡r
(), 
»t
);

306  
çl£
;

316 
m_csRAIDInfoLi¡
.
	`Lock
();

318 
¡ršg
 
mddev
;

319 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
¿id_™
 = 
	`S—rchDiskB–Úg2RAID
(
šfo
);

320 ià(
¿id_™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

321 
veùÜ
<
¡ršg
> 
vDevLi¡
;

322 
vDevLi¡
.
	`push_back
(
dev
);

324 ià(
šfo
.
m_iS‹
 & (1 << 
MD_DISK_ACTIVE
)) {

327 
»t
 = 
	`R—ddMDDisks
(
¿id_™
->
m_¡rDevNodeName
, 
vDevLi¡
);

328 ià(
»t
 !ğ
SUCCESS
) {

329 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

331 
__LINE__
,

332 
¿id_™
->
m_¡rDevNodeName
.
	`c_¡r
(), 
»t
);

338 
m_csRAIDInfoLi¡
.
	`UÆock
();

345 
m_csRAIDInfoLi¡
.
	`UÆock
();

350 
couÁ”
 = 1;

351 
m_csRAIDDiskLi¡
.
	`Lock
();

352 
size_t
 
i
 = 0; i < 
m_vRAIDDiskLi¡
.
	`size
(); i++) {

353 ià(
šfo
.
m_¡rDevName
 =ğ
m_vRAIDDiskLi¡
[
i
].m_strDevName)

357 ià(0 =ğ
	`memcmp
(
šfo
.
m_RaidUUID
, 
m_vRAIDDiskLi¡
[
i
].m_RaidUUID, () * 4))

358 
couÁ”
++;

360 
m_csRAIDDiskLi¡
.
	`UÆock
();

362 ià(
couÁ”
 >ğ
šfo
.
m_iRaidDiskNum
) {

363 ià(
	`As£mbËRAID
(
šfo
.
m_RaidUUID
, 
mddev
)) {

368 
num
 = -1;

369 ià(
	`IsFÜm©ed
(
mddev
è&& !
	`IsMouÁed
(mddev, 
num
))

370 
	`MouÁ
(
mddev
);

371  
Œue
;

377 
	`Upd©eRAIDInfo
(
mddev
);

378  
Œue
;

379 
	}
}

381 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
RAIDMªag”
::
	$S—rchDiskB–Úg2RAID
(
RAIDDiskInfo
& 
šfo
)

384 ià(
šfo
.
m_¡rDevName
.
	`em±y
())

385  
m_vRAIDInfoLi¡
.
	`’d
();

396 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

397 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

398 ià(0 !ğ
	`memcmp
(
™
->
m_UUID
, 
šfo
.
m_RaidUUID
, (info.m_RaidUUID))) {

399 
™
 ++;

402 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™_disk
 = 
™
->
m_vDiskLi¡
.
	`begš
();

403 
™_disk
 !ğ
™
->
m_vDiskLi¡
.
	`’d
()) {

404 ià(*
™_disk
 =ğ
šfo
.
m_¡rDevName
) {

405 
šfo
 = *
™_disk
;

409 
™_disk
++;

411  
™
;

414 
™
 ++;

417  
™
;

418 
	}
}

420 
boŞ
 
	gRAIDMªag”
::
	$RemoveDisk
(cÚ¡ 
¡ršg
& 
dev
)

423 ià(
dev
.
	`em±y
())

424  
çl£
;

433 
m_csRAIDDiskLi¡
.
	`Lock
();

434 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™
 = 
m_vRAIDDiskLi¡
.
	`begš
();

435 
uuid
[4];

436 
™
 !ğ
m_vRAIDDiskLi¡
.
	`’d
()) {

437 ià(*
™
 =ğ
dev
) {

438 
	`memıy
(
uuid
, 
™
->
m_RaidUUID
, () * 4);

441 
™
++;

444 ià(
™
 =ğ
m_vRAIDDiskLi¡
.
	`’d
()) {

445 
m_csRAIDDiskLi¡
.
	`UÆock
();

446 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csSymLškTabË
);

447 
m­
<
¡ršg
, 
MiscDiskInfo
>::
™”©Ü
 
™_symLškTabË
 = 
m_m­SymLškTabË
.
	`fšd
(
dev
);

448 
m_m­SymLškTabË
.
	`”a£
(
™_symLškTabË
);

449 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

450 "% »moved sucûssfuÎy .\n", 
dev
.
	`c_¡r
());

451  
Œue
;

466 
RAIDDiskInfo
 
šfo
 = *
™
;

467 
m_csRAIDInfoLi¡
.
	`Lock
();

468 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
¿id_™
 = 
	`S—rchDiskB–Úg2RAID
(
šfo
);

469 ià(
¿id_™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

470 
num
 = -1;

471 ià(
¿id_™
->
m_fsMgr
->
	`IsMouÁed
(
num
)) {

472 
¿id_™
->
m_fsMgr
->
	`UnmouÁ
();

473 
	`F»eVŞumeNum
(
num
);

476 
veùÜ
<
¡ršg
> 
vDevLi¡
;

477 
vDevLi¡
.
	`push_back
(
dev
);

478 
	`M¬kFauÉyMDDisks
(
¿id_™
->
m_¡rDevNodeName
, 
vDevLi¡
);

479 
	`RemoveMDDisks
(
¿id_™
->
m_¡rDevNodeName
, 
vDevLi¡
);

481 
m_csRAIDInfoLi¡
.
	`UÆock
();

484 
m_csSymLškTabË
.
	`Lock
();

485 
m­
<
¡ršg
, 
MiscDiskInfo
>::
™”©Ü
 
™_symLškTabË
 = 
m_m­SymLškTabË
.
	`fšd
(
dev
);

486 
m_m­SymLškTabË
.
	`”a£
(
™_symLškTabË
);

487 
m_csSymLškTabË
.
	`UÆock
();

489 
m_vRAIDDiskLi¡
.
	`”a£
(
™
);

490 
m_csRAIDDiskLi¡
.
	`UÆock
();

496 
	`Upd©eRAIDInfo
(
uuid
);

497 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

498 "% »moved sucûssfuÎy .\n", 
dev
.
	`c_¡r
());

499  
Œue
;

500 
	}
}

502 
	gRAIDMªag”
::
Upd©eRAIDDiskLi¡
(
veùÜ
<
RAIDDiskInfo
>& 
vRAIDDiskInfoLi¡
, cÚ¡ 
¡ršg
& 
mddev
)

504 ià(
	gvRAIDDiskInfoLi¡
.
em±y
())

507 
	gveùÜ
<
	gRAIDDiskInfo
>::
™”©Ü
 
™
 = 
vRAIDDiskInfoLi¡
.
begš
();

508 
	g™
 !ğ
vRAIDDiskInfoLi¡
.
’d
()) {

509 
boŞ
 
bExi¡
 = 
çl£
;

510 
Cr™iÿlSeùiÚLock
 
csRAIDDiskLi¡
(&
m_csRAIDDiskLi¡
);

511 
	gveùÜ
<
	gRAIDDiskInfo
>::
™”©Ü
 
™_®l
 = 
m_vRAIDDiskLi¡
.
begš
();

512 
	g™_®l
 !ğ
m_vRAIDDiskLi¡
.
’d
()) {

513 ià(*
™
 =ğ*
™_®l
) {

514 
examše_»suÉ
 
»suÉ
;

515 
	g»t
 = 
SUCCESS
;

517 
	g™
->
	gm_bHasMDSB
 = 
IsDiskHaveMDSu³rBlock
(
™
->
m_¡rDevName
, 
»suÉ
, 
»t
);

518 *
	g™_®l
 = *
™
;

519 
	gbExi¡
 = 
Œue
;

523 
	g™_®l
++;

526 ià(!
	gbExi¡
) {

531 
	gm_vRAIDDiskLi¡
.
push_back
(*
™
);

534 
Cr™iÿlSeùiÚLock
 
csSymLškTabË
(&
m_csSymLškTabË
);

535 
	gm_m­SymLškTabË
[
™
->
m_¡rDevName
].
	gm_¡rMDDev
 = 
mddev
;

536 
	g™
++;

539 
Cr™iÿlSeùiÚLock
 
cs
(&
m_csSymLškTabË
);

540 
	gm­
<
	g¡ršg
, 
	gMiscDiskInfo
>::
™”©Ü
 
™_symLškTab
 = 
m_m­SymLškTabË
.
begš
();

541 
	g™_symLškTab
 !ğ
m_m­SymLškTabË
.
’d
()) {

542 ià(
™_symLškTab
->
£cÚd
.
m_¡rMDDev
 !ğ
mddev
) {

543 
™_symLškTab
++;

547 
boŞ
 
	gbFound
 = 
çl£
;

548 
size_t
 
	gi
 = 0; i < 
	gvRAIDDiskInfoLi¡
.
size
(); i++) {

549 ià(
	g™_symLškTab
->
	gfœ¡
 =ğ
vRAIDDiskInfoLi¡
[
i
].
m_¡rDevName
) {

550 
bFound
 = 
Œue
;

555 ià(!
	gbFound
)

556 
	g™_symLškTab
->
	g£cÚd
.
	gm_¡rMDDev
 = "";

558 
	g™_symLškTab
++;

562 
boŞ
 
	gRAIDMªag”
::
	$G‘RAIDD‘a
(cÚ¡ 
¡ršg
& 
mddev
,

563 
¬¿y_d‘a
 &
ad
)

565 
cÚ‹xt
 
c
;

566 
»t
 = 
SUCCESS
;

568 
	`In™ŸlizeCÚ‹xt
(
c
);

569 
»t
 = 
	`D‘a_ToA¼ayD‘a
(
mddev
.
	`c_¡r
(), &
c
, &
ad
);

570 ià(
»t
 !ğ
SUCCESS
) {

571 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

573 
__LINE__
, 
mddev
.
	`c_¡r
(), 
»t
);

574  
çl£
;

577  
Œue
;

578 
	}
}

580 
boŞ
 
	gRAIDMªag”
::
	$IsRAIDAbnÜm®
(cÚ¡ 
RAIDInfo
 &
šfo
)

582 
num
 = -1;

584 ià(
šfo
.
m_iTÙ®DiskNum
 == 0)

585 
¿id_abnÜm®
;

587 
šfo
.
m_iRAIDLev–
) {

593 
LEVEL_MULTIPATH
:

594 
LEVEL_LINEAR
:

595 ià(
šfo
.
m_¡rS‹
.
	`fšd
("FAILED"è!ğ
¡ršg
::
Åos
)

596 
¿id_abnÜm®
;

599 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

601 
šfo
.
m_¡rDevNodeName
.
	`c_¡r
());

602  
Œue
;

606 ià(
šfo
.
m_fsMgr
->
	`IsFÜm©ed
()) {

607 ià(!
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

608 
¡ršg
 
¡rMouÁPošt
;

609 ià(
num
 < 0) {

610 
num
 = 
	`G‘F»eVŞumeNum
();

611 ià(
num
 < 0) {

617 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

619  
çl£
;

621 
šfo
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

624 
šfo
.
m_fsMgr
->
	`IsMouÁed
(
¡rMouÁPošt
);

625 ià(!
šfo
.
m_fsMgr
->
	`MouÁ
(
¡rMouÁPošt
)) {

626 
	`F»eVŞumeNum
(
num
);

631  
çl£
;

633 
¿id_abnÜm®
:

635 ià(
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

636 
šfo
.
m_fsMgr
->
	`UnmouÁ
();

637 
	`F»eVŞumeNum
(
num
);

639  
Œue
;

640 
	}
}

642 
boŞ
 
	gRAIDMªag”
::
	$Upd©eRAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
mdnum
)

649 ià(
mddev
.
	`em±y
())

650  
çl£
;

658 
¬¿y_d‘a
 
ad
;

659 
RAIDInfo
 
šfo
;

660 
boŞ
 
bG‘D‘aSucûss
 = 
çl£
;

662 
bG‘D‘aSucûss
 = 
	`G‘RAIDD‘a
(
mddev
, 
ad
);

664 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

665 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

666 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

667 ià(*
™
 =ğ
mddev
) {

668 ià(!
bG‘D‘aSucûss
) {

669 
™
->
m_¡rS‹
 = "INVALID";

670  
çl£
;

673 *
™
 = 
ad
;

674 
	`Upd©eRAIDDiskLi¡
(
™
->
m_vDiskLi¡
, 
mddev
);

676 ià(
	`IsRAIDAbnÜm®
(*
™
)) {

678 ià(
ad
.
¬¿yInfo
.
Ä_disks
 == 0) {

679 
m_vRAIDInfoLi¡
.
	`”a£
(
™
);

680 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

682 
__LINE__
, 
mddev
.
	`c_¡r
());

686  
Œue
;

689 
™
 ++;

692 ià(
ad
.
¬¿yInfo
.
Ä_disks
 == 0) {

693 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

695 
__LINE__
, 
mddev
.
	`c_¡r
());

696  
Œue
;

699 
šfo
 = 
ad
;

700 
šfo
.
m_iMDNum
 = 
mdnum
;

701 
šfo
.
	`In™ŸlizeFSMªag”
();

702 
	`Upd©eRAIDDiskLi¡
(
šfo
.
m_vDiskLi¡
, 
mddev
);

703 
m_vRAIDInfoLi¡
.
	`push_back
(
šfo
);

704  
Œue
;

705 
	}
}

707 
boŞ
 
	gRAIDMªag”
::
	$Upd©eRAIDInfo
()

716 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

717 ià(
m_vRAIDInfoLi¡
.
	`em±y
())

718  
Œue
;

720 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

721 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

722 
¬¿y_d‘a
 
ad
;

724 ià(!
	`G‘RAIDD‘a
(
™
->
m_¡rDevNodeName
, 
ad
)) {

730 
™
->
m_¡rS‹
 = "INVALID";

734 *
™
 = 
ad
;

735 
	`Upd©eRAIDDiskLi¡
(
™
->
m_vDiskLi¡
, it->
m_¡rDevNodeName
);

737 
	`IsRAIDAbnÜm®
(*
™
);

739 ià(
ad
.
¬¿yInfo
.
Ä_disks
 == 0) {

740 
™
 = 
m_vRAIDInfoLi¡
.
	`”a£
(it);

741 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

743 
__LINE__
, 
™
->
m_¡rDevNodeName
.
	`c_¡r
());

745 
™
 ++;

749  
Œue
;

750 
	}
}

752 
boŞ
 
	gRAIDMªag”
::
	$Upd©eRAIDInfo
(cÚ¡ 
uuid
[4])

760 ià(
uuid
 =ğ
NULL
)

761  
çl£
;

763 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

764 ià(
m_vRAIDInfoLi¡
.
	`em±y
())

765  
Œue
;

767 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

768 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

769 ià(0 =ğ
	`memcmp
(
uuid
, 
™
->
m_UUID
, () * 4)) {

770 
¬¿y_d‘a
 
ad
;

772 ià(!
	`G‘RAIDD‘a
(
™
->
m_¡rDevNodeName
, 
ad
)) {

773 
™
->
m_¡rS‹
 = "INVALID";

774  
çl£
;

777 *
™
 = 
ad
;

778 
	`Upd©eRAIDDiskLi¡
(
™
->
m_vDiskLi¡
, it->
m_¡rDevNodeName
);

779 ià(
	`IsRAIDAbnÜm®
(*
™
)) {

781 ià(
ad
.
¬¿yInfo
.
Ä_disks
 == 0) {

782 
m_vRAIDInfoLi¡
.
	`”a£
(
™
);

783 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

785 
__LINE__
, 
™
->
m_¡rDevNodeName
.
	`c_¡r
());

789  
Œue
;

792 
™
++;

795 * 
p_uuid
 = (*è
uuid
;

796 
¡ršg
 
	`¡rUUID
("");

797 
i
 = 0; i < 16; i++) {

798 
¡rUUID
 +ğ
	`¡ršg_fÜm©
("%02X ", 
p_uuid
[
i
]);

800 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
, "MD deviû cÜ»¥ÚdšgØ%swa nÙ found.\n", 
¡rUUID
.
	`c_¡r
());

801  
çl£
;

802 
	}
}

804 
	gRAIDMªag”
::
	$In™ŸlizeSh­e
(
sh­e
& 
s
, 
¿iddisks
, 
Ëv–
, 
chunk
, 
b™m­_chunk
, * 
b™m­_fe
)

806 
	`mem£t
(&
s
, 0x00, (
sh­e
));

807 
s
.
¿iddisks
 =„aiddisks;

808 
s
.
Ëv–
 =†evel;

809 
s
.
Ïyout
 = 
UnS‘
;

810 
s
.
b™m­_chunk
 = bitmap_chunk;

811 
s
.
chunk
 = chunk;

812 
s
.
assume_ş—n
 = 0;

813 
s
.
b™m­_fe
 = bitmap_file;

814 
	}
}

816 
	gRAIDMªag”
::
	$In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
, 
run¡İ
, 
v”bo£
)

818 
	`mem£t
(&
c
, 0x00, (
cÚ‹xt
));

819 
c
.
fÜû
 = force;

820 
c
.
d–ay
 = 
DEFAULT_BITMAP_DELAY
;

821 
c
.
run¡İ
 =„unstop;

822 
c
.
v”bo£
 = verbose;

823 
c
.
br›f
 = 0;

824 
	}
}

826 
	gRAIDMªag”
::
	$In™ŸlizeMDDevId’t
(
mddev_id’t
& 
id’t
, 
uuid_£t
, cÚ¡ 
uuid
[4], 
b™m­_fd
, * 
b™m­_fe
)

828 
	`mem£t
(&
id’t
, 0x00, (
mddev_id’t
));

829 
id’t
.
uuid_£t
 = uuid_set;

830 
id’t
.
su³r_mšÜ
 = 
UnS‘
;

831 
id’t
.
Ëv–
 = 
UnS‘
;

832 
id’t
.
¿id_disks
 = 
UnS‘
;

833 
id’t
.
¥¬e_disks
 = 
UnS‘
;

834 
id’t
.
b™m­_fd
 = bitmap_fd;

835 
id’t
.
b™m­_fe
 = bitmap_file;

836 ià(
uuid_£t
) {

837 
	`memıy
(
id’t
.
uuid
, uuid, () * 4);

838 
i
 = 0; i < 4; i++) {

839 
id’t
.
uuid
[
i
] = 
	`__be32_to_ıu
(ident.uuid[i]);

842 
	}
}

844 
mddev_dev
* 
	gRAIDMªag”
::
	$In™ŸlizeDevLi¡
(cÚ¡ 
¡ršg
& 
»¶aû
, cÚ¡ sŒšg& 
w™h
)

846 
mddev_dev
* 
devli¡
 = 
NULL
;

847 
mddev_dev
** 
devli¡’d
 = &
devli¡
;

848 
mddev_dev
* 
dv
 = 
NULL
;

850 ià(
»¶aû
.
	`em±y
(è|| 
w™h
.empty())

851  
NULL
;

853 
devli¡
 = 
NULL
;

854 
dv
 = (
mddev_dev
*)
	`m®loc
((mddev_dev));

855 ià(
dv
 =ğ
NULL
) {

856 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

857 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

858  
NULL
;

860 
dv
->
devÇme
 = (*)
»¶aû
.
	`c_¡r
();

861 
dv
->
di¥os™iÚ
 = 'R';

862 
dv
->
wr™emo¡ly
 = 0;

863 
dv
->
u£d
 = 0;

864 
dv
->
Ãxt
 = 
NULL
;

865 *
devli¡’d
 = 
dv
;

866 
devli¡’d
 = &
dv
->
Ãxt
;

868 
dv
 = (
mddev_dev
*)
	`m®loc
((mddev_dev));

869 ià(
dv
 =ğ
NULL
) {

870 
	`F»eDevLi¡
(
devli¡
);

871 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

872 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

873  
NULL
;

875 
dv
->
devÇme
 = (*)
w™h
.
	`c_¡r
();

876 
dv
->
di¥os™iÚ
 = 'w';

877 
dv
->
wr™emo¡ly
 = 0;

878 
dv
->
u£d
 = 0;

879 
dv
->
Ãxt
 = 
NULL
;

880 *
devli¡’d
 = 
dv
;

881 
devli¡’d
 = &
dv
->
Ãxt
;

883  
devli¡
;

884 
	}
}

886 
mddev_dev
* 
	gRAIDMªag”
::
In™ŸlizeDevLi¡
(
veùÜ
<
¡ršg
>& 
devNameLi¡
, 
di¥os™iÚ
)

888 
mddev_dev
* 
	gdevli¡
 = 
NULL
;

889 
mddev_dev
** 
	gdevli¡’d
 = &
devli¡
;

890 
mddev_dev
* 
	gdv
 = 
NULL
;

892 ià(
	gdevNameLi¡
.
em±y
())

893  
	gNULL
;

895 
size_t
 
	gi
 = 0; i < 
	gdevNameLi¡
.
size
(); i ++) {

896 
	gdv
 = (
mddev_dev
*)
m®loc
((mddev_dev));

897 ià(
	gdv
 =ğ
NULL
) {

898 
F»eDevLi¡
(
devli¡
);

899 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

900 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

901  
	gNULL
;

903 
	gdv
->
	gdevÇme
 = (*)
devNameLi¡
[
i
].
c_¡r
();

904 
	gdv
->
	gdi¥os™iÚ
 = 
di¥os™iÚ
;

905 
	gdv
->
	gwr™emo¡ly
 = 0;

906 
	gdv
->
	gu£d
 = 0;

907 
	gdv
->
	gÃxt
 = 
NULL
;

908 *
	gdevli¡’d
 = 
dv
;

909 
	gdevli¡’d
 = &
dv
->
Ãxt
;

912  
	gdevli¡
;

915 
	gRAIDMªag”
::
	$F»eDevLi¡
(
mddev_dev
* 
devli¡
)

917 
mddev_dev
* 
dv
 = 
NULL
;

918 
dv
 = 
devli¡
; dv; dv = dv->
Ãxt
) {

919 
	`ä“
(
dv
);

921 
devli¡
 = 
NULL
;

922 
	}
}

924 
	gRAIDMªag”
::
	$O³nMDDev
(cÚ¡ 
¡ršg
& 
mddev
)

926 
fd
 = 
	`İ’_mddev
((*)
mddev
.
	`c_¡r
(), 1);

927 ià(
fd
 < 0) {

928 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

929 "FaØİ’ MD deviû. %s\n", 
mddev
.
	`c_¡r
());

932  
fd
;

933 
	}
}

935 
¡ršg
 
	gRAIDMªag”
::
	$G’”©eMDDevName
(
num
)

937  
	`¡ršg_fÜm©
("/dev/md%d", 
num
);

938 
	}
}

940 
	gRAIDMªag”
::
	$G’”©eVŞumeName
(
¡ršg
& 
Çme
)

942 
iF»eVŞume
 = 
	`G‘F»eVŞumeNum
();

943 ià(
iF»eVŞume
 < 0) {

944 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

948 
Çme
 = 
	`¡ršg_fÜm©
("/mÁ/VOLUME%d", 
iF»eVŞume
 + 1);

949 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

950 "VŞumName: %s\n", 
Çme
.
	`c_¡r
());

951  
iF»eVŞume
;

952 
	}
}

954 
boŞ
 
	gRAIDMªag”
::
C»©eRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, 
Ëv–
, sŒšg& 
¡rMDName
)

956 
	g»t
 = 
SUCCESS
;

959 
	gä“MD
 = 
G‘F»eMDNum
();

960 ià(
	gä“MD
 < 0) {

961 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

966 
	g»t
 = 
C»©eRAID
(
ä“MD
, 
¡rMDName
, 
vDevLi¡
, 
Ëv–
);

967 ià(
	g»t
 =ğ
SUCCESS
) {

968 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

969 "% ü—‹d sucûssfuÎy.\n", 
¡rMDName
.
c_¡r
());

970  
	gŒue
;

971 } ià(
	g»t
 =ğ
CREATE_MDDEV_INUSE
) {

972 
S‘MDNum
(
ä“MD
);

975 
F»eMDNum
(
ä“MD
);

977 } 
	g»t
 =ğ
CREATE_MDDEV_INUSE
);

979 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

980 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

981  
	gçl£
;

984 
	gRAIDMªag”
::
C»©eRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
)

988 ià(
	gmdnum
 < 0)

989  
	gCREATE_MDNUM_ILLEGAL
;

991 
	gmddev
 = 
G’”©eMDDevName
(
mdnum
);

994 ià(
	gvDevLi¡
.
em±y
())

995  
	gCREATE_RAID_DEVS_NOT_ENOUGH
;

1001 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1002 ià(
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1003 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1004 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
CREATE_MDDEV_INUSE
);

1006  
	gCREATE_MDDEV_INUSE
;

1015 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1016 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1017 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
CREATE_RAID_DEVS_NOT_EXIST_IN_LIST
);

1018  
	gCREATE_RAID_DEVS_NOT_EXIST_IN_LIST
;

1022 
sh­e
 
	gs
;

1023 
In™ŸlizeSh­e
(
s
, 
vDevLi¡
.
size
(), 
Ëv–
, 512);

1026 
cÚ‹xt
 
	gc
;

1027 
In™ŸlizeCÚ‹xt
(
c
);

1033 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
);

1034 ià(
	gdevli¡
 =ğ
NULL
)

1035  
çl£
;

1042 
	g»t
 = 
C»©e
(
NULL
, (*)
mddev
.
c_¡r
(), NULL, NULL, 
vDevLi¡
.
size
(), 
devli¡
, &
s
, &
c
, 
INVALID_SECTORS
);

1043 ià(
	g»t
 !ğ
SUCCESS
) {

1044 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1045 "FaØü—‹ vŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1046  
	g»t
;

1050 
Upd©eRAIDInfo
(
mddev
, 
mdnum
);

1056 
F»eDevLi¡
(
devli¡
);

1057  
	gSUCCESS
;

1060 
	gRAIDMªag”
::
C»©eRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
)

1064 ià(
	gmddev
.
em±y
())

1065  
	gCREATE_MDDEV_UNSET
;

1069 ià(
	gvDevLi¡
.
em±y
())

1070  
	gCREATE_RAID_DEVS_NOT_ENOUGH
;

1076 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1077 ià(
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1078 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1079 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
CREATE_MDDEV_INUSE
);

1081  
	gCREATE_MDDEV_INUSE
;

1090 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1091 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1092 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
CREATE_RAID_DEVS_NOT_EXIST_IN_LIST
);

1093  
	gCREATE_RAID_DEVS_NOT_EXIST_IN_LIST
;

1097 
sh­e
 
	gs
;

1098 
In™ŸlizeSh­e
(
s
, 
vDevLi¡
.
size
(), 
Ëv–
, 512);

1101 
cÚ‹xt
 
	gc
;

1102 
In™ŸlizeCÚ‹xt
(
c
);

1108 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
);

1109 ià(
	gdevli¡
 =ğ
NULL
)

1110  
çl£
;

1117 
	g»t
 = 
C»©e
(
NULL
, (*)
mddev
.
c_¡r
(), NULL, NULL, 
vDevLi¡
.
size
(), 
devli¡
, &
s
, &
c
, 
INVALID_SECTORS
);

1118 ià(
	g»t
 !ğ
SUCCESS
) {

1119 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1120 "FaØü—‹ vŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1121  
	g»t
;

1125 
Upd©eRAIDInfo
(
mddev
);

1131 
F»eDevLi¡
(
devli¡
);

1132  
	gSUCCESS
;

1135 
boŞ
 
	gRAIDMªag”
::
	$As£mbËRAID
(cÚ¡ 
uuid
[4], 
¡ršg
& 
¡rMDName
)

1137 
»t
 = 
SUCCESS
;

1140 
ä“MD
 = 
	`G‘F»eMDNum
();

1141 ià(
ä“MD
 < 0) {

1142 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1144  
çl£
;

1147 
»t
 = 
	`As£mbËRAID
(
ä“MD
, 
¡rMDName
, 
uuid
);

1148 ià(
»t
 =ğ
SUCCESS
) {

1149 * 
p_uuid
 = (*è
uuid
;

1150 
¡ršg
 
	`¡rUUID
("");

1151 
i
 = 0; i < 16; i++) {

1152 
¡rUUID
 +ğ
	`¡ršg_fÜm©
("%02X ", 
p_uuid
[
i
]);

1154 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1155 "%swa as£mbËdØ%s.\n", 
¡rUUID
.
	`c_¡r
(), 
¡rMDName
.c_str());

1156 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1157 "% as£mbËd sucûssfuÎy.\n", 
¡rMDName
.
	`c_¡r
());

1158  
Œue
;

1159 } ià(
»t
 =ğ
ASSEMBLE_MD_ALREADY_ACTIVE
) {

1160  
Œue
;

1161 } ià(
»t
 =ğ
ASSEMBLE_MDDEV_INUSE
) {

1162 
	`S‘MDNum
(
ä“MD
);

1164 } ià(
»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
) {

1165 
	`F»eMDNum
(
ä“MD
);

1167 } 
»t
 =ğ
ASSEMBLE_MDDEV_INUSE
);

1169 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1170 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

1171  
çl£
;

1172 
	}
}

1174 
	gRAIDMªag”
::
	$As£mbËRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4])

1178 ià(
mdnum
 < 0)

1179  
ASSEMBLE_MDNUM_ILLEGAL
;

1181 
mddev
 = 
	`G’”©eMDDevName
(
mdnum
);

1187 ià(
uuid
 =ğ
NULL
)

1188  
ASSEMBLE_INVALID_UUID
;

1194 
RAIDInfo
 
šfo
;

1195 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
);

1196 ià(
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1197 
»t
 = 
ASSEMBLE_MDDEV_INUSE
;

1198 ià(0 =ğ
	`memcmp
(
uuid
, 
šfo
.
m_UUID
, (info.m_UUID))) {

1199 
»t
 = 
ASSEMBLE_MD_ALREADY_ACTIVE
;

1201 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1202 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

1203  
»t
;

1209 
mddev_id’t
 
id’t
;

1210 
	`In™ŸlizeMDDevId’t
(
id’t
, 1, 
uuid
);

1217 
cÚ‹xt
 
c
;

1218 
	`In™ŸlizeCÚ‹xt
(
c
);

1219 
»t
 = 
	`As£mbË
(
NULL
, (*)
mddev
.
	`c_¡r
(), &
id’t
, NULL, &
c
);

1220 ià(
»t
 !ğ
SUCCESS
) {

1221 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1222 "FaØas£mbË vŞum%s: (%d)\n", 
mddev
.
	`c_¡r
(), 
»t
);

1223 iàĞ
»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
)

1224  
»t
;

1230 
	`Upd©eRAIDInfo
(
mddev
, 
mdnum
);

1231  
»t
;

1232 
	}
}

1234 
	gRAIDMªag”
::
	$As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4])

1240 ià(
mddev
.
	`em±y
())

1241  
ASSEMBLE_MDDEV_UNSET
;

1247 ià(
uuid
 =ğ
NULL
)

1248  
ASSEMBLE_INVALID_UUID
;

1254 
RAIDInfo
 
šfo
;

1255 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
);

1256 ià(
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1257 
»t
 = 
ASSEMBLE_MDDEV_INUSE
;

1258 ià(0 =ğ
	`memcmp
(
uuid
, 
šfo
.
m_UUID
, (info.m_UUID))) {

1259 
»t
 = 
ASSEMBLE_MD_ALREADY_ACTIVE
;

1262 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1263 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

1264  
»t
;

1270 
mddev_id’t
 
id’t
;

1271 
	`In™ŸlizeMDDevId’t
(
id’t
, 1, 
uuid
);

1278 
cÚ‹xt
 
c
;

1279 
	`In™ŸlizeCÚ‹xt
(
c
);

1280 
»t
 = 
	`As£mbË
(
NULL
, (*)
mddev
.
	`c_¡r
(), &
id’t
, NULL, &
c
);

1281 ià(
»t
 !ğ
SUCCESS
) {

1282 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1283 "FaØas£mbË vŞum%s: (%d)\n", 
mddev
.
	`c_¡r
(), 
»t
);

1284 iàĞ
»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
)

1285  
»t
;

1291 
	`Upd©eRAIDInfo
(
mddev
);

1292  
»t
;

1293 
	}
}

1295 
boŞ
 
	gRAIDMªag”
::
As£mbËRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, sŒšg& 
¡rMDName
)

1297 
	g»t
 = 
SUCCESS
;

1300 
	gä“MD
 = 
G‘F»eMDNum
();

1301 ià(
	gä“MD
 < 0) {

1302 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1304  
	gçl£
;

1307 
	g»t
 = 
As£mbËRAID
(
ä“MD
, 
¡rMDName
, 
vDevLi¡
);

1308 ià(
	g»t
 =ğ
SUCCESS
) {

1309 
¡ršg
 
¡rDevLi¡
("");

1310 
size_t
 
	gi
 = 0; i < 
	gvDevLi¡
.
size
(); i++) {

1311 
	g¡rDevLi¡
 +ğ
vDevLi¡
[
i
];

1313 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1314 "%swa as£mbËdØ%s.\n", 
¡rDevLi¡
.
c_¡r
(), 
¡rMDName
.c_str());

1315 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1316 "% as£mbËd sucûssfuÎy.\n", 
¡rMDName
.
c_¡r
());

1317  
	gŒue
;

1318 } ià(
	g»t
 =ğ
ASSEMBLE_MDDEV_INUSE
) {

1319 
S‘MDNum
(
ä“MD
);

1321 } ià(
	g»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
) {

1322 
F»eMDNum
(
ä“MD
);

1324 } 
	g»t
 =ğ
ASSEMBLE_MDDEV_INUSE
);

1326 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1327 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

1328  
	gçl£
;

1331 
	gRAIDMªag”
::
As£mbËRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1337 ià(
	gmdnum
 < 0)

1338  
	gASSEMBLE_MDNUM_ILLEGAL
;

1340 
	gmddev
 = 
G’”©eMDDevName
(
mdnum
);

1346 ià(
	gvDevLi¡
.
em±y
())

1347  
	gASSEMBLE_NO_DEVS_FOR_MD
;

1357 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1358 ià(
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1359 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1360 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
ASSEMBLE_MDDEV_INUSE
);

1362  
	gASSEMBLE_MDDEV_INUSE
;

1371 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1372 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1373 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
ASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
);

1374  
	gASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
;

1380 
mddev_id’t
 
	gid’t
;

1381 
In™ŸlizeMDDevId’t
(
id’t
, 0, 
NULL
);

1387 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
);

1388 if(
	gdevli¡
 =ğ
NULL
) {

1389  
ASSEMBLE_INITIALIZE_DEV_LIST_FAIL
;

1397 
cÚ‹xt
 
	gc
;

1398 
In™ŸlizeCÚ‹xt
(
c
);

1399 
	g»t
 = 
As£mbË
(
NULL
, (*)
mddev
.
c_¡r
(), &
id’t
, 
devli¡
, &
c
);

1400 
F»eDevLi¡
(
devli¡
);

1401 ià(
	g»t
 != 0) {

1402 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1403 "FaØas£mbË vŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1404 iàĞ
	g»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
)

1405  
»t
;

1415 
Upd©eRAIDInfo
(
mddev
, 
mdnum
);

1416  
	g»t
;

1419 
	gRAIDMªag”
::
As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1425 ià(
	gmddev
.
em±y
())

1426  
	gASSEMBLE_MDDEV_UNSET
;

1432 ià(
	gvDevLi¡
.
em±y
())

1433  
	gASSEMBLE_NO_DEVS_FOR_MD
;

1443 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1444 ià(
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1445 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1446 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
ASSEMBLE_MDDEV_INUSE
);

1448  
	gASSEMBLE_MDDEV_INUSE
;

1457 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1458 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1459 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
ASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
);

1460  
	gASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
;

1466 
mddev_id’t
 
	gid’t
;

1467 
In™ŸlizeMDDevId’t
(
id’t
, 0, 
NULL
);

1473 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
);

1474 if(
	gdevli¡
 =ğ
NULL
) {

1475  
ASSEMBLE_INITIALIZE_DEV_LIST_FAIL
;

1483 
cÚ‹xt
 
	gc
;

1484 
In™ŸlizeCÚ‹xt
(
c
);

1485 
	g»t
 = 
As£mbË
(
NULL
, (*)
mddev
.
c_¡r
(), &
id’t
, 
devli¡
, &
c
);

1486 
F»eDevLi¡
(
devli¡
);

1487 ià(
	g»t
 != 0) {

1488 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1489 "FaØas£mbË vŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1490 iàĞ
	g»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
)

1491  
»t
;

1501 
Upd©eRAIDInfo
(
mddev
);

1502  
	g»t
;

1505 
boŞ
 
	gRAIDMªag”
::
MªageRAIDSubdevs
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
İ”©iÚ
)

1511 ià(
	gmddev
.
em±y
())

1512  
	gçl£
;

1518 ià(
	gvDevLi¡
.
em±y
())

1519  
	gçl£
;

1525 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1526 ià(
	g™
 =ğ
m_vRAIDInfoLi¡
.
’d
()) {

1527 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1528 "% dÛ¢'ˆexi¡.\n", 
mddev
.
c_¡r
());

1529  
	gçl£
;

1538 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1539 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1540 "Somdisk dÛ¢'ˆb–ÚgØ%s.\n", 
mddev
.
c_¡r
());

1541  
	gçl£
;

1549 
	gfd
 = 
O³nMDDev
(
mddev
);

1550 ià(
	gfd
 < 0)

1551  
	gçl£
;

1562 
mddev_dev
* 
	gdevli¡
 = 
NULL
;

1563 
	gİ”©iÚ
) {

1565 ià(
vDevLi¡
.
size
() != 2) {

1566 
şo£
(
fd
);

1567 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1569  
	gçl£
;

1572 ià(
	gNULL
 =ğ(
devli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
[0], vDevList[1]))) {

1573  
	gçl£
;

1577 ià(
NULL
 =ğ(
devli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
, 
İ”©iÚ
))) {

1578  
	gçl£
;

1589 
cÚ‹xt
 
	gc
;

1590 
In™ŸlizeCÚ‹xt
(
c
);

1591 
	g»t
 = 
Mªage_subdevs
((*)
mddev
.
c_¡r
(), 
fd
, 
devli¡
, 
c
.
v”bo£
, 0, 
NULL
, c.
fÜû
);

1592 
şo£
(
fd
);

1593 
F»eDevLi¡
(
devli¡
);

1602 ià(
	g»t
 != 0) {

1603 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1604 "FaØmªagvŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1605  
	gçl£
;

1608 
Upd©eRAIDInfo
(
mddev
);

1609  
	gSUCCESS
;

1612 
boŞ
 
	gRAIDMªag”
::
RemoveMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1614  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'r');

1617 
boŞ
 
	gRAIDMªag”
::
M¬kFauÉyMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1619  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'f');

1622 
boŞ
 
	gRAIDMªag”
::
AddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1624  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'a');

1627 
boŞ
 
	gRAIDMªag”
::
R—ddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1629  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'A');

1632 
boŞ
 
	gRAIDMªag”
::
	$R•ÏûMDDisk
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ sŒšg& 
»¶aû
, cÚ¡ sŒšg& 
w™h
)

1634 ià(
»¶aû
.
	`em±y
(è|| 
w™h
.empty())

1635  
çl£
;

1637 
veùÜ
<
¡ršg
> 
vDevLi¡
;

1638 
vDevLi¡
.
	`push_back
(
»¶aû
);

1639 
vDevLi¡
.
	`push_back
(
w™h
);

1641  
	`MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'R');

1642 
	}
}

1644 
boŞ
 
	gRAIDMªag”
::
	$StİRAID
(cÚ¡ 
¡ršg
& 
mddev
)

1650 ià(
mddev
.
	`em±y
())

1651  
çl£
;

1658 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
);

1659 ià(
™
 =ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1660 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_WARNING
, 
LOG_LABEL
,

1661 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1662  
Œue
;

1666 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
, 
´og»ss
 = -1;

1667 ià(
	`G‘FÜm©Prog»ss
(
mddev
, 
¡©
, 
´og»ss
)) {

1668 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1669 "FaØ¡İ vŞum%s. Iˆi fÜm©tšg. [%d/%d%%]\n", 
mddev
.
	`c_¡r
(), 
¡©
, 
´og»ss
);

1670  
çl£
;

1673 
	`UnmouÁ
(
mddev
);

1679 
fd
 = 
	`O³nMDDev
(
mddev
);

1680 ià(
fd
 < 0)

1681  
çl£
;

1689 
cÚ‹xt
 
c
;

1690 
»t
 = 
SUCCESS
;

1692 
	`In™ŸlizeCÚ‹xt
(
c
);

1693 
»t
 = 
	`Mªage_¡İ
((*)
mddev
.
	`c_¡r
(), 
fd
, 
c
.
v”bo£
, 0);

1694 
	`şo£
(
fd
);

1696 ià(
»t
 !ğ
SUCCESS
) {

1697 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1698 "FaØ¡İ vŞum%s: %d\n", 
mddev
.
	`c_¡r
(), 
»t
);

1699  
çl£
;

1705 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

1707 
size_t
 
i
 = 0; i < 
™
->
m_vDiskLi¡
.
	`size
(); i++) {

1708 
Cr™iÿlSeùiÚLock
 
	`csSymLškTabË
(&
m_csSymLškTabË
);

1709 
m_m­SymLškTabË
[
™
->
m_vDiskLi¡
[
i
].
m_¡rDevName
].
m_¡rMDDev
 = "";

1712 
	`F»eMDNum
(
™
->
m_iMDNum
);

1713 
m_vRAIDInfoLi¡
.
	`”a£
(
™
);

1714  
Œue
;

1715 
	}
}

1717 
boŞ
 
	gRAIDMªag”
::
	$D–‘eRAID
(cÚ¡ 
¡ršg
& 
mddev
)

1724 
RAIDInfo
 
šfo
;

1725 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
);

1726 ià(
™
 =ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1727 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1728 "D–‘vŞum%s\n", 
mddev
.
	`c_¡r
());

1729  
Œue
;

1732 ià(!
	`StİRAID
(
mddev
))

1733  
çl£
;

1739 ià(
mddev
.
	`em±y
())

1740  
çl£
;

1747 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
);

1748 ià(
™
 =ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1749 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1750 "D–‘vŞum%s\n", 
mddev
.
	`c_¡r
());

1751  
Œue
;

1755 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
, 
´og»ss
 = -1;

1756 ià(
	`G‘FÜm©Prog»ss
(
mddev
, 
¡©
, 
´og»ss
)) {

1757 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1758 "FaØd–‘vŞum%s. Iˆi fÜm©tšg. [%d/%d%%]\n", 
mddev
.
	`c_¡r
(), 
¡©
, 
´og»ss
);

1759  
çl£
;

1762 
	`UnmouÁ
(
mddev
);

1768 
fd
 = 
	`O³nMDDev
(
mddev
);

1769 ià(
fd
 < 0)

1770  
çl£
;

1778 
cÚ‹xt
 
c
;

1779 
»t
 = 
SUCCESS
;

1781 
	`In™ŸlizeCÚ‹xt
(
c
);

1782 
»t
 = 
	`Mªage_¡İ
((*)
mddev
.
	`c_¡r
(), 
fd
, 
c
.
v”bo£
, 0);

1783 
	`şo£
(
fd
);

1785 ià(
»t
 !ğ
SUCCESS
) {

1786 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1787 "FaØ¡İ vŞum%s: %d\n", 
mddev
.
	`c_¡r
(), 
»t
);

1788  
çl£
;

1793 
RAIDInfo
 
šfo
 = *
™
;

1794 #ifdeà
NUUO


1795 
m_csRAIDInfoLi¡
.
	`Lock
();

1798 
	`F»eMDNum
(
šfo
.
m_iMDNum
);

1799 
m_vRAIDInfoLi¡
.
	`”a£
(
™
);

1800 #ifdeà
NUUO


1801 
m_csRAIDInfoLi¡
.
	`UÆock
();

1810 
cÚ‹xt
 
c
;

1811 
»t
 = 
SUCCESS
;

1813 
	`In™ŸlizeCÚ‹xt
(
c
);

1814 
size_t
 
i
 = 0; i < 
šfo
.
m_vDiskLi¡
.
	`size
(); i++) {

1815 
»t
 = 
	`Kl
((*)
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
(), 
NULL
, 
c
.
fÜû
, c.
v”bo£
, 0);

1816 ià(
»t
 !ğ
SUCCESS
) {

1817 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1818 "KÈE¼Ü Cod%s: %d\n", 
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
(), 
»t
);

1826 
examše_»suÉ
 
»suÉ
;

1827 
»t
 = 
SUCCESS
;

1830 ià(
	`IsDiskHaveMDSu³rBlock
(
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
(), 
»suÉ
, 
»t
)) {

1831 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_WARNING
, 
LOG_LABEL
,

1833 
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
(), 
»t
);

1835 
¡ršg
 
cmd
 = 
	`¡ršg_fÜm©
("dd if=/dev/z”Øof=% bs=512 couÁ=1", 
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
());

1836 
	`sy¡em
(
cmd
.
	`c_¡r
());

1841 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_WARNING
, 
LOG_LABEL
,

1842 "%s' su³rblock i ş—»d\n", 
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
());

1845  
Œue
;

1846 
	}
}

1848 
boŞ
 
	gRAIDMªag”
::
	$G‘RAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
RAIDInfo
& 
šfo
)

1854 ià(
mddev
.
	`em±y
())

1855  
çl£
;

1863 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

1864 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

1865 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1866 ià(*
™
 =ğ
mddev
) {

1870 
™
++;

1873 ià(
™
 =ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1874 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1875 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1876  
çl£
;

1879 
size_t
 
i
 = 0; i < 
™
->
m_vDiskLi¡
.
	`size
(); i++) {

1880 
Cr™iÿlSeùiÚLock
 
	`csSymLškTabË
(&
m_csSymLškTabË
);

1881 
™
->
m_vDiskLi¡
[
i
].
m_miscInfo
 = 
m_m­SymLškTabË
[™->m_vDiskLi¡[i].
m_¡rDevName
];

1883 
šfo
 = *
™
;

1884  
Œue
;

1885 
	}
}

1887 
	gRAIDMªag”
::
G‘RAIDInfo
(
veùÜ
<
RAIDInfo
>& 
li¡
)

1889 
li¡
.
ş—r
();

1891 
Cr™iÿlSeùiÚLock
 
cs
(&
m_csRAIDInfoLi¡
);

1892 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
begš
();

1893 
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1894 
size_t
 
i
 = 0; 
	gi
 < 
	g™
->
	gm_vDiskLi¡
.
size
(); i++) {

1895 
Cr™iÿlSeùiÚLock
 
csSymLškTabË
(&
m_csSymLškTabË
);

1896 
	g™
->
	gm_vDiskLi¡
[
i
].
	gm_miscInfo
 = 
m_m­SymLškTabË
[
™
->
m_vDiskLi¡
[i].
m_¡rDevName
];

1899 
	gli¡
.
push_back
(*
™
);

1900 
	g™
++;

1904 
	gRAIDMªag”
::
G‘DisksInfo
(
veùÜ
<
RAIDDiskInfo
> &
li¡
)

1906 
li¡
.
ş—r
();

1908 
Cr™iÿlSeùiÚLock
 
cs
(&
m_csRAIDDiskLi¡
);

1909 
	gveùÜ
<
	gRAIDDiskInfo
>::
™”©Ü
 
™
 = 
m_vRAIDDiskLi¡
.
begš
();

1910 
	g™
 !ğ
m_vRAIDDiskLi¡
.
’d
()) {

1911 
RAIDDiskInfo
 
šfo
 = *
™
;

1912 
Cr™iÿlSeùiÚLock
 
csSymLškTabË
(&
m_csSymLškTabË
);

1913 
	gšfo
.
	gm_miscInfo
 = 
m_m­SymLškTabË
[
™
->
m_¡rDevName
];

1914 
	gli¡
.
push_back
(
šfo
);

1915 
	g™
++;

1919 
boŞ
 
	gRAIDMªag”
::
	$G‘DisksInfo
(cÚ¡ 
¡ršg
& 
dev
, 
RAIDDiskInfo
 &
šfo
)

1921 ià(
dev
.
	`em±y
()) {

1922  
çl£
;

1925 
¡ršg
 
¡rDevNode
 = 
	`G‘DeviûNodeBySymLšk
(
dev
);

1927 
Cr™iÿlSeùiÚLock
 
	`csRAIDDiskLi¡
(&
m_csRAIDDiskLi¡
);

1928 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™
 = 
m_vRAIDDiskLi¡
.
	`begš
();

1929 
™
 !ğ
m_vRAIDDiskLi¡
.
	`’d
()) {

1930 ià(*
™
 =ğ
¡rDevNode
) {

1931 
šfo
 = *
™
;

1932 
Cr™iÿlSeùiÚLock
 
	`csSymLškTabË
(&
m_csSymLškTabË
);

1933 
šfo
.
m_miscInfo
 = 
m_m­SymLškTabË
[
¡rDevNode
];

1934  
Œue
;

1936 
™
++;

1939  
çl£
;

1940 
	}
}

1942 
boŞ
 
	gRAIDMªag”
::
	$FÜm©
(cÚ¡ 
¡ršg
& 
mddev
)

1944 ià(
mddev
.
	`em±y
()) {

1945 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1946 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

1947  
çl£
;

1950 
RAIDInfo
 
šfo
;

1951 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1952 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1953 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1954  
çl£
;

1957 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1958 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1960 
mddev
.
	`c_¡r
());

1961  
çl£
;

1964 
num
 = 
	`G‘F»eVŞumeNum
();

1965 ià(
num
 < 0) {

1966 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1968  
çl£
;

1971 
šfo
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

1972 #ifdeà
NUUO


1973 
šfo
.
m_fsMgr
->
	`C»©eTh»ad
();

1976  
Œue
;

1977 
	}
}

1979 
boŞ
 
	gRAIDMªag”
::
	$MouÁ
(cÚ¡ 
¡ršg
& 
mddev
)

1981 ià(
mddev
.
	`em±y
()) {

1982 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1983 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

1984  
çl£
;

1987 
RAIDInfo
 
šfo
;

1988 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1989 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1990 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1991  
çl£
;

1994 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1995 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1997 
mddev
.
	`c_¡r
());

1998  
çl£
;

2001 ià(!
šfo
.
m_fsMgr
->
	`IsFÜm©ed
()) {

2002 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2004 
mddev
.
	`c_¡r
());

2005  
çl£
;

2008 
num
 = -1;

2009 ià(!
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

2010 
¡ršg
 
¡rMouÁPošt
;

2011 ià(
num
 < 0) {

2012 
num
 = 
	`G‘F»eVŞumeNum
();

2013 ià(
num
 < 0) {

2014 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2016  
çl£
;

2018 
šfo
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

2021 
šfo
.
m_fsMgr
->
	`IsMouÁed
(
¡rMouÁPošt
);

2022 ià(!
šfo
.
m_fsMgr
->
	`MouÁ
(
¡rMouÁPošt
)) {

2023 
	`F»eVŞumeNum
(
num
);

2024  
çl£
;

2029 
šfo
.
m_fsMgr
->
	`G’”©eUUIDFe
();

2030 
šfo
.
m_fsMgr
->
	`C»©eDeçuÉFŞd”s
();

2032  
Œue
;

2033 
	}
}

2035 
boŞ
 
	gRAIDMªag”
::
	$UnmouÁ
(cÚ¡ 
¡ršg
& 
mddev
)

2037 ià(
mddev
.
	`em±y
()) {

2038 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2039 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

2040  
çl£
;

2043 
RAIDInfo
 
šfo
;

2044 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

2045 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

2046 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

2047  
çl£
;

2050 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

2051 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2053 
mddev
.
	`c_¡r
());

2054  
çl£
;

2057 
num
 = -1;

2058 ià(
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

2059 ià(
šfo
.
m_fsMgr
->
	`UnmouÁ
()) {

2060 
	`F»eVŞumeNum
(
num
);

2061  
Œue
;

2064 
	`F»eVŞumeNum
(
num
);

2065  
çl£
;

2069  
Œue
;

2070 
	}
}

2072 
boŞ
 
	gRAIDMªag”
::
	$G‘FÜm©Prog»ss
(cÚ¡ 
¡ršg
& 
mddev
,

2073 & 
¡©
, & 
´og»ss
)

2075 ià(
mddev
.
	`em±y
()) {

2076 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2077 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

2078  
çl£
;

2081 
RAIDInfo
 
šfo
;

2082 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

2083 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

2084 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

2085  
çl£
;

2088 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

2089 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2091 
mddev
.
	`c_¡r
());

2092  
çl£
;

2095  
šfo
.
m_fsMgr
->
	`IsFÜm©šg
(
´og»ss
, 
¡©
);

2096 
	}
}

2098 
boŞ
 
	gRAIDMªag”
::
	$IsMouÁed
(cÚ¡ 
¡ršg
& 
mddev
, &
num
)

2100 ià(
mddev
.
	`em±y
()) {

2101 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2102 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

2103  
çl£
;

2106 
RAIDInfo
 
šfo
;

2107 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

2108 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

2109 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

2110  
çl£
;

2113 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

2114 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2116 
mddev
.
	`c_¡r
());

2117  
çl£
;

2120  
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
);

2121 
	}
}

2123 
boŞ
 
	gRAIDMªag”
::
	$IsFÜm©ed
(cÚ¡ 
¡ršg
& 
mddev
)

2125 ià(
mddev
.
	`em±y
()) {

2126 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2127 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

2128  
çl£
;

2131 
RAIDInfo
 
šfo
;

2132 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

2133 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

2134 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

2135  
çl£
;

2138 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

2139 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2141 
mddev
.
	`c_¡r
());

2142  
çl£
;

2145  
šfo
.
m_fsMgr
->
	`IsFÜm©ed
();

2146 
	}
}

2148 
	gRAIDMªag”
::
	$Dump
()

2150 
	`´štf
("Used MD Number: ");

2151 
i
 = 0; i < 128; i ++)

2152 ià(
m_bU£dMD
[
i
])

2153 
	`´štf
("%d ", 
i
);

2154 
	`´štf
("\n");

2155 
	`´štf
("Used Volume Number: ");

2156 
i
 = 0; i < 128; i ++)

2157 ià(
m_bU£dVŞume
[
i
])

2158 
	`´štf
("%d ", 
i
 + 1);

2159 
	`´štf
("\n");

2160 
size_t
 
i
 = 0; i < 
m_vRAIDDiskLi¡
.
	`size
(); i++) {

2161 
m_vRAIDDiskLi¡
[
i
].
	`Dump
();

2163 
	}
}

2165 
¡ršg
 
	gRAIDMªag”
::
	$G‘DeviûNodeBySymLšk
(cÚ¡ 
¡ršg
& 
symlšk
)

2168 
¡©
 
s
;

2169 ià(
	`l¡©
(
symlšk
.
	`c_¡r
(), &
s
) >= 0) {

2170 ià(
	`S_ISLNK
(
s
.
¡_mode
) == 1) {

2171 
buf
[128];

2172 
Ën
 = 0;

2173 ià((
Ën
 = 
	`»adlšk
(
symlšk
.
	`c_¡r
(), 
buf
, (buf) - 1)) >= 0) {

2174 
¡ršg
 
¡rDevNode
 = "/dev/";

2175 
buf
[
Ën
] = '\0';

2176 
¡rDevNode
 +ğ
buf
;

2177  
¡rDevNode
;

2182  
symlšk
;

2183 
	}
}

	@RAIDManager.cpp

1 
	~"RAIDMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/fe.h
"

5 
	~"commÚ/¡ršg.h
"

6 
	~"commÚ/dœeùÜy_Œav”£.h
"

9 
	#LOG_LABEL
 "RAIDMªag”"

	)

11 
	gRAIDMªag”
::
	$RAIDMªag”
()

13 
i
 = 0; i < 128; i++)

14 
m_bU£dMD
[
i
] = 
çl£
;

15 
i
 = 0; i < 128; i++)

16 
m_bU£dVŞume
[
i
] = 
çl£
;

18 #ifdeà
NUUO


19 
DœeùÜyT¿v”£
 
	`dt
("/dev");

24 
dt
.
	`Next
()) {

25 ià(
dt
.
	`G‘P©hName
().
	`fšd
("/dev/md"è!ğ
¡ršg
::
Åos
) {

26 ià(
	`CheckBlockDeviû
(
dt
.
	`G‘P©hName
())) {

27 
num
 = 0;

28 
»t
 = 
	`ssÿnf
(
dt
.
	`G‘P©hName
().
	`c_¡r
(), "/dev/md%d", &
num
);

29 ià(
»t
 < 1 ||„‘ =ğ
EOF
 || 
num
 > 127 ||‚um < 0)

36 ià(
	`Upd©eRAIDInfo
(
dt
.
	`G‘P©hName
(), 
num
)) {

37 
m_bU£dMD
[
num
] = 
Œue
;

40 
vŞumeNum
;

41 ià(
	`IsFÜm©ed
(
dt
.
	`G‘P©hName
())) {

42 ià(
	`IsMouÁed
(
dt
.
	`G‘P©hName
(), 
vŞumeNum
)) {

43 
m_bU£dVŞume
[
vŞumeNum
] = 
Œue
;

45 
	`MouÁ
(
dt
.
	`G‘P©hName
());

51 
dt
.
	`Re£t
();

63 
dt
.
	`Next
()) {

64 ià(
dt
.
	`G‘FÏgs
(è& 
DœeùÜyT¿v”£
::
FLAG_SYMBOLIC
) {

65 ià(
dt
.
	`G‘P©hName
().
	`fšd
("/dev/nuuo_sata") !=

66 
¡ršg
::
Åos
) {

67 ià(
dt
.
	`G‘P©hName
() != "/dev/nuuo_satadom") {

68 
	`AddDiskSymLšk
(
dt
.
	`G‘P©hName
(), 
DISK_TYPE_SATA
);

69 
	`AddDisk
(
dt
.
	`G‘P©hName
());

71 } ià(
dt
.
	`G‘P©hName
().
	`fšd
("/dev/nuuo_e§"è!ğ
¡ršg
::
Åos
) {

72 
	`AddDiskSymLšk
(
dt
.
	`G‘P©hName
(), 
DISK_TYPE_ESATA
);

73 
	`AddDisk
(
dt
.
	`G‘P©hName
());

74 } ià(
dt
.
	`G‘P©hName
().
	`fšd
("/dev/nuuo_iscsi"è!ğ
¡ršg
::
Åos
) {

75 
	`AddDiskSymLšk
(
dt
.
	`G‘P©hName
(), 
DISK_TYPE_ISCSI
);

76 
	`AddDisk
(
dt
.
	`G‘P©hName
());

80 
dt
.
	`Clo£
();

82 
	}
}

84 
	gRAIDMªag”
::~
	$RAIDMªag”
()

87 
	}
}

89 
RAIDMªag”
::
	$G‘F»eMDNum
()

91 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

92 
i
 = 0 ; i < 128; i++) {

93 ià(!
m_bU£dMD
[
i
]) {

94 
m_bU£dMD
[
i
] = 
Œue
;

95  
i
;

100 
	}
}

102 
	gRAIDMªag”
::
	$F»eMDNum
(
n
)

104 ià(
n
 < 0 ||‚ > 127)

107 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

108 
m_bU£dMD
[
n
] = 
çl£
;

109 
	}
}

111 
	gRAIDMªag”
::
	$S‘MDNum
(
n
)

113 ià(
n
 < 0 ||‚ > 127)

116 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

117 
m_bU£dMD
[
n
] = 
Œue
;

118 
	}
}

120 
	gRAIDMªag”
::
	$G‘F»eVŞumeNum
()

122 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

123 
i
 = 0 ; i < 128; i++) {

124 ià(!
m_bU£dVŞume
[
i
]) {

125 
m_bU£dVŞume
[
i
] = 
Œue
;

126  
i
;

131 
	}
}

133 
	gRAIDMªag”
::
	$F»eVŞumeNum
(
n
)

135 ià(
n
 < 0 ||‚ > 127)

138 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

139 
m_bU£dVŞume
[
n
] = 
çl£
;

140 
	}
}

142 
	gRAIDMªag”
::
	$S‘VŞumeNum
(
n
)

144 ià(
n
 < 0 ||‚ > 127)

147 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

148 
m_bU£dVŞume
[
n
] = 
Œue
;

149 
	}
}

151 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
RAIDMªag”
::
	$IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
, 
RAIDInfo
& 
šfo
)

153 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

154 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

155 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

156 ià(*
™
 =ğ
mddev
) {

157 
šfo
 = *
™
;

161 
™
 ++;

164  
™
;

165 
	}
}

167 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
RAIDMªag”
::
	$IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
)

169 
RAIDInfo
 
šfo
;

170  
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
);

171 
	}
}

173 
boŞ
 
	gRAIDMªag”
::
	$IsDiskExi¡InRAIDDiskLi¡
(cÚ¡ 
¡ršg
& 
dev
)

175 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDDiskLi¡
);

176 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™_disk
 = 
m_vRAIDDiskLi¡
.
	`begš
();

177 
™_disk
 !ğ
m_vRAIDDiskLi¡
.
	`’d
()) {

181 
¡ršg
 
¡rDevNode
 = 
	`G‘DeviûNodeBySymLšk
(
dev
);

182 ià(*
™_disk
 =ğ
¡rDevNode
) {

183  
Œue
;

185 
™_disk
++;

188  
çl£
;

189 
	}
}

191 
boŞ
 
	gRAIDMªag”
::
IsDiskExi¡InRAIDDiskLi¡
(
veùÜ
<
¡ršg
>& 
vDevLi¡
)

193 
veùÜ
<
¡ršg
>::
™”©Ü
 
™_devli¡
 = 
vDevLi¡
.
begš
();

194 
	g™_devli¡
 !ğ
vDevLi¡
.
’d
()) {

195 if(!
IsDiskExi¡InRAIDDiskLi¡
(*
™_devli¡
)) {

196  
çl£
;

199 
	g™_devli¡
++;

202  
	gŒue
;

205 
boŞ
 
	gRAIDMªag”
::
	$IsDiskHaveMDSu³rBlock
(cÚ¡ 
¡ršg
& 
dev
, 
examše_»suÉ
 &
»suÉ
, &
”r
)

207 
veùÜ
<
¡ršg
> 
vDevLi¡
;

208 
mddev_dev
* 
devli¡
 = 
NULL
;

209 
cÚ‹xt
 
c
;

211 
vDevLi¡
.
	`push_back
(
dev
);

212 ià(
NULL
 =ğ(
devli¡
 = 
	`In™ŸlizeDevLi¡
(
vDevLi¡
))) {

213 
”r
 = 
EXAMINE_MEM_ALLOC_FAIL
;

214  
çl£
;

217 
	`In™ŸlizeCÚ‹xt
(
c
);

218 
”r
 = 
	`Examše_ToResuÉ
(
devli¡
, &
c
, 
NULL
, &
»suÉ
);

219 
	`F»eDevLi¡
(
devli¡
);

221  !(
”r
 =ğ
EXAMINE_NO_MD_SUPERBLOCK
);

222 
	}
}

224 
boŞ
 
	gRAIDMªag”
::
	$AddDiskSymLšk
(cÚ¡ 
¡ršg
& 
symlšk
, 
eDiskTy³
 
ty³
)

226 ià(
symlšk
.
	`em±y
())

227  
çl£
;

229 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csSymLškTabË
);

231 
¡ršg
 
¡rDevNode
 = 
	`G‘DeviûNodeBySymLšk
(
symlšk
);

232 
MiscDiskInfo
 
	`šfo
(
symlšk
, 
ty³
);

233 
šfo
.
	`Dump
();

234 
m_m­SymLškTabË
[
¡rDevNode
] = 
šfo
;

235  
Œue
;

236 
	}
}

238 
boŞ
 
	gRAIDMªag”
::
	$RemoveDiskSymLšk
(cÚ¡ 
¡ršg
& 
symlšk
)

240 ià(
symlšk
.
	`em±y
())

241  
çl£
;

243 
¡ršg
 
¡rDevNode
 = 
	`G‘DeviûNodeBySymLšk
(
symlšk
);

245 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csSymLškTabË
);

247 
m­
<
¡ršg
, 
MiscDiskInfo
>::
™”©Ü
 
™
 = 
m_m­SymLškTabË
.
	`fšd
(
¡rDevNode
);

248 ià(
™
 !ğ
m_m­SymLškTabË
.
	`’d
())

249 
m_m­SymLškTabË
.
	`”a£
(
™
);

251  
Œue
;

252 
	}
}

254 
boŞ
 
	gRAIDMªag”
::
	$AddDisk
(cÚ¡ 
¡ršg
& 
dev
)

257 ià(
dev
.
	`em±y
())

258  
çl£
;

263 ià(!
	`CheckBlockDeviû
(
dev
)) {

264 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

265 "% i nÙ‡ block deviû.\n", 
dev
.
	`c_¡r
());

266  
çl£
;

277 
examše_»suÉ
 
»suÉ
;

278 
»t
 = 
SUCCESS
;

279 
RAIDDiskInfo
 
šfo
;

280 
boŞ
 
bExi¡
 = 
	`IsDiskExi¡InRAIDDiskLi¡
(
dev
);

282 
šfo
.
m_bHasMDSB
 = 
	`IsDiskHaveMDSu³rBlock
(
dev
, 
»suÉ
, 
»t
);

283 
šfo
.
m_¡rDevName
 = 
	`G‘DeviûNodeBySymLšk
(
dev
);

284 
šfo
.
	`S‘HDDV’dÜInfom©iÚ
();

285 
šfo
.
m_iRaidDiskNum
 = 
»suÉ
.
uRaidDiskNum
;

286 
	`memıy
(
šfo
.
m_RaidUUID
, 
»suÉ
.
¬¿yUUID
, () * 4);

289 ià(!
bExi¡
) {

290 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDDiskLi¡
);

291 
m_vRAIDDiskLi¡
.
	`push_back
(
šfo
);

292 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

293 "% added sucûssfuÎy .\n", 
dev
.
	`c_¡r
());

298 ià(!
šfo
.
m_bHasMDSB
) {

299 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

300 "% ha nØMD su³rblock .\n", 
dev
.
	`c_¡r
());

301  
Œue
;

302 } ià(
»t
 > 0) {

303 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

304 "[%d] ExamšE¼Ü Cod%s: (%d)\n", 
__LINE__
,

305 
dev
.
	`c_¡r
(), 
»t
);

306  
çl£
;

316 
m_csRAIDInfoLi¡
.
	`Lock
();

318 
¡ršg
 
mddev
;

319 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
¿id_™
 = 
	`S—rchDiskB–Úg2RAID
(
šfo
);

320 ià(
¿id_™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

321 
veùÜ
<
¡ršg
> 
vDevLi¡
;

322 
vDevLi¡
.
	`push_back
(
dev
);

324 ià(
šfo
.
m_iS‹
 & (1 << 
MD_DISK_ACTIVE
)) {

327 
»t
 = 
	`R—ddMDDisks
(
¿id_™
->
m_¡rDevNodeName
, 
vDevLi¡
);

328 ià(
»t
 !ğ
SUCCESS
) {

329 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

331 
__LINE__
,

332 
¿id_™
->
m_¡rDevNodeName
.
	`c_¡r
(), 
»t
);

338 
m_csRAIDInfoLi¡
.
	`UÆock
();

345 
m_csRAIDInfoLi¡
.
	`UÆock
();

350 
couÁ”
 = 1;

351 
m_csRAIDDiskLi¡
.
	`Lock
();

352 
size_t
 
i
 = 0; i < 
m_vRAIDDiskLi¡
.
	`size
(); i++) {

353 ià(
šfo
.
m_¡rDevName
 =ğ
m_vRAIDDiskLi¡
[
i
].m_strDevName)

357 ià(0 =ğ
	`memcmp
(
šfo
.
m_RaidUUID
, 
m_vRAIDDiskLi¡
[
i
].m_RaidUUID, () * 4))

358 
couÁ”
++;

360 
m_csRAIDDiskLi¡
.
	`UÆock
();

362 ià(
couÁ”
 >ğ
šfo
.
m_iRaidDiskNum
) {

363 ià(
	`As£mbËRAID
(
šfo
.
m_RaidUUID
, 
mddev
)) {

368 
num
 = -1;

369 ià(
	`IsFÜm©ed
(
mddev
è&& !
	`IsMouÁed
(mddev, 
num
))

370 
	`MouÁ
(
mddev
);

371  
Œue
;

377 
	`Upd©eRAIDInfo
(
mddev
);

378  
Œue
;

379 
	}
}

381 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
RAIDMªag”
::
	$S—rchDiskB–Úg2RAID
(
RAIDDiskInfo
& 
šfo
)

384 ià(
šfo
.
m_¡rDevName
.
	`em±y
())

385  
m_vRAIDInfoLi¡
.
	`’d
();

396 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

397 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

398 ià(0 !ğ
	`memcmp
(
™
->
m_UUID
, 
šfo
.
m_RaidUUID
, (info.m_RaidUUID))) {

399 
™
 ++;

402 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™_disk
 = 
™
->
m_vDiskLi¡
.
	`begš
();

403 
™_disk
 !ğ
™
->
m_vDiskLi¡
.
	`’d
()) {

404 ià(*
™_disk
 =ğ
šfo
.
m_¡rDevName
) {

405 
šfo
 = *
™_disk
;

409 
™_disk
++;

411  
™
;

414 
™
 ++;

417  
™
;

418 
	}
}

420 
boŞ
 
	gRAIDMªag”
::
	$RemoveDisk
(cÚ¡ 
¡ršg
& 
dev
)

423 ià(
dev
.
	`em±y
())

424  
çl£
;

433 
m_csRAIDDiskLi¡
.
	`Lock
();

434 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™
 = 
m_vRAIDDiskLi¡
.
	`begš
();

435 
uuid
[4];

436 
™
 !ğ
m_vRAIDDiskLi¡
.
	`’d
()) {

437 ià(*
™
 =ğ
dev
) {

438 
	`memıy
(
uuid
, 
™
->
m_RaidUUID
, () * 4);

441 
™
++;

444 ià(
™
 =ğ
m_vRAIDDiskLi¡
.
	`’d
()) {

445 
m_csRAIDDiskLi¡
.
	`UÆock
();

446 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csSymLškTabË
);

447 
m­
<
¡ršg
, 
MiscDiskInfo
>::
™”©Ü
 
™_symLškTabË
 = 
m_m­SymLškTabË
.
	`fšd
(
dev
);

448 
m_m­SymLškTabË
.
	`”a£
(
™_symLškTabË
);

449 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

450 "% »moved sucûssfuÎy .\n", 
dev
.
	`c_¡r
());

451  
Œue
;

466 
RAIDDiskInfo
 
šfo
 = *
™
;

467 
m_csRAIDInfoLi¡
.
	`Lock
();

468 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
¿id_™
 = 
	`S—rchDiskB–Úg2RAID
(
šfo
);

469 ià(
¿id_™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

470 
num
 = -1;

471 ià(
¿id_™
->
m_fsMgr
->
	`IsMouÁed
(
num
)) {

472 
¿id_™
->
m_fsMgr
->
	`UnmouÁ
();

473 
	`F»eVŞumeNum
(
num
);

476 
veùÜ
<
¡ršg
> 
vDevLi¡
;

477 
vDevLi¡
.
	`push_back
(
dev
);

478 
	`M¬kFauÉyMDDisks
(
¿id_™
->
m_¡rDevNodeName
, 
vDevLi¡
);

479 
	`RemoveMDDisks
(
¿id_™
->
m_¡rDevNodeName
, 
vDevLi¡
);

481 
m_csRAIDInfoLi¡
.
	`UÆock
();

484 
m_csSymLškTabË
.
	`Lock
();

485 
m­
<
¡ršg
, 
MiscDiskInfo
>::
™”©Ü
 
™_symLškTabË
 = 
m_m­SymLškTabË
.
	`fšd
(
dev
);

486 
m_m­SymLškTabË
.
	`”a£
(
™_symLškTabË
);

487 
m_csSymLškTabË
.
	`UÆock
();

489 
m_vRAIDDiskLi¡
.
	`”a£
(
™
);

490 
m_csRAIDDiskLi¡
.
	`UÆock
();

496 
	`Upd©eRAIDInfo
(
uuid
);

497 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

498 "% »moved sucûssfuÎy .\n", 
dev
.
	`c_¡r
());

499  
Œue
;

500 
	}
}

502 
	gRAIDMªag”
::
Upd©eRAIDDiskLi¡
(
veùÜ
<
RAIDDiskInfo
>& 
vRAIDDiskInfoLi¡
, cÚ¡ 
¡ršg
& 
mddev
)

504 ià(
	gvRAIDDiskInfoLi¡
.
em±y
())

507 
	gveùÜ
<
	gRAIDDiskInfo
>::
™”©Ü
 
™
 = 
vRAIDDiskInfoLi¡
.
begš
();

508 
	g™
 !ğ
vRAIDDiskInfoLi¡
.
’d
()) {

509 
boŞ
 
bExi¡
 = 
çl£
;

510 
Cr™iÿlSeùiÚLock
 
csRAIDDiskLi¡
(&
m_csRAIDDiskLi¡
);

511 
	gveùÜ
<
	gRAIDDiskInfo
>::
™”©Ü
 
™_®l
 = 
m_vRAIDDiskLi¡
.
begš
();

512 
	g™_®l
 !ğ
m_vRAIDDiskLi¡
.
’d
()) {

513 ià(*
™
 =ğ*
™_®l
) {

514 
examše_»suÉ
 
»suÉ
;

515 
	g»t
 = 
SUCCESS
;

517 
	g™
->
	gm_bHasMDSB
 = 
IsDiskHaveMDSu³rBlock
(
™
->
m_¡rDevName
, 
»suÉ
, 
»t
);

518 *
	g™_®l
 = *
™
;

519 
	gbExi¡
 = 
Œue
;

523 
	g™_®l
++;

526 ià(!
	gbExi¡
) {

531 
	gm_vRAIDDiskLi¡
.
push_back
(*
™
);

534 
Cr™iÿlSeùiÚLock
 
csSymLškTabË
(&
m_csSymLškTabË
);

535 
	gm_m­SymLškTabË
[
™
->
m_¡rDevName
].
	gm_¡rMDDev
 = 
mddev
;

536 
	g™
++;

539 
Cr™iÿlSeùiÚLock
 
cs
(&
m_csSymLškTabË
);

540 
	gm­
<
	g¡ršg
, 
	gMiscDiskInfo
>::
™”©Ü
 
™_symLškTab
 = 
m_m­SymLškTabË
.
begš
();

541 
	g™_symLškTab
 !ğ
m_m­SymLškTabË
.
’d
()) {

542 ià(
™_symLškTab
->
£cÚd
.
m_¡rMDDev
 !ğ
mddev
) {

543 
™_symLškTab
++;

547 
boŞ
 
	gbFound
 = 
çl£
;

548 
size_t
 
	gi
 = 0; i < 
	gvRAIDDiskInfoLi¡
.
size
(); i++) {

549 ià(
	g™_symLškTab
->
	gfœ¡
 =ğ
vRAIDDiskInfoLi¡
[
i
].
m_¡rDevName
) {

550 
bFound
 = 
Œue
;

555 ià(!
	gbFound
)

556 
	g™_symLškTab
->
	g£cÚd
.
	gm_¡rMDDev
 = "";

558 
	g™_symLškTab
++;

562 
boŞ
 
	gRAIDMªag”
::
	$G‘RAIDD‘a
(cÚ¡ 
¡ršg
& 
mddev
,

563 
¬¿y_d‘a
 &
ad
)

565 
cÚ‹xt
 
c
;

566 
»t
 = 
SUCCESS
;

568 
	`In™ŸlizeCÚ‹xt
(
c
);

569 
»t
 = 
	`D‘a_ToA¼ayD‘a
(
mddev
.
	`c_¡r
(), &
c
, &
ad
);

570 ià(
»t
 !ğ
SUCCESS
) {

571 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

573 
__LINE__
, 
mddev
.
	`c_¡r
(), 
»t
);

574  
çl£
;

577  
Œue
;

578 
	}
}

580 
boŞ
 
	gRAIDMªag”
::
	$IsRAIDAbnÜm®
(cÚ¡ 
RAIDInfo
 &
šfo
)

582 
num
 = -1;

584 ià(
šfo
.
m_iTÙ®DiskNum
 == 0)

585 
¿id_abnÜm®
;

587 
šfo
.
m_iRAIDLev–
) {

593 
LEVEL_MULTIPATH
:

594 
LEVEL_LINEAR
:

595 ià(
šfo
.
m_¡rS‹
.
	`fšd
("FAILED"è!ğ
¡ršg
::
Åos
)

596 
¿id_abnÜm®
;

599 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

601 
šfo
.
m_¡rDevNodeName
.
	`c_¡r
());

602  
Œue
;

606 ià(
šfo
.
m_fsMgr
->
	`IsFÜm©ed
()) {

607 ià(!
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

608 
¡ršg
 
¡rMouÁPošt
;

609 ià(
num
 < 0) {

610 
num
 = 
	`G‘F»eVŞumeNum
();

611 ià(
num
 < 0) {

617 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

619  
çl£
;

621 
šfo
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

624 
šfo
.
m_fsMgr
->
	`IsMouÁed
(
¡rMouÁPošt
);

625 ià(!
šfo
.
m_fsMgr
->
	`MouÁ
(
¡rMouÁPošt
)) {

626 
	`F»eVŞumeNum
(
num
);

631  
çl£
;

633 
¿id_abnÜm®
:

635 ià(
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

636 
šfo
.
m_fsMgr
->
	`UnmouÁ
();

637 
	`F»eVŞumeNum
(
num
);

639  
Œue
;

640 
	}
}

642 
boŞ
 
	gRAIDMªag”
::
	$Upd©eRAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
mdnum
)

649 ià(
mddev
.
	`em±y
())

650  
çl£
;

658 
¬¿y_d‘a
 
ad
;

659 
RAIDInfo
 
šfo
;

660 
boŞ
 
bG‘D‘aSucûss
 = 
çl£
;

662 
bG‘D‘aSucûss
 = 
	`G‘RAIDD‘a
(
mddev
, 
ad
);

664 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

665 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

666 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

667 ià(*
™
 =ğ
mddev
) {

668 ià(!
bG‘D‘aSucûss
) {

669 
™
->
m_¡rS‹
 = "INVALID";

670  
çl£
;

673 *
™
 = 
ad
;

674 
	`Upd©eRAIDDiskLi¡
(
™
->
m_vDiskLi¡
, 
mddev
);

676 ià(
	`IsRAIDAbnÜm®
(*
™
)) {

678 ià(
ad
.
¬¿yInfo
.
Ä_disks
 == 0) {

679 
m_vRAIDInfoLi¡
.
	`”a£
(
™
);

680 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

682 
__LINE__
, 
mddev
.
	`c_¡r
());

686  
Œue
;

689 
™
 ++;

692 ià(
ad
.
¬¿yInfo
.
Ä_disks
 == 0) {

693 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

695 
__LINE__
, 
mddev
.
	`c_¡r
());

696  
Œue
;

699 
šfo
 = 
ad
;

700 
šfo
.
m_iMDNum
 = 
mdnum
;

701 
šfo
.
	`In™ŸlizeFSMªag”
();

702 
	`Upd©eRAIDDiskLi¡
(
šfo
.
m_vDiskLi¡
, 
mddev
);

703 
m_vRAIDInfoLi¡
.
	`push_back
(
šfo
);

704  
Œue
;

705 
	}
}

707 
boŞ
 
	gRAIDMªag”
::
	$Upd©eRAIDInfo
()

716 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

717 ià(
m_vRAIDInfoLi¡
.
	`em±y
())

718  
Œue
;

720 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

721 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

722 
¬¿y_d‘a
 
ad
;

724 ià(!
	`G‘RAIDD‘a
(
™
->
m_¡rDevNodeName
, 
ad
)) {

730 
™
->
m_¡rS‹
 = "INVALID";

734 *
™
 = 
ad
;

735 
	`Upd©eRAIDDiskLi¡
(
™
->
m_vDiskLi¡
, it->
m_¡rDevNodeName
);

737 
	`IsRAIDAbnÜm®
(*
™
);

739 ià(
ad
.
¬¿yInfo
.
Ä_disks
 == 0) {

740 
™
 = 
m_vRAIDInfoLi¡
.
	`”a£
(it);

741 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

743 
__LINE__
, 
™
->
m_¡rDevNodeName
.
	`c_¡r
());

745 
™
 ++;

749  
Œue
;

750 
	}
}

752 
boŞ
 
	gRAIDMªag”
::
	$Upd©eRAIDInfo
(cÚ¡ 
uuid
[4])

760 ià(
uuid
 =ğ
NULL
)

761  
çl£
;

763 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

764 ià(
m_vRAIDInfoLi¡
.
	`em±y
())

765  
Œue
;

767 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

768 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

769 ià(0 =ğ
	`memcmp
(
uuid
, 
™
->
m_UUID
, () * 4)) {

770 
¬¿y_d‘a
 
ad
;

772 ià(!
	`G‘RAIDD‘a
(
™
->
m_¡rDevNodeName
, 
ad
)) {

773 
™
->
m_¡rS‹
 = "INVALID";

774  
çl£
;

777 *
™
 = 
ad
;

778 
	`Upd©eRAIDDiskLi¡
(
™
->
m_vDiskLi¡
, it->
m_¡rDevNodeName
);

779 ià(
	`IsRAIDAbnÜm®
(*
™
)) {

781 ià(
ad
.
¬¿yInfo
.
Ä_disks
 == 0) {

782 
m_vRAIDInfoLi¡
.
	`”a£
(
™
);

783 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

785 
__LINE__
, 
™
->
m_¡rDevNodeName
.
	`c_¡r
());

789  
Œue
;

792 
™
++;

795 * 
p_uuid
 = (*è
uuid
;

796 
¡ršg
 
	`¡rUUID
("");

797 
i
 = 0; i < 16; i++) {

798 
¡rUUID
 +ğ
	`¡ršg_fÜm©
("%02X ", 
p_uuid
[
i
]);

800 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
, "MD deviû cÜ»¥ÚdšgØ%swa nÙ found.\n", 
¡rUUID
.
	`c_¡r
());

801  
çl£
;

802 
	}
}

804 
	gRAIDMªag”
::
	$In™ŸlizeSh­e
(
sh­e
& 
s
, 
¿iddisks
, 
Ëv–
, 
chunk
, 
b™m­_chunk
, * 
b™m­_fe
)

806 
	`mem£t
(&
s
, 0x00, (
sh­e
));

807 
s
.
¿iddisks
 =„aiddisks;

808 
s
.
Ëv–
 =†evel;

809 
s
.
Ïyout
 = 
UnS‘
;

810 
s
.
b™m­_chunk
 = bitmap_chunk;

811 
s
.
chunk
 = chunk;

812 
s
.
assume_ş—n
 = 0;

813 
s
.
b™m­_fe
 = bitmap_file;

814 
	}
}

816 
	gRAIDMªag”
::
	$In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
, 
run¡İ
, 
v”bo£
)

818 
	`mem£t
(&
c
, 0x00, (
cÚ‹xt
));

819 
c
.
fÜû
 = force;

820 
c
.
d–ay
 = 
DEFAULT_BITMAP_DELAY
;

821 
c
.
run¡İ
 =„unstop;

822 
c
.
v”bo£
 = verbose;

823 
c
.
br›f
 = 0;

824 
	}
}

826 
	gRAIDMªag”
::
	$In™ŸlizeMDDevId’t
(
mddev_id’t
& 
id’t
, 
uuid_£t
, cÚ¡ 
uuid
[4], 
b™m­_fd
, * 
b™m­_fe
)

828 
	`mem£t
(&
id’t
, 0x00, (
mddev_id’t
));

829 
id’t
.
uuid_£t
 = uuid_set;

830 
id’t
.
su³r_mšÜ
 = 
UnS‘
;

831 
id’t
.
Ëv–
 = 
UnS‘
;

832 
id’t
.
¿id_disks
 = 
UnS‘
;

833 
id’t
.
¥¬e_disks
 = 
UnS‘
;

834 
id’t
.
b™m­_fd
 = bitmap_fd;

835 
id’t
.
b™m­_fe
 = bitmap_file;

836 ià(
uuid_£t
) {

837 
	`memıy
(
id’t
.
uuid
, uuid, () * 4);

838 
i
 = 0; i < 4; i++) {

839 
id’t
.
uuid
[
i
] = 
	`__be32_to_ıu
(ident.uuid[i]);

842 
	}
}

844 
mddev_dev
* 
	gRAIDMªag”
::
	$In™ŸlizeDevLi¡
(cÚ¡ 
¡ršg
& 
»¶aû
, cÚ¡ sŒšg& 
w™h
)

846 
mddev_dev
* 
devli¡
 = 
NULL
;

847 
mddev_dev
** 
devli¡’d
 = &
devli¡
;

848 
mddev_dev
* 
dv
 = 
NULL
;

850 ià(
»¶aû
.
	`em±y
(è|| 
w™h
.empty())

851  
NULL
;

853 
devli¡
 = 
NULL
;

854 
dv
 = (
mddev_dev
*)
	`m®loc
((mddev_dev));

855 ià(
dv
 =ğ
NULL
) {

856 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

857 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

858  
NULL
;

860 
dv
->
devÇme
 = (*)
»¶aû
.
	`c_¡r
();

861 
dv
->
di¥os™iÚ
 = 'R';

862 
dv
->
wr™emo¡ly
 = 0;

863 
dv
->
u£d
 = 0;

864 
dv
->
Ãxt
 = 
NULL
;

865 *
devli¡’d
 = 
dv
;

866 
devli¡’d
 = &
dv
->
Ãxt
;

868 
dv
 = (
mddev_dev
*)
	`m®loc
((mddev_dev));

869 ià(
dv
 =ğ
NULL
) {

870 
	`F»eDevLi¡
(
devli¡
);

871 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

872 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

873  
NULL
;

875 
dv
->
devÇme
 = (*)
w™h
.
	`c_¡r
();

876 
dv
->
di¥os™iÚ
 = 'w';

877 
dv
->
wr™emo¡ly
 = 0;

878 
dv
->
u£d
 = 0;

879 
dv
->
Ãxt
 = 
NULL
;

880 *
devli¡’d
 = 
dv
;

881 
devli¡’d
 = &
dv
->
Ãxt
;

883  
devli¡
;

884 
	}
}

886 
mddev_dev
* 
	gRAIDMªag”
::
In™ŸlizeDevLi¡
(
veùÜ
<
¡ršg
>& 
devNameLi¡
, 
di¥os™iÚ
)

888 
mddev_dev
* 
	gdevli¡
 = 
NULL
;

889 
mddev_dev
** 
	gdevli¡’d
 = &
devli¡
;

890 
mddev_dev
* 
	gdv
 = 
NULL
;

892 ià(
	gdevNameLi¡
.
em±y
())

893  
	gNULL
;

895 
size_t
 
	gi
 = 0; i < 
	gdevNameLi¡
.
size
(); i ++) {

896 
	gdv
 = (
mddev_dev
*)
m®loc
((mddev_dev));

897 ià(
	gdv
 =ğ
NULL
) {

898 
F»eDevLi¡
(
devli¡
);

899 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

900 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

901  
	gNULL
;

903 
	gdv
->
	gdevÇme
 = (*)
devNameLi¡
[
i
].
c_¡r
();

904 
	gdv
->
	gdi¥os™iÚ
 = 
di¥os™iÚ
;

905 
	gdv
->
	gwr™emo¡ly
 = 0;

906 
	gdv
->
	gu£d
 = 0;

907 
	gdv
->
	gÃxt
 = 
NULL
;

908 *
	gdevli¡’d
 = 
dv
;

909 
	gdevli¡’d
 = &
dv
->
Ãxt
;

912  
	gdevli¡
;

915 
	gRAIDMªag”
::
	$F»eDevLi¡
(
mddev_dev
* 
devli¡
)

917 
mddev_dev
* 
dv
 = 
NULL
;

918 
dv
 = 
devli¡
; dv; dv = dv->
Ãxt
) {

919 
	`ä“
(
dv
);

921 
devli¡
 = 
NULL
;

922 
	}
}

924 
	gRAIDMªag”
::
	$O³nMDDev
(cÚ¡ 
¡ršg
& 
mddev
)

926 
fd
 = 
	`İ’_mddev
((*)
mddev
.
	`c_¡r
(), 1);

927 ià(
fd
 < 0) {

928 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

929 "FaØİ’ MD deviû. %s\n", 
mddev
.
	`c_¡r
());

932  
fd
;

933 
	}
}

935 
¡ršg
 
	gRAIDMªag”
::
	$G’”©eMDDevName
(
num
)

937  
	`¡ršg_fÜm©
("/dev/md%d", 
num
);

938 
	}
}

940 
	gRAIDMªag”
::
	$G’”©eVŞumeName
(
¡ršg
& 
Çme
)

942 
iF»eVŞume
 = 
	`G‘F»eVŞumeNum
();

943 ià(
iF»eVŞume
 < 0) {

944 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

948 
Çme
 = 
	`¡ršg_fÜm©
("/mÁ/VOLUME%d", 
iF»eVŞume
 + 1);

949 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

950 "VŞumName: %s\n", 
Çme
.
	`c_¡r
());

951  
iF»eVŞume
;

952 
	}
}

954 
boŞ
 
	gRAIDMªag”
::
C»©eRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, 
Ëv–
, sŒšg& 
¡rMDName
)

956 
	g»t
 = 
SUCCESS
;

959 
	gä“MD
 = 
G‘F»eMDNum
();

960 ià(
	gä“MD
 < 0) {

961 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

966 
	g»t
 = 
C»©eRAID
(
ä“MD
, 
¡rMDName
, 
vDevLi¡
, 
Ëv–
);

967 ià(
	g»t
 =ğ
SUCCESS
) {

968 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

969 "% ü—‹d sucûssfuÎy.\n", 
¡rMDName
.
c_¡r
());

970  
	gŒue
;

971 } ià(
	g»t
 =ğ
CREATE_MDDEV_INUSE
) {

972 
S‘MDNum
(
ä“MD
);

975 
F»eMDNum
(
ä“MD
);

977 } 
	g»t
 =ğ
CREATE_MDDEV_INUSE
);

979 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

980 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

981  
	gçl£
;

984 
	gRAIDMªag”
::
C»©eRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
)

988 ià(
	gmdnum
 < 0)

989  
	gCREATE_MDNUM_ILLEGAL
;

991 
	gmddev
 = 
G’”©eMDDevName
(
mdnum
);

994 ià(
	gvDevLi¡
.
em±y
())

995  
	gCREATE_RAID_DEVS_NOT_ENOUGH
;

1001 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1002 ià(
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1003 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1004 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
CREATE_MDDEV_INUSE
);

1006  
	gCREATE_MDDEV_INUSE
;

1015 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1016 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1017 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
CREATE_RAID_DEVS_NOT_EXIST_IN_LIST
);

1018  
	gCREATE_RAID_DEVS_NOT_EXIST_IN_LIST
;

1022 
sh­e
 
	gs
;

1023 
In™ŸlizeSh­e
(
s
, 
vDevLi¡
.
size
(), 
Ëv–
, 512);

1026 
cÚ‹xt
 
	gc
;

1027 
In™ŸlizeCÚ‹xt
(
c
);

1033 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
);

1034 ià(
	gdevli¡
 =ğ
NULL
)

1035  
çl£
;

1042 
	g»t
 = 
C»©e
(
NULL
, (*)
mddev
.
c_¡r
(), NULL, NULL, 
vDevLi¡
.
size
(), 
devli¡
, &
s
, &
c
, 
INVALID_SECTORS
);

1043 ià(
	g»t
 !ğ
SUCCESS
) {

1044 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1045 "FaØü—‹ vŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1046  
	g»t
;

1050 
Upd©eRAIDInfo
(
mddev
, 
mdnum
);

1056 
F»eDevLi¡
(
devli¡
);

1057  
	gSUCCESS
;

1060 
	gRAIDMªag”
::
C»©eRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
)

1064 ià(
	gmddev
.
em±y
())

1065  
	gCREATE_MDDEV_UNSET
;

1069 ià(
	gvDevLi¡
.
em±y
())

1070  
	gCREATE_RAID_DEVS_NOT_ENOUGH
;

1076 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1077 ià(
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1078 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1079 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
CREATE_MDDEV_INUSE
);

1081  
	gCREATE_MDDEV_INUSE
;

1090 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1091 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1092 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
CREATE_RAID_DEVS_NOT_EXIST_IN_LIST
);

1093  
	gCREATE_RAID_DEVS_NOT_EXIST_IN_LIST
;

1097 
sh­e
 
	gs
;

1098 
In™ŸlizeSh­e
(
s
, 
vDevLi¡
.
size
(), 
Ëv–
, 512);

1101 
cÚ‹xt
 
	gc
;

1102 
In™ŸlizeCÚ‹xt
(
c
);

1108 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
);

1109 ià(
	gdevli¡
 =ğ
NULL
)

1110  
çl£
;

1117 
	g»t
 = 
C»©e
(
NULL
, (*)
mddev
.
c_¡r
(), NULL, NULL, 
vDevLi¡
.
size
(), 
devli¡
, &
s
, &
c
, 
INVALID_SECTORS
);

1118 ià(
	g»t
 !ğ
SUCCESS
) {

1119 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1120 "FaØü—‹ vŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1121  
	g»t
;

1125 
Upd©eRAIDInfo
(
mddev
);

1131 
F»eDevLi¡
(
devli¡
);

1132  
	gSUCCESS
;

1135 
boŞ
 
	gRAIDMªag”
::
	$As£mbËRAID
(cÚ¡ 
uuid
[4], 
¡ršg
& 
¡rMDName
)

1137 
»t
 = 
SUCCESS
;

1140 
ä“MD
 = 
	`G‘F»eMDNum
();

1141 ià(
ä“MD
 < 0) {

1142 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1144  
çl£
;

1147 
»t
 = 
	`As£mbËRAID
(
ä“MD
, 
¡rMDName
, 
uuid
);

1148 ià(
»t
 =ğ
SUCCESS
) {

1149 * 
p_uuid
 = (*è
uuid
;

1150 
¡ršg
 
	`¡rUUID
("");

1151 
i
 = 0; i < 16; i++) {

1152 
¡rUUID
 +ğ
	`¡ršg_fÜm©
("%02X ", 
p_uuid
[
i
]);

1154 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1155 "%swa as£mbËdØ%s.\n", 
¡rUUID
.
	`c_¡r
(), 
¡rMDName
.c_str());

1156 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1157 "% as£mbËd sucûssfuÎy.\n", 
¡rMDName
.
	`c_¡r
());

1158  
Œue
;

1159 } ià(
»t
 =ğ
ASSEMBLE_MD_ALREADY_ACTIVE
) {

1160  
Œue
;

1161 } ià(
»t
 =ğ
ASSEMBLE_MDDEV_INUSE
) {

1162 
	`S‘MDNum
(
ä“MD
);

1164 } ià(
»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
) {

1165 
	`F»eMDNum
(
ä“MD
);

1167 } 
»t
 =ğ
ASSEMBLE_MDDEV_INUSE
);

1169 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1170 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

1171  
çl£
;

1172 
	}
}

1174 
	gRAIDMªag”
::
	$As£mbËRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4])

1178 ià(
mdnum
 < 0)

1179  
ASSEMBLE_MDNUM_ILLEGAL
;

1181 
mddev
 = 
	`G’”©eMDDevName
(
mdnum
);

1187 ià(
uuid
 =ğ
NULL
)

1188  
ASSEMBLE_INVALID_UUID
;

1194 
RAIDInfo
 
šfo
;

1195 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
);

1196 ià(
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1197 
»t
 = 
ASSEMBLE_MDDEV_INUSE
;

1198 ià(0 =ğ
	`memcmp
(
uuid
, 
šfo
.
m_UUID
, (info.m_UUID))) {

1199 
»t
 = 
ASSEMBLE_MD_ALREADY_ACTIVE
;

1201 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1202 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

1203  
»t
;

1209 
mddev_id’t
 
id’t
;

1210 
	`In™ŸlizeMDDevId’t
(
id’t
, 1, 
uuid
);

1217 
cÚ‹xt
 
c
;

1218 
	`In™ŸlizeCÚ‹xt
(
c
);

1219 
»t
 = 
	`As£mbË
(
NULL
, (*)
mddev
.
	`c_¡r
(), &
id’t
, NULL, &
c
);

1220 ià(
»t
 !ğ
SUCCESS
) {

1221 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1222 "FaØas£mbË vŞum%s: (%d)\n", 
mddev
.
	`c_¡r
(), 
»t
);

1223 iàĞ
»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
)

1224  
»t
;

1230 
	`Upd©eRAIDInfo
(
mddev
, 
mdnum
);

1231  
»t
;

1232 
	}
}

1234 
	gRAIDMªag”
::
	$As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4])

1240 ià(
mddev
.
	`em±y
())

1241  
ASSEMBLE_MDDEV_UNSET
;

1247 ià(
uuid
 =ğ
NULL
)

1248  
ASSEMBLE_INVALID_UUID
;

1254 
RAIDInfo
 
šfo
;

1255 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
);

1256 ià(
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1257 
»t
 = 
ASSEMBLE_MDDEV_INUSE
;

1258 ià(0 =ğ
	`memcmp
(
uuid
, 
šfo
.
m_UUID
, (info.m_UUID))) {

1259 
»t
 = 
ASSEMBLE_MD_ALREADY_ACTIVE
;

1262 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1263 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

1264  
»t
;

1270 
mddev_id’t
 
id’t
;

1271 
	`In™ŸlizeMDDevId’t
(
id’t
, 1, 
uuid
);

1278 
cÚ‹xt
 
c
;

1279 
	`In™ŸlizeCÚ‹xt
(
c
);

1280 
»t
 = 
	`As£mbË
(
NULL
, (*)
mddev
.
	`c_¡r
(), &
id’t
, NULL, &
c
);

1281 ià(
»t
 !ğ
SUCCESS
) {

1282 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1283 "FaØas£mbË vŞum%s: (%d)\n", 
mddev
.
	`c_¡r
(), 
»t
);

1284 iàĞ
»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
)

1285  
»t
;

1291 
	`Upd©eRAIDInfo
(
mddev
);

1292  
»t
;

1293 
	}
}

1295 
boŞ
 
	gRAIDMªag”
::
As£mbËRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, sŒšg& 
¡rMDName
)

1297 
	g»t
 = 
SUCCESS
;

1300 
	gä“MD
 = 
G‘F»eMDNum
();

1301 ià(
	gä“MD
 < 0) {

1302 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1304  
	gçl£
;

1307 
	g»t
 = 
As£mbËRAID
(
ä“MD
, 
¡rMDName
, 
vDevLi¡
);

1308 ià(
	g»t
 =ğ
SUCCESS
) {

1309 
¡ršg
 
¡rDevLi¡
("");

1310 
size_t
 
	gi
 = 0; i < 
	gvDevLi¡
.
size
(); i++) {

1311 
	g¡rDevLi¡
 +ğ
vDevLi¡
[
i
];

1313 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1314 "%swa as£mbËdØ%s.\n", 
¡rDevLi¡
.
c_¡r
(), 
¡rMDName
.c_str());

1315 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1316 "% as£mbËd sucûssfuÎy.\n", 
¡rMDName
.
c_¡r
());

1317  
	gŒue
;

1318 } ià(
	g»t
 =ğ
ASSEMBLE_MDDEV_INUSE
) {

1319 
S‘MDNum
(
ä“MD
);

1321 } ià(
	g»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
) {

1322 
F»eMDNum
(
ä“MD
);

1324 } 
	g»t
 =ğ
ASSEMBLE_MDDEV_INUSE
);

1326 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1327 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

1328  
	gçl£
;

1331 
	gRAIDMªag”
::
As£mbËRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1337 ià(
	gmdnum
 < 0)

1338  
	gASSEMBLE_MDNUM_ILLEGAL
;

1340 
	gmddev
 = 
G’”©eMDDevName
(
mdnum
);

1346 ià(
	gvDevLi¡
.
em±y
())

1347  
	gASSEMBLE_NO_DEVS_FOR_MD
;

1357 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1358 ià(
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1359 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1360 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
ASSEMBLE_MDDEV_INUSE
);

1362  
	gASSEMBLE_MDDEV_INUSE
;

1371 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1372 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1373 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
ASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
);

1374  
	gASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
;

1380 
mddev_id’t
 
	gid’t
;

1381 
In™ŸlizeMDDevId’t
(
id’t
, 0, 
NULL
);

1387 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
);

1388 if(
	gdevli¡
 =ğ
NULL
) {

1389  
ASSEMBLE_INITIALIZE_DEV_LIST_FAIL
;

1397 
cÚ‹xt
 
	gc
;

1398 
In™ŸlizeCÚ‹xt
(
c
);

1399 
	g»t
 = 
As£mbË
(
NULL
, (*)
mddev
.
c_¡r
(), &
id’t
, 
devli¡
, &
c
);

1400 
F»eDevLi¡
(
devli¡
);

1401 ià(
	g»t
 != 0) {

1402 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1403 "FaØas£mbË vŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1404 iàĞ
	g»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
)

1405  
»t
;

1415 
Upd©eRAIDInfo
(
mddev
, 
mdnum
);

1416  
	g»t
;

1419 
	gRAIDMªag”
::
As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1425 ià(
	gmddev
.
em±y
())

1426  
	gASSEMBLE_MDDEV_UNSET
;

1432 ià(
	gvDevLi¡
.
em±y
())

1433  
	gASSEMBLE_NO_DEVS_FOR_MD
;

1443 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1444 ià(
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1445 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1446 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
ASSEMBLE_MDDEV_INUSE
);

1448  
	gASSEMBLE_MDDEV_INUSE
;

1457 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1458 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1459 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
ASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
);

1460  
	gASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
;

1466 
mddev_id’t
 
	gid’t
;

1467 
In™ŸlizeMDDevId’t
(
id’t
, 0, 
NULL
);

1473 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
);

1474 if(
	gdevli¡
 =ğ
NULL
) {

1475  
ASSEMBLE_INITIALIZE_DEV_LIST_FAIL
;

1483 
cÚ‹xt
 
	gc
;

1484 
In™ŸlizeCÚ‹xt
(
c
);

1485 
	g»t
 = 
As£mbË
(
NULL
, (*)
mddev
.
c_¡r
(), &
id’t
, 
devli¡
, &
c
);

1486 
F»eDevLi¡
(
devli¡
);

1487 ià(
	g»t
 != 0) {

1488 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1489 "FaØas£mbË vŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1490 iàĞ
	g»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
)

1491  
»t
;

1501 
Upd©eRAIDInfo
(
mddev
);

1502  
	g»t
;

1505 
boŞ
 
	gRAIDMªag”
::
MªageRAIDSubdevs
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
İ”©iÚ
)

1511 ià(
	gmddev
.
em±y
())

1512  
	gçl£
;

1518 ià(
	gvDevLi¡
.
em±y
())

1519  
	gçl£
;

1525 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
IsMDDevInRAIDInfoLi¡
(
mddev
);

1526 ià(
	g™
 =ğ
m_vRAIDInfoLi¡
.
’d
()) {

1527 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1528 "% dÛ¢'ˆexi¡.\n", 
mddev
.
c_¡r
());

1529  
	gçl£
;

1538 ià(!
IsDiskExi¡InRAIDDiskLi¡
(
vDevLi¡
)) {

1539 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1540 "Somdisk dÛ¢'ˆb–ÚgØ%s.\n", 
mddev
.
c_¡r
());

1541  
	gçl£
;

1549 
	gfd
 = 
O³nMDDev
(
mddev
);

1550 ià(
	gfd
 < 0)

1551  
	gçl£
;

1562 
mddev_dev
* 
	gdevli¡
 = 
NULL
;

1563 
	gİ”©iÚ
) {

1565 ià(
vDevLi¡
.
size
() != 2) {

1566 
şo£
(
fd
);

1567 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1569  
	gçl£
;

1572 ià(
	gNULL
 =ğ(
devli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
[0], vDevList[1]))) {

1573  
	gçl£
;

1577 ià(
NULL
 =ğ(
devli¡
 = 
In™ŸlizeDevLi¡
(
vDevLi¡
, 
İ”©iÚ
))) {

1578  
	gçl£
;

1589 
cÚ‹xt
 
	gc
;

1590 
In™ŸlizeCÚ‹xt
(
c
);

1591 
	g»t
 = 
Mªage_subdevs
((*)
mddev
.
c_¡r
(), 
fd
, 
devli¡
, 
c
.
v”bo£
, 0, 
NULL
, c.
fÜû
);

1592 
şo£
(
fd
);

1593 
F»eDevLi¡
(
devli¡
);

1602 ià(
	g»t
 != 0) {

1603 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1604 "FaØmªagvŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

1605  
	gçl£
;

1608 
Upd©eRAIDInfo
(
mddev
);

1609  
	gSUCCESS
;

1612 
boŞ
 
	gRAIDMªag”
::
RemoveMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1614  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'r');

1617 
boŞ
 
	gRAIDMªag”
::
M¬kFauÉyMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1619  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'f');

1622 
boŞ
 
	gRAIDMªag”
::
AddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1624  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'a');

1627 
boŞ
 
	gRAIDMªag”
::
R—ddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

1629  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'A');

1632 
boŞ
 
	gRAIDMªag”
::
	$R•ÏûMDDisk
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ sŒšg& 
»¶aû
, cÚ¡ sŒšg& 
w™h
)

1634 ià(
»¶aû
.
	`em±y
(è|| 
w™h
.empty())

1635  
çl£
;

1637 
veùÜ
<
¡ršg
> 
vDevLi¡
;

1638 
vDevLi¡
.
	`push_back
(
»¶aû
);

1639 
vDevLi¡
.
	`push_back
(
w™h
);

1641  
	`MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'R');

1642 
	}
}

1644 
boŞ
 
	gRAIDMªag”
::
	$StİRAID
(cÚ¡ 
¡ršg
& 
mddev
)

1650 ià(
mddev
.
	`em±y
())

1651  
çl£
;

1658 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
);

1659 ià(
™
 =ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1660 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_WARNING
, 
LOG_LABEL
,

1661 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1662  
Œue
;

1666 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
, 
´og»ss
 = -1;

1667 ià(
	`G‘FÜm©Prog»ss
(
mddev
, 
¡©
, 
´og»ss
)) {

1668 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1669 "FaØ¡İ vŞum%s. Iˆi fÜm©tšg. [%d/%d%%]\n", 
mddev
.
	`c_¡r
(), 
¡©
, 
´og»ss
);

1670  
çl£
;

1673 
	`UnmouÁ
(
mddev
);

1679 
fd
 = 
	`O³nMDDev
(
mddev
);

1680 ià(
fd
 < 0)

1681  
çl£
;

1689 
cÚ‹xt
 
c
;

1690 
»t
 = 
SUCCESS
;

1692 
	`In™ŸlizeCÚ‹xt
(
c
);

1693 
»t
 = 
	`Mªage_¡İ
((*)
mddev
.
	`c_¡r
(), 
fd
, 
c
.
v”bo£
, 0);

1694 
	`şo£
(
fd
);

1696 ià(
»t
 !ğ
SUCCESS
) {

1697 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1698 "FaØ¡İ vŞum%s: %d\n", 
mddev
.
	`c_¡r
(), 
»t
);

1699  
çl£
;

1705 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

1707 
size_t
 
i
 = 0; i < 
™
->
m_vDiskLi¡
.
	`size
(); i++) {

1708 
Cr™iÿlSeùiÚLock
 
	`csSymLškTabË
(&
m_csSymLškTabË
);

1709 
m_m­SymLškTabË
[
™
->
m_vDiskLi¡
[
i
].
m_¡rDevName
].
m_¡rMDDev
 = "";

1712 
	`F»eMDNum
(
™
->
m_iMDNum
);

1713 
m_vRAIDInfoLi¡
.
	`”a£
(
™
);

1714  
Œue
;

1715 
	}
}

1717 
boŞ
 
	gRAIDMªag”
::
	$D–‘eRAID
(cÚ¡ 
¡ršg
& 
mddev
)

1724 
RAIDInfo
 
šfo
;

1725 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
);

1726 ià(
™
 =ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1727 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1728 "D–‘vŞum%s\n", 
mddev
.
	`c_¡r
());

1729  
Œue
;

1732 ià(!
	`StİRAID
(
mddev
))

1733  
çl£
;

1739 ià(
mddev
.
	`em±y
())

1740  
çl£
;

1747 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
	`IsMDDevInRAIDInfoLi¡
(
mddev
);

1748 ià(
™
 =ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1749 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1750 "D–‘vŞum%s\n", 
mddev
.
	`c_¡r
());

1751  
Œue
;

1755 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
, 
´og»ss
 = -1;

1756 ià(
	`G‘FÜm©Prog»ss
(
mddev
, 
¡©
, 
´og»ss
)) {

1757 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1758 "FaØd–‘vŞum%s. Iˆi fÜm©tšg. [%d/%d%%]\n", 
mddev
.
	`c_¡r
(), 
¡©
, 
´og»ss
);

1759  
çl£
;

1762 
	`UnmouÁ
(
mddev
);

1768 
fd
 = 
	`O³nMDDev
(
mddev
);

1769 ià(
fd
 < 0)

1770  
çl£
;

1778 
cÚ‹xt
 
c
;

1779 
»t
 = 
SUCCESS
;

1781 
	`In™ŸlizeCÚ‹xt
(
c
);

1782 
»t
 = 
	`Mªage_¡İ
((*)
mddev
.
	`c_¡r
(), 
fd
, 
c
.
v”bo£
, 0);

1783 
	`şo£
(
fd
);

1785 ià(
»t
 !ğ
SUCCESS
) {

1786 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1787 "FaØ¡İ vŞum%s: %d\n", 
mddev
.
	`c_¡r
(), 
»t
);

1788  
çl£
;

1793 
RAIDInfo
 
šfo
 = *
™
;

1794 #ifdeà
NUUO


1795 
m_csRAIDInfoLi¡
.
	`Lock
();

1798 
	`F»eMDNum
(
šfo
.
m_iMDNum
);

1799 
m_vRAIDInfoLi¡
.
	`”a£
(
™
);

1800 #ifdeà
NUUO


1801 
m_csRAIDInfoLi¡
.
	`UÆock
();

1810 
cÚ‹xt
 
c
;

1811 
»t
 = 
SUCCESS
;

1813 
	`In™ŸlizeCÚ‹xt
(
c
);

1814 
size_t
 
i
 = 0; i < 
šfo
.
m_vDiskLi¡
.
	`size
(); i++) {

1815 
»t
 = 
	`Kl
((*)
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
(), 
NULL
, 
c
.
fÜû
, c.
v”bo£
, 0);

1816 ià(
»t
 !ğ
SUCCESS
) {

1817 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1818 "KÈE¼Ü Cod%s: %d\n", 
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
(), 
»t
);

1826 
examše_»suÉ
 
»suÉ
;

1827 
»t
 = 
SUCCESS
;

1830 ià(
	`IsDiskHaveMDSu³rBlock
(
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
(), 
»suÉ
, 
»t
)) {

1831 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_WARNING
, 
LOG_LABEL
,

1833 
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
(), 
»t
);

1835 
¡ršg
 
cmd
 = 
	`¡ršg_fÜm©
("dd if=/dev/z”Øof=% bs=512 couÁ=1", 
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
());

1836 
	`sy¡em
(
cmd
.
	`c_¡r
());

1841 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_WARNING
, 
LOG_LABEL
,

1842 "%s' su³rblock i ş—»d\n", 
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevName
.
	`c_¡r
());

1845  
Œue
;

1846 
	}
}

1848 
boŞ
 
	gRAIDMªag”
::
	$G‘RAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
RAIDInfo
& 
šfo
)

1854 ià(
mddev
.
	`em±y
())

1855  
çl£
;

1863 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csRAIDInfoLi¡
);

1864 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
	`begš
();

1865 
™
 !ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1866 ià(*
™
 =ğ
mddev
) {

1870 
™
++;

1873 ià(
™
 =ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1874 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1875 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1876  
çl£
;

1879 
size_t
 
i
 = 0; i < 
™
->
m_vDiskLi¡
.
	`size
(); i++) {

1880 
Cr™iÿlSeùiÚLock
 
	`csSymLškTabË
(&
m_csSymLškTabË
);

1881 
™
->
m_vDiskLi¡
[
i
].
m_miscInfo
 = 
m_m­SymLškTabË
[™->m_vDiskLi¡[i].
m_¡rDevName
];

1883 
šfo
 = *
™
;

1884  
Œue
;

1885 
	}
}

1887 
	gRAIDMªag”
::
G‘RAIDInfo
(
veùÜ
<
RAIDInfo
>& 
li¡
)

1889 
li¡
.
ş—r
();

1891 
Cr™iÿlSeùiÚLock
 
cs
(&
m_csRAIDInfoLi¡
);

1892 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
™
 = 
m_vRAIDInfoLi¡
.
begš
();

1893 
	g™
 !ğ
m_vRAIDInfoLi¡
.
’d
()) {

1894 
size_t
 
i
 = 0; 
	gi
 < 
	g™
->
	gm_vDiskLi¡
.
size
(); i++) {

1895 
Cr™iÿlSeùiÚLock
 
csSymLškTabË
(&
m_csSymLškTabË
);

1896 
	g™
->
	gm_vDiskLi¡
[
i
].
	gm_miscInfo
 = 
m_m­SymLškTabË
[
™
->
m_vDiskLi¡
[i].
m_¡rDevName
];

1899 
	gli¡
.
push_back
(*
™
);

1900 
	g™
++;

1904 
	gRAIDMªag”
::
G‘DisksInfo
(
veùÜ
<
RAIDDiskInfo
> &
li¡
)

1906 
li¡
.
ş—r
();

1908 
Cr™iÿlSeùiÚLock
 
cs
(&
m_csRAIDDiskLi¡
);

1909 
	gveùÜ
<
	gRAIDDiskInfo
>::
™”©Ü
 
™
 = 
m_vRAIDDiskLi¡
.
begš
();

1910 
	g™
 !ğ
m_vRAIDDiskLi¡
.
’d
()) {

1911 
RAIDDiskInfo
 
šfo
 = *
™
;

1912 
Cr™iÿlSeùiÚLock
 
csSymLškTabË
(&
m_csSymLškTabË
);

1913 
	gšfo
.
	gm_miscInfo
 = 
m_m­SymLškTabË
[
™
->
m_¡rDevName
];

1914 
	gli¡
.
push_back
(
šfo
);

1915 
	g™
++;

1919 
boŞ
 
	gRAIDMªag”
::
	$G‘DisksInfo
(cÚ¡ 
¡ršg
& 
dev
, 
RAIDDiskInfo
 &
šfo
)

1921 ià(
dev
.
	`em±y
()) {

1922  
çl£
;

1925 
¡ršg
 
¡rDevNode
 = 
	`G‘DeviûNodeBySymLšk
(
dev
);

1927 
Cr™iÿlSeùiÚLock
 
	`csRAIDDiskLi¡
(&
m_csRAIDDiskLi¡
);

1928 
veùÜ
<
RAIDDiskInfo
>::
™”©Ü
 
™
 = 
m_vRAIDDiskLi¡
.
	`begš
();

1929 
™
 !ğ
m_vRAIDDiskLi¡
.
	`’d
()) {

1930 ià(*
™
 =ğ
¡rDevNode
) {

1931 
šfo
 = *
™
;

1932 
Cr™iÿlSeùiÚLock
 
	`csSymLškTabË
(&
m_csSymLškTabË
);

1933 
šfo
.
m_miscInfo
 = 
m_m­SymLškTabË
[
¡rDevNode
];

1934  
Œue
;

1936 
™
++;

1939  
çl£
;

1940 
	}
}

1942 
boŞ
 
	gRAIDMªag”
::
	$FÜm©
(cÚ¡ 
¡ršg
& 
mddev
)

1944 ià(
mddev
.
	`em±y
()) {

1945 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1946 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

1947  
çl£
;

1950 
RAIDInfo
 
šfo
;

1951 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1952 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1953 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1954  
çl£
;

1957 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1958 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1960 
mddev
.
	`c_¡r
());

1961  
çl£
;

1964 
num
 = 
	`G‘F»eVŞumeNum
();

1965 ià(
num
 < 0) {

1966 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1968  
çl£
;

1971 
šfo
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

1972 #ifdeà
NUUO


1973 
šfo
.
m_fsMgr
->
	`C»©eTh»ad
();

1976  
Œue
;

1977 
	}
}

1979 
boŞ
 
	gRAIDMªag”
::
	$MouÁ
(cÚ¡ 
¡ršg
& 
mddev
)

1981 ià(
mddev
.
	`em±y
()) {

1982 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1983 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

1984  
çl£
;

1987 
RAIDInfo
 
šfo
;

1988 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

1989 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

1990 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1991  
çl£
;

1994 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1995 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1997 
mddev
.
	`c_¡r
());

1998  
çl£
;

2001 ià(!
šfo
.
m_fsMgr
->
	`IsFÜm©ed
()) {

2002 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2004 
mddev
.
	`c_¡r
());

2005  
çl£
;

2008 
num
 = -1;

2009 ià(!
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

2010 
¡ršg
 
¡rMouÁPošt
;

2011 ià(
num
 < 0) {

2012 
num
 = 
	`G‘F»eVŞumeNum
();

2013 ià(
num
 < 0) {

2014 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2016  
çl£
;

2018 
šfo
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

2021 
šfo
.
m_fsMgr
->
	`IsMouÁed
(
¡rMouÁPošt
);

2022 ià(!
šfo
.
m_fsMgr
->
	`MouÁ
(
¡rMouÁPošt
)) {

2023 
	`F»eVŞumeNum
(
num
);

2024  
çl£
;

2029 
šfo
.
m_fsMgr
->
	`G’”©eUUIDFe
();

2030 
šfo
.
m_fsMgr
->
	`C»©eDeçuÉFŞd”s
();

2032  
Œue
;

2033 
	}
}

2035 
boŞ
 
	gRAIDMªag”
::
	$UnmouÁ
(cÚ¡ 
¡ršg
& 
mddev
)

2037 ià(
mddev
.
	`em±y
()) {

2038 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2039 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

2040  
çl£
;

2043 
RAIDInfo
 
šfo
;

2044 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

2045 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

2046 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

2047  
çl£
;

2050 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

2051 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2053 
mddev
.
	`c_¡r
());

2054  
çl£
;

2057 
num
 = -1;

2058 ià(
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

2059 ià(
šfo
.
m_fsMgr
->
	`UnmouÁ
()) {

2060 
	`F»eVŞumeNum
(
num
);

2061  
Œue
;

2064 
	`F»eVŞumeNum
(
num
);

2065  
çl£
;

2069  
Œue
;

2070 
	}
}

2072 
boŞ
 
	gRAIDMªag”
::
	$G‘FÜm©Prog»ss
(cÚ¡ 
¡ršg
& 
mddev
,

2073 & 
¡©
, & 
´og»ss
)

2075 ià(
mddev
.
	`em±y
()) {

2076 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2077 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

2078  
çl£
;

2081 
RAIDInfo
 
šfo
;

2082 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

2083 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

2084 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

2085  
çl£
;

2088 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

2089 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2091 
mddev
.
	`c_¡r
());

2092  
çl£
;

2095  
šfo
.
m_fsMgr
->
	`IsFÜm©šg
(
´og»ss
, 
¡©
);

2096 
	}
}

2098 
boŞ
 
	gRAIDMªag”
::
	$IsMouÁed
(cÚ¡ 
¡ršg
& 
mddev
, &
num
)

2100 ià(
mddev
.
	`em±y
()) {

2101 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2102 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

2103  
çl£
;

2106 
RAIDInfo
 
šfo
;

2107 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

2108 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

2109 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

2110  
çl£
;

2113 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

2114 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2116 
mddev
.
	`c_¡r
());

2117  
çl£
;

2120  
šfo
.
m_fsMgr
->
	`IsMouÁed
(
num
);

2121 
	}
}

2123 
boŞ
 
	gRAIDMªag”
::
	$IsFÜm©ed
(cÚ¡ 
¡ršg
& 
mddev
)

2125 ià(
mddev
.
	`em±y
()) {

2126 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2127 "[%d] UnknowÀMD deviû.\n", 
__LINE__
);

2128  
çl£
;

2131 
RAIDInfo
 
šfo
;

2132 ià(
	`IsMDDevInRAIDInfoLi¡
(
mddev
, 
šfo
è=ğ
m_vRAIDInfoLi¡
.
	`’d
()) {

2133 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

2134 "% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

2135  
çl£
;

2138 ià(
šfo
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

2139 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

2141 
mddev
.
	`c_¡r
());

2142  
çl£
;

2145  
šfo
.
m_fsMgr
->
	`IsFÜm©ed
();

2146 
	}
}

2148 
	gRAIDMªag”
::
	$Dump
()

2150 
	`´štf
("Used MD Number: ");

2151 
i
 = 0; i < 128; i ++)

2152 ià(
m_bU£dMD
[
i
])

2153 
	`´štf
("%d ", 
i
);

2154 
	`´štf
("\n");

2155 
	`´štf
("Used Volume Number: ");

2156 
i
 = 0; i < 128; i ++)

2157 ià(
m_bU£dVŞume
[
i
])

2158 
	`´štf
("%d ", 
i
 + 1);

2159 
	`´štf
("\n");

2160 
size_t
 
i
 = 0; i < 
m_vRAIDDiskLi¡
.
	`size
(); i++) {

2161 
m_vRAIDDiskLi¡
[
i
].
	`Dump
();

2163 
	}
}

2165 
¡ršg
 
	gRAIDMªag”
::
	$G‘DeviûNodeBySymLšk
(cÚ¡ 
¡ršg
& 
symlšk
)

2168 
¡©
 
s
;

2169 ià(
	`l¡©
(
symlšk
.
	`c_¡r
(), &
s
) >= 0) {

2170 ià(
	`S_ISLNK
(
s
.
¡_mode
) == 1) {

2171 
buf
[128];

2172 
Ën
 = 0;

2173 ià((
Ën
 = 
	`»adlšk
(
symlšk
.
	`c_¡r
(), 
buf
, (buf) - 1)) >= 0) {

2174 
¡ršg
 
¡rDevNode
 = "/dev/";

2175 
buf
[
Ën
] = '\0';

2176 
¡rDevNode
 +ğ
buf
;

2177  
¡rDevNode
;

2182  
symlšk
;

2183 
	}
}

	@RAIDManager.h

1 #iâdeà
__RAIDMANAGER_H__


2 
	#__RAIDMANAGER_H__


	)

4 #ifdeà
__ılu¥lus


7 
	~"libmdadm/mdadm.h
"

8 #ifdeà
__ılu¥lus


12 
	~"Fesy¡emMªag”.h
"

14 #ifdeà
NUUO


15 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

16 
	~"commÚ/nusy¦og.h
"

17 
	~"commÚ/sm¬t_poš‹r.h
"

18 
usšg
 
Çme¥aû
 
SYSUTILS_SPACE
;

20 
	~"‹¡_uts.h
"

23 
	~<¡ršg
>

24 
	~<veùÜ
>

25 
	~<™”©Ü
>

26 
	~<memÜy
>

27 
	~<m­
>

29 
	~<¡dšt.h
>

30 
	~<sys/¡©.h
>

31 
	~<uni¡d.h
>

32 
	~<scsi/sg_cmds.h
>

33 
	~<scsi/sg_uÇligÃd.h
>

35 
usšg
 
Çme¥aû
 
	g¡d
;

37 
	eeDiskTy³
 {

38 
	mDISK_TYPE_UNKNOWN
 = -1,

39 
	mDISK_TYPE_SATA
,

40 
	mDISK_TYPE_ESATA
,

41 
	mDISK_TYPE_ISCSI
,

42 
	mDISK_TYPE_NFS


45 
	sSGS”ŸlNoPage
 {

46 
ušt8_t
 
	mm_by‹PQPDT
;

47 
ušt8_t
 
	mm_by‹PageCode
;

48 
ušt8_t
 
	mm_by‹Re£rv›d
;

49 
ušt8_t
 
	mm_by‹PageL’gth
;

50 
ušt8_t
 
	mm_by‹PageSN
[32];

53 
	sSGR—dC­ac™y10
 {

54 
ušt8_t
 
	mm_LogiÿlBlockAddr
[4];

55 
ušt8_t
 
	mm_BlockL’gth
[4];

58 
	sMiscDiskInfo
 {

59 
¡ršg
 
	mm_¡rSymLšk
;

60 
¡ršg
 
	mm_¡rMDDev
;

61 
eDiskTy³
 
	mm_diskTy³
;

63 
MiscDiskInfo
()

64 : 
m_¡rSymLšk
("")

65 , 
m_¡rMDDev
("")

66 , 
m_diskTy³
(
DISK_TYPE_UNKNOWN
)

70 
MiscDiskInfo
(cÚ¡ 
¡ršg
& 
lšk
, 
eDiskTy³
 
ty³
)

71 : 
m_¡rSymLšk
(
lšk
)

72 , 
m_¡rMDDev
("")

73 , 
m_diskTy³
(
ty³
)

77 ~
MiscDiskInfo
()

81 
	mMiscDiskInfo
& 
	mİ”©Ü
=(cÚ¡ 
MiscDiskInfo
& 
rhs
)

83 ià(
this
 =ğ&
rhs
)

84  *
this
;

86 
	mm_¡rSymLšk
 = 
rhs
.
m_¡rSymLšk
;

87 
	mm_diskTy³
 = 
rhs
.
m_diskTy³
;

88 
	mm_¡rMDDev
 = 
rhs
.
m_¡rMDDev
;

89  *
	mthis
;

92 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
MiscDiskInfo
& 
rhs
)

94  (
m_¡rSymLšk
 =ğ
rhs
.m_strSymLink);

97 
Dump
()

99 
´štf
("Soft Link: %s, In RAID: %s",

100 
m_¡rSymLšk
.
c_¡r
(), 
m_¡rMDDev
.c_str());

101 
	mm_diskTy³
) {

102 
	mDISK_TYPE_UNKNOWN
:

103 
´štf
(", Type: Unknown\n");

105 
	mDISK_TYPE_SATA
:

106 
´štf
(", Type: SATA\n");

108 
	mDISK_TYPE_ESATA
:

109 
´štf
(", Type: ESATA\n");

111 
	mDISK_TYPE_ISCSI
:

112 
´štf
(", Type: iSCSI\n");

114 
	mDISK_TYPE_NFS
:

115 
´štf
(", Type: NFS\n");

121 
	sRAIDDiskInfo
 {

122 
MiscDiskInfo
 
	mm_miscInfo
;

123 
¡ršg
 
	mm_¡rS‹
;

124 
¡ršg
 
	mm_¡rDevName
;

125 
¡ršg
 
	mm_¡rV’dÜ
;

126 
¡ršg
 
	mm_¡rMod–
;

127 
¡ršg
 
	mm_¡rFœmw¬eV”siÚ
;

128 
¡ršg
 
	mm_¡rS”ŸlNum
;

129 
št64_t
 
	mm_ÎC­ac™y
;

130 
št32_t
 
	mm_RaidUUID
[4];

131 
št32_t
 
	mm_iS‹
;

132 
št32_t
 
	mm_iRaidDiskNum
;

133 
št32_t
 
	mm_iMajÜ
;

134 
št32_t
 
	mm_iMšÜ
;

135 
boŞ
 
	mm_bHasMDSB
;

137 
RAIDDiskInfo
()

138 : 
m_¡rS‹
("")

139 , 
m_¡rDevName
("")

140 , 
m_¡rV’dÜ
("")

141 , 
m_¡rMod–
("")

142 , 
m_¡rFœmw¬eV”siÚ
("")

143 , 
m_¡rS”ŸlNum
("")

144 , 
m_ÎC­ac™y
(0ll)

145 , 
m_iS‹
(0)

146 , 
m_iRaidDiskNum
(0)

147 , 
m_iMajÜ
(0)

148 , 
m_iMšÜ
(0)

149 , 
m_bHasMDSB
(
çl£
)

151 
mem£t
(
m_RaidUUID
, 0x00, (m_RaidUUID));

154 ~
RAIDDiskInfo
() {}

156 
	mRAIDDiskInfo
& 
	mİ”©Ü
=(cÚ¡ 
¬¿y_disk_šfo
& 
rhs
)

158 
m_¡rS‹
 = 
rhs
.
¡rS‹
;

159 
	mm_¡rDevName
 = 
rhs
.
¡rDevName
;

160 
	mm_iS‹
 = 
rhs
.
diskInfo
.
¡©e
;

161 
	mm_iRaidDiskNum
 = 
rhs
.
diskInfo
.
¿id_disk
;

162 
	mm_iMajÜ
 = 
rhs
.
diskInfo
.
majÜ
;

163 
	mm_iMšÜ
 = 
rhs
.
diskInfo
.
mšÜ
;

164 
S‘HDDV’dÜInfom©iÚ
();

165  *
	mthis
;

168 
Dump
()

170 
´štf
("Device: %s, State: %s, MD Super Block: %s, Major: %d, Minor: %d\n\t",

171 
m_¡rDevName
.
c_¡r
(), 
m_¡rS‹
.c_¡r(), 
m_bHasMDSB
 ? "Yes" : "No",

172 
m_iMajÜ
, 
m_iMšÜ
);

173 
	mm_miscInfo
.
Dump
();

176 
S‘HDDV’dÜInfom©iÚ
() {

177 ià(
	mm_¡rDevName
.
em±y
())

180 
sg_sim¶e_šquœy_»¥
 
	m»¥
;

181 
SGS”ŸlNoPage
 
	msg_¢_»¥
;

182 
SGR—dC­ac™y10
 
	msg_»adÿp10_»¥
;

183 
	msg_fd
 = 
sg_cmds_İ’_deviû
(
m_¡rDevName
.
c_¡r
(), 1, 1);

185 ià(
	msg_fd
 < 0)

188 ià(0 =ğ
sg_sim¶e_šquœy
(
sg_fd
, &
»¥
, 0, 0)) {

189 
	mm_¡rV’dÜ
 = 
»¥
.
v’dÜ
;

190 
	mm_¡rMod–
 = 
»¥
.
´oduù
;

191 
	mm_¡rFœmw¬eV”siÚ
 = 
»¥
.
»visiÚ
;

198 ià(0 =ğ
sg_Î_šquœy
(
sg_fd
, 0 ,1 , 0x80,

199 (*)&
sg_¢_»¥
,

200 (
SGS”ŸlNoPage
),

202 
	mm_¡rS”ŸlNum
 = (*)
sg_¢_»¥
.
m_by‹PageSN
;

209 ià(0 =ğ
sg_Î_»adÿp_10
(
sg_fd
, 0, 1,

210 &
sg_»adÿp10_»¥
,

211 (
SGR—dC­ac™y10
),

213 
ušt32_t
 
	mÏ¡_blk_addr
 = 0, 
	mblock_size
 = 0;

214 
	mÏ¡_blk_addr
 = 
sg_g‘_uÇligÃd_be32
(&(
sg_»adÿp10_»¥
.
m_LogiÿlBlockAddr
));

215 ià(0xfffffffà!ğ
Ï¡_blk_addr
) {

216 
block_size
 = 
sg_g‘_uÇligÃd_be32
(&(
sg_»adÿp10_»¥
.
m_BlockL’gth
));

217 
	mm_ÎC­ac™y
 = (
Ï¡_blk_addr
 + 1è* 
block_size
;

225 
sg_cmds_şo£_deviû
(
sg_fd
);

228 
	mRAIDDiskInfo
& 
	mİ”©Ü
=(cÚ¡ 
RAIDDiskInfo
& 
rhs
)

230 ià(
this
 =ğ&
rhs
)

231  *
this
;

232 
	mm_¡rS‹
 = 
rhs
.
m_¡rS‹
;

233 
	mm_¡rDevName
 = 
rhs
.
m_¡rDevName
;

234 
	mm_iS‹
 = 
rhs
.
m_iS‹
;

235 
	mm_iRaidDiskNum
 = 
rhs
.
m_iRaidDiskNum
;

236 
	mm_bHasMDSB
 = 
rhs
.
m_bHasMDSB
;

237 
	mm_iMajÜ
 = 
rhs
.
m_iMajÜ
;

238 
	mm_iMšÜ
 = 
rhs
.
m_iMšÜ
;

239 
S‘HDDV’dÜInfom©iÚ
();

240  *
	mthis
;

243 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
RAIDDiskInfo
& 
rhs
) const

245  (
m_¡rDevName
 =ğ
rhs
.m_strDevName);

248 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
¡ršg
& 
rhs
) const

250  (
rhs
 =ğ
m_¡rDevName
);

254 
	sRAIDInfo
 {

255 #ifdeà
NUUO


256 
	msm¬t_±r
<
	mFesy¡emMªag”
> 
	mm_fsMgr
;

258 
	msh¬ed_±r
<
	mFesy¡emMªag”
> 
	mm_fsMgr
;

260 
	mveùÜ
<
	mRAIDDiskInfo
> 
	mm_vDiskLi¡
;

261 
¡ršg
 
	mm_¡rDevNodeName
;

262 
¡ršg
 
	mm_¡rS‹
;

263 
¡ršg
 
	mm_¡rLayout
;

264 
¡ršg
 
	mm_¡rRebudšgO³¿tiÚ
;

265 
time_t
 
	mm_C»©iÚTime
;

266 
time_t
 
	mm_Upd©eTime
;

267 
ušt32_t
 
	mm_UUID
[4];

268 
št64_t
 
	mm_uÎTÙ®C­ac™y
;

269 
št64_t
 
	mm_uÎU£dSize
;

270 
št32_t
 
	mm_iRAIDLev–
;

271 
št32_t
 
	mm_iTÙ®DiskNum
;

272 
št32_t
 
	mm_iRAIDDiskNum
;

273 
št32_t
 
	mm_iAùiveDiskNum
;

274 
št32_t
 
	mm_iWÜkšgDiskNum
;

275 
št32_t
 
	mm_iFaedDiskNum
;

276 
št32_t
 
	mm_iS·»DiskNum
;

277 
št32_t
 
	mm_iS‹
;

278 
št32_t
 
	mm_iChunkSize
;

279 
št32_t
 
	mm_iRebudšgProg»ss
;

280 
št32_t
 
	mm_iMDNum
;

281 
boŞ
 
	mm_bSu³rBlockP”si¡’t
;

282 
boŞ
 
	mm_bIÇùive
;

283 
boŞ
 
	mm_bRebudšg
;

285 
RAIDInfo
()

286 : 
m_fsMgr
(
NULL
)

287 , 
m_¡rDevNodeName
("")

288 , 
m_¡rS‹
("")

289 , 
m_¡rLayout
("")

290 , 
m_¡rRebudšgO³¿tiÚ
("")

291 , 
m_C»©iÚTime
(0)

292 , 
m_Upd©eTime
(0)

293 , 
m_uÎTÙ®C­ac™y
(0ull)

294 , 
m_uÎU£dSize
(0ull)

295 , 
m_iRAIDLev–
(
UnS‘
)

296 , 
m_iTÙ®DiskNum
(0)

297 , 
m_iRAIDDiskNum
(0)

298 , 
m_iAùiveDiskNum
(0)

299 , 
m_iWÜkšgDiskNum
(0)

300 , 
m_iFaedDiskNum
(0)

301 , 
m_iS·»DiskNum
(0)

302 , 
m_iS‹
(0)

303 , 
m_iChunkSize
(512)

304 , 
m_iRebudšgProg»ss
(-1)

305 , 
m_iMDNum
(-1)

306 , 
m_bSu³rBlockP”si¡’t
(
çl£
)

307 , 
m_bIÇùive
(
çl£
)

308 , 
m_bRebudšg
(
çl£
)

310 
	mi
 = 0; i < 4; i ++)

311 
	mm_UUID
[
i
] = 0;

314 ~
RAIDInfo
() {

315 
	mm_fsMgr
 = 
NULL
;

318 
boŞ
 
In™ŸlizeFSMªag”
() {

319 
	mŒy
 {

320 #ifdeà
NUUO


321 
	mm_fsMgr
 = 
Ãw
 
Fesy¡emMªag”
;

323 
	mm_fsMgr
 = 
sh¬ed_±r
<
Fesy¡emMªag”
>(
Ãw
 FilesystemManager);

325 ià(!
	mm_fsMgr
->
S‘DeviûNode
(
m_¡rDevNodeName
)) {

326 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, "RAIDInfo",

328  
	mçl£
;

330 } 
ÿtch
 (
bad_®loc
&) {

331 
	mm_fsMgr
 = 
NULL
;

332 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, "RAIDInfo",

334  
	mçl£
;

337  
	mŒue
;

340 
	mRAIDInfo
& 
	mİ”©Ü
=(cÚ¡ 
¬¿y_d‘a
& 
rhs
)

342 
m_vDiskLi¡
.
ş—r
();

343 
	mi
 = 0; i < 
	mrhs
.
	m¬¿yInfo
.
	mÄ_disks
; i++) {

344 
RAIDDiskInfo
 
	mšfo
;

345 ià(
	mrhs
.
	m¬¿yDisks
[
i
].
	mdiskInfo
.
	mmajÜ
 == 0 &&

346 
rhs
.
¬¿yDisks
[
i
].
diskInfo
.
mšÜ
 == 0)

349 
	mšfo
 = 
rhs
.
¬¿yDisks
[
i
];

350 
	mm_vDiskLi¡
.
push_back
(
šfo
);

353 
	mm_¡rS‹
 = 
rhs
.
¡rA¼ayS‹
;

354 
	mm_¡rLayout
 = 
rhs
.
¡rRaidLayout
;

355 
	mm_¡rRebudšgO³¿tiÚ
 = 
rhs
.
¡rRebudO³¿tiÚ
;

356 
	mm_¡rDevNodeName
 = 
rhs
.
¡rA¼ayDevName
;

357 
memıy
(
m_UUID
, 
rhs
.
uuid
, (m_UUID));

358 
	mm_uÎTÙ®C­ac™y
 = 
rhs
.
uÎA¼aySize
;

359 
	mm_uÎU£dSize
 = 
rhs
.
uÎU£dSize
;

360 
	mm_iRAIDLev–
 = 
rhs
.
¬¿yInfo
.
Ëv–
;

361 
	mm_iTÙ®DiskNum
 = 
rhs
.
¬¿yInfo
.
Ä_disks
;

362 
	mm_iRAIDDiskNum
 = 
rhs
.
¬¿yInfo
.
¿id_disks
;

363 
	mm_iAùiveDiskNum
 = 
rhs
.
¬¿yInfo
.
aùive_disks
;

364 
	mm_iWÜkšgDiskNum
 = 
rhs
.
¬¿yInfo
.
wÜkšg_disks
;

365 
	mm_iFaedDiskNum
 = 
rhs
.
¬¿yInfo
.
çed_disks
;

366 
	mm_iS·»DiskNum
 = 
rhs
.
¬¿yInfo
.
¥¬e_disks
;

367 
	mm_iS‹
 = 
rhs
.
¬¿yInfo
.
¡©e
;

368 
	mm_iChunkSize
 = 
rhs
.
¬¿yInfo
.
chunk_size
;

369 
	mm_iRebudšgProg»ss
 = 
rhs
.
iRebudProg»ss
;

370 
	mm_bRebudšg
 = 
rhs
.
bIsRebudšg
 =ğ1 ? 
Œue
 : 
çl£
;

371 
	mm_bIÇùive
 = 
rhs
.
bIÇùive
 =ğ1 ? 
Œue
 : 
çl£
;

372 
	mm_bSu³rBlockP”si¡’t
 = 
rhs
.
bIsSu³rBlockP”si¡’t
 =ğ1 ? 
Œue
 : 
çl£
;

373 
	mm_C»©iÚTime
 = 
rhs
.
¬¿yInfo
.
ùime
;

374 
	mm_Upd©eTime
 = 
rhs
.
¬¿yInfo
.
utime
;

376  *
	mthis
;

379 
	mRAIDInfo
& 
	mİ”©Ü
=(cÚ¡ 
RAIDInfo
& 
rhs
)

381 ià(
this
 =ğ&
rhs
)

382  *
this
;

384 
	mm_vDiskLi¡
.
ş—r
();

385 
size_t
 
	mi
 = 0; i < 
	mrhs
.
	mm_vDiskLi¡
.
size
(); i++) {

386 
	mm_vDiskLi¡
.
push_back
(
rhs
.
m_vDiskLi¡
[
i
]);

389 
	mm_¡rS‹
 = 
rhs
.
m_¡rS‹
;

390 
	mm_¡rLayout
 = 
rhs
.
m_¡rLayout
;

391 
	mm_¡rRebudšgO³¿tiÚ
 = 
rhs
.
m_¡rRebudšgO³¿tiÚ
;

392 
	mm_¡rDevNodeName
 = 
rhs
.
m_¡rDevNodeName
;

393 
memıy
(
m_UUID
, 
rhs
.m_UUID, (m_UUID));

394 
	mm_uÎTÙ®C­ac™y
 = 
rhs
.
m_uÎTÙ®C­ac™y
;

395 
	mm_uÎU£dSize
 = 
rhs
.
m_uÎU£dSize
;

396 
	mm_iRAIDLev–
 = 
rhs
.
m_iRAIDLev–
;

397 
	mm_iTÙ®DiskNum
 = 
rhs
.
m_iTÙ®DiskNum
;

398 
	mm_iRAIDDiskNum
 = 
rhs
.
m_iRAIDDiskNum
;

399 
	mm_iAùiveDiskNum
 = 
rhs
.
m_iAùiveDiskNum
;

400 
	mm_iWÜkšgDiskNum
 = 
rhs
.
m_iWÜkšgDiskNum
;

401 
	mm_iFaedDiskNum
 = 
rhs
.
m_iFaedDiskNum
;

402 
	mm_iS·»DiskNum
 = 
rhs
.
m_iS·»DiskNum
;

403 
	mm_iS‹
 = 
rhs
.
m_iS‹
;

404 
	mm_iChunkSize
 = 
rhs
.
m_iChunkSize
;

405 
	mm_iRebudšgProg»ss
 = 
rhs
.
m_iRebudšgProg»ss
;

406 
	mm_bRebudšg
 = 
rhs
.
m_bRebudšg
;

407 
	mm_bIÇùive
 = 
rhs
.
m_bIÇùive
;

408 
	mm_bSu³rBlockP”si¡’t
 = 
rhs
.
m_bSu³rBlockP”si¡’t
;

409 
	mm_C»©iÚTime
 = 
rhs
.
m_C»©iÚTime
;

410 
	mm_Upd©eTime
 = 
rhs
.
m_Upd©eTime
;

411 
	mm_fsMgr
 = 
rhs
.
m_fsMgr
;

412 
	mm_iMDNum
 = 
rhs
.
m_iMDNum
;

414  *
	mthis
;

417 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
RAIDInfo
& 
rhs
) const

419  (
m_¡rDevNodeName
 =ğ
rhs
.m_strDevNodeName &&

420 0 =ğ
memcmp
(
rhs
.
m_UUID
, m_UUID, (m_UUID)));

423 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
¡ršg
& 
rhs
) const

425  (
m_¡rDevNodeName
 =ğ
rhs
);

428 
boŞ
 
IsRAIDStusChªged
(cÚ¡ 
RAIDInfo
& 
´evious
) {

429  !(
	mm_Upd©eTime
 =ğ
´evious
.
m_Upd©eTime
 &&

430 
m_iFaedDiskNum
 =ğ
´evious
.m_iFailedDiskNum &&

431 
m_iWÜkšgDiskNum
 =ğ
´evious
.m_iWorkingDiskNum &&

432 
m_iS·»DiskNum
 =ğ
´evious
.m_iSpareDiskNum);

435 
Dump
()

437 
´štf
("Device: %s\n"

443 
m_¡rDevNodeName
.
c_¡r
(), 
m_¡rS‹
.c_str(),

444 
m_iRAIDLev–
, 
m_iChunkSize
,

445 
m_uÎTÙ®C­ac™y
, 
m_uÎU£dSize
,

446 
m_iTÙ®DiskNum
, 
m_iRAIDDiskNum
, 
m_iAùiveDiskNum
,

447 
m_iWÜkšgDiskNum
, 
m_iFaedDiskNum
, 
m_iS·»DiskNum
,

448 
ùime
(&
m_C»©iÚTime
), ctime(&
m_Upd©eTime
),

449 
m_bRebudšg
?"Yes":"No", (
m_iRebudšgProg»ss
 < 0)?100:m_iRebuildingProgress

452 ià(
	mm_fsMgr
.
g‘
(è!ğ
NULL
)

453 
m_fsMgr
->
Dump
();

454 
´štf
("\n");

456 
size_t
 
	mi
 =0 ; i < 
	mm_vDiskLi¡
.
size
(); i++) {

457 
´štf
("\t");

458 
	mm_vDiskLi¡
[
i
].
Dump
();

460 
´štf
("\n");

464 şas 
	cRAIDMªag”
 {

465 
	m´iv©e
:

466 
veùÜ
<
RAIDInfo
> 
m_vRAIDInfoLi¡
;

467 
	mveùÜ
<
	mRAIDDiskInfo
> 
	mm_vRAIDDiskLi¡
;

468 
	mm­
<
	m¡ršg
, 
	mMiscDiskInfo
> 
	mm_m­SymLškTabË
;

470 
Cr™iÿlSeùiÚ
 
	mm_csRAIDInfoLi¡
;

471 
Cr™iÿlSeùiÚ
 
	mm_csRAIDDiskLi¡
;

472 
Cr™iÿlSeùiÚ
 
	mm_csU£dMD
;

473 
Cr™iÿlSeùiÚ
 
	mm_csU£dVŞume
;

474 
Cr™iÿlSeùiÚ
 
	mm_csSymLškTabË
;

476 
boŞ
 
	mm_bU£dMD
[128];

477 
boŞ
 
	mm_bU£dVŞume
[128];

479 
	m´iv©e
:

480 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
S—rchDiskB–Úg2RAID
(
RAIDDiskInfo
& 
devInfo
);

482 
In™ŸlizeSh­e
(
sh­e
& 
s
, 
¿iddisks
, 
Ëv–
, 
chunk
 = 512, 
b™m­_chunk
 = 
UnS‘
, * 
b™m­_fe
 = 
NULL
);

483 #ifdeà
DEBUG


484 
In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
 = 1, 
run¡İ
 = 1, 
v”bo£
 = 1);

486 
In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
 = 1, 
run¡İ
 = 1, 
v”bo£
 = 0);

488 
In™ŸlizeMDDevId’t
(
mddev_id’t
& 
id’t
, 
uuid_£t
, cÚ¡ 
uuid
[4], 
b™m­_fd
 = -1, * 
b™m­_fe
 = 
NULL
);

489 
mddev_dev
* 
In™ŸlizeDevLi¡
(
veùÜ
<
¡ršg
>& 
devNameLi¡
, 
di¥os™iÚ
 = 0);

490 
mddev_dev
* 
In™ŸlizeDevLi¡
(cÚ¡ 
¡ršg
& 
»¶aû
, cÚ¡ sŒšg& 
w™h
);

491 
F»eDevLi¡
(
mddev_dev
* 
devli¡
);

492 
O³nMDDev
(cÚ¡ 
¡ršg
& 
mddev
);

494 
C»©eRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
);

495 
C»©eRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
);

496 
As£mbËRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4]);

497 
As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4]);

498 
As£mbËRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

499 
As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

500 
G‘F»eMDNum
();

501 
F»eMDNum
(
n
);

502 
S‘MDNum
(
n
);

503 
G‘F»eVŞumeNum
();

504 
F»eVŞumeNum
(
n
);

505 
S‘VŞumeNum
(
n
);

507 
Upd©eRAIDDiskLi¡
(
veùÜ
<
RAIDDiskInfo
>& 
vRAIDDiskInfoLi¡
, cÚ¡ 
¡ršg
& 
mddev
);

508 
boŞ
 
MªageRAIDSubdevs
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
İ”©iÚ
);

509 
	mveùÜ
<
	mRAIDInfo
>::
™”©Ü
 
IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
);

510 
	mveùÜ
<
	mRAIDInfo
>::
™”©Ü
 
IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
, 
RAIDInfo
& 
šfo
);

511 
boŞ
 
IsDiskExi¡InRAIDDiskLi¡
(cÚ¡ 
¡ršg
& 
dev
);

512 
boŞ
 
IsDiskExi¡InRAIDDiskLi¡
(
veùÜ
<
¡ršg
>& 
vDevLi¡
);

513 
¡ršg
 
G’”©eMDDevName
(
num
);

514 
G’”©eVŞumeName
(
¡ršg
& 
Çme
);

516 
boŞ
 
IsDiskHaveMDSu³rBlock
(cÚ¡ 
¡ršg
& 
dev
, 
examše_»suÉ
 &
»suÉ
, &
”r
);

518 
boŞ
 
G‘RAIDD‘a
(cÚ¡ 
¡ršg
& 
mddev
, 
¬¿y_d‘a
 &
ad
);

519 
boŞ
 
IsRAIDAbnÜm®
(cÚ¡ 
RAIDInfo
 &
šfo
);

521 
	mpublic
:

522 
RAIDMªag”
();

523 ~
RAIDMªag”
();

525 
boŞ
 
AddDiskSymLšk
(cÚ¡ 
¡ršg
& 
symlšk
, 
eDiskTy³
 
ty³
);

526 
boŞ
 
RemoveDiskSymLšk
(cÚ¡ 
¡ršg
& 
symlšk
);

527 
boŞ
 
AddDisk
(cÚ¡ 
¡ršg
& 
dev
);

528 
boŞ
 
RemoveDisk
(cÚ¡ 
¡ršg
& 
dev
);

530 
boŞ
 
C»©eRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, 
Ëv–
, sŒšg& 
¡rMDName
);

531 
boŞ
 
As£mbËRAID
(cÚ¡ 
uuid
[4], 
¡ršg
& 
¡rMDName
);

532 
boŞ
 
As£mbËRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, sŒšg& 
¡rMDName
);

533 
boŞ
 
RemoveMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

534 
boŞ
 
M¬kFauÉyMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

535 
boŞ
 
AddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

536 
boŞ
 
R—ddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

537 
boŞ
 
R•ÏûMDDisk
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ sŒšg& 
»¶aû
, cÚ¡ sŒšg& 
w™h
);

538 
boŞ
 
D–‘eRAID
(cÚ¡ 
¡ršg
& 
mddev
);

539 
boŞ
 
StİRAID
(cÚ¡ 
¡ršg
& 
mddev
);

541 
boŞ
 
G‘RAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
RAIDInfo
& 
šfo
);

542 
G‘RAIDInfo
(
veùÜ
<
RAIDInfo
>& 
li¡
);

543 
G‘DisksInfo
(
veùÜ
<
RAIDDiskInfo
> &
li¡
);

544 
boŞ
 
G‘DisksInfo
(cÚ¡ 
¡ršg
& 
dev
, 
RAIDDiskInfo
 &
šfo
);

545 
boŞ
 
G‘DisksInfoBySymLšk
(cÚ¡ 
¡ršg
& 
lšk
, 
RAIDDiskInfo
 &
šfo
);

546 
boŞ
 
G‘DisksInfoBySymLšk
(
veùÜ
<
RAIDDiskInfo
> &
li¡
);

548 
boŞ
 
Upd©eRAIDInfo
();

549 
boŞ
 
Upd©eRAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
mdnum
 = -1);

550 
boŞ
 
Upd©eRAIDInfo
(cÚ¡ 
uuid
[4]);

552 
boŞ
 
CheckFeSy¡em
();

553 
boŞ
 
DoFeSy¡emRecov”y
();

554 
boŞ
 
G‘FeSy¡emStus
();

556 
boŞ
 
FÜm©
(cÚ¡ 
¡ršg
& 
mddev
);

557 
boŞ
 
MouÁ
(cÚ¡ 
¡ršg
& 
mddev
);

558 
boŞ
 
UnmouÁ
(cÚ¡ 
¡ršg
& 
mddev
);

559 
boŞ
 
G‘FÜm©Prog»ss
(cÚ¡ 
¡ršg
& 
mddev
,

560 & 
¡©
, & 
´og»ss
);

561 
boŞ
 
IsMouÁed
(cÚ¡ 
¡ršg
& 
mddev
, &
num
);

562 
boŞ
 
IsFÜm©ed
(cÚ¡ 
¡ršg
& 
mddev
);

564 
Dump
();

566 
¡ršg
 
G‘DeviûNodeBySymLšk
(cÚ¡ sŒšg& 
symlšk
);

	@RAIDManager.h

1 #iâdeà
__RAIDMANAGER_H__


2 
	#__RAIDMANAGER_H__


	)

4 #ifdeà
__ılu¥lus


7 
	~"libmdadm/mdadm.h
"

8 #ifdeà
__ılu¥lus


12 
	~"Fesy¡emMªag”.h
"

14 #ifdeà
NUUO


15 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

16 
	~"commÚ/nusy¦og.h
"

17 
	~"commÚ/sm¬t_poš‹r.h
"

18 
usšg
 
Çme¥aû
 
SYSUTILS_SPACE
;

20 
	~"‹¡_uts.h
"

23 
	~<¡ršg
>

24 
	~<veùÜ
>

25 
	~<™”©Ü
>

26 
	~<memÜy
>

27 
	~<m­
>

29 
	~<¡dšt.h
>

30 
	~<sys/¡©.h
>

31 
	~<uni¡d.h
>

32 
	~<scsi/sg_cmds.h
>

33 
	~<scsi/sg_uÇligÃd.h
>

35 
usšg
 
Çme¥aû
 
	g¡d
;

37 
	eeDiskTy³
 {

38 
	mDISK_TYPE_UNKNOWN
 = -1,

39 
	mDISK_TYPE_SATA
,

40 
	mDISK_TYPE_ESATA
,

41 
	mDISK_TYPE_ISCSI
,

42 
	mDISK_TYPE_NFS


45 
	sSGS”ŸlNoPage
 {

46 
ušt8_t
 
	mm_by‹PQPDT
;

47 
ušt8_t
 
	mm_by‹PageCode
;

48 
ušt8_t
 
	mm_by‹Re£rv›d
;

49 
ušt8_t
 
	mm_by‹PageL’gth
;

50 
ušt8_t
 
	mm_by‹PageSN
[32];

53 
	sSGR—dC­ac™y10
 {

54 
ušt8_t
 
	mm_LogiÿlBlockAddr
[4];

55 
ušt8_t
 
	mm_BlockL’gth
[4];

58 
	sMiscDiskInfo
 {

59 
¡ršg
 
	mm_¡rSymLšk
;

60 
¡ršg
 
	mm_¡rMDDev
;

61 
eDiskTy³
 
	mm_diskTy³
;

63 
MiscDiskInfo
()

64 : 
m_¡rSymLšk
("")

65 , 
m_¡rMDDev
("")

66 , 
m_diskTy³
(
DISK_TYPE_UNKNOWN
)

70 
MiscDiskInfo
(cÚ¡ 
¡ršg
& 
lšk
, 
eDiskTy³
 
ty³
)

71 : 
m_¡rSymLšk
(
lšk
)

72 , 
m_¡rMDDev
("")

73 , 
m_diskTy³
(
ty³
)

77 ~
MiscDiskInfo
()

81 
	mMiscDiskInfo
& 
	mİ”©Ü
=(cÚ¡ 
MiscDiskInfo
& 
rhs
)

83 ià(
this
 =ğ&
rhs
)

84  *
this
;

86 
	mm_¡rSymLšk
 = 
rhs
.
m_¡rSymLšk
;

87 
	mm_diskTy³
 = 
rhs
.
m_diskTy³
;

88 
	mm_¡rMDDev
 = 
rhs
.
m_¡rMDDev
;

89  *
	mthis
;

92 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
MiscDiskInfo
& 
rhs
)

94  (
m_¡rSymLšk
 =ğ
rhs
.m_strSymLink);

97 
Dump
()

99 
´štf
("Soft Link: %s, In RAID: %s",

100 
m_¡rSymLšk
.
c_¡r
(), 
m_¡rMDDev
.c_str());

101 
	mm_diskTy³
) {

102 
	mDISK_TYPE_UNKNOWN
:

103 
´štf
(", Type: Unknown\n");

105 
	mDISK_TYPE_SATA
:

106 
´štf
(", Type: SATA\n");

108 
	mDISK_TYPE_ESATA
:

109 
´štf
(", Type: ESATA\n");

111 
	mDISK_TYPE_ISCSI
:

112 
´štf
(", Type: iSCSI\n");

114 
	mDISK_TYPE_NFS
:

115 
´štf
(", Type: NFS\n");

121 
	sRAIDDiskInfo
 {

122 
MiscDiskInfo
 
	mm_miscInfo
;

123 
¡ršg
 
	mm_¡rS‹
;

124 
¡ršg
 
	mm_¡rDevName
;

125 
¡ršg
 
	mm_¡rV’dÜ
;

126 
¡ršg
 
	mm_¡rMod–
;

127 
¡ršg
 
	mm_¡rFœmw¬eV”siÚ
;

128 
¡ršg
 
	mm_¡rS”ŸlNum
;

129 
št64_t
 
	mm_ÎC­ac™y
;

130 
št32_t
 
	mm_RaidUUID
[4];

131 
št32_t
 
	mm_iS‹
;

132 
št32_t
 
	mm_iRaidDiskNum
;

133 
št32_t
 
	mm_iMajÜ
;

134 
št32_t
 
	mm_iMšÜ
;

135 
boŞ
 
	mm_bHasMDSB
;

137 
RAIDDiskInfo
()

138 : 
m_¡rS‹
("")

139 , 
m_¡rDevName
("")

140 , 
m_¡rV’dÜ
("")

141 , 
m_¡rMod–
("")

142 , 
m_¡rFœmw¬eV”siÚ
("")

143 , 
m_¡rS”ŸlNum
("")

144 , 
m_ÎC­ac™y
(0ll)

145 , 
m_iS‹
(0)

146 , 
m_iRaidDiskNum
(0)

147 , 
m_iMajÜ
(0)

148 , 
m_iMšÜ
(0)

149 , 
m_bHasMDSB
(
çl£
)

151 
mem£t
(
m_RaidUUID
, 0x00, (m_RaidUUID));

154 ~
RAIDDiskInfo
() {}

156 
	mRAIDDiskInfo
& 
	mİ”©Ü
=(cÚ¡ 
¬¿y_disk_šfo
& 
rhs
)

158 
m_¡rS‹
 = 
rhs
.
¡rS‹
;

159 
	mm_¡rDevName
 = 
rhs
.
¡rDevName
;

160 
	mm_iS‹
 = 
rhs
.
diskInfo
.
¡©e
;

161 
	mm_iRaidDiskNum
 = 
rhs
.
diskInfo
.
¿id_disk
;

162 
	mm_iMajÜ
 = 
rhs
.
diskInfo
.
majÜ
;

163 
	mm_iMšÜ
 = 
rhs
.
diskInfo
.
mšÜ
;

164 
S‘HDDV’dÜInfom©iÚ
();

165  *
	mthis
;

168 
Dump
()

170 
´štf
("Device: %s, State: %s, MD Super Block: %s, Major: %d, Minor: %d\n\t",

171 
m_¡rDevName
.
c_¡r
(), 
m_¡rS‹
.c_¡r(), 
m_bHasMDSB
 ? "Yes" : "No",

172 
m_iMajÜ
, 
m_iMšÜ
);

173 
	mm_miscInfo
.
Dump
();

176 
S‘HDDV’dÜInfom©iÚ
() {

177 ià(
	mm_¡rDevName
.
em±y
())

180 
sg_sim¶e_šquœy_»¥
 
	m»¥
;

181 
SGS”ŸlNoPage
 
	msg_¢_»¥
;

182 
SGR—dC­ac™y10
 
	msg_»adÿp10_»¥
;

183 
	msg_fd
 = 
sg_cmds_İ’_deviû
(
m_¡rDevName
.
c_¡r
(), 1, 1);

185 ià(
	msg_fd
 < 0)

188 ià(0 =ğ
sg_sim¶e_šquœy
(
sg_fd
, &
»¥
, 0, 0)) {

189 
	mm_¡rV’dÜ
 = 
»¥
.
v’dÜ
;

190 
	mm_¡rMod–
 = 
»¥
.
´oduù
;

191 
	mm_¡rFœmw¬eV”siÚ
 = 
»¥
.
»visiÚ
;

198 ià(0 =ğ
sg_Î_šquœy
(
sg_fd
, 0 ,1 , 0x80,

199 (*)&
sg_¢_»¥
,

200 (
SGS”ŸlNoPage
),

202 
	mm_¡rS”ŸlNum
 = (*)
sg_¢_»¥
.
m_by‹PageSN
;

209 ià(0 =ğ
sg_Î_»adÿp_10
(
sg_fd
, 0, 1,

210 &
sg_»adÿp10_»¥
,

211 (
SGR—dC­ac™y10
),

213 
ušt32_t
 
	mÏ¡_blk_addr
 = 0, 
	mblock_size
 = 0;

214 
	mÏ¡_blk_addr
 = 
sg_g‘_uÇligÃd_be32
(&(
sg_»adÿp10_»¥
.
m_LogiÿlBlockAddr
));

215 ià(0xfffffffà!ğ
Ï¡_blk_addr
) {

216 
block_size
 = 
sg_g‘_uÇligÃd_be32
(&(
sg_»adÿp10_»¥
.
m_BlockL’gth
));

217 
	mm_ÎC­ac™y
 = (
Ï¡_blk_addr
 + 1è* 
block_size
;

225 
sg_cmds_şo£_deviû
(
sg_fd
);

228 
	mRAIDDiskInfo
& 
	mİ”©Ü
=(cÚ¡ 
RAIDDiskInfo
& 
rhs
)

230 ià(
this
 =ğ&
rhs
)

231  *
this
;

232 
	mm_¡rS‹
 = 
rhs
.
m_¡rS‹
;

233 
	mm_¡rDevName
 = 
rhs
.
m_¡rDevName
;

234 
	mm_iS‹
 = 
rhs
.
m_iS‹
;

235 
	mm_iRaidDiskNum
 = 
rhs
.
m_iRaidDiskNum
;

236 
	mm_bHasMDSB
 = 
rhs
.
m_bHasMDSB
;

237 
	mm_iMajÜ
 = 
rhs
.
m_iMajÜ
;

238 
	mm_iMšÜ
 = 
rhs
.
m_iMšÜ
;

239 
S‘HDDV’dÜInfom©iÚ
();

240  *
	mthis
;

243 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
RAIDDiskInfo
& 
rhs
) const

245  (
m_¡rDevName
 =ğ
rhs
.m_strDevName);

248 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
¡ršg
& 
rhs
) const

250  (
rhs
 =ğ
m_¡rDevName
);

254 
	sRAIDInfo
 {

255 #ifdeà
NUUO


256 
	msm¬t_±r
<
	mFesy¡emMªag”
> 
	mm_fsMgr
;

258 
	msh¬ed_±r
<
	mFesy¡emMªag”
> 
	mm_fsMgr
;

260 
	mveùÜ
<
	mRAIDDiskInfo
> 
	mm_vDiskLi¡
;

261 
¡ršg
 
	mm_¡rDevNodeName
;

262 
¡ršg
 
	mm_¡rS‹
;

263 
¡ršg
 
	mm_¡rLayout
;

264 
¡ršg
 
	mm_¡rRebudšgO³¿tiÚ
;

265 
time_t
 
	mm_C»©iÚTime
;

266 
time_t
 
	mm_Upd©eTime
;

267 
ušt32_t
 
	mm_UUID
[4];

268 
št64_t
 
	mm_uÎTÙ®C­ac™y
;

269 
št64_t
 
	mm_uÎU£dSize
;

270 
št32_t
 
	mm_iRAIDLev–
;

271 
št32_t
 
	mm_iTÙ®DiskNum
;

272 
št32_t
 
	mm_iRAIDDiskNum
;

273 
št32_t
 
	mm_iAùiveDiskNum
;

274 
št32_t
 
	mm_iWÜkšgDiskNum
;

275 
št32_t
 
	mm_iFaedDiskNum
;

276 
št32_t
 
	mm_iS·»DiskNum
;

277 
št32_t
 
	mm_iS‹
;

278 
št32_t
 
	mm_iChunkSize
;

279 
št32_t
 
	mm_iRebudšgProg»ss
;

280 
št32_t
 
	mm_iMDNum
;

281 
boŞ
 
	mm_bSu³rBlockP”si¡’t
;

282 
boŞ
 
	mm_bIÇùive
;

283 
boŞ
 
	mm_bRebudšg
;

285 
RAIDInfo
()

286 : 
m_fsMgr
(
NULL
)

287 , 
m_¡rDevNodeName
("")

288 , 
m_¡rS‹
("")

289 , 
m_¡rLayout
("")

290 , 
m_¡rRebudšgO³¿tiÚ
("")

291 , 
m_C»©iÚTime
(0)

292 , 
m_Upd©eTime
(0)

293 , 
m_uÎTÙ®C­ac™y
(0ull)

294 , 
m_uÎU£dSize
(0ull)

295 , 
m_iRAIDLev–
(
UnS‘
)

296 , 
m_iTÙ®DiskNum
(0)

297 , 
m_iRAIDDiskNum
(0)

298 , 
m_iAùiveDiskNum
(0)

299 , 
m_iWÜkšgDiskNum
(0)

300 , 
m_iFaedDiskNum
(0)

301 , 
m_iS·»DiskNum
(0)

302 , 
m_iS‹
(0)

303 , 
m_iChunkSize
(512)

304 , 
m_iRebudšgProg»ss
(-1)

305 , 
m_iMDNum
(-1)

306 , 
m_bSu³rBlockP”si¡’t
(
çl£
)

307 , 
m_bIÇùive
(
çl£
)

308 , 
m_bRebudšg
(
çl£
)

310 
	mi
 = 0; i < 4; i ++)

311 
	mm_UUID
[
i
] = 0;

314 ~
RAIDInfo
() {

315 
	mm_fsMgr
 = 
NULL
;

318 
boŞ
 
In™ŸlizeFSMªag”
() {

319 
	mŒy
 {

320 #ifdeà
NUUO


321 
	mm_fsMgr
 = 
Ãw
 
Fesy¡emMªag”
;

323 
	mm_fsMgr
 = 
sh¬ed_±r
<
Fesy¡emMªag”
>(
Ãw
 FilesystemManager);

325 ià(!
	mm_fsMgr
->
S‘DeviûNode
(
m_¡rDevNodeName
)) {

326 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, "RAIDInfo",

328  
	mçl£
;

330 } 
ÿtch
 (
bad_®loc
&) {

331 
	mm_fsMgr
 = 
NULL
;

332 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, "RAIDInfo",

334  
	mçl£
;

337  
	mŒue
;

340 
	mRAIDInfo
& 
	mİ”©Ü
=(cÚ¡ 
¬¿y_d‘a
& 
rhs
)

342 
m_vDiskLi¡
.
ş—r
();

343 
	mi
 = 0; i < 
	mrhs
.
	m¬¿yInfo
.
	mÄ_disks
; i++) {

344 
RAIDDiskInfo
 
	mšfo
;

345 ià(
	mrhs
.
	m¬¿yDisks
[
i
].
	mdiskInfo
.
	mmajÜ
 == 0 &&

346 
rhs
.
¬¿yDisks
[
i
].
diskInfo
.
mšÜ
 == 0)

349 
	mšfo
 = 
rhs
.
¬¿yDisks
[
i
];

350 
	mm_vDiskLi¡
.
push_back
(
šfo
);

353 
	mm_¡rS‹
 = 
rhs
.
¡rA¼ayS‹
;

354 
	mm_¡rLayout
 = 
rhs
.
¡rRaidLayout
;

355 
	mm_¡rRebudšgO³¿tiÚ
 = 
rhs
.
¡rRebudO³¿tiÚ
;

356 
	mm_¡rDevNodeName
 = 
rhs
.
¡rA¼ayDevName
;

357 
memıy
(
m_UUID
, 
rhs
.
uuid
, (m_UUID));

358 
	mm_uÎTÙ®C­ac™y
 = 
rhs
.
uÎA¼aySize
;

359 
	mm_uÎU£dSize
 = 
rhs
.
uÎU£dSize
;

360 
	mm_iRAIDLev–
 = 
rhs
.
¬¿yInfo
.
Ëv–
;

361 
	mm_iTÙ®DiskNum
 = 
rhs
.
¬¿yInfo
.
Ä_disks
;

362 
	mm_iRAIDDiskNum
 = 
rhs
.
¬¿yInfo
.
¿id_disks
;

363 
	mm_iAùiveDiskNum
 = 
rhs
.
¬¿yInfo
.
aùive_disks
;

364 
	mm_iWÜkšgDiskNum
 = 
rhs
.
¬¿yInfo
.
wÜkšg_disks
;

365 
	mm_iFaedDiskNum
 = 
rhs
.
¬¿yInfo
.
çed_disks
;

366 
	mm_iS·»DiskNum
 = 
rhs
.
¬¿yInfo
.
¥¬e_disks
;

367 
	mm_iS‹
 = 
rhs
.
¬¿yInfo
.
¡©e
;

368 
	mm_iChunkSize
 = 
rhs
.
¬¿yInfo
.
chunk_size
;

369 
	mm_iRebudšgProg»ss
 = 
rhs
.
iRebudProg»ss
;

370 
	mm_bRebudšg
 = 
rhs
.
bIsRebudšg
 =ğ1 ? 
Œue
 : 
çl£
;

371 
	mm_bIÇùive
 = 
rhs
.
bIÇùive
 =ğ1 ? 
Œue
 : 
çl£
;

372 
	mm_bSu³rBlockP”si¡’t
 = 
rhs
.
bIsSu³rBlockP”si¡’t
 =ğ1 ? 
Œue
 : 
çl£
;

373 
	mm_C»©iÚTime
 = 
rhs
.
¬¿yInfo
.
ùime
;

374 
	mm_Upd©eTime
 = 
rhs
.
¬¿yInfo
.
utime
;

376  *
	mthis
;

379 
	mRAIDInfo
& 
	mİ”©Ü
=(cÚ¡ 
RAIDInfo
& 
rhs
)

381 ià(
this
 =ğ&
rhs
)

382  *
this
;

384 
	mm_vDiskLi¡
.
ş—r
();

385 
size_t
 
	mi
 = 0; i < 
	mrhs
.
	mm_vDiskLi¡
.
size
(); i++) {

386 
	mm_vDiskLi¡
.
push_back
(
rhs
.
m_vDiskLi¡
[
i
]);

389 
	mm_¡rS‹
 = 
rhs
.
m_¡rS‹
;

390 
	mm_¡rLayout
 = 
rhs
.
m_¡rLayout
;

391 
	mm_¡rRebudšgO³¿tiÚ
 = 
rhs
.
m_¡rRebudšgO³¿tiÚ
;

392 
	mm_¡rDevNodeName
 = 
rhs
.
m_¡rDevNodeName
;

393 
memıy
(
m_UUID
, 
rhs
.m_UUID, (m_UUID));

394 
	mm_uÎTÙ®C­ac™y
 = 
rhs
.
m_uÎTÙ®C­ac™y
;

395 
	mm_uÎU£dSize
 = 
rhs
.
m_uÎU£dSize
;

396 
	mm_iRAIDLev–
 = 
rhs
.
m_iRAIDLev–
;

397 
	mm_iTÙ®DiskNum
 = 
rhs
.
m_iTÙ®DiskNum
;

398 
	mm_iRAIDDiskNum
 = 
rhs
.
m_iRAIDDiskNum
;

399 
	mm_iAùiveDiskNum
 = 
rhs
.
m_iAùiveDiskNum
;

400 
	mm_iWÜkšgDiskNum
 = 
rhs
.
m_iWÜkšgDiskNum
;

401 
	mm_iFaedDiskNum
 = 
rhs
.
m_iFaedDiskNum
;

402 
	mm_iS·»DiskNum
 = 
rhs
.
m_iS·»DiskNum
;

403 
	mm_iS‹
 = 
rhs
.
m_iS‹
;

404 
	mm_iChunkSize
 = 
rhs
.
m_iChunkSize
;

405 
	mm_iRebudšgProg»ss
 = 
rhs
.
m_iRebudšgProg»ss
;

406 
	mm_bRebudšg
 = 
rhs
.
m_bRebudšg
;

407 
	mm_bIÇùive
 = 
rhs
.
m_bIÇùive
;

408 
	mm_bSu³rBlockP”si¡’t
 = 
rhs
.
m_bSu³rBlockP”si¡’t
;

409 
	mm_C»©iÚTime
 = 
rhs
.
m_C»©iÚTime
;

410 
	mm_Upd©eTime
 = 
rhs
.
m_Upd©eTime
;

411 
	mm_fsMgr
 = 
rhs
.
m_fsMgr
;

412 
	mm_iMDNum
 = 
rhs
.
m_iMDNum
;

414  *
	mthis
;

417 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
RAIDInfo
& 
rhs
) const

419  (
m_¡rDevNodeName
 =ğ
rhs
.m_strDevNodeName &&

420 0 =ğ
memcmp
(
rhs
.
m_UUID
, m_UUID, (m_UUID)));

423 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
¡ršg
& 
rhs
) const

425  (
m_¡rDevNodeName
 =ğ
rhs
);

428 
boŞ
 
IsRAIDStusChªged
(cÚ¡ 
RAIDInfo
& 
´evious
) {

429  !(
	mm_Upd©eTime
 =ğ
´evious
.
m_Upd©eTime
 &&

430 
m_iFaedDiskNum
 =ğ
´evious
.m_iFailedDiskNum &&

431 
m_iWÜkšgDiskNum
 =ğ
´evious
.m_iWorkingDiskNum &&

432 
m_iS·»DiskNum
 =ğ
´evious
.m_iSpareDiskNum);

435 
Dump
()

437 
´štf
("Device: %s\n"

443 
m_¡rDevNodeName
.
c_¡r
(), 
m_¡rS‹
.c_str(),

444 
m_iRAIDLev–
, 
m_iChunkSize
,

445 
m_uÎTÙ®C­ac™y
, 
m_uÎU£dSize
,

446 
m_iTÙ®DiskNum
, 
m_iRAIDDiskNum
, 
m_iAùiveDiskNum
,

447 
m_iWÜkšgDiskNum
, 
m_iFaedDiskNum
, 
m_iS·»DiskNum
,

448 
ùime
(&
m_C»©iÚTime
), ctime(&
m_Upd©eTime
),

449 
m_bRebudšg
?"Yes":"No", (
m_iRebudšgProg»ss
 < 0)?100:m_iRebuildingProgress

452 ià(
	mm_fsMgr
.
g‘
(è!ğ
NULL
)

453 
m_fsMgr
->
Dump
();

454 
´štf
("\n");

456 
size_t
 
	mi
 =0 ; i < 
	mm_vDiskLi¡
.
size
(); i++) {

457 
´štf
("\t");

458 
	mm_vDiskLi¡
[
i
].
Dump
();

460 
´štf
("\n");

464 şas 
	cRAIDMªag”
 {

465 
	m´iv©e
:

466 
veùÜ
<
RAIDInfo
> 
m_vRAIDInfoLi¡
;

467 
	mveùÜ
<
	mRAIDDiskInfo
> 
	mm_vRAIDDiskLi¡
;

468 
	mm­
<
	m¡ršg
, 
	mMiscDiskInfo
> 
	mm_m­SymLškTabË
;

470 
Cr™iÿlSeùiÚ
 
	mm_csRAIDInfoLi¡
;

471 
Cr™iÿlSeùiÚ
 
	mm_csRAIDDiskLi¡
;

472 
Cr™iÿlSeùiÚ
 
	mm_csU£dMD
;

473 
Cr™iÿlSeùiÚ
 
	mm_csU£dVŞume
;

474 
Cr™iÿlSeùiÚ
 
	mm_csSymLškTabË
;

476 
boŞ
 
	mm_bU£dMD
[128];

477 
boŞ
 
	mm_bU£dVŞume
[128];

479 
	m´iv©e
:

480 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
S—rchDiskB–Úg2RAID
(
RAIDDiskInfo
& 
devInfo
);

482 
In™ŸlizeSh­e
(
sh­e
& 
s
, 
¿iddisks
, 
Ëv–
, 
chunk
 = 512, 
b™m­_chunk
 = 
UnS‘
, * 
b™m­_fe
 = 
NULL
);

483 #ifdeà
DEBUG


484 
In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
 = 1, 
run¡İ
 = 1, 
v”bo£
 = 1);

486 
In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
 = 1, 
run¡İ
 = 1, 
v”bo£
 = 0);

488 
In™ŸlizeMDDevId’t
(
mddev_id’t
& 
id’t
, 
uuid_£t
, cÚ¡ 
uuid
[4], 
b™m­_fd
 = -1, * 
b™m­_fe
 = 
NULL
);

489 
mddev_dev
* 
In™ŸlizeDevLi¡
(
veùÜ
<
¡ršg
>& 
devNameLi¡
, 
di¥os™iÚ
 = 0);

490 
mddev_dev
* 
In™ŸlizeDevLi¡
(cÚ¡ 
¡ršg
& 
»¶aû
, cÚ¡ sŒšg& 
w™h
);

491 
F»eDevLi¡
(
mddev_dev
* 
devli¡
);

492 
O³nMDDev
(cÚ¡ 
¡ršg
& 
mddev
);

494 
C»©eRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
);

495 
C»©eRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
);

496 
As£mbËRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4]);

497 
As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4]);

498 
As£mbËRAID
(cÚ¡ & 
mdnum
, 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

499 
As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

500 
G‘F»eMDNum
();

501 
F»eMDNum
(
n
);

502 
S‘MDNum
(
n
);

503 
G‘F»eVŞumeNum
();

504 
F»eVŞumeNum
(
n
);

505 
S‘VŞumeNum
(
n
);

507 
Upd©eRAIDDiskLi¡
(
veùÜ
<
RAIDDiskInfo
>& 
vRAIDDiskInfoLi¡
, cÚ¡ 
¡ršg
& 
mddev
);

508 
boŞ
 
MªageRAIDSubdevs
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
İ”©iÚ
);

509 
	mveùÜ
<
	mRAIDInfo
>::
™”©Ü
 
IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
);

510 
	mveùÜ
<
	mRAIDInfo
>::
™”©Ü
 
IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
, 
RAIDInfo
& 
šfo
);

511 
boŞ
 
IsDiskExi¡InRAIDDiskLi¡
(cÚ¡ 
¡ršg
& 
dev
);

512 
boŞ
 
IsDiskExi¡InRAIDDiskLi¡
(
veùÜ
<
¡ršg
>& 
vDevLi¡
);

513 
¡ršg
 
G’”©eMDDevName
(
num
);

514 
G’”©eVŞumeName
(
¡ršg
& 
Çme
);

516 
boŞ
 
IsDiskHaveMDSu³rBlock
(cÚ¡ 
¡ršg
& 
dev
, 
examše_»suÉ
 &
»suÉ
, &
”r
);

518 
boŞ
 
G‘RAIDD‘a
(cÚ¡ 
¡ršg
& 
mddev
, 
¬¿y_d‘a
 &
ad
);

519 
boŞ
 
IsRAIDAbnÜm®
(cÚ¡ 
RAIDInfo
 &
šfo
);

521 
	mpublic
:

522 
RAIDMªag”
();

523 ~
RAIDMªag”
();

525 
boŞ
 
AddDiskSymLšk
(cÚ¡ 
¡ršg
& 
symlšk
, 
eDiskTy³
 
ty³
);

526 
boŞ
 
RemoveDiskSymLšk
(cÚ¡ 
¡ršg
& 
symlšk
);

527 
boŞ
 
AddDisk
(cÚ¡ 
¡ršg
& 
dev
);

528 
boŞ
 
RemoveDisk
(cÚ¡ 
¡ršg
& 
dev
);

530 
boŞ
 
C»©eRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, 
Ëv–
, sŒšg& 
¡rMDName
);

531 
boŞ
 
As£mbËRAID
(cÚ¡ 
uuid
[4], 
¡ršg
& 
¡rMDName
);

532 
boŞ
 
As£mbËRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, sŒšg& 
¡rMDName
);

533 
boŞ
 
RemoveMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

534 
boŞ
 
M¬kFauÉyMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

535 
boŞ
 
AddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

536 
boŞ
 
R—ddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

537 
boŞ
 
R•ÏûMDDisk
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ sŒšg& 
»¶aû
, cÚ¡ sŒšg& 
w™h
);

538 
boŞ
 
D–‘eRAID
(cÚ¡ 
¡ršg
& 
mddev
);

539 
boŞ
 
StİRAID
(cÚ¡ 
¡ršg
& 
mddev
);

541 
boŞ
 
G‘RAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
RAIDInfo
& 
šfo
);

542 
G‘RAIDInfo
(
veùÜ
<
RAIDInfo
>& 
li¡
);

543 
G‘DisksInfo
(
veùÜ
<
RAIDDiskInfo
> &
li¡
);

544 
boŞ
 
G‘DisksInfo
(cÚ¡ 
¡ršg
& 
dev
, 
RAIDDiskInfo
 &
šfo
);

545 
boŞ
 
G‘DisksInfoBySymLšk
(cÚ¡ 
¡ršg
& 
lšk
, 
RAIDDiskInfo
 &
šfo
);

546 
boŞ
 
G‘DisksInfoBySymLšk
(
veùÜ
<
RAIDDiskInfo
> &
li¡
);

548 
boŞ
 
Upd©eRAIDInfo
();

549 
boŞ
 
Upd©eRAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
mdnum
 = -1);

550 
boŞ
 
Upd©eRAIDInfo
(cÚ¡ 
uuid
[4]);

552 
boŞ
 
CheckFeSy¡em
();

553 
boŞ
 
DoFeSy¡emRecov”y
();

554 
boŞ
 
G‘FeSy¡emStus
();

556 
boŞ
 
FÜm©
(cÚ¡ 
¡ršg
& 
mddev
);

557 
boŞ
 
MouÁ
(cÚ¡ 
¡ršg
& 
mddev
);

558 
boŞ
 
UnmouÁ
(cÚ¡ 
¡ršg
& 
mddev
);

559 
boŞ
 
G‘FÜm©Prog»ss
(cÚ¡ 
¡ršg
& 
mddev
,

560 & 
¡©
, & 
´og»ss
);

561 
boŞ
 
IsMouÁed
(cÚ¡ 
¡ršg
& 
mddev
, &
num
);

562 
boŞ
 
IsFÜm©ed
(cÚ¡ 
¡ršg
& 
mddev
);

564 
Dump
();

566 
¡ršg
 
G‘DeviûNodeBySymLšk
(cÚ¡ sŒšg& 
symlšk
);

	@libmdadm/bitmap.h

6 #iâdeà
BITMAP_H


7 
	#BITMAP_H
 1

	)

9 
	#BITMAP_MAJOR_LO
 3

	)

13 
	#BITMAP_MAJOR_HI
 4

	)

14 
	#BITMAP_MAJOR_HOSTENDIAN
 3

	)

16 
	#BITMAP_MINOR
 39

	)

80 #ifdeà
__KERNEL__


82 
	#PAGE_BITS
 (
PAGE_SIZE
 << 3)

	)

83 
	#PAGE_BIT_SHIFT
 (
PAGE_SHIFT
 + 3)

	)

85 
__u16
 
	tb™m­_couÁ”_t
;

86 
	#COUNTER_BITS
 16

	)

87 
	#COUNTER_BIT_SHIFT
 4

	)

88 
	#COUNTER_BYTE_RATIO
 (
COUNTER_BITS
 / 8)

	)

89 
	#COUNTER_BYTE_SHIFT
 (
COUNTER_BIT_SHIFT
 - 3)

	)

91 
	#NEEDED_MASK
 ((
b™m­_couÁ”_t
è(1 << (
COUNTER_BITS
 - 1)))

	)

92 
	#RESYNC_MASK
 ((
b™m­_couÁ”_t
è(1 << (
COUNTER_BITS
 - 2)))

	)

93 
	#COUNTER_MAX
 ((
b™m­_couÁ”_t
è
RESYNC_MASK
 - 1)

	)

94 
	#NEEDED
(
x
è(((
b™m­_couÁ”_t
èxè& 
NEEDED_MASK
)

	)

95 
	#RESYNC
(
x
è(((
b™m­_couÁ”_t
èxè& 
RESYNC_MASK
)

	)

96 
	#COUNTER
(
x
è(((
b™m­_couÁ”_t
èxè& 
COUNTER_MAX
)

	)

99 
	#PAGE_COUNTER_RATIO
 (
PAGE_BITS
 / 
COUNTER_BITS
)

	)

101 
	#PAGE_COUNTER_SHIFT
 (
PAGE_BIT_SHIFT
 - 
COUNTER_BIT_SHIFT
)

	)

103 
	#PAGE_COUNTER_MASK
 (
PAGE_COUNTER_RATIO
 - 1)

	)

105 
	#BITMAP_BLOCK_SIZE
 512

	)

106 
	#BITMAP_BLOCK_SHIFT
 9

	)

109 
	#CHUNK_BLOCK_RATIO
(
b™m­
è((b™m­)->
chunksize
 >> 
BITMAP_BLOCK_SHIFT
)

	)

110 
	#CHUNK_BLOCK_SHIFT
(
b™m­
è((b™m­)->
chunkshiá
 - 
BITMAP_BLOCK_SHIFT
)

	)

111 
	#CHUNK_BLOCK_MASK
(
b™m­
è(
	`CHUNK_BLOCK_RATIO
(b™m­è- 1)

	)

115 
	#PAGEPTR_BLOCK_RATIO
(
b™m­
) \

116 (
	`CHUNK_BLOCK_RATIO
(
b™m­
è<< 
PAGE_COUNTER_SHIFT
 >> 1)

	)

117 
	#PAGEPTR_BLOCK_SHIFT
(
b™m­
) \

118 (
	`CHUNK_BLOCK_SHIFT
(
b™m­
è+ 
PAGE_COUNTER_SHIFT
 - 1)

	)

119 
	#PAGEPTR_BLOCK_MASK
(
b™m­
è(
	`PAGEPTR_BLOCK_RATIO
(b™m­è- 1)

	)

129 
	#CHUNK_BIT_OFFSET
(
chunk
è((chunkè+ ((
b™m­_su³r_t
è<< 3))

	)

137 
	#BITMAP_MAGIC
 0x6d746962

	)

140 
	eb™m­_¡©e
 {

141 
	mBITMAP_ACTIVE
 = 0x001,

142 
	mBITMAP_STALE
 = 0x002

146 
	sb™m­_su³r_s
 {

147 
__u32
 
	mmagic
;

148 
__u32
 
	mv”siÚ
;

149 
__u8
 
	muuid
[16];

150 
__u64
 
	mev’ts
;

151 
__u64
 
	mev’ts_ş—»d
;

152 
__u64
 
	msync_size
;

153 
__u32
 
	m¡©e
;

154 
__u32
 
	mchunksize
;

155 
__u32
 
	md«mÚ_¦“p
;

156 
__u32
 
	mwr™e_behšd
;

158 
__u8
 
	m·d
[256 - 64];

159 } 
	tb™m­_su³r_t
;

175 #ifdeà
__KERNEL__


178 
	sb™m­_·ge
 {

182 *
	mm­
;

187 
	mhijacked
;

191 
	mcouÁ
;

195 
	s·ge_li¡
 {

196 
li¡_h—d
 
	mli¡
;

197 
·ge
 *
	m·ge
;

201 
	sb™m­
 {

202 
b™m­_·ge
 *
	mbp
;

203 
	m·ges
;

204 
	mmissšg_·ges
;

206 
mddev_t
 *
	mmddev
;

208 
	mcouÁ”_b™s
;

211 
	mchunksize
;

212 
	mchunkshiá
;

213 
	mchunks
;

220 
	msyncchunk
;

222 
__u64
 
	mev’ts_ş—»d
;

225 
¥šlock_t
 
	mlock
;

227 
fe
 *
	mfe
;

228 
·ge
 *
	msb_·ge
;

229 
·ge
 **
	mfem­
;

230 *
	mfem­_©Œ
;

231 
	mfe_·ges
;

233 
	mæags
;

239 
mdk_th»ad_t
 *
	md«mÚ
;

240 
	md«mÚ_¦“p
;

251 
mdk_th»ad_t
 *
	mwr™e_d«mÚ
;

252 
mdk_th»ad_t
 *
	mwr™eback_d«mÚ
;

253 
¥šlock_t
 
	mwr™e_lock
;

254 
£m­hÜe
 
	mwr™e_»ady
;

255 
£m­hÜe
 
	mwr™e_dÚe
;

256 
	mwr™es_³ndšg
;

257 
wa™_queue_h—d_t
 
	mwr™e_wa™
;

258 
li¡_h—d
 
	mwr™e_·ges
;

259 
li¡_h—d
 
	mcom¶‘e_·ges
;

260 
mempoŞ_t
 *
	mwr™e_poŞ
;

266 
b™m­_ü—‹
(
mddev_t
 *
mddev
);

267 
b™m­_de¡roy
(
mddev_t
 *
mddev
);

268 
b™m­_aùive
(
b™m­
 *bitmap);

270 *
fe_·th
(
fe
 *fe, *
buf
, 
couÁ
);

271 
b™m­_´št_sb
(
b™m­
 *bitmap);

272 
b™m­_upd©e_sb
(
b™m­
 *bitmap);

274 
b™m­_£Îb™s
(
b™m­
 *bitmap);

277 
b™m­_¡¬twr™e
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, 
£ùÜs
);

278 
b™m­_’dwr™e
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, 
£ùÜs
,

279 
sucûss
);

280 
b™m­_¡¬t_sync
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, *
blocks
);

281 
b™m­_’d_sync
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, *
blocks
, 
abÜ‹d
);

282 
b™m­_şo£_sync
(
b™m­
 *bitmap);

284 
b™m­_uÅlug
(
b™m­
 *bitmap);

	@libmdadm/bitmap.h

6 #iâdeà
BITMAP_H


7 
	#BITMAP_H
 1

	)

9 
	#BITMAP_MAJOR_LO
 3

	)

13 
	#BITMAP_MAJOR_HI
 4

	)

14 
	#BITMAP_MAJOR_HOSTENDIAN
 3

	)

16 
	#BITMAP_MINOR
 39

	)

80 #ifdeà
__KERNEL__


82 
	#PAGE_BITS
 (
PAGE_SIZE
 << 3)

	)

83 
	#PAGE_BIT_SHIFT
 (
PAGE_SHIFT
 + 3)

	)

85 
__u16
 
	tb™m­_couÁ”_t
;

86 
	#COUNTER_BITS
 16

	)

87 
	#COUNTER_BIT_SHIFT
 4

	)

88 
	#COUNTER_BYTE_RATIO
 (
COUNTER_BITS
 / 8)

	)

89 
	#COUNTER_BYTE_SHIFT
 (
COUNTER_BIT_SHIFT
 - 3)

	)

91 
	#NEEDED_MASK
 ((
b™m­_couÁ”_t
è(1 << (
COUNTER_BITS
 - 1)))

	)

92 
	#RESYNC_MASK
 ((
b™m­_couÁ”_t
è(1 << (
COUNTER_BITS
 - 2)))

	)

93 
	#COUNTER_MAX
 ((
b™m­_couÁ”_t
è
RESYNC_MASK
 - 1)

	)

94 
	#NEEDED
(
x
è(((
b™m­_couÁ”_t
èxè& 
NEEDED_MASK
)

	)

95 
	#RESYNC
(
x
è(((
b™m­_couÁ”_t
èxè& 
RESYNC_MASK
)

	)

96 
	#COUNTER
(
x
è(((
b™m­_couÁ”_t
èxè& 
COUNTER_MAX
)

	)

99 
	#PAGE_COUNTER_RATIO
 (
PAGE_BITS
 / 
COUNTER_BITS
)

	)

101 
	#PAGE_COUNTER_SHIFT
 (
PAGE_BIT_SHIFT
 - 
COUNTER_BIT_SHIFT
)

	)

103 
	#PAGE_COUNTER_MASK
 (
PAGE_COUNTER_RATIO
 - 1)

	)

105 
	#BITMAP_BLOCK_SIZE
 512

	)

106 
	#BITMAP_BLOCK_SHIFT
 9

	)

109 
	#CHUNK_BLOCK_RATIO
(
b™m­
è((b™m­)->
chunksize
 >> 
BITMAP_BLOCK_SHIFT
)

	)

110 
	#CHUNK_BLOCK_SHIFT
(
b™m­
è((b™m­)->
chunkshiá
 - 
BITMAP_BLOCK_SHIFT
)

	)

111 
	#CHUNK_BLOCK_MASK
(
b™m­
è(
	`CHUNK_BLOCK_RATIO
(b™m­è- 1)

	)

115 
	#PAGEPTR_BLOCK_RATIO
(
b™m­
) \

116 (
	`CHUNK_BLOCK_RATIO
(
b™m­
è<< 
PAGE_COUNTER_SHIFT
 >> 1)

	)

117 
	#PAGEPTR_BLOCK_SHIFT
(
b™m­
) \

118 (
	`CHUNK_BLOCK_SHIFT
(
b™m­
è+ 
PAGE_COUNTER_SHIFT
 - 1)

	)

119 
	#PAGEPTR_BLOCK_MASK
(
b™m­
è(
	`PAGEPTR_BLOCK_RATIO
(b™m­è- 1)

	)

129 
	#CHUNK_BIT_OFFSET
(
chunk
è((chunkè+ ((
b™m­_su³r_t
è<< 3))

	)

137 
	#BITMAP_MAGIC
 0x6d746962

	)

140 
	eb™m­_¡©e
 {

141 
	mBITMAP_ACTIVE
 = 0x001,

142 
	mBITMAP_STALE
 = 0x002

146 
	sb™m­_su³r_s
 {

147 
__u32
 
	mmagic
;

148 
__u32
 
	mv”siÚ
;

149 
__u8
 
	muuid
[16];

150 
__u64
 
	mev’ts
;

151 
__u64
 
	mev’ts_ş—»d
;

152 
__u64
 
	msync_size
;

153 
__u32
 
	m¡©e
;

154 
__u32
 
	mchunksize
;

155 
__u32
 
	md«mÚ_¦“p
;

156 
__u32
 
	mwr™e_behšd
;

158 
__u8
 
	m·d
[256 - 64];

159 } 
	tb™m­_su³r_t
;

175 #ifdeà
__KERNEL__


178 
	sb™m­_·ge
 {

182 *
	mm­
;

187 
	mhijacked
;

191 
	mcouÁ
;

195 
	s·ge_li¡
 {

196 
li¡_h—d
 
	mli¡
;

197 
·ge
 *
	m·ge
;

201 
	sb™m­
 {

202 
b™m­_·ge
 *
	mbp
;

203 
	m·ges
;

204 
	mmissšg_·ges
;

206 
mddev_t
 *
	mmddev
;

208 
	mcouÁ”_b™s
;

211 
	mchunksize
;

212 
	mchunkshiá
;

213 
	mchunks
;

220 
	msyncchunk
;

222 
__u64
 
	mev’ts_ş—»d
;

225 
¥šlock_t
 
	mlock
;

227 
fe
 *
	mfe
;

228 
·ge
 *
	msb_·ge
;

229 
·ge
 **
	mfem­
;

230 *
	mfem­_©Œ
;

231 
	mfe_·ges
;

233 
	mæags
;

239 
mdk_th»ad_t
 *
	md«mÚ
;

240 
	md«mÚ_¦“p
;

251 
mdk_th»ad_t
 *
	mwr™e_d«mÚ
;

252 
mdk_th»ad_t
 *
	mwr™eback_d«mÚ
;

253 
¥šlock_t
 
	mwr™e_lock
;

254 
£m­hÜe
 
	mwr™e_»ady
;

255 
£m­hÜe
 
	mwr™e_dÚe
;

256 
	mwr™es_³ndšg
;

257 
wa™_queue_h—d_t
 
	mwr™e_wa™
;

258 
li¡_h—d
 
	mwr™e_·ges
;

259 
li¡_h—d
 
	mcom¶‘e_·ges
;

260 
mempoŞ_t
 *
	mwr™e_poŞ
;

266 
b™m­_ü—‹
(
mddev_t
 *
mddev
);

267 
b™m­_de¡roy
(
mddev_t
 *
mddev
);

268 
b™m­_aùive
(
b™m­
 *bitmap);

270 *
fe_·th
(
fe
 *fe, *
buf
, 
couÁ
);

271 
b™m­_´št_sb
(
b™m­
 *bitmap);

272 
b™m­_upd©e_sb
(
b™m­
 *bitmap);

274 
b™m­_£Îb™s
(
b™m­
 *bitmap);

277 
b™m­_¡¬twr™e
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, 
£ùÜs
);

278 
b™m­_’dwr™e
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, 
£ùÜs
,

279 
sucûss
);

280 
b™m­_¡¬t_sync
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, *
blocks
);

281 
b™m­_’d_sync
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, *
blocks
, 
abÜ‹d
);

282 
b™m­_şo£_sync
(
b™m­
 *bitmap);

284 
b™m­_uÅlug
(
b™m­
 *bitmap);

	@libmdadm/crc32.h

5 
loÿl
 cÚ¡ 
FAR
 
	güc_bË
[
TBLS
][256] =

60 #ifdeà
BYFOUR


	@libmdadm/crc32.h

5 
loÿl
 cÚ¡ 
FAR
 
	güc_bË
[
TBLS
][256] =

60 #ifdeà
BYFOUR


	@libmdadm/dlink.h

5 
	s__dl_h—d


7 * 
	mdh_´ev
;

8 * 
	mdh_Ãxt
;

11 
	#dl_®loc
(
size
è((*)(((*)
	`xÿÎoc
(1,(size)+(
__dl_h—d
)))+(__dl_h—d)))

	)

12 
	#dl_Ãw
(
t
è(Ñ*)
	`dl_®loc
(Ñ)))

	)

13 
	#dl_Ãwv
(
t
,
n
è(Ñ*)
	`dl_®loc
(Ñ)*n))

	)

15 
	#dl_Ãxt
(
p
è*(&(((
__dl_h—d
*)Õ))[-1].
dh_Ãxt
))

	)

16 
	#dl_´ev
(
p
è*(&(((
__dl_h—d
*)Õ))[-1].
dh_´ev
))

	)

18 *
dl_h—d
();

19 *
dl_¡rdup
(*);

20 *
dl_¡ºdup
(*, );

21 
dl_š£¹
(*, *);

22 
dl_add
(*, *);

23 
dl_d–
(*);

24 
dl_ä“
(*);

25 
dl_š™
(*);

	@libmdadm/dlink.h

5 
	s__dl_h—d


7 * 
	mdh_´ev
;

8 * 
	mdh_Ãxt
;

11 
	#dl_®loc
(
size
è((*)(((*)
	`xÿÎoc
(1,(size)+(
__dl_h—d
)))+(__dl_h—d)))

	)

12 
	#dl_Ãw
(
t
è(Ñ*)
	`dl_®loc
(Ñ)))

	)

13 
	#dl_Ãwv
(
t
,
n
è(Ñ*)
	`dl_®loc
(Ñ)*n))

	)

15 
	#dl_Ãxt
(
p
è*(&(((
__dl_h—d
*)Õ))[-1].
dh_Ãxt
))

	)

16 
	#dl_´ev
(
p
è*(&(((
__dl_h—d
*)Õ))[-1].
dh_´ev
))

	)

18 *
dl_h—d
();

19 *
dl_¡rdup
(*);

20 *
dl_¡ºdup
(*, );

21 
dl_š£¹
(*, *);

22 
dl_add
(*, *);

23 
dl_d–
(*);

24 
dl_ä“
(*);

25 
dl_š™
(*);

	@libmdadm/md_p.h

15 #iâdeà
_MD_P_H


16 
	#_MD_P_H


	)

44 
	#MD_RESERVED_BYTES
 (64 * 1024)

	)

45 
	#MD_RESERVED_SECTORS
 (
MD_RESERVED_BYTES
 / 512)

	)

46 
	#MD_RESERVED_BLOCKS
 (
MD_RESERVED_BYTES
 / 
BLOCK_SIZE
)

	)

48 
	#MD_NEW_SIZE_SECTORS
(
x
è((x & ~(
MD_RESERVED_SECTORS
 - 1)è- MD_RESERVED_SECTORS)

	)

49 
	#MD_NEW_SIZE_BLOCKS
(
x
è((x & ~(
MD_RESERVED_BLOCKS
 - 1)è- MD_RESERVED_BLOCKS)

	)

51 
	#MD_SB_BYTES
 4096

	)

52 
	#MD_SB_WORDS
 (
MD_SB_BYTES
 / 4)

	)

53 
	#MD_SB_BLOCKS
 (
MD_SB_BYTES
 / 
BLOCK_SIZE
)

	)

54 
	#MD_SB_SECTORS
 (
MD_SB_BYTES
 / 512)

	)

59 
	#MD_SB_GENERIC_OFFSET
 0

	)

60 
	#MD_SB_PERSONALITY_OFFSET
 64

	)

61 
	#MD_SB_DISKS_OFFSET
 128

	)

62 
	#MD_SB_DESCRIPTOR_OFFSET
 992

	)

64 
	#MD_SB_GENERIC_CONSTANT_WORDS
 32

	)

65 
	#MD_SB_GENERIC_STATE_WORDS
 32

	)

66 
	#MD_SB_GENERIC_WORDS
 (
MD_SB_GENERIC_CONSTANT_WORDS
 + 
MD_SB_GENERIC_STATE_WORDS
)

	)

67 
	#MD_SB_PERSONALITY_WORDS
 64

	)

68 
	#MD_SB_DESCRIPTOR_WORDS
 32

	)

69 
	#MD_SB_DISKS
 27

	)

70 
	#MD_SB_DISKS_WORDS
 (
MD_SB_DISKS
*
MD_SB_DESCRIPTOR_WORDS
)

	)

71 
	#MD_SB_RESERVED_WORDS
 (1024 - 
MD_SB_GENERIC_WORDS
 - 
MD_SB_PERSONALITY_WORDS
 - 
MD_SB_DISKS_WORDS
 - 
MD_SB_DESCRIPTOR_WORDS
)

	)

72 
	#MD_SB_EQUAL_WORDS
 (
MD_SB_GENERIC_WORDS
 + 
MD_SB_PERSONALITY_WORDS
 + 
MD_SB_DISKS_WORDS
)

	)

77 
	#MD_DISK_FAULTY
 0

	)

78 
	#MD_DISK_ACTIVE
 1

	)

79 
	#MD_DISK_SYNC
 2

	)

80 
	#MD_DISK_REMOVED
 3

	)

82 
	#MD_DISK_WRITEMOSTLY
 9

	)

87 
	#MD_DISK_REPLACEMENT
 17

	)

89 
	smdp_deviû_desütÜ_s
 {

90 
__u32
 
	mnumb”
;

91 
__u32
 
	mmajÜ
;

92 
__u32
 
	mmšÜ
;

93 
__u32
 
	m¿id_disk
;

94 
__u32
 
	m¡©e
;

95 
__u32
 
	m»£rved
[
MD_SB_DESCRIPTOR_WORDS
 - 5];

96 } 
	tmdp_disk_t
;

98 
	#MD_SB_MAGIC
 0xa92b4efc

	)

103 
	#MD_SB_CLEAN
 0

	)

104 
	#MD_SB_ERRORS
 1

	)

105 
	#MD_SB_BBM_ERRORS
 2

	)

106 
	#MD_SB_BLOCK_CONTAINER_RESHAPE
 3

	)

107 
	#MD_SB_BLOCK_VOLUME
 4

	)

109 
	#MD_SB_BITMAP_PRESENT
 8

	)

111 
	smdp_su³rblock_s
 {

115 
__u32
 
	mmd_magic
;

116 
__u32
 
	mmajÜ_v”siÚ
;

117 
__u32
 
	mmšÜ_v”siÚ
;

118 
__u32
 
	m·tch_v”siÚ
;

119 
__u32
 
	mgv®id_wÜds
;

120 
__u32
 
	m£t_uuid0
;

121 
__u32
 
	mùime
;

122 
__u32
 
	mËv–
;

123 
__u32
 
	msize
;

124 
__u32
 
	mÄ_disks
;

125 
__u32
 
	m¿id_disks
;

126 
__u32
 
	mmd_mšÜ
;

127 
__u32
 
	mnÙ_³rsi¡’t
;

128 
__u32
 
	m£t_uuid1
;

129 
__u32
 
	m£t_uuid2
;

130 
__u32
 
	m£t_uuid3
;

131 
__u32
 
	mg¡©e_üe£rved
[
MD_SB_GENERIC_CONSTANT_WORDS
 - 16];

136 
__u32
 
	mutime
;

137 
__u32
 
	m¡©e
;

138 
__u32
 
	maùive_disks
;

139 
__u32
 
	mwÜkšg_disks
;

140 
__u32
 
	mçed_disks
;

141 
__u32
 
	m¥¬e_disks
;

142 
__u32
 
	msb_csum
;

143 #ià 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


144 
__u32
 
	mev’ts_hi
;

145 
__u32
 
	mev’ts_lo
;

146 
__u32
 
	mı_ev’ts_hi
;

147 
__u32
 
	mı_ev’ts_lo
;

149 
__u32
 
	mev’ts_lo
;

150 
__u32
 
	mev’ts_hi
;

151 
__u32
 
	mı_ev’ts_lo
;

152 
__u32
 
	mı_ev’ts_hi
;

154 
__u32
 
	m»cov”y_ı
;

156 
__u64
 
	m»sh­e_pos™iÚ
;

157 
__u32
 
	mÃw_Ëv–
;

158 
__u32
 
	md–_disks
;

159 
__u32
 
	mÃw_Ïyout
;

160 
__u32
 
	mÃw_chunk
;

161 
__u32
 
	mg¡©e_¤e£rved
[
MD_SB_GENERIC_STATE_WORDS
 - 18];

166 
__u32
 
	mÏyout
;

167 
__u32
 
	mchunk_size
;

168 
__u32
 
	mroÙ_pv
;

169 
__u32
 
	mroÙ_block
;

170 
__u32
 
	mp¡©e_»£rved
[
MD_SB_PERSONALITY_WORDS
 - 4];

175 
mdp_disk_t
 
	mdisks
[
MD_SB_DISKS
];

180 
__u32
 
	m»£rved
[
MD_SB_RESERVED_WORDS
];

185 
mdp_disk_t
 
	mthis_disk
;

187 } 
	tmdp_su³r_t
;

189 #ifdeà
__TINYC__


190 
	t__u64
;

193 
šlše
 
__u64
 
	$md_ev’t
(
mdp_su³r_t
 *
sb
) {

194 
__u64
 
ev
 = 
sb
->
ev’ts_hi
;

195  (
ev
<<32)| 
sb
->
ev’ts_lo
;

196 
	}
}

	@libmdadm/md_p.h

15 #iâdeà
_MD_P_H


16 
	#_MD_P_H


	)

44 
	#MD_RESERVED_BYTES
 (64 * 1024)

	)

45 
	#MD_RESERVED_SECTORS
 (
MD_RESERVED_BYTES
 / 512)

	)

46 
	#MD_RESERVED_BLOCKS
 (
MD_RESERVED_BYTES
 / 
BLOCK_SIZE
)

	)

48 
	#MD_NEW_SIZE_SECTORS
(
x
è((x & ~(
MD_RESERVED_SECTORS
 - 1)è- MD_RESERVED_SECTORS)

	)

49 
	#MD_NEW_SIZE_BLOCKS
(
x
è((x & ~(
MD_RESERVED_BLOCKS
 - 1)è- MD_RESERVED_BLOCKS)

	)

51 
	#MD_SB_BYTES
 4096

	)

52 
	#MD_SB_WORDS
 (
MD_SB_BYTES
 / 4)

	)

53 
	#MD_SB_BLOCKS
 (
MD_SB_BYTES
 / 
BLOCK_SIZE
)

	)

54 
	#MD_SB_SECTORS
 (
MD_SB_BYTES
 / 512)

	)

59 
	#MD_SB_GENERIC_OFFSET
 0

	)

60 
	#MD_SB_PERSONALITY_OFFSET
 64

	)

61 
	#MD_SB_DISKS_OFFSET
 128

	)

62 
	#MD_SB_DESCRIPTOR_OFFSET
 992

	)

64 
	#MD_SB_GENERIC_CONSTANT_WORDS
 32

	)

65 
	#MD_SB_GENERIC_STATE_WORDS
 32

	)

66 
	#MD_SB_GENERIC_WORDS
 (
MD_SB_GENERIC_CONSTANT_WORDS
 + 
MD_SB_GENERIC_STATE_WORDS
)

	)

67 
	#MD_SB_PERSONALITY_WORDS
 64

	)

68 
	#MD_SB_DESCRIPTOR_WORDS
 32

	)

69 
	#MD_SB_DISKS
 27

	)

70 
	#MD_SB_DISKS_WORDS
 (
MD_SB_DISKS
*
MD_SB_DESCRIPTOR_WORDS
)

	)

71 
	#MD_SB_RESERVED_WORDS
 (1024 - 
MD_SB_GENERIC_WORDS
 - 
MD_SB_PERSONALITY_WORDS
 - 
MD_SB_DISKS_WORDS
 - 
MD_SB_DESCRIPTOR_WORDS
)

	)

72 
	#MD_SB_EQUAL_WORDS
 (
MD_SB_GENERIC_WORDS
 + 
MD_SB_PERSONALITY_WORDS
 + 
MD_SB_DISKS_WORDS
)

	)

77 
	#MD_DISK_FAULTY
 0

	)

78 
	#MD_DISK_ACTIVE
 1

	)

79 
	#MD_DISK_SYNC
 2

	)

80 
	#MD_DISK_REMOVED
 3

	)

82 
	#MD_DISK_WRITEMOSTLY
 9

	)

87 
	#MD_DISK_REPLACEMENT
 17

	)

89 
	smdp_deviû_desütÜ_s
 {

90 
__u32
 
	mnumb”
;

91 
__u32
 
	mmajÜ
;

92 
__u32
 
	mmšÜ
;

93 
__u32
 
	m¿id_disk
;

94 
__u32
 
	m¡©e
;

95 
__u32
 
	m»£rved
[
MD_SB_DESCRIPTOR_WORDS
 - 5];

96 } 
	tmdp_disk_t
;

98 
	#MD_SB_MAGIC
 0xa92b4efc

	)

103 
	#MD_SB_CLEAN
 0

	)

104 
	#MD_SB_ERRORS
 1

	)

105 
	#MD_SB_BBM_ERRORS
 2

	)

106 
	#MD_SB_BLOCK_CONTAINER_RESHAPE
 3

	)

107 
	#MD_SB_BLOCK_VOLUME
 4

	)

109 
	#MD_SB_BITMAP_PRESENT
 8

	)

111 
	smdp_su³rblock_s
 {

115 
__u32
 
	mmd_magic
;

116 
__u32
 
	mmajÜ_v”siÚ
;

117 
__u32
 
	mmšÜ_v”siÚ
;

118 
__u32
 
	m·tch_v”siÚ
;

119 
__u32
 
	mgv®id_wÜds
;

120 
__u32
 
	m£t_uuid0
;

121 
__u32
 
	mùime
;

122 
__u32
 
	mËv–
;

123 
__u32
 
	msize
;

124 
__u32
 
	mÄ_disks
;

125 
__u32
 
	m¿id_disks
;

126 
__u32
 
	mmd_mšÜ
;

127 
__u32
 
	mnÙ_³rsi¡’t
;

128 
__u32
 
	m£t_uuid1
;

129 
__u32
 
	m£t_uuid2
;

130 
__u32
 
	m£t_uuid3
;

131 
__u32
 
	mg¡©e_üe£rved
[
MD_SB_GENERIC_CONSTANT_WORDS
 - 16];

136 
__u32
 
	mutime
;

137 
__u32
 
	m¡©e
;

138 
__u32
 
	maùive_disks
;

139 
__u32
 
	mwÜkšg_disks
;

140 
__u32
 
	mçed_disks
;

141 
__u32
 
	m¥¬e_disks
;

142 
__u32
 
	msb_csum
;

143 #ià 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


144 
__u32
 
	mev’ts_hi
;

145 
__u32
 
	mev’ts_lo
;

146 
__u32
 
	mı_ev’ts_hi
;

147 
__u32
 
	mı_ev’ts_lo
;

149 
__u32
 
	mev’ts_lo
;

150 
__u32
 
	mev’ts_hi
;

151 
__u32
 
	mı_ev’ts_lo
;

152 
__u32
 
	mı_ev’ts_hi
;

154 
__u32
 
	m»cov”y_ı
;

156 
__u64
 
	m»sh­e_pos™iÚ
;

157 
__u32
 
	mÃw_Ëv–
;

158 
__u32
 
	md–_disks
;

159 
__u32
 
	mÃw_Ïyout
;

160 
__u32
 
	mÃw_chunk
;

161 
__u32
 
	mg¡©e_¤e£rved
[
MD_SB_GENERIC_STATE_WORDS
 - 18];

166 
__u32
 
	mÏyout
;

167 
__u32
 
	mchunk_size
;

168 
__u32
 
	mroÙ_pv
;

169 
__u32
 
	mroÙ_block
;

170 
__u32
 
	mp¡©e_»£rved
[
MD_SB_PERSONALITY_WORDS
 - 4];

175 
mdp_disk_t
 
	mdisks
[
MD_SB_DISKS
];

180 
__u32
 
	m»£rved
[
MD_SB_RESERVED_WORDS
];

185 
mdp_disk_t
 
	mthis_disk
;

187 } 
	tmdp_su³r_t
;

189 #ifdeà
__TINYC__


190 
	t__u64
;

193 
šlše
 
__u64
 
	$md_ev’t
(
mdp_su³r_t
 *
sb
) {

194 
__u64
 
ev
 = 
sb
->
ev’ts_hi
;

195  (
ev
<<32)| 
sb
->
ev’ts_lo
;

196 
	}
}

	@libmdadm/md_u.h

15 #iâdeà
_MD_U_H


16 
	#_MD_U_H


	)

21 
	#RAID_VERSION
 
	`_IOR
 (
MD_MAJOR
, 0x10, 
mdu_v”siÚ_t
)

	)

22 
	#GET_ARRAY_INFO
 
	`_IOR
 (
MD_MAJOR
, 0x11, 
mdu_¬¿y_šfo_t
)

	)

23 
	#GET_DISK_INFO
 
	`_IOR
 (
MD_MAJOR
, 0x12, 
mdu_disk_šfo_t
)

	)

24 
	#PRINT_RAID_DEBUG
 
	`_IO
 (
MD_MAJOR
, 0x13)

	)

25 
	#RAID_AUTORUN
 
	`_IO
 (
MD_MAJOR
, 0x14)

	)

26 
	#GET_BITMAP_FILE
 
	`_IOR
 (
MD_MAJOR
, 0x15, 
mdu_b™m­_fe_t
)

	)

29 
	#CLEAR_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x20)

	)

30 
	#ADD_NEW_DISK
 
	`_IOW
 (
MD_MAJOR
, 0x21, 
mdu_disk_šfo_t
)

	)

31 
	#HOT_REMOVE_DISK
 
	`_IO
 (
MD_MAJOR
, 0x22)

	)

32 
	#SET_ARRAY_INFO
 
	`_IOW
 (
MD_MAJOR
, 0x23, 
mdu_¬¿y_šfo_t
)

	)

33 
	#SET_DISK_INFO
 
	`_IO
 (
MD_MAJOR
, 0x24)

	)

34 
	#WRITE_RAID_INFO
 
	`_IO
 (
MD_MAJOR
, 0x25)

	)

35 
	#UNPROTECT_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x26)

	)

36 
	#PROTECT_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x27)

	)

37 
	#HOT_ADD_DISK
 
	`_IO
 (
MD_MAJOR
, 0x28)

	)

38 
	#SET_DISK_FAULTY
 
	`_IO
 (
MD_MAJOR
, 0x29)

	)

39 
	#SET_BITMAP_FILE
 
	`_IOW
 (
MD_MAJOR
, 0x2b, )

	)

42 
	#RUN_ARRAY
 
	`_IOW
 (
MD_MAJOR
, 0x30, 
mdu_·¿m_t
)

	)

43 
	#START_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x31)

	)

44 
	#STOP_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x32)

	)

45 
	#STOP_ARRAY_RO
 
	`_IO
 (
MD_MAJOR
, 0x33)

	)

46 
	#RESTART_ARRAY_RW
 
	`_IO
 (
MD_MAJOR
, 0x34)

	)

48 
	smdu_v”siÚ_s
 {

49 
	mmajÜ
;

50 
	mmšÜ
;

51 
	m·tchËv–
;

52 } 
	tmdu_v”siÚ_t
;

54 
	smdu_¬¿y_šfo_s
 {

58 
	mmajÜ_v”siÚ
;

59 
	mmšÜ_v”siÚ
;

60 
	m·tch_v”siÚ
;

61 
	mùime
;

62 
	mËv–
;

63 
	msize
;

64 
	mÄ_disks
;

65 
	m¿id_disks
;

66 
	mmd_mšÜ
;

67 
	mnÙ_³rsi¡’t
;

72 
	mutime
;

73 
	m¡©e
;

74 
	maùive_disks
;

75 
	mwÜkšg_disks
;

76 
	mçed_disks
;

77 
	m¥¬e_disks
;

82 
	mÏyout
;

83 
	mchunk_size
;

85 } 
	tmdu_¬¿y_šfo_t
;

87 
	smdu_disk_šfo_s
 {

91 
	mnumb”
;

92 
	mmajÜ
;

93 
	mmšÜ
;

94 
	m¿id_disk
;

95 
	m¡©e
;

97 } 
	tmdu_disk_šfo_t
;

99 
	smdu_¡¬t_šfo_s
 {

103 
	mmajÜ
;

104 
	mmšÜ
;

105 
	m¿id_disk
;

106 
	m¡©e
;

108 } 
	tmdu_¡¬t_šfo_t
;

110 
	smdu_b™m­_fe_s


112 
	m·thÇme
[4096];

113 } 
	tmdu_b™m­_fe_t
;

115 
	smdu_·¿m_s


117 
	m³rsÚ®™y
;

118 
	mchunk_size
;

119 
	mmax_çuÉ
;

120 } 
	tmdu_·¿m_t
;

	@libmdadm/md_u.h

15 #iâdeà
_MD_U_H


16 
	#_MD_U_H


	)

21 
	#RAID_VERSION
 
	`_IOR
 (
MD_MAJOR
, 0x10, 
mdu_v”siÚ_t
)

	)

22 
	#GET_ARRAY_INFO
 
	`_IOR
 (
MD_MAJOR
, 0x11, 
mdu_¬¿y_šfo_t
)

	)

23 
	#GET_DISK_INFO
 
	`_IOR
 (
MD_MAJOR
, 0x12, 
mdu_disk_šfo_t
)

	)

24 
	#PRINT_RAID_DEBUG
 
	`_IO
 (
MD_MAJOR
, 0x13)

	)

25 
	#RAID_AUTORUN
 
	`_IO
 (
MD_MAJOR
, 0x14)

	)

26 
	#GET_BITMAP_FILE
 
	`_IOR
 (
MD_MAJOR
, 0x15, 
mdu_b™m­_fe_t
)

	)

29 
	#CLEAR_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x20)

	)

30 
	#ADD_NEW_DISK
 
	`_IOW
 (
MD_MAJOR
, 0x21, 
mdu_disk_šfo_t
)

	)

31 
	#HOT_REMOVE_DISK
 
	`_IO
 (
MD_MAJOR
, 0x22)

	)

32 
	#SET_ARRAY_INFO
 
	`_IOW
 (
MD_MAJOR
, 0x23, 
mdu_¬¿y_šfo_t
)

	)

33 
	#SET_DISK_INFO
 
	`_IO
 (
MD_MAJOR
, 0x24)

	)

34 
	#WRITE_RAID_INFO
 
	`_IO
 (
MD_MAJOR
, 0x25)

	)

35 
	#UNPROTECT_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x26)

	)

36 
	#PROTECT_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x27)

	)

37 
	#HOT_ADD_DISK
 
	`_IO
 (
MD_MAJOR
, 0x28)

	)

38 
	#SET_DISK_FAULTY
 
	`_IO
 (
MD_MAJOR
, 0x29)

	)

39 
	#SET_BITMAP_FILE
 
	`_IOW
 (
MD_MAJOR
, 0x2b, )

	)

42 
	#RUN_ARRAY
 
	`_IOW
 (
MD_MAJOR
, 0x30, 
mdu_·¿m_t
)

	)

43 
	#START_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x31)

	)

44 
	#STOP_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x32)

	)

45 
	#STOP_ARRAY_RO
 
	`_IO
 (
MD_MAJOR
, 0x33)

	)

46 
	#RESTART_ARRAY_RW
 
	`_IO
 (
MD_MAJOR
, 0x34)

	)

48 
	smdu_v”siÚ_s
 {

49 
	mmajÜ
;

50 
	mmšÜ
;

51 
	m·tchËv–
;

52 } 
	tmdu_v”siÚ_t
;

54 
	smdu_¬¿y_šfo_s
 {

58 
	mmajÜ_v”siÚ
;

59 
	mmšÜ_v”siÚ
;

60 
	m·tch_v”siÚ
;

61 
	mùime
;

62 
	mËv–
;

63 
	msize
;

64 
	mÄ_disks
;

65 
	m¿id_disks
;

66 
	mmd_mšÜ
;

67 
	mnÙ_³rsi¡’t
;

72 
	mutime
;

73 
	m¡©e
;

74 
	maùive_disks
;

75 
	mwÜkšg_disks
;

76 
	mçed_disks
;

77 
	m¥¬e_disks
;

82 
	mÏyout
;

83 
	mchunk_size
;

85 } 
	tmdu_¬¿y_šfo_t
;

87 
	smdu_disk_šfo_s
 {

91 
	mnumb”
;

92 
	mmajÜ
;

93 
	mmšÜ
;

94 
	m¿id_disk
;

95 
	m¡©e
;

97 } 
	tmdu_disk_šfo_t
;

99 
	smdu_¡¬t_šfo_s
 {

103 
	mmajÜ
;

104 
	mmšÜ
;

105 
	m¿id_disk
;

106 
	m¡©e
;

108 } 
	tmdu_¡¬t_šfo_t
;

110 
	smdu_b™m­_fe_s


112 
	m·thÇme
[4096];

113 } 
	tmdu_b™m­_fe_t
;

115 
	smdu_·¿m_s


117 
	m³rsÚ®™y
;

118 
	mchunk_size
;

119 
	mmax_çuÉ
;

120 } 
	tmdu_·¿m_t
;

	@libmdadm/mdadm.h

25 
	#_GNU_SOURCE


	)

26 
	#_FILE_OFFSET_BITS
 64

	)

27 
	~<uni¡d.h
>

28 #ifdeà
__GLIBC__


29 
__off64_t
 
l£ek64
 
__P
 ((
__fd
, __off64_ˆ
__off£t
, 
__wh’û
));

30 #–ià!
defšed
(
l£ek64
)

31 #ià
defšed
(
__NO_STAT64
è|| 
__WORDSIZE
 != 32

32 
	#l£ek64
 
l£ek


	)

36 
	~<sys/ty³s.h
>

37 
	~<sys/¡©.h
>

38 
	~<¡dlib.h
>

39 
	~<time.h
>

40 
	~<sys/time.h
>

41 
	~<g‘İt.h
>

42 
	~<fú.h
>

43 
	~<¡dio.h
>

44 
	~<”ºo.h
>

45 
	~<¡ršg.h
>

46 
	~<sy¦og.h
>

47 #ifdeà
__d›ibc__


48 
	~<¡ršgs.h
>

50 
	#¿ndom
 
¿nd


	)

51 
	#¤ªdom
 
¤ªd


	)

54 
	~<lšux/kdev_t.h
>

56 
	~<sys/mouÁ.h
>

57 
	~<asm/ty³s.h
>

58 
	~<sys/ioùl.h
>

59 
	#MD_MAJOR
 9

	)

60 
	#MdpMšÜShiá
 6

	)

62 #iâdeà
BLKGETSIZE64


63 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
è

	)

66 
	#DEFAULT_CHUNK
 512

	)

67 
	#DEFAULT_BITMAP_CHUNK
 4096

	)

68 
	#DEFAULT_BITMAP_DELAY
 5

	)

69 
	#DEFAULT_MAX_WRITE_BEHIND
 256

	)

75 #iâdeà
MAP_DIR


76 
	#MAP_DIR
 "/run/mdadm"

	)

81 #iâdeà
MAP_FILE


82 
	#MAP_FILE
 "m­"

	)

92 #iâdeà
MDMON_DIR


93 
	#MDMON_DIR
 "/run/mdadm"

	)

100 #iâdeà
FAILED_SLOTS_DIR


101 
	#FAILED_SLOTS_DIR
 "/run/mdadm/çed-¦Ùs"

	)

104 
	~"md_u.h
"

105 
	~"md_p.h
"

106 
	~"b™m­.h
"

107 
	~"msg.h
"

108 
	~"mdadm_”rcode.h
"

109 
	~"mdadm_Ùh”.h
"

111 
	~<’dŸn.h
>

117 
	#bsw­_16
(
x
) (((x) & 0x00ffU) << 8 | \

118 ((
x
è& 0xff00Uè>> 8)

	)

119 
	#bsw­_32
(
x
) (((x) & 0x000000ffU) << 24 | \

120 ((
x
) & 0xff000000U) >> 24 | \

121 ((
x
) & 0x0000ff00U) << 8 | \

122 ((
x
è& 0x00ff0000Uè>> 8)

	)

123 
	#bsw­_64
(
x
) (((x) & 0x00000000000000ffULL) << 56 | \

124 ((
x
) & 0xff00000000000000ULL) >> 56 | \

125 ((
x
) & 0x000000000000ff00ULL) << 40 | \

126 ((
x
) & 0x00ff000000000000ULL) >> 40 | \

127 ((
x
) & 0x0000000000ff0000ULL) << 24 | \

128 ((
x
) & 0x0000ff0000000000ULL) >> 24 | \

129 ((
x
) & 0x00000000ff000000ULL) << 8 | \

130 ((
x
è& 0x000000ff00000000ULLè>> 8)

	)

132 #ià!
defšed
(
__KLIBC__
)

133 #ià
BYTE_ORDER
 =ğ
LITTLE_ENDIAN


134 
	#__ıu_to_Ë16
(
_x
è()(_x)

	)

135 
	#__ıu_to_Ë32
(
_x
è()(_x)

	)

136 
	#__ıu_to_Ë64
(
_x
è()(_x)

	)

137 
	#__Ë16_to_ıu
(
_x
è()(_x)

	)

138 
	#__Ë32_to_ıu
(
_x
è()(_x)

	)

139 
	#__Ë64_to_ıu
(
_x
è()(_x)

	)

141 
	#__ıu_to_be16
(
_x
è
	`bsw­_16
(_x)

	)

142 
	#__ıu_to_be32
(
_x
è
	`bsw­_32
(_x)

	)

143 
	#__ıu_to_be64
(
_x
è
	`bsw­_64
(_x)

	)

144 
	#__be16_to_ıu
(
_x
è
	`bsw­_16
(_x)

	)

145 
	#__be32_to_ıu
(
_x
è
	`bsw­_32
(_x)

	)

146 
	#__be64_to_ıu
(
_x
è
	`bsw­_64
(_x)

	)

147 #–ià
BYTE_ORDER
 =ğ
BIG_ENDIAN


148 
	#__ıu_to_Ë16
(
_x
è
	`bsw­_16
(_x)

	)

149 
	#__ıu_to_Ë32
(
_x
è
	`bsw­_32
(_x)

	)

150 
	#__ıu_to_Ë64
(
_x
è
	`bsw­_64
(_x)

	)

151 
	#__Ë16_to_ıu
(
_x
è
	`bsw­_16
(_x)

	)

152 
	#__Ë32_to_ıu
(
_x
è
	`bsw­_32
(_x)

	)

153 
	#__Ë64_to_ıu
(
_x
è
	`bsw­_64
(_x)

	)

155 
	#__ıu_to_be16
(
_x
è()(_x)

	)

156 
	#__ıu_to_be32
(
_x
è()(_x)

	)

157 
	#__ıu_to_be64
(
_x
è()(_x)

	)

158 
	#__be16_to_ıu
(
_x
è()(_x)

	)

159 
	#__be32_to_ıu
(
_x
è()(_x)

	)

160 
	#__be64_to_ıu
(
_x
è()(_x)

	)

171 
	#mš
(
x
, 
y
) ({ \

172 
	`ty³of
(
x
è
_mš1
 = (x); \

173 
	`ty³of
(
y
è
_mš2
 = (y); \

174 (è(&
_mš1
 =ğ&
_mš2
); \

175 
_mš1
 < 
_mš2
 ? _mš1 : _mš2; })

	)

177 
	#max
(
x
, 
y
) ({ \

178 
	`ty³of
(
x
è
_max1
 = (x); \

179 
	`ty³of
(
y
è
_max2
 = (y); \

180 (è(&
_max1
 =ğ&
_max2
); \

181 
_max1
 > 
_max2
 ? _max1 : _max2; })

	)

183 
	#ARRAY_SIZE
(
x
è((x)/(x[0]))

	)

186 
	smdšfo
 {

187 
mdu_¬¿y_šfo_t
 
	m¬¿y
;

188 
mdu_disk_šfo_t
 
	mdisk
;

189 
__u64
 
	mev’ts
;

190 
	muuid
[4];

191 
	mÇme
[33];

192 
	md©a_off£t
;

193 
	mÃw_d©a_off£t
;

194 
	mcompÚ’t_size
;

197 
	mcu¡om_¬¿y_size
;

200 
	#NO_RESHAPE
 0

	)

201 
	#VOLUME_RESHAPE
 1

	)

202 
	#CONTAINER_RESHAPE
 2

	)

203 
	#RESHAPE_NO_BACKUP
 16

	)

204 
	m»sh­e_aùive
;

205 
	m»sh­e_´og»ss
;

206 
	m»cov”y_blocked
;

218 
	m¥aû_befÜe
, 
	m¥aû_aá”
;

220 
	m»sync_¡¬t
;

221 
	m»cov”y_¡¬t
;

222 
	#MaxSeùÜ
 (~0ULLè

	)

224 
	mb™m­_off£t
;

225 
	m§ã_mode_d–ay
;

226 
	mÃw_Ëv–
, 
	md–_disks
, 
	mÃw_Ïyout
, 
	mÃw_chunk
;

227 
	m”rÜs
;

228 
	mÿche_size
;

229 
	mmism©ch_út
;

230 
	m‹xt_v”siÚ
[50];

232 
	mcÚš”_memb”
;

235 
	mcÚš”_’ough
;

238 
	msys_Çme
[20];

239 
mdšfo
 *
	mdevs
;

240 
mdšfo
 *
	mÃxt
;

243 
	m»cov”y_fd
;

244 
	m¡©e_fd
;

245 
	#DS_FAULTY
 1

	)

246 
	#DS_INSYNC
 2

	)

247 
	#DS_WRITE_MOSTLY
 4

	)

248 
	#DS_SPARE
 8

	)

249 
	#DS_BLOCKED
 16

	)

250 
	#DS_REMOVE
 1024

	)

251 
	#DS_UNBLOCK
 2048

	)

252 
	m´ev_¡©e
, 
	mcu¼_¡©e
, 
	mÃxt_¡©e
;

256 
	sü—‹šfo
 {

257 
	muid
;

258 
	mgid
;

259 
	mautof
;

260 
	mmode
;

261 
	msymlšks
;

262 
	mÇmes
;

263 
	mbbli¡
;

264 
su³¹y³
 *
	msu³¹y³
;

267 
	#Name
 "mdadm"

	)

269 
	emode
 {

270 
	mASSEMBLE
=1,

271 
	mBUILD
,

272 
	mCREATE
,

273 
	mMANAGE
,

274 
	mMISC
,

275 
	mMONITOR
,

276 
	mGROW
,

277 
	mINCREMENTAL
,

278 
	mAUTODETECT
,

279 
	mmode_couÁ


282 
	e´efix_¡ªd¬d
 {

283 
	mJEDEC
,

284 
	mIEC


297 
	#UnS‘
 (0xffã)

	)

298 
	smddev_id’t
 {

299 *
	mdevÇme
;

301 
	muuid_£t
;

302 
	muuid
[4];

303 
	mÇme
[33];

305 
	msu³r_mšÜ
;

307 *
	mdeviûs
;

310 
	mËv–
;

311 
	m¿id_disks
;

312 
	m¥¬e_disks
;

313 
su³¹y³
 *
	m¡
;

314 
	mautof
;

315 *
	m¥¬e_group
;

316 *
	mb™m­_fe
;

317 
	mb™m­_fd
;

319 *
	mcÚš”
;

324 *
	mmemb”
;

326 
mddev_id’t
 *
	mÃxt
;

329 
	mas£mbËd
;

333 
	scÚ‹xt
 {

334 
	m»adÚly
;

335 
	mrun¡İ
;

336 
	mv”bo£
;

337 
	mbr›f
;

338 
	mfÜû
;

339 *
	mhomeho¡
;

340 
	m»quœe_homeho¡
;

341 *
	m´eãr
;

342 
	m_expÜt
;

343 
	m‹¡
;

344 *
	msub¬¿y
;

345 *
	mupd©e
;

346 
	msÿn
;

347 
	mS·rcAdju¡
;

348 
	mautof
;

349 
	md–ay
;

350 
	mä“ze_»sh­e
;

351 *
	mbackup_fe
;

352 
	mšv®id_backup
;

353 *
	maùiÚ
;

356 
	ssh­e
 {

357 
	m¿iddisks
;

358 
	m¥¬edisks
;

359 
	mËv–
;

360 
	mÏyout
;

361 *
	mÏyout_¡r
;

362 
	mchunk
;

363 
	mb™m­_chunk
;

364 *
	mb™m­_fe
;

365 
	massume_ş—n
;

366 
	mwr™e_behšd
;

367 
	msize
;

371 
	smddev_dev
 {

372 *
	mdevÇme
;

373 
	mdi¥os™iÚ
;

377 
	mwr™emo¡ly
;

378 
	mu£d
;

379 
	md©a_off£t
;

380 
mddev_dev
 *
	mÃxt
;

383 
	sm­pšg
 {

384 *
	mÇme
;

385 
	mnum
;

386 } 
	tm­pšg_t
;

388 
	smd¡©_’t
 {

389 *
	mdev
;

390 
	mdevnm
[32];

391 
	maùive
;

392 *
	mËv–
;

393 *
	m·‰”n
;

394 
	m³rûÁ
;

395 
	m»sync
;

396 
	mdevút
;

397 
	m¿id_disks
;

398 * 
	mm‘ad©a_v”siÚ
;

399 
	sdev_memb”
 {

400 *
	mÇme
;

401 
dev_memb”
 *
	mÃxt
;

402 } *
	mmemb”s
;

403 
md¡©_’t
 *
	mÃxt
;

406 
md¡©_’t
 *
md¡©_»ad
(
hŞd
, 
¡¬t
);

407 
md¡©_şo£
();

408 
ä“_md¡©
(
md¡©_’t
 *
ms
);

409 
md¡©_wa™
(
£cÚds
);

410 
md¡©_wa™_fd
(
fd
, cÚ¡ 
sig£t_t
 *
sigmask
);

411 
mddev_busy
(*
devnm
);

412 
md¡©_’t
 *
md¡©_by_compÚ’t
(*
Çme
);

413 
md¡©_’t
 *
md¡©_by_subdev
(*
subdev
, *
cÚš”
);

415 
	sm­_’t
 {

416 
m­_’t
 *
	mÃxt
;

417 
	mdevnm
[32];

418 
	mm‘ad©a
[20];

419 
	muuid
[4];

420 
	mbad
;

421 *
	m·th
;

423 
m­_upd©e
(
m­_’t
 **
mµ
, *
devnm
, *
m‘ad©a
,

424 
uuid
[4], *
·th
);

425 
m­_»move
(
m­_’t
 **
m­
, *
devnm
);

426 
m­_’t
 *
m­_by_uuid
(m­_’ˆ**
m­
, 
uuid
[4]);

427 #ifdeà
MDASSEMBLE


428 
šlše
 
m­_’t
 *
	$m­_by_devnm
(
m­_’t
 **
m­
, *
Çme
)

430  
NULL
;

431 
	}
}

432 
šlše
 
	$m­_ä“
(
m­_’t
 *
m­
)

434 
	}
}

436 
m­_’t
 *
m­_by_devnm
(m­_’ˆ**
m­
, *
devnm
);

437 
m­_ä“
(
m­_’t
 *
m­
);

439 
m­_’t
 *
m­_by_Çme
(m­_’ˆ**
m­
, *
Çme
);

440 
m­_»ad
(
m­_’t
 **
m–p
);

441 
m­_wr™e
(
m­_’t
 *
m–
);

442 
m­_d–‘e
(
m­_’t
 **
m­p
, *
devnm
);

443 
m­_add
(
m­_’t
 **
m–p
,

444 *
devnm
, *
m‘ad©a
, 
uuid
[4], *
·th
);

445 
m­_lock
(
m­_’t
 **
m–p
);

446 
m­_uÆock
(
m­_’t
 **
m–p
);

447 
m­_fÜk
();

450 
	esysfs_»ad_æags
 {

451 
	mGET_LEVEL
 = (1 << 0),

452 
	mGET_LAYOUT
 = (1 << 1),

453 
	mGET_COMPONENT
 = (1 << 2),

454 
	mGET_CHUNK
 = (1 << 3),

455 
	mGET_CACHE
 = (1 << 4),

456 
	mGET_MISMATCH
 = (1 << 5),

457 
	mGET_VERSION
 = (1 << 6),

458 
	mGET_DISKS
 = (1 << 7),

459 
	mGET_DEGRADED
 = (1 << 8),

460 
	mGET_SAFEMODE
 = (1 << 9),

461 
	mGET_BITMAP_LOCATION
 = (1 << 10),

463 
	mGET_DEVS
 = (1 << 20),

464 
	mGET_OFFSET
 = (1 << 21),

465 
	mGET_SIZE
 = (1 << 22),

466 
	mGET_STATE
 = (1 << 23),

467 
	mGET_ERROR
 = (1 << 24),

473 
sysfs_İ’
(*
devnm
, *
devÇme
, *
©Œ
);

474 
sysfs_š™
(
mdšfo
 *
mdi
, 
fd
, *
devnm
);

475 
sysfs_ä“
(
mdšfo
 *
¤a
);

476 
mdšfo
 *
sysfs_»ad
(
fd
, *
devnm
, 
İtiÚs
);

477 
sysfs_©Œ_m©ch
(cÚ¡ *
©Œ
, cÚ¡ *
¡r
);

478 
sysfs_m©ch_wÜd
(cÚ¡ *
wÜd
, **
li¡
);

479 
sysfs_£t_¡r
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

480 *
Çme
, *
v®
);

481 
sysfs_£t_num
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

482 *
Çme
, 
v®
);

483 
sysfs_£t_num_sigÃd
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

484 *
Çme
, 
v®
);

485 
sysfs_uev’t
(
mdšfo
 *
¤a
, *
ev’t
);

486 
sysfs_g‘_fd
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

487 *
Çme
);

488 
sysfs_fd_g‘_Î
(
fd
, *
v®
);

489 
sysfs_g‘_Î
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

490 *
Çme
, *
v®
);

491 
sysfs_fd_g‘_two
(
fd
, *
v1
, *
v2
);

492 
sysfs_g‘_two
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

493 *
Çme
, *
v1
, *
v2
);

494 
sysfs_fd_g‘_¡r
(
fd
, *
v®
, 
size
);

495 
sysfs_©Œibu‹_avaabË
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

496 *
Çme
);

497 
sysfs_g‘_¡r
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

498 *
Çme
, *
v®
, 
size
);

499 
sysfs_£t_§ãmode
(
mdšfo
 *
¤a
, 
ms
);

500 
sysfs_£t_¬¿y
(
mdšfo
 *
šfo
, 
v”s
);

501 
sysfs_add_disk
(
mdšfo
 *
¤a
, mdšfØ*
sd
, 
»sume
);

502 
sysfs_disk_to_scsi_id
(
fd
, 
__u32
 *
id
);

503 
sysfs_unique_hŞd”
(*
devnm
, 
rdev
);

504 
sysfs_ä“ze_¬¿y
(
mdšfo
 *
¤a
);

505 
sysfs_wa™
(
fd
, *
m£c
);

506 
lßd_sys
(*
·th
, *
buf
);

507 
»sh­e_´•¬e_fdli¡
(*
devÇme
,

508 
mdšfo
 *
¤a
,

509 
¿id_disks
,

510 
Ädisks
,

511 
blocks
,

512 *
backup_fe
,

513 *
fdli¡
,

514 *
off£ts
);

515 
»sh­e_ä“_fdli¡
(*
fdli¡
,

516 *
off£ts
,

517 
size
);

518 
»sh­e_İ’_backup_fe
(*
backup
,

519 
fd
,

520 *
devÇme
,

521 
blocks
,

522 *
fdli¡
,

523 *
off£ts
,

524 *
sysfs_Çme
,

525 
»¡¬t
);

526 
compu‹_backup_blocks
(
nchunk
, 
ochunk
,

527 
nd©a
, 
od©a
);

528 *
loÿ‹_backup
(*
Çme
);

529 *
make_backup
(*
Çme
);

531 
§ve_¡res
(*
sourû
, *
off£ts
,

532 
¿id_disks
, 
chunk_size
, 
Ëv–
, 
Ïyout
,

533 
nwr™es
, *
de¡
,

534 
¡¬t
, 
Ëngth
,

535 *
buf
);

536 
»¡Üe_¡res
(*
de¡
, *
off£ts
,

537 
¿id_disks
, 
chunk_size
, 
Ëv–
, 
Ïyout
,

538 
sourû
, 
»ad_off£t
,

539 
¡¬t
, 
Ëngth
,

540 *
¤c_buf
);

542 #iâdeà
S’dma


543 
	#S’dma
 "/u¤/lib/£ndma -t"

	)

546 
	#SYSLOG_FACILITY
 
LOG_DAEMON


	)

548 *
m­_num
(
m­pšg_t
 *
m­
, 
num
);

549 
m­_Çme
(
m­pšg_t
 *
m­
, *
Çme
);

550 
m­pšg_t
 
r5Ïyout
[], 
r6Ïyout
[], 
³rs
[], 
modes
[], 
çuÉyÏyout
[];

552 *
m­_dev_´eã¼ed
(
majÜ
, 
mšÜ
, 
ü—‹
,

553 *
´eãr
);

554 
šlše
 *
	$m­_dev
(
majÜ
, 
mšÜ
, 
ü—‹
)

556  
	`m­_dev_´eã¼ed
(
majÜ
, 
mšÜ
, 
ü—‹
, 
NULL
);

557 
	}
}

559 
	gaùive_¬¿y
;

560 
	gm‘ad©a_upd©e
;

578 
	s»sh­e
 {

579 
	mËv–
;

580 
	m·r™y
;

582 
	mÏyout
;

583 
	md©a_disks
;

584 } 
	mbefÜe
, 
	maá”
;

585 
	mbackup_blocks
;

586 
	mmš_off£t_chªge
;

587 
	m¡res
;

588 
	mÃw_size
;

618 
	ssu³rsw™ch
 {

623 (*
examše_su³r
)(
su³¹y³
 *
¡
, *
homeho¡
);

624 (*
examše_su³r_»suÉ
)(
su³¹y³
 *
¡
, *
homeho¡
, 
examše_»suÉ
 *
»suÉli¡
);

625 (*
br›f_examše_su³r
)(
su³¹y³
 *
¡
, 
v”bo£
);

626 (*
br›f_examše_sub¬¿ys
)(
su³¹y³
 *
¡
, 
v”bo£
);

627 (*
expÜt_examše_su³r
)(
su³¹y³
 *
¡
);

628 (*
examše_badblocks
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

629 (*
cİy_m‘ad©a
)(
su³¹y³
 *
¡
, 
äom
, 
to
);

634 (*
d‘a_su³r
)(
su³¹y³
 *
¡
, *
homeho¡
);

635 (*
br›f_d‘a_su³r
)(
su³¹y³
 *
¡
);

636 (*
expÜt_d‘a_su³r
)(
su³¹y³
 *
¡
);

639 (*
d‘a_¶©fÜm
)(
v”bo£
, 
’um”©e_Úly
, *
cÚŒŞËr_·th
);

640 (*
expÜt_d‘a_¶©fÜm
)(
v”bo£
, *
cÚŒŞËr_·th
);

647 (*
uuid_äom_su³r
)(
su³¹y³
 *
¡
, 
uuid
[4]);

664 (*
g‘šfo_su³r
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
, *
m­
);

665 
mdšfo
 *(*
g‘šfo_su³r_disks
)(
su³¹y³
 *
¡
);

669 (*
m©ch_home
)(
su³¹y³
 *
¡
, *
homeho¡
);

699 (*
upd©e_su³r
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
,

700 *
upd©e
,

701 *
devÇme
, 
v”bo£
,

702 
uuid_£t
, *
homeho¡
);

709 (*
š™_su³r
)(
su³¹y³
 *
¡
, 
mdu_¬¿y_šfo_t
 *
šfo
,

710 
size
, *
Çme
,

711 *
homeho¡
, *
uuid
,

712 
d©a_off£t
);

717 (*
add_to_su³r
)(
su³¹y³
 *
¡
, 
mdu_disk_šfo_t
 *
dšfo
,

718 
fd
, *
devÇme
,

719 
d©a_off£t
);

723 (*
»move_äom_su³r
)(
su³¹y³
 *
¡
, 
mdu_disk_šfo_t
 *
dšfo
);

728 (*
¡Üe_su³r
)(
su³¹y³
 *
¡
, 
fd
);

732 (*
wr™e_š™_su³r
)(
su³¹y³
 *
¡
);

740 (*
com·»_su³r
)(
su³¹y³
 *
¡
, su³¹y³ *
t¡
);

743 (*
lßd_su³r
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

747 (*
lßd_cÚš”
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

750 
su³¹y³
 * (*
m©ch_m‘ad©a_desc
)(*
¬g
);

759 
__u64
 (*
ava_size
)(
su³¹y³
 *
¡
, __u64 
size
,

760 
d©a_off£t
);

765 (*
mš_acû±abË_¥¬e_size
)(
su³¹y³
 *
¡
);

772 (*
add_š‹º®_b™m­
)(
su³¹y³
 *
¡
, *
chunkp
,

773 
d–ay
, 
wr™e_behšd
,

774 
size
, 
may_chªge
, 
majÜ
);

778 (*
loÿ‹_b™m­
)(
su³¹y³
 *
¡
, 
fd
);

782 (*
wr™e_b™m­
)(
su³¹y³
 *
¡
, 
fd
);

784 (*
ä“_su³r
)(
su³¹y³
 *
¡
);

801 (*
v®id©e_geom‘ry
)(
su³¹y³
 *
¡
, 
Ëv–
, 
Ïyout
,

802 
¿iddisks
,

803 *
chunk
, 
size
,

804 
d©a_off£t
,

805 *
subdev
, *
ä“size
,

806 
v”bo£
);

811 
mdšfo
 *(*
cÚš”_cÚ‹Á
)(
su³¹y³
 *
¡
, *
sub¬¿y
);

813 (*
deçuÉ_geom‘ry
)(
su³¹y³
 *
¡
, *
Ëv–
, *
Ïyout
, *
chunk
);

815 (*
kl_sub¬¿y
)(
su³¹y³
 *
¡
);

817 (*
upd©e_sub¬¿y
)(
su³¹y³
 *
¡
, *
sub¬¿y
,

818 *
upd©e
, 
mddev_id’t
 *
id’t
);

824 
	#APPLY_METADATA_CHANGES
 1

	)

825 
	#ROLLBACK_METADATA_CHANGES
 0

	)

827 (*
»sh­e_su³r
)(
su³¹y³
 *
¡
,

828 
size
, 
Ëv–
,

829 
Ïyout
, 
chunksize
, 
¿id_disks
,

830 
d–_disks
, *
backup
, *
dev
,

831 
dœeùiÚ
,

832 
v”bo£
);

833 (*
mªage_»sh­e
)(

834 
afd
, 
mdšfo
 *
¤a
, 
»sh­e
 *reshape,

835 
su³¹y³
 *
¡
, 
blocks
,

836 *
fds
, *
off£ts
,

837 
de¡s
, *
de¡fd
, *
de¡off£ts
);

840 (*
İ’_Ãw
)(
su³¹y³
 *
c
, 
aùive_¬¿y
 *
a
,

841 *
š¡
);

854 (*
£t_¬¿y_¡©e
)(
aùive_¬¿y
 *
a
, 
cÚsi¡’t
);

863 (*
£t_disk
)(
aùive_¬¿y
 *
a
, 
n
, 
¡©e
);

864 (*
sync_m‘ad©a
)(
su³¹y³
 *
¡
);

865 (*
´oûss_upd©e
)(
su³¹y³
 *
¡
,

866 
m‘ad©a_upd©e
 *
upd©e
);

870 (*
´•¬e_upd©e
)(
su³¹y³
 *
¡
,

871 
m‘ad©a_upd©e
 *
upd©e
);

880 
mdšfo
 *(*
aùiv©e_¥¬e
)(
aùive_¬¿y
 *
a
,

881 
m‘ad©a_upd©e
 **
upd©es
);

896 cÚ¡ *(*
g‘_disk_cÚŒŞËr_domaš
)(cÚ¡ *
·th
);

899 (*
»cov”_backup
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
);

902 (*
v®id©e_cÚš”
)(
mdšfo
 *
šfo
);

904 
sw­uuid
;

905 
ex‹º®
;

906 cÚ¡ *
Çme
;

907 } *
su³¾i¡
[];

909 
su³rsw™ch
 
su³r0
, 
su³r1
;

910 
su³rsw™ch
 
su³r_imsm
, 
su³r_ddf
;

911 
su³rsw™ch
 
mbr
, 
g±
;

913 
	sm‘ad©a_upd©e
 {

914 
	mËn
;

915 *
	mbuf
;

916 *
	m¥aû
;

917 **
	m¥aû_li¡
;

920 
m‘ad©a_upd©e
 *
	mÃxt
;

940 
	ssu³¹y³
 {

941 
su³rsw™ch
 *
	mss
;

942 
	mmšÜ_v”siÚ
;

943 
	mmax_devs
;

944 
	mcÚš”_devnm
[32];

945 *
	msb
;

946 *
	mšfo
;

947 *
	mÙh”
;

948 
	mdevsize
;

949 
	md©a_off£t
;

950 
	mignÜe_hw_com·t
;

955 
m‘ad©a_upd©e
 *
	mupd©es
;

956 
m‘ad©a_upd©e
 **
	mupd©e_
;

959 
aùive_¬¿y
 *
	m¬¿ys
;

960 
	msock
;

961 
	mdevnm
[32];

964 
	mdevút
;

965 
	m»Œy_soÚ
;

967 
mdšfo
 *
	mdevs
;

971 
su³¹y³
 *
su³r_by_fd
(
fd
, **
sub¬¿y
);

972 
	eguess_ty³s
 { 
	mguess_ªy
, 
	mguess_¬¿y
, 
	mguess_·¹™iÚs
 };

973 
su³¹y³
 *
guess_su³r_ty³
(
fd
, 
guess_ty³s
 
guess_ty³
);

974 
šlše
 
su³¹y³
 *
	$guess_su³r
(
fd
) {

975  
	`guess_su³r_ty³
(
fd
, 
guess_ªy
);

976 
	}
}

977 
su³¹y³
 *
dup_su³r
(su³¹y³ *
¡
);

978 
g‘_dev_size
(
fd
, *
dÇme
, *
siz•
);

979 
mu¡_be_cÚš”
(
fd
);

980 
dev_size_äom_id
(
dev_t
 
id
, *
size
);

981 
wa™_fÜ
(*
dev
, 
fd
);

989 
	sdev_pŞicy
 {

990 
dev_pŞicy
 *
	mÃxt
;

991 *
	mÇme
;

996 cÚ¡ *
	mm‘ad©a
;

997 cÚ¡ *
	mv®ue
;

1000 
pŞ_aù
[], 
pŞ_domaš
[], 
pŞ_m‘ad©a
[], 
pŞ_auto
[];

1006 
	#pŞ_fÜ_—ch
(
™em
, 
li¡
, 
_m‘ad©a
) \

1007 
™em
 = 
li¡
; \

1008 
™em
 && i‹m->
Çme
 =ğ
li¡
->name; \

1009 
™em
 = i‹m->
Ãxt
) \

1010 ià(!(!
_m‘ad©a
 || !
™em
->
m‘ad©a
 || _metadata == item->metadata)) \

1011 ; 

	)

1017 
	spŞ_ruË
 {

1018 
pŞ_ruË
 *
	mÃxt
;

1019 *
	mty³
;

1020 
	sruË
 {

1021 
ruË
 *
	mÃxt
;

1022 *
	mÇme
;

1023 *
	mv®ue
;

1024 *
	mdups
;

1025 } *
	mruË
;

1028 
ruË_pŞicy
[], 
ruË_·¹
[];

1029 
ruË_·th
[], 
ruË_ty³
[];

1030 
ty³_·¹
[], 
ty³_disk
[];

1032 
pŞicylše
(*
lše
, *
ty³
);

1033 
pŞicy_add
(*
ty³
, ...);

1034 
pŞicy_ä“
();

1036 
dev_pŞicy
 *
·th_pŞicy
(*
·th
, *
ty³
);

1037 
dev_pŞicy
 *
disk_pŞicy
(
mdšfo
 *
disk
);

1038 
dev_pŞicy
 *
devid_pŞicy
(
devid
);

1039 
dev_pŞicy_ä“
(
dev_pŞicy
 *
p
);

1042 
pŞ_add
(
dev_pŞicy
 **
pŞ
, *
Çme
, *
v®
, *
m‘ad©a
);

1043 
dev_pŞicy
 *
pŞ_fšd
(dev_pŞicy *
pŞ
, *
Çme
);

1045 
	epŞicy_aùiÚ
 {

1046 
	maù_deçuÉ
,

1047 
	maù_šşude
,

1048 
	maù_»_add
,

1049 
	maù_¥¬e
,

1050 
	maù_¥¬e_§me_¦Ù
,

1052 
	maù_fÜû_¥¬e
,

1053 
	maù_”r


1056 
pŞicy_aùiÚ_®lows
(
dev_pŞicy
 *
¶i¡
, cÚ¡ *
m‘ad©a
,

1057 
pŞicy_aùiÚ
 
wªt
);

1058 
disk_aùiÚ_®lows
(
mdšfo
 *
disk
, cÚ¡ *
m‘ad©a
,

1059 
pŞicy_aùiÚ
 
wªt
);

1061 
	sdomašli¡
 {

1062 
domašli¡
 *
	mÃxt
;

1063 cÚ¡ *
	mdom
;

1066 
domaš_‹¡
(
domašli¡
 *
dom
, 
dev_pŞicy
 *
pŞ
,

1067 cÚ¡ *
m‘ad©a
);

1068 
domašli¡
 *
domaš_äom_¬¿y
(
mdšfo
 *
mdi
,

1069 cÚ¡ *
m‘ad©a
);

1070 
domašli¡_add_dev
(
domašli¡
 **
dom
, 
devid
,

1071 cÚ¡ *
m‘ad©a
);

1072 
domaš_ä“
(
domašli¡
 *
dl
);

1073 
domaš_m”ge
(
domašli¡
 **
domp
, 
dev_pŞicy
 *
pŞ
,

1074 cÚ¡ *
m‘ad©a
);

1075 
domaš_add
(
domašli¡
 **
domp
, *
domaš
);

1077 
pŞicy_§ve_·th
(*
id_·th
, 
m­_’t
 *
¬¿y
);

1078 
pŞicy_check_·th
(
mdšfo
 *
disk
, 
m­_’t
 *
¬¿y
);

1080 #ià
__GNUC__
 < 3

1081 
	g¡©64
;

1084 
	#HAVE_NFTW
 
we
 
assume


	)

1085 
	#HAVE_FTW


	)

1087 #ifdeà
__UCLIBC__


1088 
	~<ã©u»s.h
>

1089 #iâdeà
__UCLIBC_HAS_LFS__


1090 
	#l£ek64
 
l£ek


	)

1092 #iâdeà 
__UCLIBC_HAS_FTW__


1093 #undeà
HAVE_FTW


1094 #undeà
HAVE_NFTW


1098 #ifdeà
__d›ibc__


1099 #undeà
HAVE_NFTW


1102 #ià
defšed
(
__KLIBC__
)

1103 #undeà
HAVE_NFTW


1104 #undeà
HAVE_FTW


1107 #iâdeà
HAVE_NFTW


1108 
	#FTW_PHYS
 1

	)

1109 #iâdeà
HAVE_FTW


1110 
	sFTW
 {};

1114 #ifdeà
HAVE_FTW


1115 
	~<áw.h
>

1118 
add_dev
(cÚ¡ *
Çme
, cÚ¡ 
¡©
 *
¡b
, 
æag
, 
FTW
 *
s
);

1120 
Mªage_ro
(*
devÇme
, 
fd
, 
»adÚly
);

1121 
Mªage_run
(*
devÇme
, 
fd
, 
cÚ‹xt
 *
c
);

1122 
Mªage_¡İ
(*
devÇme
, 
fd
, 
qu›t
,

1123 
wl_»Œy
);

1124 
Mªage_subdevs
(*
devÇme
, 
fd
,

1125 
mddev_dev
 *
devli¡
, 
v”bo£
, 
‹¡
,

1126 *
upd©e
, 
fÜû
);

1127 
autod‘eù
();

1128 
Grow_Add_deviû
(*
devÇme
, 
fd
, *
Ãwdev
);

1129 
Grow_addb™m­
(*
devÇme
, 
fd
,

1130 
cÚ‹xt
 *
c
, 
sh­e
 *
s
);

1131 
Grow_»sh­e
(*
devÇme
, 
fd
,

1132 
mddev_dev
 *
devli¡
,

1133 
d©a_off£t
,

1134 
cÚ‹xt
 *
c
, 
sh­e
 *
s
);

1135 
Grow_»¡¬t
(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
,

1136 *
fdli¡
, 
út
, *
backup_fe
, 
v”bo£
);

1137 
Grow_cÚtšue
(
mdfd
, 
su³¹y³
 *
¡
,

1138 
mdšfo
 *
šfo
, *
backup_fe
,

1139 
fÜked
, 
ä“ze_»sh­e
);

1141 
»¡Üe_backup
(
su³¹y³
 *
¡
,

1142 
mdšfo
 *
cÚ‹Á
,

1143 
wÜkšg_disks
,

1144 
¥¬es
,

1145 **
backup_f•
,

1146 
v”bo£
);

1147 
Grow_cÚtšue_commªd
(*
devÇme
, 
fd
,

1148 *
backup_fe
, 
v”bo£
);

1150 
As£mbË
(
su³¹y³
 *
¡
, *
mddev
,

1151 
mddev_id’t
 *
id’t
,

1152 
mddev_dev
 *
devli¡
,

1153 
cÚ‹xt
 *
c
);

1155 
Bud
(*
mddev
, 
mddev_dev
 *
devli¡
,

1156 
sh­e
 *
s
, 
cÚ‹xt
 *
c
);

1158 
C»©e
(
su³¹y³
 *
¡
, *
mddev
,

1159 *
Çme
, *
uuid
,

1160 
subdevs
, 
mddev_dev
 *
devli¡
,

1161 
sh­e
 *
s
,

1162 
cÚ‹xt
 *
c
,

1163 
d©a_off£t
);

1165 
D‘a
(*
dev
, 
cÚ‹xt
 *
c
);

1166 
D‘a_PÏtfÜm
(
su³rsw™ch
 *
ss
, 
sÿn
, 
v”bo£
, 
_expÜt
, *
cÚŒŞËr_·th
);

1167 
D‘a_ToA¼ayD‘a
(cÚ¡ *
dev
, 
cÚ‹xt
 *
c
, 
¬¿y_d‘a
 *
ad
);

1168 
Qu”y
(*
dev
);

1169 
ExamšeBadblocks
(*
devÇme
, 
br›f
, 
su³¹y³
 *
fÜû¡
);

1170 
Examše
(
mddev_dev
 *
devli¡
, 
cÚ‹xt
 *
c
,

1171 
su³¹y³
 *
fÜû¡
);

1172 
Examše_ToResuÉ
(
mddev_dev
 *
devli¡
,

1173 
cÚ‹xt
 *
c
,

1174 
su³¹y³
 *
fÜû¡
,

1175 
examše_»suÉ
 *
»suÉ
);

1176 
MÚ™Ü
(
mddev_dev
 *
devli¡
,

1177 *
maaddr
, *
®”t_cmd
,

1178 
cÚ‹xt
 *
c
,

1179 
d«mÚi£
, 
ÚeshÙ
,

1180 
dosy¦og
, *
pidfe
, 
šüem’ts
,

1181 
sh¬e
);

1183 
Kl
(*
dev
, 
su³¹y³
 *
¡
, 
fÜû
, 
v”bo£
, 
nÛxş
);

1184 
Kl_sub¬¿y
(*
dev
, *
sub¬¿y
, 
v”bo£
);

1185 
Upd©e_sub¬¿y
(*
dev
, *
sub¬¿y
, *
upd©e
, 
mddev_id’t
 *
id’t
, 
qu›t
);

1186 
Wa™
(*
dev
);

1187 
Wa™CËª
(*
dev
, 
sock
, 
v”bo£
);

1188 
S‘AùiÚ
(*
dev
, *
aùiÚ
);

1190 
Inüem’l
(
mddev_dev
 *
devli¡
, 
cÚ‹xt
 *
c
,

1191 
su³¹y³
 *
¡
);

1192 
RebudM­
();

1193 
Inüem’lSÿn
(
cÚ‹xt
 *
c
, *
devnm
);

1194 
Inüem’lRemove
(*
devÇme
, *
·th
, 
v”bo£
);

1195 
C»©eB™m­
(*
f’ame
, 
fÜû
, 
uuid
[16],

1196 
chunksize
, 
d«mÚ_¦“p
,

1197 
wr™e_behšd
,

1198 
¬¿y_size
,

1199 
majÜ
);

1200 
ExamšeB™m­
(*
f’ame
, 
br›f
, 
su³¹y³
 *
¡
);

1201 
Wr™e_ruËs
(*
ruË_Çme
);

1202 
b™m­_upd©e_uuid
(
fd
, *
uuid
, 
sw­
);

1203 
b™m­_£ùÜs
(
b™m­_su³r_s
 *
bsb
);

1204 
Dump_m‘ad©a
(*
dev
, *
dœ
, 
cÚ‹xt
 *
c
,

1205 
su³¹y³
 *
¡
);

1206 
Re¡Üe_m‘ad©a
(*
dev
, *
dœ
, 
cÚ‹xt
 *
c
,

1207 
su³¹y³
 *
¡
, 
Úly
);

1209 
md_g‘_v”siÚ
(
fd
);

1210 
g‘_lšux_v”siÚ
();

1211 
mdadm_v”siÚ
(*
v”siÚ
);

1212 
·r£_size
(*
size
);

1213 
·r£_uuid
(*
¡r
, 
uuid
[4]);

1214 
·r£_Ïyout_10
(*
Ïyout
);

1215 
·r£_Ïyout_çuÉy
(*
Ïyout
);

1216 
·r£_num
(*
num
);

1217 
check_ext2
(
fd
, *
Çme
);

1218 
check_»i£r
(
fd
, *
Çme
);

1219 
check_¿id
(
fd
, *
Çme
);

1220 
check_·¹™iÚs
(
fd
, *
dÇme
,

1221 
ä“size
,

1222 
size
);

1224 
g‘_mdp_majÜ
();

1225 
g‘_maj_mš
(*
dev
, *
majÜ
, *
mšÜ
);

1226 
dev_İ’
(*
dev
, 
æags
);

1227 
İ’_dev
(*
devnm
);

1228 
»İ’_mddev
(
mdfd
);

1229 
İ’_dev_æags
(*
devnm
, 
æags
);

1230 
İ’_dev_exş
(*
devnm
);

1231 
is_¡ªd¬d
(*
dev
, *
nump
);

1232 
§me_dev
(*
Úe
, *
two
);

1233 
com·»_·ths
 (* 
·th1
,* 
·th2
);

1234 
’abË_fds
(
deviûs
);

1236 
·r£_auto
(*
¡r
, *
msg
, 
cÚfig
);

1237 
mddev_id’t
 *
cÚf_g‘_id’t
(*
dev
);

1238 
mddev_dev
 *
cÚf_g‘_devs
();

1239 
cÚf_‹¡_dev
(*
devÇme
);

1240 
cÚf_‹¡_m‘ad©a
(cÚ¡ *
v”siÚ
, 
dev_pŞicy
 *
pŞ
, 
is_homeho¡
);

1241 
ü—‹šfo
 *
cÚf_g‘_ü—‹_šfo
();

1242 
£t_cÚffe
(*
fe
);

1243 *
cÚf_g‘_maaddr
();

1244 *
cÚf_g‘_maäom
();

1245 *
cÚf_g‘_´og¿m
();

1246 *
cÚf_g‘_homeho¡
(*
»quœe_homeho¡p
);

1247 *
cÚf_lše
(
FILE
 *
fe
);

1248 *
cÚf_wÜd
(
FILE
 *
fe
, 
®low_key
);

1249 
´št_quÙed
(*
¡r
);

1250 
´št_esÿ³
(*
¡r
);

1251 
u£_udev
();

1252 
GCD
(
a
, 
b
);

1253 
cÚf_Çme_is_ä“
(*
Çme
);

1254 
cÚf_v”ify_devÇmes
(
mddev_id’t
 *
¬¿y_li¡
);

1255 
devÇme_m©ches
(*
Çme
, *
m©ch
);

1256 
mddev_id’t
 *
cÚf_m©ch
(
su³¹y³
 *
¡
,

1257 
mdšfo
 *
šfo
,

1258 *
devÇme
,

1259 
v”bo£
, *
rvp
);

1260 
ex³rim’l
();

1262 
ä“_lše
(*
lše
);

1263 
m©ch_Úeof
(*
deviûs
, *
devÇme
);

1264 
uuid_äom_su³r
(
uuid
[4], 
mdp_su³r_t
 *
su³r
);

1265 cÚ¡ 
uuid_z”o
[4];

1266 
§me_uuid
(
a
[4], 
b
[4], 
sw­uuid
);

1267 
cİy_uuid
(*
a
, 
b
[4], 
sw­uuid
);

1268 *
__âame_äom_uuid
(
id
[4], 
sw­
, *
buf
, 
£p
);

1269 *
âame_äom_uuid
(
su³¹y³
 *
¡
,

1270 
mdšfo
 *
šfo
, *
buf
, 
£p
);

1271 
ÿlc_csum
(*
su³r
, 
by‹s
);

1272 
’ough
(
Ëv–
, 
¿id_disks
, 
Ïyout
, 
ş—n
,

1273 *
ava
);

1274 
’ough_fd
(
fd
);

1275 
ask
(*
mesg
);

1276 
g‘_compÚ’t_size
(
fd
);

1277 
»move_·¹™iÚs
(
fd
);

1278 
‹¡_·¹™iÚ
(
fd
);

1279 
‹¡_·¹™iÚ_äom_id
(
dev_t
 
id
);

1280 
g‘_d©a_disks
(
Ëv–
, 
Ïyout
, 
¿id_disks
);

1281 
ÿlc_¬¿y_size
(
Ëv–
, 
¿id_disks
, 
Ïyout
,

1282 
chunksize
, 
devsize
);

1283 
æush_m‘ad©a_upd©es
(
su³¹y³
 *
¡
);

1284 
­³nd_m‘ad©a_upd©e
(
su³¹y³
 *
¡
, *
buf
, 
Ën
);

1285 
as£mbË_cÚš”_cÚ‹Á
(
su³¹y³
 *
¡
, 
mdfd
,

1286 
mdšfo
 *
cÚ‹Á
,

1287 
cÚ‹xt
 *
c
,

1288 *
cho£n_Çme
, *
»suÉ
);

1289 
	#INCR_NO
 1

	)

1290 
	#INCR_UNSAFE
 2

	)

1291 
	#INCR_ALREADY
 4

	)

1292 
	#INCR_YES
 8

	)

1293 
mdšfo
 *
cÚš”_choo£_¥¬es
(
su³¹y³
 *
¡
,

1294 
mš_size
,

1295 
domašli¡
 *
domli¡
,

1296 *
¥¬e_group
,

1297 cÚ¡ *
m‘ad©a
, 
g‘_Úe
);

1298 
move_¥¬e
(*
äom_devÇme
, *
to_devÇme
, 
dev_t
 
devid
);

1299 
add_disk
(
mdfd
, 
su³¹y³
 *
¡
,

1300 
mdšfo
 *
¤a
, mdšfØ*
šfo
);

1301 
»move_disk
(
mdfd
, 
su³¹y³
 *
¡
,

1302 
mdšfo
 *
¤a
, mdšfØ*
šfo
);

1303 
£t_¬¿y_šfo
(
mdfd
, 
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
);

1304 
mš_»cov”y_¡¬t
(
mdšfo
 *
¬¿y
);

1306 *
humª_size
(
by‹s
);

1307 *
humª_size_br›f
(
by‹s
, 
´efix
);

1308 
´št_r10_Ïyout
(
Ïyout
);

1310 *
fšd_ä“_devnm
(
u£_·¹™iÚs
);

1312 
put_md_Çme
(*
Çme
);

1313 *
devid2kÇme
(
devid
);

1314 *
devid2devnm
(
devid
);

1315 
devnm2devid
(*
devnm
);

1316 *
g‘_md_Çme
(*
devnm
);

1318 
DeçuÉCÚfFe
[];

1320 
ü—‹_mddev
(*
dev
, *
Çme
, 
autof
, 
Œu¡wÜthy
,

1321 *
cho£n
);

1323 
	#LOCAL
 1

	)

1324 
	#LOCAL_ANY
 10

	)

1325 
	#FOREIGN
 2

	)

1326 
	#METADATA
 3

	)

1327 
İ’_mddev
(*
dev
, 
»pÜt_”rÜs
);

1328 
İ’_cÚš”
(
fd
);

1329 
m‘ad©a_cÚš”_m©ches
(*
m‘ad©a
, *
devnm
);

1330 
m‘ad©a_subdev_m©ches
(*
m‘ad©a
, *
devnm
);

1331 
is_cÚš”_memb”
(
md¡©_’t
 *
’t
, *
devÇme
);

1332 
is_sub¬¿y_aùive
(*
sub¬¿y
, *
devÇme
);

1333 
İ’_sub¬¿y
(*
dev
, *
sub¬¿y
, 
su³¹y³
 *
¡
, 
qu›t
);

1334 
su³rsw™ch
 *
v”siÚ_to_su³rsw™ch
(*
v”s
);

1336 
mdmÚ_ruÂšg
(*
devnm
);

1337 
mdmÚ_pid
(*
devnm
);

1338 
check_’v
(*
Çme
);

1339 
__u32
 
¿ndom32
();

1340 
¡¬t_mdmÚ
(*
devnm
);

1342 
chd_mÚ™Ü
(
afd
, 
mdšfo
 *
¤a
, 
»sh­e
 *reshape,

1343 
su³¹y³
 *
¡
, 
¡res
,

1344 *
fds
, *
off£ts
,

1345 
de¡s
, *
de¡fd
, *
de¡off£ts
);

1346 
abÜt_»sh­e
(
mdšfo
 *
¤a
);

1348 *
su³r1_make_v0
(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
, 
mdp_su³r_t
 *
sb0
);

1350 
fmt_devÇme
(*
Çme
, 
num
);

1351 *
¡©2devnm
(
¡©
 *
¡
);

1352 *
fd2devnm
(
fd
);

1354 
š_š™rd
();

1356 
	#_ROUND_UP
(
v®
, 
ba£
è(((v®è+ (ba£è- 1è& ~(ba£ - 1))

	)

1357 
	#ROUND_UP
(
v®
, 
ba£
è
	`_ROUND_UP
(v®, (
	`ty³of
(v®))(ba£))

	)

1358 
	#ROUND_UP_PTR
(
±r
, 
ba£
è((
	`ty³of
(ptr)) \

1359 (
	`ROUND_UP
(()(
±r
), 
ba£
)))

	)

1361 
šlše
 
	$is_sub¬¿y
(*
v”s
)

1372  (*
v”s
 == '/' || *vers == '-');

1373 
	}
}

1375 
šlše
 *
	$to_sub¬¿y
(
md¡©_’t
 *
’t
, *
cÚš”
)

1377  &
’t
->
m‘ad©a_v”siÚ
[10+
	`¡¾’
(
cÚš”
)+1];

1378 
	}
}

1380 #ifdeà
DEBUG


1381 
	#d´štf
(
fmt
, 
¬g
...) \

1382 
	`årštf
(
¡d”r
, 
fmt
, ##
¬g
)

	)

1384 
	#d´štf
(
fmt
, 
¬g
...) \

1385 ({ ià(0è
	`årštf
(
¡d”r
, 
fmt
, ##
¬g
); 0; })

	)

1387 
	~<as£¹.h
>

1388 
	~<¡d¬g.h
>

1389 
šlše
 
	$xa¥rštf
(**
¡½
, cÚ¡ *
fmt
, ...) {

1390 
va_li¡
 
­
;

1391 
»t
;

1392 
	`va_¡¬t
(
­
, 
fmt
);

1393 
»t
 = 
	`va¥rštf
(
¡½
, 
fmt
, 
­
);

1394 
	`va_’d
(
­
);

1395 
	`as£¹
(
»t
 >= 0);

1396  
»t
;

1397 
	}
}

1399 #ifdeà
DEBUG


1400 
	#´_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, 
Name
 ": " fmt)

	)

1401 
	#cÚt_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, " " fmt)

	)

1403 
	#´_”r
(
fmt
 ...è({ ià(0è
	`årštf
(
¡d”r
, 
Name
 ": " fmt); })

	)

1404 
	#cÚt_”r
(
fmt
 ...è({ ià(0è
	`årštf
(
¡d”r
, " " fmt); })

	)

1407 *
xm®loc
(
size_t
 
Ën
);

1408 *
x»®loc
(*
±r
, 
size_t
 
Ën
);

1409 *
xÿÎoc
(
size_t
 
num
, size_ˆ
size
);

1410 *
x¡rdup
(cÚ¡ *
¡r
);

1412 
	#LEVEL_MULTIPATH
 (-4)

	)

1413 
	#LEVEL_LINEAR
 (-1)

	)

1414 
	#LEVEL_FAULTY
 (-5)

	)

1417 
	#LEVEL_CONTAINER
 (-100)

	)

1418 
	#LEVEL_UNSUPPORTED
 (-200)

	)

1421 
	#LEVEL_NONE
 (-1000000)

	)

1425 
	#Wr™eT¿ns›Á
 0

	)

1426 
	#R—dT¿ns›Á
 1

	)

1427 
	#Wr™eP”si¡’t
 2

	)

1428 
	#R—dP”si¡’t
 3

	)

1429 
	#Wr™eAÎ
 4

	)

1430 
	#R—dFixabË
 5

	)

1431 
	#Modes
 6

	)

1433 
	#CË¬E¼Üs
 31

	)

1434 
	#CË¬FauÉs
 30

	)

1436 
	#AÎP”si¡
 100

	)

1437 
	#NoP”si¡
 101

	)

1439 
	#ModeMask
 0x1f

	)

1440 
	#ModeShiá
 5

	)

1442 #ifdeà
__TINYC__


1443 #undeà
mšÜ


1444 #undeà
majÜ


1445 #undeà
makedev


1446 
	#mšÜ
(
x
è((x)&0xff)

	)

1447 
	#majÜ
(
x
è(((x)>>8)&0xff)

	)

1448 
	#makedev
(
M
,
m
è(((M)<<8è| (m))

	)

1452 
	#ALGORITHM_LEFT_ASYMMETRIC
 0

	)

1453 
	#ALGORITHM_RIGHT_ASYMMETRIC
 1

	)

1454 
	#ALGORITHM_LEFT_SYMMETRIC
 2

	)

1455 
	#ALGORITHM_RIGHT_SYMMETRIC
 3

	)

1460 
	#ALGORITHM_PARITY_0
 4

	)

1461 
	#ALGORITHM_PARITY_N
 5

	)

1475 
	#ALGORITHM_ROTATING_ZERO_RESTART
 8

	)

1476 
	#ALGORITHM_ROTATING_N_RESTART
 9

	)

1477 
	#ALGORITHM_ROTATING_N_CONTINUE
 10

	)

1484 
	#ALGORITHM_LEFT_ASYMMETRIC_6
 16

	)

1485 
	#ALGORITHM_RIGHT_ASYMMETRIC_6
 17

	)

1486 
	#ALGORITHM_LEFT_SYMMETRIC_6
 18

	)

1487 
	#ALGORITHM_RIGHT_SYMMETRIC_6
 19

	)

1488 
	#ALGORITHM_PARITY_0_6
 20

	)

1489 
	#ALGORITHM_PARITY_N_6
 
ALGORITHM_PARITY_N


	)

1494 #iâdeà
PATH_MAX


1495 
	#PATH_MAX
 4096

	)

1498 
	#RESYNC_NONE
 -1

	)

1499 
	#RESYNC_DELAYED
 -2

	)

1500 
	#RESYNC_PENDING
 -3

	)

1501 
	#RESYNC_UNKNOWN
 -4

	)

1509 
	#MAX_DISKS
 4096

	)

1514 
	#MAX_SIZE
 1

	)

1519 
	#INVALID_SECTORS
 1

	)

1521 
	#VARIABLE_OFFSET
 3

	)

1523 
	#V”siÚ
 "NUUO"

	)

	@libmdadm/mdadm.h

25 
	#_GNU_SOURCE


	)

26 
	#_FILE_OFFSET_BITS
 64

	)

27 
	~<uni¡d.h
>

28 #ifdeà
__GLIBC__


29 
__off64_t
 
l£ek64
 
__P
 ((
__fd
, __off64_ˆ
__off£t
, 
__wh’û
));

30 #–ià!
defšed
(
l£ek64
)

31 #ià
defšed
(
__NO_STAT64
è|| 
__WORDSIZE
 != 32

32 
	#l£ek64
 
l£ek


	)

36 
	~<sys/ty³s.h
>

37 
	~<sys/¡©.h
>

38 
	~<¡dlib.h
>

39 
	~<time.h
>

40 
	~<sys/time.h
>

41 
	~<g‘İt.h
>

42 
	~<fú.h
>

43 
	~<¡dio.h
>

44 
	~<”ºo.h
>

45 
	~<¡ršg.h
>

46 
	~<sy¦og.h
>

47 #ifdeà
__d›ibc__


48 
	~<¡ršgs.h
>

50 
	#¿ndom
 
¿nd


	)

51 
	#¤ªdom
 
¤ªd


	)

54 
	~<lšux/kdev_t.h
>

56 
	~<sys/mouÁ.h
>

57 
	~<asm/ty³s.h
>

58 
	~<sys/ioùl.h
>

59 
	#MD_MAJOR
 9

	)

60 
	#MdpMšÜShiá
 6

	)

62 #iâdeà
BLKGETSIZE64


63 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
è

	)

66 
	#DEFAULT_CHUNK
 512

	)

67 
	#DEFAULT_BITMAP_CHUNK
 4096

	)

68 
	#DEFAULT_BITMAP_DELAY
 5

	)

69 
	#DEFAULT_MAX_WRITE_BEHIND
 256

	)

75 #iâdeà
MAP_DIR


76 
	#MAP_DIR
 "/run/mdadm"

	)

81 #iâdeà
MAP_FILE


82 
	#MAP_FILE
 "m­"

	)

92 #iâdeà
MDMON_DIR


93 
	#MDMON_DIR
 "/run/mdadm"

	)

100 #iâdeà
FAILED_SLOTS_DIR


101 
	#FAILED_SLOTS_DIR
 "/run/mdadm/çed-¦Ùs"

	)

104 
	~"md_u.h
"

105 
	~"md_p.h
"

106 
	~"b™m­.h
"

107 
	~"msg.h
"

108 
	~"mdadm_”rcode.h
"

109 
	~"mdadm_Ùh”.h
"

111 
	~<’dŸn.h
>

117 
	#bsw­_16
(
x
) (((x) & 0x00ffU) << 8 | \

118 ((
x
è& 0xff00Uè>> 8)

	)

119 
	#bsw­_32
(
x
) (((x) & 0x000000ffU) << 24 | \

120 ((
x
) & 0xff000000U) >> 24 | \

121 ((
x
) & 0x0000ff00U) << 8 | \

122 ((
x
è& 0x00ff0000Uè>> 8)

	)

123 
	#bsw­_64
(
x
) (((x) & 0x00000000000000ffULL) << 56 | \

124 ((
x
) & 0xff00000000000000ULL) >> 56 | \

125 ((
x
) & 0x000000000000ff00ULL) << 40 | \

126 ((
x
) & 0x00ff000000000000ULL) >> 40 | \

127 ((
x
) & 0x0000000000ff0000ULL) << 24 | \

128 ((
x
) & 0x0000ff0000000000ULL) >> 24 | \

129 ((
x
) & 0x00000000ff000000ULL) << 8 | \

130 ((
x
è& 0x000000ff00000000ULLè>> 8)

	)

132 #ià!
defšed
(
__KLIBC__
)

133 #ià
BYTE_ORDER
 =ğ
LITTLE_ENDIAN


134 
	#__ıu_to_Ë16
(
_x
è()(_x)

	)

135 
	#__ıu_to_Ë32
(
_x
è()(_x)

	)

136 
	#__ıu_to_Ë64
(
_x
è()(_x)

	)

137 
	#__Ë16_to_ıu
(
_x
è()(_x)

	)

138 
	#__Ë32_to_ıu
(
_x
è()(_x)

	)

139 
	#__Ë64_to_ıu
(
_x
è()(_x)

	)

141 
	#__ıu_to_be16
(
_x
è
	`bsw­_16
(_x)

	)

142 
	#__ıu_to_be32
(
_x
è
	`bsw­_32
(_x)

	)

143 
	#__ıu_to_be64
(
_x
è
	`bsw­_64
(_x)

	)

144 
	#__be16_to_ıu
(
_x
è
	`bsw­_16
(_x)

	)

145 
	#__be32_to_ıu
(
_x
è
	`bsw­_32
(_x)

	)

146 
	#__be64_to_ıu
(
_x
è
	`bsw­_64
(_x)

	)

147 #–ià
BYTE_ORDER
 =ğ
BIG_ENDIAN


148 
	#__ıu_to_Ë16
(
_x
è
	`bsw­_16
(_x)

	)

149 
	#__ıu_to_Ë32
(
_x
è
	`bsw­_32
(_x)

	)

150 
	#__ıu_to_Ë64
(
_x
è
	`bsw­_64
(_x)

	)

151 
	#__Ë16_to_ıu
(
_x
è
	`bsw­_16
(_x)

	)

152 
	#__Ë32_to_ıu
(
_x
è
	`bsw­_32
(_x)

	)

153 
	#__Ë64_to_ıu
(
_x
è
	`bsw­_64
(_x)

	)

155 
	#__ıu_to_be16
(
_x
è()(_x)

	)

156 
	#__ıu_to_be32
(
_x
è()(_x)

	)

157 
	#__ıu_to_be64
(
_x
è()(_x)

	)

158 
	#__be16_to_ıu
(
_x
è()(_x)

	)

159 
	#__be32_to_ıu
(
_x
è()(_x)

	)

160 
	#__be64_to_ıu
(
_x
è()(_x)

	)

171 
	#mš
(
x
, 
y
) ({ \

172 
	`ty³of
(
x
è
_mš1
 = (x); \

173 
	`ty³of
(
y
è
_mš2
 = (y); \

174 (è(&
_mš1
 =ğ&
_mš2
); \

175 
_mš1
 < 
_mš2
 ? _mš1 : _mš2; })

	)

177 
	#max
(
x
, 
y
) ({ \

178 
	`ty³of
(
x
è
_max1
 = (x); \

179 
	`ty³of
(
y
è
_max2
 = (y); \

180 (è(&
_max1
 =ğ&
_max2
); \

181 
_max1
 > 
_max2
 ? _max1 : _max2; })

	)

183 
	#ARRAY_SIZE
(
x
è((x)/(x[0]))

	)

186 
	smdšfo
 {

187 
mdu_¬¿y_šfo_t
 
	m¬¿y
;

188 
mdu_disk_šfo_t
 
	mdisk
;

189 
__u64
 
	mev’ts
;

190 
	muuid
[4];

191 
	mÇme
[33];

192 
	md©a_off£t
;

193 
	mÃw_d©a_off£t
;

194 
	mcompÚ’t_size
;

197 
	mcu¡om_¬¿y_size
;

200 
	#NO_RESHAPE
 0

	)

201 
	#VOLUME_RESHAPE
 1

	)

202 
	#CONTAINER_RESHAPE
 2

	)

203 
	#RESHAPE_NO_BACKUP
 16

	)

204 
	m»sh­e_aùive
;

205 
	m»sh­e_´og»ss
;

206 
	m»cov”y_blocked
;

218 
	m¥aû_befÜe
, 
	m¥aû_aá”
;

220 
	m»sync_¡¬t
;

221 
	m»cov”y_¡¬t
;

222 
	#MaxSeùÜ
 (~0ULLè

	)

224 
	mb™m­_off£t
;

225 
	m§ã_mode_d–ay
;

226 
	mÃw_Ëv–
, 
	md–_disks
, 
	mÃw_Ïyout
, 
	mÃw_chunk
;

227 
	m”rÜs
;

228 
	mÿche_size
;

229 
	mmism©ch_út
;

230 
	m‹xt_v”siÚ
[50];

232 
	mcÚš”_memb”
;

235 
	mcÚš”_’ough
;

238 
	msys_Çme
[20];

239 
mdšfo
 *
	mdevs
;

240 
mdšfo
 *
	mÃxt
;

243 
	m»cov”y_fd
;

244 
	m¡©e_fd
;

245 
	#DS_FAULTY
 1

	)

246 
	#DS_INSYNC
 2

	)

247 
	#DS_WRITE_MOSTLY
 4

	)

248 
	#DS_SPARE
 8

	)

249 
	#DS_BLOCKED
 16

	)

250 
	#DS_REMOVE
 1024

	)

251 
	#DS_UNBLOCK
 2048

	)

252 
	m´ev_¡©e
, 
	mcu¼_¡©e
, 
	mÃxt_¡©e
;

256 
	sü—‹šfo
 {

257 
	muid
;

258 
	mgid
;

259 
	mautof
;

260 
	mmode
;

261 
	msymlšks
;

262 
	mÇmes
;

263 
	mbbli¡
;

264 
su³¹y³
 *
	msu³¹y³
;

267 
	#Name
 "mdadm"

	)

269 
	emode
 {

270 
	mASSEMBLE
=1,

271 
	mBUILD
,

272 
	mCREATE
,

273 
	mMANAGE
,

274 
	mMISC
,

275 
	mMONITOR
,

276 
	mGROW
,

277 
	mINCREMENTAL
,

278 
	mAUTODETECT
,

279 
	mmode_couÁ


282 
	e´efix_¡ªd¬d
 {

283 
	mJEDEC
,

284 
	mIEC


297 
	#UnS‘
 (0xffã)

	)

298 
	smddev_id’t
 {

299 *
	mdevÇme
;

301 
	muuid_£t
;

302 
	muuid
[4];

303 
	mÇme
[33];

305 
	msu³r_mšÜ
;

307 *
	mdeviûs
;

310 
	mËv–
;

311 
	m¿id_disks
;

312 
	m¥¬e_disks
;

313 
su³¹y³
 *
	m¡
;

314 
	mautof
;

315 *
	m¥¬e_group
;

316 *
	mb™m­_fe
;

317 
	mb™m­_fd
;

319 *
	mcÚš”
;

324 *
	mmemb”
;

326 
mddev_id’t
 *
	mÃxt
;

329 
	mas£mbËd
;

333 
	scÚ‹xt
 {

334 
	m»adÚly
;

335 
	mrun¡İ
;

336 
	mv”bo£
;

337 
	mbr›f
;

338 
	mfÜû
;

339 *
	mhomeho¡
;

340 
	m»quœe_homeho¡
;

341 *
	m´eãr
;

342 
	m_expÜt
;

343 
	m‹¡
;

344 *
	msub¬¿y
;

345 *
	mupd©e
;

346 
	msÿn
;

347 
	mS·rcAdju¡
;

348 
	mautof
;

349 
	md–ay
;

350 
	mä“ze_»sh­e
;

351 *
	mbackup_fe
;

352 
	mšv®id_backup
;

353 *
	maùiÚ
;

356 
	ssh­e
 {

357 
	m¿iddisks
;

358 
	m¥¬edisks
;

359 
	mËv–
;

360 
	mÏyout
;

361 *
	mÏyout_¡r
;

362 
	mchunk
;

363 
	mb™m­_chunk
;

364 *
	mb™m­_fe
;

365 
	massume_ş—n
;

366 
	mwr™e_behšd
;

367 
	msize
;

371 
	smddev_dev
 {

372 *
	mdevÇme
;

373 
	mdi¥os™iÚ
;

377 
	mwr™emo¡ly
;

378 
	mu£d
;

379 
	md©a_off£t
;

380 
mddev_dev
 *
	mÃxt
;

383 
	sm­pšg
 {

384 *
	mÇme
;

385 
	mnum
;

386 } 
	tm­pšg_t
;

388 
	smd¡©_’t
 {

389 *
	mdev
;

390 
	mdevnm
[32];

391 
	maùive
;

392 *
	mËv–
;

393 *
	m·‰”n
;

394 
	m³rûÁ
;

395 
	m»sync
;

396 
	mdevút
;

397 
	m¿id_disks
;

398 * 
	mm‘ad©a_v”siÚ
;

399 
	sdev_memb”
 {

400 *
	mÇme
;

401 
dev_memb”
 *
	mÃxt
;

402 } *
	mmemb”s
;

403 
md¡©_’t
 *
	mÃxt
;

406 
md¡©_’t
 *
md¡©_»ad
(
hŞd
, 
¡¬t
);

407 
md¡©_şo£
();

408 
ä“_md¡©
(
md¡©_’t
 *
ms
);

409 
md¡©_wa™
(
£cÚds
);

410 
md¡©_wa™_fd
(
fd
, cÚ¡ 
sig£t_t
 *
sigmask
);

411 
mddev_busy
(*
devnm
);

412 
md¡©_’t
 *
md¡©_by_compÚ’t
(*
Çme
);

413 
md¡©_’t
 *
md¡©_by_subdev
(*
subdev
, *
cÚš”
);

415 
	sm­_’t
 {

416 
m­_’t
 *
	mÃxt
;

417 
	mdevnm
[32];

418 
	mm‘ad©a
[20];

419 
	muuid
[4];

420 
	mbad
;

421 *
	m·th
;

423 
m­_upd©e
(
m­_’t
 **
mµ
, *
devnm
, *
m‘ad©a
,

424 
uuid
[4], *
·th
);

425 
m­_»move
(
m­_’t
 **
m­
, *
devnm
);

426 
m­_’t
 *
m­_by_uuid
(m­_’ˆ**
m­
, 
uuid
[4]);

427 #ifdeà
MDASSEMBLE


428 
šlše
 
m­_’t
 *
	$m­_by_devnm
(
m­_’t
 **
m­
, *
Çme
)

430  
NULL
;

431 
	}
}

432 
šlše
 
	$m­_ä“
(
m­_’t
 *
m­
)

434 
	}
}

436 
m­_’t
 *
m­_by_devnm
(m­_’ˆ**
m­
, *
devnm
);

437 
m­_ä“
(
m­_’t
 *
m­
);

439 
m­_’t
 *
m­_by_Çme
(m­_’ˆ**
m­
, *
Çme
);

440 
m­_»ad
(
m­_’t
 **
m–p
);

441 
m­_wr™e
(
m­_’t
 *
m–
);

442 
m­_d–‘e
(
m­_’t
 **
m­p
, *
devnm
);

443 
m­_add
(
m­_’t
 **
m–p
,

444 *
devnm
, *
m‘ad©a
, 
uuid
[4], *
·th
);

445 
m­_lock
(
m­_’t
 **
m–p
);

446 
m­_uÆock
(
m­_’t
 **
m–p
);

447 
m­_fÜk
();

450 
	esysfs_»ad_æags
 {

451 
	mGET_LEVEL
 = (1 << 0),

452 
	mGET_LAYOUT
 = (1 << 1),

453 
	mGET_COMPONENT
 = (1 << 2),

454 
	mGET_CHUNK
 = (1 << 3),

455 
	mGET_CACHE
 = (1 << 4),

456 
	mGET_MISMATCH
 = (1 << 5),

457 
	mGET_VERSION
 = (1 << 6),

458 
	mGET_DISKS
 = (1 << 7),

459 
	mGET_DEGRADED
 = (1 << 8),

460 
	mGET_SAFEMODE
 = (1 << 9),

461 
	mGET_BITMAP_LOCATION
 = (1 << 10),

463 
	mGET_DEVS
 = (1 << 20),

464 
	mGET_OFFSET
 = (1 << 21),

465 
	mGET_SIZE
 = (1 << 22),

466 
	mGET_STATE
 = (1 << 23),

467 
	mGET_ERROR
 = (1 << 24),

473 
sysfs_İ’
(*
devnm
, *
devÇme
, *
©Œ
);

474 
sysfs_š™
(
mdšfo
 *
mdi
, 
fd
, *
devnm
);

475 
sysfs_ä“
(
mdšfo
 *
¤a
);

476 
mdšfo
 *
sysfs_»ad
(
fd
, *
devnm
, 
İtiÚs
);

477 
sysfs_©Œ_m©ch
(cÚ¡ *
©Œ
, cÚ¡ *
¡r
);

478 
sysfs_m©ch_wÜd
(cÚ¡ *
wÜd
, **
li¡
);

479 
sysfs_£t_¡r
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

480 *
Çme
, *
v®
);

481 
sysfs_£t_num
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

482 *
Çme
, 
v®
);

483 
sysfs_£t_num_sigÃd
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

484 *
Çme
, 
v®
);

485 
sysfs_uev’t
(
mdšfo
 *
¤a
, *
ev’t
);

486 
sysfs_g‘_fd
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

487 *
Çme
);

488 
sysfs_fd_g‘_Î
(
fd
, *
v®
);

489 
sysfs_g‘_Î
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

490 *
Çme
, *
v®
);

491 
sysfs_fd_g‘_two
(
fd
, *
v1
, *
v2
);

492 
sysfs_g‘_two
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

493 *
Çme
, *
v1
, *
v2
);

494 
sysfs_fd_g‘_¡r
(
fd
, *
v®
, 
size
);

495 
sysfs_©Œibu‹_avaabË
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

496 *
Çme
);

497 
sysfs_g‘_¡r
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

498 *
Çme
, *
v®
, 
size
);

499 
sysfs_£t_§ãmode
(
mdšfo
 *
¤a
, 
ms
);

500 
sysfs_£t_¬¿y
(
mdšfo
 *
šfo
, 
v”s
);

501 
sysfs_add_disk
(
mdšfo
 *
¤a
, mdšfØ*
sd
, 
»sume
);

502 
sysfs_disk_to_scsi_id
(
fd
, 
__u32
 *
id
);

503 
sysfs_unique_hŞd”
(*
devnm
, 
rdev
);

504 
sysfs_ä“ze_¬¿y
(
mdšfo
 *
¤a
);

505 
sysfs_wa™
(
fd
, *
m£c
);

506 
lßd_sys
(*
·th
, *
buf
);

507 
»sh­e_´•¬e_fdli¡
(*
devÇme
,

508 
mdšfo
 *
¤a
,

509 
¿id_disks
,

510 
Ädisks
,

511 
blocks
,

512 *
backup_fe
,

513 *
fdli¡
,

514 *
off£ts
);

515 
»sh­e_ä“_fdli¡
(*
fdli¡
,

516 *
off£ts
,

517 
size
);

518 
»sh­e_İ’_backup_fe
(*
backup
,

519 
fd
,

520 *
devÇme
,

521 
blocks
,

522 *
fdli¡
,

523 *
off£ts
,

524 *
sysfs_Çme
,

525 
»¡¬t
);

526 
compu‹_backup_blocks
(
nchunk
, 
ochunk
,

527 
nd©a
, 
od©a
);

528 *
loÿ‹_backup
(*
Çme
);

529 *
make_backup
(*
Çme
);

531 
§ve_¡res
(*
sourû
, *
off£ts
,

532 
¿id_disks
, 
chunk_size
, 
Ëv–
, 
Ïyout
,

533 
nwr™es
, *
de¡
,

534 
¡¬t
, 
Ëngth
,

535 *
buf
);

536 
»¡Üe_¡res
(*
de¡
, *
off£ts
,

537 
¿id_disks
, 
chunk_size
, 
Ëv–
, 
Ïyout
,

538 
sourû
, 
»ad_off£t
,

539 
¡¬t
, 
Ëngth
,

540 *
¤c_buf
);

542 #iâdeà
S’dma


543 
	#S’dma
 "/u¤/lib/£ndma -t"

	)

546 
	#SYSLOG_FACILITY
 
LOG_DAEMON


	)

548 *
m­_num
(
m­pšg_t
 *
m­
, 
num
);

549 
m­_Çme
(
m­pšg_t
 *
m­
, *
Çme
);

550 
m­pšg_t
 
r5Ïyout
[], 
r6Ïyout
[], 
³rs
[], 
modes
[], 
çuÉyÏyout
[];

552 *
m­_dev_´eã¼ed
(
majÜ
, 
mšÜ
, 
ü—‹
,

553 *
´eãr
);

554 
šlše
 *
	$m­_dev
(
majÜ
, 
mšÜ
, 
ü—‹
)

556  
	`m­_dev_´eã¼ed
(
majÜ
, 
mšÜ
, 
ü—‹
, 
NULL
);

557 
	}
}

559 
	gaùive_¬¿y
;

560 
	gm‘ad©a_upd©e
;

578 
	s»sh­e
 {

579 
	mËv–
;

580 
	m·r™y
;

582 
	mÏyout
;

583 
	md©a_disks
;

584 } 
	mbefÜe
, 
	maá”
;

585 
	mbackup_blocks
;

586 
	mmš_off£t_chªge
;

587 
	m¡res
;

588 
	mÃw_size
;

618 
	ssu³rsw™ch
 {

623 (*
examše_su³r
)(
su³¹y³
 *
¡
, *
homeho¡
);

624 (*
examše_su³r_»suÉ
)(
su³¹y³
 *
¡
, *
homeho¡
, 
examše_»suÉ
 *
»suÉli¡
);

625 (*
br›f_examše_su³r
)(
su³¹y³
 *
¡
, 
v”bo£
);

626 (*
br›f_examše_sub¬¿ys
)(
su³¹y³
 *
¡
, 
v”bo£
);

627 (*
expÜt_examše_su³r
)(
su³¹y³
 *
¡
);

628 (*
examše_badblocks
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

629 (*
cİy_m‘ad©a
)(
su³¹y³
 *
¡
, 
äom
, 
to
);

634 (*
d‘a_su³r
)(
su³¹y³
 *
¡
, *
homeho¡
);

635 (*
br›f_d‘a_su³r
)(
su³¹y³
 *
¡
);

636 (*
expÜt_d‘a_su³r
)(
su³¹y³
 *
¡
);

639 (*
d‘a_¶©fÜm
)(
v”bo£
, 
’um”©e_Úly
, *
cÚŒŞËr_·th
);

640 (*
expÜt_d‘a_¶©fÜm
)(
v”bo£
, *
cÚŒŞËr_·th
);

647 (*
uuid_äom_su³r
)(
su³¹y³
 *
¡
, 
uuid
[4]);

664 (*
g‘šfo_su³r
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
, *
m­
);

665 
mdšfo
 *(*
g‘šfo_su³r_disks
)(
su³¹y³
 *
¡
);

669 (*
m©ch_home
)(
su³¹y³
 *
¡
, *
homeho¡
);

699 (*
upd©e_su³r
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
,

700 *
upd©e
,

701 *
devÇme
, 
v”bo£
,

702 
uuid_£t
, *
homeho¡
);

709 (*
š™_su³r
)(
su³¹y³
 *
¡
, 
mdu_¬¿y_šfo_t
 *
šfo
,

710 
size
, *
Çme
,

711 *
homeho¡
, *
uuid
,

712 
d©a_off£t
);

717 (*
add_to_su³r
)(
su³¹y³
 *
¡
, 
mdu_disk_šfo_t
 *
dšfo
,

718 
fd
, *
devÇme
,

719 
d©a_off£t
);

723 (*
»move_äom_su³r
)(
su³¹y³
 *
¡
, 
mdu_disk_šfo_t
 *
dšfo
);

728 (*
¡Üe_su³r
)(
su³¹y³
 *
¡
, 
fd
);

732 (*
wr™e_š™_su³r
)(
su³¹y³
 *
¡
);

740 (*
com·»_su³r
)(
su³¹y³
 *
¡
, su³¹y³ *
t¡
);

743 (*
lßd_su³r
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

747 (*
lßd_cÚš”
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

750 
su³¹y³
 * (*
m©ch_m‘ad©a_desc
)(*
¬g
);

759 
__u64
 (*
ava_size
)(
su³¹y³
 *
¡
, __u64 
size
,

760 
d©a_off£t
);

765 (*
mš_acû±abË_¥¬e_size
)(
su³¹y³
 *
¡
);

772 (*
add_š‹º®_b™m­
)(
su³¹y³
 *
¡
, *
chunkp
,

773 
d–ay
, 
wr™e_behšd
,

774 
size
, 
may_chªge
, 
majÜ
);

778 (*
loÿ‹_b™m­
)(
su³¹y³
 *
¡
, 
fd
);

782 (*
wr™e_b™m­
)(
su³¹y³
 *
¡
, 
fd
);

784 (*
ä“_su³r
)(
su³¹y³
 *
¡
);

801 (*
v®id©e_geom‘ry
)(
su³¹y³
 *
¡
, 
Ëv–
, 
Ïyout
,

802 
¿iddisks
,

803 *
chunk
, 
size
,

804 
d©a_off£t
,

805 *
subdev
, *
ä“size
,

806 
v”bo£
);

811 
mdšfo
 *(*
cÚš”_cÚ‹Á
)(
su³¹y³
 *
¡
, *
sub¬¿y
);

813 (*
deçuÉ_geom‘ry
)(
su³¹y³
 *
¡
, *
Ëv–
, *
Ïyout
, *
chunk
);

815 (*
kl_sub¬¿y
)(
su³¹y³
 *
¡
);

817 (*
upd©e_sub¬¿y
)(
su³¹y³
 *
¡
, *
sub¬¿y
,

818 *
upd©e
, 
mddev_id’t
 *
id’t
);

824 
	#APPLY_METADATA_CHANGES
 1

	)

825 
	#ROLLBACK_METADATA_CHANGES
 0

	)

827 (*
»sh­e_su³r
)(
su³¹y³
 *
¡
,

828 
size
, 
Ëv–
,

829 
Ïyout
, 
chunksize
, 
¿id_disks
,

830 
d–_disks
, *
backup
, *
dev
,

831 
dœeùiÚ
,

832 
v”bo£
);

833 (*
mªage_»sh­e
)(

834 
afd
, 
mdšfo
 *
¤a
, 
»sh­e
 *reshape,

835 
su³¹y³
 *
¡
, 
blocks
,

836 *
fds
, *
off£ts
,

837 
de¡s
, *
de¡fd
, *
de¡off£ts
);

840 (*
İ’_Ãw
)(
su³¹y³
 *
c
, 
aùive_¬¿y
 *
a
,

841 *
š¡
);

854 (*
£t_¬¿y_¡©e
)(
aùive_¬¿y
 *
a
, 
cÚsi¡’t
);

863 (*
£t_disk
)(
aùive_¬¿y
 *
a
, 
n
, 
¡©e
);

864 (*
sync_m‘ad©a
)(
su³¹y³
 *
¡
);

865 (*
´oûss_upd©e
)(
su³¹y³
 *
¡
,

866 
m‘ad©a_upd©e
 *
upd©e
);

870 (*
´•¬e_upd©e
)(
su³¹y³
 *
¡
,

871 
m‘ad©a_upd©e
 *
upd©e
);

880 
mdšfo
 *(*
aùiv©e_¥¬e
)(
aùive_¬¿y
 *
a
,

881 
m‘ad©a_upd©e
 **
upd©es
);

896 cÚ¡ *(*
g‘_disk_cÚŒŞËr_domaš
)(cÚ¡ *
·th
);

899 (*
»cov”_backup
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
);

902 (*
v®id©e_cÚš”
)(
mdšfo
 *
šfo
);

904 
sw­uuid
;

905 
ex‹º®
;

906 cÚ¡ *
Çme
;

907 } *
su³¾i¡
[];

909 
su³rsw™ch
 
su³r0
, 
su³r1
;

910 
su³rsw™ch
 
su³r_imsm
, 
su³r_ddf
;

911 
su³rsw™ch
 
mbr
, 
g±
;

913 
	sm‘ad©a_upd©e
 {

914 
	mËn
;

915 *
	mbuf
;

916 *
	m¥aû
;

917 **
	m¥aû_li¡
;

920 
m‘ad©a_upd©e
 *
	mÃxt
;

940 
	ssu³¹y³
 {

941 
su³rsw™ch
 *
	mss
;

942 
	mmšÜ_v”siÚ
;

943 
	mmax_devs
;

944 
	mcÚš”_devnm
[32];

945 *
	msb
;

946 *
	mšfo
;

947 *
	mÙh”
;

948 
	mdevsize
;

949 
	md©a_off£t
;

950 
	mignÜe_hw_com·t
;

955 
m‘ad©a_upd©e
 *
	mupd©es
;

956 
m‘ad©a_upd©e
 **
	mupd©e_
;

959 
aùive_¬¿y
 *
	m¬¿ys
;

960 
	msock
;

961 
	mdevnm
[32];

964 
	mdevút
;

965 
	m»Œy_soÚ
;

967 
mdšfo
 *
	mdevs
;

971 
su³¹y³
 *
su³r_by_fd
(
fd
, **
sub¬¿y
);

972 
	eguess_ty³s
 { 
	mguess_ªy
, 
	mguess_¬¿y
, 
	mguess_·¹™iÚs
 };

973 
su³¹y³
 *
guess_su³r_ty³
(
fd
, 
guess_ty³s
 
guess_ty³
);

974 
šlše
 
su³¹y³
 *
	$guess_su³r
(
fd
) {

975  
	`guess_su³r_ty³
(
fd
, 
guess_ªy
);

976 
	}
}

977 
su³¹y³
 *
dup_su³r
(su³¹y³ *
¡
);

978 
g‘_dev_size
(
fd
, *
dÇme
, *
siz•
);

979 
mu¡_be_cÚš”
(
fd
);

980 
dev_size_äom_id
(
dev_t
 
id
, *
size
);

981 
wa™_fÜ
(*
dev
, 
fd
);

989 
	sdev_pŞicy
 {

990 
dev_pŞicy
 *
	mÃxt
;

991 *
	mÇme
;

996 cÚ¡ *
	mm‘ad©a
;

997 cÚ¡ *
	mv®ue
;

1000 
pŞ_aù
[], 
pŞ_domaš
[], 
pŞ_m‘ad©a
[], 
pŞ_auto
[];

1006 
	#pŞ_fÜ_—ch
(
™em
, 
li¡
, 
_m‘ad©a
) \

1007 
™em
 = 
li¡
; \

1008 
™em
 && i‹m->
Çme
 =ğ
li¡
->name; \

1009 
™em
 = i‹m->
Ãxt
) \

1010 ià(!(!
_m‘ad©a
 || !
™em
->
m‘ad©a
 || _metadata == item->metadata)) \

1011 ; 

	)

1017 
	spŞ_ruË
 {

1018 
pŞ_ruË
 *
	mÃxt
;

1019 *
	mty³
;

1020 
	sruË
 {

1021 
ruË
 *
	mÃxt
;

1022 *
	mÇme
;

1023 *
	mv®ue
;

1024 *
	mdups
;

1025 } *
	mruË
;

1028 
ruË_pŞicy
[], 
ruË_·¹
[];

1029 
ruË_·th
[], 
ruË_ty³
[];

1030 
ty³_·¹
[], 
ty³_disk
[];

1032 
pŞicylše
(*
lše
, *
ty³
);

1033 
pŞicy_add
(*
ty³
, ...);

1034 
pŞicy_ä“
();

1036 
dev_pŞicy
 *
·th_pŞicy
(*
·th
, *
ty³
);

1037 
dev_pŞicy
 *
disk_pŞicy
(
mdšfo
 *
disk
);

1038 
dev_pŞicy
 *
devid_pŞicy
(
devid
);

1039 
dev_pŞicy_ä“
(
dev_pŞicy
 *
p
);

1042 
pŞ_add
(
dev_pŞicy
 **
pŞ
, *
Çme
, *
v®
, *
m‘ad©a
);

1043 
dev_pŞicy
 *
pŞ_fšd
(dev_pŞicy *
pŞ
, *
Çme
);

1045 
	epŞicy_aùiÚ
 {

1046 
	maù_deçuÉ
,

1047 
	maù_šşude
,

1048 
	maù_»_add
,

1049 
	maù_¥¬e
,

1050 
	maù_¥¬e_§me_¦Ù
,

1052 
	maù_fÜû_¥¬e
,

1053 
	maù_”r


1056 
pŞicy_aùiÚ_®lows
(
dev_pŞicy
 *
¶i¡
, cÚ¡ *
m‘ad©a
,

1057 
pŞicy_aùiÚ
 
wªt
);

1058 
disk_aùiÚ_®lows
(
mdšfo
 *
disk
, cÚ¡ *
m‘ad©a
,

1059 
pŞicy_aùiÚ
 
wªt
);

1061 
	sdomašli¡
 {

1062 
domašli¡
 *
	mÃxt
;

1063 cÚ¡ *
	mdom
;

1066 
domaš_‹¡
(
domašli¡
 *
dom
, 
dev_pŞicy
 *
pŞ
,

1067 cÚ¡ *
m‘ad©a
);

1068 
domašli¡
 *
domaš_äom_¬¿y
(
mdšfo
 *
mdi
,

1069 cÚ¡ *
m‘ad©a
);

1070 
domašli¡_add_dev
(
domašli¡
 **
dom
, 
devid
,

1071 cÚ¡ *
m‘ad©a
);

1072 
domaš_ä“
(
domašli¡
 *
dl
);

1073 
domaš_m”ge
(
domašli¡
 **
domp
, 
dev_pŞicy
 *
pŞ
,

1074 cÚ¡ *
m‘ad©a
);

1075 
domaš_add
(
domašli¡
 **
domp
, *
domaš
);

1077 
pŞicy_§ve_·th
(*
id_·th
, 
m­_’t
 *
¬¿y
);

1078 
pŞicy_check_·th
(
mdšfo
 *
disk
, 
m­_’t
 *
¬¿y
);

1080 #ià
__GNUC__
 < 3

1081 
	g¡©64
;

1084 
	#HAVE_NFTW
 
we
 
assume


	)

1085 
	#HAVE_FTW


	)

1087 #ifdeà
__UCLIBC__


1088 
	~<ã©u»s.h
>

1089 #iâdeà
__UCLIBC_HAS_LFS__


1090 
	#l£ek64
 
l£ek


	)

1092 #iâdeà 
__UCLIBC_HAS_FTW__


1093 #undeà
HAVE_FTW


1094 #undeà
HAVE_NFTW


1098 #ifdeà
__d›ibc__


1099 #undeà
HAVE_NFTW


1102 #ià
defšed
(
__KLIBC__
)

1103 #undeà
HAVE_NFTW


1104 #undeà
HAVE_FTW


1107 #iâdeà
HAVE_NFTW


1108 
	#FTW_PHYS
 1

	)

1109 #iâdeà
HAVE_FTW


1110 
	sFTW
 {};

1114 #ifdeà
HAVE_FTW


1115 
	~<áw.h
>

1118 
add_dev
(cÚ¡ *
Çme
, cÚ¡ 
¡©
 *
¡b
, 
æag
, 
FTW
 *
s
);

1120 
Mªage_ro
(*
devÇme
, 
fd
, 
»adÚly
);

1121 
Mªage_run
(*
devÇme
, 
fd
, 
cÚ‹xt
 *
c
);

1122 
Mªage_¡İ
(*
devÇme
, 
fd
, 
qu›t
,

1123 
wl_»Œy
);

1124 
Mªage_subdevs
(*
devÇme
, 
fd
,

1125 
mddev_dev
 *
devli¡
, 
v”bo£
, 
‹¡
,

1126 *
upd©e
, 
fÜû
);

1127 
autod‘eù
();

1128 
Grow_Add_deviû
(*
devÇme
, 
fd
, *
Ãwdev
);

1129 
Grow_addb™m­
(*
devÇme
, 
fd
,

1130 
cÚ‹xt
 *
c
, 
sh­e
 *
s
);

1131 
Grow_»sh­e
(*
devÇme
, 
fd
,

1132 
mddev_dev
 *
devli¡
,

1133 
d©a_off£t
,

1134 
cÚ‹xt
 *
c
, 
sh­e
 *
s
);

1135 
Grow_»¡¬t
(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
,

1136 *
fdli¡
, 
út
, *
backup_fe
, 
v”bo£
);

1137 
Grow_cÚtšue
(
mdfd
, 
su³¹y³
 *
¡
,

1138 
mdšfo
 *
šfo
, *
backup_fe
,

1139 
fÜked
, 
ä“ze_»sh­e
);

1141 
»¡Üe_backup
(
su³¹y³
 *
¡
,

1142 
mdšfo
 *
cÚ‹Á
,

1143 
wÜkšg_disks
,

1144 
¥¬es
,

1145 **
backup_f•
,

1146 
v”bo£
);

1147 
Grow_cÚtšue_commªd
(*
devÇme
, 
fd
,

1148 *
backup_fe
, 
v”bo£
);

1150 
As£mbË
(
su³¹y³
 *
¡
, *
mddev
,

1151 
mddev_id’t
 *
id’t
,

1152 
mddev_dev
 *
devli¡
,

1153 
cÚ‹xt
 *
c
);

1155 
Bud
(*
mddev
, 
mddev_dev
 *
devli¡
,

1156 
sh­e
 *
s
, 
cÚ‹xt
 *
c
);

1158 
C»©e
(
su³¹y³
 *
¡
, *
mddev
,

1159 *
Çme
, *
uuid
,

1160 
subdevs
, 
mddev_dev
 *
devli¡
,

1161 
sh­e
 *
s
,

1162 
cÚ‹xt
 *
c
,

1163 
d©a_off£t
);

1165 
D‘a
(*
dev
, 
cÚ‹xt
 *
c
);

1166 
D‘a_PÏtfÜm
(
su³rsw™ch
 *
ss
, 
sÿn
, 
v”bo£
, 
_expÜt
, *
cÚŒŞËr_·th
);

1167 
D‘a_ToA¼ayD‘a
(cÚ¡ *
dev
, 
cÚ‹xt
 *
c
, 
¬¿y_d‘a
 *
ad
);

1168 
Qu”y
(*
dev
);

1169 
ExamšeBadblocks
(*
devÇme
, 
br›f
, 
su³¹y³
 *
fÜû¡
);

1170 
Examše
(
mddev_dev
 *
devli¡
, 
cÚ‹xt
 *
c
,

1171 
su³¹y³
 *
fÜû¡
);

1172 
Examše_ToResuÉ
(
mddev_dev
 *
devli¡
,

1173 
cÚ‹xt
 *
c
,

1174 
su³¹y³
 *
fÜû¡
,

1175 
examše_»suÉ
 *
»suÉ
);

1176 
MÚ™Ü
(
mddev_dev
 *
devli¡
,

1177 *
maaddr
, *
®”t_cmd
,

1178 
cÚ‹xt
 *
c
,

1179 
d«mÚi£
, 
ÚeshÙ
,

1180 
dosy¦og
, *
pidfe
, 
šüem’ts
,

1181 
sh¬e
);

1183 
Kl
(*
dev
, 
su³¹y³
 *
¡
, 
fÜû
, 
v”bo£
, 
nÛxş
);

1184 
Kl_sub¬¿y
(*
dev
, *
sub¬¿y
, 
v”bo£
);

1185 
Upd©e_sub¬¿y
(*
dev
, *
sub¬¿y
, *
upd©e
, 
mddev_id’t
 *
id’t
, 
qu›t
);

1186 
Wa™
(*
dev
);

1187 
Wa™CËª
(*
dev
, 
sock
, 
v”bo£
);

1188 
S‘AùiÚ
(*
dev
, *
aùiÚ
);

1190 
Inüem’l
(
mddev_dev
 *
devli¡
, 
cÚ‹xt
 *
c
,

1191 
su³¹y³
 *
¡
);

1192 
RebudM­
();

1193 
Inüem’lSÿn
(
cÚ‹xt
 *
c
, *
devnm
);

1194 
Inüem’lRemove
(*
devÇme
, *
·th
, 
v”bo£
);

1195 
C»©eB™m­
(*
f’ame
, 
fÜû
, 
uuid
[16],

1196 
chunksize
, 
d«mÚ_¦“p
,

1197 
wr™e_behšd
,

1198 
¬¿y_size
,

1199 
majÜ
);

1200 
ExamšeB™m­
(*
f’ame
, 
br›f
, 
su³¹y³
 *
¡
);

1201 
Wr™e_ruËs
(*
ruË_Çme
);

1202 
b™m­_upd©e_uuid
(
fd
, *
uuid
, 
sw­
);

1203 
b™m­_£ùÜs
(
b™m­_su³r_s
 *
bsb
);

1204 
Dump_m‘ad©a
(*
dev
, *
dœ
, 
cÚ‹xt
 *
c
,

1205 
su³¹y³
 *
¡
);

1206 
Re¡Üe_m‘ad©a
(*
dev
, *
dœ
, 
cÚ‹xt
 *
c
,

1207 
su³¹y³
 *
¡
, 
Úly
);

1209 
md_g‘_v”siÚ
(
fd
);

1210 
g‘_lšux_v”siÚ
();

1211 
mdadm_v”siÚ
(*
v”siÚ
);

1212 
·r£_size
(*
size
);

1213 
·r£_uuid
(*
¡r
, 
uuid
[4]);

1214 
·r£_Ïyout_10
(*
Ïyout
);

1215 
·r£_Ïyout_çuÉy
(*
Ïyout
);

1216 
·r£_num
(*
num
);

1217 
check_ext2
(
fd
, *
Çme
);

1218 
check_»i£r
(
fd
, *
Çme
);

1219 
check_¿id
(
fd
, *
Çme
);

1220 
check_·¹™iÚs
(
fd
, *
dÇme
,

1221 
ä“size
,

1222 
size
);

1224 
g‘_mdp_majÜ
();

1225 
g‘_maj_mš
(*
dev
, *
majÜ
, *
mšÜ
);

1226 
dev_İ’
(*
dev
, 
æags
);

1227 
İ’_dev
(*
devnm
);

1228 
»İ’_mddev
(
mdfd
);

1229 
İ’_dev_æags
(*
devnm
, 
æags
);

1230 
İ’_dev_exş
(*
devnm
);

1231 
is_¡ªd¬d
(*
dev
, *
nump
);

1232 
§me_dev
(*
Úe
, *
two
);

1233 
com·»_·ths
 (* 
·th1
,* 
·th2
);

1234 
’abË_fds
(
deviûs
);

1236 
·r£_auto
(*
¡r
, *
msg
, 
cÚfig
);

1237 
mddev_id’t
 *
cÚf_g‘_id’t
(*
dev
);

1238 
mddev_dev
 *
cÚf_g‘_devs
();

1239 
cÚf_‹¡_dev
(*
devÇme
);

1240 
cÚf_‹¡_m‘ad©a
(cÚ¡ *
v”siÚ
, 
dev_pŞicy
 *
pŞ
, 
is_homeho¡
);

1241 
ü—‹šfo
 *
cÚf_g‘_ü—‹_šfo
();

1242 
£t_cÚffe
(*
fe
);

1243 *
cÚf_g‘_maaddr
();

1244 *
cÚf_g‘_maäom
();

1245 *
cÚf_g‘_´og¿m
();

1246 *
cÚf_g‘_homeho¡
(*
»quœe_homeho¡p
);

1247 *
cÚf_lše
(
FILE
 *
fe
);

1248 *
cÚf_wÜd
(
FILE
 *
fe
, 
®low_key
);

1249 
´št_quÙed
(*
¡r
);

1250 
´št_esÿ³
(*
¡r
);

1251 
u£_udev
();

1252 
GCD
(
a
, 
b
);

1253 
cÚf_Çme_is_ä“
(*
Çme
);

1254 
cÚf_v”ify_devÇmes
(
mddev_id’t
 *
¬¿y_li¡
);

1255 
devÇme_m©ches
(*
Çme
, *
m©ch
);

1256 
mddev_id’t
 *
cÚf_m©ch
(
su³¹y³
 *
¡
,

1257 
mdšfo
 *
šfo
,

1258 *
devÇme
,

1259 
v”bo£
, *
rvp
);

1260 
ex³rim’l
();

1262 
ä“_lše
(*
lše
);

1263 
m©ch_Úeof
(*
deviûs
, *
devÇme
);

1264 
uuid_äom_su³r
(
uuid
[4], 
mdp_su³r_t
 *
su³r
);

1265 cÚ¡ 
uuid_z”o
[4];

1266 
§me_uuid
(
a
[4], 
b
[4], 
sw­uuid
);

1267 
cİy_uuid
(*
a
, 
b
[4], 
sw­uuid
);

1268 *
__âame_äom_uuid
(
id
[4], 
sw­
, *
buf
, 
£p
);

1269 *
âame_äom_uuid
(
su³¹y³
 *
¡
,

1270 
mdšfo
 *
šfo
, *
buf
, 
£p
);

1271 
ÿlc_csum
(*
su³r
, 
by‹s
);

1272 
’ough
(
Ëv–
, 
¿id_disks
, 
Ïyout
, 
ş—n
,

1273 *
ava
);

1274 
’ough_fd
(
fd
);

1275 
ask
(*
mesg
);

1276 
g‘_compÚ’t_size
(
fd
);

1277 
»move_·¹™iÚs
(
fd
);

1278 
‹¡_·¹™iÚ
(
fd
);

1279 
‹¡_·¹™iÚ_äom_id
(
dev_t
 
id
);

1280 
g‘_d©a_disks
(
Ëv–
, 
Ïyout
, 
¿id_disks
);

1281 
ÿlc_¬¿y_size
(
Ëv–
, 
¿id_disks
, 
Ïyout
,

1282 
chunksize
, 
devsize
);

1283 
æush_m‘ad©a_upd©es
(
su³¹y³
 *
¡
);

1284 
­³nd_m‘ad©a_upd©e
(
su³¹y³
 *
¡
, *
buf
, 
Ën
);

1285 
as£mbË_cÚš”_cÚ‹Á
(
su³¹y³
 *
¡
, 
mdfd
,

1286 
mdšfo
 *
cÚ‹Á
,

1287 
cÚ‹xt
 *
c
,

1288 *
cho£n_Çme
, *
»suÉ
);

1289 
	#INCR_NO
 1

	)

1290 
	#INCR_UNSAFE
 2

	)

1291 
	#INCR_ALREADY
 4

	)

1292 
	#INCR_YES
 8

	)

1293 
mdšfo
 *
cÚš”_choo£_¥¬es
(
su³¹y³
 *
¡
,

1294 
mš_size
,

1295 
domašli¡
 *
domli¡
,

1296 *
¥¬e_group
,

1297 cÚ¡ *
m‘ad©a
, 
g‘_Úe
);

1298 
move_¥¬e
(*
äom_devÇme
, *
to_devÇme
, 
dev_t
 
devid
);

1299 
add_disk
(
mdfd
, 
su³¹y³
 *
¡
,

1300 
mdšfo
 *
¤a
, mdšfØ*
šfo
);

1301 
»move_disk
(
mdfd
, 
su³¹y³
 *
¡
,

1302 
mdšfo
 *
¤a
, mdšfØ*
šfo
);

1303 
£t_¬¿y_šfo
(
mdfd
, 
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
);

1304 
mš_»cov”y_¡¬t
(
mdšfo
 *
¬¿y
);

1306 *
humª_size
(
by‹s
);

1307 *
humª_size_br›f
(
by‹s
, 
´efix
);

1308 
´št_r10_Ïyout
(
Ïyout
);

1310 *
fšd_ä“_devnm
(
u£_·¹™iÚs
);

1312 
put_md_Çme
(*
Çme
);

1313 *
devid2kÇme
(
devid
);

1314 *
devid2devnm
(
devid
);

1315 
devnm2devid
(*
devnm
);

1316 *
g‘_md_Çme
(*
devnm
);

1318 
DeçuÉCÚfFe
[];

1320 
ü—‹_mddev
(*
dev
, *
Çme
, 
autof
, 
Œu¡wÜthy
,

1321 *
cho£n
);

1323 
	#LOCAL
 1

	)

1324 
	#LOCAL_ANY
 10

	)

1325 
	#FOREIGN
 2

	)

1326 
	#METADATA
 3

	)

1327 
İ’_mddev
(*
dev
, 
»pÜt_”rÜs
);

1328 
İ’_cÚš”
(
fd
);

1329 
m‘ad©a_cÚš”_m©ches
(*
m‘ad©a
, *
devnm
);

1330 
m‘ad©a_subdev_m©ches
(*
m‘ad©a
, *
devnm
);

1331 
is_cÚš”_memb”
(
md¡©_’t
 *
’t
, *
devÇme
);

1332 
is_sub¬¿y_aùive
(*
sub¬¿y
, *
devÇme
);

1333 
İ’_sub¬¿y
(*
dev
, *
sub¬¿y
, 
su³¹y³
 *
¡
, 
qu›t
);

1334 
su³rsw™ch
 *
v”siÚ_to_su³rsw™ch
(*
v”s
);

1336 
mdmÚ_ruÂšg
(*
devnm
);

1337 
mdmÚ_pid
(*
devnm
);

1338 
check_’v
(*
Çme
);

1339 
__u32
 
¿ndom32
();

1340 
¡¬t_mdmÚ
(*
devnm
);

1342 
chd_mÚ™Ü
(
afd
, 
mdšfo
 *
¤a
, 
»sh­e
 *reshape,

1343 
su³¹y³
 *
¡
, 
¡res
,

1344 *
fds
, *
off£ts
,

1345 
de¡s
, *
de¡fd
, *
de¡off£ts
);

1346 
abÜt_»sh­e
(
mdšfo
 *
¤a
);

1348 *
su³r1_make_v0
(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
, 
mdp_su³r_t
 *
sb0
);

1350 
fmt_devÇme
(*
Çme
, 
num
);

1351 *
¡©2devnm
(
¡©
 *
¡
);

1352 *
fd2devnm
(
fd
);

1354 
š_š™rd
();

1356 
	#_ROUND_UP
(
v®
, 
ba£
è(((v®è+ (ba£è- 1è& ~(ba£ - 1))

	)

1357 
	#ROUND_UP
(
v®
, 
ba£
è
	`_ROUND_UP
(v®, (
	`ty³of
(v®))(ba£))

	)

1358 
	#ROUND_UP_PTR
(
±r
, 
ba£
è((
	`ty³of
(ptr)) \

1359 (
	`ROUND_UP
(()(
±r
), 
ba£
)))

	)

1361 
šlše
 
	$is_sub¬¿y
(*
v”s
)

1372  (*
v”s
 == '/' || *vers == '-');

1373 
	}
}

1375 
šlše
 *
	$to_sub¬¿y
(
md¡©_’t
 *
’t
, *
cÚš”
)

1377  &
’t
->
m‘ad©a_v”siÚ
[10+
	`¡¾’
(
cÚš”
)+1];

1378 
	}
}

1380 #ifdeà
DEBUG


1381 
	#d´štf
(
fmt
, 
¬g
...) \

1382 
	`årštf
(
¡d”r
, 
fmt
, ##
¬g
)

	)

1384 
	#d´štf
(
fmt
, 
¬g
...) \

1385 ({ ià(0è
	`årštf
(
¡d”r
, 
fmt
, ##
¬g
); 0; })

	)

1387 
	~<as£¹.h
>

1388 
	~<¡d¬g.h
>

1389 
šlše
 
	$xa¥rštf
(**
¡½
, cÚ¡ *
fmt
, ...) {

1390 
va_li¡
 
­
;

1391 
»t
;

1392 
	`va_¡¬t
(
­
, 
fmt
);

1393 
»t
 = 
	`va¥rštf
(
¡½
, 
fmt
, 
­
);

1394 
	`va_’d
(
­
);

1395 
	`as£¹
(
»t
 >= 0);

1396  
»t
;

1397 
	}
}

1399 #ifdeà
DEBUG


1400 
	#´_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, 
Name
 ": " fmt)

	)

1401 
	#cÚt_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, " " fmt)

	)

1403 
	#´_”r
(
fmt
 ...è({ ià(0è
	`årštf
(
¡d”r
, 
Name
 ": " fmt); })

	)

1404 
	#cÚt_”r
(
fmt
 ...è({ ià(0è
	`årštf
(
¡d”r
, " " fmt); })

	)

1407 *
xm®loc
(
size_t
 
Ën
);

1408 *
x»®loc
(*
±r
, 
size_t
 
Ën
);

1409 *
xÿÎoc
(
size_t
 
num
, size_ˆ
size
);

1410 *
x¡rdup
(cÚ¡ *
¡r
);

1412 
	#LEVEL_MULTIPATH
 (-4)

	)

1413 
	#LEVEL_LINEAR
 (-1)

	)

1414 
	#LEVEL_FAULTY
 (-5)

	)

1417 
	#LEVEL_CONTAINER
 (-100)

	)

1418 
	#LEVEL_UNSUPPORTED
 (-200)

	)

1421 
	#LEVEL_NONE
 (-1000000)

	)

1425 
	#Wr™eT¿ns›Á
 0

	)

1426 
	#R—dT¿ns›Á
 1

	)

1427 
	#Wr™eP”si¡’t
 2

	)

1428 
	#R—dP”si¡’t
 3

	)

1429 
	#Wr™eAÎ
 4

	)

1430 
	#R—dFixabË
 5

	)

1431 
	#Modes
 6

	)

1433 
	#CË¬E¼Üs
 31

	)

1434 
	#CË¬FauÉs
 30

	)

1436 
	#AÎP”si¡
 100

	)

1437 
	#NoP”si¡
 101

	)

1439 
	#ModeMask
 0x1f

	)

1440 
	#ModeShiá
 5

	)

1442 #ifdeà
__TINYC__


1443 #undeà
mšÜ


1444 #undeà
majÜ


1445 #undeà
makedev


1446 
	#mšÜ
(
x
è((x)&0xff)

	)

1447 
	#majÜ
(
x
è(((x)>>8)&0xff)

	)

1448 
	#makedev
(
M
,
m
è(((M)<<8è| (m))

	)

1452 
	#ALGORITHM_LEFT_ASYMMETRIC
 0

	)

1453 
	#ALGORITHM_RIGHT_ASYMMETRIC
 1

	)

1454 
	#ALGORITHM_LEFT_SYMMETRIC
 2

	)

1455 
	#ALGORITHM_RIGHT_SYMMETRIC
 3

	)

1460 
	#ALGORITHM_PARITY_0
 4

	)

1461 
	#ALGORITHM_PARITY_N
 5

	)

1475 
	#ALGORITHM_ROTATING_ZERO_RESTART
 8

	)

1476 
	#ALGORITHM_ROTATING_N_RESTART
 9

	)

1477 
	#ALGORITHM_ROTATING_N_CONTINUE
 10

	)

1484 
	#ALGORITHM_LEFT_ASYMMETRIC_6
 16

	)

1485 
	#ALGORITHM_RIGHT_ASYMMETRIC_6
 17

	)

1486 
	#ALGORITHM_LEFT_SYMMETRIC_6
 18

	)

1487 
	#ALGORITHM_RIGHT_SYMMETRIC_6
 19

	)

1488 
	#ALGORITHM_PARITY_0_6
 20

	)

1489 
	#ALGORITHM_PARITY_N_6
 
ALGORITHM_PARITY_N


	)

1494 #iâdeà
PATH_MAX


1495 
	#PATH_MAX
 4096

	)

1498 
	#RESYNC_NONE
 -1

	)

1499 
	#RESYNC_DELAYED
 -2

	)

1500 
	#RESYNC_PENDING
 -3

	)

1501 
	#RESYNC_UNKNOWN
 -4

	)

1509 
	#MAX_DISKS
 4096

	)

1514 
	#MAX_SIZE
 1

	)

1519 
	#INVALID_SECTORS
 1

	)

1521 
	#VARIABLE_OFFSET
 3

	)

1523 
	#V”siÚ
 "NUUO"

	)

	@libmdadm/mdadm_errcode.h

1 #iâdeà
__MDADM_ERRORCODE__


2 
	#__MDADM_ERRORCODE__


	)

5 
	mSUCCESS
 = 0,

7 
	mCREATE_RAID_LEVEL_UNSET
 = 1,

8 
	mCREATE_RAID_DEVS_NOT_ENOUGH
,

9 
	mCREATE_RAID_DEVS_OVER_256
,

10 
	mCREATE_RAID_DEVS_NOT_EXIST_IN_LIST
,

11 
	mCREATE_SPARE_DEVS_NOT_SUPPORT
,

12 
	mCREATE_LIST_DEVS_MORE_THAN_ARRAY_NEEDED
,

13 
	mCREATE_BITMAP_NOT_MEANINGFUL
,

14 
	mCREATE_RAID_LEVEL_UNKNOWN
,

15 
	mCREATE_GEOMETRY_INVALID
,

16 
	mCREATE_RAID_DEV_CANNOT_OPEN
,

17 
	mCREATE_NOT_BLOCK_DEVICE
,

18 
	mCREATE_UNSUITABLE_STYLE
,

19 
	mCREATE_TOO_MANY_DEVS
,

20 
	mCREATE_NO_FREE_SPACE
,

21 
	mCREATE_FREE_SPACE_SMALL_THAN_GIVEN
,

22 
	mCREATE_WITHOUT_GIVEN_SIZE_DRIVES
,

23 
	mCREATE_DEVS_TOO_LARGE
,

24 
	mCREATE_ABORTED
,

25 
	mCREATE_MISSING_DEVS_NOT_SUPPORT
,

26 
	mCREATE_MDDEV_FAIL
,

27 
	mCREATE_MDDEV_INUSE
,

28 
	mCREATE_MDDEV_UNSET
,

29 
	mCREATE_MDNUM_ILLEGAL
,

30 
	mCREATE_REQUIRE_NEWER_VERSION
,

31 
	mCREATE_INIT_SUPER_FAIL
,

32 
	mCREATE_BITMAP_NOT_SUPPORT
,

33 
	mCREATE_BITMAP_CHUNK_NOT_SUPPORT
,

34 
	mCREATE_OPEN_CONTAINER_FAIL
,

35 
	mCREATE_SET_ARRAY_INFO_FAIL
,

36 
	mCREATE_BITMAP_FAIL
,

37 
	mCREATE_OPEN_BITMAP_FILE_FAIL
,

38 
	mCREATE_SET_BITMAP_FILE_FAIL
,

39 
	mCREATE_ADD_TO_SUPER_FAIL
,

40 
	mCREATE_ADD_NEW_DISK_FAIL
,

41 
	mCREATE_FREE_SUPER_TYPE_OBJ_FAIL
,

42 
	mCREATE_RAID_ACTIVATION_FAIL
,

45 
	mDETAIL_MDDEV_OPEN_FAIL
 = 101,

46 
	mDETAIL_MDDEV_ILLEGAL
,

47 
	mDETAIL_MDDEV_REQUIRE_NEWER_DRIVER
,

48 
	mDETAIL_MDDEV_CANNOT_GET_DETAIL
,

50 
	mMANAGE_STOP_MD_FAIL
 = 201,

51 
	mMANAGE_MD_IN_USE
,

52 
	mMANAGE_DEVICE_BUSY
,

53 
	mMANAGE_STOP_CONTAINER_FAIL
,

54 
	mMANAGE_GET_ARRAY_INFO_FAIL
,

55 
	mMANAGE_UNSUPPORTED_ARRAY
,

56 
	mMANAGE_NEED_MEANINGFUL_DISPOSITION
,

57 
	mMANAGE_NOT_MEANINGFUL_FOR_R10
,

58 
	mMANAGE_NOT_MEANINGFUL_FOR_ARRAY
,

59 
	mMANAGE_OPEN_SYSFD_FAIL
,

60 
	mMANAGE_CANNOT_FIND_DEV
,

61 
	mMANAGE_NOT_BLOCK_DEV
,

62 
	mMANAGE_CANNOT_OPEN_DEV
,

63 
	mMANAGE_CANNOT_ADD_DISKS_TO_MEMBER_ARRAY
,

64 
	mMANAGE_SET_FAULTY_FAIL
,

65 
	mMANAGE_NO_MATCHING_DEV
,

66 
	mMANAGE_WITH_ARG_FAIL
,

67 
	mMANAGE_CANNOT_REMOVE_DISKS_FROM_MEMBER_ARRAY
,

68 
	mMANAGE_ADD_GET_DEV_SIZE_FAIL
 = 251,

69 
	mMANAGE_ADD_WASTED_DEV_SIZE
,

70 
	mMANAGE_ADD_HOT_ADD_FAIL
,

71 
	mMANAGE_ADD_CANNOT_LOAD_ARRAY_METADATA
,

72 
	mMANAGE_ADD_DEV_SIZE_NOT_LARGE_ENOUGH
,

73 
	mMANAGE_ADD_READD_IMPOSSIBLE
,

74 
	mMANAGE_ADD_ARRAY_FAILED
,

75 
	mMANAGE_ADD_UPDATE_SUPERBLOCK_FAIL
,

76 
	mMANAGE_ADD_WRITE_INIT_SUPERBLOCK_FAIL
,

77 
	mMANAGE_ADD_CANNOT_GET_EXCLUSIVE_ACCESS
,

78 
	mMANAGE_ADD_READ_SYSFS_FAIL
,

79 
	mMANAGE_ADD_ADD_NEW_DEVS_FAIL
,

80 
	mMANAGE_REMOVE_CANNOT_GET_EXCLUSIVE_ACCESS
 = 271,

81 
	mMANAGE_REMOVE_NOT_MEMBER
,

82 
	mMANAGE_REMOVE_IN_USE
,

83 
	mMANAGE_REMOVE_HOT_REMOVE_FAIL
,

84 
	mMANAGE_REMOVE_GET_CONTAINER_NAME_FAIL
,

85 
	mMANAGE_REPLACE_UNSUPPORTED_METADATA_VER
 = 291,

86 
	mMANAGE_REPLACE_CANNOT_FIND_MD_INFO
,

87 
	mMANAGE_REPLACE_DISK_NOT_ACTIVE
,

88 
	mMANAGE_REPLACE_REQUEST_REPLACEMENT_FAIL
,

89 
	mMANAGE_REPLACE_MD_NOT_FOUND
,

90 
	mMANAGE_WITH_CANNOT_FOUND_MD_INFO
 = 311,

91 
	mMANAGE_WITH_FAULTY_DISK
,

92 
	mMANAGE_WITH_ACTIVE_DISK
,

93 
	mMANAGE_WITH_PREFER_REPLACEMENT_FAIL
,

94 
	mMANAGE_WITH_MD_NOT_FOUND
,

97 
	mASSEMBLE_NO_IDENTITY_INFO
 = 401,

98 
	mASSEMBLE_RAID_DEVS_NOT_ENOUGH
,

99 
	mASSEMBLE_NEGATIVE_NUM_DEVICES
,

100 
	mASSEMBLE_SUPER_INFO_IS_NULL
,

101 
	mASSEMBLE_DRIVE_IS_ACTIVE
,

102 
	mASSEMBLE_INVALID_MDFD
,

103 
	mASSEMBLE_KERNEL_UNSUPPORT
,

104 
	mASSEMBLE_MD_ALREADY_ACTIVE
,

105 
	mASSEMBLE_CONTAINER_CONTENT_FAIL
,

106 
	mASSEMBLE_NEGATIVE_DEV_CNT
,

107 
	mASSEMBLE_NO_DEVS_FOR_MD
,

108 
	mASSEMBLE_OPEN_DEV_FAIL
,

109 
	mASSEMBLE_SUPERBLOCK_DISAPPEARED
,

110 
	mASSEMBLE_NO_SUITABLE_DRIVES
,

111 
	mASSEMBLE_REWRITE_SUPERBLOCK_FAIL
,

112 
	mASSEMBLE_FAIL
,

113 
	mASSEMBLE_MDDEV_UNSET
,

114 
	mASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
,

115 
	mASSEMBLE_INVALID_UUID
,

116 
	mASSEMBLE_MDDEV_INUSE
,

117 
	mASSEMBLE_MDNUM_ILLEGAL
,

118 
	mASSEMBLE_INITIALIZE_DEV_LIST_FAIL
,

119 
	mASSEMBLE_FAIL_TO_SET_ARRAY_INFO
,

120 
	mASSEMBLE_FAIL_TO_SET_BITMAP_FILE
,

121 
	mASSEMBLE_FAIL_TO_OPEN_BITMAP_FILE
,

122 
	mASSEMBLE_NEED_BACKUP_FILE
,

123 
	mASSEMBLE_UNDEFINED_ERROR
,

125 
	mKILL_OPEN_DEV_FAIL
 = 501,

126 
	mKILL_NOT_MD_COMPONENT
,

127 
	mKILL_ZERO_SUPERBLOCK_FAIL
,

129 
	mQUERY_OPEN_DEV_FAIL
 = 551,

130 
	mQUERY_NULL_POINTER
,

131 
	mEXAMINE_OPEN_DEV_FAIL
 = 601,

132 
	mEXAMINE_NO_MD_SUPERBLOCK
,

133 
	mEXAMINE_MEM_ALLOC_FAIL
,

134 
	mEXAMINE_NULL_POINTER


	@libmdadm/mdadm_errcode.h

1 #iâdeà
__MDADM_ERRORCODE__


2 
	#__MDADM_ERRORCODE__


	)

5 
	mSUCCESS
 = 0,

7 
	mCREATE_RAID_LEVEL_UNSET
 = 1,

8 
	mCREATE_RAID_DEVS_NOT_ENOUGH
,

9 
	mCREATE_RAID_DEVS_OVER_256
,

10 
	mCREATE_RAID_DEVS_NOT_EXIST_IN_LIST
,

11 
	mCREATE_SPARE_DEVS_NOT_SUPPORT
,

12 
	mCREATE_LIST_DEVS_MORE_THAN_ARRAY_NEEDED
,

13 
	mCREATE_BITMAP_NOT_MEANINGFUL
,

14 
	mCREATE_RAID_LEVEL_UNKNOWN
,

15 
	mCREATE_GEOMETRY_INVALID
,

16 
	mCREATE_RAID_DEV_CANNOT_OPEN
,

17 
	mCREATE_NOT_BLOCK_DEVICE
,

18 
	mCREATE_UNSUITABLE_STYLE
,

19 
	mCREATE_TOO_MANY_DEVS
,

20 
	mCREATE_NO_FREE_SPACE
,

21 
	mCREATE_FREE_SPACE_SMALL_THAN_GIVEN
,

22 
	mCREATE_WITHOUT_GIVEN_SIZE_DRIVES
,

23 
	mCREATE_DEVS_TOO_LARGE
,

24 
	mCREATE_ABORTED
,

25 
	mCREATE_MISSING_DEVS_NOT_SUPPORT
,

26 
	mCREATE_MDDEV_FAIL
,

27 
	mCREATE_MDDEV_INUSE
,

28 
	mCREATE_MDDEV_UNSET
,

29 
	mCREATE_MDNUM_ILLEGAL
,

30 
	mCREATE_REQUIRE_NEWER_VERSION
,

31 
	mCREATE_INIT_SUPER_FAIL
,

32 
	mCREATE_BITMAP_NOT_SUPPORT
,

33 
	mCREATE_BITMAP_CHUNK_NOT_SUPPORT
,

34 
	mCREATE_OPEN_CONTAINER_FAIL
,

35 
	mCREATE_SET_ARRAY_INFO_FAIL
,

36 
	mCREATE_BITMAP_FAIL
,

37 
	mCREATE_OPEN_BITMAP_FILE_FAIL
,

38 
	mCREATE_SET_BITMAP_FILE_FAIL
,

39 
	mCREATE_ADD_TO_SUPER_FAIL
,

40 
	mCREATE_ADD_NEW_DISK_FAIL
,

41 
	mCREATE_FREE_SUPER_TYPE_OBJ_FAIL
,

42 
	mCREATE_RAID_ACTIVATION_FAIL
,

45 
	mDETAIL_MDDEV_OPEN_FAIL
 = 101,

46 
	mDETAIL_MDDEV_ILLEGAL
,

47 
	mDETAIL_MDDEV_REQUIRE_NEWER_DRIVER
,

48 
	mDETAIL_MDDEV_CANNOT_GET_DETAIL
,

50 
	mMANAGE_STOP_MD_FAIL
 = 201,

51 
	mMANAGE_MD_IN_USE
,

52 
	mMANAGE_DEVICE_BUSY
,

53 
	mMANAGE_STOP_CONTAINER_FAIL
,

54 
	mMANAGE_GET_ARRAY_INFO_FAIL
,

55 
	mMANAGE_UNSUPPORTED_ARRAY
,

56 
	mMANAGE_NEED_MEANINGFUL_DISPOSITION
,

57 
	mMANAGE_NOT_MEANINGFUL_FOR_R10
,

58 
	mMANAGE_NOT_MEANINGFUL_FOR_ARRAY
,

59 
	mMANAGE_OPEN_SYSFD_FAIL
,

60 
	mMANAGE_CANNOT_FIND_DEV
,

61 
	mMANAGE_NOT_BLOCK_DEV
,

62 
	mMANAGE_CANNOT_OPEN_DEV
,

63 
	mMANAGE_CANNOT_ADD_DISKS_TO_MEMBER_ARRAY
,

64 
	mMANAGE_SET_FAULTY_FAIL
,

65 
	mMANAGE_NO_MATCHING_DEV
,

66 
	mMANAGE_WITH_ARG_FAIL
,

67 
	mMANAGE_CANNOT_REMOVE_DISKS_FROM_MEMBER_ARRAY
,

68 
	mMANAGE_ADD_GET_DEV_SIZE_FAIL
 = 251,

69 
	mMANAGE_ADD_WASTED_DEV_SIZE
,

70 
	mMANAGE_ADD_HOT_ADD_FAIL
,

71 
	mMANAGE_ADD_CANNOT_LOAD_ARRAY_METADATA
,

72 
	mMANAGE_ADD_DEV_SIZE_NOT_LARGE_ENOUGH
,

73 
	mMANAGE_ADD_READD_IMPOSSIBLE
,

74 
	mMANAGE_ADD_ARRAY_FAILED
,

75 
	mMANAGE_ADD_UPDATE_SUPERBLOCK_FAIL
,

76 
	mMANAGE_ADD_WRITE_INIT_SUPERBLOCK_FAIL
,

77 
	mMANAGE_ADD_CANNOT_GET_EXCLUSIVE_ACCESS
,

78 
	mMANAGE_ADD_READ_SYSFS_FAIL
,

79 
	mMANAGE_ADD_ADD_NEW_DEVS_FAIL
,

80 
	mMANAGE_REMOVE_CANNOT_GET_EXCLUSIVE_ACCESS
 = 271,

81 
	mMANAGE_REMOVE_NOT_MEMBER
,

82 
	mMANAGE_REMOVE_IN_USE
,

83 
	mMANAGE_REMOVE_HOT_REMOVE_FAIL
,

84 
	mMANAGE_REMOVE_GET_CONTAINER_NAME_FAIL
,

85 
	mMANAGE_REPLACE_UNSUPPORTED_METADATA_VER
 = 291,

86 
	mMANAGE_REPLACE_CANNOT_FIND_MD_INFO
,

87 
	mMANAGE_REPLACE_DISK_NOT_ACTIVE
,

88 
	mMANAGE_REPLACE_REQUEST_REPLACEMENT_FAIL
,

89 
	mMANAGE_REPLACE_MD_NOT_FOUND
,

90 
	mMANAGE_WITH_CANNOT_FOUND_MD_INFO
 = 311,

91 
	mMANAGE_WITH_FAULTY_DISK
,

92 
	mMANAGE_WITH_ACTIVE_DISK
,

93 
	mMANAGE_WITH_PREFER_REPLACEMENT_FAIL
,

94 
	mMANAGE_WITH_MD_NOT_FOUND
,

97 
	mASSEMBLE_NO_IDENTITY_INFO
 = 401,

98 
	mASSEMBLE_RAID_DEVS_NOT_ENOUGH
,

99 
	mASSEMBLE_NEGATIVE_NUM_DEVICES
,

100 
	mASSEMBLE_SUPER_INFO_IS_NULL
,

101 
	mASSEMBLE_DRIVE_IS_ACTIVE
,

102 
	mASSEMBLE_INVALID_MDFD
,

103 
	mASSEMBLE_KERNEL_UNSUPPORT
,

104 
	mASSEMBLE_MD_ALREADY_ACTIVE
,

105 
	mASSEMBLE_CONTAINER_CONTENT_FAIL
,

106 
	mASSEMBLE_NEGATIVE_DEV_CNT
,

107 
	mASSEMBLE_NO_DEVS_FOR_MD
,

108 
	mASSEMBLE_OPEN_DEV_FAIL
,

109 
	mASSEMBLE_SUPERBLOCK_DISAPPEARED
,

110 
	mASSEMBLE_NO_SUITABLE_DRIVES
,

111 
	mASSEMBLE_REWRITE_SUPERBLOCK_FAIL
,

112 
	mASSEMBLE_FAIL
,

113 
	mASSEMBLE_MDDEV_UNSET
,

114 
	mASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
,

115 
	mASSEMBLE_INVALID_UUID
,

116 
	mASSEMBLE_MDDEV_INUSE
,

117 
	mASSEMBLE_MDNUM_ILLEGAL
,

118 
	mASSEMBLE_INITIALIZE_DEV_LIST_FAIL
,

119 
	mASSEMBLE_FAIL_TO_SET_ARRAY_INFO
,

120 
	mASSEMBLE_FAIL_TO_SET_BITMAP_FILE
,

121 
	mASSEMBLE_FAIL_TO_OPEN_BITMAP_FILE
,

122 
	mASSEMBLE_NEED_BACKUP_FILE
,

123 
	mASSEMBLE_UNDEFINED_ERROR
,

125 
	mKILL_OPEN_DEV_FAIL
 = 501,

126 
	mKILL_NOT_MD_COMPONENT
,

127 
	mKILL_ZERO_SUPERBLOCK_FAIL
,

129 
	mQUERY_OPEN_DEV_FAIL
 = 551,

130 
	mQUERY_NULL_POINTER
,

131 
	mEXAMINE_OPEN_DEV_FAIL
 = 601,

132 
	mEXAMINE_NO_MD_SUPERBLOCK
,

133 
	mEXAMINE_MEM_ALLOC_FAIL
,

134 
	mEXAMINE_NULL_POINTER


	@libmdadm/mdadm_other.h

1 #iâdeà
__MDADM_OTHER_H__


2 
	#__MDAMM_OTHER_H__


	)

4 
	#MAX_DISK_NUM
 64

	)

8 
	mRAID_STATUS_BIT_FUNCTIONAL
 = 0,

9 
	mRAID_STATUS_BIT_DEGRADE
,

10 
	mRAID_STATUS_BIT_FAILED
,

11 
	mRAID_STATUS_BIT_RECOVERING
,

12 
	mRAID_STATUS_BIT_UNMOUNTED
,

13 
	mRAID_STATUS_BIT_UNFORMATED
,

14 
	mRAID_STATUS_BIT_FILESYS_ERR
,

17 
	s¬¿y_disk_šfo
 {

18 
mdu_disk_šfo_t
 
	mdiskInfo
;

19 
	m¡rS‹
[256];

20 
	m¡rDevName
[64];

23 
	s¬¿y_d‘a
 {

24 
mdu_¬¿y_šfo_t
 
	m¬¿yInfo
;

25 
¬¿y_disk_šfo
 
	m¬¿yDisks
[
MAX_DISK_NUM
];

27 
	m¡rA¼ayS‹
[128];

28 
	m¡rA¼ayDevName
[32];

29 
	m¡rRaidLev–
[16];

30 
	m¡rRaidLayout
[32];

31 
	m¡rA¼aySize
[32];

32 
	m¡rU£dSize
[32];

33 
	m¡rRebudO³¿tiÚ
[16];

34 
	muÎA¼aySize
;

35 
	muÎU£dSize
;

36 
	muuid
[4];

37 
	mbIsSu³rBlockP”si¡’t
;

38 
	mbIÇùive
;

39 
	mbIsRebudšg
;

40 
	miRebudProg»ss
;

42 
	m¡rCÚš”
[32];

43 
	m¡rMemb”
[32];

46 
	mbResh­eAùive
;

47 
	miD–Disks
;

48 
	miRaidNewLev–
;

49 
	miNewChunkSize
;

50 
	muÎResh­eProg»ss
;

51 
	m¡rRaidNewLayout
[32];

54 
	squ”y_»suÉ
 {

55 
	mbIsMD
;

56 
	mbIsMDAùive
;

57 
	mbHasMDD‘a
;

58 
	mbHasMDE¼Ü
;

59 
	miMDRaidDiskNum
;

60 
	miMDS·»DiskNum
;

61 
	miMDRaidLev–
;

62 
	m¡rMDSize
[32];

63 
	m¡rMDLev–
[16];

64 
	m¡rMDDevName
[32];

65 
	m¡rMDE¼Ü
[128];

67 
	miDiskNumb”
;

68 
	m¡rDiskAùiv™y
[32];

69 
	m¡rDiskDevName
[32];

72 
	sexamše_»suÉ
 {

73 
	mcS‹
;

74 
	m¡rDevName
[32];

75 
	m¬¿yUUID
[4];

76 
	muRaidLev–
;

77 
	muRaidDiskNum
;

78 
	mbHasBadblock
;

79 
	mbSBChkSumE¼Ü
;

80 
	mbIsV®id
;

81 
	muChkSum
;

82 
	muEx³ùedChkSum
;

83 
	muDevRŞe
;

84 
examše_»suÉ
* 
	mÃxt
;

	@libmdadm/mdadm_other.h

1 #iâdeà
__MDADM_OTHER_H__


2 
	#__MDAMM_OTHER_H__


	)

4 
	#MAX_DISK_NUM
 64

	)

8 
	mRAID_STATUS_BIT_FUNCTIONAL
 = 0,

9 
	mRAID_STATUS_BIT_DEGRADE
,

10 
	mRAID_STATUS_BIT_FAILED
,

11 
	mRAID_STATUS_BIT_RECOVERING
,

12 
	mRAID_STATUS_BIT_UNMOUNTED
,

13 
	mRAID_STATUS_BIT_UNFORMATED
,

14 
	mRAID_STATUS_BIT_FILESYS_ERR
,

17 
	s¬¿y_disk_šfo
 {

18 
mdu_disk_šfo_t
 
	mdiskInfo
;

19 
	m¡rS‹
[256];

20 
	m¡rDevName
[64];

23 
	s¬¿y_d‘a
 {

24 
mdu_¬¿y_šfo_t
 
	m¬¿yInfo
;

25 
¬¿y_disk_šfo
 
	m¬¿yDisks
[
MAX_DISK_NUM
];

27 
	m¡rA¼ayS‹
[128];

28 
	m¡rA¼ayDevName
[32];

29 
	m¡rRaidLev–
[16];

30 
	m¡rRaidLayout
[32];

31 
	m¡rA¼aySize
[32];

32 
	m¡rU£dSize
[32];

33 
	m¡rRebudO³¿tiÚ
[16];

34 
	muÎA¼aySize
;

35 
	muÎU£dSize
;

36 
	muuid
[4];

37 
	mbIsSu³rBlockP”si¡’t
;

38 
	mbIÇùive
;

39 
	mbIsRebudšg
;

40 
	miRebudProg»ss
;

42 
	m¡rCÚš”
[32];

43 
	m¡rMemb”
[32];

46 
	mbResh­eAùive
;

47 
	miD–Disks
;

48 
	miRaidNewLev–
;

49 
	miNewChunkSize
;

50 
	muÎResh­eProg»ss
;

51 
	m¡rRaidNewLayout
[32];

54 
	squ”y_»suÉ
 {

55 
	mbIsMD
;

56 
	mbIsMDAùive
;

57 
	mbHasMDD‘a
;

58 
	mbHasMDE¼Ü
;

59 
	miMDRaidDiskNum
;

60 
	miMDS·»DiskNum
;

61 
	miMDRaidLev–
;

62 
	m¡rMDSize
[32];

63 
	m¡rMDLev–
[16];

64 
	m¡rMDDevName
[32];

65 
	m¡rMDE¼Ü
[128];

67 
	miDiskNumb”
;

68 
	m¡rDiskAùiv™y
[32];

69 
	m¡rDiskDevName
[32];

72 
	sexamše_»suÉ
 {

73 
	mcS‹
;

74 
	m¡rDevName
[32];

75 
	m¬¿yUUID
[4];

76 
	muRaidLev–
;

77 
	muRaidDiskNum
;

78 
	mbHasBadblock
;

79 
	mbSBChkSumE¼Ü
;

80 
	mbIsV®id
;

81 
	muChkSum
;

82 
	muEx³ùedChkSum
;

83 
	muDevRŞe
;

84 
examše_»suÉ
* 
	mÃxt
;

	@libmdadm/mdmon.h

21 #undeà
´_”r


22 
	#´_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, "mdmÚ: " fmt)

	)

24 
	e¬¿y_¡©e
 { 
	mş—r
, 
	mšaùive
, 
	msu¥’ded
, 
	m»adÚly
, 
	m»ad_auto
,

25 
	mş—n
, 
	maùive
, 
	mwr™e_³ndšg
, 
	maùive_idË
, 
	mbad_wÜd
};

27 
	esync_aùiÚ
 { 
	midË
, 
	m»sh­e
, 
	m»sync
, 
	m»cov”
, 
	mcheck
, 
	m»·œ
, 
	mbad_aùiÚ
 };

29 
	saùive_¬¿y
 {

30 
mdšfo
 
	mšfo
;

31 
su³¹y³
 *
	mcÚš”
;

32 
aùive_¬¿y
 *
	mÃxt
, *
	m»¶aûs
;

33 
	mto_»move
;

35 
	maùiÚ_fd
;

36 
	m»sync_¡¬t_fd
;

37 
	mm‘ad©a_fd
;

38 
	msync_com¶‘ed_fd
;

39 
	mÏ¡_checkpošt
;

48 
¬¿y_¡©e
 
	m´ev_¡©e
, 
	mcu¼_¡©e
, 
	mÃxt_¡©e
;

49 
sync_aùiÚ
 
	m´ev_aùiÚ
, 
	mcu¼_aùiÚ
, 
	mÃxt_aùiÚ
;

51 
	mcheck_deg¿ded
;

52 
	mcheck_»sh­e
;

66 
m‘ad©a_upd©e
 *
upd©e_queue
, *
upd©e_queue_hªdËd
;

68 
	#MD_MAJOR
 9

	)

70 
aùive_¬¿y
 *
cÚš”
;

71 
aùive_¬¿y
 *
disÿrd_this
;

72 
aùive_¬¿y
 *
³ndšg_disÿrd
;

73 
md_g’”ic_cmd
 *
aùive_cmd
;

75 
»move_pidfe
(*
devÇme
);

76 
do_mÚ™Ü
(
su³¹y³
 *
cÚš”
);

77 
do_mªag”
(
su³¹y³
 *
cÚš”
);

78 
sig‹rm
;

80 
»ad_dev_¡©e
(
fd
);

81 
is_cÚš”_memb”
(
md¡©_’t
 *
md¡©
, *
cÚš”
);

83 
md¡©_’t
 *
md¡©_»ad
(
hŞd
, 
¡¬t
);

85 
ex™_now
, 
mªag”_»ady
;

86 
mÚ_tid
, 
mgr_tid
;

87 
mÚ™Ü_loİ_út
;

92 
šlše
 
	$is_»sync_com¶‘e
(
mdšfo
 *
¬¿y
)

94 
sync_size
 = 0;

95 
ncİ›s
, 
l
;

96 
¬¿y
->¬¿y.
Ëv–
) {

101 
sync_size
 = 
¬¿y
->
compÚ’t_size
;

104 
l
 = 
¬¿y
->¬¿y.
Ïyout
;

105 
ncİ›s
 = (
l
 & 0xff) * ((l >> 8) && 0xff);

106 
sync_size
 = 
¬¿y
->
compÚ’t_size
 *‡¼ay->¬¿y.
¿id_disks
;

107 
sync_size
 /ğ
ncİ›s
;

110  
¬¿y
->
»sync_¡¬t
 >ğ
sync_size
;

111 
	}
}

	@libmdadm/mdmon.h

21 #undeà
´_”r


22 
	#´_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, "mdmÚ: " fmt)

	)

24 
	e¬¿y_¡©e
 { 
	mş—r
, 
	mšaùive
, 
	msu¥’ded
, 
	m»adÚly
, 
	m»ad_auto
,

25 
	mş—n
, 
	maùive
, 
	mwr™e_³ndšg
, 
	maùive_idË
, 
	mbad_wÜd
};

27 
	esync_aùiÚ
 { 
	midË
, 
	m»sh­e
, 
	m»sync
, 
	m»cov”
, 
	mcheck
, 
	m»·œ
, 
	mbad_aùiÚ
 };

29 
	saùive_¬¿y
 {

30 
mdšfo
 
	mšfo
;

31 
su³¹y³
 *
	mcÚš”
;

32 
aùive_¬¿y
 *
	mÃxt
, *
	m»¶aûs
;

33 
	mto_»move
;

35 
	maùiÚ_fd
;

36 
	m»sync_¡¬t_fd
;

37 
	mm‘ad©a_fd
;

38 
	msync_com¶‘ed_fd
;

39 
	mÏ¡_checkpošt
;

48 
¬¿y_¡©e
 
	m´ev_¡©e
, 
	mcu¼_¡©e
, 
	mÃxt_¡©e
;

49 
sync_aùiÚ
 
	m´ev_aùiÚ
, 
	mcu¼_aùiÚ
, 
	mÃxt_aùiÚ
;

51 
	mcheck_deg¿ded
;

52 
	mcheck_»sh­e
;

66 
m‘ad©a_upd©e
 *
upd©e_queue
, *
upd©e_queue_hªdËd
;

68 
	#MD_MAJOR
 9

	)

70 
aùive_¬¿y
 *
cÚš”
;

71 
aùive_¬¿y
 *
disÿrd_this
;

72 
aùive_¬¿y
 *
³ndšg_disÿrd
;

73 
md_g’”ic_cmd
 *
aùive_cmd
;

75 
»move_pidfe
(*
devÇme
);

76 
do_mÚ™Ü
(
su³¹y³
 *
cÚš”
);

77 
do_mªag”
(
su³¹y³
 *
cÚš”
);

78 
sig‹rm
;

80 
»ad_dev_¡©e
(
fd
);

81 
is_cÚš”_memb”
(
md¡©_’t
 *
md¡©
, *
cÚš”
);

83 
md¡©_’t
 *
md¡©_»ad
(
hŞd
, 
¡¬t
);

85 
ex™_now
, 
mªag”_»ady
;

86 
mÚ_tid
, 
mgr_tid
;

87 
mÚ™Ü_loİ_út
;

92 
šlše
 
	$is_»sync_com¶‘e
(
mdšfo
 *
¬¿y
)

94 
sync_size
 = 0;

95 
ncİ›s
, 
l
;

96 
¬¿y
->¬¿y.
Ëv–
) {

101 
sync_size
 = 
¬¿y
->
compÚ’t_size
;

104 
l
 = 
¬¿y
->¬¿y.
Ïyout
;

105 
ncİ›s
 = (
l
 & 0xff) * ((l >> 8) && 0xff);

106 
sync_size
 = 
¬¿y
->
compÚ’t_size
 *‡¼ay->¬¿y.
¿id_disks
;

107 
sync_size
 /ğ
ncİ›s
;

110  
¬¿y
->
»sync_¡¬t
 >ğ
sync_size
;

111 
	}
}

	@libmdadm/msg.h

20 
	gmdšfo
;

21 
	gm‘ad©a_upd©e
;

23 
»ûive_mes§ge
(
fd
, 
m‘ad©a_upd©e
 *
msg
, 
tmo
);

24 
£nd_mes§ge
(
fd
, 
m‘ad©a_upd©e
 *
msg
, 
tmo
);

25 
ack
(
fd
, 
tmo
);

26 
wa™_»¶y
(
fd
, 
tmo
);

27 
cÚÃù_mÚ™Ü
(*
devÇme
);

28 
pšg_mÚ™Ü
(*
devÇme
);

29 
block_sub¬¿y
(
mdšfo
 *
¤a
);

30 
unblock_sub¬¿y
(
mdšfo
 *
¤a
, cÚ¡ 
unä“ze
);

31 
block_mÚ™Ü
(*
cÚš”
, cÚ¡ 
ä“ze
);

32 
unblock_mÚ™Ü
(*
cÚš”
, cÚ¡ 
unä“ze
);

33 
åšg_mÚ™Ü
(
sock
);

34 
pšg_mªag”
(*
devÇme
);

35 
æush_mdmÚ
(*
cÚš”
);

37 
	#MSG_MAX_LEN
 (4*1024*1024)

	)

	@libmdadm/msg.h

20 
	gmdšfo
;

21 
	gm‘ad©a_upd©e
;

23 
»ûive_mes§ge
(
fd
, 
m‘ad©a_upd©e
 *
msg
, 
tmo
);

24 
£nd_mes§ge
(
fd
, 
m‘ad©a_upd©e
 *
msg
, 
tmo
);

25 
ack
(
fd
, 
tmo
);

26 
wa™_»¶y
(
fd
, 
tmo
);

27 
cÚÃù_mÚ™Ü
(*
devÇme
);

28 
pšg_mÚ™Ü
(*
devÇme
);

29 
block_sub¬¿y
(
mdšfo
 *
¤a
);

30 
unblock_sub¬¿y
(
mdšfo
 *
¤a
, cÚ¡ 
unä“ze
);

31 
block_mÚ™Ü
(*
cÚš”
, cÚ¡ 
ä“ze
);

32 
unblock_mÚ™Ü
(*
cÚš”
, cÚ¡ 
unä“ze
);

33 
åšg_mÚ™Ü
(
sock
);

34 
pšg_mªag”
(*
devÇme
);

35 
æush_mdmÚ
(*
cÚš”
);

37 
	#MSG_MAX_LEN
 (4*1024*1024)

	)

	@libmdadm/part.h

29 
	#MBR_SIGNATURE_MAGIC
 
	`__ıu_to_Ë16
(0xAA55)

	)

30 
	#MBR_PARTITIONS
 4

	)

32 
	sMBR_·¹_»cÜd
 {

33 
__u8
 
	mboÙabË
;

34 
__u8
 
	mfœ¡_h—d
;

35 
__u8
 
	mfœ¡_£ùÜ
;

36 
__u8
 
	mfœ¡_cyl
;

37 
__u8
 
	m·¹_ty³
;

38 
__u8
 
	mÏ¡_h—d
;

39 
__u8
 
	mÏ¡_£ùÜ
;

40 
__u8
 
	mÏ¡_cyl
;

41 
__u32
 
	mfœ¡_£ù_lba
;

42 
__u32
 
	mblocks_num
;

45 
	sMBR
 {

46 
__u8
 
	m·d
[446];

47 
MBR_·¹_»cÜd
 
	m·¹s
[
MBR_PARTITIONS
];

48 
__u16
 
	mmagic
;

49 } 
__©Œibu‹__
((
·cked
));

51 
	#GPT_SIGNATURE_MAGIC
 
	`__ıu_to_Ë64
(0x5452415020494645ULL)

	)

52 
	#MBR_GPT_PARTITION_TYPE
 0xEE

	)

54 
	sGPT_·¹_’Œy
 {

55 
	mty³_guid
[16];

56 
	m·¹™iÚ_guid
[16];

57 
__u64
 
	m¡¬tšg_lba
;

58 
__u64
 
	m’dšg_lba
;

59 
	m©Œ_b™s
[8];

60 
	mÇme
[72];

61 } 
__©Œibu‹__
((
·cked
));

63 
	sGPT
 {

64 
__u64
 
	mmagic
;

65 
__u32
 
	m»visiÚ
;

66 
__u32
 
	mh—d”_size
;

67 
__u32
 
	müc
;

68 
__u32
 
	m·d1
;

69 
__u64
 
	mcu¼’t_lba
;

70 
__u64
 
	mbackup_lba
;

71 
__u64
 
	mfœ¡_lba
;

72 
__u64
 
	mÏ¡_lba
;

73 
__u8
 
	mguid
[16];

74 
__u64
 
	m·¹_¡¬t
;

75 
__u32
 
	m·¹_út
;

76 
__u32
 
	m·¹_size
;

77 
__u32
 
	m·¹_üc
;

78 
__u8
 
	m·d2
[420];

79 } 
__©Œibu‹__
((
·cked
));

	@libmdadm/part.h

29 
	#MBR_SIGNATURE_MAGIC
 
	`__ıu_to_Ë16
(0xAA55)

	)

30 
	#MBR_PARTITIONS
 4

	)

32 
	sMBR_·¹_»cÜd
 {

33 
__u8
 
	mboÙabË
;

34 
__u8
 
	mfœ¡_h—d
;

35 
__u8
 
	mfœ¡_£ùÜ
;

36 
__u8
 
	mfœ¡_cyl
;

37 
__u8
 
	m·¹_ty³
;

38 
__u8
 
	mÏ¡_h—d
;

39 
__u8
 
	mÏ¡_£ùÜ
;

40 
__u8
 
	mÏ¡_cyl
;

41 
__u32
 
	mfœ¡_£ù_lba
;

42 
__u32
 
	mblocks_num
;

45 
	sMBR
 {

46 
__u8
 
	m·d
[446];

47 
MBR_·¹_»cÜd
 
	m·¹s
[
MBR_PARTITIONS
];

48 
__u16
 
	mmagic
;

49 } 
__©Œibu‹__
((
·cked
));

51 
	#GPT_SIGNATURE_MAGIC
 
	`__ıu_to_Ë64
(0x5452415020494645ULL)

	)

52 
	#MBR_GPT_PARTITION_TYPE
 0xEE

	)

54 
	sGPT_·¹_’Œy
 {

55 
	mty³_guid
[16];

56 
	m·¹™iÚ_guid
[16];

57 
__u64
 
	m¡¬tšg_lba
;

58 
__u64
 
	m’dšg_lba
;

59 
	m©Œ_b™s
[8];

60 
	mÇme
[72];

61 } 
__©Œibu‹__
((
·cked
));

63 
	sGPT
 {

64 
__u64
 
	mmagic
;

65 
__u32
 
	m»visiÚ
;

66 
__u32
 
	mh—d”_size
;

67 
__u32
 
	müc
;

68 
__u32
 
	m·d1
;

69 
__u64
 
	mcu¼’t_lba
;

70 
__u64
 
	mbackup_lba
;

71 
__u64
 
	mfœ¡_lba
;

72 
__u64
 
	mÏ¡_lba
;

73 
__u8
 
	mguid
[16];

74 
__u64
 
	m·¹_¡¬t
;

75 
__u32
 
	m·¹_út
;

76 
__u32
 
	m·¹_size
;

77 
__u32
 
	m·¹_üc
;

78 
__u8
 
	m·d2
[420];

79 } 
__©Œibu‹__
((
·cked
));

	@libmdadm/platform-intel.h

19 
	~<asm/ty³s.h
>

20 
	~<¡ršgs.h
>

23 
	simsm_Üom
 {

24 
__u8
 
	msigÇtu»
[4];

25 
__u8
 
	mbË_v”_majÜ
;

26 
__u8
 
	mbË_v”_mšÜ
;

27 
__u16
 
	mmajÜ_v”
;

28 
__u16
 
	mmšÜ_v”
;

29 
__u16
 
	mhÙfix_v”
;

30 
__u16
 
	mbud
;

31 
__u8
 
	mËn
;

32 
__u8
 
	mchecksum
;

33 
__u16
 
	m¾c
;

37 
	#IMSM_OROM_RLC_RAID0
 (1 << 0)

	)

38 
	#IMSM_OROM_RLC_RAID1
 (1 << 1)

	)

39 
	#IMSM_OROM_RLC_RAID10
 (1 << 2)

	)

40 
	#IMSM_OROM_RLC_RAID1E
 (1 << 3)

	)

41 
	#IMSM_OROM_RLC_RAID5
 (1 << 4)

	)

42 
	#IMSM_OROM_RLC_RAID_CNG
 (1 << 5)

	)

43 
__u16
 
	msss
;

44 
	#IMSM_OROM_SSS_2kB
 (1 << 0)

	)

45 
	#IMSM_OROM_SSS_4kB
 (1 << 1)

	)

46 
	#IMSM_OROM_SSS_8kB
 (1 << 2)

	)

47 
	#IMSM_OROM_SSS_16kB
 (1 << 3)

	)

48 
	#IMSM_OROM_SSS_32kB
 (1 << 4)

	)

49 
	#IMSM_OROM_SSS_64kB
 (1 << 5)

	)

50 
	#IMSM_OROM_SSS_128kB
 (1 << 6)

	)

51 
	#IMSM_OROM_SSS_256kB
 (1 << 7)

	)

52 
	#IMSM_OROM_SSS_512kB
 (1 << 8)

	)

53 
	#IMSM_OROM_SSS_1MB
 (1 << 9)

	)

54 
	#IMSM_OROM_SSS_2MB
 (1 << 10)

	)

55 
	#IMSM_OROM_SSS_4MB
 (1 << 11)

	)

56 
	#IMSM_OROM_SSS_8MB
 (1 << 12)

	)

57 
	#IMSM_OROM_SSS_16MB
 (1 << 13)

	)

58 
	#IMSM_OROM_SSS_32MB
 (1 << 14)

	)

59 
	#IMSM_OROM_SSS_64MB
 (1 << 15)

	)

60 
__u16
 
	md·
;

61 
	#IMSM_OROM_DISKS_PER_ARRAY
 6

	)

62 
__u16
 
	mtds
;

63 
	#IMSM_OROM_TOTAL_DISKS
 6

	)

64 
__u8
 
	mv·
;

65 
	#IMSM_OROM_VOLUMES_PER_ARRAY
 2

	)

66 
__u8
 
	mvphba
;

67 
	#IMSM_OROM_VOLUMES_PER_HBA
 4

	)

72 
__u32
 
	m©Œ
;

73 
	#IMSM_OROM_ATTR_RAID0
 
IMSM_OROM_RLC_RAID0


	)

74 
	#IMSM_OROM_ATTR_RAID1
 
IMSM_OROM_RLC_RAID1


	)

75 
	#IMSM_OROM_ATTR_RAID10
 
IMSM_OROM_RLC_RAID10


	)

76 
	#IMSM_OROM_ATTR_RAID1E
 
IMSM_OROM_RLC_RAID1E


	)

77 
	#IMSM_OROM_ATTR_RAID5
 
IMSM_OROM_RLC_RAID5


	)

78 
	#IMSM_OROM_ATTR_RAID_CNG
 
IMSM_OROM_RLC_RAID_CNG


	)

79 
	#IMSM_OROM_ATTR_2TB_DISK
 (1 << 26)

	)

80 
	#IMSM_OROM_ATTR_2TB
 (1 << 29)

	)

81 
	#IMSM_OROM_ATTR_PM
 (1 << 30)

	)

82 
	#IMSM_OROM_ATTR_ChecksumV”ify
 (1 << 31)

	)

83 
__u32
 
	mÿ·b™›s
;

84 
	#IMSM_OROM_CAPABILITIES_Ext_SATA
 (1 << 0)

	)

85 
	#IMSM_OROM_CAPABILITIES_TurboMemÜy
 (1 << 1)

	)

86 
	#IMSM_OROM_CAPABILITIES_HddPasswÜd
 (1 << 2)

	)

87 
	#IMSM_OROM_CAPABILITIES_DiskCÛrciÚ
 (1 << 3)

	)

88 
__u32
 
	mdriv”_ã©u»s
;

89 
	#IMSM_OROM_CAPABILITIES_HDDUÆock
 (1 << 0)

	)

90 
	#IMSM_OROM_CAPABILITIES_LEDLoc
 (1 << 1)

	)

91 
	#IMSM_OROM_CAPABILITIES_EÁ”´i£Sy¡em
 (1 << 2)

	)

92 
	#IMSM_OROM_CAPABILITIES_Zpodd
 (1 << 3)

	)

93 
	#IMSM_OROM_CAPABILITIES_L¬geD¿mCache
 (1 << 4)

	)

94 
	#IMSM_OROM_CAPABILITIES_Rohi
 (1 << 5)

	)

95 
	#IMSM_OROM_CAPABILITIES_R—dP©rŞ
 (1 << 6)

	)

96 
	#IMSM_OROM_CAPABILITIES_XÜHw
 (1 << 7)

	)

97 } 
__©Œibu‹__
((
·cked
));

99 
šlše
 
	$imsm_Üom_has_¿id0
(cÚ¡ 
imsm_Üom
 *
Üom
)

101  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID0
);

102 
	}
}

103 
šlše
 
	$imsm_Üom_has_¿id1
(cÚ¡ 
imsm_Üom
 *
Üom
)

105  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID1
);

106 
	}
}

107 
šlše
 
	$imsm_Üom_has_¿id1e
(cÚ¡ 
imsm_Üom
 *
Üom
)

109  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID1E
);

110 
	}
}

111 
šlše
 
	$imsm_Üom_has_¿id10
(cÚ¡ 
imsm_Üom
 *
Üom
)

113  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID10
);

114 
	}
}

115 
šlše
 
	$imsm_Üom_has_¿id5
(cÚ¡ 
imsm_Üom
 *
Üom
)

117  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID5
);

118 
	}
}

125 
šlše
 
	$imsm_Üom_has_chunk
(cÚ¡ 
imsm_Üom
 *
Üom
, 
chunk
)

127 
fs
 = 
	`ffs
(
chunk
);

128 ià(!
fs
)

130 
fs
--;

131 ià(
chunk
 & (chunk-1))

133  !!(
Üom
->
sss
 & (1 << (
fs
 - 1)));

134 
	}
}

142 
šlše
 
	$æs
(
x
)

144 
r
 = 32;

146 ià(!
x
)

148 ià(!(
x
 & 0xffff0000u)) {

149 
x
 <<= 16;

150 
r
 -= 16;

152 ià(!(
x
 & 0xff000000u)) {

153 
x
 <<= 8;

154 
r
 -= 8;

156 ià(!(
x
 & 0xf0000000u)) {

157 
x
 <<= 4;

158 
r
 -= 4;

160 ià(!(
x
 & 0xc0000000u)) {

161 
x
 <<= 2;

162 
r
 -= 2;

164 ià(!(
x
 & 0x80000000u)) {

165 
x
 <<= 1;

166 
r
 -= 1;

168  
r
;

169 
	}
}

171 
	esys_dev_ty³
 {

172 
	mSYS_DEV_UNKNOWN
 = 0,

173 
	mSYS_DEV_SAS
,

174 
	mSYS_DEV_SATA
,

175 
	mSYS_DEV_MAX


178 
	ssys_dev
 {

179 
sys_dev_ty³
 
	mty³
;

180 *
	m·th
;

181 *
	mpci_id
;

182 
__u16
 
	mdev_id
;

183 
sys_dev
 *
	mÃxt
;

186 
	sefi_guid
 {

187 
__u8
 
	mb
[16];

190 
šlše
 *
	$guid_¡r
(*
buf
, 
efi_guid
 
guid
)

192 
	`¥rštf
(
buf
, "%02x%02x%02x%02x-%02x%02x-%02x%02x-"

194 
guid
.
b
[3], guid.b[2], guid.b[1], guid.b[0],

195 
guid
.
b
[5], guid.b[4], guid.b[7], guid.b[6],

196 
guid
.
b
[8], guid.b[9], guid.b[10], guid.b[11],

197 
guid
.
b
[12], guid.b[13], guid.b[14], guid.b[15]);

198  
buf
;

199 
	}
}

201 *
diskfd_to_dev·th
(
fd
);

202 
sys_dev
 *
fšd_driv”_deviûs
(cÚ¡ *
bus
, cÚ¡ *
driv”
);

203 
sys_dev
 *
fšd_š‹l_deviûs
();

204 cÚ¡ 
imsm_Üom
 *
fšd_imsm_ÿ·b™y
(
sys_dev_ty³
 
hba_id
);

205 cÚ¡ 
imsm_Üom
 *
fšd_imsm_Üom
();

206 
disk_©ched_to_hba
(
fd
, cÚ¡ *
hba_·th
);

207 
devt_©ched_to_hba
(
dev_t
 
dev
, cÚ¡ *
hba_·th
);

208 *
devt_to_dev·th
(
dev_t
 
dev
);

209 
·th_©ched_to_hba
(cÚ¡ *
disk_·th
, cÚ¡ *
hba_·th
);

210 cÚ¡ *
g‘_sys_dev_ty³
(
sys_dev_ty³
);

	@libmdadm/platform-intel.h

19 
	~<asm/ty³s.h
>

20 
	~<¡ršgs.h
>

23 
	simsm_Üom
 {

24 
__u8
 
	msigÇtu»
[4];

25 
__u8
 
	mbË_v”_majÜ
;

26 
__u8
 
	mbË_v”_mšÜ
;

27 
__u16
 
	mmajÜ_v”
;

28 
__u16
 
	mmšÜ_v”
;

29 
__u16
 
	mhÙfix_v”
;

30 
__u16
 
	mbud
;

31 
__u8
 
	mËn
;

32 
__u8
 
	mchecksum
;

33 
__u16
 
	m¾c
;

37 
	#IMSM_OROM_RLC_RAID0
 (1 << 0)

	)

38 
	#IMSM_OROM_RLC_RAID1
 (1 << 1)

	)

39 
	#IMSM_OROM_RLC_RAID10
 (1 << 2)

	)

40 
	#IMSM_OROM_RLC_RAID1E
 (1 << 3)

	)

41 
	#IMSM_OROM_RLC_RAID5
 (1 << 4)

	)

42 
	#IMSM_OROM_RLC_RAID_CNG
 (1 << 5)

	)

43 
__u16
 
	msss
;

44 
	#IMSM_OROM_SSS_2kB
 (1 << 0)

	)

45 
	#IMSM_OROM_SSS_4kB
 (1 << 1)

	)

46 
	#IMSM_OROM_SSS_8kB
 (1 << 2)

	)

47 
	#IMSM_OROM_SSS_16kB
 (1 << 3)

	)

48 
	#IMSM_OROM_SSS_32kB
 (1 << 4)

	)

49 
	#IMSM_OROM_SSS_64kB
 (1 << 5)

	)

50 
	#IMSM_OROM_SSS_128kB
 (1 << 6)

	)

51 
	#IMSM_OROM_SSS_256kB
 (1 << 7)

	)

52 
	#IMSM_OROM_SSS_512kB
 (1 << 8)

	)

53 
	#IMSM_OROM_SSS_1MB
 (1 << 9)

	)

54 
	#IMSM_OROM_SSS_2MB
 (1 << 10)

	)

55 
	#IMSM_OROM_SSS_4MB
 (1 << 11)

	)

56 
	#IMSM_OROM_SSS_8MB
 (1 << 12)

	)

57 
	#IMSM_OROM_SSS_16MB
 (1 << 13)

	)

58 
	#IMSM_OROM_SSS_32MB
 (1 << 14)

	)

59 
	#IMSM_OROM_SSS_64MB
 (1 << 15)

	)

60 
__u16
 
	md·
;

61 
	#IMSM_OROM_DISKS_PER_ARRAY
 6

	)

62 
__u16
 
	mtds
;

63 
	#IMSM_OROM_TOTAL_DISKS
 6

	)

64 
__u8
 
	mv·
;

65 
	#IMSM_OROM_VOLUMES_PER_ARRAY
 2

	)

66 
__u8
 
	mvphba
;

67 
	#IMSM_OROM_VOLUMES_PER_HBA
 4

	)

72 
__u32
 
	m©Œ
;

73 
	#IMSM_OROM_ATTR_RAID0
 
IMSM_OROM_RLC_RAID0


	)

74 
	#IMSM_OROM_ATTR_RAID1
 
IMSM_OROM_RLC_RAID1


	)

75 
	#IMSM_OROM_ATTR_RAID10
 
IMSM_OROM_RLC_RAID10


	)

76 
	#IMSM_OROM_ATTR_RAID1E
 
IMSM_OROM_RLC_RAID1E


	)

77 
	#IMSM_OROM_ATTR_RAID5
 
IMSM_OROM_RLC_RAID5


	)

78 
	#IMSM_OROM_ATTR_RAID_CNG
 
IMSM_OROM_RLC_RAID_CNG


	)

79 
	#IMSM_OROM_ATTR_2TB_DISK
 (1 << 26)

	)

80 
	#IMSM_OROM_ATTR_2TB
 (1 << 29)

	)

81 
	#IMSM_OROM_ATTR_PM
 (1 << 30)

	)

82 
	#IMSM_OROM_ATTR_ChecksumV”ify
 (1 << 31)

	)

83 
__u32
 
	mÿ·b™›s
;

84 
	#IMSM_OROM_CAPABILITIES_Ext_SATA
 (1 << 0)

	)

85 
	#IMSM_OROM_CAPABILITIES_TurboMemÜy
 (1 << 1)

	)

86 
	#IMSM_OROM_CAPABILITIES_HddPasswÜd
 (1 << 2)

	)

87 
	#IMSM_OROM_CAPABILITIES_DiskCÛrciÚ
 (1 << 3)

	)

88 
__u32
 
	mdriv”_ã©u»s
;

89 
	#IMSM_OROM_CAPABILITIES_HDDUÆock
 (1 << 0)

	)

90 
	#IMSM_OROM_CAPABILITIES_LEDLoc
 (1 << 1)

	)

91 
	#IMSM_OROM_CAPABILITIES_EÁ”´i£Sy¡em
 (1 << 2)

	)

92 
	#IMSM_OROM_CAPABILITIES_Zpodd
 (1 << 3)

	)

93 
	#IMSM_OROM_CAPABILITIES_L¬geD¿mCache
 (1 << 4)

	)

94 
	#IMSM_OROM_CAPABILITIES_Rohi
 (1 << 5)

	)

95 
	#IMSM_OROM_CAPABILITIES_R—dP©rŞ
 (1 << 6)

	)

96 
	#IMSM_OROM_CAPABILITIES_XÜHw
 (1 << 7)

	)

97 } 
__©Œibu‹__
((
·cked
));

99 
šlše
 
	$imsm_Üom_has_¿id0
(cÚ¡ 
imsm_Üom
 *
Üom
)

101  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID0
);

102 
	}
}

103 
šlše
 
	$imsm_Üom_has_¿id1
(cÚ¡ 
imsm_Üom
 *
Üom
)

105  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID1
);

106 
	}
}

107 
šlše
 
	$imsm_Üom_has_¿id1e
(cÚ¡ 
imsm_Üom
 *
Üom
)

109  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID1E
);

110 
	}
}

111 
šlše
 
	$imsm_Üom_has_¿id10
(cÚ¡ 
imsm_Üom
 *
Üom
)

113  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID10
);

114 
	}
}

115 
šlše
 
	$imsm_Üom_has_¿id5
(cÚ¡ 
imsm_Üom
 *
Üom
)

117  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID5
);

118 
	}
}

125 
šlše
 
	$imsm_Üom_has_chunk
(cÚ¡ 
imsm_Üom
 *
Üom
, 
chunk
)

127 
fs
 = 
	`ffs
(
chunk
);

128 ià(!
fs
)

130 
fs
--;

131 ià(
chunk
 & (chunk-1))

133  !!(
Üom
->
sss
 & (1 << (
fs
 - 1)));

134 
	}
}

142 
šlše
 
	$æs
(
x
)

144 
r
 = 32;

146 ià(!
x
)

148 ià(!(
x
 & 0xffff0000u)) {

149 
x
 <<= 16;

150 
r
 -= 16;

152 ià(!(
x
 & 0xff000000u)) {

153 
x
 <<= 8;

154 
r
 -= 8;

156 ià(!(
x
 & 0xf0000000u)) {

157 
x
 <<= 4;

158 
r
 -= 4;

160 ià(!(
x
 & 0xc0000000u)) {

161 
x
 <<= 2;

162 
r
 -= 2;

164 ià(!(
x
 & 0x80000000u)) {

165 
x
 <<= 1;

166 
r
 -= 1;

168  
r
;

169 
	}
}

171 
	esys_dev_ty³
 {

172 
	mSYS_DEV_UNKNOWN
 = 0,

173 
	mSYS_DEV_SAS
,

174 
	mSYS_DEV_SATA
,

175 
	mSYS_DEV_MAX


178 
	ssys_dev
 {

179 
sys_dev_ty³
 
	mty³
;

180 *
	m·th
;

181 *
	mpci_id
;

182 
__u16
 
	mdev_id
;

183 
sys_dev
 *
	mÃxt
;

186 
	sefi_guid
 {

187 
__u8
 
	mb
[16];

190 
šlše
 *
	$guid_¡r
(*
buf
, 
efi_guid
 
guid
)

192 
	`¥rštf
(
buf
, "%02x%02x%02x%02x-%02x%02x-%02x%02x-"

194 
guid
.
b
[3], guid.b[2], guid.b[1], guid.b[0],

195 
guid
.
b
[5], guid.b[4], guid.b[7], guid.b[6],

196 
guid
.
b
[8], guid.b[9], guid.b[10], guid.b[11],

197 
guid
.
b
[12], guid.b[13], guid.b[14], guid.b[15]);

198  
buf
;

199 
	}
}

201 *
diskfd_to_dev·th
(
fd
);

202 
sys_dev
 *
fšd_driv”_deviûs
(cÚ¡ *
bus
, cÚ¡ *
driv”
);

203 
sys_dev
 *
fšd_š‹l_deviûs
();

204 cÚ¡ 
imsm_Üom
 *
fšd_imsm_ÿ·b™y
(
sys_dev_ty³
 
hba_id
);

205 cÚ¡ 
imsm_Üom
 *
fšd_imsm_Üom
();

206 
disk_©ched_to_hba
(
fd
, cÚ¡ *
hba_·th
);

207 
devt_©ched_to_hba
(
dev_t
 
dev
, cÚ¡ *
hba_·th
);

208 *
devt_to_dev·th
(
dev_t
 
dev
);

209 
·th_©ched_to_hba
(cÚ¡ *
disk_·th
, cÚ¡ *
hba_·th
);

210 cÚ¡ *
g‘_sys_dev_ty³
(
sys_dev_ty³
);

	@libmdadm/probe_roms.h

20 
´obe_roms_ex™
();

21 
´obe_roms_š™
(
®ign
);

22 (*
	tsÿn_â
)(cÚ¡ *
	t¡¬t
, cÚ¡ *
	t’d
, cÚ¡ *
	td©a
);

23 
	`sÿn_ad­‹r_roms
(
sÿn_â
 
â
);

24 
	`´obe_roms
();

	@libmdadm/probe_roms.h

20 
´obe_roms_ex™
();

21 
´obe_roms_š™
(
®ign
);

22 (*
	tsÿn_â
)(cÚ¡ *
	t¡¬t
, cÚ¡ *
	t’d
, cÚ¡ *
	td©a
);

23 
	`sÿn_ad­‹r_roms
(
sÿn_â
 
â
);

24 
	`´obe_roms
();

	@libmdadm/sha1.h

20 #iâdeà
SHA1_H


21 
	#SHA1_H
 1

	)

23 
	~<¡dio.h
>

25 #ià
defšed
 
HAVE_LIMITS_H
 || 
_LIBC


26 
	~<lim™s.h
>

36 #ifdeà
_LIBC


37 
	~<sys/ty³s.h
>

38 
u_št32_t
 
	tsha1_ušt32
;

39 
ušŒ_t
 
	tsha1_ušŒ
;

41 
	#INT_MAX_32_BITS
 2147483647

	)

48 #iâdeà
INT_MAX


49 
	#INT_MAX
 
INT_MAX_32_BITS


	)

52 #ià
INT_MAX
 =ğ
INT_MAX_32_BITS


53 
	tsha1_ušt32
;

55 #ià
SHRT_MAX
 =ğ
INT_MAX_32_BITS


56 
	tsha1_ušt32
;

58 #ià
LONG_MAX
 =ğ
INT_MAX_32_BITS


59 
	tsha1_ušt32
;

69 #ifdeà
__ılu¥lus


74 
	ssha1_ùx


76 
sha1_ušt32
 
A
;

77 
sha1_ušt32
 
B
;

78 
sha1_ušt32
 
C
;

79 
sha1_ušt32
 
D
;

80 
sha1_ušt32
 
E
;

82 
sha1_ušt32
 
tÙ®
[2];

83 
sha1_ušt32
 
buæ’
;

84 
sha1_ušt32
 
bufãr
[32];

88 
sha1_š™_ùx
 (
sha1_ùx
 *
ùx
);

94 
sha1_´oûss_block
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
,

95 
sha1_ùx
 *
ùx
);

101 
sha1_´oûss_by‹s
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
,

102 
sha1_ùx
 *
ùx
);

111 *
sha1_fšish_ùx
 (
sha1_ùx
 *
ùx
, *
»sbuf
);

119 *
sha1_»ad_ùx
 (cÚ¡ 
sha1_ùx
 *
ùx
, *
»sbuf
);

124 
sha1_¡»am
 (
FILE
 *
¡»am
, *
»sblock
);

130 *
sha1_bufãr
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
, *
»sblock
);

132 #ifdeà
__ılu¥lus


	@libmdadm/sha1.h

20 #iâdeà
SHA1_H


21 
	#SHA1_H
 1

	)

23 
	~<¡dio.h
>

25 #ià
defšed
 
HAVE_LIMITS_H
 || 
_LIBC


26 
	~<lim™s.h
>

36 #ifdeà
_LIBC


37 
	~<sys/ty³s.h
>

38 
u_št32_t
 
	tsha1_ušt32
;

39 
ušŒ_t
 
	tsha1_ušŒ
;

41 
	#INT_MAX_32_BITS
 2147483647

	)

48 #iâdeà
INT_MAX


49 
	#INT_MAX
 
INT_MAX_32_BITS


	)

52 #ià
INT_MAX
 =ğ
INT_MAX_32_BITS


53 
	tsha1_ušt32
;

55 #ià
SHRT_MAX
 =ğ
INT_MAX_32_BITS


56 
	tsha1_ušt32
;

58 #ià
LONG_MAX
 =ğ
INT_MAX_32_BITS


59 
	tsha1_ušt32
;

69 #ifdeà
__ılu¥lus


74 
	ssha1_ùx


76 
sha1_ušt32
 
A
;

77 
sha1_ušt32
 
B
;

78 
sha1_ušt32
 
C
;

79 
sha1_ušt32
 
D
;

80 
sha1_ušt32
 
E
;

82 
sha1_ušt32
 
tÙ®
[2];

83 
sha1_ušt32
 
buæ’
;

84 
sha1_ušt32
 
bufãr
[32];

88 
sha1_š™_ùx
 (
sha1_ùx
 *
ùx
);

94 
sha1_´oûss_block
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
,

95 
sha1_ùx
 *
ùx
);

101 
sha1_´oûss_by‹s
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
,

102 
sha1_ùx
 *
ùx
);

111 *
sha1_fšish_ùx
 (
sha1_ùx
 *
ùx
, *
»sbuf
);

119 *
sha1_»ad_ùx
 (cÚ¡ 
sha1_ùx
 *
ùx
, *
»sbuf
);

124 
sha1_¡»am
 (
FILE
 *
¡»am
, *
»sblock
);

130 *
sha1_bufãr
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
, *
»sblock
);

132 #ifdeà
__ılu¥lus


	@libmke2fs/ext2fs.h

12 #iâdeà
_EXT2FS_EXT2FS_H


13 
	#_EXT2FS_EXT2FS_H


	)

15 #ifdeà
__GNUC__


16 
	#EXT2FS_ATTR
(
x
è
	`__©Œibu‹__
(x)

	)

18 
	#EXT2FS_ATTR
(
x
)

	)

21 #ifdeà
__ılu¥lus


28 #ià(!
defšed
(
__GNUC__
è&& !defšed(
__WATCOMC__
))

29 
	#NO_INLINE_FUNCS


	)

39 
	#SUPERBLOCK_OFFSET
 1024

	)

40 
	#SUPERBLOCK_SIZE
 1024

	)

46 
	#EXT2_LIB_CURRENT_REV
 
EXT2_DYNAMIC_REV


	)

48 #ifdeà
HAVE_SYS_TYPES_H


49 
	~<sys/ty³s.h
>

52 
	~<¡dio.h
>

53 
	~<¡dlib.h
>

54 
	~<¡ršg.h
>

55 
	~<”ºo.h
>

57 #ià
EXT2_FLAT_INCLUDES


58 
	~"e2_ty³s.h
"

59 
	~"ext2_fs.h
"

60 
	~"ext3_ex‹Ás.h
"

62 
	~<ext2fs/ext2_ty³s.h
>

63 
	~<ext2fs/ext2_fs.h
>

64 
	~<ext2fs/ext3_ex‹Ás.h
>

67 #ifdeà
__CHECK_ENDIAN__


68 
	#__b™wi£
 
	`__©Œibu‹__
((
b™wi£
))

	)

70 
	#__b™wi£


	)

73 
__u32
 
	t__b™wi£
 
	text2_šo_t
;

74 
__u32
 
	t__b™wi£
 
	tblk_t
;

75 
__u64
 
	t__b™wi£
 
	tblk64_t
;

76 
__u32
 
	t__b™wi£
 
	tdg½_t
;

77 
__u32
 
	t__b™wi£
 
	text2_off_t
;

78 
__u64
 
	t__b™wi£
 
	text2_off64_t
;

79 
__s64
 
	t__b™wi£
 
	te2_blkút_t
;

80 
__u32
 
	t__b™wi£
 
	text2_dœhash_t
;

82 #ià
EXT2_FLAT_INCLUDES


83 
	~"com_”r.h
"

84 
	~"ext2_io.h
"

85 
	~"ext2_”r.h
"

86 
	~"ext2_ext_©Œ.h
"

88 
	~<‘/com_”r.h
>

89 
	~<ext2fs/ext2_io.h
>

90 
	~<ext2fs/ext2_”r.h
>

91 
	~<ext2fs/ext2_ext_©Œ.h
>

97 #ifdeà
_MSC_VER


98 
	#EXT2_QSORT_TYPE
 
__cdeş


	)

100 
	#EXT2_QSORT_TYPE
 

	)

103 
¡ruù_ext2_fsys
 *
	text2_fsys
;

105 
	#EXT2FS_MARK_ERROR
 0

	)

106 
	#EXT2FS_UNMARK_ERROR
 1

	)

107 
	#EXT2FS_TEST_ERROR
 2

	)

109 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_g’”ic_b™m­
;

110 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_šode_b™m­
;

111 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_block_b™m­
;

113 
	#EXT2_FIRST_INODE
(
s
è
	`EXT2_FIRST_INO
(s)

	)

120 
ext2_¡ruù_u32_li¡
 *
	text2_badblocks_li¡
;

121 
ext2_¡ruù_u32_™”©e
 *
	text2_badblocks_™”©e
;

123 
ext2_¡ruù_u32_li¡
 *
	text2_u32_li¡
;

124 
ext2_¡ruù_u32_™”©e
 *
	text2_u32_™”©e
;

127 
ext2_¡ruù_u32_li¡
 *
	tbadblocks_li¡
;

128 
ext2_¡ruù_u32_™”©e
 *
	tbadblocks_™”©e
;

130 
	#BADBLOCKS_FLAG_DIRTY
 1

	)

135 
	sext2_db_’Œy2
 {

136 
ext2_šo_t
 
šo
;

137 
blk64_t
 
blk
;

138 
e2_blkút_t
 
blockút
;

142 
	sext2_db_’Œy
 {

143 
ext2_šo_t
 
šo
;

144 
blk_t
 
blk
;

145 
blockút
;

148 
ext2_¡ruù_dbli¡
 *
	text2_dbli¡
;

150 
	#DBLIST_ABORT
 1

	)

156 
	#EXT2_FILE_WRITE
 0x0001

	)

157 
	#EXT2_FILE_CREATE
 0x0002

	)

159 
	#EXT2_FILE_MASK
 0x00FF

	)

161 
	#EXT2_FILE_BUF_DIRTY
 0x4000

	)

162 
	#EXT2_FILE_BUF_VALID
 0x2000

	)

164 
ext2_fe
 *
	text2_fe_t
;

166 
	#EXT2_SEEK_SET
 0

	)

167 
	#EXT2_SEEK_CUR
 1

	)

168 
	#EXT2_SEEK_END
 2

	)

173 
	#EXT2_FLAG_RW
 0x01

	)

174 
	#EXT2_FLAG_CHANGED
 0x02

	)

175 
	#EXT2_FLAG_DIRTY
 0x04

	)

176 
	#EXT2_FLAG_VALID
 0x08

	)

177 
	#EXT2_FLAG_IB_DIRTY
 0x10

	)

178 
	#EXT2_FLAG_BB_DIRTY
 0x20

	)

179 
	#EXT2_FLAG_SWAP_BYTES
 0x40

	)

180 
	#EXT2_FLAG_SWAP_BYTES_READ
 0x80

	)

181 
	#EXT2_FLAG_SWAP_BYTES_WRITE
 0x100

	)

182 
	#EXT2_FLAG_MASTER_SB_ONLY
 0x200

	)

183 
	#EXT2_FLAG_FORCE
 0x400

	)

184 
	#EXT2_FLAG_SUPER_ONLY
 0x800

	)

185 
	#EXT2_FLAG_JOURNAL_DEV_OK
 0x1000

	)

186 
	#EXT2_FLAG_IMAGE_FILE
 0x2000

	)

187 
	#EXT2_FLAG_EXCLUSIVE
 0x4000

	)

188 
	#EXT2_FLAG_SOFTSUPP_FEATURES
 0x8000

	)

189 
	#EXT2_FLAG_NOFREE_ON_ERROR
 0x10000

	)

190 
	#EXT2_FLAG_64BITS
 0x20000

	)

191 
	#EXT2_FLAG_PRINT_PROGRESS
 0x40000

	)

192 
	#EXT2_FLAG_DIRECT_IO
 0x80000

	)

193 
	#EXT2_FLAG_SKIP_MMP
 0x100000

	)

199 
	#EXT2_NEW_INODE_FL
 0x80000000

	)

204 
	#EXT2_MKJOURNAL_V1_SUPER
 0x0000001

	)

205 
	#EXT2_MKJOURNAL_LAZYINIT
 0x0000002

	)

206 
	#EXT2_MKJOURNAL_NO_MNT_CHECK
 0x0000004

	)

208 
İaque_ext2_group_desc
;

210 
	s¡ruù_ext2_fsys
 {

211 
”rcode_t
 
magic
;

212 
io_chªÃl
 
io
;

213 
æags
;

214 * 
deviû_Çme
;

215 
ext2_su³r_block
 * 
su³r
;

216 
blocksize
;

217 
äagsize
;

218 
dg½_t
 
group_desc_couÁ
;

219 
desc_blocks
;

220 
İaque_ext2_group_desc
 * 
group_desc
;

221 
šode_blocks_³r_group
;

222 
ext2fs_šode_b™m­
 
šode_m­
;

223 
ext2fs_block_b™m­
 
block_m­
;

225 
”rcode_t
 (*
g‘_blocks
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
blk_t
 *
blocks
);

226 
”rcode_t
 (*
check_dœeùÜy
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

227 
”rcode_t
 (*
wr™e_b™m­s
)(
ext2_fsys
 
fs
);

228 
”rcode_t
 (*
»ad_šode
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

229 
ext2_šode
 *
šode
);

230 
”rcode_t
 (*
wr™e_šode
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

231 
ext2_šode
 *
šode
);

232 
ext2_badblocks_li¡
 
badblocks
;

233 
ext2_dbli¡
 
dbli¡
;

234 
__u32
 
¡ride
;

235 
ext2_su³r_block
 * 
Üig_su³r
;

236 
ext2_image_hdr
 * 
image_h—d”
;

237 
__u32
 
umask
;

238 
time_t
 
now
;

239 
şu¡”_¿tio_b™s
;

240 
__u16
 
deçuÉ_b™m­_ty³
;

241 
__u16
 
·d
;

245 
__u32
 
»£rved
[5];

250 * 
´iv_d©a
;

255 
ext2_šode_ÿche
 *
iÿche
;

256 
io_chªÃl
 
image_io
;

261 
”rcode_t
 (*
g‘_®loc_block
)(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

262 
blk64_t
 *
»t
);

263 (*
block_®loc_¡©s
)(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
šu£
);

268 *
mmp_buf
;

269 *
mmp_cmp
;

270 
mmp_fd
;

275 
mmp_Ï¡_wr™‹n
;

278 #ià
EXT2_FLAT_INCLUDES


279 
	~"e2_b™İs.h
"

281 
	~<ext2fs/b™İs.h
>

287 
	#EXT2FS_BMAP64_BITARRAY
 1

	)

288 
	#EXT2FS_BMAP64_RBTREE
 2

	)

289 
	#EXT2FS_BMAP64_AUTODIR
 3

	)

294 
	#BLOCK_CHANGED
 1

	)

295 
	#BLOCK_ABORT
 2

	)

296 
	#BLOCK_ERROR
 4

	)

322 
	#BLOCK_FLAG_APPEND
 1

	)

323 
	#BLOCK_FLAG_HOLE
 1

	)

324 
	#BLOCK_FLAG_DEPTH_TRAVERSE
 2

	)

325 
	#BLOCK_FLAG_DATA_ONLY
 4

	)

326 
	#BLOCK_FLAG_READ_ONLY
 8

	)

328 
	#BLOCK_FLAG_NO_LARGE
 0x1000

	)

333 
	#BLOCK_COUNT_IND
 (-1)

	)

334 
	#BLOCK_COUNT_DIND
 (-2)

	)

335 
	#BLOCK_COUNT_TIND
 (-3)

	)

336 
	#BLOCK_COUNT_TRANSLATOR
 (-4)

	)

342 
	#EXT2_BMOVE_GET_DBLIST
 0x0001

	)

343 
	#EXT2_BMOVE_DEBUG
 0x0002

	)

350 
	#EXT2_EXTENT_FLAGS_LEAF
 0x0001

	)

351 
	#EXT2_EXTENT_FLAGS_UNINIT
 0x0002

	)

352 
	#EXT2_EXTENT_FLAGS_SECOND_VISIT
 0x0004

	)

354 
	sext2fs_ex‹Á
 {

355 
blk64_t
 
e_pblk
;

356 
blk64_t
 
e_lblk
;

357 
__u32
 
e_Ën
;

358 
__u32
 
e_æags
;

361 
ext2_ex‹Á_hªdË
 *
	text2_ex‹Á_hªdË_t
;

362 
ext2_ex‹Á_·th
 *
	text2_ex‹Á_·th_t
;

367 
	#EXT2_EXTENT_CURRENT
 0x0000

	)

368 
	#EXT2_EXTENT_MOVE_MASK
 0x000F

	)

369 
	#EXT2_EXTENT_ROOT
 0x0001

	)

370 
	#EXT2_EXTENT_LAST_LEAF
 0x0002

	)

371 
	#EXT2_EXTENT_FIRST_SIB
 0x0003

	)

372 
	#EXT2_EXTENT_LAST_SIB
 0x0004

	)

373 
	#EXT2_EXTENT_NEXT_SIB
 0x0005

	)

374 
	#EXT2_EXTENT_PREV_SIB
 0x0006

	)

375 
	#EXT2_EXTENT_NEXT_LEAF
 0x0007

	)

376 
	#EXT2_EXTENT_PREV_LEAF
 0x0008

	)

377 
	#EXT2_EXTENT_NEXT
 0x0009

	)

378 
	#EXT2_EXTENT_PREV
 0x000A

	)

379 
	#EXT2_EXTENT_UP
 0x000B

	)

380 
	#EXT2_EXTENT_DOWN
 0x000C

	)

381 
	#EXT2_EXTENT_DOWN_AND_LAST
 0x000D

	)

386 
	#EXT2_EXTENT_INSERT_AFTER
 0x0001

	)

387 
	#EXT2_EXTENT_INSERT_NOSPLIT
 0x0002

	)

392 
	#EXT2_EXTENT_DELETE_KEEP_EMPTY
 0x001

	)

397 
	#EXT2_EXTENT_SET_BMAP_UNINIT
 0x0001

	)

402 
	sext2_ex‹Á_šfo
 {

403 
cu¼_’Œy
;

404 
cu¼_Ëv–
;

405 
num_’Œ›s
;

406 
max_’Œ›s
;

407 
max_d•th
;

408 
by‹s_ava
;

409 
blk64_t
 
max_lblk
;

410 
blk64_t
 
max_pblk
;

411 
__u32
 
max_Ën
;

412 
__u32
 
max_unš™_Ën
;

418 
	#EXT2_DIRBLOCK_V2_STRUCT
 0x0001

	)

423 
	#DIRENT_CHANGED
 1

	)

424 
	#DIRENT_ABORT
 2

	)

425 
	#DIRENT_ERROR
 3

	)

431 
	#DIRENT_FLAG_INCLUDE_EMPTY
 1

	)

432 
	#DIRENT_FLAG_INCLUDE_REMOVED
 2

	)

434 
	#DIRENT_DOT_FILE
 1

	)

435 
	#DIRENT_DOT_DOT_FILE
 2

	)

436 
	#DIRENT_OTHER_FILE
 3

	)

437 
	#DIRENT_DELETED_FILE
 4

	)

442 
ext2_¡ruù_šode_sÿn
 *
	text2_šode_sÿn
;

447 
	#EXT2_SF_CHK_BADBLOCKS
 0x0001

	)

448 
	#EXT2_SF_BAD_INODE_BLK
 0x0002

	)

449 
	#EXT2_SF_BAD_EXTRA_BYTES
 0x0004

	)

450 
	#EXT2_SF_SKIP_MISSING_ITABLE
 0x0008

	)

451 
	#EXT2_SF_DO_LAZY
 0x0010

	)

456 
	#EXT2_MF_MOUNTED
 1

	)

457 
	#EXT2_MF_ISROOT
 2

	)

458 
	#EXT2_MF_READONLY
 4

	)

459 
	#EXT2_MF_SWAP
 8

	)

460 
	#EXT2_MF_BUSY
 16

	)

467 
	#LINUX_S_IFMT
 00170000

	)

468 
	#LINUX_S_IFSOCK
 0140000

	)

469 
	#LINUX_S_IFLNK
 0120000

	)

470 
	#LINUX_S_IFREG
 0100000

	)

471 
	#LINUX_S_IFBLK
 0060000

	)

472 
	#LINUX_S_IFDIR
 0040000

	)

473 
	#LINUX_S_IFCHR
 0020000

	)

474 
	#LINUX_S_IFIFO
 0010000

	)

475 
	#LINUX_S_ISUID
 0004000

	)

476 
	#LINUX_S_ISGID
 0002000

	)

477 
	#LINUX_S_ISVTX
 0001000

	)

479 
	#LINUX_S_IRWXU
 00700

	)

480 
	#LINUX_S_IRUSR
 00400

	)

481 
	#LINUX_S_IWUSR
 00200

	)

482 
	#LINUX_S_IXUSR
 00100

	)

484 
	#LINUX_S_IRWXG
 00070

	)

485 
	#LINUX_S_IRGRP
 00040

	)

486 
	#LINUX_S_IWGRP
 00020

	)

487 
	#LINUX_S_IXGRP
 00010

	)

489 
	#LINUX_S_IRWXO
 00007

	)

490 
	#LINUX_S_IROTH
 00004

	)

491 
	#LINUX_S_IWOTH
 00002

	)

492 
	#LINUX_S_IXOTH
 00001

	)

494 
	#LINUX_S_ISLNK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFLNK
)

	)

495 
	#LINUX_S_ISREG
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFREG
)

	)

496 
	#LINUX_S_ISDIR
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFDIR
)

	)

497 
	#LINUX_S_ISCHR
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFCHR
)

	)

498 
	#LINUX_S_ISBLK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFBLK
)

	)

499 
	#LINUX_S_ISFIFO
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFIFO
)

	)

500 
	#LINUX_S_ISSOCK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFSOCK
)

	)

505 
	#EXT2_I_SIZE
(
i
è((i)->
i_size
 | ((
__u64
è(i)->
i_size_high
 << 32))

	)

510 
	#EXT2_ICOUNT_OPT_INCREMENT
 0x01

	)

512 
ext2_icouÁ
 *
	text2_icouÁ_t
;

517 
	#BMAP_ALLOC
 0x0001

	)

518 
	#BMAP_SET
 0x0002

	)

523 
	#BMAP_RET_UNINIT
 0x0001

	)

528 
	#IMAGER_FLAG_INODEMAP
 1

	)

529 
	#IMAGER_FLAG_SPARSEWRITE
 2

	)

535 
	#EXT2_CHECK_MAGIC
(, 
code
) \

536 ià(()->
magic
 !ğ(
code
)è (code)

	)

542 
	#EXT2FS_COMPRESSED_BLKADDR
 ((
blk_t
è-1)

	)

543 
	#HOLE_BLKADDR
(
_b
è((_bè=ğ0 || (_bè=ğ
EXT2FS_COMPRESSED_BLKADDR
)

	)

548 
	#EXT2_LIB_FEATURE_COMPAT_SUPP
 (
EXT2_FEATURE_COMPAT_DIR_PREALLOC
|\

549 
EXT2_FEATURE_COMPAT_IMAGIC_INODES
|\

550 
EXT3_FEATURE_COMPAT_HAS_JOURNAL
|\

551 
EXT2_FEATURE_COMPAT_RESIZE_INODE
|\

552 
EXT2_FEATURE_COMPAT_DIR_INDEX
|\

553 
EXT2_FEATURE_COMPAT_EXT_ATTR
)

	)

556 #ifdeà
ENABLE_COMPRESSION


557 #iâdeà
I_KNOW_THAT_COMPRESSION_IS_EXPERIMENTAL


563 
	#EXT2_LIB_FEATURE_INCOMPAT_SUPP
 (
EXT2_FEATURE_INCOMPAT_FILETYPE
|\

564 
EXT2_FEATURE_INCOMPAT_COMPRESSION
|\

565 
EXT3_FEATURE_INCOMPAT_JOURNAL_DEV
|\

566 
EXT2_FEATURE_INCOMPAT_META_BG
|\

567 
EXT3_FEATURE_INCOMPAT_RECOVER
|\

568 
EXT3_FEATURE_INCOMPAT_EXTENTS
|\

569 
EXT4_FEATURE_INCOMPAT_FLEX_BG
|\

570 
EXT4_FEATURE_INCOMPAT_MMP
|\

571 
EXT4_FEATURE_INCOMPAT_64BIT
)

	)

573 
	#EXT2_LIB_FEATURE_INCOMPAT_SUPP
 (
EXT2_FEATURE_INCOMPAT_FILETYPE
|\

574 
EXT3_FEATURE_INCOMPAT_JOURNAL_DEV
|\

575 
EXT2_FEATURE_INCOMPAT_META_BG
|\

576 
EXT3_FEATURE_INCOMPAT_RECOVER
|\

577 
EXT3_FEATURE_INCOMPAT_EXTENTS
|\

578 
EXT4_FEATURE_INCOMPAT_FLEX_BG
|\

579 
EXT4_FEATURE_INCOMPAT_MMP
|\

580 
EXT4_FEATURE_INCOMPAT_64BIT
)

	)

582 #ifdeà
CONFIG_QUOTA


583 
	#EXT2_LIB_FEATURE_RO_COMPAT_SUPP
 (
EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER
|\

584 
EXT4_FEATURE_RO_COMPAT_HUGE_FILE
|\

585 
EXT2_FEATURE_RO_COMPAT_LARGE_FILE
|\

586 
EXT4_FEATURE_RO_COMPAT_DIR_NLINK
|\

587 
EXT4_FEATURE_RO_COMPAT_EXTRA_ISIZE
|\

588 
EXT4_FEATURE_RO_COMPAT_GDT_CSUM
|\

589 
EXT4_FEATURE_RO_COMPAT_BIGALLOC
|\

590 
EXT4_FEATURE_RO_COMPAT_QUOTA
)

	)

592 
	#EXT2_LIB_FEATURE_RO_COMPAT_SUPP
 (
EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER
|\

593 
EXT4_FEATURE_RO_COMPAT_HUGE_FILE
|\

594 
EXT2_FEATURE_RO_COMPAT_LARGE_FILE
|\

595 
EXT4_FEATURE_RO_COMPAT_DIR_NLINK
|\

596 
EXT4_FEATURE_RO_COMPAT_EXTRA_ISIZE
|\

597 
EXT4_FEATURE_RO_COMPAT_GDT_CSUM
|\

598 
EXT4_FEATURE_RO_COMPAT_BIGALLOC
)

	)

605 
	#EXT2_LIB_SOFTSUPP_INCOMPAT
 (0)

	)

606 
	#EXT2_LIB_SOFTSUPP_RO_COMPAT
 (
EXT4_FEATURE_RO_COMPAT_REPLICA
)

	)

610 
	#EXT2FS_CLUSTER_RATIO
(
fs
è(1 << (fs)->
şu¡”_¿tio_b™s
)

	)

611 
	#EXT2FS_CLUSTER_MASK
(
fs
è(
	`EXT2FS_CLUSTER_RATIO
(fsè- 1)

	)

612 
	#EXT2FS_B2C
(
fs
, 
blk
è((blkè>> (fs)->
şu¡”_¿tio_b™s
)

	)

614 
	#EXT2FS_C2B
(
fs
, 
şu¡”
è((şu¡”è<< (fs)->
şu¡”_¿tio_b™s
)

	)

616 
	#EXT2FS_NUM_B2C
(
fs
, 
blks
è(((blksè+ 
	`EXT2FS_CLUSTER_MASK
(fs)) >> \

617 (
fs
)->
şu¡”_¿tio_b™s
)

	)

619 #ià
defšed
(
HAVE_FSTAT64
è&& !defšed(
__OSX_AVAILABLE_BUT_DEPRECATED
)

620 
¡©64
 
	text2fs_¡ruù_¡©
;

622 
¡©
 
	text2fs_¡ruù_¡©
;

629 
	#EXT2_FLAG_FLUSH_NO_SYNC
 1

	)

636 
šlše
 
ext2fs_Ãeds_Ïrge_fe_ã©u»
(
fe_size
)

638  
fe_size
 >= 0x80000000ULL;

642 
”rcode_t
 
ext2fs_Ãw_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, 
mode
,

643 
ext2fs_šode_b™m­
 
m­
, 
ext2_šo_t
 *
»t
);

644 
”rcode_t
 
ext2fs_Ãw_block
(
ext2_fsys
 
fs
, 
blk_t
 
gßl
,

645 
ext2fs_block_b™m­
 
m­
, 
blk_t
 *
»t
);

646 
”rcode_t
 
ext2fs_Ãw_block2
(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

647 
ext2fs_block_b™m­
 
m­
, 
blk64_t
 *
»t
);

648 
”rcode_t
 
ext2fs_g‘_ä“_blocks
(
ext2_fsys
 
fs
, 
blk_t
 
¡¬t
,

649 
blk_t
 
fšish
, 
num
,

650 
ext2fs_block_b™m­
 
m­
,

651 
blk_t
 *
»t
);

652 
”rcode_t
 
ext2fs_g‘_ä“_blocks2
(
ext2_fsys
 
fs
, 
blk64_t
 
¡¬t
,

653 
blk64_t
 
fšish
, 
num
,

654 
ext2fs_block_b™m­
 
m­
,

655 
blk64_t
 *
»t
);

656 
”rcode_t
 
ext2fs_®loc_block
(
ext2_fsys
 
fs
, 
blk_t
 
gßl
,

657 *
block_buf
, 
blk_t
 *
»t
);

658 
”rcode_t
 
ext2fs_®loc_block2
(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

659 *
block_buf
, 
blk64_t
 *
»t
);

660 
ext2fs_£t_®loc_block_ÿÎback
(
ext2_fsys
 
fs
,

661 
”rcode_t
 (*
func
)(
ext2_fsys
 
fs
,

662 
blk64_t
 
gßl
,

663 
blk64_t
 *
»t
),

664 
”rcode_t
 (**
Şd
)(
ext2_fsys
 
fs
,

665 
blk64_t
 
gßl
,

666 
blk64_t
 *
»t
));

669 
ext2fs_»£rve_su³r_ªd_bgd
(
ext2_fsys
 
fs
,

670 
dg½_t
 
group
,

671 
ext2fs_block_b™m­
 
bm­
);

672 
ext2fs_£t_block_®loc_¡©s_ÿÎback
(
ext2_fsys
 
fs
,

673 (*
func
)(
ext2_fsys
 
fs
,

674 
blk64_t
 
blk
,

675 
šu£
),

676 (**
Şd
)(
ext2_fsys
 
fs
,

677 
blk64_t
 
blk
,

678 
šu£
));

681 
ext2fs_šode_®loc_¡©s
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
šu£
);

682 
ext2fs_šode_®loc_¡©s2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

683 
šu£
, 
isdœ
);

684 
ext2fs_block_®loc_¡©s
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, 
šu£
);

685 
ext2fs_block_®loc_¡©s2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
šu£
);

688 
”rcode_t
 
ext2fs_®loÿ‹_bËs
(
ext2_fsys
 
fs
);

689 
”rcode_t
 
ext2fs_®loÿ‹_group_bË
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

690 
ext2fs_block_b™m­
 
bm­
);

693 
”rcode_t
 
ext2fs_u32_li¡_ü—‹
(
ext2_u32_li¡
 *
»t
, 
size
);

694 
”rcode_t
 
ext2fs_u32_li¡_add
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

695 
ext2fs_u32_li¡_fšd
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

696 
ext2fs_u32_li¡_‹¡
(
ext2_u32_li¡
 
bb
, 
blk_t
 
blk
);

697 
”rcode_t
 
ext2fs_u32_li¡_™”©e_begš
(
ext2_u32_li¡
 
bb
,

698 
ext2_u32_™”©e
 *
»t
);

699 
ext2fs_u32_li¡_™”©e
(
ext2_u32_™”©e
 
™”
, 
blk_t
 *
blk
);

700 
ext2fs_u32_li¡_™”©e_’d
(
ext2_u32_™”©e
 
™”
);

701 
”rcode_t
 
ext2fs_u32_cİy
(
ext2_u32_li¡
 
¤c
,ƒxt2_u32_li¡ *
de¡
);

702 
ext2fs_u32_li¡_equ®
(
ext2_u32_li¡
 
bb1
,ƒxt2_u32_li¡ 
bb2
);

704 
”rcode_t
 
ext2fs_badblocks_li¡_ü—‹
(
ext2_badblocks_li¡
 *
»t
,

705 
size
);

706 
”rcode_t
 
ext2fs_badblocks_li¡_add
(
ext2_badblocks_li¡
 
bb
,

707 
blk_t
 
blk
);

708 
ext2fs_badblocks_li¡_‹¡
(
ext2_badblocks_li¡
 
bb
,

709 
blk_t
 
blk
);

710 
ext2fs_u32_li¡_d–
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

711 
ext2fs_badblocks_li¡_d–
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

712 
”rcode_t


713 
ext2fs_badblocks_li¡_™”©e_begš
(
ext2_badblocks_li¡
 
bb
,

714 
ext2_badblocks_™”©e
 *
»t
);

715 
ext2fs_badblocks_li¡_™”©e
(
ext2_badblocks_™”©e
 
™”
,

716 
blk_t
 *
blk
);

717 
ext2fs_badblocks_li¡_™”©e_’d
(
ext2_badblocks_™”©e
 
™”
);

718 
”rcode_t
 
ext2fs_badblocks_cİy
(
ext2_badblocks_li¡
 
¤c
,

719 
ext2_badblocks_li¡
 *
de¡
);

720 
ext2fs_badblocks_equ®
(
ext2_badblocks_li¡
 
bb1
,

721 
ext2_badblocks_li¡
 
bb2
);

722 
ext2fs_u32_li¡_couÁ
(
ext2_u32_li¡
 
bb
);

725 
”rcode_t
 
badblocks_li¡_ü—‹
(
badblocks_li¡
 *
»t
, 
size
);

726 
”rcode_t
 
badblocks_li¡_add
(
badblocks_li¡
 
bb
, 
blk_t
 
blk
);

727 
badblocks_li¡_‹¡
(
badblocks_li¡
 
bb
, 
blk_t
 
blk
);

728 
”rcode_t
 
badblocks_li¡_™”©e_begš
(
badblocks_li¡
 
bb
,

729 
badblocks_™”©e
 *
»t
);

730 
badblocks_li¡_™”©e
(
badblocks_™”©e
 
™”
, 
blk_t
 *
blk
);

731 
badblocks_li¡_™”©e_’d
(
badblocks_™”©e
 
™”
);

732 
badblocks_li¡_ä“
(
badblocks_li¡
 
bb
);

735 
”rcode_t
 
ext2fs_upd©e_bb_šode
(
ext2_fsys
 
fs
,

736 
ext2_badblocks_li¡
 
bb_li¡
);

739 
ext2fs_ä“_block_b™m­
(
ext2fs_block_b™m­
 
b™m­
);

740 
ext2fs_ä“_šode_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

741 
”rcode_t
 
ext2fs_cİy_b™m­
(
ext2fs_g’”ic_b™m­
 
¤c
,

742 
ext2fs_g’”ic_b™m­
 *
de¡
);

743 
”rcode_t
 
ext2fs_wr™e_šode_b™m­
(
ext2_fsys
 
fs
);

744 
”rcode_t
 
ext2fs_wr™e_block_b™m­
 (
ext2_fsys
 
fs
);

745 
”rcode_t
 
ext2fs_»ad_šode_b™m­
 (
ext2_fsys
 
fs
);

746 
”rcode_t
 
ext2fs_»ad_block_b™m­
(
ext2_fsys
 
fs
);

747 
”rcode_t
 
ext2fs_®loÿ‹_block_b™m­
(
ext2_fsys
 
fs
,

748 cÚ¡ *
desü
,

749 
ext2fs_block_b™m­
 *
»t
);

750 
”rcode_t
 
ext2fs_®loÿ‹_subşu¡”_b™m­
(
ext2_fsys
 
fs
,

751 cÚ¡ *
desü
,

752 
ext2fs_block_b™m­
 *
»t
);

753 
ext2fs_g‘_b™m­_g¿nuÏr™y
(
ext2fs_block_b™m­
 
b™m­
);

754 
”rcode_t
 
ext2fs_®loÿ‹_šode_b™m­
(
ext2_fsys
 
fs
,

755 cÚ¡ *
desü
,

756 
ext2fs_šode_b™m­
 *
»t
);

757 
”rcode_t
 
ext2fs_fudge_šode_b™m­_’d
(
ext2fs_šode_b™m­
 
b™m­
,

758 
ext2_šo_t
 
’d
,ƒxt2_šo_ˆ*
Ûnd
);

759 
”rcode_t
 
ext2fs_fudge_block_b™m­_’d
(
ext2fs_block_b™m­
 
b™m­
,

760 
blk_t
 
’d
, blk_ˆ*
Ûnd
);

761 
”rcode_t
 
ext2fs_fudge_block_b™m­_’d2
(
ext2fs_block_b™m­
 
b™m­
,

762 
blk64_t
 
’d
, blk64_ˆ*
Ûnd
);

763 
ext2fs_ş—r_šode_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

764 
ext2fs_ş—r_block_b™m­
(
ext2fs_block_b™m­
 
b™m­
);

765 
”rcode_t
 
ext2fs_»ad_b™m­s
(
ext2_fsys
 
fs
);

766 
”rcode_t
 
ext2fs_wr™e_b™m­s
(
ext2_fsys
 
fs
);

767 
”rcode_t
 
ext2fs_»size_šode_b™m­
(
__u32
 
Ãw_’d
, __u32 
Ãw_»®_’d
,

768 
ext2fs_šode_b™m­
 
bm­
);

769 
”rcode_t
 
ext2fs_»size_šode_b™m­2
(
__u64
 
Ãw_’d
,

770 
__u64
 
Ãw_»®_’d
,

771 
ext2fs_šode_b™m­
 
bm­
);

772 
”rcode_t
 
ext2fs_»size_block_b™m­
(
__u32
 
Ãw_’d
, __u32 
Ãw_»®_’d
,

773 
ext2fs_block_b™m­
 
bm­
);

774 
”rcode_t
 
ext2fs_»size_block_b™m­2
(
__u64
 
Ãw_’d
,

775 
__u64
 
Ãw_»®_’d
,

776 
ext2fs_block_b™m­
 
bm­
);

777 
”rcode_t
 
ext2fs_com·»_block_b™m­
(
ext2fs_block_b™m­
 
bm1
,

778 
ext2fs_block_b™m­
 
bm2
);

779 
”rcode_t
 
ext2fs_com·»_šode_b™m­
(
ext2fs_šode_b™m­
 
bm1
,

780 
ext2fs_šode_b™m­
 
bm2
);

781 
”rcode_t
 
ext2fs_£t_šode_b™m­_¿nge
(
ext2fs_šode_b™m­
 
bm­
,

782 
ext2_šo_t
 
¡¬t
, 
num
,

783 *
š
);

784 
”rcode_t
 
ext2fs_£t_šode_b™m­_¿nge2
(
ext2fs_šode_b™m­
 
bm­
,

785 
__u64
 
¡¬t
, 
size_t
 
num
,

786 *
š
);

787 
”rcode_t
 
ext2fs_g‘_šode_b™m­_¿nge
(
ext2fs_šode_b™m­
 
bm­
,

788 
ext2_šo_t
 
¡¬t
, 
num
,

789 *
out
);

790 
”rcode_t
 
ext2fs_g‘_šode_b™m­_¿nge2
(
ext2fs_šode_b™m­
 
bm­
,

791 
__u64
 
¡¬t
, 
size_t
 
num
,

792 *
out
);

793 
”rcode_t
 
ext2fs_£t_block_b™m­_¿nge
(
ext2fs_block_b™m­
 
bm­
,

794 
blk_t
 
¡¬t
, 
num
,

795 *
š
);

796 
”rcode_t
 
ext2fs_£t_block_b™m­_¿nge2
(
ext2fs_block_b™m­
 
bm­
,

797 
blk64_t
 
¡¬t
, 
size_t
 
num
,

798 *
š
);

799 
”rcode_t
 
ext2fs_g‘_block_b™m­_¿nge
(
ext2fs_block_b™m­
 
bm­
,

800 
blk_t
 
¡¬t
, 
num
,

801 *
out
);

802 
”rcode_t
 
ext2fs_g‘_block_b™m­_¿nge2
(
ext2fs_block_b™m­
 
bm­
,

803 
blk64_t
 
¡¬t
, 
size_t
 
num
,

804 *
out
);

807 
dg½_t
 
ext2fs_group_of_blk2
(
ext2_fsys
 
fs
, 
blk64_t
);

808 
blk64_t
 
ext2fs_group_fœ¡_block2
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

809 
blk64_t
 
ext2fs_group_Ï¡_block2
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

810 
ext2fs_group_blocks_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

811 
blk64_t
 
ext2fs_šode_d©a_blocks2
(
ext2_fsys
 
fs
,

812 
ext2_šode
 *
šode
);

813 
blk64_t
 
ext2fs_šode_i_blocks
(
ext2_fsys
 
fs
,

814 
ext2_šode
 *
šode
);

815 
blk64_t
 
ext2fs_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

816 
ext2fs_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

817 
blk64_t
 
blk
);

818 
ext2fs_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

819 
blk64_t
 
blk
);

820 
blk64_t
 
ext2fs_r_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

821 
ext2fs_r_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

822 
blk64_t
 
blk
);

823 
ext2fs_r_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

824 
blk64_t
 
blk
);

825 
blk64_t
 
ext2fs_ä“_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

826 
ext2fs_ä“_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

827 
blk64_t
 
blk
);

828 
ext2fs_ä“_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

829 
blk64_t
 
blk
);

831 
ext2_group_desc
 *
ext2fs_group_desc
(
ext2_fsys
 
fs
,

832 
İaque_ext2_group_desc
 *
gdp
,

833 
dg½_t
 
group
);

834 
blk64_t
 
ext2fs_block_b™m­_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

835 
ext2fs_block_b™m­_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

836 
blk64_t
 
blk
);

837 
blk64_t
 
ext2fs_šode_b™m­_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

838 
ext2fs_šode_b™m­_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

839 
blk64_t
 
blk
);

840 
blk64_t
 
ext2fs_šode_bË_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

841 
ext2fs_šode_bË_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

842 
blk64_t
 
blk
);

843 
__u32
 
ext2fs_bg_ä“_blocks_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

844 
ext2fs_bg_ä“_blocks_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

845 
__u32
 
n
);

846 
__u32
 
ext2fs_bg_ä“_šodes_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

847 
ext2fs_bg_ä“_šodes_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

848 
__u32
 
n
);

849 
__u32
 
ext2fs_bg_u£d_dœs_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

850 
ext2fs_bg_u£d_dœs_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

851 
__u32
 
n
);

852 
__u32
 
ext2fs_bg_™abË_unu£d
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

853 
ext2fs_bg_™abË_unu£d_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

854 
__u32
 
n
);

855 
__u16
 
ext2fs_bg_æags
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

856 
ext2fs_bg_æags_z­
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

857 
ext2fs_bg_æags_‹¡
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æag
);

858 
ext2fs_bg_æags_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æags
);

859 
ext2fs_bg_æags_ş—r
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æags
);

860 
__u16
 
ext2fs_bg_checksum
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

861 
ext2fs_bg_checksum_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
checksum
);

862 
blk64_t
 
ext2fs_fe_aş_block
(
ext2_fsys
 
fs
,

863 cÚ¡ 
ext2_šode
 *
šode
);

864 
ext2fs_fe_aş_block_£t
(
ext2_fsys
 
fs
,

865 
ext2_šode
 *
šode
, 
blk64_t
 
blk
);

868 
”rcode_t
 
ext2fs_block_™”©e
(
ext2_fsys
 
fs
,

869 
ext2_šo_t
 
šo
,

870 
æags
,

871 *
block_buf
,

872 (*
func
)(
ext2_fsys
 
fs
,

873 
blk_t
 *
blockÄ
,

874 
blockút
,

875 *
´iv_d©a
),

876 *
´iv_d©a
);

877 
”rcode_t
 
ext2fs_block_™”©e2
(
ext2_fsys
 
fs
,

878 
ext2_šo_t
 
šo
,

879 
æags
,

880 *
block_buf
,

881 (*
func
)(
ext2_fsys
 
fs
,

882 
blk_t
 *
blockÄ
,

883 
e2_blkút_t
 
blockút
,

884 
blk_t
 
»f_blk
,

885 
»f_off£t
,

886 *
´iv_d©a
),

887 *
´iv_d©a
);

888 
”rcode_t
 
ext2fs_block_™”©e3
(
ext2_fsys
 
fs
,

889 
ext2_šo_t
 
šo
,

890 
æags
,

891 *
block_buf
,

892 (*
func
)(
ext2_fsys
 
fs
,

893 
blk64_t
 *
blockÄ
,

894 
e2_blkút_t
 
blockút
,

895 
blk64_t
 
»f_blk
,

896 
»f_off£t
,

897 *
´iv_d©a
),

898 *
´iv_d©a
);

901 
”rcode_t
 
ext2fs_bm­
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

902 
ext2_šode
 *
šode
,

903 *
block_buf
, 
bm­_æags
,

904 
blk_t
 
block
, blk_ˆ*
phys_blk
);

905 
”rcode_t
 
ext2fs_bm­2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

906 
ext2_šode
 *
šode
,

907 *
block_buf
, 
bm­_æags
, 
blk64_t
 
block
,

908 *
»t_æags
, 
blk64_t
 *
phys_blk
);

909 
”rcode_t
 
ext2fs_m­_şu¡”_block
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

910 
ext2_šode
 *
šode
, 
blk64_t
 
lblk
,

911 
blk64_t
 *
pblk
);

915 
”rcode_t
 
ext2fs_move_blocks
(
ext2_fsys
 
fs
,

916 
ext2fs_block_b™m­
 
»£rve
,

917 
ext2fs_block_b™m­
 
®loc_m­
,

918 
æags
);

922 
”rcode_t
 
ext2fs_check_desc
(
ext2_fsys
 
fs
);

925 
”rcode_t
 
ext2fs_şo£
(
ext2_fsys
 
fs
);

926 
”rcode_t
 
ext2fs_şo£2
(
ext2_fsys
 
fs
, 
æags
);

927 
”rcode_t
 
ext2fs_æush
(
ext2_fsys
 
fs
);

928 
”rcode_t
 
ext2fs_æush2
(
ext2_fsys
 
fs
, 
æags
);

929 
ext2fs_bg_has_su³r
(
ext2_fsys
 
fs
, 
dg½_t
 
group_block
);

930 
”rcode_t
 
ext2fs_su³r_ªd_bgd_loc2
(
ext2_fsys
 
fs
,

931 
dg½_t
 
group
,

932 
blk64_t
 *
»t_su³r_blk
,

933 
blk64_t
 *
»t_Şd_desc_blk
,

934 
blk64_t
 *
»t_Ãw_desc_blk
,

935 
blk_t
 *
»t_u£d_blks
);

936 
ext2fs_su³r_ªd_bgd_loc
(
ext2_fsys
 
fs
,

937 
dg½_t
 
group
,

938 
blk_t
 *
»t_su³r_blk
,

939 
blk_t
 *
»t_Şd_desc_blk
,

940 
blk_t
 *
»t_Ãw_desc_blk
,

941 *
»t_m‘a_bg
);

942 
ext2fs_upd©e_dyÇmic_»v
(
ext2_fsys
 
fs
);

945 
__u32
 
ext2fs_üc32c_be
(__u32 
üc
, cÚ¡ *
p
, 
size_t
 
Ën
);

946 
__u32
 
ext2fs_üc32c_Ë
(__u32 
üc
, cÚ¡ *
p
, 
size_t
 
Ën
);

949 
ext2fs_group_desc_csum_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

950 
ext2fs_group_desc_csum_v”ify
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

951 
”rcode_t
 
ext2fs_£t_gdt_csum
(
ext2_fsys
 
fs
);

952 
__u16
 
ext2fs_group_desc_csum
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

956 
”rcode_t
 
ext2fs_g‘_num_dœs
(
ext2_fsys
 
fs
, 
ext2_šo_t
 *
»t_num_dœs
);

957 
”rcode_t
 
ext2fs_š™_dbli¡
(
ext2_fsys
 
fs
, 
ext2_dbli¡
 *
»t_dbli¡
);

958 
”rcode_t
 
ext2fs_add_dœ_block
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

959 
blk_t
 
blk
, 
blockút
);

960 
”rcode_t
 
ext2fs_add_dœ_block2
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

961 
blk64_t
 
blk
, 
e2_blkút_t
 
blockút
);

962 
ext2fs_dbli¡_sÜt
(
ext2_dbli¡
 
dbli¡
,

963 
EXT2_QSORT_TYPE
 (*
sÜtfunc
)(const *,

965 
ext2fs_dbli¡_sÜt2
(
ext2_dbli¡
 
dbli¡
,

966 
EXT2_QSORT_TYPE
 (*
sÜtfunc
)(const *,

968 
”rcode_t
 
ext2fs_dbli¡_™”©e
(
ext2_dbli¡
 
dbli¡
,

969 (*
func
)(
ext2_fsys
 
fs
, 
ext2_db_’Œy
 *
db_šfo
,

970 *
´iv_d©a
),

971 *
´iv_d©a
);

972 
”rcode_t
 
ext2fs_dbli¡_™”©e2
(
ext2_dbli¡
 
dbli¡
,

973 (*
func
)(
ext2_fsys
 
fs
, 
ext2_db_’Œy2
 *
db_šfo
,

974 *
´iv_d©a
),

975 *
´iv_d©a
);

976 
”rcode_t
 
ext2fs_£t_dœ_block
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

977 
blk_t
 
blk
, 
blockút
);

978 
”rcode_t
 
ext2fs_£t_dœ_block2
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

979 
blk64_t
 
blk
, 
e2_blkút_t
 
blockút
);

980 
”rcode_t
 
ext2fs_cİy_dbli¡
(
ext2_dbli¡
 
¤c
,

981 
ext2_dbli¡
 *
de¡
);

982 
ext2fs_dbli¡_couÁ
(
ext2_dbli¡
 
dbli¡
);

983 
blk64_t
 
ext2fs_dbli¡_couÁ2
(
ext2_dbli¡
 
dbli¡
);

984 
”rcode_t
 
ext2fs_dbli¡_g‘_Ï¡
(
ext2_dbli¡
 
dbli¡
,

985 
ext2_db_’Œy
 **
’Œy
);

986 
”rcode_t
 
ext2fs_dbli¡_g‘_Ï¡2
(
ext2_dbli¡
 
dbli¡
,

987 
ext2_db_’Œy2
 **
’Œy
);

988 
”rcode_t
 
ext2fs_dbli¡_drİ_Ï¡
(
ext2_dbli¡
 
dbli¡
);

991 
”rcode_t


992 
ext2fs_dbli¡_dœ_™”©e
(
ext2_dbli¡
 
dbli¡
,

993 
æags
,

994 *
block_buf
,

995 (*
func
)(
ext2_šo_t
 
dœ
,

996 
’Œy
,

997 
ext2_dœ_’Œy
 *
dœ’t
,

998 
off£t
,

999 
blocksize
,

1000 *
buf
,

1001 *
´iv_d©a
),

1002 *
´iv_d©a
);

1005 
”rcode_t
 
ext2fs_»ad_dœ_block
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1006 *
buf
);

1007 
”rcode_t
 
ext2fs_»ad_dœ_block2
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1008 *
buf
, 
æags
);

1009 
”rcode_t
 
ext2fs_»ad_dœ_block3
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1010 *
buf
, 
æags
);

1011 
”rcode_t
 
ext2fs_wr™e_dœ_block
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1012 *
buf
);

1013 
”rcode_t
 
ext2fs_wr™e_dœ_block2
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1014 *
buf
, 
æags
);

1015 
”rcode_t
 
ext2fs_wr™e_dœ_block3
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1016 *
buf
, 
æags
);

1019 
”rcode_t
 
ext2fs_dœhash
(
v”siÚ
, cÚ¡ *
Çme
, 
Ën
,

1020 cÚ¡ 
__u32
 *
£ed
,

1021 
ext2_dœhash_t
 *
»t_hash
,

1022 
ext2_dœhash_t
 *
»t_mšÜ_hash
);

1026 
”rcode_t
 
ext2fs_g‘_»c_Ën
(
ext2_fsys
 
fs
,

1027 
ext2_dœ_’Œy
 *
dœ’t
,

1028 *
»c_Ën
);

1029 
”rcode_t
 
ext2fs_£t_»c_Ën
(
ext2_fsys
 
fs
,

1030 
Ën
,

1031 
ext2_dœ_’Œy
 *
dœ’t
);

1032 
”rcode_t
 
ext2fs_dœ_™”©e
(
ext2_fsys
 
fs
,

1033 
ext2_šo_t
 
dœ
,

1034 
æags
,

1035 *
block_buf
,

1036 (*
func
)(
ext2_dœ_’Œy
 *
dœ’t
,

1037 
off£t
,

1038 
blocksize
,

1039 *
buf
,

1040 *
´iv_d©a
),

1041 *
´iv_d©a
);

1042 
”rcode_t
 
ext2fs_dœ_™”©e2
(
ext2_fsys
 
fs
,

1043 
ext2_šo_t
 
dœ
,

1044 
æags
,

1045 *
block_buf
,

1046 (*
func
)(
ext2_šo_t
 
dœ
,

1047 
’Œy
,

1048 
ext2_dœ_’Œy
 *
dœ’t
,

1049 
off£t
,

1050 
blocksize
,

1051 *
buf
,

1052 *
´iv_d©a
),

1053 *
´iv_d©a
);

1056 
”rcode_t
 
ext2fs_dup_hªdË
(
ext2_fsys
 
¤c
,ƒxt2_fsy *
de¡
);

1059 
”rcode_t
 
ext2fs_ex·nd_dœ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
);

1062 
__u32
 
ext2fs_ext_©Œ_hash_’Œy
(
ext2_ext_©Œ_’Œy
 *
’Œy
,

1063 *
d©a
);

1064 
”rcode_t
 
ext2fs_»ad_ext_©Œ
(
ext2_fsys
 
fs
, 
blk_t
 
block
, *
buf
);

1065 
”rcode_t
 
ext2fs_»ad_ext_©Œ2
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1066 *
buf
);

1067 
”rcode_t
 
ext2fs_wr™e_ext_©Œ
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1068 *
buf
);

1069 
”rcode_t
 
ext2fs_wr™e_ext_©Œ2
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1070 *
buf
);

1071 
”rcode_t
 
ext2fs_adju¡_—_»fcouÁ
(
ext2_fsys
 
fs
, 
blk_t
 
blk
,

1072 *
block_buf
,

1073 
adju¡
, 
__u32
 *
ÃwcouÁ
);

1074 
”rcode_t
 
ext2fs_adju¡_—_»fcouÁ2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
,

1075 *
block_buf
,

1076 
adju¡
, 
__u32
 *
ÃwcouÁ
);

1079 
”rcode_t
 
ext2fs_ex‹Á_h—d”_v”ify
(*
±r
, 
size
);

1080 
”rcode_t
 
ext2fs_ex‹Á_İ’
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1081 
ext2_ex‹Á_hªdË_t
 *
hªdË
);

1082 
”rcode_t
 
ext2fs_ex‹Á_İ’2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1083 
ext2_šode
 *
šode
,

1084 
ext2_ex‹Á_hªdË_t
 *
»t_hªdË
);

1085 
ext2fs_ex‹Á_ä“
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1086 
”rcode_t
 
ext2fs_ex‹Á_g‘
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1087 
æags
, 
ext2fs_ex‹Á
 *
ex‹Á
);

1088 
”rcode_t
 
ext2fs_ex‹Á_node_¥l™
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1089 
”rcode_t
 
ext2fs_ex‹Á_»¶aû
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
,

1090 
ext2fs_ex‹Á
 *
ex‹Á
);

1091 
”rcode_t
 
ext2fs_ex‹Á_š£¹
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
,

1092 
ext2fs_ex‹Á
 *
ex‹Á
);

1093 
”rcode_t
 
ext2fs_ex‹Á_£t_bm­
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1094 
blk64_t
 
logiÿl
, blk64_ˆ
physiÿl
,

1095 
æags
);

1096 
”rcode_t
 
ext2fs_ex‹Á_d–‘e
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
);

1097 
”rcode_t
 
ext2fs_ex‹Á_g‘_šfo
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1098 
ext2_ex‹Á_šfo
 *
šfo
);

1099 
”rcode_t
 
ext2fs_ex‹Á_gÙo
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1100 
blk64_t
 
blk
);

1101 
”rcode_t
 
ext2fs_ex‹Á_gÙo2
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1102 
Ëaf_Ëv–
, 
blk64_t
 
blk
);

1103 
”rcode_t
 
ext2fs_ex‹Á_fix_·»Ás
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1106 
”rcode_t
 
ext2fs_fe_İ’2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1107 
ext2_šode
 *
šode
,

1108 
æags
, 
ext2_fe_t
 *
»t
);

1109 
”rcode_t
 
ext2fs_fe_İ’
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1110 
æags
, 
ext2_fe_t
 *
»t
);

1111 
ext2_fsys
 
ext2fs_fe_g‘_fs
(
ext2_fe_t
 
fe
);

1112 
ext2_šode
 *
ext2fs_fe_g‘_šode
(
ext2_fe_t
 
fe
);

1113 
ext2_šo_t
 
ext2fs_fe_g‘_šode_num
(
ext2_fe_t
 
fe
);

1114 
”rcode_t
 
ext2fs_fe_şo£
(
ext2_fe_t
 
fe
);

1115 
”rcode_t
 
ext2fs_fe_æush
(
ext2_fe_t
 
fe
);

1116 
”rcode_t
 
ext2fs_fe_»ad
(
ext2_fe_t
 
fe
, *
buf
,

1117 
wª‹d
, *
gÙ
);

1118 
”rcode_t
 
ext2fs_fe_wr™e
(
ext2_fe_t
 
fe
, cÚ¡ *
buf
,

1119 
nby‹s
, *
wr™‹n
);

1120 
”rcode_t
 
ext2fs_fe_Î£ek
(
ext2_fe_t
 
fe
, 
__u64
 
off£t
,

1121 
wh’û
, 
__u64
 *
»t_pos
);

1122 
”rcode_t
 
ext2fs_fe_l£ek
(
ext2_fe_t
 
fe
, 
ext2_off_t
 
off£t
,

1123 
wh’û
, 
ext2_off_t
 *
»t_pos
);

1124 
”rcode_t
 
ext2fs_fe_g‘_lsize
(
ext2_fe_t
 
fe
, 
__u64
 *
»t_size
);

1125 
ext2_off_t
 
ext2fs_fe_g‘_size
(
ext2_fe_t
 
fe
);

1126 
”rcode_t
 
ext2fs_fe_£t_size
(
ext2_fe_t
 
fe
, 
ext2_off_t
 
size
);

1127 
”rcode_t
 
ext2fs_fe_£t_size2
(
ext2_fe_t
 
fe
, 
ext2_off64_t
 
size
);

1130 *
ext2fs_fšd_block_deviû
(
dev_t
 
deviû
);

1133 
”rcode_t
 
ext2fs_sync_deviû
(
fd
, 
æushb
);

1136 
ext2fs_ä“
(
ext2_fsys
 
fs
);

1137 
ext2fs_ä“_dbli¡
(
ext2_dbli¡
 
dbli¡
);

1138 
ext2fs_badblocks_li¡_ä“
(
ext2_badblocks_li¡
 
bb
);

1139 
ext2fs_u32_li¡_ä“
(
ext2_u32_li¡
 
bb
);

1142 
ext2fs_ä“_g’”ic_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

1143 
”rcode_t
 
ext2fs_make_g’”ic_b™m­
Ó¼code_ˆ
magic
, 
ext2_fsys
 
fs
,

1144 
__u32
 
¡¬t
, __u32 
’d
,

1145 
__u32
 
»®_’d
,

1146 cÚ¡ *
desü
, *
š™_m­
,

1147 
ext2fs_g’”ic_b™m­
 *
»t
);

1148 
”rcode_t
 
ext2fs_®loÿ‹_g’”ic_b™m­
(
__u32
 
¡¬t
,

1149 
__u32
 
’d
,

1150 
__u32
 
»®_’d
,

1151 cÚ¡ *
desü
,

1152 
ext2fs_g’”ic_b™m­
 *
»t
);

1153 
”rcode_t
 
ext2fs_cİy_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
¤c
,

1154 
ext2fs_g’”ic_b™m­
 *
de¡
);

1155 
ext2fs_ş—r_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
b™m­
);

1156 
”rcode_t
 
ext2fs_fudge_g’”ic_b™m­_’d
(
ext2fs_šode_b™m­
 
b™m­
,

1157 
”rcode_t
 
magic
,

1158 
”rcode_t
 
Ãq
,

1159 
ext2_šo_t
 
’d
,

1160 
ext2_šo_t
 *
Ûnd
);

1161 
ext2fs_£t_g’”ic_b™m­_·ddšg
(
ext2fs_g’”ic_b™m­
 
m­
);

1162 
”rcode_t
 
ext2fs_»size_g’”ic_b™m­
Ó¼code_ˆ
magic
,

1163 
__u32
 
Ãw_’d
,

1164 
__u32
 
Ãw_»®_’d
,

1165 
ext2fs_g’”ic_b™m­
 
bm­
);

1166 
”rcode_t
 
ext2fs_com·»_g’”ic_b™m­
Ó¼code_ˆ
magic
,ƒ¼code_ˆ
Ãq
,

1167 
ext2fs_g’”ic_b™m­
 
bm1
,

1168 
ext2fs_g’”ic_b™m­
 
bm2
);

1169 
”rcode_t
 
ext2fs_g‘_g’”ic_b™m­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1170 
”rcode_t
 
magic
,

1171 
__u32
 
¡¬t
, __u32 
num
,

1172 *
out
);

1173 
”rcode_t
 
ext2fs_£t_g’”ic_b™m­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1174 
”rcode_t
 
magic
,

1175 
__u32
 
¡¬t
, __u32 
num
,

1176 *
š
);

1177 
”rcode_t
 
ext2fs_fšd_fœ¡_z”o_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

1178 
__u32
 
¡¬t
, __u32 
’d
,

1179 
__u32
 *
out
);

1184 
	#BMAP_STATS


	)

1186 
ext2fs_ä“_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
);

1187 
”rcode_t
 
ext2fs_®loc_g’”ic_bm­
(
ext2_fsys
 
fs
,ƒ¼code_ˆ
magic
,

1188 
ty³
, 
__u64
 
¡¬t
, __u64 
’d
,

1189 
__u64
 
»®_’d
,

1190 cÚ¡ *
desü
,

1191 
ext2fs_g’”ic_b™m­
 *
»t
);

1192 
”rcode_t
 
ext2fs_cİy_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
¤c
,

1193 
ext2fs_g’”ic_b™m­
 *
de¡
);

1194 
ext2fs_ş—r_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
);

1195 
”rcode_t
 
ext2fs_fudge_g’”ic_bm­_’d
(
ext2fs_g’”ic_b™m­
 
b™m­
,

1196 
”rcode_t
 
Ãq
,

1197 
__u64
 
’d
, __u64 *
Ûnd
);

1198 
ext2fs_£t_g’”ic_bm­_·ddšg
(
ext2fs_g’”ic_b™m­
 
bm­
);

1199 
”rcode_t
 
ext2fs_»size_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
,

1200 
__u64
 
Ãw_’d
,

1201 
__u64
 
Ãw_»®_’d
);

1202 
”rcode_t
 
ext2fs_com·»_g’”ic_bm­
Ó¼code_ˆ
Ãq
,

1203 
ext2fs_g’”ic_b™m­
 
bm1
,

1204 
ext2fs_g’”ic_b™m­
 
bm2
);

1205 
”rcode_t
 
ext2fs_g‘_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1206 
__u64
 
¡¬t
, 
num
,

1207 *
out
);

1208 
”rcode_t
 
ext2fs_£t_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1209 
__u64
 
¡¬t
, 
num
,

1210 *
š
);

1211 
”rcode_t
 
ext2fs_cÚv”t_subşu¡”_b™m­
(
ext2_fsys
 
fs
,

1212 
ext2fs_block_b™m­
 *
b™m­
);

1215 
”rcode_t
 
ext2fs_g‘_deviû_size
(cÚ¡ *
fe
, 
blocksize
,

1216 
blk_t
 *
»tblocks
);

1217 
”rcode_t
 
ext2fs_g‘_deviû_size2
(cÚ¡ *
fe
, 
blocksize
,

1218 
blk64_t
 *
»tblocks
);

1221 
ext2fs_g‘_dio_®ignm’t
(
fd
);

1222 
”rcode_t
 
ext2fs_g‘_deviû_£ùsize
(cÚ¡ *
fe
, *
£ùsize
);

1223 
”rcode_t
 
ext2fs_g‘_deviû_phys_£ùsize
(cÚ¡ *
fe
, *
£ùsize
);

1226 
”rcode_t
 
ext2fs_iblk_add_blocks
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
,

1227 
blk64_t
 
num_blocks
);

1228 
”rcode_t
 
ext2fs_iblk_sub_blocks
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
,

1229 
blk64_t
 
num_blocks
);

1230 
”rcode_t
 
ext2fs_iblk_£t
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
, 
blk64_t
 
b
);

1233 
”rcode_t
 
ext2fs_image_šode_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1234 
”rcode_t
 
ext2fs_image_šode_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1235 
”rcode_t
 
ext2fs_image_su³r_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1236 
”rcode_t
 
ext2fs_image_su³r_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1237 
”rcode_t
 
ext2fs_image_b™m­_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1238 
”rcode_t
 
ext2fs_image_b™m­_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1241 
”rcode_t
 
ext2fs_»ad_šd_block
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, *
buf
);

1242 
”rcode_t
 
ext2fs_wr™e_šd_block
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, *
buf
);

1245 
”rcode_t
 
ext2fs_š™Ÿlize
(cÚ¡ *
Çme
, 
æags
,

1246 
ext2_su³r_block
 *
·¿m
,

1247 
io_mªag”
 
mªag”
, 
ext2_fsys
 *
»t_fs
);

1250 
ext2fs_ä“_icouÁ
(
ext2_icouÁ_t
 
icouÁ
);

1251 
”rcode_t
 
ext2fs_ü—‹_icouÁ_tdb
(
ext2_fsys
 
fs
, *
tdb_dœ
,

1252 
æags
, 
ext2_icouÁ_t
 *
»t
);

1253 
”rcode_t
 
ext2fs_ü—‹_icouÁ2
(
ext2_fsys
 
fs
, 
æags
,

1254 
size
,

1255 
ext2_icouÁ_t
 
hšt
,ƒxt2_icouÁ_ˆ*
»t
);

1256 
”rcode_t
 
ext2fs_ü—‹_icouÁ
(
ext2_fsys
 
fs
, 
æags
,

1257 
size
,

1258 
ext2_icouÁ_t
 *
»t
);

1259 
”rcode_t
 
ext2fs_icouÁ_ãtch
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1260 
__u16
 *
»t
);

1261 
”rcode_t
 
ext2fs_icouÁ_šüem’t
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1262 
__u16
 *
»t
);

1263 
”rcode_t
 
ext2fs_icouÁ_deüem’t
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1264 
__u16
 *
»t
);

1265 
”rcode_t
 
ext2fs_icouÁ_¡Üe
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1266 
__u16
 
couÁ
);

1267 
ext2_šo_t
 
ext2fs_g‘_icouÁ_size
(
ext2_icouÁ_t
 
icouÁ
);

1268 
”rcode_t
 
ext2fs_icouÁ_v®id©e
(
ext2_icouÁ_t
 
icouÁ
, 
FILE
 *);

1272 
”rcode_t
 
ext2fs_g‘_mem®ign
(
size
,

1273 
®ign
, *
±r
);

1276 
”rcode_t
 
ext2fs_æush_iÿche
(
ext2_fsys
 
fs
);

1277 
”rcode_t
 
ext2fs_g‘_Ãxt_šode_fuÎ
(
ext2_šode_sÿn
 
sÿn
,

1278 
ext2_šo_t
 *
šo
,

1279 
ext2_šode
 *
šode
,

1280 
bufsize
);

1281 
”rcode_t
 
ext2fs_İ’_šode_sÿn
(
ext2_fsys
 
fs
, 
bufãr_blocks
,

1282 
ext2_šode_sÿn
 *
»t_sÿn
);

1283 
ext2fs_şo£_šode_sÿn
(
ext2_šode_sÿn
 
sÿn
);

1284 
”rcode_t
 
ext2fs_g‘_Ãxt_šode
(
ext2_šode_sÿn
 
sÿn
, 
ext2_šo_t
 *
šo
,

1285 
ext2_šode
 *
šode
);

1286 
”rcode_t
 
ext2fs_šode_sÿn_gÙo_blockgroup
(
ext2_šode_sÿn
 
sÿn
,

1287 
group
);

1288 
ext2fs_£t_šode_ÿÎback


1289 (
ext2_šode_sÿn
 
sÿn
,

1290 
”rcode_t
 (*
dÚe_group
)(
ext2_fsys
 
fs
,

1291 
ext2_šode_sÿn
 
sÿn
,

1292 
dg½_t
 
group
,

1293 * 
´iv_d©a
),

1294 *
dÚe_group_d©a
);

1295 
ext2fs_šode_sÿn_æags
(
ext2_šode_sÿn
 
sÿn
, 
£t_æags
,

1296 
ş—r_æags
);

1297 
”rcode_t
 
ext2fs_»ad_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1298 
ext2_šode
 * 
šode
,

1299 
bufsize
);

1300 
”rcode_t
 
ext2fs_»ad_šode
 (
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1301 
ext2_šode
 * 
šode
);

1302 
”rcode_t
 
ext2fs_wr™e_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1303 
ext2_šode
 * 
šode
,

1304 
bufsize
);

1305 
”rcode_t
 
ext2fs_wr™e_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1306 
ext2_šode
 * 
šode
);

1307 
”rcode_t
 
ext2fs_wr™e_Ãw_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1308 
ext2_šode
 * 
šode
);

1309 
”rcode_t
 
ext2fs_g‘_blocks
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
blk_t
 *
blocks
);

1310 
”rcode_t
 
ext2fs_check_dœeùÜy
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

1313 
io_mªag”
 
šode_io_mªag”
;

1314 
”rcode_t
 
ext2fs_šode_io_š‹º
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1315 **
Çme
);

1316 
”rcode_t
 
ext2fs_šode_io_š‹º2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1317 
ext2_šode
 *
šode
,

1318 **
Çme
);

1321 
”rcode_t
 
ext2fs_check_if_mouÁed
(cÚ¡ *
fe
, *
mouÁ_æags
);

1322 
”rcode_t
 
ext2fs_check_mouÁ_pošt
(cÚ¡ *
deviû
, *
mouÁ_æags
,

1323 *
mt
, 
m’
);

1330 
”rcode_t
 
ext2fs_punch
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1331 
ext2_šode
 *
šode
,

1332 *
block_buf
, 
blk64_t
 
¡¬t
,

1333 
blk64_t
 
’d
);

1336 
”rcode_t
 
ext2fs_lookup
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1337 
Çm–’
, *
buf
, 
ext2_šo_t
 *
šode
);

1338 
”rcode_t
 
ext2fs_Çmei
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1339 cÚ¡ *
Çme
, 
ext2_šo_t
 *
šode
);

1340 
”rcode_t
 
ext2fs_Çmei_fŞlow
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1341 cÚ¡ *
Çme
, 
ext2_šo_t
 *
šode
);

1342 
”rcode_t
 
ext2fs_fŞlow_lšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1343 
ext2_šo_t
 
šode
,ƒxt2_šo_ˆ*
»s_šode
);

1346 
ext2fs_Çtive_æag
();

1349 
”rcode_t
 
ext2fs_Ãw_dœ_block
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ_šo
,

1350 
ext2_šo_t
 
·»Á_šo
, **
block
);

1353 
”rcode_t
 
ext2fs_mkdœ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
·»Á
,ƒxt2_šo_ˆ
šum
,

1354 cÚ¡ *
Çme
);

1357 
”rcode_t
 
ext2fs_z”o_blocks
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, 
num
,

1358 
blk_t
 *
»t_blk
, *
»t_couÁ
);

1359 
”rcode_t
 
ext2fs_z”o_blocks2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
num
,

1360 
blk64_t
 *
»t_blk
, *
»t_couÁ
);

1361 
”rcode_t
 
ext2fs_ü—‹_jouº®_su³rblock
(
ext2_fsys
 
fs
,

1362 
__u32
 
num_blocks
, 
æags
,

1363 **
»t_jsb
);

1364 
”rcode_t
 
ext2fs_add_jouº®_deviû
(
ext2_fsys
 
fs
,

1365 
ext2_fsys
 
jouº®_dev
);

1366 
”rcode_t
 
ext2fs_add_jouº®_šode
(
ext2_fsys
 
fs
, 
blk_t
 
num_blocks
,

1367 
æags
);

1368 
ext2fs_deçuÉ_jouº®_size
(
__u64
 
num_blocks
);

1371 
”rcode_t
 
ext2fs_İ’
(cÚ¡ *
Çme
, 
æags
, 
su³rblock
,

1372 
block_size
, 
io_mªag”
 
mªag”
,

1373 
ext2_fsys
 *
»t_fs
);

1374 
”rcode_t
 
ext2fs_İ’2
(cÚ¡ *
Çme
, cÚ¡ *
io_İtiÚs
,

1375 
æags
, 
su³rblock
,

1376 
block_size
, 
io_mªag”
 
mªag”
,

1377 
ext2_fsys
 *
»t_fs
);

1378 
blk64_t
 
ext2fs_desütÜ_block_loc2
(
ext2_fsys
 
fs
,

1379 
blk64_t
 
group_block
, 
dg½_t
 
i
);

1380 
blk_t
 
ext2fs_desütÜ_block_loc
(
ext2_fsys
 
fs
, blk_ˆ
group_block
,

1381 
dg½_t
 
i
);

1382 
”rcode_t
 
ext2fs_g‘_d©a_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 *
Şd_io
);

1383 
”rcode_t
 
ext2fs_£t_d©a_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 
Ãw_io
);

1384 
”rcode_t
 
ext2fs_»wr™e_to_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 
Ãw_io
);

1387 
”rcode_t
 
ext2fs_g‘_·thÇme
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
,ƒxt2_šo_ˆ
šo
,

1388 **
Çme
);

1391 
”rcode_t
 
ext2fs_lšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1392 
ext2_šo_t
 
šo
, 
æags
);

1393 
”rcode_t
 
ext2fs_uÆšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1394 
ext2_šo_t
 
šo
, 
æags
);

1397 
”rcode_t
 
ext2fs_symlšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
·»Á
,ƒxt2_šo_ˆ
šo
,

1398 cÚ¡ *
Çme
, *
rg‘
);

1401 
”rcode_t
 
ext2fs_mmp_»ad
(
ext2_fsys
 
fs
, 
blk64_t
 
mmp_blk
, *
buf
);

1402 
”rcode_t
 
ext2fs_mmp_wr™e
(
ext2_fsys
 
fs
, 
blk64_t
 
mmp_blk
, *
buf
);

1403 
”rcode_t
 
ext2fs_mmp_ş—r
(
ext2_fsys
 
fs
);

1404 
”rcode_t
 
ext2fs_mmp_š™
(
ext2_fsys
 
fs
);

1405 
”rcode_t
 
ext2fs_mmp_¡¬t
(
ext2_fsys
 
fs
);

1406 
”rcode_t
 
ext2fs_mmp_upd©e
(
ext2_fsys
 
fs
);

1407 
”rcode_t
 
ext2fs_mmp_¡İ
(
ext2_fsys
 
fs
);

1408 
ext2fs_mmp_Ãw_£q
();

1411 
”rcode_t
 
ext2fs_»ad_bb_šode
(
ext2_fsys
 
fs
,

1412 
ext2_badblocks_li¡
 *
bb_li¡
);

1415 
”rcode_t
 
ext2fs_»ad_bb_FILE2
(
ext2_fsys
 
fs
, 
FILE
 *
f
,

1416 
ext2_badblocks_li¡
 *
bb_li¡
,

1417 *
´iv_d©a
,

1418 (*
šv®id
)(
ext2_fsys
 
fs
,

1419 
blk_t
 
blk
,

1420 *
bad¡r
,

1421 *
´iv_d©a
));

1422 
”rcode_t
 
ext2fs_»ad_bb_FILE
(
ext2_fsys
 
fs
, 
FILE
 *
f
,

1423 
ext2_badblocks_li¡
 *
bb_li¡
,

1424 (*
šv®id
)(
ext2_fsys
 
fs
,

1425 
blk_t
 
blk
));

1428 
”rcode_t
 
ext2fs_ü—‹_»size_šode
(
ext2_fsys
 
fs
);

1431 
ext2fs_sw­_ext_©Œ
(*
to
, *
äom
, 
bufsize
,

1432 
has_h—d”
);

1433 
ext2fs_sw­_ext_©Œ_h—d”
(
ext2_ext_©Œ_h—d”
 *
to_h—d”
,

1434 
ext2_ext_©Œ_h—d”
 *
äom_hdr
);

1435 
ext2fs_sw­_ext_©Œ_’Œy
(
ext2_ext_©Œ_’Œy
 *
to_’Œy
,

1436 
ext2_ext_©Œ_’Œy
 *
äom_’Œy
);

1437 
ext2fs_sw­_su³r
(
ext2_su³r_block
 * 
su³r
);

1438 
ext2fs_sw­_group_desc
(
ext2_group_desc
 *
gdp
);

1439 
ext2fs_sw­_group_desc2
(
ext2_fsys
, 
ext2_group_desc
 *
gdp
);

1440 
ext2fs_sw­_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šode_Ïrge
 *
t
,

1441 
ext2_šode_Ïrge
 *
f
, 
ho¡Üd”
,

1442 
bufsize
);

1443 
ext2fs_sw­_šode
(
ext2_fsys
 
fs
,
ext2_šode
 *
t
,

1444 
ext2_šode
 *
f
, 
ho¡Üd”
);

1445 
ext2fs_sw­_mmp
(
mmp_¡ruù
 *
mmp
);

1448 
ext2fs_İ’_fe
(cÚ¡ *
·thÇme
, 
æags
, 
mode_t
 
mode
);

1449 
ext2fs_¡©
(cÚ¡ *
·th
, 
ext2fs_¡ruù_¡©
 *
buf
);

1450 
ext2fs_f¡©
(
fd
, 
ext2fs_¡ruù_¡©
 *
buf
);

1453 
ext2fs_šode_has_v®id_blocks
(
ext2_šode
 *
šode
);

1454 
ext2fs_šode_has_v®id_blocks2
(
ext2_fsys
 
fs
,

1455 
ext2_šode
 *
šode
);

1458 
ext2fs_·r£_v”siÚ_¡ršg
(cÚ¡ *
v”_¡ršg
);

1459 
ext2fs_g‘_lib¿ry_v”siÚ
(cÚ¡ **
v”_¡ršg
,

1460 cÚ¡ **
d©e_¡ršg
);

1463 
”rcode_t
 
ext2fs_wr™e_bb_FILE
(
ext2_badblocks_li¡
 
bb_li¡
,

1464 
æags
,

1465 
FILE
 *
f
);

1469 #ifdeà
NO_INLINE_FUNCS


1470 
”rcode_t
 
ext2fs_g‘_mem
(
size
, *
±r
);

1471 
”rcode_t
 
ext2fs_g‘_memz”o
(
size
, *
±r
);

1472 
”rcode_t
 
ext2fs_g‘_¬¿y
(
couÁ
,

1473 
size
, *
±r
);

1474 
”rcode_t
 
ext2fs_g‘_¬¿yz”o
(
couÁ
,

1475 
size
, *
±r
);

1476 
”rcode_t
 
ext2fs_ä“_mem
(*
±r
);

1477 
”rcode_t
 
ext2fs_»size_mem
(
Şd_size
,

1478 
size
, *
±r
);

1479 
ext2fs_m¬k_su³r_dœty
(
ext2_fsys
 
fs
);

1480 
ext2fs_m¬k_chªged
(
ext2_fsys
 
fs
);

1481 
ext2fs_‹¡_chªged
(
ext2_fsys
 
fs
);

1482 
ext2fs_m¬k_v®id
(
ext2_fsys
 
fs
);

1483 
ext2fs_unm¬k_v®id
(
ext2_fsys
 
fs
);

1484 
ext2fs_‹¡_v®id
(
ext2_fsys
 
fs
);

1485 
ext2fs_m¬k_ib_dœty
(
ext2_fsys
 
fs
);

1486 
ext2fs_m¬k_bb_dœty
(
ext2_fsys
 
fs
);

1487 
ext2fs_‹¡_ib_dœty
(
ext2_fsys
 
fs
);

1488 
ext2fs_‹¡_bb_dœty
(
ext2_fsys
 
fs
);

1489 
dg½_t
 
ext2fs_group_of_blk
(
ext2_fsys
 
fs
, 
blk_t
 
blk
);

1490 
dg½_t
 
ext2fs_group_of_šo
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

1491 
blk_t
 
ext2fs_group_fœ¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

1492 
blk_t
 
ext2fs_group_Ï¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

1493 
blk_t
 
ext2fs_šode_d©a_blocks
(
ext2_fsys
 
fs
,

1494 
ext2_šode
 *
šode
);

1495 
ext2fs_div_û
(
a
, 
b
);

1496 
__u64
 
ext2fs_div64_û
(__u64 
a
, __u64 
b
);

1505 #ià(
defšed
(
INCLUDE_INLINE_FUNCS
è|| !defšed(
NO_INLINE_FUNCS
))

1506 #ifdeà
INCLUDE_INLINE_FUNCS


1507 
	#_INLINE_
 

	)

1509 #ià(
__STDC_VERSION__
 >= 199901L)

1510 
	#_INLINE_
 
šlše


	)

1512 #ifdeà
__GNUC__


1513 
	#_INLINE_
 
__šlše__


	)

1515 
	#_INLINE_
 
šlše


	)

1520 #iâdeà
EXT2_CUSTOM_MEMORY_ROUTINES


1521 
	~<¡ršg.h
>

1525 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_mem
(
size
, *
±r
)

1527 *
µ
;

1529 
µ
 = 
m®loc
(
size
);

1530 ià(!
µ
)

1531  
EXT2_ET_NO_MEMORY
;

1532 
memıy
(
±r
, &
µ
,  (pp));

1536 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_memz”o
(
size
, *
±r
)

1538 *
µ
;

1540 
µ
 = 
m®loc
(
size
);

1541 ià(!
µ
)

1542  
EXT2_ET_NO_MEMORY
;

1543 
mem£t
(
µ
, 0, 
size
);

1544 
memıy
(
±r
, &
µ
, (pp));

1548 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_¬¿y
(
couÁ
, 
size
, *
±r
)

1550 ià(
couÁ
 && (-1UL)/couÁ<
size
)

1551  
EXT2_ET_NO_MEMORY
;

1552  
ext2fs_g‘_mem
(
couÁ
*
size
, 
±r
);

1555 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_¬¿yz”o
(
couÁ
,

1556 
size
, *
±r
)

1558 *
µ
;

1560 ià(
couÁ
 && (-1UL)/couÁ<
size
)

1561  
EXT2_ET_NO_MEMORY
;

1562 
µ
 = 
ÿÎoc
(
couÁ
, 
size
);

1563 ià(!
µ
)

1564  
EXT2_ET_NO_MEMORY
;

1565 
memıy
(
±r
, &
µ
, (pp));

1572 
_INLINE_
 
”rcode_t
 
ext2fs_ä“_mem
(*
±r
)

1574 *
p
;

1576 
memıy
(&
p
, 
±r
, (p));

1577 
ä“
(
p
);

1578 
p
 = 0;

1579 
memıy
(
±r
, &
p
, (p));

1586 
_INLINE_
 
”rcode_t
 
ext2fs_»size_mem
(
EXT2FS_ATTR
((
unu£d
)è
Şd_size
,

1587 
size
, *
±r
)

1589 *
p
;

1593 
memıy
(&
p
, 
±r
, (p));

1594 
p
 = 
»®loc
Õ, 
size
);

1595 ià(!
p
)

1596  
EXT2_ET_NO_MEMORY
;

1597 
memıy
(
±r
, &
p
, (p));

1605 
_INLINE_
 
ext2fs_m¬k_su³r_dœty
(
ext2_fsys
 
fs
)

1607 
fs
->
æags
 |ğ
EXT2_FLAG_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1613 
_INLINE_
 
ext2fs_m¬k_chªged
(
ext2_fsys
 
fs
)

1615 
fs
->
æags
 |ğ
EXT2_FLAG_CHANGED
;

1621 
_INLINE_
 
ext2fs_‹¡_chªged
(
ext2_fsys
 
fs
)

1623  (
fs
->
æags
 & 
EXT2_FLAG_CHANGED
);

1629 
_INLINE_
 
ext2fs_m¬k_v®id
(
ext2_fsys
 
fs
)

1631 
fs
->
æags
 |ğ
EXT2_FLAG_VALID
;

1637 
_INLINE_
 
ext2fs_unm¬k_v®id
(
ext2_fsys
 
fs
)

1639 
fs
->
æags
 &ğ~
EXT2_FLAG_VALID
;

1645 
_INLINE_
 
ext2fs_‹¡_v®id
(
ext2_fsys
 
fs
)

1647  (
fs
->
æags
 & 
EXT2_FLAG_VALID
);

1653 
_INLINE_
 
ext2fs_m¬k_ib_dœty
(
ext2_fsys
 
fs
)

1655 
fs
->
æags
 |ğ
EXT2_FLAG_IB_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1661 
_INLINE_
 
ext2fs_m¬k_bb_dœty
(
ext2_fsys
 
fs
)

1663 
fs
->
æags
 |ğ
EXT2_FLAG_BB_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1669 
_INLINE_
 
ext2fs_‹¡_ib_dœty
(
ext2_fsys
 
fs
)

1671  (
fs
->
æags
 & 
EXT2_FLAG_IB_DIRTY
);

1677 
_INLINE_
 
ext2fs_‹¡_bb_dœty
(
ext2_fsys
 
fs
)

1679  (
fs
->
æags
 & 
EXT2_FLAG_BB_DIRTY
);

1685 
_INLINE_
 
dg½_t
 
ext2fs_group_of_blk
(
ext2_fsys
 
fs
, 
blk_t
 
blk
)

1687  
ext2fs_group_of_blk2
(
fs
, 
blk
);

1692 
_INLINE_
 
dg½_t
 
ext2fs_group_of_šo
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
)

1694  (
šo
 - 1è/ 
fs
->
su³r
->
s_šodes_³r_group
;

1700 
_INLINE_
 
blk_t
 
ext2fs_group_fœ¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
)

1702  (
blk_t
è
ext2fs_group_fœ¡_block2
(
fs
, 
group
);

1708 
_INLINE_
 
blk_t
 
ext2fs_group_Ï¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
)

1710  (
blk_t
è
ext2fs_group_Ï¡_block2
(
fs
, 
group
);

1713 
_INLINE_
 
blk_t
 
ext2fs_šode_d©a_blocks
(
ext2_fsys
 
fs
,

1714 
ext2_šode
 *
šode
)

1716  (
blk_t
è
ext2fs_šode_d©a_blocks2
(
fs
, 
šode
);

1722 
_INLINE_
 
ext2fs_div_û
(
a
, 
b
)

1724 ià(!
a
)

1726  ((
a
 - 1è/ 
b
) + 1;

1729 
_INLINE_
 
__u64
 
ext2fs_div64_û
(__u64 
a
, __u64 
b
)

1731 ià(!
a
)

1733  ((
a
 - 1è/ 
b
) + 1;

1736 #undeà
_INLINE_


1739 #ifdeà
__ılu¥lus


	@libmke2fs/ext2fs.h

12 #iâdeà
_EXT2FS_EXT2FS_H


13 
	#_EXT2FS_EXT2FS_H


	)

15 #ifdeà
__GNUC__


16 
	#EXT2FS_ATTR
(
x
è
	`__©Œibu‹__
(x)

	)

18 
	#EXT2FS_ATTR
(
x
)

	)

21 #ifdeà
__ılu¥lus


28 #ià(!
defšed
(
__GNUC__
è&& !defšed(
__WATCOMC__
))

29 
	#NO_INLINE_FUNCS


	)

39 
	#SUPERBLOCK_OFFSET
 1024

	)

40 
	#SUPERBLOCK_SIZE
 1024

	)

46 
	#EXT2_LIB_CURRENT_REV
 
EXT2_DYNAMIC_REV


	)

48 #ifdeà
HAVE_SYS_TYPES_H


49 
	~<sys/ty³s.h
>

52 
	~<¡dio.h
>

53 
	~<¡dlib.h
>

54 
	~<¡ršg.h
>

55 
	~<”ºo.h
>

57 #ià
EXT2_FLAT_INCLUDES


58 
	~"e2_ty³s.h
"

59 
	~"ext2_fs.h
"

60 
	~"ext3_ex‹Ás.h
"

62 
	~<ext2fs/ext2_ty³s.h
>

63 
	~<ext2fs/ext2_fs.h
>

64 
	~<ext2fs/ext3_ex‹Ás.h
>

67 #ifdeà
__CHECK_ENDIAN__


68 
	#__b™wi£
 
	`__©Œibu‹__
((
b™wi£
))

	)

70 
	#__b™wi£


	)

73 
__u32
 
	t__b™wi£
 
	text2_šo_t
;

74 
__u32
 
	t__b™wi£
 
	tblk_t
;

75 
__u64
 
	t__b™wi£
 
	tblk64_t
;

76 
__u32
 
	t__b™wi£
 
	tdg½_t
;

77 
__u32
 
	t__b™wi£
 
	text2_off_t
;

78 
__u64
 
	t__b™wi£
 
	text2_off64_t
;

79 
__s64
 
	t__b™wi£
 
	te2_blkút_t
;

80 
__u32
 
	t__b™wi£
 
	text2_dœhash_t
;

82 #ià
EXT2_FLAT_INCLUDES


83 
	~"com_”r.h
"

84 
	~"ext2_io.h
"

85 
	~"ext2_”r.h
"

86 
	~"ext2_ext_©Œ.h
"

88 
	~<‘/com_”r.h
>

89 
	~<ext2fs/ext2_io.h
>

90 
	~<ext2fs/ext2_”r.h
>

91 
	~<ext2fs/ext2_ext_©Œ.h
>

97 #ifdeà
_MSC_VER


98 
	#EXT2_QSORT_TYPE
 
__cdeş


	)

100 
	#EXT2_QSORT_TYPE
 

	)

103 
¡ruù_ext2_fsys
 *
	text2_fsys
;

105 
	#EXT2FS_MARK_ERROR
 0

	)

106 
	#EXT2FS_UNMARK_ERROR
 1

	)

107 
	#EXT2FS_TEST_ERROR
 2

	)

109 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_g’”ic_b™m­
;

110 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_šode_b™m­
;

111 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_block_b™m­
;

113 
	#EXT2_FIRST_INODE
(
s
è
	`EXT2_FIRST_INO
(s)

	)

120 
ext2_¡ruù_u32_li¡
 *
	text2_badblocks_li¡
;

121 
ext2_¡ruù_u32_™”©e
 *
	text2_badblocks_™”©e
;

123 
ext2_¡ruù_u32_li¡
 *
	text2_u32_li¡
;

124 
ext2_¡ruù_u32_™”©e
 *
	text2_u32_™”©e
;

127 
ext2_¡ruù_u32_li¡
 *
	tbadblocks_li¡
;

128 
ext2_¡ruù_u32_™”©e
 *
	tbadblocks_™”©e
;

130 
	#BADBLOCKS_FLAG_DIRTY
 1

	)

135 
	sext2_db_’Œy2
 {

136 
ext2_šo_t
 
šo
;

137 
blk64_t
 
blk
;

138 
e2_blkút_t
 
blockút
;

142 
	sext2_db_’Œy
 {

143 
ext2_šo_t
 
šo
;

144 
blk_t
 
blk
;

145 
blockút
;

148 
ext2_¡ruù_dbli¡
 *
	text2_dbli¡
;

150 
	#DBLIST_ABORT
 1

	)

156 
	#EXT2_FILE_WRITE
 0x0001

	)

157 
	#EXT2_FILE_CREATE
 0x0002

	)

159 
	#EXT2_FILE_MASK
 0x00FF

	)

161 
	#EXT2_FILE_BUF_DIRTY
 0x4000

	)

162 
	#EXT2_FILE_BUF_VALID
 0x2000

	)

164 
ext2_fe
 *
	text2_fe_t
;

166 
	#EXT2_SEEK_SET
 0

	)

167 
	#EXT2_SEEK_CUR
 1

	)

168 
	#EXT2_SEEK_END
 2

	)

173 
	#EXT2_FLAG_RW
 0x01

	)

174 
	#EXT2_FLAG_CHANGED
 0x02

	)

175 
	#EXT2_FLAG_DIRTY
 0x04

	)

176 
	#EXT2_FLAG_VALID
 0x08

	)

177 
	#EXT2_FLAG_IB_DIRTY
 0x10

	)

178 
	#EXT2_FLAG_BB_DIRTY
 0x20

	)

179 
	#EXT2_FLAG_SWAP_BYTES
 0x40

	)

180 
	#EXT2_FLAG_SWAP_BYTES_READ
 0x80

	)

181 
	#EXT2_FLAG_SWAP_BYTES_WRITE
 0x100

	)

182 
	#EXT2_FLAG_MASTER_SB_ONLY
 0x200

	)

183 
	#EXT2_FLAG_FORCE
 0x400

	)

184 
	#EXT2_FLAG_SUPER_ONLY
 0x800

	)

185 
	#EXT2_FLAG_JOURNAL_DEV_OK
 0x1000

	)

186 
	#EXT2_FLAG_IMAGE_FILE
 0x2000

	)

187 
	#EXT2_FLAG_EXCLUSIVE
 0x4000

	)

188 
	#EXT2_FLAG_SOFTSUPP_FEATURES
 0x8000

	)

189 
	#EXT2_FLAG_NOFREE_ON_ERROR
 0x10000

	)

190 
	#EXT2_FLAG_64BITS
 0x20000

	)

191 
	#EXT2_FLAG_PRINT_PROGRESS
 0x40000

	)

192 
	#EXT2_FLAG_DIRECT_IO
 0x80000

	)

193 
	#EXT2_FLAG_SKIP_MMP
 0x100000

	)

199 
	#EXT2_NEW_INODE_FL
 0x80000000

	)

204 
	#EXT2_MKJOURNAL_V1_SUPER
 0x0000001

	)

205 
	#EXT2_MKJOURNAL_LAZYINIT
 0x0000002

	)

206 
	#EXT2_MKJOURNAL_NO_MNT_CHECK
 0x0000004

	)

208 
İaque_ext2_group_desc
;

210 
	s¡ruù_ext2_fsys
 {

211 
”rcode_t
 
magic
;

212 
io_chªÃl
 
io
;

213 
æags
;

214 * 
deviû_Çme
;

215 
ext2_su³r_block
 * 
su³r
;

216 
blocksize
;

217 
äagsize
;

218 
dg½_t
 
group_desc_couÁ
;

219 
desc_blocks
;

220 
İaque_ext2_group_desc
 * 
group_desc
;

221 
šode_blocks_³r_group
;

222 
ext2fs_šode_b™m­
 
šode_m­
;

223 
ext2fs_block_b™m­
 
block_m­
;

225 
”rcode_t
 (*
g‘_blocks
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
blk_t
 *
blocks
);

226 
”rcode_t
 (*
check_dœeùÜy
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

227 
”rcode_t
 (*
wr™e_b™m­s
)(
ext2_fsys
 
fs
);

228 
”rcode_t
 (*
»ad_šode
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

229 
ext2_šode
 *
šode
);

230 
”rcode_t
 (*
wr™e_šode
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

231 
ext2_šode
 *
šode
);

232 
ext2_badblocks_li¡
 
badblocks
;

233 
ext2_dbli¡
 
dbli¡
;

234 
__u32
 
¡ride
;

235 
ext2_su³r_block
 * 
Üig_su³r
;

236 
ext2_image_hdr
 * 
image_h—d”
;

237 
__u32
 
umask
;

238 
time_t
 
now
;

239 
şu¡”_¿tio_b™s
;

240 
__u16
 
deçuÉ_b™m­_ty³
;

241 
__u16
 
·d
;

245 
__u32
 
»£rved
[5];

250 * 
´iv_d©a
;

255 
ext2_šode_ÿche
 *
iÿche
;

256 
io_chªÃl
 
image_io
;

261 
”rcode_t
 (*
g‘_®loc_block
)(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

262 
blk64_t
 *
»t
);

263 (*
block_®loc_¡©s
)(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
šu£
);

268 *
mmp_buf
;

269 *
mmp_cmp
;

270 
mmp_fd
;

275 
mmp_Ï¡_wr™‹n
;

278 #ià
EXT2_FLAT_INCLUDES


279 
	~"e2_b™İs.h
"

281 
	~<ext2fs/b™İs.h
>

287 
	#EXT2FS_BMAP64_BITARRAY
 1

	)

288 
	#EXT2FS_BMAP64_RBTREE
 2

	)

289 
	#EXT2FS_BMAP64_AUTODIR
 3

	)

294 
	#BLOCK_CHANGED
 1

	)

295 
	#BLOCK_ABORT
 2

	)

296 
	#BLOCK_ERROR
 4

	)

322 
	#BLOCK_FLAG_APPEND
 1

	)

323 
	#BLOCK_FLAG_HOLE
 1

	)

324 
	#BLOCK_FLAG_DEPTH_TRAVERSE
 2

	)

325 
	#BLOCK_FLAG_DATA_ONLY
 4

	)

326 
	#BLOCK_FLAG_READ_ONLY
 8

	)

328 
	#BLOCK_FLAG_NO_LARGE
 0x1000

	)

333 
	#BLOCK_COUNT_IND
 (-1)

	)

334 
	#BLOCK_COUNT_DIND
 (-2)

	)

335 
	#BLOCK_COUNT_TIND
 (-3)

	)

336 
	#BLOCK_COUNT_TRANSLATOR
 (-4)

	)

342 
	#EXT2_BMOVE_GET_DBLIST
 0x0001

	)

343 
	#EXT2_BMOVE_DEBUG
 0x0002

	)

350 
	#EXT2_EXTENT_FLAGS_LEAF
 0x0001

	)

351 
	#EXT2_EXTENT_FLAGS_UNINIT
 0x0002

	)

352 
	#EXT2_EXTENT_FLAGS_SECOND_VISIT
 0x0004

	)

354 
	sext2fs_ex‹Á
 {

355 
blk64_t
 
e_pblk
;

356 
blk64_t
 
e_lblk
;

357 
__u32
 
e_Ën
;

358 
__u32
 
e_æags
;

361 
ext2_ex‹Á_hªdË
 *
	text2_ex‹Á_hªdË_t
;

362 
ext2_ex‹Á_·th
 *
	text2_ex‹Á_·th_t
;

367 
	#EXT2_EXTENT_CURRENT
 0x0000

	)

368 
	#EXT2_EXTENT_MOVE_MASK
 0x000F

	)

369 
	#EXT2_EXTENT_ROOT
 0x0001

	)

370 
	#EXT2_EXTENT_LAST_LEAF
 0x0002

	)

371 
	#EXT2_EXTENT_FIRST_SIB
 0x0003

	)

372 
	#EXT2_EXTENT_LAST_SIB
 0x0004

	)

373 
	#EXT2_EXTENT_NEXT_SIB
 0x0005

	)

374 
	#EXT2_EXTENT_PREV_SIB
 0x0006

	)

375 
	#EXT2_EXTENT_NEXT_LEAF
 0x0007

	)

376 
	#EXT2_EXTENT_PREV_LEAF
 0x0008

	)

377 
	#EXT2_EXTENT_NEXT
 0x0009

	)

378 
	#EXT2_EXTENT_PREV
 0x000A

	)

379 
	#EXT2_EXTENT_UP
 0x000B

	)

380 
	#EXT2_EXTENT_DOWN
 0x000C

	)

381 
	#EXT2_EXTENT_DOWN_AND_LAST
 0x000D

	)

386 
	#EXT2_EXTENT_INSERT_AFTER
 0x0001

	)

387 
	#EXT2_EXTENT_INSERT_NOSPLIT
 0x0002

	)

392 
	#EXT2_EXTENT_DELETE_KEEP_EMPTY
 0x001

	)

397 
	#EXT2_EXTENT_SET_BMAP_UNINIT
 0x0001

	)

402 
	sext2_ex‹Á_šfo
 {

403 
cu¼_’Œy
;

404 
cu¼_Ëv–
;

405 
num_’Œ›s
;

406 
max_’Œ›s
;

407 
max_d•th
;

408 
by‹s_ava
;

409 
blk64_t
 
max_lblk
;

410 
blk64_t
 
max_pblk
;

411 
__u32
 
max_Ën
;

412 
__u32
 
max_unš™_Ën
;

418 
	#EXT2_DIRBLOCK_V2_STRUCT
 0x0001

	)

423 
	#DIRENT_CHANGED
 1

	)

424 
	#DIRENT_ABORT
 2

	)

425 
	#DIRENT_ERROR
 3

	)

431 
	#DIRENT_FLAG_INCLUDE_EMPTY
 1

	)

432 
	#DIRENT_FLAG_INCLUDE_REMOVED
 2

	)

434 
	#DIRENT_DOT_FILE
 1

	)

435 
	#DIRENT_DOT_DOT_FILE
 2

	)

436 
	#DIRENT_OTHER_FILE
 3

	)

437 
	#DIRENT_DELETED_FILE
 4

	)

442 
ext2_¡ruù_šode_sÿn
 *
	text2_šode_sÿn
;

447 
	#EXT2_SF_CHK_BADBLOCKS
 0x0001

	)

448 
	#EXT2_SF_BAD_INODE_BLK
 0x0002

	)

449 
	#EXT2_SF_BAD_EXTRA_BYTES
 0x0004

	)

450 
	#EXT2_SF_SKIP_MISSING_ITABLE
 0x0008

	)

451 
	#EXT2_SF_DO_LAZY
 0x0010

	)

456 
	#EXT2_MF_MOUNTED
 1

	)

457 
	#EXT2_MF_ISROOT
 2

	)

458 
	#EXT2_MF_READONLY
 4

	)

459 
	#EXT2_MF_SWAP
 8

	)

460 
	#EXT2_MF_BUSY
 16

	)

467 
	#LINUX_S_IFMT
 00170000

	)

468 
	#LINUX_S_IFSOCK
 0140000

	)

469 
	#LINUX_S_IFLNK
 0120000

	)

470 
	#LINUX_S_IFREG
 0100000

	)

471 
	#LINUX_S_IFBLK
 0060000

	)

472 
	#LINUX_S_IFDIR
 0040000

	)

473 
	#LINUX_S_IFCHR
 0020000

	)

474 
	#LINUX_S_IFIFO
 0010000

	)

475 
	#LINUX_S_ISUID
 0004000

	)

476 
	#LINUX_S_ISGID
 0002000

	)

477 
	#LINUX_S_ISVTX
 0001000

	)

479 
	#LINUX_S_IRWXU
 00700

	)

480 
	#LINUX_S_IRUSR
 00400

	)

481 
	#LINUX_S_IWUSR
 00200

	)

482 
	#LINUX_S_IXUSR
 00100

	)

484 
	#LINUX_S_IRWXG
 00070

	)

485 
	#LINUX_S_IRGRP
 00040

	)

486 
	#LINUX_S_IWGRP
 00020

	)

487 
	#LINUX_S_IXGRP
 00010

	)

489 
	#LINUX_S_IRWXO
 00007

	)

490 
	#LINUX_S_IROTH
 00004

	)

491 
	#LINUX_S_IWOTH
 00002

	)

492 
	#LINUX_S_IXOTH
 00001

	)

494 
	#LINUX_S_ISLNK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFLNK
)

	)

495 
	#LINUX_S_ISREG
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFREG
)

	)

496 
	#LINUX_S_ISDIR
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFDIR
)

	)

497 
	#LINUX_S_ISCHR
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFCHR
)

	)

498 
	#LINUX_S_ISBLK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFBLK
)

	)

499 
	#LINUX_S_ISFIFO
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFIFO
)

	)

500 
	#LINUX_S_ISSOCK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFSOCK
)

	)

505 
	#EXT2_I_SIZE
(
i
è((i)->
i_size
 | ((
__u64
è(i)->
i_size_high
 << 32))

	)

510 
	#EXT2_ICOUNT_OPT_INCREMENT
 0x01

	)

512 
ext2_icouÁ
 *
	text2_icouÁ_t
;

517 
	#BMAP_ALLOC
 0x0001

	)

518 
	#BMAP_SET
 0x0002

	)

523 
	#BMAP_RET_UNINIT
 0x0001

	)

528 
	#IMAGER_FLAG_INODEMAP
 1

	)

529 
	#IMAGER_FLAG_SPARSEWRITE
 2

	)

535 
	#EXT2_CHECK_MAGIC
(, 
code
) \

536 ià(()->
magic
 !ğ(
code
)è (code)

	)

542 
	#EXT2FS_COMPRESSED_BLKADDR
 ((
blk_t
è-1)

	)

543 
	#HOLE_BLKADDR
(
_b
è((_bè=ğ0 || (_bè=ğ
EXT2FS_COMPRESSED_BLKADDR
)

	)

548 
	#EXT2_LIB_FEATURE_COMPAT_SUPP
 (
EXT2_FEATURE_COMPAT_DIR_PREALLOC
|\

549 
EXT2_FEATURE_COMPAT_IMAGIC_INODES
|\

550 
EXT3_FEATURE_COMPAT_HAS_JOURNAL
|\

551 
EXT2_FEATURE_COMPAT_RESIZE_INODE
|\

552 
EXT2_FEATURE_COMPAT_DIR_INDEX
|\

553 
EXT2_FEATURE_COMPAT_EXT_ATTR
)

	)

556 #ifdeà
ENABLE_COMPRESSION


557 #iâdeà
I_KNOW_THAT_COMPRESSION_IS_EXPERIMENTAL


563 
	#EXT2_LIB_FEATURE_INCOMPAT_SUPP
 (
EXT2_FEATURE_INCOMPAT_FILETYPE
|\

564 
EXT2_FEATURE_INCOMPAT_COMPRESSION
|\

565 
EXT3_FEATURE_INCOMPAT_JOURNAL_DEV
|\

566 
EXT2_FEATURE_INCOMPAT_META_BG
|\

567 
EXT3_FEATURE_INCOMPAT_RECOVER
|\

568 
EXT3_FEATURE_INCOMPAT_EXTENTS
|\

569 
EXT4_FEATURE_INCOMPAT_FLEX_BG
|\

570 
EXT4_FEATURE_INCOMPAT_MMP
|\

571 
EXT4_FEATURE_INCOMPAT_64BIT
)

	)

573 
	#EXT2_LIB_FEATURE_INCOMPAT_SUPP
 (
EXT2_FEATURE_INCOMPAT_FILETYPE
|\

574 
EXT3_FEATURE_INCOMPAT_JOURNAL_DEV
|\

575 
EXT2_FEATURE_INCOMPAT_META_BG
|\

576 
EXT3_FEATURE_INCOMPAT_RECOVER
|\

577 
EXT3_FEATURE_INCOMPAT_EXTENTS
|\

578 
EXT4_FEATURE_INCOMPAT_FLEX_BG
|\

579 
EXT4_FEATURE_INCOMPAT_MMP
|\

580 
EXT4_FEATURE_INCOMPAT_64BIT
)

	)

582 #ifdeà
CONFIG_QUOTA


583 
	#EXT2_LIB_FEATURE_RO_COMPAT_SUPP
 (
EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER
|\

584 
EXT4_FEATURE_RO_COMPAT_HUGE_FILE
|\

585 
EXT2_FEATURE_RO_COMPAT_LARGE_FILE
|\

586 
EXT4_FEATURE_RO_COMPAT_DIR_NLINK
|\

587 
EXT4_FEATURE_RO_COMPAT_EXTRA_ISIZE
|\

588 
EXT4_FEATURE_RO_COMPAT_GDT_CSUM
|\

589 
EXT4_FEATURE_RO_COMPAT_BIGALLOC
|\

590 
EXT4_FEATURE_RO_COMPAT_QUOTA
)

	)

592 
	#EXT2_LIB_FEATURE_RO_COMPAT_SUPP
 (
EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER
|\

593 
EXT4_FEATURE_RO_COMPAT_HUGE_FILE
|\

594 
EXT2_FEATURE_RO_COMPAT_LARGE_FILE
|\

595 
EXT4_FEATURE_RO_COMPAT_DIR_NLINK
|\

596 
EXT4_FEATURE_RO_COMPAT_EXTRA_ISIZE
|\

597 
EXT4_FEATURE_RO_COMPAT_GDT_CSUM
|\

598 
EXT4_FEATURE_RO_COMPAT_BIGALLOC
)

	)

605 
	#EXT2_LIB_SOFTSUPP_INCOMPAT
 (0)

	)

606 
	#EXT2_LIB_SOFTSUPP_RO_COMPAT
 (
EXT4_FEATURE_RO_COMPAT_REPLICA
)

	)

610 
	#EXT2FS_CLUSTER_RATIO
(
fs
è(1 << (fs)->
şu¡”_¿tio_b™s
)

	)

611 
	#EXT2FS_CLUSTER_MASK
(
fs
è(
	`EXT2FS_CLUSTER_RATIO
(fsè- 1)

	)

612 
	#EXT2FS_B2C
(
fs
, 
blk
è((blkè>> (fs)->
şu¡”_¿tio_b™s
)

	)

614 
	#EXT2FS_C2B
(
fs
, 
şu¡”
è((şu¡”è<< (fs)->
şu¡”_¿tio_b™s
)

	)

616 
	#EXT2FS_NUM_B2C
(
fs
, 
blks
è(((blksè+ 
	`EXT2FS_CLUSTER_MASK
(fs)) >> \

617 (
fs
)->
şu¡”_¿tio_b™s
)

	)

619 #ià
defšed
(
HAVE_FSTAT64
è&& !defšed(
__OSX_AVAILABLE_BUT_DEPRECATED
)

620 
¡©64
 
	text2fs_¡ruù_¡©
;

622 
¡©
 
	text2fs_¡ruù_¡©
;

629 
	#EXT2_FLAG_FLUSH_NO_SYNC
 1

	)

636 
šlše
 
ext2fs_Ãeds_Ïrge_fe_ã©u»
(
fe_size
)

638  
fe_size
 >= 0x80000000ULL;

642 
”rcode_t
 
ext2fs_Ãw_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, 
mode
,

643 
ext2fs_šode_b™m­
 
m­
, 
ext2_šo_t
 *
»t
);

644 
”rcode_t
 
ext2fs_Ãw_block
(
ext2_fsys
 
fs
, 
blk_t
 
gßl
,

645 
ext2fs_block_b™m­
 
m­
, 
blk_t
 *
»t
);

646 
”rcode_t
 
ext2fs_Ãw_block2
(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

647 
ext2fs_block_b™m­
 
m­
, 
blk64_t
 *
»t
);

648 
”rcode_t
 
ext2fs_g‘_ä“_blocks
(
ext2_fsys
 
fs
, 
blk_t
 
¡¬t
,

649 
blk_t
 
fšish
, 
num
,

650 
ext2fs_block_b™m­
 
m­
,

651 
blk_t
 *
»t
);

652 
”rcode_t
 
ext2fs_g‘_ä“_blocks2
(
ext2_fsys
 
fs
, 
blk64_t
 
¡¬t
,

653 
blk64_t
 
fšish
, 
num
,

654 
ext2fs_block_b™m­
 
m­
,

655 
blk64_t
 *
»t
);

656 
”rcode_t
 
ext2fs_®loc_block
(
ext2_fsys
 
fs
, 
blk_t
 
gßl
,

657 *
block_buf
, 
blk_t
 *
»t
);

658 
”rcode_t
 
ext2fs_®loc_block2
(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

659 *
block_buf
, 
blk64_t
 *
»t
);

660 
ext2fs_£t_®loc_block_ÿÎback
(
ext2_fsys
 
fs
,

661 
”rcode_t
 (*
func
)(
ext2_fsys
 
fs
,

662 
blk64_t
 
gßl
,

663 
blk64_t
 *
»t
),

664 
”rcode_t
 (**
Şd
)(
ext2_fsys
 
fs
,

665 
blk64_t
 
gßl
,

666 
blk64_t
 *
»t
));

669 
ext2fs_»£rve_su³r_ªd_bgd
(
ext2_fsys
 
fs
,

670 
dg½_t
 
group
,

671 
ext2fs_block_b™m­
 
bm­
);

672 
ext2fs_£t_block_®loc_¡©s_ÿÎback
(
ext2_fsys
 
fs
,

673 (*
func
)(
ext2_fsys
 
fs
,

674 
blk64_t
 
blk
,

675 
šu£
),

676 (**
Şd
)(
ext2_fsys
 
fs
,

677 
blk64_t
 
blk
,

678 
šu£
));

681 
ext2fs_šode_®loc_¡©s
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
šu£
);

682 
ext2fs_šode_®loc_¡©s2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

683 
šu£
, 
isdœ
);

684 
ext2fs_block_®loc_¡©s
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, 
šu£
);

685 
ext2fs_block_®loc_¡©s2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
šu£
);

688 
”rcode_t
 
ext2fs_®loÿ‹_bËs
(
ext2_fsys
 
fs
);

689 
”rcode_t
 
ext2fs_®loÿ‹_group_bË
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

690 
ext2fs_block_b™m­
 
bm­
);

693 
”rcode_t
 
ext2fs_u32_li¡_ü—‹
(
ext2_u32_li¡
 *
»t
, 
size
);

694 
”rcode_t
 
ext2fs_u32_li¡_add
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

695 
ext2fs_u32_li¡_fšd
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

696 
ext2fs_u32_li¡_‹¡
(
ext2_u32_li¡
 
bb
, 
blk_t
 
blk
);

697 
”rcode_t
 
ext2fs_u32_li¡_™”©e_begš
(
ext2_u32_li¡
 
bb
,

698 
ext2_u32_™”©e
 *
»t
);

699 
ext2fs_u32_li¡_™”©e
(
ext2_u32_™”©e
 
™”
, 
blk_t
 *
blk
);

700 
ext2fs_u32_li¡_™”©e_’d
(
ext2_u32_™”©e
 
™”
);

701 
”rcode_t
 
ext2fs_u32_cİy
(
ext2_u32_li¡
 
¤c
,ƒxt2_u32_li¡ *
de¡
);

702 
ext2fs_u32_li¡_equ®
(
ext2_u32_li¡
 
bb1
,ƒxt2_u32_li¡ 
bb2
);

704 
”rcode_t
 
ext2fs_badblocks_li¡_ü—‹
(
ext2_badblocks_li¡
 *
»t
,

705 
size
);

706 
”rcode_t
 
ext2fs_badblocks_li¡_add
(
ext2_badblocks_li¡
 
bb
,

707 
blk_t
 
blk
);

708 
ext2fs_badblocks_li¡_‹¡
(
ext2_badblocks_li¡
 
bb
,

709 
blk_t
 
blk
);

710 
ext2fs_u32_li¡_d–
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

711 
ext2fs_badblocks_li¡_d–
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

712 
”rcode_t


713 
ext2fs_badblocks_li¡_™”©e_begš
(
ext2_badblocks_li¡
 
bb
,

714 
ext2_badblocks_™”©e
 *
»t
);

715 
ext2fs_badblocks_li¡_™”©e
(
ext2_badblocks_™”©e
 
™”
,

716 
blk_t
 *
blk
);

717 
ext2fs_badblocks_li¡_™”©e_’d
(
ext2_badblocks_™”©e
 
™”
);

718 
”rcode_t
 
ext2fs_badblocks_cİy
(
ext2_badblocks_li¡
 
¤c
,

719 
ext2_badblocks_li¡
 *
de¡
);

720 
ext2fs_badblocks_equ®
(
ext2_badblocks_li¡
 
bb1
,

721 
ext2_badblocks_li¡
 
bb2
);

722 
ext2fs_u32_li¡_couÁ
(
ext2_u32_li¡
 
bb
);

725 
”rcode_t
 
badblocks_li¡_ü—‹
(
badblocks_li¡
 *
»t
, 
size
);

726 
”rcode_t
 
badblocks_li¡_add
(
badblocks_li¡
 
bb
, 
blk_t
 
blk
);

727 
badblocks_li¡_‹¡
(
badblocks_li¡
 
bb
, 
blk_t
 
blk
);

728 
”rcode_t
 
badblocks_li¡_™”©e_begš
(
badblocks_li¡
 
bb
,

729 
badblocks_™”©e
 *
»t
);

730 
badblocks_li¡_™”©e
(
badblocks_™”©e
 
™”
, 
blk_t
 *
blk
);

731 
badblocks_li¡_™”©e_’d
(
badblocks_™”©e
 
™”
);

732 
badblocks_li¡_ä“
(
badblocks_li¡
 
bb
);

735 
”rcode_t
 
ext2fs_upd©e_bb_šode
(
ext2_fsys
 
fs
,

736 
ext2_badblocks_li¡
 
bb_li¡
);

739 
ext2fs_ä“_block_b™m­
(
ext2fs_block_b™m­
 
b™m­
);

740 
ext2fs_ä“_šode_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

741 
”rcode_t
 
ext2fs_cİy_b™m­
(
ext2fs_g’”ic_b™m­
 
¤c
,

742 
ext2fs_g’”ic_b™m­
 *
de¡
);

743 
”rcode_t
 
ext2fs_wr™e_šode_b™m­
(
ext2_fsys
 
fs
);

744 
”rcode_t
 
ext2fs_wr™e_block_b™m­
 (
ext2_fsys
 
fs
);

745 
”rcode_t
 
ext2fs_»ad_šode_b™m­
 (
ext2_fsys
 
fs
);

746 
”rcode_t
 
ext2fs_»ad_block_b™m­
(
ext2_fsys
 
fs
);

747 
”rcode_t
 
ext2fs_®loÿ‹_block_b™m­
(
ext2_fsys
 
fs
,

748 cÚ¡ *
desü
,

749 
ext2fs_block_b™m­
 *
»t
);

750 
”rcode_t
 
ext2fs_®loÿ‹_subşu¡”_b™m­
(
ext2_fsys
 
fs
,

751 cÚ¡ *
desü
,

752 
ext2fs_block_b™m­
 *
»t
);

753 
ext2fs_g‘_b™m­_g¿nuÏr™y
(
ext2fs_block_b™m­
 
b™m­
);

754 
”rcode_t
 
ext2fs_®loÿ‹_šode_b™m­
(
ext2_fsys
 
fs
,

755 cÚ¡ *
desü
,

756 
ext2fs_šode_b™m­
 *
»t
);

757 
”rcode_t
 
ext2fs_fudge_šode_b™m­_’d
(
ext2fs_šode_b™m­
 
b™m­
,

758 
ext2_šo_t
 
’d
,ƒxt2_šo_ˆ*
Ûnd
);

759 
”rcode_t
 
ext2fs_fudge_block_b™m­_’d
(
ext2fs_block_b™m­
 
b™m­
,

760 
blk_t
 
’d
, blk_ˆ*
Ûnd
);

761 
”rcode_t
 
ext2fs_fudge_block_b™m­_’d2
(
ext2fs_block_b™m­
 
b™m­
,

762 
blk64_t
 
’d
, blk64_ˆ*
Ûnd
);

763 
ext2fs_ş—r_šode_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

764 
ext2fs_ş—r_block_b™m­
(
ext2fs_block_b™m­
 
b™m­
);

765 
”rcode_t
 
ext2fs_»ad_b™m­s
(
ext2_fsys
 
fs
);

766 
”rcode_t
 
ext2fs_wr™e_b™m­s
(
ext2_fsys
 
fs
);

767 
”rcode_t
 
ext2fs_»size_šode_b™m­
(
__u32
 
Ãw_’d
, __u32 
Ãw_»®_’d
,

768 
ext2fs_šode_b™m­
 
bm­
);

769 
”rcode_t
 
ext2fs_»size_šode_b™m­2
(
__u64
 
Ãw_’d
,

770 
__u64
 
Ãw_»®_’d
,

771 
ext2fs_šode_b™m­
 
bm­
);

772 
”rcode_t
 
ext2fs_»size_block_b™m­
(
__u32
 
Ãw_’d
, __u32 
Ãw_»®_’d
,

773 
ext2fs_block_b™m­
 
bm­
);

774 
”rcode_t
 
ext2fs_»size_block_b™m­2
(
__u64
 
Ãw_’d
,

775 
__u64
 
Ãw_»®_’d
,

776 
ext2fs_block_b™m­
 
bm­
);

777 
”rcode_t
 
ext2fs_com·»_block_b™m­
(
ext2fs_block_b™m­
 
bm1
,

778 
ext2fs_block_b™m­
 
bm2
);

779 
”rcode_t
 
ext2fs_com·»_šode_b™m­
(
ext2fs_šode_b™m­
 
bm1
,

780 
ext2fs_šode_b™m­
 
bm2
);

781 
”rcode_t
 
ext2fs_£t_šode_b™m­_¿nge
(
ext2fs_šode_b™m­
 
bm­
,

782 
ext2_šo_t
 
¡¬t
, 
num
,

783 *
š
);

784 
”rcode_t
 
ext2fs_£t_šode_b™m­_¿nge2
(
ext2fs_šode_b™m­
 
bm­
,

785 
__u64
 
¡¬t
, 
size_t
 
num
,

786 *
š
);

787 
”rcode_t
 
ext2fs_g‘_šode_b™m­_¿nge
(
ext2fs_šode_b™m­
 
bm­
,

788 
ext2_šo_t
 
¡¬t
, 
num
,

789 *
out
);

790 
”rcode_t
 
ext2fs_g‘_šode_b™m­_¿nge2
(
ext2fs_šode_b™m­
 
bm­
,

791 
__u64
 
¡¬t
, 
size_t
 
num
,

792 *
out
);

793 
”rcode_t
 
ext2fs_£t_block_b™m­_¿nge
(
ext2fs_block_b™m­
 
bm­
,

794 
blk_t
 
¡¬t
, 
num
,

795 *
š
);

796 
”rcode_t
 
ext2fs_£t_block_b™m­_¿nge2
(
ext2fs_block_b™m­
 
bm­
,

797 
blk64_t
 
¡¬t
, 
size_t
 
num
,

798 *
š
);

799 
”rcode_t
 
ext2fs_g‘_block_b™m­_¿nge
(
ext2fs_block_b™m­
 
bm­
,

800 
blk_t
 
¡¬t
, 
num
,

801 *
out
);

802 
”rcode_t
 
ext2fs_g‘_block_b™m­_¿nge2
(
ext2fs_block_b™m­
 
bm­
,

803 
blk64_t
 
¡¬t
, 
size_t
 
num
,

804 *
out
);

807 
dg½_t
 
ext2fs_group_of_blk2
(
ext2_fsys
 
fs
, 
blk64_t
);

808 
blk64_t
 
ext2fs_group_fœ¡_block2
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

809 
blk64_t
 
ext2fs_group_Ï¡_block2
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

810 
ext2fs_group_blocks_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

811 
blk64_t
 
ext2fs_šode_d©a_blocks2
(
ext2_fsys
 
fs
,

812 
ext2_šode
 *
šode
);

813 
blk64_t
 
ext2fs_šode_i_blocks
(
ext2_fsys
 
fs
,

814 
ext2_šode
 *
šode
);

815 
blk64_t
 
ext2fs_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

816 
ext2fs_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

817 
blk64_t
 
blk
);

818 
ext2fs_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

819 
blk64_t
 
blk
);

820 
blk64_t
 
ext2fs_r_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

821 
ext2fs_r_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

822 
blk64_t
 
blk
);

823 
ext2fs_r_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

824 
blk64_t
 
blk
);

825 
blk64_t
 
ext2fs_ä“_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

826 
ext2fs_ä“_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

827 
blk64_t
 
blk
);

828 
ext2fs_ä“_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

829 
blk64_t
 
blk
);

831 
ext2_group_desc
 *
ext2fs_group_desc
(
ext2_fsys
 
fs
,

832 
İaque_ext2_group_desc
 *
gdp
,

833 
dg½_t
 
group
);

834 
blk64_t
 
ext2fs_block_b™m­_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

835 
ext2fs_block_b™m­_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

836 
blk64_t
 
blk
);

837 
blk64_t
 
ext2fs_šode_b™m­_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

838 
ext2fs_šode_b™m­_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

839 
blk64_t
 
blk
);

840 
blk64_t
 
ext2fs_šode_bË_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

841 
ext2fs_šode_bË_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

842 
blk64_t
 
blk
);

843 
__u32
 
ext2fs_bg_ä“_blocks_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

844 
ext2fs_bg_ä“_blocks_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

845 
__u32
 
n
);

846 
__u32
 
ext2fs_bg_ä“_šodes_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

847 
ext2fs_bg_ä“_šodes_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

848 
__u32
 
n
);

849 
__u32
 
ext2fs_bg_u£d_dœs_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

850 
ext2fs_bg_u£d_dœs_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

851 
__u32
 
n
);

852 
__u32
 
ext2fs_bg_™abË_unu£d
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

853 
ext2fs_bg_™abË_unu£d_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

854 
__u32
 
n
);

855 
__u16
 
ext2fs_bg_æags
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

856 
ext2fs_bg_æags_z­
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

857 
ext2fs_bg_æags_‹¡
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æag
);

858 
ext2fs_bg_æags_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æags
);

859 
ext2fs_bg_æags_ş—r
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æags
);

860 
__u16
 
ext2fs_bg_checksum
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

861 
ext2fs_bg_checksum_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
checksum
);

862 
blk64_t
 
ext2fs_fe_aş_block
(
ext2_fsys
 
fs
,

863 cÚ¡ 
ext2_šode
 *
šode
);

864 
ext2fs_fe_aş_block_£t
(
ext2_fsys
 
fs
,

865 
ext2_šode
 *
šode
, 
blk64_t
 
blk
);

868 
”rcode_t
 
ext2fs_block_™”©e
(
ext2_fsys
 
fs
,

869 
ext2_šo_t
 
šo
,

870 
æags
,

871 *
block_buf
,

872 (*
func
)(
ext2_fsys
 
fs
,

873 
blk_t
 *
blockÄ
,

874 
blockút
,

875 *
´iv_d©a
),

876 *
´iv_d©a
);

877 
”rcode_t
 
ext2fs_block_™”©e2
(
ext2_fsys
 
fs
,

878 
ext2_šo_t
 
šo
,

879 
æags
,

880 *
block_buf
,

881 (*
func
)(
ext2_fsys
 
fs
,

882 
blk_t
 *
blockÄ
,

883 
e2_blkút_t
 
blockút
,

884 
blk_t
 
»f_blk
,

885 
»f_off£t
,

886 *
´iv_d©a
),

887 *
´iv_d©a
);

888 
”rcode_t
 
ext2fs_block_™”©e3
(
ext2_fsys
 
fs
,

889 
ext2_šo_t
 
šo
,

890 
æags
,

891 *
block_buf
,

892 (*
func
)(
ext2_fsys
 
fs
,

893 
blk64_t
 *
blockÄ
,

894 
e2_blkút_t
 
blockút
,

895 
blk64_t
 
»f_blk
,

896 
»f_off£t
,

897 *
´iv_d©a
),

898 *
´iv_d©a
);

901 
”rcode_t
 
ext2fs_bm­
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

902 
ext2_šode
 *
šode
,

903 *
block_buf
, 
bm­_æags
,

904 
blk_t
 
block
, blk_ˆ*
phys_blk
);

905 
”rcode_t
 
ext2fs_bm­2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

906 
ext2_šode
 *
šode
,

907 *
block_buf
, 
bm­_æags
, 
blk64_t
 
block
,

908 *
»t_æags
, 
blk64_t
 *
phys_blk
);

909 
”rcode_t
 
ext2fs_m­_şu¡”_block
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

910 
ext2_šode
 *
šode
, 
blk64_t
 
lblk
,

911 
blk64_t
 *
pblk
);

915 
”rcode_t
 
ext2fs_move_blocks
(
ext2_fsys
 
fs
,

916 
ext2fs_block_b™m­
 
»£rve
,

917 
ext2fs_block_b™m­
 
®loc_m­
,

918 
æags
);

922 
”rcode_t
 
ext2fs_check_desc
(
ext2_fsys
 
fs
);

925 
”rcode_t
 
ext2fs_şo£
(
ext2_fsys
 
fs
);

926 
”rcode_t
 
ext2fs_şo£2
(
ext2_fsys
 
fs
, 
æags
);

927 
”rcode_t
 
ext2fs_æush
(
ext2_fsys
 
fs
);

928 
”rcode_t
 
ext2fs_æush2
(
ext2_fsys
 
fs
, 
æags
);

929 
ext2fs_bg_has_su³r
(
ext2_fsys
 
fs
, 
dg½_t
 
group_block
);

930 
”rcode_t
 
ext2fs_su³r_ªd_bgd_loc2
(
ext2_fsys
 
fs
,

931 
dg½_t
 
group
,

932 
blk64_t
 *
»t_su³r_blk
,

933 
blk64_t
 *
»t_Şd_desc_blk
,

934 
blk64_t
 *
»t_Ãw_desc_blk
,

935 
blk_t
 *
»t_u£d_blks
);

936 
ext2fs_su³r_ªd_bgd_loc
(
ext2_fsys
 
fs
,

937 
dg½_t
 
group
,

938 
blk_t
 *
»t_su³r_blk
,

939 
blk_t
 *
»t_Şd_desc_blk
,

940 
blk_t
 *
»t_Ãw_desc_blk
,

941 *
»t_m‘a_bg
);

942 
ext2fs_upd©e_dyÇmic_»v
(
ext2_fsys
 
fs
);

945 
__u32
 
ext2fs_üc32c_be
(__u32 
üc
, cÚ¡ *
p
, 
size_t
 
Ën
);

946 
__u32
 
ext2fs_üc32c_Ë
(__u32 
üc
, cÚ¡ *
p
, 
size_t
 
Ën
);

949 
ext2fs_group_desc_csum_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

950 
ext2fs_group_desc_csum_v”ify
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

951 
”rcode_t
 
ext2fs_£t_gdt_csum
(
ext2_fsys
 
fs
);

952 
__u16
 
ext2fs_group_desc_csum
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

956 
”rcode_t
 
ext2fs_g‘_num_dœs
(
ext2_fsys
 
fs
, 
ext2_šo_t
 *
»t_num_dœs
);

957 
”rcode_t
 
ext2fs_š™_dbli¡
(
ext2_fsys
 
fs
, 
ext2_dbli¡
 *
»t_dbli¡
);

958 
”rcode_t
 
ext2fs_add_dœ_block
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

959 
blk_t
 
blk
, 
blockút
);

960 
”rcode_t
 
ext2fs_add_dœ_block2
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

961 
blk64_t
 
blk
, 
e2_blkút_t
 
blockút
);

962 
ext2fs_dbli¡_sÜt
(
ext2_dbli¡
 
dbli¡
,

963 
EXT2_QSORT_TYPE
 (*
sÜtfunc
)(const *,

965 
ext2fs_dbli¡_sÜt2
(
ext2_dbli¡
 
dbli¡
,

966 
EXT2_QSORT_TYPE
 (*
sÜtfunc
)(const *,

968 
”rcode_t
 
ext2fs_dbli¡_™”©e
(
ext2_dbli¡
 
dbli¡
,

969 (*
func
)(
ext2_fsys
 
fs
, 
ext2_db_’Œy
 *
db_šfo
,

970 *
´iv_d©a
),

971 *
´iv_d©a
);

972 
”rcode_t
 
ext2fs_dbli¡_™”©e2
(
ext2_dbli¡
 
dbli¡
,

973 (*
func
)(
ext2_fsys
 
fs
, 
ext2_db_’Œy2
 *
db_šfo
,

974 *
´iv_d©a
),

975 *
´iv_d©a
);

976 
”rcode_t
 
ext2fs_£t_dœ_block
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

977 
blk_t
 
blk
, 
blockút
);

978 
”rcode_t
 
ext2fs_£t_dœ_block2
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

979 
blk64_t
 
blk
, 
e2_blkút_t
 
blockút
);

980 
”rcode_t
 
ext2fs_cİy_dbli¡
(
ext2_dbli¡
 
¤c
,

981 
ext2_dbli¡
 *
de¡
);

982 
ext2fs_dbli¡_couÁ
(
ext2_dbli¡
 
dbli¡
);

983 
blk64_t
 
ext2fs_dbli¡_couÁ2
(
ext2_dbli¡
 
dbli¡
);

984 
”rcode_t
 
ext2fs_dbli¡_g‘_Ï¡
(
ext2_dbli¡
 
dbli¡
,

985 
ext2_db_’Œy
 **
’Œy
);

986 
”rcode_t
 
ext2fs_dbli¡_g‘_Ï¡2
(
ext2_dbli¡
 
dbli¡
,

987 
ext2_db_’Œy2
 **
’Œy
);

988 
”rcode_t
 
ext2fs_dbli¡_drİ_Ï¡
(
ext2_dbli¡
 
dbli¡
);

991 
”rcode_t


992 
ext2fs_dbli¡_dœ_™”©e
(
ext2_dbli¡
 
dbli¡
,

993 
æags
,

994 *
block_buf
,

995 (*
func
)(
ext2_šo_t
 
dœ
,

996 
’Œy
,

997 
ext2_dœ_’Œy
 *
dœ’t
,

998 
off£t
,

999 
blocksize
,

1000 *
buf
,

1001 *
´iv_d©a
),

1002 *
´iv_d©a
);

1005 
”rcode_t
 
ext2fs_»ad_dœ_block
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1006 *
buf
);

1007 
”rcode_t
 
ext2fs_»ad_dœ_block2
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1008 *
buf
, 
æags
);

1009 
”rcode_t
 
ext2fs_»ad_dœ_block3
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1010 *
buf
, 
æags
);

1011 
”rcode_t
 
ext2fs_wr™e_dœ_block
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1012 *
buf
);

1013 
”rcode_t
 
ext2fs_wr™e_dœ_block2
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1014 *
buf
, 
æags
);

1015 
”rcode_t
 
ext2fs_wr™e_dœ_block3
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1016 *
buf
, 
æags
);

1019 
”rcode_t
 
ext2fs_dœhash
(
v”siÚ
, cÚ¡ *
Çme
, 
Ën
,

1020 cÚ¡ 
__u32
 *
£ed
,

1021 
ext2_dœhash_t
 *
»t_hash
,

1022 
ext2_dœhash_t
 *
»t_mšÜ_hash
);

1026 
”rcode_t
 
ext2fs_g‘_»c_Ën
(
ext2_fsys
 
fs
,

1027 
ext2_dœ_’Œy
 *
dœ’t
,

1028 *
»c_Ën
);

1029 
”rcode_t
 
ext2fs_£t_»c_Ën
(
ext2_fsys
 
fs
,

1030 
Ën
,

1031 
ext2_dœ_’Œy
 *
dœ’t
);

1032 
”rcode_t
 
ext2fs_dœ_™”©e
(
ext2_fsys
 
fs
,

1033 
ext2_šo_t
 
dœ
,

1034 
æags
,

1035 *
block_buf
,

1036 (*
func
)(
ext2_dœ_’Œy
 *
dœ’t
,

1037 
off£t
,

1038 
blocksize
,

1039 *
buf
,

1040 *
´iv_d©a
),

1041 *
´iv_d©a
);

1042 
”rcode_t
 
ext2fs_dœ_™”©e2
(
ext2_fsys
 
fs
,

1043 
ext2_šo_t
 
dœ
,

1044 
æags
,

1045 *
block_buf
,

1046 (*
func
)(
ext2_šo_t
 
dœ
,

1047 
’Œy
,

1048 
ext2_dœ_’Œy
 *
dœ’t
,

1049 
off£t
,

1050 
blocksize
,

1051 *
buf
,

1052 *
´iv_d©a
),

1053 *
´iv_d©a
);

1056 
”rcode_t
 
ext2fs_dup_hªdË
(
ext2_fsys
 
¤c
,ƒxt2_fsy *
de¡
);

1059 
”rcode_t
 
ext2fs_ex·nd_dœ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
);

1062 
__u32
 
ext2fs_ext_©Œ_hash_’Œy
(
ext2_ext_©Œ_’Œy
 *
’Œy
,

1063 *
d©a
);

1064 
”rcode_t
 
ext2fs_»ad_ext_©Œ
(
ext2_fsys
 
fs
, 
blk_t
 
block
, *
buf
);

1065 
”rcode_t
 
ext2fs_»ad_ext_©Œ2
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1066 *
buf
);

1067 
”rcode_t
 
ext2fs_wr™e_ext_©Œ
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1068 *
buf
);

1069 
”rcode_t
 
ext2fs_wr™e_ext_©Œ2
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1070 *
buf
);

1071 
”rcode_t
 
ext2fs_adju¡_—_»fcouÁ
(
ext2_fsys
 
fs
, 
blk_t
 
blk
,

1072 *
block_buf
,

1073 
adju¡
, 
__u32
 *
ÃwcouÁ
);

1074 
”rcode_t
 
ext2fs_adju¡_—_»fcouÁ2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
,

1075 *
block_buf
,

1076 
adju¡
, 
__u32
 *
ÃwcouÁ
);

1079 
”rcode_t
 
ext2fs_ex‹Á_h—d”_v”ify
(*
±r
, 
size
);

1080 
”rcode_t
 
ext2fs_ex‹Á_İ’
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1081 
ext2_ex‹Á_hªdË_t
 *
hªdË
);

1082 
”rcode_t
 
ext2fs_ex‹Á_İ’2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1083 
ext2_šode
 *
šode
,

1084 
ext2_ex‹Á_hªdË_t
 *
»t_hªdË
);

1085 
ext2fs_ex‹Á_ä“
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1086 
”rcode_t
 
ext2fs_ex‹Á_g‘
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1087 
æags
, 
ext2fs_ex‹Á
 *
ex‹Á
);

1088 
”rcode_t
 
ext2fs_ex‹Á_node_¥l™
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1089 
”rcode_t
 
ext2fs_ex‹Á_»¶aû
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
,

1090 
ext2fs_ex‹Á
 *
ex‹Á
);

1091 
”rcode_t
 
ext2fs_ex‹Á_š£¹
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
,

1092 
ext2fs_ex‹Á
 *
ex‹Á
);

1093 
”rcode_t
 
ext2fs_ex‹Á_£t_bm­
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1094 
blk64_t
 
logiÿl
, blk64_ˆ
physiÿl
,

1095 
æags
);

1096 
”rcode_t
 
ext2fs_ex‹Á_d–‘e
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
);

1097 
”rcode_t
 
ext2fs_ex‹Á_g‘_šfo
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1098 
ext2_ex‹Á_šfo
 *
šfo
);

1099 
”rcode_t
 
ext2fs_ex‹Á_gÙo
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1100 
blk64_t
 
blk
);

1101 
”rcode_t
 
ext2fs_ex‹Á_gÙo2
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1102 
Ëaf_Ëv–
, 
blk64_t
 
blk
);

1103 
”rcode_t
 
ext2fs_ex‹Á_fix_·»Ás
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1106 
”rcode_t
 
ext2fs_fe_İ’2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1107 
ext2_šode
 *
šode
,

1108 
æags
, 
ext2_fe_t
 *
»t
);

1109 
”rcode_t
 
ext2fs_fe_İ’
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1110 
æags
, 
ext2_fe_t
 *
»t
);

1111 
ext2_fsys
 
ext2fs_fe_g‘_fs
(
ext2_fe_t
 
fe
);

1112 
ext2_šode
 *
ext2fs_fe_g‘_šode
(
ext2_fe_t
 
fe
);

1113 
ext2_šo_t
 
ext2fs_fe_g‘_šode_num
(
ext2_fe_t
 
fe
);

1114 
”rcode_t
 
ext2fs_fe_şo£
(
ext2_fe_t
 
fe
);

1115 
”rcode_t
 
ext2fs_fe_æush
(
ext2_fe_t
 
fe
);

1116 
”rcode_t
 
ext2fs_fe_»ad
(
ext2_fe_t
 
fe
, *
buf
,

1117 
wª‹d
, *
gÙ
);

1118 
”rcode_t
 
ext2fs_fe_wr™e
(
ext2_fe_t
 
fe
, cÚ¡ *
buf
,

1119 
nby‹s
, *
wr™‹n
);

1120 
”rcode_t
 
ext2fs_fe_Î£ek
(
ext2_fe_t
 
fe
, 
__u64
 
off£t
,

1121 
wh’û
, 
__u64
 *
»t_pos
);

1122 
”rcode_t
 
ext2fs_fe_l£ek
(
ext2_fe_t
 
fe
, 
ext2_off_t
 
off£t
,

1123 
wh’û
, 
ext2_off_t
 *
»t_pos
);

1124 
”rcode_t
 
ext2fs_fe_g‘_lsize
(
ext2_fe_t
 
fe
, 
__u64
 *
»t_size
);

1125 
ext2_off_t
 
ext2fs_fe_g‘_size
(
ext2_fe_t
 
fe
);

1126 
”rcode_t
 
ext2fs_fe_£t_size
(
ext2_fe_t
 
fe
, 
ext2_off_t
 
size
);

1127 
”rcode_t
 
ext2fs_fe_£t_size2
(
ext2_fe_t
 
fe
, 
ext2_off64_t
 
size
);

1130 *
ext2fs_fšd_block_deviû
(
dev_t
 
deviû
);

1133 
”rcode_t
 
ext2fs_sync_deviû
(
fd
, 
æushb
);

1136 
ext2fs_ä“
(
ext2_fsys
 
fs
);

1137 
ext2fs_ä“_dbli¡
(
ext2_dbli¡
 
dbli¡
);

1138 
ext2fs_badblocks_li¡_ä“
(
ext2_badblocks_li¡
 
bb
);

1139 
ext2fs_u32_li¡_ä“
(
ext2_u32_li¡
 
bb
);

1142 
ext2fs_ä“_g’”ic_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

1143 
”rcode_t
 
ext2fs_make_g’”ic_b™m­
Ó¼code_ˆ
magic
, 
ext2_fsys
 
fs
,

1144 
__u32
 
¡¬t
, __u32 
’d
,

1145 
__u32
 
»®_’d
,

1146 cÚ¡ *
desü
, *
š™_m­
,

1147 
ext2fs_g’”ic_b™m­
 *
»t
);

1148 
”rcode_t
 
ext2fs_®loÿ‹_g’”ic_b™m­
(
__u32
 
¡¬t
,

1149 
__u32
 
’d
,

1150 
__u32
 
»®_’d
,

1151 cÚ¡ *
desü
,

1152 
ext2fs_g’”ic_b™m­
 *
»t
);

1153 
”rcode_t
 
ext2fs_cİy_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
¤c
,

1154 
ext2fs_g’”ic_b™m­
 *
de¡
);

1155 
ext2fs_ş—r_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
b™m­
);

1156 
”rcode_t
 
ext2fs_fudge_g’”ic_b™m­_’d
(
ext2fs_šode_b™m­
 
b™m­
,

1157 
”rcode_t
 
magic
,

1158 
”rcode_t
 
Ãq
,

1159 
ext2_šo_t
 
’d
,

1160 
ext2_šo_t
 *
Ûnd
);

1161 
ext2fs_£t_g’”ic_b™m­_·ddšg
(
ext2fs_g’”ic_b™m­
 
m­
);

1162 
”rcode_t
 
ext2fs_»size_g’”ic_b™m­
Ó¼code_ˆ
magic
,

1163 
__u32
 
Ãw_’d
,

1164 
__u32
 
Ãw_»®_’d
,

1165 
ext2fs_g’”ic_b™m­
 
bm­
);

1166 
”rcode_t
 
ext2fs_com·»_g’”ic_b™m­
Ó¼code_ˆ
magic
,ƒ¼code_ˆ
Ãq
,

1167 
ext2fs_g’”ic_b™m­
 
bm1
,

1168 
ext2fs_g’”ic_b™m­
 
bm2
);

1169 
”rcode_t
 
ext2fs_g‘_g’”ic_b™m­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1170 
”rcode_t
 
magic
,

1171 
__u32
 
¡¬t
, __u32 
num
,

1172 *
out
);

1173 
”rcode_t
 
ext2fs_£t_g’”ic_b™m­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1174 
”rcode_t
 
magic
,

1175 
__u32
 
¡¬t
, __u32 
num
,

1176 *
š
);

1177 
”rcode_t
 
ext2fs_fšd_fœ¡_z”o_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

1178 
__u32
 
¡¬t
, __u32 
’d
,

1179 
__u32
 *
out
);

1184 
	#BMAP_STATS


	)

1186 
ext2fs_ä“_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
);

1187 
”rcode_t
 
ext2fs_®loc_g’”ic_bm­
(
ext2_fsys
 
fs
,ƒ¼code_ˆ
magic
,

1188 
ty³
, 
__u64
 
¡¬t
, __u64 
’d
,

1189 
__u64
 
»®_’d
,

1190 cÚ¡ *
desü
,

1191 
ext2fs_g’”ic_b™m­
 *
»t
);

1192 
”rcode_t
 
ext2fs_cİy_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
¤c
,

1193 
ext2fs_g’”ic_b™m­
 *
de¡
);

1194 
ext2fs_ş—r_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
);

1195 
”rcode_t
 
ext2fs_fudge_g’”ic_bm­_’d
(
ext2fs_g’”ic_b™m­
 
b™m­
,

1196 
”rcode_t
 
Ãq
,

1197 
__u64
 
’d
, __u64 *
Ûnd
);

1198 
ext2fs_£t_g’”ic_bm­_·ddšg
(
ext2fs_g’”ic_b™m­
 
bm­
);

1199 
”rcode_t
 
ext2fs_»size_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
,

1200 
__u64
 
Ãw_’d
,

1201 
__u64
 
Ãw_»®_’d
);

1202 
”rcode_t
 
ext2fs_com·»_g’”ic_bm­
Ó¼code_ˆ
Ãq
,

1203 
ext2fs_g’”ic_b™m­
 
bm1
,

1204 
ext2fs_g’”ic_b™m­
 
bm2
);

1205 
”rcode_t
 
ext2fs_g‘_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1206 
__u64
 
¡¬t
, 
num
,

1207 *
out
);

1208 
”rcode_t
 
ext2fs_£t_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1209 
__u64
 
¡¬t
, 
num
,

1210 *
š
);

1211 
”rcode_t
 
ext2fs_cÚv”t_subşu¡”_b™m­
(
ext2_fsys
 
fs
,

1212 
ext2fs_block_b™m­
 *
b™m­
);

1215 
”rcode_t
 
ext2fs_g‘_deviû_size
(cÚ¡ *
fe
, 
blocksize
,

1216 
blk_t
 *
»tblocks
);

1217 
”rcode_t
 
ext2fs_g‘_deviû_size2
(cÚ¡ *
fe
, 
blocksize
,

1218 
blk64_t
 *
»tblocks
);

1221 
ext2fs_g‘_dio_®ignm’t
(
fd
);

1222 
”rcode_t
 
ext2fs_g‘_deviû_£ùsize
(cÚ¡ *
fe
, *
£ùsize
);

1223 
”rcode_t
 
ext2fs_g‘_deviû_phys_£ùsize
(cÚ¡ *
fe
, *
£ùsize
);

1226 
”rcode_t
 
ext2fs_iblk_add_blocks
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
,

1227 
blk64_t
 
num_blocks
);

1228 
”rcode_t
 
ext2fs_iblk_sub_blocks
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
,

1229 
blk64_t
 
num_blocks
);

1230 
”rcode_t
 
ext2fs_iblk_£t
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
, 
blk64_t
 
b
);

1233 
”rcode_t
 
ext2fs_image_šode_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1234 
”rcode_t
 
ext2fs_image_šode_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1235 
”rcode_t
 
ext2fs_image_su³r_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1236 
”rcode_t
 
ext2fs_image_su³r_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1237 
”rcode_t
 
ext2fs_image_b™m­_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1238 
”rcode_t
 
ext2fs_image_b™m­_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1241 
”rcode_t
 
ext2fs_»ad_šd_block
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, *
buf
);

1242 
”rcode_t
 
ext2fs_wr™e_šd_block
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, *
buf
);

1245 
”rcode_t
 
ext2fs_š™Ÿlize
(cÚ¡ *
Çme
, 
æags
,

1246 
ext2_su³r_block
 *
·¿m
,

1247 
io_mªag”
 
mªag”
, 
ext2_fsys
 *
»t_fs
);

1250 
ext2fs_ä“_icouÁ
(
ext2_icouÁ_t
 
icouÁ
);

1251 
”rcode_t
 
ext2fs_ü—‹_icouÁ_tdb
(
ext2_fsys
 
fs
, *
tdb_dœ
,

1252 
æags
, 
ext2_icouÁ_t
 *
»t
);

1253 
”rcode_t
 
ext2fs_ü—‹_icouÁ2
(
ext2_fsys
 
fs
, 
æags
,

1254 
size
,

1255 
ext2_icouÁ_t
 
hšt
,ƒxt2_icouÁ_ˆ*
»t
);

1256 
”rcode_t
 
ext2fs_ü—‹_icouÁ
(
ext2_fsys
 
fs
, 
æags
,

1257 
size
,

1258 
ext2_icouÁ_t
 *
»t
);

1259 
”rcode_t
 
ext2fs_icouÁ_ãtch
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1260 
__u16
 *
»t
);

1261 
”rcode_t
 
ext2fs_icouÁ_šüem’t
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1262 
__u16
 *
»t
);

1263 
”rcode_t
 
ext2fs_icouÁ_deüem’t
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1264 
__u16
 *
»t
);

1265 
”rcode_t
 
ext2fs_icouÁ_¡Üe
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1266 
__u16
 
couÁ
);

1267 
ext2_šo_t
 
ext2fs_g‘_icouÁ_size
(
ext2_icouÁ_t
 
icouÁ
);

1268 
”rcode_t
 
ext2fs_icouÁ_v®id©e
(
ext2_icouÁ_t
 
icouÁ
, 
FILE
 *);

1272 
”rcode_t
 
ext2fs_g‘_mem®ign
(
size
,

1273 
®ign
, *
±r
);

1276 
”rcode_t
 
ext2fs_æush_iÿche
(
ext2_fsys
 
fs
);

1277 
”rcode_t
 
ext2fs_g‘_Ãxt_šode_fuÎ
(
ext2_šode_sÿn
 
sÿn
,

1278 
ext2_šo_t
 *
šo
,

1279 
ext2_šode
 *
šode
,

1280 
bufsize
);

1281 
”rcode_t
 
ext2fs_İ’_šode_sÿn
(
ext2_fsys
 
fs
, 
bufãr_blocks
,

1282 
ext2_šode_sÿn
 *
»t_sÿn
);

1283 
ext2fs_şo£_šode_sÿn
(
ext2_šode_sÿn
 
sÿn
);

1284 
”rcode_t
 
ext2fs_g‘_Ãxt_šode
(
ext2_šode_sÿn
 
sÿn
, 
ext2_šo_t
 *
šo
,

1285 
ext2_šode
 *
šode
);

1286 
”rcode_t
 
ext2fs_šode_sÿn_gÙo_blockgroup
(
ext2_šode_sÿn
 
sÿn
,

1287 
group
);

1288 
ext2fs_£t_šode_ÿÎback


1289 (
ext2_šode_sÿn
 
sÿn
,

1290 
”rcode_t
 (*
dÚe_group
)(
ext2_fsys
 
fs
,

1291 
ext2_šode_sÿn
 
sÿn
,

1292 
dg½_t
 
group
,

1293 * 
´iv_d©a
),

1294 *
dÚe_group_d©a
);

1295 
ext2fs_šode_sÿn_æags
(
ext2_šode_sÿn
 
sÿn
, 
£t_æags
,

1296 
ş—r_æags
);

1297 
”rcode_t
 
ext2fs_»ad_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1298 
ext2_šode
 * 
šode
,

1299 
bufsize
);

1300 
”rcode_t
 
ext2fs_»ad_šode
 (
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1301 
ext2_šode
 * 
šode
);

1302 
”rcode_t
 
ext2fs_wr™e_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1303 
ext2_šode
 * 
šode
,

1304 
bufsize
);

1305 
”rcode_t
 
ext2fs_wr™e_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1306 
ext2_šode
 * 
šode
);

1307 
”rcode_t
 
ext2fs_wr™e_Ãw_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1308 
ext2_šode
 * 
šode
);

1309 
”rcode_t
 
ext2fs_g‘_blocks
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
blk_t
 *
blocks
);

1310 
”rcode_t
 
ext2fs_check_dœeùÜy
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

1313 
io_mªag”
 
šode_io_mªag”
;

1314 
”rcode_t
 
ext2fs_šode_io_š‹º
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1315 **
Çme
);

1316 
”rcode_t
 
ext2fs_šode_io_š‹º2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1317 
ext2_šode
 *
šode
,

1318 **
Çme
);

1321 
”rcode_t
 
ext2fs_check_if_mouÁed
(cÚ¡ *
fe
, *
mouÁ_æags
);

1322 
”rcode_t
 
ext2fs_check_mouÁ_pošt
(cÚ¡ *
deviû
, *
mouÁ_æags
,

1323 *
mt
, 
m’
);

1330 
”rcode_t
 
ext2fs_punch
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1331 
ext2_šode
 *
šode
,

1332 *
block_buf
, 
blk64_t
 
¡¬t
,

1333 
blk64_t
 
’d
);

1336 
”rcode_t
 
ext2fs_lookup
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1337 
Çm–’
, *
buf
, 
ext2_šo_t
 *
šode
);

1338 
”rcode_t
 
ext2fs_Çmei
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1339 cÚ¡ *
Çme
, 
ext2_šo_t
 *
šode
);

1340 
”rcode_t
 
ext2fs_Çmei_fŞlow
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1341 cÚ¡ *
Çme
, 
ext2_šo_t
 *
šode
);

1342 
”rcode_t
 
ext2fs_fŞlow_lšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1343 
ext2_šo_t
 
šode
,ƒxt2_šo_ˆ*
»s_šode
);

1346 
ext2fs_Çtive_æag
();

1349 
”rcode_t
 
ext2fs_Ãw_dœ_block
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ_šo
,

1350 
ext2_šo_t
 
·»Á_šo
, **
block
);

1353 
”rcode_t
 
ext2fs_mkdœ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
·»Á
,ƒxt2_šo_ˆ
šum
,

1354 cÚ¡ *
Çme
);

1357 
”rcode_t
 
ext2fs_z”o_blocks
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, 
num
,

1358 
blk_t
 *
»t_blk
, *
»t_couÁ
);

1359 
”rcode_t
 
ext2fs_z”o_blocks2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
num
,

1360 
blk64_t
 *
»t_blk
, *
»t_couÁ
);

1361 
”rcode_t
 
ext2fs_ü—‹_jouº®_su³rblock
(
ext2_fsys
 
fs
,

1362 
__u32
 
num_blocks
, 
æags
,

1363 **
»t_jsb
);

1364 
”rcode_t
 
ext2fs_add_jouº®_deviû
(
ext2_fsys
 
fs
,

1365 
ext2_fsys
 
jouº®_dev
);

1366 
”rcode_t
 
ext2fs_add_jouº®_šode
(
ext2_fsys
 
fs
, 
blk_t
 
num_blocks
,

1367 
æags
);

1368 
ext2fs_deçuÉ_jouº®_size
(
__u64
 
num_blocks
);

1371 
”rcode_t
 
ext2fs_İ’
(cÚ¡ *
Çme
, 
æags
, 
su³rblock
,

1372 
block_size
, 
io_mªag”
 
mªag”
,

1373 
ext2_fsys
 *
»t_fs
);

1374 
”rcode_t
 
ext2fs_İ’2
(cÚ¡ *
Çme
, cÚ¡ *
io_İtiÚs
,

1375 
æags
, 
su³rblock
,

1376 
block_size
, 
io_mªag”
 
mªag”
,

1377 
ext2_fsys
 *
»t_fs
);

1378 
blk64_t
 
ext2fs_desütÜ_block_loc2
(
ext2_fsys
 
fs
,

1379 
blk64_t
 
group_block
, 
dg½_t
 
i
);

1380 
blk_t
 
ext2fs_desütÜ_block_loc
(
ext2_fsys
 
fs
, blk_ˆ
group_block
,

1381 
dg½_t
 
i
);

1382 
”rcode_t
 
ext2fs_g‘_d©a_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 *
Şd_io
);

1383 
”rcode_t
 
ext2fs_£t_d©a_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 
Ãw_io
);

1384 
”rcode_t
 
ext2fs_»wr™e_to_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 
Ãw_io
);

1387 
”rcode_t
 
ext2fs_g‘_·thÇme
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
,ƒxt2_šo_ˆ
šo
,

1388 **
Çme
);

1391 
”rcode_t
 
ext2fs_lšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1392 
ext2_šo_t
 
šo
, 
æags
);

1393 
”rcode_t
 
ext2fs_uÆšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1394 
ext2_šo_t
 
šo
, 
æags
);

1397 
”rcode_t
 
ext2fs_symlšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
·»Á
,ƒxt2_šo_ˆ
šo
,

1398 cÚ¡ *
Çme
, *
rg‘
);

1401 
”rcode_t
 
ext2fs_mmp_»ad
(
ext2_fsys
 
fs
, 
blk64_t
 
mmp_blk
, *
buf
);

1402 
”rcode_t
 
ext2fs_mmp_wr™e
(
ext2_fsys
 
fs
, 
blk64_t
 
mmp_blk
, *
buf
);

1403 
”rcode_t
 
ext2fs_mmp_ş—r
(
ext2_fsys
 
fs
);

1404 
”rcode_t
 
ext2fs_mmp_š™
(
ext2_fsys
 
fs
);

1405 
”rcode_t
 
ext2fs_mmp_¡¬t
(
ext2_fsys
 
fs
);

1406 
”rcode_t
 
ext2fs_mmp_upd©e
(
ext2_fsys
 
fs
);

1407 
”rcode_t
 
ext2fs_mmp_¡İ
(
ext2_fsys
 
fs
);

1408 
ext2fs_mmp_Ãw_£q
();

1411 
”rcode_t
 
ext2fs_»ad_bb_šode
(
ext2_fsys
 
fs
,

1412 
ext2_badblocks_li¡
 *
bb_li¡
);

1415 
”rcode_t
 
ext2fs_»ad_bb_FILE2
(
ext2_fsys
 
fs
, 
FILE
 *
f
,

1416 
ext2_badblocks_li¡
 *
bb_li¡
,

1417 *
´iv_d©a
,

1418 (*
šv®id
)(
ext2_fsys
 
fs
,

1419 
blk_t
 
blk
,

1420 *
bad¡r
,

1421 *
´iv_d©a
));

1422 
”rcode_t
 
ext2fs_»ad_bb_FILE
(
ext2_fsys
 
fs
, 
FILE
 *
f
,

1423 
ext2_badblocks_li¡
 *
bb_li¡
,

1424 (*
šv®id
)(
ext2_fsys
 
fs
,

1425 
blk_t
 
blk
));

1428 
”rcode_t
 
ext2fs_ü—‹_»size_šode
(
ext2_fsys
 
fs
);

1431 
ext2fs_sw­_ext_©Œ
(*
to
, *
äom
, 
bufsize
,

1432 
has_h—d”
);

1433 
ext2fs_sw­_ext_©Œ_h—d”
(
ext2_ext_©Œ_h—d”
 *
to_h—d”
,

1434 
ext2_ext_©Œ_h—d”
 *
äom_hdr
);

1435 
ext2fs_sw­_ext_©Œ_’Œy
(
ext2_ext_©Œ_’Œy
 *
to_’Œy
,

1436 
ext2_ext_©Œ_’Œy
 *
äom_’Œy
);

1437 
ext2fs_sw­_su³r
(
ext2_su³r_block
 * 
su³r
);

1438 
ext2fs_sw­_group_desc
(
ext2_group_desc
 *
gdp
);

1439 
ext2fs_sw­_group_desc2
(
ext2_fsys
, 
ext2_group_desc
 *
gdp
);

1440 
ext2fs_sw­_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šode_Ïrge
 *
t
,

1441 
ext2_šode_Ïrge
 *
f
, 
ho¡Üd”
,

1442 
bufsize
);

1443 
ext2fs_sw­_šode
(
ext2_fsys
 
fs
,
ext2_šode
 *
t
,

1444 
ext2_šode
 *
f
, 
ho¡Üd”
);

1445 
ext2fs_sw­_mmp
(
mmp_¡ruù
 *
mmp
);

1448 
ext2fs_İ’_fe
(cÚ¡ *
·thÇme
, 
æags
, 
mode_t
 
mode
);

1449 
ext2fs_¡©
(cÚ¡ *
·th
, 
ext2fs_¡ruù_¡©
 *
buf
);

1450 
ext2fs_f¡©
(
fd
, 
ext2fs_¡ruù_¡©
 *
buf
);

1453 
ext2fs_šode_has_v®id_blocks
(
ext2_šode
 *
šode
);

1454 
ext2fs_šode_has_v®id_blocks2
(
ext2_fsys
 
fs
,

1455 
ext2_šode
 *
šode
);

1458 
ext2fs_·r£_v”siÚ_¡ršg
(cÚ¡ *
v”_¡ršg
);

1459 
ext2fs_g‘_lib¿ry_v”siÚ
(cÚ¡ **
v”_¡ršg
,

1460 cÚ¡ **
d©e_¡ršg
);

1463 
”rcode_t
 
ext2fs_wr™e_bb_FILE
(
ext2_badblocks_li¡
 
bb_li¡
,

1464 
æags
,

1465 
FILE
 *
f
);

1469 #ifdeà
NO_INLINE_FUNCS


1470 
”rcode_t
 
ext2fs_g‘_mem
(
size
, *
±r
);

1471 
”rcode_t
 
ext2fs_g‘_memz”o
(
size
, *
±r
);

1472 
”rcode_t
 
ext2fs_g‘_¬¿y
(
couÁ
,

1473 
size
, *
±r
);

1474 
”rcode_t
 
ext2fs_g‘_¬¿yz”o
(
couÁ
,

1475 
size
, *
±r
);

1476 
”rcode_t
 
ext2fs_ä“_mem
(*
±r
);

1477 
”rcode_t
 
ext2fs_»size_mem
(
Şd_size
,

1478 
size
, *
±r
);

1479 
ext2fs_m¬k_su³r_dœty
(
ext2_fsys
 
fs
);

1480 
ext2fs_m¬k_chªged
(
ext2_fsys
 
fs
);

1481 
ext2fs_‹¡_chªged
(
ext2_fsys
 
fs
);

1482 
ext2fs_m¬k_v®id
(
ext2_fsys
 
fs
);

1483 
ext2fs_unm¬k_v®id
(
ext2_fsys
 
fs
);

1484 
ext2fs_‹¡_v®id
(
ext2_fsys
 
fs
);

1485 
ext2fs_m¬k_ib_dœty
(
ext2_fsys
 
fs
);

1486 
ext2fs_m¬k_bb_dœty
(
ext2_fsys
 
fs
);

1487 
ext2fs_‹¡_ib_dœty
(
ext2_fsys
 
fs
);

1488 
ext2fs_‹¡_bb_dœty
(
ext2_fsys
 
fs
);

1489 
dg½_t
 
ext2fs_group_of_blk
(
ext2_fsys
 
fs
, 
blk_t
 
blk
);

1490 
dg½_t
 
ext2fs_group_of_šo
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

1491 
blk_t
 
ext2fs_group_fœ¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

1492 
blk_t
 
ext2fs_group_Ï¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

1493 
blk_t
 
ext2fs_šode_d©a_blocks
(
ext2_fsys
 
fs
,

1494 
ext2_šode
 *
šode
);

1495 
ext2fs_div_û
(
a
, 
b
);

1496 
__u64
 
ext2fs_div64_û
(__u64 
a
, __u64 
b
);

1505 #ià(
defšed
(
INCLUDE_INLINE_FUNCS
è|| !defšed(
NO_INLINE_FUNCS
))

1506 #ifdeà
INCLUDE_INLINE_FUNCS


1507 
	#_INLINE_
 

	)

1509 #ià(
__STDC_VERSION__
 >= 199901L)

1510 
	#_INLINE_
 
šlše


	)

1512 #ifdeà
__GNUC__


1513 
	#_INLINE_
 
__šlše__


	)

1515 
	#_INLINE_
 
šlše


	)

1520 #iâdeà
EXT2_CUSTOM_MEMORY_ROUTINES


1521 
	~<¡ršg.h
>

1525 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_mem
(
size
, *
±r
)

1527 *
µ
;

1529 
µ
 = 
m®loc
(
size
);

1530 ià(!
µ
)

1531  
EXT2_ET_NO_MEMORY
;

1532 
memıy
(
±r
, &
µ
,  (pp));

1536 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_memz”o
(
size
, *
±r
)

1538 *
µ
;

1540 
µ
 = 
m®loc
(
size
);

1541 ià(!
µ
)

1542  
EXT2_ET_NO_MEMORY
;

1543 
mem£t
(
µ
, 0, 
size
);

1544 
memıy
(
±r
, &
µ
, (pp));

1548 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_¬¿y
(
couÁ
, 
size
, *
±r
)

1550 ià(
couÁ
 && (-1UL)/couÁ<
size
)

1551  
EXT2_ET_NO_MEMORY
;

1552  
ext2fs_g‘_mem
(
couÁ
*
size
, 
±r
);

1555 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_¬¿yz”o
(
couÁ
,

1556 
size
, *
±r
)

1558 *
µ
;

1560 ià(
couÁ
 && (-1UL)/couÁ<
size
)

1561  
EXT2_ET_NO_MEMORY
;

1562 
µ
 = 
ÿÎoc
(
couÁ
, 
size
);

1563 ià(!
µ
)

1564  
EXT2_ET_NO_MEMORY
;

1565 
memıy
(
±r
, &
µ
, (pp));

1572 
_INLINE_
 
”rcode_t
 
ext2fs_ä“_mem
(*
±r
)

1574 *
p
;

1576 
memıy
(&
p
, 
±r
, (p));

1577 
ä“
(
p
);

1578 
p
 = 0;

1579 
memıy
(
±r
, &
p
, (p));

1586 
_INLINE_
 
”rcode_t
 
ext2fs_»size_mem
(
EXT2FS_ATTR
((
unu£d
)è
Şd_size
,

1587 
size
, *
±r
)

1589 *
p
;

1593 
memıy
(&
p
, 
±r
, (p));

1594 
p
 = 
»®loc
Õ, 
size
);

1595 ià(!
p
)

1596  
EXT2_ET_NO_MEMORY
;

1597 
memıy
(
±r
, &
p
, (p));

1605 
_INLINE_
 
ext2fs_m¬k_su³r_dœty
(
ext2_fsys
 
fs
)

1607 
fs
->
æags
 |ğ
EXT2_FLAG_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1613 
_INLINE_
 
ext2fs_m¬k_chªged
(
ext2_fsys
 
fs
)

1615 
fs
->
æags
 |ğ
EXT2_FLAG_CHANGED
;

1621 
_INLINE_
 
ext2fs_‹¡_chªged
(
ext2_fsys
 
fs
)

1623  (
fs
->
æags
 & 
EXT2_FLAG_CHANGED
);

1629 
_INLINE_
 
ext2fs_m¬k_v®id
(
ext2_fsys
 
fs
)

1631 
fs
->
æags
 |ğ
EXT2_FLAG_VALID
;

1637 
_INLINE_
 
ext2fs_unm¬k_v®id
(
ext2_fsys
 
fs
)

1639 
fs
->
æags
 &ğ~
EXT2_FLAG_VALID
;

1645 
_INLINE_
 
ext2fs_‹¡_v®id
(
ext2_fsys
 
fs
)

1647  (
fs
->
æags
 & 
EXT2_FLAG_VALID
);

1653 
_INLINE_
 
ext2fs_m¬k_ib_dœty
(
ext2_fsys
 
fs
)

1655 
fs
->
æags
 |ğ
EXT2_FLAG_IB_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1661 
_INLINE_
 
ext2fs_m¬k_bb_dœty
(
ext2_fsys
 
fs
)

1663 
fs
->
æags
 |ğ
EXT2_FLAG_BB_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1669 
_INLINE_
 
ext2fs_‹¡_ib_dœty
(
ext2_fsys
 
fs
)

1671  (
fs
->
æags
 & 
EXT2_FLAG_IB_DIRTY
);

1677 
_INLINE_
 
ext2fs_‹¡_bb_dœty
(
ext2_fsys
 
fs
)

1679  (
fs
->
æags
 & 
EXT2_FLAG_BB_DIRTY
);

1685 
_INLINE_
 
dg½_t
 
ext2fs_group_of_blk
(
ext2_fsys
 
fs
, 
blk_t
 
blk
)

1687  
ext2fs_group_of_blk2
(
fs
, 
blk
);

1692 
_INLINE_
 
dg½_t
 
ext2fs_group_of_šo
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
)

1694  (
šo
 - 1è/ 
fs
->
su³r
->
s_šodes_³r_group
;

1700 
_INLINE_
 
blk_t
 
ext2fs_group_fœ¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
)

1702  (
blk_t
è
ext2fs_group_fœ¡_block2
(
fs
, 
group
);

1708 
_INLINE_
 
blk_t
 
ext2fs_group_Ï¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
)

1710  (
blk_t
è
ext2fs_group_Ï¡_block2
(
fs
, 
group
);

1713 
_INLINE_
 
blk_t
 
ext2fs_šode_d©a_blocks
(
ext2_fsys
 
fs
,

1714 
ext2_šode
 *
šode
)

1716  (
blk_t
è
ext2fs_šode_d©a_blocks2
(
fs
, 
šode
);

1722 
_INLINE_
 
ext2fs_div_û
(
a
, 
b
)

1724 ià(!
a
)

1726  ((
a
 - 1è/ 
b
) + 1;

1729 
_INLINE_
 
__u64
 
ext2fs_div64_û
(__u64 
a
, __u64 
b
)

1731 ià(!
a
)

1733  ((
a
 - 1è/ 
b
) + 1;

1736 #undeà
_INLINE_


1739 #ifdeà
__ılu¥lus


	@libmke2fs/ext2fsP.h

12 
	~"ext2fs.h
"

14 
	#EXT2FS_MAX_NESTED_LINKS
 8

	)

19 
	sext2_¡ruù_u32_li¡
 {

20 
	mmagic
;

21 
	mnum
;

22 
	msize
;

23 
__u32
 *
	mli¡
;

24 
	mbadblocks_æags
;

27 
	sext2_¡ruù_u32_™”©e
 {

28 
	mmagic
;

29 
ext2_u32_li¡
 
	mbb
;

30 
	m±r
;

37 
	sext2_¡ruù_dbli¡
 {

38 
	mmagic
;

39 
ext2_fsys
 
	mfs
;

40 
	msize
;

41 
	mcouÁ
;

42 
	msÜ‹d
;

43 
ext2_db_’Œy2
 * 
	mli¡
;

49 
	sdœ_cÚ‹xt
 {

50 
ext2_šo_t
 
	mdœ
;

51 
	mæags
;

52 *
	mbuf
;

53 (*
	mfunc
)(
ext2_šo_t
 
	mdœ
,

54 
	m’Œy
,

55 
ext2_dœ_’Œy
 *
	mdœ’t
,

56 
	moff£t
,

57 
	mblocksize
,

58 *
	mbuf
,

59 *
	m´iv_d©a
);

60 *
	m´iv_d©a
;

61 
”rcode_t
 
	m”rcode
;

67 
	sext2_šode_ÿche
 {

68 * 
	mbufãr
;

69 
blk64_t
 
	mbufãr_blk
;

70 
	mÿche_Ï¡
;

71 
	mÿche_size
;

72 
	m»fcouÁ
;

73 
ext2_šode_ÿche_’t
 *
	mÿche
;

76 
	sext2_šode_ÿche_’t
 {

77 
ext2_šo_t
 
	mšo
;

78 
ext2_šode
 
	mšode
;

83 
ext2fs_´oûss_dœ_block
(
ext2_fsys
 
fs
,

84 
blk64_t
 *
blockÄ
,

85 
e2_blkút_t
 
blockút
,

86 
blk64_t
 
»f_block
,

87 
»f_off£t
,

88 *
´iv_d©a
);

92 
	sext2fs_num”ic_´og»ss_¡ruù
 {

93 
__u64
 
	mmax
;

94 
	mlog_max
;

95 
	msk_´og»ss
;

98 
ext2fs_num”ic_´og»ss_š™
(
ext2_fsys
 
fs
,

99 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

100 cÚ¡ *
Ïb–
, 
__u64
 
max
);

101 
ext2fs_num”ic_´og»ss_upd©e
(
ext2_fsys
 
fs
,

102 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

103 
__u64
 
v®
);

104 
ext2fs_num”ic_´og»ss_şo£
(
ext2_fsys
 
fs
,

105 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

106 cÚ¡ *
mes§ge
);

112 
”rcode_t
 
ext2fs_®loc_g’”ic_bm­
(
ext2_fsys
 
fs
,ƒ¼code_ˆ
magic
,

113 
ty³
, 
__u64
 
¡¬t
, __u64 
’d
,

114 
__u64
 
»®_’d
,

115 cÚ¡ * 
desütiÚ
,

116 
ext2fs_g’”ic_b™m­
 *
bm­
);

118 
ext2fs_ä“_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
);

120 
”rcode_t
 
ext2fs_cİy_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
¤c
,

121 
ext2fs_g’”ic_b™m­
 *
de¡
);

123 
”rcode_t
 
ext2fs_»size_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
,

124 
__u64
 
Ãw_’d
,

125 
__u64
 
Ãw_»®_’d
);

126 
”rcode_t
 
ext2fs_fudge_g’”ic_bm­_’d
(
ext2fs_g’”ic_b™m­
 
b™m­
,

127 
”rcode_t
 
Ãq
,

128 
__u64
 
’d
, __u64 *
Ûnd
);

129 
ext2fs_m¬k_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

130 
__u64
 
¬g
);

131 
ext2fs_unm¬k_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

132 
__u64
 
¬g
);

133 
ext2fs_‹¡_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

134 
__u64
 
¬g
);

135 
”rcode_t
 
ext2fs_£t_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
b™m­
,

136 
__u64
 
¡¬t
, 
num
,

137 *
š
);

138 
”rcode_t
 
ext2fs_g‘_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
b™m­
,

139 
__u64
 
¡¬t
, 
num
,

140 *
out
);

141 
ext2fs_w¬n_b™m­32
(
ext2fs_g’”ic_b™m­
 
b™m­
,cÚ¡ *
func
);

143 
ext2fs_mem_is_z”o
(cÚ¡ *
mem
, 
size_t
 
Ën
);

145 
ext2fs_fe_block_off£t_too_big
(
ext2_fsys
 
fs
,

146 
ext2_šode
 *
šode
,

147 
blk64_t
 
off£t
);

	@libmke2fs/ext2fsP.h

12 
	~"ext2fs.h
"

14 
	#EXT2FS_MAX_NESTED_LINKS
 8

	)

19 
	sext2_¡ruù_u32_li¡
 {

20 
	mmagic
;

21 
	mnum
;

22 
	msize
;

23 
__u32
 *
	mli¡
;

24 
	mbadblocks_æags
;

27 
	sext2_¡ruù_u32_™”©e
 {

28 
	mmagic
;

29 
ext2_u32_li¡
 
	mbb
;

30 
	m±r
;

37 
	sext2_¡ruù_dbli¡
 {

38 
	mmagic
;

39 
ext2_fsys
 
	mfs
;

40 
	msize
;

41 
	mcouÁ
;

42 
	msÜ‹d
;

43 
ext2_db_’Œy2
 * 
	mli¡
;

49 
	sdœ_cÚ‹xt
 {

50 
ext2_šo_t
 
	mdœ
;

51 
	mæags
;

52 *
	mbuf
;

53 (*
	mfunc
)(
ext2_šo_t
 
	mdœ
,

54 
	m’Œy
,

55 
ext2_dœ_’Œy
 *
	mdœ’t
,

56 
	moff£t
,

57 
	mblocksize
,

58 *
	mbuf
,

59 *
	m´iv_d©a
);

60 *
	m´iv_d©a
;

61 
”rcode_t
 
	m”rcode
;

67 
	sext2_šode_ÿche
 {

68 * 
	mbufãr
;

69 
blk64_t
 
	mbufãr_blk
;

70 
	mÿche_Ï¡
;

71 
	mÿche_size
;

72 
	m»fcouÁ
;

73 
ext2_šode_ÿche_’t
 *
	mÿche
;

76 
	sext2_šode_ÿche_’t
 {

77 
ext2_šo_t
 
	mšo
;

78 
ext2_šode
 
	mšode
;

83 
ext2fs_´oûss_dœ_block
(
ext2_fsys
 
fs
,

84 
blk64_t
 *
blockÄ
,

85 
e2_blkút_t
 
blockút
,

86 
blk64_t
 
»f_block
,

87 
»f_off£t
,

88 *
´iv_d©a
);

92 
	sext2fs_num”ic_´og»ss_¡ruù
 {

93 
__u64
 
	mmax
;

94 
	mlog_max
;

95 
	msk_´og»ss
;

98 
ext2fs_num”ic_´og»ss_š™
(
ext2_fsys
 
fs
,

99 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

100 cÚ¡ *
Ïb–
, 
__u64
 
max
);

101 
ext2fs_num”ic_´og»ss_upd©e
(
ext2_fsys
 
fs
,

102 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

103 
__u64
 
v®
);

104 
ext2fs_num”ic_´og»ss_şo£
(
ext2_fsys
 
fs
,

105 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

106 cÚ¡ *
mes§ge
);

112 
”rcode_t
 
ext2fs_®loc_g’”ic_bm­
(
ext2_fsys
 
fs
,ƒ¼code_ˆ
magic
,

113 
ty³
, 
__u64
 
¡¬t
, __u64 
’d
,

114 
__u64
 
»®_’d
,

115 cÚ¡ * 
desütiÚ
,

116 
ext2fs_g’”ic_b™m­
 *
bm­
);

118 
ext2fs_ä“_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
);

120 
”rcode_t
 
ext2fs_cİy_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
¤c
,

121 
ext2fs_g’”ic_b™m­
 *
de¡
);

123 
”rcode_t
 
ext2fs_»size_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
,

124 
__u64
 
Ãw_’d
,

125 
__u64
 
Ãw_»®_’d
);

126 
”rcode_t
 
ext2fs_fudge_g’”ic_bm­_’d
(
ext2fs_g’”ic_b™m­
 
b™m­
,

127 
”rcode_t
 
Ãq
,

128 
__u64
 
’d
, __u64 *
Ûnd
);

129 
ext2fs_m¬k_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

130 
__u64
 
¬g
);

131 
ext2fs_unm¬k_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

132 
__u64
 
¬g
);

133 
ext2fs_‹¡_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

134 
__u64
 
¬g
);

135 
”rcode_t
 
ext2fs_£t_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
b™m­
,

136 
__u64
 
¡¬t
, 
num
,

137 *
š
);

138 
”rcode_t
 
ext2fs_g‘_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
b™m­
,

139 
__u64
 
¡¬t
, 
num
,

140 *
out
);

141 
ext2fs_w¬n_b™m­32
(
ext2fs_g’”ic_b™m­
 
b™m­
,cÚ¡ *
func
);

143 
ext2fs_mem_is_z”o
(cÚ¡ *
mem
, 
size_t
 
Ën
);

145 
ext2fs_fe_block_off£t_too_big
(
ext2_fsys
 
fs
,

146 
ext2_šode
 *
šode
,

147 
blk64_t
 
off£t
);

	@libmke2fs/mke2fs.h

1 #iâdeà
__MKE2FS_H__


2 
	#__MKE2FS_H__


	)

4 
	~"ext2fs/ext2fs.h
"

5 
	~"mke2fs_”r.h
"

8 
	mWRITE_INODE_TABLES_UNKNOWN
 = 0,

9 
	mWRITE_INODE_TABLES_INIT
,

10 
	mWRITE_INODE_TABLES_WRITING
,

11 
	mWRITE_INODE_TABLES_WRITING_DONE
,

12 
	mWRITE_INODE_TABLES_DONE
,

13 
	mWRITE_INODE_TABLES_ERROR
,

16 
	sex‹nded_İt
 {

17 
__u16
 
	m¡ride
;

18 
__u32
 
	m¡re_width
;

19 
__u16
 
	mdesc_size
;

20 
__u16
 
	mmmp_upd©e_š‹rv®
;

21 
	m‹¡_fs
;

22 
	mdisÿrd
;

25 
	se2fs_cfg
 {

26 
	m»£rved_¿tio
;

27 
	mnum_šodes
;

28 
	mæex_bg_size
;

29 
__u32
 
	mblocks_³r_group
;

30 
__u32
 
	mü—tÜ_os
;

31 
	mblocksize
;

32 
	mşu¡”_size
;

33 
	mdœeù_io
;

34 
	mfÜû
;

35 
	mcæag
;

36 
	mv”bo£
;

37 
	mqu›t
;

38 
	mr_İt
;

39 
	msu³r_Úly
;

40 
	mšode_¿tio
;

41 
	mšode_size
;

42 
	mjouº®_size
;

43 
	mnßùiÚ
;

44 
	mbad_blocks_f’ame
[512];

45 
	mfs_ã©u»s
[256];

46 
	mu§ge_ty³s
[256];

47 
	mmouÁ_dœ
[64];

48 
	mfs_uuid
[64];

49 
	mfs_ty³
[16];

50 
	mvŞume_Ïb–
[16];

52 
ex‹nded_İt
 
	mext_İts
;

55 (*
	tmke2fs_cb_func
)(*
	tpD©a
, 
	t¡©
, 
	tcu¼’t
, 
	ttÙ®
);

57 
	smke2fs_hªdË
 {

59 
e2fs_cfg
 
cfg
;

60 
deviû_Çme
[32];

61 *
buf
;

62 *
pD©a
;

63 
mke2fs_cb_func
 
cb_func
;

66 
	`mke2fs
(
mke2fs_hªdË
 *
hªdË
);

	@libmke2fs/mke2fs.h

1 #iâdeà
__MKE2FS_H__


2 
	#__MKE2FS_H__


	)

4 
	~"ext2fs/ext2fs.h
"

5 
	~"mke2fs_”r.h
"

8 
	mWRITE_INODE_TABLES_UNKNOWN
 = 0,

9 
	mWRITE_INODE_TABLES_INIT
,

10 
	mWRITE_INODE_TABLES_WRITING
,

11 
	mWRITE_INODE_TABLES_WRITING_DONE
,

12 
	mWRITE_INODE_TABLES_DONE
,

13 
	mWRITE_INODE_TABLES_ERROR
,

16 
	sex‹nded_İt
 {

17 
__u16
 
	m¡ride
;

18 
__u32
 
	m¡re_width
;

19 
__u16
 
	mdesc_size
;

20 
__u16
 
	mmmp_upd©e_š‹rv®
;

21 
	m‹¡_fs
;

22 
	mdisÿrd
;

25 
	se2fs_cfg
 {

26 
	m»£rved_¿tio
;

27 
	mnum_šodes
;

28 
	mæex_bg_size
;

29 
__u32
 
	mblocks_³r_group
;

30 
__u32
 
	mü—tÜ_os
;

31 
	mblocksize
;

32 
	mşu¡”_size
;

33 
	mdœeù_io
;

34 
	mfÜû
;

35 
	mcæag
;

36 
	mv”bo£
;

37 
	mqu›t
;

38 
	mr_İt
;

39 
	msu³r_Úly
;

40 
	mšode_¿tio
;

41 
	mšode_size
;

42 
	mjouº®_size
;

43 
	mnßùiÚ
;

44 
	mbad_blocks_f’ame
[512];

45 
	mfs_ã©u»s
[256];

46 
	mu§ge_ty³s
[256];

47 
	mmouÁ_dœ
[64];

48 
	mfs_uuid
[64];

49 
	mfs_ty³
[16];

50 
	mvŞume_Ïb–
[16];

52 
ex‹nded_İt
 
	mext_İts
;

55 (*
	tmke2fs_cb_func
)(*
	tpD©a
, 
	t¡©
, 
	tcu¼’t
, 
	ttÙ®
);

57 
	smke2fs_hªdË
 {

59 
e2fs_cfg
 
cfg
;

60 
deviû_Çme
[32];

61 *
buf
;

62 *
pD©a
;

63 
mke2fs_cb_func
 
cb_func
;

66 
	`mke2fs
(
mke2fs_hªdË
 *
hªdË
);

	@libmke2fs/mke2fs_err.h

1 #iâdeà
__MKE2FS_ERR_H__


2 
	#__MKE2FS_ERR_H__


	)

5 
	mMKE2FS_INVALID_HANDLE
 = 1001,

6 
	mMKE2FS_FAIL_TO_ALLOCATE_MEMORY
,

7 
	mMKE2FS_PROFILE_ERROR
,

8 
	mMKE2FS_UNAME_ERROR
,

9 
	mMKE2FS_INVALID_BLOCK_SIZE
,

10 
	mMKE2FS_INVALID_CLUSTER_SIZE
,

11 
	mMKE2FS_ILLEGAL_BLOCKS_PER_GROUP
,

12 
	mMKE2FS_BLOCKS_PER_GROUP_NOT_MULTIPLE_OF_8
,

13 
	mMKE2FS_FLEX_BG_SIZE_NOT_POWER_OF_2
,

14 
	mMKE2FS_INVALID_INODE_RATIO
,

15 
	mMKE2FS_INVALID_INODE_SIZE
,

16 
	mMKE2FS_INVALID_RESERVED_RATIO
,

17 
	mMKE2FS_FAIL_TO_PARSE_FSTYPE
,

18 
	mMKE2FS_FAIL_TO_DETERMINE_HW_SECTOR_SIZE
,

19 
	mMKE2FS_FAIL_TO_DETERMINE_PHY_SECTOR_SIZE
,

20 
	mMKE2FS_FAIL_TO_DETERMINE_FS_SIZE
,

21 
	mMKE2FS_FAIL_TO_DETERMINE_MOUNT_STATUS
,

22 
	mMKE2FS_BLOCKSIZE_TOO_SMALL
,

23 
	mMKE2FS_UNSUITABLE_BLOCKSIZE_FOR_32BIT
,

24 
	mMKE2FS_FS_FEATURE_NOT_SUPPORT
,

25 
	mMKE2FS_NOT_SUPPORT_SPARSE_SB
,

26 
	mMKE2FS_NOT_SUPPORT_JOURNAL
,

27 
	mMKE2FS_EXTENTS_ENABLED_FOR_64BIT_FS_NOLY
,

28 
	mMKE2FS_CLUSTER_SIZE_SMALLER_THAN_BLOCK_SIZE
,

29 
	mMKE2FS_UNSUITABLE_CLUSTER_SIZE
,

30 
	mMKE2FS_NEED_EXTENTS_FEATURE
,

31 
	mMKE2FS_FEATURES_CANNOT_ENABLED_SIMULTANEOUSLY
,

32 
	mMKE2FS_NOT_SUPPORT_RESERVED_ONLINE_RESIZE
,

33 
	mMKE2FS_BLOCK_PER_GROUP_OUT_OF_RANGE
,

34 
	mMKE2FS_FLEX_BG_FEATURE_NOT_ENABLED
,

35 
	mMKE2FS_TOO_MANY_INODES
,

36 
	mMKE2FS_UNSUITABLE_INODE_CONFIG
,

37 
	mMKE2FS_SETUP_TDB_ERROR
,

38 
	mMKE2FS_FAIL_TO_INITIALIZE_SUPERBLOCK
,

39 
	mMKE2FS_COULD_NOT_PARSE_UUID
,

40 
	mMKE2FS_UNKNOWN_OS
,

41 
	mMKE2FS_EXT2FS_CLOSE_ERROR
,

42 
	mMKE2FS_FAIL_TO_ALLOCATE_FS_TABLES
,

43 
	mMKE2FS_FAIL_TO_CONVERT_SUBCLUSTER_BITMAP
,

44 
	mMKE2FS_RESERVING_BLOCKS_FOR_ONLINE_RESIZE_ERROR
,

45 
	mMKE2FS_FAIL_TO_OPEN_JOURNAL_DEV
,

46 
	mMKE2FS_FAIL_TO_ADD_JOURNAL
,

47 
	mMKE2FS_FAIL_TO_CREATE_JOURNAL
,

48 
	mMKE2FS_FAIL_TO_INITIALIZE_JOURNAL_SUPERBLOCK
,

49 
	mMKE2FS_FAIL_TO_ZERO_JOURNAL_DEV
,

50 
	mMKE2FS_FAIL_TO_WRITE_JOURNAL_SB
,

51 
	mMKE2FS_ENABLE_MULTIPLE_MOUNT_PROTECTION_ERROR
,

52 
	mMKE2FS_INVALID_BB_LIST
,

53 
	mMKE2FS_BAD_PRIMARY_SB_GROUP_DESCRIPTOR
,

54 
	mMKE2FS_MARK_BAD_BLOCKS_ERROR
,

55 
	mMKE2FS_COULD_NOT_WRITE_BLOCKS_IN_INODE_TABLES
,

56 
	mMKE2FS_FAIL_TO_CREATE_ROOT_DIR
,

57 
	mMKE2FS_FAIL_TO_READ_ROOT_INODE
,

58 
	mMKE2FS_FAIL_TO_SET_ROOT_INODE_OWNERSHIP
,

59 
	mMKE2FS_OOM_ERASING_SECTORS
,

60 
	mMKE2FS_FAIL_TO_OPEN_BB_FILE
,

61 
	mMKE2FS_FAIL_TO_READ_BB_FILE
,

62 
	mMKE2FS_EMPTY_STRING
,

63 
	mMKE2FS_INVALID_FS_OPTIONS
,

64 
	mMKE2FS_INVALID_MOUNT_OPTIONS
,

65 
	mMKE2FS_ABORT_CHECK_PROFILE
,

66 
	mMKE2FS_JOURNAL_BLOCKSIZE_SMALLER_THAN_MINIMUM_BLOCKSIZE
,

67 
	mMKE2FS_COULD_NOT_DETERMINE_DEV_SIZE
,

68 
	mMKE2FS_DEVICE_SIZE_REPORT_TO_BE_0
,

69 
	mMKE2FS_NOT_BLOCK_DEV
,

70 
	mMKE2FS_FAIL_TO_GET_BLKID_CACHE
,

71 
	mMKE2FS_CHECK_MOUNT_POINT_FAIL
,

72 
	mMKE2FS_MOUNTED
,

	@libmke2fs/mke2fs_err.h

1 #iâdeà
__MKE2FS_ERR_H__


2 
	#__MKE2FS_ERR_H__


	)

5 
	mMKE2FS_INVALID_HANDLE
 = 1001,

6 
	mMKE2FS_FAIL_TO_ALLOCATE_MEMORY
,

7 
	mMKE2FS_PROFILE_ERROR
,

8 
	mMKE2FS_UNAME_ERROR
,

9 
	mMKE2FS_INVALID_BLOCK_SIZE
,

10 
	mMKE2FS_INVALID_CLUSTER_SIZE
,

11 
	mMKE2FS_ILLEGAL_BLOCKS_PER_GROUP
,

12 
	mMKE2FS_BLOCKS_PER_GROUP_NOT_MULTIPLE_OF_8
,

13 
	mMKE2FS_FLEX_BG_SIZE_NOT_POWER_OF_2
,

14 
	mMKE2FS_INVALID_INODE_RATIO
,

15 
	mMKE2FS_INVALID_INODE_SIZE
,

16 
	mMKE2FS_INVALID_RESERVED_RATIO
,

17 
	mMKE2FS_FAIL_TO_PARSE_FSTYPE
,

18 
	mMKE2FS_FAIL_TO_DETERMINE_HW_SECTOR_SIZE
,

19 
	mMKE2FS_FAIL_TO_DETERMINE_PHY_SECTOR_SIZE
,

20 
	mMKE2FS_FAIL_TO_DETERMINE_FS_SIZE
,

21 
	mMKE2FS_FAIL_TO_DETERMINE_MOUNT_STATUS
,

22 
	mMKE2FS_BLOCKSIZE_TOO_SMALL
,

23 
	mMKE2FS_UNSUITABLE_BLOCKSIZE_FOR_32BIT
,

24 
	mMKE2FS_FS_FEATURE_NOT_SUPPORT
,

25 
	mMKE2FS_NOT_SUPPORT_SPARSE_SB
,

26 
	mMKE2FS_NOT_SUPPORT_JOURNAL
,

27 
	mMKE2FS_EXTENTS_ENABLED_FOR_64BIT_FS_NOLY
,

28 
	mMKE2FS_CLUSTER_SIZE_SMALLER_THAN_BLOCK_SIZE
,

29 
	mMKE2FS_UNSUITABLE_CLUSTER_SIZE
,

30 
	mMKE2FS_NEED_EXTENTS_FEATURE
,

31 
	mMKE2FS_FEATURES_CANNOT_ENABLED_SIMULTANEOUSLY
,

32 
	mMKE2FS_NOT_SUPPORT_RESERVED_ONLINE_RESIZE
,

33 
	mMKE2FS_BLOCK_PER_GROUP_OUT_OF_RANGE
,

34 
	mMKE2FS_FLEX_BG_FEATURE_NOT_ENABLED
,

35 
	mMKE2FS_TOO_MANY_INODES
,

36 
	mMKE2FS_UNSUITABLE_INODE_CONFIG
,

37 
	mMKE2FS_SETUP_TDB_ERROR
,

38 
	mMKE2FS_FAIL_TO_INITIALIZE_SUPERBLOCK
,

39 
	mMKE2FS_COULD_NOT_PARSE_UUID
,

40 
	mMKE2FS_UNKNOWN_OS
,

41 
	mMKE2FS_EXT2FS_CLOSE_ERROR
,

42 
	mMKE2FS_FAIL_TO_ALLOCATE_FS_TABLES
,

43 
	mMKE2FS_FAIL_TO_CONVERT_SUBCLUSTER_BITMAP
,

44 
	mMKE2FS_RESERVING_BLOCKS_FOR_ONLINE_RESIZE_ERROR
,

45 
	mMKE2FS_FAIL_TO_OPEN_JOURNAL_DEV
,

46 
	mMKE2FS_FAIL_TO_ADD_JOURNAL
,

47 
	mMKE2FS_FAIL_TO_CREATE_JOURNAL
,

48 
	mMKE2FS_FAIL_TO_INITIALIZE_JOURNAL_SUPERBLOCK
,

49 
	mMKE2FS_FAIL_TO_ZERO_JOURNAL_DEV
,

50 
	mMKE2FS_FAIL_TO_WRITE_JOURNAL_SB
,

51 
	mMKE2FS_ENABLE_MULTIPLE_MOUNT_PROTECTION_ERROR
,

52 
	mMKE2FS_INVALID_BB_LIST
,

53 
	mMKE2FS_BAD_PRIMARY_SB_GROUP_DESCRIPTOR
,

54 
	mMKE2FS_MARK_BAD_BLOCKS_ERROR
,

55 
	mMKE2FS_COULD_NOT_WRITE_BLOCKS_IN_INODE_TABLES
,

56 
	mMKE2FS_FAIL_TO_CREATE_ROOT_DIR
,

57 
	mMKE2FS_FAIL_TO_READ_ROOT_INODE
,

58 
	mMKE2FS_FAIL_TO_SET_ROOT_INODE_OWNERSHIP
,

59 
	mMKE2FS_OOM_ERASING_SECTORS
,

60 
	mMKE2FS_FAIL_TO_OPEN_BB_FILE
,

61 
	mMKE2FS_FAIL_TO_READ_BB_FILE
,

62 
	mMKE2FS_EMPTY_STRING
,

63 
	mMKE2FS_INVALID_FS_OPTIONS
,

64 
	mMKE2FS_INVALID_MOUNT_OPTIONS
,

65 
	mMKE2FS_ABORT_CHECK_PROFILE
,

66 
	mMKE2FS_JOURNAL_BLOCKSIZE_SMALLER_THAN_MINIMUM_BLOCKSIZE
,

67 
	mMKE2FS_COULD_NOT_DETERMINE_DEV_SIZE
,

68 
	mMKE2FS_DEVICE_SIZE_REPORT_TO_BE_0
,

69 
	mMKE2FS_NOT_BLOCK_DEV
,

70 
	mMKE2FS_FAIL_TO_GET_BLKID_CACHE
,

71 
	mMKE2FS_CHECK_MOUNT_POINT_FAIL
,

72 
	mMKE2FS_MOUNTED
,

	@libmke2fs/prof_err.h

6 
	~<‘/com_”r.h
>

8 
	#PROF_VERSION
 (-1429577728L)

	)

9 
	#PROF_MAGIC_NODE
 (-1429577727L)

	)

10 
	#PROF_NO_SECTION
 (-1429577726L)

	)

11 
	#PROF_NO_RELATION
 (-1429577725L)

	)

12 
	#PROF_ADD_NOT_SECTION
 (-1429577724L)

	)

13 
	#PROF_SECTION_WITH_VALUE
 (-1429577723L)

	)

14 
	#PROF_BAD_LINK_LIST
 (-1429577722L)

	)

15 
	#PROF_BAD_GROUP_LVL
 (-1429577721L)

	)

16 
	#PROF_BAD_PARENT_PTR
 (-1429577720L)

	)

17 
	#PROF_MAGIC_ITERATOR
 (-1429577719L)

	)

18 
	#PROF_SET_SECTION_VALUE
 (-1429577718L)

	)

19 
	#PROF_EINVAL
 (-1429577717L)

	)

20 
	#PROF_READ_ONLY
 (-1429577716L)

	)

21 
	#PROF_SECTION_NOTOP
 (-1429577715L)

	)

22 
	#PROF_SECTION_SYNTAX
 (-1429577714L)

	)

23 
	#PROF_RELATION_SYNTAX
 (-1429577713L)

	)

24 
	#PROF_EXTRA_CBRACE
 (-1429577712L)

	)

25 
	#PROF_MISSING_OBRACE
 (-1429577711L)

	)

26 
	#PROF_MAGIC_PROFILE
 (-1429577710L)

	)

27 
	#PROF_MAGIC_SECTION
 (-1429577709L)

	)

28 
	#PROF_TOPSECTION_ITER_NOSUPP
 (-1429577708L)

	)

29 
	#PROF_INVALID_SECTION
 (-1429577707L)

	)

30 
	#PROF_END_OF_SECTIONS
 (-1429577706L)

	)

31 
	#PROF_BAD_NAMESET
 (-1429577705L)

	)

32 
	#PROF_NO_PROFILE
 (-1429577704L)

	)

33 
	#PROF_MAGIC_FILE
 (-1429577703L)

	)

34 
	#PROF_FAIL_OPEN
 (-1429577702L)

	)

35 
	#PROF_EXISTS
 (-1429577701L)

	)

36 
	#PROF_BAD_BOOLEAN
 (-1429577700L)

	)

37 
	#PROF_BAD_INTEGER
 (-1429577699L)

	)

38 
	#PROF_MAGIC_FILE_DATA
 (-1429577698L)

	)

39 cÚ¡ 
”rÜ_bË
 
‘_´of_”rÜ_bË
;

40 
š™Ÿlize_´of_”rÜ_bË
();

43 
š™Ÿlize_´of_”rÜ_bË_r
(
‘_li¡
 **
li¡
);

45 
	#ERROR_TABLE_BASE_´of
 (-1429577728L)

	)

48 
	#š™_´of_”r_tbl
 
š™Ÿlize_´of_”rÜ_bË


	)

49 
	#´of_”r_ba£
 
ERROR_TABLE_BASE_´of


	)

	@libmke2fs/prof_err.h

6 
	~<‘/com_”r.h
>

8 
	#PROF_VERSION
 (-1429577728L)

	)

9 
	#PROF_MAGIC_NODE
 (-1429577727L)

	)

10 
	#PROF_NO_SECTION
 (-1429577726L)

	)

11 
	#PROF_NO_RELATION
 (-1429577725L)

	)

12 
	#PROF_ADD_NOT_SECTION
 (-1429577724L)

	)

13 
	#PROF_SECTION_WITH_VALUE
 (-1429577723L)

	)

14 
	#PROF_BAD_LINK_LIST
 (-1429577722L)

	)

15 
	#PROF_BAD_GROUP_LVL
 (-1429577721L)

	)

16 
	#PROF_BAD_PARENT_PTR
 (-1429577720L)

	)

17 
	#PROF_MAGIC_ITERATOR
 (-1429577719L)

	)

18 
	#PROF_SET_SECTION_VALUE
 (-1429577718L)

	)

19 
	#PROF_EINVAL
 (-1429577717L)

	)

20 
	#PROF_READ_ONLY
 (-1429577716L)

	)

21 
	#PROF_SECTION_NOTOP
 (-1429577715L)

	)

22 
	#PROF_SECTION_SYNTAX
 (-1429577714L)

	)

23 
	#PROF_RELATION_SYNTAX
 (-1429577713L)

	)

24 
	#PROF_EXTRA_CBRACE
 (-1429577712L)

	)

25 
	#PROF_MISSING_OBRACE
 (-1429577711L)

	)

26 
	#PROF_MAGIC_PROFILE
 (-1429577710L)

	)

27 
	#PROF_MAGIC_SECTION
 (-1429577709L)

	)

28 
	#PROF_TOPSECTION_ITER_NOSUPP
 (-1429577708L)

	)

29 
	#PROF_INVALID_SECTION
 (-1429577707L)

	)

30 
	#PROF_END_OF_SECTIONS
 (-1429577706L)

	)

31 
	#PROF_BAD_NAMESET
 (-1429577705L)

	)

32 
	#PROF_NO_PROFILE
 (-1429577704L)

	)

33 
	#PROF_MAGIC_FILE
 (-1429577703L)

	)

34 
	#PROF_FAIL_OPEN
 (-1429577702L)

	)

35 
	#PROF_EXISTS
 (-1429577701L)

	)

36 
	#PROF_BAD_BOOLEAN
 (-1429577700L)

	)

37 
	#PROF_BAD_INTEGER
 (-1429577699L)

	)

38 
	#PROF_MAGIC_FILE_DATA
 (-1429577698L)

	)

39 cÚ¡ 
”rÜ_bË
 
‘_´of_”rÜ_bË
;

40 
š™Ÿlize_´of_”rÜ_bË
();

43 
š™Ÿlize_´of_”rÜ_bË_r
(
‘_li¡
 **
li¡
);

45 
	#ERROR_TABLE_BASE_´of
 (-1429577728L)

	)

48 
	#š™_´of_”r_tbl
 
š™Ÿlize_´of_”rÜ_bË


	)

49 
	#´of_”r_ba£
 
ERROR_TABLE_BASE_´of


	)

	@libmke2fs/profile.h

39 #iâdeà
_PROFILE_H


40 
	#_PROFILE_H


	)

42 
_´ofe_t
 *
	t´ofe_t
;

44 (*
	t´ofe_syÁax_”r_cb_t
)(cÚ¡ *
	tfe
, 
	t”r
,

45 
	tlše_num
);

50 
	#PROFILE_ITER_LIST_SECTION
 0x0001

	)

51 
	#PROFILE_ITER_SECTIONS_ONLY
 0x0002

	)

52 
	#PROFILE_ITER_RELATIONS_ONLY
 0x0004

	)

54 #ifdeà
__ılu¥lus


58 
´ofe_š™


59 (cÚ¡ * *
fes
, 
´ofe_t
 *
»t_´ofe
);

61 
´ofe_»Ëa£


62 (
´ofe_t
 
´ofe
);

64 
´ofe_£t_deçuÉ


65 (
´ofe_t
 
´ofe
, cÚ¡ *
def_¡ršg
);

67 
´ofe_g‘_¡ršg


68 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

69 cÚ¡ *
subsubÇme
, cÚ¡ *
def_v®
,

70 **
»t_¡ršg
);

71 
´ofe_g‘_š‹g”


72 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

73 cÚ¡ *
subsubÇme
, 
def_v®
,

74 *
»t_deçuÉ
);

76 
´ofe_g‘_ušt


77 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

78 cÚ¡ *
subsubÇme
, 
def_v®
,

79 *
»t_št
);

81 
´ofe_g‘_doubË


82 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

83 cÚ¡ *
subsubÇme
, 
def_v®
,

84 *
»t_æßt
);

86 
´ofe_g‘_boŞ—n


87 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

88 cÚ¡ *
subsubÇme
, 
def_v®
,

89 *
»t_deçuÉ
);

91 
´ofe_™”©Ü_ü—‹


92 (
´ofe_t
 
´ofe
, cÚ¡ *cÚ¡ *
Çmes
,

93 
æags
, **
»t_™”
);

95 
´ofe_™”©Ü_ä“


96 (**
™”_p
);

98 
´ofe_™”©Ü


99 (**
™”_p
, **
»t_Çme
, **
»t_v®ue
);

101 
´ofe_syÁax_”r_cb_t
 
	`´ofe_£t_syÁax_”r_cb
Õrofe_syÁax_”r_cb_ˆ
hook
);

103 #ifdeà
__ılu¥lus


104 
	}
}

	@libmke2fs/profile.h

39 #iâdeà
_PROFILE_H


40 
	#_PROFILE_H


	)

42 
_´ofe_t
 *
	t´ofe_t
;

44 (*
	t´ofe_syÁax_”r_cb_t
)(cÚ¡ *
	tfe
, 
	t”r
,

45 
	tlše_num
);

50 
	#PROFILE_ITER_LIST_SECTION
 0x0001

	)

51 
	#PROFILE_ITER_SECTIONS_ONLY
 0x0002

	)

52 
	#PROFILE_ITER_RELATIONS_ONLY
 0x0004

	)

54 #ifdeà
__ılu¥lus


58 
´ofe_š™


59 (cÚ¡ * *
fes
, 
´ofe_t
 *
»t_´ofe
);

61 
´ofe_»Ëa£


62 (
´ofe_t
 
´ofe
);

64 
´ofe_£t_deçuÉ


65 (
´ofe_t
 
´ofe
, cÚ¡ *
def_¡ršg
);

67 
´ofe_g‘_¡ršg


68 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

69 cÚ¡ *
subsubÇme
, cÚ¡ *
def_v®
,

70 **
»t_¡ršg
);

71 
´ofe_g‘_š‹g”


72 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

73 cÚ¡ *
subsubÇme
, 
def_v®
,

74 *
»t_deçuÉ
);

76 
´ofe_g‘_ušt


77 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

78 cÚ¡ *
subsubÇme
, 
def_v®
,

79 *
»t_št
);

81 
´ofe_g‘_doubË


82 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

83 cÚ¡ *
subsubÇme
, 
def_v®
,

84 *
»t_æßt
);

86 
´ofe_g‘_boŞ—n


87 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

88 cÚ¡ *
subsubÇme
, 
def_v®
,

89 *
»t_deçuÉ
);

91 
´ofe_™”©Ü_ü—‹


92 (
´ofe_t
 
´ofe
, cÚ¡ *cÚ¡ *
Çmes
,

93 
æags
, **
»t_™”
);

95 
´ofe_™”©Ü_ä“


96 (**
™”_p
);

98 
´ofe_™”©Ü


99 (**
™”_p
, **
»t_Çme
, **
»t_v®ue
);

101 
´ofe_syÁax_”r_cb_t
 
	`´ofe_£t_syÁax_”r_cb
Õrofe_syÁax_”r_cb_ˆ
hook
);

103 #ifdeà
__ılu¥lus


104 
	}
}

	@libmke2fs/util.h

13 
jouº®_size
;

14 
jouº®_æags
;

15 *
jouº®_deviû
;

17 *
g‘_´ogÇme
(*
¬gv_z”o
);

18 
´oûed_que¡iÚ
();

19 
check_¶ausib™y
(cÚ¡ *
deviû
);

20 
·r£_jouº®_İts
(cÚ¡ *
İts
);

21 
check_mouÁ
(cÚ¡ *
deviû
, 
fÜû
, cÚ¡ *
ty³
);

22 
figu»_jouº®_size
(
size
, 
ext2_fsys
 
fs
);

23 
´št_check_mes§ge
(, );

24 
dump_mmp_msg
(
mmp_¡ruù
 *
mmp
, cÚ¡ *
msg
);

	@libmke2fs/util.h

13 
jouº®_size
;

14 
jouº®_æags
;

15 *
jouº®_deviû
;

17 *
g‘_´ogÇme
(*
¬gv_z”o
);

18 
´oûed_que¡iÚ
();

19 
check_¶ausib™y
(cÚ¡ *
deviû
);

20 
·r£_jouº®_İts
(cÚ¡ *
İts
);

21 
check_mouÁ
(cÚ¡ *
deviû
, 
fÜû
, cÚ¡ *
ty³
);

22 
figu»_jouº®_size
(
size
, 
ext2_fsys
 
fs
);

23 
´št_check_mes§ge
(, );

24 
dump_mmp_msg
(
mmp_¡ruù
 *
mmp
, cÚ¡ *
msg
);

	@macro_def.h

1 #iâdeà
__MACRO_DEF_H__


2 
	#__MACRO_DEF_H__


	)

4 #ifdeà
NUUO


5 
	#_LOCK
(
l
è\

	)

7 
	gnuuo_æag
 = 
NUUO_FLAG
; \

8 ià(
	gnuuo_æag
è
	gm_cs
##
	gl
.
Lock
(); \

11 
	#_UNLOCK
(
l
è\

	)

13 
	gnuuo_æag
 = 
NUUO_FLAG
; \

14 ià(
	gnuuo_æag
è
	gm_cs
##
	gl
.
UÆock
(); \

17 
	#_CS
(
l
è\

	)

18 
Cr™iÿlSeùiÚLock
 
	g_cs
##
l
(&
m_cs
##l)

	@macro_def.h

1 #iâdeà
__MACRO_DEF_H__


2 
	#__MACRO_DEF_H__


	)

4 #ifdeà
NUUO


5 
	#_LOCK
(
l
è\

	)

7 
	gnuuo_æag
 = 
NUUO_FLAG
; \

8 ià(
	gnuuo_æag
è
	gm_cs
##
	gl
.
Lock
(); \

11 
	#_UNLOCK
(
l
è\

	)

13 
	gnuuo_æag
 = 
NUUO_FLAG
; \

14 ià(
	gnuuo_æag
è
	gm_cs
##
	gl
.
UÆock
(); \

17 
	#_CS
(
l
è\

	)

18 
Cr™iÿlSeùiÚLock
 
	g_cs
##
l
(&
m_cs
##l)

	@test_utils.cpp

1 
	~"‹¡_uts.h
"

3 
	~<sys/ty³s.h
>

4 
	~<sys/¡©.h
>

5 
	~<uni¡d.h
>

6 
	~<¡ršg.h
>

7 
	~<”ºo.h
>

9 #iâdeà
NUUO


10 
¡ršg
 
	$¡ršg_fÜm©
(cÚ¡ * 
fmt
, ...)

12 
va_li¡
 
¬gs
;

13 
buf
[64];

14 
	`va_¡¬t
(
¬gs
, 
fmt
);

15 
	`v¢´štf
(
buf
, 63, 
fmt
, 
¬gs
);

16 
	`va_’d
(
¬gs
);

17  
buf
;

18 
	}
}

20 
boŞ
 
	$CheckBlockDeviû
(cÚ¡ 
¡ršg
& 
dev
)

22 
¡©
 
sb
;

23 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

24 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

25  
çl£
;

28 ià(
	`S_ISBLK
(
sb
.
¡_mode
)) {

29  
Œue
;

32  
çl£
;

33 
	}
}

35 
boŞ
 
	$CheckDœeùÜyExi¡
(cÚ¡ 
¡ršg
& 
dev
)

37 
¡©
 
sb
;

38 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

39 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

40  
çl£
;

43 ià(
	`S_ISDIR
(
sb
.
¡_mode
)) {

44  
Œue
;

47  
çl£
;

48 
	}
}

50 
boŞ
 
	$CheckFeExi¡
(cÚ¡ 
¡ršg
& 
dev
)

52 
¡©
 
sb
;

53 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

54 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

55  
çl£
;

58 ià(
	`S_ISREG
(
sb
.
¡_mode
)) {

59  
Œue
;

62  
çl£
;

63 
	}
}

65 
boŞ
 
	$MakeDœeùÜy
(cÚ¡ 
¡ršg
& 
·thÇme
)

67 
¡©us
 = 
	`mkdœ
(
·thÇme
.
	`c_¡r
(), 0666);

68 ià(
¡©us
 < 0) {

69 
	`årštf
(
¡d”r
, "%s: %s, %s\n", 
__func__
, 
·thÇme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

70  
çl£
;

73  
Œue
;

74 
	}
}

76 
off_t
 
	$G‘FeStÜageSize
(cÚ¡ 
¡ršg
& 
·thÇme
)

78 
¡©
 
¡
;

79 ià(
	`¡©
(
·thÇme
.
	`c_¡r
(), &
¡
) == 0)

80  
¡
.
¡_size
;

82 
	`årštf
(
¡d”r
, "%s: %s, %s\n", 
__func__
, 
·thÇme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

84 
	}
}

	@test_utils.cpp

1 
	~"‹¡_uts.h
"

3 
	~<sys/ty³s.h
>

4 
	~<sys/¡©.h
>

5 
	~<uni¡d.h
>

6 
	~<¡ršg.h
>

7 
	~<”ºo.h
>

9 #iâdeà
NUUO


10 
¡ršg
 
	$¡ršg_fÜm©
(cÚ¡ * 
fmt
, ...)

12 
va_li¡
 
¬gs
;

13 
buf
[64];

14 
	`va_¡¬t
(
¬gs
, 
fmt
);

15 
	`v¢´štf
(
buf
, 63, 
fmt
, 
¬gs
);

16 
	`va_’d
(
¬gs
);

17  
buf
;

18 
	}
}

20 
boŞ
 
	$CheckBlockDeviû
(cÚ¡ 
¡ršg
& 
dev
)

22 
¡©
 
sb
;

23 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

24 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

25  
çl£
;

28 ià(
	`S_ISBLK
(
sb
.
¡_mode
)) {

29  
Œue
;

32  
çl£
;

33 
	}
}

35 
boŞ
 
	$CheckDœeùÜyExi¡
(cÚ¡ 
¡ršg
& 
dev
)

37 
¡©
 
sb
;

38 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

39 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

40  
çl£
;

43 ià(
	`S_ISDIR
(
sb
.
¡_mode
)) {

44  
Œue
;

47  
çl£
;

48 
	}
}

50 
boŞ
 
	$CheckFeExi¡
(cÚ¡ 
¡ršg
& 
dev
)

52 
¡©
 
sb
;

53 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

54 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

55  
çl£
;

58 ià(
	`S_ISREG
(
sb
.
¡_mode
)) {

59  
Œue
;

62  
çl£
;

63 
	}
}

65 
boŞ
 
	$MakeDœeùÜy
(cÚ¡ 
¡ršg
& 
·thÇme
)

67 
¡©us
 = 
	`mkdœ
(
·thÇme
.
	`c_¡r
(), 0666);

68 ià(
¡©us
 < 0) {

69 
	`årštf
(
¡d”r
, "%s: %s, %s\n", 
__func__
, 
·thÇme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

70  
çl£
;

73  
Œue
;

74 
	}
}

76 
off_t
 
	$G‘FeStÜageSize
(cÚ¡ 
¡ršg
& 
·thÇme
)

78 
¡©
 
¡
;

79 ià(
	`¡©
(
·thÇme
.
	`c_¡r
(), &
¡
) == 0)

80  
¡
.
¡_size
;

82 
	`årštf
(
¡d”r
, "%s: %s, %s\n", 
__func__
, 
·thÇme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

84 
	}
}

	@test_utils.h

1 #iâdeà
__TEST_UTILS_H__


2 
	#__TEST_UTILS_H__


	)

4 #iâdeà
NUUO


5 
	~<¡ršg
>

7 
	~<¡dio.h
>

8 
	~<sy¦og.h
>

9 
	~<¡d¬g.h
>

11 
usšg
 
Çme¥aû
 
	g¡d
;

13 
	#Wr™eHWLog
(
çc™y
, 
Ëv–
, 
Ïb–
, 
fmt
, ...) \

15 
	`´štf
("[%d][%s][%s][%s] " 
fmt
, 
__LINE__
, #çc™y, #Ëv–, 
Ïb–
, ##
__VA_ARGS__
); \

16 } 0);

	)

18 
¡ršg
 
¡ršg_fÜm©
(cÚ¡ * 
fmt
, ...);

19 
boŞ
 
CheckBlockDeviû
(cÚ¡ 
¡ršg
& 
dev
);

20 
boŞ
 
CheckDœeùÜyExi¡
(cÚ¡ 
¡ršg
& 
dev
);

21 
boŞ
 
MakeDœeùÜy
(cÚ¡ 
¡ršg
& 
·thÇme
);

22 
boŞ
 
CheckFeExi¡
(cÚ¡ 
¡ršg
& 
dev
);

23 
off_t
 
G‘FeStÜageSize
(cÚ¡ 
¡ršg
& 
·thÇme
);

25 şas 
	cCr™iÿlSeùiÚ
 {

26 
	m´iv©e
:

27 
m_iLock
;

29 
	mpublic
:

30 
	$Cr™iÿlSeùiÚ
()

31 : 
	$m_iLock
(0)

34 ~
	$Cr™iÿlSeùiÚ
(è{ 
m_iLock
 = 0; 
	}
}

36 
	$Lock
() {

37 
m_iLock
++;

38 
	}
}

40 
	$UÆock
() {

41 
m_iLock
--;

42 
	}
}

45 şas 
	cCr™iÿlSeùiÚLock
 {

46 
	m´iv©e
:

47 
Cr™iÿlSeùiÚ
 *
m_cs
;

48 
Cr™iÿlSeùiÚLock
();

49 
	mpublic
:

50 
	$Cr™iÿlSeùiÚLock
(
Cr™iÿlSeùiÚ
 *
cs
)

51 : 
	$m_cs
(
cs
)

53 ià(
m_cs
)

54 
m_cs
->
	`Lock
();

56 ~
	$Cr™iÿlSeùiÚLock
() {

57 ià(
m_cs
)

58 
m_cs
->
	`UÆock
();

59 
	}
}

	@test_utils.h

1 #iâdeà
__TEST_UTILS_H__


2 
	#__TEST_UTILS_H__


	)

4 #iâdeà
NUUO


5 
	~<¡ršg
>

7 
	~<¡dio.h
>

8 
	~<sy¦og.h
>

9 
	~<¡d¬g.h
>

11 
usšg
 
Çme¥aû
 
	g¡d
;

13 
	#Wr™eHWLog
(
çc™y
, 
Ëv–
, 
Ïb–
, 
fmt
, ...) \

15 
	`´štf
("[%d][%s][%s][%s] " 
fmt
, 
__LINE__
, #çc™y, #Ëv–, 
Ïb–
, ##
__VA_ARGS__
); \

16 } 0);

	)

18 
¡ršg
 
¡ršg_fÜm©
(cÚ¡ * 
fmt
, ...);

19 
boŞ
 
CheckBlockDeviû
(cÚ¡ 
¡ršg
& 
dev
);

20 
boŞ
 
CheckDœeùÜyExi¡
(cÚ¡ 
¡ršg
& 
dev
);

21 
boŞ
 
MakeDœeùÜy
(cÚ¡ 
¡ršg
& 
·thÇme
);

22 
boŞ
 
CheckFeExi¡
(cÚ¡ 
¡ršg
& 
dev
);

23 
off_t
 
G‘FeStÜageSize
(cÚ¡ 
¡ršg
& 
·thÇme
);

25 şas 
	cCr™iÿlSeùiÚ
 {

26 
	m´iv©e
:

27 
m_iLock
;

29 
	mpublic
:

30 
	$Cr™iÿlSeùiÚ
()

31 : 
	$m_iLock
(0)

34 ~
	$Cr™iÿlSeùiÚ
(è{ 
m_iLock
 = 0; 
	}
}

36 
	$Lock
() {

37 
m_iLock
++;

38 
	}
}

40 
	$UÆock
() {

41 
m_iLock
--;

42 
	}
}

45 şas 
	cCr™iÿlSeùiÚLock
 {

46 
	m´iv©e
:

47 
Cr™iÿlSeùiÚ
 *
m_cs
;

48 
Cr™iÿlSeùiÚLock
();

49 
	mpublic
:

50 
	$Cr™iÿlSeùiÚLock
(
Cr™iÿlSeùiÚ
 *
cs
)

51 : 
	$m_cs
(
cs
)

53 ià(
m_cs
)

54 
m_cs
->
	`Lock
();

56 ~
	$Cr™iÿlSeùiÚLock
() {

57 ià(
m_cs
)

58 
m_cs
->
	`UÆock
();

59 
	}
}

	@unitest/FilesystemManager_test.cpp

1 
	~"Fesy¡emMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/sy¡em.h
"

7 
	$maš
(
¬gc
, *
¬gv
[])

9 
Fesy¡emMªag”
 
	`fs_mgr
("/dev/md0");

10 
fs_mgr
.
	`S‘MouÁPošt
("/mnt/VOLUME0");

11 #ifdeà
NUUO


12 
fs_mgr
.
	`C»©eTh»ad
();

15 
	`´štf
("Progress: ");

16 
´og»ss
 = 0, 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
;

17 
FILE
 *
pf
 = 
	`fİ’
("fs_test.log", "w+");

18 #ifdeà
NUUO


19 
fs_mgr
.
	`Th»adExi¡s
()) {

21 ià(
fs_mgr
.
	`IsFÜm©šg
(
´og»ss
, 
¡©
)) {

22 
	`årštf
(
pf
, "%3d%%\n", 
´og»ss
);

23 
	`fæush
(
pf
);

25 #ifdeà
NUUO


26 
	`SË•MS
(100);

29 ià(!
fs_mgr
.
	`IsFÜm©šg
(
´og»ss
, 
¡©
è&& sˆ=ğ
WRITE_INODE_TABLES_DONE
) {

30 
	`årštf
(
pf
, "DÚe:%3d%%\n", 
´og»ss
);

32 
	`fşo£
(
pf
);

49 
	}
}

	@unitest/FilesystemManager_test.cpp

1 
	~"Fesy¡emMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/sy¡em.h
"

7 
	$maš
(
¬gc
, *
¬gv
[])

9 
Fesy¡emMªag”
 
	`fs_mgr
("/dev/md0");

10 
fs_mgr
.
	`S‘MouÁPošt
("/mnt/VOLUME0");

11 #ifdeà
NUUO


12 
fs_mgr
.
	`C»©eTh»ad
();

15 
	`´štf
("Progress: ");

16 
´og»ss
 = 0, 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
;

17 
FILE
 *
pf
 = 
	`fİ’
("fs_test.log", "w+");

18 #ifdeà
NUUO


19 
fs_mgr
.
	`Th»adExi¡s
()) {

21 ià(
fs_mgr
.
	`IsFÜm©šg
(
´og»ss
, 
¡©
)) {

22 
	`årštf
(
pf
, "%3d%%\n", 
´og»ss
);

23 
	`fæush
(
pf
);

25 #ifdeà
NUUO


26 
	`SË•MS
(100);

29 ià(!
fs_mgr
.
	`IsFÜm©šg
(
´og»ss
, 
¡©
è&& sˆ=ğ
WRITE_INODE_TABLES_DONE
) {

30 
	`årštf
(
pf
, "DÚe:%3d%%\n", 
´og»ss
);

32 
	`fşo£
(
pf
);

49 
	}
}

	@unitest/RAIDManager_test.cpp

1 
	~"RAIDMªag”.h
"

3 
	~<uni¡d.h
>

4 
	~<¡dlib.h
>

5 
	~<¡dio.h
>

6 
	~<sigÇl.h
>

8 
boŞ
 
	gg_bLoİ
 = 
Œue
;

10 
Te¡šgLoİ
(cÚ¡ * 
cfg
, 
RAIDMªag”
& 
¿id_mgr
);

12 
	$sig_hªdËr
(
sig
)

14 ià(
sig
 =ğ
SIGINT
) {

15 
g_bLoİ
 = 
çl£
;

16 
	`´štf
("received SIGINT\n");

18 
	}
}

20 
	$maš
(
¬gc
, * 
¬gv
[])

22 
İt
;

23 
RAIDMªag”
 
¿id_mgr
;

24 
Ëv–
 = -1;

25 
¡ršg
 
¡rMDName
;

26 
boŞ
 
bC»©e
 = 
çl£
;

27 
boŞ
 
bAddDisk
 = 
çl£
;

28 
boŞ
 
bRemove
 = 
çl£
;

29 
boŞ
 
bFe
 = 
çl£
;

30 
veùÜ
<
¡ršg
> 
vDevLi¡
;

31 
veùÜ
<
RAIDInfo
> 
li¡
;

32 
‹¡šg_sûÇrio_fe
[256];

34 
	`sigÇl
(
SIGINT
, 
sig_hªdËr
);

35 
	`sigÇl
(
SIGTERM
, 
sig_hªdËr
);

37 (
İt
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "arcl:f:")) != -1) {

38 
İt
) {

40 
bAddDisk
 = 
Œue
;

43 
bRemove
 = 
Œue
;

46 
bC»©e
 = 
Œue
;

49 
Ëv–
 = 
	`©oi
(
İrg
);

52 
bFe
 = 
Œue
;

53 
	`¡ºıy
(
‹¡šg_sûÇrio_fe
, 
İrg
, (testing_scenario_file) - 1);

58 ià(
bFe
) {

59 
	`Te¡šgLoİ
(
‹¡šg_sûÇrio_fe
, 
¿id_mgr
);

63 ià(
¬gc
 > 
İtšd
) {

64 
i
 = 
İtšd
; i < 
¬gc
; i++) {

65 
vDevLi¡
.
	`push_back
(
¬gv
[
i
]);

69 ià(
bAddDisk
) {

70 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++) {

71 
¿id_mgr
.
	`AddDiskSymLšk
(
vDevLi¡
[
i
], 
DISK_TYPE_SATA
);

72 
¿id_mgr
.
	`AddDisk
(
vDevLi¡
[
i
]);

76 ià(
bRemove
) {

77 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++)

78 
¿id_mgr
.
	`RemoveDisk
(
vDevLi¡
[
i
]);

81 ià(
bC»©e
) {

82 ià(
Ëv–
 < 0)  1;

83 ià(
vDevLi¡
.
	`em±y
())  1;

84 
¿id_mgr
.
	`C»©eRAID
(
vDevLi¡
, 
Ëv–
, 
¡rMDName
);

87 
g_bLoİ
) {

88 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

90 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++) {

91 
li¡
[
i
].
	`Dump
();

94 
	`¦“p
(10);

96 
¿id_mgr
.
	`Upd©eRAIDInfo
();

99 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++)

100 
¿id_mgr
.
	`StİRAID
(
li¡
[
i
].
m_¡rDevNodeName
);

102 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++) {

103 
¿id_mgr
.
	`RemoveDiskSymLšk
(
vDevLi¡
[
i
]);

104 
¿id_mgr
.
	`RemoveDisk
(
vDevLi¡
[
i
]);

108 
	}
}

	@unitest/RAIDManager_test.cpp

1 
	~"RAIDMªag”.h
"

3 
	~<uni¡d.h
>

4 
	~<¡dlib.h
>

5 
	~<¡dio.h
>

6 
	~<sigÇl.h
>

8 
boŞ
 
	gg_bLoİ
 = 
Œue
;

10 
Te¡šgLoİ
(cÚ¡ * 
cfg
, 
RAIDMªag”
& 
¿id_mgr
);

12 
	$sig_hªdËr
(
sig
)

14 ià(
sig
 =ğ
SIGINT
) {

15 
g_bLoİ
 = 
çl£
;

16 
	`´štf
("received SIGINT\n");

18 
	}
}

20 
	$maš
(
¬gc
, * 
¬gv
[])

22 
İt
;

23 
RAIDMªag”
 
¿id_mgr
;

24 
Ëv–
 = -1;

25 
¡ršg
 
¡rMDName
;

26 
boŞ
 
bC»©e
 = 
çl£
;

27 
boŞ
 
bAddDisk
 = 
çl£
;

28 
boŞ
 
bRemove
 = 
çl£
;

29 
boŞ
 
bFe
 = 
çl£
;

30 
veùÜ
<
¡ršg
> 
vDevLi¡
;

31 
veùÜ
<
RAIDInfo
> 
li¡
;

32 
‹¡šg_sûÇrio_fe
[256];

34 
	`sigÇl
(
SIGINT
, 
sig_hªdËr
);

35 
	`sigÇl
(
SIGTERM
, 
sig_hªdËr
);

37 (
İt
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "arcl:f:")) != -1) {

38 
İt
) {

40 
bAddDisk
 = 
Œue
;

43 
bRemove
 = 
Œue
;

46 
bC»©e
 = 
Œue
;

49 
Ëv–
 = 
	`©oi
(
İrg
);

52 
bFe
 = 
Œue
;

53 
	`¡ºıy
(
‹¡šg_sûÇrio_fe
, 
İrg
, (testing_scenario_file) - 1);

58 ià(
bFe
) {

59 
	`Te¡šgLoİ
(
‹¡šg_sûÇrio_fe
, 
¿id_mgr
);

63 ià(
¬gc
 > 
İtšd
) {

64 
i
 = 
İtšd
; i < 
¬gc
; i++) {

65 
vDevLi¡
.
	`push_back
(
¬gv
[
i
]);

69 ià(
bAddDisk
) {

70 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++) {

71 
¿id_mgr
.
	`AddDiskSymLšk
(
vDevLi¡
[
i
], 
DISK_TYPE_SATA
);

72 
¿id_mgr
.
	`AddDisk
(
vDevLi¡
[
i
]);

76 ià(
bRemove
) {

77 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++)

78 
¿id_mgr
.
	`RemoveDisk
(
vDevLi¡
[
i
]);

81 ià(
bC»©e
) {

82 ià(
Ëv–
 < 0)  1;

83 ià(
vDevLi¡
.
	`em±y
())  1;

84 
¿id_mgr
.
	`C»©eRAID
(
vDevLi¡
, 
Ëv–
, 
¡rMDName
);

87 
g_bLoİ
) {

88 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

90 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++) {

91 
li¡
[
i
].
	`Dump
();

94 
	`¦“p
(10);

96 
¿id_mgr
.
	`Upd©eRAIDInfo
();

99 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++)

100 
¿id_mgr
.
	`StİRAID
(
li¡
[
i
].
m_¡rDevNodeName
);

102 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++) {

103 
¿id_mgr
.
	`RemoveDiskSymLšk
(
vDevLi¡
[
i
]);

104 
¿id_mgr
.
	`RemoveDisk
(
vDevLi¡
[
i
]);

108 
	}
}

	@unitest/TestingLoop.cpp

1 
	~"RAIDMªag”.h
"

3 
	~<¡dio.h
>

4 
	~<¡ršg.h
>

6 
	~<¡ršg
>

7 
	~<veùÜ
>

10 
	mOP_ADDDISK
 = 'a',

11 
	mOP_REMDISK
 = 'r',

12 
	mOP_CREATERAID
 = 'C',

13 
	mOP_STOPRAID
 = 'S',

14 
	mOP_DELETERAID
 = 'D',

15 
	mOP_ASSEMBLERAID
 = 'A',

16 
	mOP_MANAGEMDDISK
 = 'M',

22 
	mOP_DONOTHING
 = 'N',

26 
	mMANAGE_M¬kFauÉy
 = 'f',

27 
	mMANAGE_Remove
 = 'r',

28 
	mMANAGE_Add
 = 'a',

29 
	mMANAGE_R—dd
 = 'A',

30 
	mMANAGE_R•Ïû
 = 'R',

33 
	#OPERATION_CASE
(
İ
) \

34 
OP_
##
İ
: \

35 
	`´štf
("%s\n", #op); \

36 
HªdË
##
	`İ
(
cÚ‹Á
, 
¿id_mgr
); \

37 ;

	)

39 
	#MANAGE_CASE
(
İ
) \

40 
MANAGE_
##
İ
: \

41 
	`´štf
("İ”©iÚ = %c\n", 
İ”©iÚ
); \

42 
¿id_mgr
.
İ
##
	`MDDisks
(
mddev
, 
vdisks
); \

43 ;

	)

46 
boŞ
 
g_bLoİ
;

48 
usšg
 
Çme¥aû
 
	g¡d
;

50 
tok’ize
(* 
rg‘
, 
veùÜ
<
¡ršg
>& 
tok’s
)

52 *
	g§v•Œ
 = 
NULL
;

53 *
	gp
 = 
¡¹ok_r
(
rg‘
, ",", &
§v•Œ
);

55 
	gtok’s
.
ş—r
();

56 
	gp
) {

57 
´štf
 ("Tok’: %s\n", 
p
);

58 
	gtok’s
.
push_back
(
p
);

59 
	gp
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ
);

63 
	$HªdËADDDISK
 (* 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

65 
veùÜ
<
¡ršg
> 
disks
;

66 
	`tok’ize
(
cÚ‹Á
, 
disks
);

67 
size_t
 
i
 = 0; i < 
disks
.
	`size
(); i++) {

68 
¿id_mgr
.
	`AddDisk
(
disks
[
i
]);

69 
¿id_mgr
.
	`AddDiskSymLšk
(
disks
[
i
], 
DISK_TYPE_SATA
);

71 
	}
}

73 
	$HªdËREMDISK
 (* 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

75 
veùÜ
<
¡ršg
> 
disks
;

76 
	`tok’ize
(
cÚ‹Á
, 
disks
);

77 
size_t
 
i
 = 0; i < 
disks
.
	`size
(); i++) {

78 
¿id_mgr
.
	`RemoveDisk
(
disks
[
i
]);

80 
	}
}

82 
	$HªdËCREATERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

84 
lv
 = 0;

85 
disks
[1024];

86 
veùÜ
<
¡ršg
> 
vdisks
;

87 
¡ršg
 
¡rMDName
;

88 
	`ssÿnf
(
cÚ‹Á
, "%d,%1023s", &
lv
, 
disks
);

89 
	`tok’ize
(
disks
, 
vdisks
);

90 
	`´štf
("lv = %d\n", 
lv
);

91 
¿id_mgr
.
	`C»©eRAID
(
vdisks
, 
lv
, 
¡rMDName
);

92 
¿id_mgr
.
	`FÜm©
(
¡rMDName
);

93 
	}
}

95 
	$HªdËMANAGEMDDISK
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

97 
İ”©iÚ
;

98 
disks
[1024];

99 
mddev
[16];

100 
veùÜ
<
¡ršg
> 
vdisks
;

101 
	`ssÿnf
(
cÚ‹Á
, "%c,%15[^,],%1023s", &
İ”©iÚ
, 
mddev
, 
disks
);

102 
	`tok’ize
(
disks
, 
vdisks
);

103 
	`´štf
("mddev = %s\n", 
mddev
);

105 
İ”©iÚ
) {

106 
	`MANAGE_CASE
(
M¬kFauÉy
)

107 
	`MANAGE_CASE
(
Remove
)

108 
	`MANAGE_CASE
(
Add
)

109 
	`MANAGE_CASE
(
R—dd
)

110 
MANAGE_R•Ïû
:

111 
	`´štf
("Replace\n");

112 ià(
vdisks
.
	`size
() == 2) {

113 
¿id_mgr
.
	`R•ÏûMDDisk
(
mddev
, 
vdisks
[0], vdisks[1]);

115 
	`´štf
("Disk‚umber is‚ot‡ccepted\n");

120 
	}
}

122 
	$HªdËSTOPRAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

124 ià(
	`¡ºcmp
("®l", 
cÚ‹Á
, ("all")) == 0) {

125 
veùÜ
<
RAIDInfo
> 
li¡
;

126 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

127 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++) {

128 
¡©
 = 0, 
´og»ss
 = 0;

134 
¿id_mgr
.
	`StİRAID
(
li¡
[
i
].
m_¡rDevNodeName
);

137 
¿id_mgr
.
	`StİRAID
(
cÚ‹Á
);

139 
	}
}

141 
	$HªdËDELETERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

143 ià(
	`¡ºcmp
("®l", 
cÚ‹Á
, ("all")) == 0) {

144 
veùÜ
<
RAIDInfo
> 
li¡
;

145 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

146 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++)

147 
¿id_mgr
.
	`D–‘eRAID
(
li¡
[
i
].
m_¡rDevNodeName
);

149 
¿id_mgr
.
	`D–‘eRAID
(
cÚ‹Á
);

151 
	}
}

153 
	$HªdËFAULTYDISK
 (cÚ¡ * 
cÚ‹Á
)

155 
	}
}

157 
	$HªdËREMMDDISK
 (cÚ¡ * 
cÚ‹Á
)

159 
	}
}

161 
	$HªdËADDMDDISK
 (cÚ¡ * 
cÚ‹Á
)

163 
	}
}

165 
	$HªdËREADDMDDISK
 (cÚ¡ * 
cÚ‹Á
)

167 
	}
}

169 
	$HªdËREPLACEMDDISK
 (cÚ¡ * 
cÚ‹Á
)

171 
	}
}

173 
	$HªdËASSEMBLERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

175 
ty³
[5];

176 
šfo
[1024];

177 
	`ssÿnf
(
cÚ‹Á
, "%4[^,],%1023s", 
ty³
, 
šfo
);

179 
	`´štf
("ty³ = %s\n", 
ty³
);

180 ià(
	`¡ºcmp
("disk", 
ty³
, 
	`¡¾’
("disk")) == 0) {

181 
veùÜ
<
¡ršg
> 
vdisks
;

182 
¡ršg
 
¡rMDName
;

183 
	`tok’ize
(
šfo
, 
vdisks
);

184 
¿id_mgr
.
	`As£mbËRAID
(
vdisks
, 
¡rMDName
);

185 } ià(
	`¡ºcmp
("uuid", 
ty³
, 
	`¡¾’
("uuid")) == 0) {

188 
	}
}

190 
	$HªdËDONOTHING
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

192 
¿id_mgr
.
	`Upd©eRAIDInfo
();

194 
veùÜ
<
RAIDInfo
> 
li¡
;

195 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

196 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i++) {

197 
li¡
[
i
].
	`Dump
();

199 
¿id_mgr
.
	`Dump
();

200 
	}
}

202 
	$Te¡šgLoİ
(cÚ¡ * 
cfg
, 
RAIDMªag”
& 
¿id_mgr
)

204 
FILE
 *
pFe
 = 
	`fİ’
(
cfg
, "r");

205 
lše
[1024];

206 
cÚ‹Á
[1024];

207 
o
 = 
OP_DONOTHING
;

209 ià(
pFe
 =ğ
NULL
) {

210 
	`´štf
("Failo open file\n");

215 
	`fg‘s
(
lše
, 1023, 
pFe
è!ğ
NULL
 && 
g_bLoİ
) {

216 ià(
lše
[0] == '#')

218 
	`´štf
("\nRun: %s", 
lše
);

219 
	`ssÿnf
(
lše
, "%c:%1023[^:\n]", &
o
, 
cÚ‹Á
);

221 
o
) {

222 
	`OPERATION_CASE
(
ADDDISK
)

223 
	`OPERATION_CASE
(
REMDISK
)

224 
	`OPERATION_CASE
(
CREATERAID
)

225 
	`OPERATION_CASE
(
STOPRAID
)

226 
	`OPERATION_CASE
(
DELETERAID
)

232 
	`OPERATION_CASE
(
ASSEMBLERAID
)

233 
	`OPERATION_CASE
(
MANAGEMDDISK
)

234 
	`OPERATION_CASE
(
DONOTHING
)

239 
	`¦“p
(10);

243 
	`fşo£
(
pFe
);

244 
	}
}

	@unitest/TestingLoop.cpp

1 
	~"RAIDMªag”.h
"

3 
	~<¡dio.h
>

4 
	~<¡ršg.h
>

6 
	~<¡ršg
>

7 
	~<veùÜ
>

10 
	mOP_ADDDISK
 = 'a',

11 
	mOP_REMDISK
 = 'r',

12 
	mOP_CREATERAID
 = 'C',

13 
	mOP_STOPRAID
 = 'S',

14 
	mOP_DELETERAID
 = 'D',

15 
	mOP_ASSEMBLERAID
 = 'A',

16 
	mOP_MANAGEMDDISK
 = 'M',

22 
	mOP_DONOTHING
 = 'N',

26 
	mMANAGE_M¬kFauÉy
 = 'f',

27 
	mMANAGE_Remove
 = 'r',

28 
	mMANAGE_Add
 = 'a',

29 
	mMANAGE_R—dd
 = 'A',

30 
	mMANAGE_R•Ïû
 = 'R',

33 
	#OPERATION_CASE
(
İ
) \

34 
OP_
##
İ
: \

35 
	`´štf
("%s\n", #op); \

36 
HªdË
##
	`İ
(
cÚ‹Á
, 
¿id_mgr
); \

37 ;

	)

39 
	#MANAGE_CASE
(
İ
) \

40 
MANAGE_
##
İ
: \

41 
	`´štf
("İ”©iÚ = %c\n", 
İ”©iÚ
); \

42 
¿id_mgr
.
İ
##
	`MDDisks
(
mddev
, 
vdisks
); \

43 ;

	)

46 
boŞ
 
g_bLoİ
;

48 
usšg
 
Çme¥aû
 
	g¡d
;

50 
tok’ize
(* 
rg‘
, 
veùÜ
<
¡ršg
>& 
tok’s
)

52 *
	g§v•Œ
 = 
NULL
;

53 *
	gp
 = 
¡¹ok_r
(
rg‘
, ",", &
§v•Œ
);

55 
	gtok’s
.
ş—r
();

56 
	gp
) {

57 
´štf
 ("Tok’: %s\n", 
p
);

58 
	gtok’s
.
push_back
(
p
);

59 
	gp
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ
);

63 
	$HªdËADDDISK
 (* 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

65 
veùÜ
<
¡ršg
> 
disks
;

66 
	`tok’ize
(
cÚ‹Á
, 
disks
);

67 
size_t
 
i
 = 0; i < 
disks
.
	`size
(); i++) {

68 
¿id_mgr
.
	`AddDisk
(
disks
[
i
]);

69 
¿id_mgr
.
	`AddDiskSymLšk
(
disks
[
i
], 
DISK_TYPE_SATA
);

71 
	}
}

73 
	$HªdËREMDISK
 (* 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

75 
veùÜ
<
¡ršg
> 
disks
;

76 
	`tok’ize
(
cÚ‹Á
, 
disks
);

77 
size_t
 
i
 = 0; i < 
disks
.
	`size
(); i++) {

78 
¿id_mgr
.
	`RemoveDisk
(
disks
[
i
]);

80 
	}
}

82 
	$HªdËCREATERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

84 
lv
 = 0;

85 
disks
[1024];

86 
veùÜ
<
¡ršg
> 
vdisks
;

87 
¡ršg
 
¡rMDName
;

88 
	`ssÿnf
(
cÚ‹Á
, "%d,%1023s", &
lv
, 
disks
);

89 
	`tok’ize
(
disks
, 
vdisks
);

90 
	`´štf
("lv = %d\n", 
lv
);

91 
¿id_mgr
.
	`C»©eRAID
(
vdisks
, 
lv
, 
¡rMDName
);

92 
¿id_mgr
.
	`FÜm©
(
¡rMDName
);

93 
	}
}

95 
	$HªdËMANAGEMDDISK
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

97 
İ”©iÚ
;

98 
disks
[1024];

99 
mddev
[16];

100 
veùÜ
<
¡ršg
> 
vdisks
;

101 
	`ssÿnf
(
cÚ‹Á
, "%c,%15[^,],%1023s", &
İ”©iÚ
, 
mddev
, 
disks
);

102 
	`tok’ize
(
disks
, 
vdisks
);

103 
	`´štf
("mddev = %s\n", 
mddev
);

105 
İ”©iÚ
) {

106 
	`MANAGE_CASE
(
M¬kFauÉy
)

107 
	`MANAGE_CASE
(
Remove
)

108 
	`MANAGE_CASE
(
Add
)

109 
	`MANAGE_CASE
(
R—dd
)

110 
MANAGE_R•Ïû
:

111 
	`´štf
("Replace\n");

112 ià(
vdisks
.
	`size
() == 2) {

113 
¿id_mgr
.
	`R•ÏûMDDisk
(
mddev
, 
vdisks
[0], vdisks[1]);

115 
	`´štf
("Disk‚umber is‚ot‡ccepted\n");

120 
	}
}

122 
	$HªdËSTOPRAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

124 ià(
	`¡ºcmp
("®l", 
cÚ‹Á
, ("all")) == 0) {

125 
veùÜ
<
RAIDInfo
> 
li¡
;

126 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

127 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++) {

128 
¡©
 = 0, 
´og»ss
 = 0;

134 
¿id_mgr
.
	`StİRAID
(
li¡
[
i
].
m_¡rDevNodeName
);

137 
¿id_mgr
.
	`StİRAID
(
cÚ‹Á
);

139 
	}
}

141 
	$HªdËDELETERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

143 ià(
	`¡ºcmp
("®l", 
cÚ‹Á
, ("all")) == 0) {

144 
veùÜ
<
RAIDInfo
> 
li¡
;

145 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

146 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++)

147 
¿id_mgr
.
	`D–‘eRAID
(
li¡
[
i
].
m_¡rDevNodeName
);

149 
¿id_mgr
.
	`D–‘eRAID
(
cÚ‹Á
);

151 
	}
}

153 
	$HªdËFAULTYDISK
 (cÚ¡ * 
cÚ‹Á
)

155 
	}
}

157 
	$HªdËREMMDDISK
 (cÚ¡ * 
cÚ‹Á
)

159 
	}
}

161 
	$HªdËADDMDDISK
 (cÚ¡ * 
cÚ‹Á
)

163 
	}
}

165 
	$HªdËREADDMDDISK
 (cÚ¡ * 
cÚ‹Á
)

167 
	}
}

169 
	$HªdËREPLACEMDDISK
 (cÚ¡ * 
cÚ‹Á
)

171 
	}
}

173 
	$HªdËASSEMBLERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

175 
ty³
[5];

176 
šfo
[1024];

177 
	`ssÿnf
(
cÚ‹Á
, "%4[^,],%1023s", 
ty³
, 
šfo
);

179 
	`´štf
("ty³ = %s\n", 
ty³
);

180 ià(
	`¡ºcmp
("disk", 
ty³
, 
	`¡¾’
("disk")) == 0) {

181 
veùÜ
<
¡ršg
> 
vdisks
;

182 
¡ršg
 
¡rMDName
;

183 
	`tok’ize
(
šfo
, 
vdisks
);

184 
¿id_mgr
.
	`As£mbËRAID
(
vdisks
, 
¡rMDName
);

185 } ià(
	`¡ºcmp
("uuid", 
ty³
, 
	`¡¾’
("uuid")) == 0) {

188 
	}
}

190 
	$HªdËDONOTHING
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

192 
¿id_mgr
.
	`Upd©eRAIDInfo
();

194 
veùÜ
<
RAIDInfo
> 
li¡
;

195 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

196 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i++) {

197 
li¡
[
i
].
	`Dump
();

199 
¿id_mgr
.
	`Dump
();

200 
	}
}

202 
	$Te¡šgLoİ
(cÚ¡ * 
cfg
, 
RAIDMªag”
& 
¿id_mgr
)

204 
FILE
 *
pFe
 = 
	`fİ’
(
cfg
, "r");

205 
lše
[1024];

206 
cÚ‹Á
[1024];

207 
o
 = 
OP_DONOTHING
;

209 ià(
pFe
 =ğ
NULL
) {

210 
	`´štf
("Failo open file\n");

215 
	`fg‘s
(
lše
, 1023, 
pFe
è!ğ
NULL
 && 
g_bLoİ
) {

216 ià(
lše
[0] == '#')

218 
	`´štf
("\nRun: %s", 
lše
);

219 
	`ssÿnf
(
lše
, "%c:%1023[^:\n]", &
o
, 
cÚ‹Á
);

221 
o
) {

222 
	`OPERATION_CASE
(
ADDDISK
)

223 
	`OPERATION_CASE
(
REMDISK
)

224 
	`OPERATION_CASE
(
CREATERAID
)

225 
	`OPERATION_CASE
(
STOPRAID
)

226 
	`OPERATION_CASE
(
DELETERAID
)

232 
	`OPERATION_CASE
(
ASSEMBLERAID
)

233 
	`OPERATION_CASE
(
MANAGEMDDISK
)

234 
	`OPERATION_CASE
(
DONOTHING
)

239 
	`¦“p
(10);

243 
	`fşo£
(
pFe
);

244 
	}
}

	@
1
.
0
77
1889
../../../system/VolumeMgnService/NuDiskStat.h
../../../system/VolumeMgnService/NuHWMgn.cpp
../../../system/VolumeMgnService/NuHWMgn.h
../../../system/VolumeMgnService/NuLedsCtrl.cpp
../../../system/VolumeMgnService/NuLedsCtrl.h
../../../system/VolumeMgnService/NuRaidMgn.cpp
../../../system/VolumeMgnService/NuRaidMgn.h
../../../system/VolumeMgnService/NuTitanStatIPC.cpp
../../../system/VolumeMgnService/NuTitanStatIPC.h
../../../system/VolumeMgnService/_NuRaidMgn.cpp
../../../system/VolumeMgnService/ipc_command.h
../../../system/VolumeMgnService/main.cpp
../../../system/VolumeMgnService/nu_sata.h
../../../system/VolumeMgnService/nudaemon.c
../../../system/VolumeMgnService/nuhwmon.c
FilesystemManager.cpp
FilesystemManager.cpp
FilesystemManager.h
FilesystemManager.h
RAIDManager.cpp
RAIDManager.cpp
RAIDManager.h
RAIDManager.h
libmdadm/bitmap.h
libmdadm/bitmap.h
libmdadm/crc32.h
libmdadm/crc32.h
libmdadm/dlink.h
libmdadm/dlink.h
libmdadm/md_p.h
libmdadm/md_p.h
libmdadm/md_u.h
libmdadm/md_u.h
libmdadm/mdadm.h
libmdadm/mdadm.h
libmdadm/mdadm_errcode.h
libmdadm/mdadm_errcode.h
libmdadm/mdadm_other.h
libmdadm/mdadm_other.h
libmdadm/mdmon.h
libmdadm/mdmon.h
libmdadm/msg.h
libmdadm/msg.h
libmdadm/part.h
libmdadm/part.h
libmdadm/platform-intel.h
libmdadm/platform-intel.h
libmdadm/probe_roms.h
libmdadm/probe_roms.h
libmdadm/sha1.h
libmdadm/sha1.h
libmke2fs/ext2fs.h
libmke2fs/ext2fs.h
libmke2fs/ext2fsP.h
libmke2fs/ext2fsP.h
libmke2fs/mke2fs.h
libmke2fs/mke2fs.h
libmke2fs/mke2fs_err.h
libmke2fs/mke2fs_err.h
libmke2fs/prof_err.h
libmke2fs/prof_err.h
libmke2fs/profile.h
libmke2fs/profile.h
libmke2fs/util.h
libmke2fs/util.h
macro_def.h
macro_def.h
test_utils.cpp
test_utils.cpp
test_utils.h
test_utils.h
unitest/FilesystemManager_test.cpp
unitest/FilesystemManager_test.cpp
unitest/RAIDManager_test.cpp
unitest/RAIDManager_test.cpp
unitest/TestingLoop.cpp
unitest/TestingLoop.cpp
