cscope 15 /media/audy_huang/MyCode_inBuilder/v3.1/utility/sysutils/raid_manager -q 0000009888 0001474105
	@../../titanutils/EventAction/ActionModel.cpp

1 
	~"AùiÚMod–.h
"

3 
	gAùiÚBa£
::
	$AùiÚBa£
(
ušt32_t
 
aùiÚID
)

4 : 
	`m_AùiÚID
(
aùiÚID
)

5 , 
	$m_bAutom©ic
(
çl£
)

6 {
	}
}

8 
	gAùiÚBa£
::~
	$AùiÚBa£
()

9 {
	}
}

11 
ušt32_t
 
AùiÚBa£
::
	$G‘AùiÚID
() const

13  
m_AùiÚID
;

14 
	}
}

16 
	gAùiÚBa£
::
	$S‘Autom©ic
(
boŞ
 
bAutom©ic
)

18 
m_bAutom©ic
 = 
bAutom©ic
;

19 
	}
}

21 
boŞ
 
	gAùiÚBa£
::
	$G‘Autom©ic
() const

23  
m_bAutom©ic
;

24 
	}
}

	@../../titanutils/EventAction/ActionModel.h

1 #iâdeà
__ACTION_MODEL_H__


2 
	#__ACTION_MODEL_H__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~"AùiÚP¬am‘”.h
"

7 
	~"Ev’tP¬am‘”.h
"

9 
şass
 
	gS”v”Ev’tBa£
;

11 
	eS”v”DefšeAùiÚID


13 
	meS”v”DefšeAùiÚIDNÙifyCl›Á
 = 0xABCD,

14 
	meS”v”DefšeAùiÚIDNÙifyMªagem’tS”v”
,

15 
	meS”v”DefšeAùiÚIDNÙifyCommÚS”v”
,

19 şas 
	cAùiÚBa£


21 
	mpublic
:

22 
	eAùiÚDe¡š©iÚ


24 
eAùiÚDe¡š©iÚMªagem’tS”v”
,

25 
	meAùiÚDe¡š©iÚLoÿlS”v”
,

26 
	meAùiÚDe¡š©iÚRemÙeS”v”
,

27 
	meAùiÚDe¡š©iÚCl›Á
,

28 
	meAùiÚDe¡š©iÚU£r
,

31 
	gpublic
:

32 
AùiÚBa£
(
ušt32_t
 
aùiÚID
);

33 
	gvœtu®
 ~
AùiÚBa£
();

35 
vœtu®
 
Trigg”
(
S”v”Ev’tBa£
* 
ev’tBa£
, 
AùiÚP¬am‘”Ba£
* 
aùiÚP¬am‘”Ba£
,

36 cÚ¡ 
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
& 
·¿m
) = 0;

37 
vœtu®
 
AùiÚDe¡š©iÚ
 
G‘De¡š©iÚ
() = 0;

38 
ušt32_t
 
	$G‘AùiÚID
() const;

41 
	`S‘Autom©ic
(
boŞ
 
bAutom©ic
);

42 
boŞ
 
	$G‘Autom©ic
() const;

44 
´Ùeùed
:

45 
ušt32_t
 
m_AùiÚID
;

46 
boŞ
 
m_bAutom©ic
;

47 
	}
};

	@../../titanutils/EventAction/ActionParameter.cpp

1 
	~"AùiÚP¬am‘”.h
"

2 
	~"debugMsg/Debug.h
"

4 
	gAùiÚP¬am‘”Ba£
::
	$AùiÚP¬am‘”Ba£
(
ušt32_t
 
aùiÚP¬am‘”Ty³
)

5 : 
	$m_AùiÚP¬am‘”Ty³
(
aùiÚP¬am‘”Ty³
)

6 {
	}
}

7 
AùiÚP¬am‘”Ba£
::~
	$AùiÚP¬am‘”Ba£
()

8 {
	}
}

10 
boŞ
 
AùiÚP¬am‘”Ba£
::
İ”©Ü
==(cÚ¡ AùiÚP¬am‘”Ba£ &
rhs
) const

12 
TRACE
("ActionParameterBase::operator==\n");

13  (
	gm_AùiÚP¬am‘”Ty³
 =ğ
rhs
.
G‘AùiÚP¬am‘”Ty³
()

14 && 
doCom·»
(
rhs
));

16 
ušt32_t
 
	gAùiÚP¬am‘”Ba£
::
	$G‘AùiÚP¬am‘”Ty³
() const

18  
m_AùiÚP¬am‘”Ty³
;

19 
	}
}

22 
	gEmaAùiÚP¬am‘”
::
EmaAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
, cÚ¡ 
¡d
::
veùÜ
<ušt32_t>& 
emaIDLi¡
)

23 : 
AùiÚP¬am‘”Ba£
(
aùiÚP¬am‘”Ty³
)

24 , 
	$m_EmaIDLi¡
(
emaIDLi¡
)

25 {
	}
}

26 
	gEmaAùiÚP¬am‘”
::~
	$EmaAùiÚP¬am‘”
()

27 {
	}
}

28 
¡d
::
veùÜ
<
ušt32_t
> 
EmaAùiÚP¬am‘”
::
	$G‘EmaIDLi¡
() const

30  
m_EmaIDLi¡
;

31 
	}
}

33 
boŞ
 
	gEmaAùiÚP¬am‘”
::
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const

35 
boŞ
 
bR‘v®
 = 
çl£
;

36 cÚ¡ 
EmaAùiÚP¬am‘”
* 
pEmaAùiÚ
 = 
dyÇmic_ÿ¡
<cÚ¡ EmaAùiÚP¬am‘”*>(&
rhs
);

37 ià(
pEmaAùiÚ
)

39 ià(
m_EmaIDLi¡
.
	`size
(è=ğ
pEmaAùiÚ
->m_EmailIDList.size())

41 
ušt32_t
 
i
=0; i<
pEmaAùiÚ
->
m_EmaIDLi¡
.
	`size
(); i++)

43 ià(
m_EmaIDLi¡
[
i
] !ğ
pEmaAùiÚ
->m_EmailIDList[i])

48  
Œue
;

51  
bR‘v®
;

52 
	}
}

55 
	gOnSü“nDi¥ÏyAùiÚP¬am‘”
::
	$OnSü“nDi¥ÏyAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
, cÚ¡ 
¡d
::
¡ršg
& 
¡rMsg
)

56 : 
	`AùiÚP¬am‘”Ba£
(
aùiÚP¬am‘”Ty³
)

57 , 
	$m_Di¥ÏyMsg
(
¡rMsg
)

58 {
	}
}

59 
	gOnSü“nDi¥ÏyAùiÚP¬am‘”
::~
	$OnSü“nDi¥ÏyAùiÚP¬am‘”
()

60 {
	}
}

61 
¡d
::
¡ršg
 
OnSü“nDi¥ÏyAùiÚP¬am‘”
::
	$G‘Di¥ÏyMsg
() const

63  
m_Di¥ÏyMsg
;

64 
	}
}

66 
boŞ
 
	gOnSü“nDi¥ÏyAùiÚP¬am‘”
::
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const

68 
boŞ
 
bR‘v®
 = 
çl£
;

69 cÚ¡ 
OnSü“nDi¥ÏyAùiÚP¬am‘”
* 
pSü“nAùiÚ
 = 
dyÇmic_ÿ¡
<cÚ¡ OnSü“nDi¥ÏyAùiÚP¬am‘”*>(&
rhs
);

70 ià(
pSü“nAùiÚ
)

72 
bR‘v®
 = (
m_Di¥ÏyMsg
 =ğ
pSü“nAùiÚ
->
	`G‘Di¥ÏyMsg
());

74  
bR‘v®
;

75 
	}
}

78 
	gDig™®OuutAùiÚP¬am‘”
::
Dig™®OuutAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
,

79 cÚ¡ 
¡d
::
veùÜ
<
P”h”yP¬am
>& 
³rh”yLi¡
)

80 : 
AùiÚP¬am‘”Ba£
(
aùiÚP¬am‘”Ty³
)

81 , 
	$m_P”h”yLi¡
(
³rh”yLi¡
)

82 {
	}
}

83 
	gDig™®OuutAùiÚP¬am‘”
::~
	$Dig™®OuutAùiÚP¬am‘”
()

84 {
	}
}

85 
¡d
::
veùÜ
<
Dig™®OuutAùiÚP¬am‘”
::
P”h”yP¬am
> Dig™®OuutAùiÚP¬am‘”::
	$G‘P”h”yP¬am
() const

87  
m_P”h”yLi¡
;

88 
	}
}

90 
boŞ
 
	gDig™®OuutAùiÚP¬am‘”
::
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const

92 
	`TRACE
("DigitalOutputActionParameter::doCompare\n");

93 
boŞ
 
bR‘v®
 = 
çl£
;

94 cÚ¡ 
Dig™®OuutAùiÚP¬am‘”
* 
pDOAùiÚ
 = 
dyÇmic_ÿ¡
<cÚ¡ Dig™®OuutAùiÚP¬am‘”*>(&
rhs
);

95 ià(
pDOAùiÚ
)

97 ià(
m_P”h”yLi¡
.
	`size
(è=ğ
pDOAùiÚ
->m_PeripheryList.size())

99 
ušt32_t
 
i
=0; i<
pDOAùiÚ
->
m_P”h”yLi¡
.
	`size
(); i++)

101 ià(
m_P”h”yLi¡
[
i
].
£rv”ID
 !ğ
pDOAùiÚ
->m_PeripheryList[i].serverID ||

102 
m_P”h”yLi¡
[
i
].
deviûID
 !ğ
pDOAùiÚ
->m_PeripheryList[i].deviceID )

104  
çl£
;

107 
bR‘v®
 = 
Œue
;

110  
bR‘v®
;

111 
	}
}

114 
	gP»£tToGoAùiÚP¬am‘”
::
P»£tToGoAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
,

115 cÚ¡ 
¡d
::
veùÜ
<
P»£tToGoP¬am
>& 
´e£tToGoLi¡
)

116 : 
AùiÚP¬am‘”Ba£
(
aùiÚP¬am‘”Ty³
)

117 , 
	$m_P»£tToGoLi¡
(
´e£tToGoLi¡
)

118 {
	}
}

120 
	gP»£tToGoAùiÚP¬am‘”
::~
	$P»£tToGoAùiÚP¬am‘”
()

121 {
	}
}

123 
¡d
::
veùÜ
<
P»£tToGoAùiÚP¬am‘”
::
P»£tToGoP¬am
> P»£tToGoAùiÚP¬am‘”::
	$G‘P»£tToGoP¬am
() const

125  
m_P»£tToGoLi¡
;

126 
	}
}

128 
boŞ
 
	gP»£tToGoAùiÚP¬am‘”
::
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const

130 
boŞ
 
bR‘v®
 = 
çl£
;

131 cÚ¡ 
P»£tToGoAùiÚP¬am‘”
* 
pP»£tAùiÚ
 = 
dyÇmic_ÿ¡
<cÚ¡ P»£tToGoAùiÚP¬am‘”*>(&
rhs
);

132 ià(
pP»£tAùiÚ
)

134 ià(
m_P»£tToGoLi¡
.
	`size
(è=ğ
pP»£tAùiÚ
->m_PresetToGoList.size())

136 
ušt32_t
 
i
=0; i<
pP»£tAùiÚ
->
m_P»£tToGoLi¡
.
	`size
(); i++)

138 ià(
m_P»£tToGoLi¡
[
i
] =ğ
pP»£tAùiÚ
->m_PresetToGoList[i])

144  
çl£
;

147  
Œue
;

150  
bR‘v®
;

151 
	}
}

154 
	gP©rŞToS¹AùiÚP¬am‘”
::
P©rŞToS¹AùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
,

155 cÚ¡ 
¡d
::
veùÜ
<
P©rŞToS¹P¬am
>& 
·ŒŞToS¹Li¡
)

156 : 
AùiÚP¬am‘”Ba£
(
aùiÚP¬am‘”Ty³
)

157 , 
	$m_P©rŞToS¹Li¡
(
·ŒŞToS¹Li¡
)

158 {
	}
}

160 
	gP©rŞToS¹AùiÚP¬am‘”
::~
	$P©rŞToS¹AùiÚP¬am‘”
()

161 {
	}
}

163 
¡d
::
veùÜ
<
P©rŞToS¹AùiÚP¬am‘”
::
P©rŞToS¹P¬am
> P©rŞToS¹AùiÚP¬am‘”::
	$G‘P©rŞToS¹P¬am
() const

165  
m_P©rŞToS¹Li¡
;

166 
	}
}

168 
boŞ
 
	gP©rŞToS¹AùiÚP¬am‘”
::
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const

170 
boŞ
 
bR‘v®
 = 
çl£
;

171 cÚ¡ 
P©rŞToS¹AùiÚP¬am‘”
* 
pP©rŞAùiÚ
 = 
dyÇmic_ÿ¡
<cÚ¡ P©rŞToS¹AùiÚP¬am‘”*>(&
rhs
);

172 ià(
pP©rŞAùiÚ
)

174 ià(
m_P©rŞToS¹Li¡
.
	`size
(è=ğ
pP©rŞAùiÚ
->m_PatrolToStartList.size())

176 
ušt32_t
 
i
=0; i<
pP©rŞAùiÚ
->
m_P©rŞToS¹Li¡
.
	`size
(); i++)

178 ià(
m_P©rŞToS¹Li¡
[
i
] =ğ
pP©rŞAùiÚ
->m_PatrolToStartList[i])

184  
çl£
;

187  
Œue
;

190  
bR‘v®
;

191 
	}
}

194 
	gPÏyAË¹SoundAùiÚP¬am‘”
::
	$PÏyAË¹SoundAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
)

195 : 
	$AùiÚP¬am‘”Ba£
(
aùiÚP¬am‘”Ty³
)

196 {
	}
}

197 
PÏyAË¹SoundAùiÚP¬am‘”
::~
	$PÏyAË¹SoundAùiÚP¬am‘”
()

198 {
	}
}

200 
boŞ
 
PÏyAË¹SoundAùiÚP¬am‘”
::
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const

202  
Œue
;

203 
	}
}

205 
	gVideoPİupAùiÚP¬am‘”
::
	$VideoPİupAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
)

206 : 
	$AùiÚP¬am‘”Ba£
(
aùiÚP¬am‘”Ty³
)

207 {
	}
}

208 
VideoPİupAùiÚP¬am‘”
::~
	$VideoPİupAùiÚP¬am‘”
()

209 {
	}
}

211 
boŞ
 
VideoPİupAùiÚP¬am‘”
::
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const

213  
Œue
;

214 
	}
}

217 
	gS¹P©rŞAùiÚP¬am‘”
::
S¹P©rŞAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
,

218 cÚ¡ 
¡d
::
veùÜ
<
S¹P©rŞP¬am
>& 
¡¬tP©rŞLi¡
)

219 : 
AùiÚP¬am‘”Ba£
(
aùiÚP¬am‘”Ty³
)

220 , 
	$m_S¹P©rŞLi¡
(
¡¬tP©rŞLi¡
)

221 {
	}
}

223 
	gS¹P©rŞAùiÚP¬am‘”
::~
	$S¹P©rŞAùiÚP¬am‘”
()

224 {
	}
}

226 
¡d
::
veùÜ
<
S¹P©rŞAùiÚP¬am‘”
::
S¹P©rŞP¬am
> S¹P©rŞAùiÚP¬am‘”::
	$G‘S¹P©rŞP¬am
() const

228  
m_S¹P©rŞLi¡
;

229 
	}
}

231 
boŞ
 
	gS¹P©rŞAùiÚP¬am‘”
::
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const

233 
boŞ
 
bR‘v®
 = 
çl£
;

234 cÚ¡ 
S¹P©rŞAùiÚP¬am‘”
* 
pS¹P©rŞAùiÚ
 = 
dyÇmic_ÿ¡
<cÚ¡ S¹P©rŞAùiÚP¬am‘”*>(&
rhs
);

235 ià(
pS¹P©rŞAùiÚ
)

237 ià(
this
->
m_S¹P©rŞLi¡
.
	`size
(è=ğ
pS¹P©rŞAùiÚ
->m_StartPatrolList.size())

239 
ušt32_t
 
i
 = 0; i < 
pS¹P©rŞAùiÚ
->
m_S¹P©rŞLi¡
.
	`size
(); i++)

241 ià(
m_S¹P©rŞLi¡
[
i
] =ğ
pS¹P©rŞAùiÚ
->m_StartPatrolList[i])

247  
çl£
;

250  
Œue
;

253  
bR‘v®
;

254 
	}
}

	@../../titanutils/EventAction/ActionParameter.h

1 #iâdeà
__ACTION_PARAMETER_H__


2 
	#__ACTION_PARAMETER_H__


	)

4 
	~"Ev’tP¬am‘”.h
"

6 şas 
	cAùiÚP¬am‘”Ba£


8 
	mpublic
:

9 
AùiÚP¬am‘”Ba£
(
ušt32_t
 
aùiÚP¬am‘”Ty³
);

10 
	mvœtu®
 ~
AùiÚP¬am‘”Ba£
();

11 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
AùiÚP¬am‘”Ba£
&) const;

13 
ušt32_t
 
	$G‘AùiÚP¬am‘”Ty³
() const;

15 
´iv©e
:

16 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const = 0;

18 
ušt32_t
 
m_AùiÚP¬am‘”Ty³
;

21 şas 
	cEmaAùiÚP¬am‘”
: 
public
 
AùiÚP¬am‘”Ba£


23 
public
:

24 
	`EmaAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
, cÚ¡ 
¡d
::
veùÜ
<ušt32_t>& 
emaIDLi¡
);

25 
vœtu®
 ~
	`EmaAùiÚP¬am‘”
();

27 
¡d
::
veùÜ
<
ušt32_t
> 
	$G‘EmaIDLi¡
() const;

29 
´iv©e
:

30 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const;

32 
¡d
::
veùÜ
<
ušt32_t
> 
m_EmaIDLi¡
;

35 şas 
	cOnSü“nDi¥ÏyAùiÚP¬am‘”
: 
public
 
AùiÚP¬am‘”Ba£


37 
public
:

38 
	`OnSü“nDi¥ÏyAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
, cÚ¡ 
¡d
::
¡ršg
& 
¡rMsg
);

39 
vœtu®
 ~
	`OnSü“nDi¥ÏyAùiÚP¬am‘”
();

41 
¡d
::
¡ršg
 
	$G‘Di¥ÏyMsg
() const;

43 
´iv©e
:

44 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const;

46 
¡d
::
¡ršg
 
m_Di¥ÏyMsg
;

49 şas 
	cDig™®OuutAùiÚP¬am‘”
: 
public
 
AùiÚP¬am‘”Ba£


51 
public
:

52 
	sP”h”yP¬am


54 
ušt64_t
 
£rv”ID
;

55 
ušt64_t
 
deviûID
;

58 
public
:

59 
	`Dig™®OuutAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
, cÚ¡ 
¡d
::
veùÜ
<
P”h”yP¬am
>& 
³rh”yLi¡
);

60 
vœtu®
 ~
	`Dig™®OuutAùiÚP¬am‘”
();

61 
¡d
::
veùÜ
<
P”h”yP¬am
> 
	$G‘P”h”yP¬am
() const;

62 
¡d
::
veùÜ
<
P”h”yP¬am
> 
m_P”h”yLi¡
;

64 
´iv©e
:

65 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const;

67 
	}
};

69 şas 
	cP©rŞToS¹AùiÚP¬am‘”
: 
public
 
AùiÚP¬am‘”Ba£


71 
public
:

72 
	sP©rŞToS¹P¬am


74 
ušt64_t
 
£rv”ID
;

75 
ušt64_t
 
	mdeviûID
;

76 
ušt64_t
 
	massocŸ‹dCamS”v”ID
;

77 
ušt64_t
 
	massocŸ‹dCamDeviûID
;

78 
ušt32_t
 
	m¡¬tP©rŞId
;

79 
ušt32_t
 
	m·ŒŞTimes
;

80 
ušt32_t
 
	m’dP»£tId
;

81 
ušt32_t
 
	me¡im©edEÏp£dTimefÜP»£t
;

82 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
P©rŞToS¹P¬am
 &
rhs
) const

84  (
£rv”ID
 =ğ
rhs
.serverID &&

85 
deviûID
 =ğ
rhs
.deviceID &&

86 
assocŸ‹dCamS”v”ID
 =ğ
rhs
.associatedCamServerID &&

87 
assocŸ‹dCamDeviûID
 =ğ
rhs
.associatedCamDeviceID &&

88 
¡¬tP©rŞId
 =ğ
rhs
.startPatrolId &&

89 
·ŒŞTimes
 =ğ
rhs
.patrolTimes &&

90 
’dP»£tId
 =ğ
rhs
.endPresetId &&

91 
e¡im©edEÏp£dTimefÜP»£t
 =ğ
rhs
.estimatedElapsedTimeforPreset);

95 
	gpublic
:

96 
P©rŞToS¹AùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
, cÚ¡ 
¡d
::
veùÜ
<
P©rŞToS¹P¬am
>& 
·ŒŞToS¹Li¡
);

97 
	gvœtu®
 ~
P©rŞToS¹AùiÚP¬am‘”
();

99 
	g¡d
::
veùÜ
<
P©rŞToS¹P¬am
> 
	$G‘P©rŞToS¹P¬am
() const;

100 
¡d
::
veùÜ
<
P©rŞToS¹P¬am
> 
m_P©rŞToS¹Li¡
;

102 
´iv©e
:

103 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const;

105 
	}
};

107 şas 
	cP»£tToGoAùiÚP¬am‘”
: 
public
 
AùiÚP¬am‘”Ba£


109 
public
:

110 
	sP»£tToGoP¬am


112 
ušt64_t
 
£rv”ID
;

113 
ušt64_t
 
	mdeviûID
;

114 
ušt64_t
 
	massocŸ‹dCamS”v”ID
;

115 
ušt64_t
 
	massocŸ‹dCamDeviûID
;

116 
ušt32_t
 
	mgu¬dTy³P»£tID
;

118 
ušt32_t
 
	mnÜm®Ty³P»£tID
;

119 
ušt32_t
 
	mdi§bËMÙiÚD‘eùDu¿tiÚ
;

120 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
P»£tToGoP¬am
 &
rhs
) const

122  (
£rv”ID
 =ğ
rhs
.serverID &&

123 
deviûID
 =ğ
rhs
.deviceID &&

124 
assocŸ‹dCamS”v”ID
 =ğ
rhs
.associatedCamServerID &&

125 
assocŸ‹dCamDeviûID
 =ğ
rhs
.associatedCamDeviceID &&

126 
gu¬dTy³P»£tID
 =ğ
rhs
.guardTypePresetID &&

127 
nÜm®Ty³P»£tID
 =ğ
rhs
.normalTypePresetID &&

128 
di§bËMÙiÚD‘eùDu¿tiÚ
 =ğ
rhs
.disableMotionDetectDuration);

132 
	gpublic
:

133 
P»£tToGoAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
, cÚ¡ 
¡d
::
veùÜ
<
P»£tToGoP¬am
>& 
´e£tToGoLi¡
);

134 
	gvœtu®
 ~
P»£tToGoAùiÚP¬am‘”
();

136 
	g¡d
::
veùÜ
<
P»£tToGoP¬am
> 
	$G‘P»£tToGoP¬am
() const;

137 
¡d
::
veùÜ
<
P»£tToGoP¬am
> 
m_P»£tToGoLi¡
;

139 
´iv©e
:

140 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const;

142 
	}
};

144 şas 
	cPÏyAË¹SoundAùiÚP¬am‘”
: 
public
 
AùiÚP¬am‘”Ba£


146 
public
:

147 
PÏyAË¹SoundAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
);

148 
	mvœtu®
 ~
PÏyAË¹SoundAùiÚP¬am‘”
();

150 
	m´iv©e
:

151 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const;

154 şas 
	cVideoPİupAùiÚP¬am‘”
: 
public
 
AùiÚP¬am‘”Ba£


156 
public
:

157 
	`VideoPİupAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
);

158 
vœtu®
 ~
	`VideoPİupAùiÚP¬am‘”
();

160 
´iv©e
:

161 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const;

164 şas 
	cS¹P©rŞAùiÚP¬am‘”
: 
public
 
AùiÚP¬am‘”Ba£


166 
public
:

167 
	sS¹P©rŞP¬am


169 
ušt64_t
 
£rv”ID
;

170 
ušt64_t
 
deviûID
;

171 
ušt64_t
 
assocŸ‹dCamS”v”ID
;

172 
ušt64_t
 
assocŸ‹dCamDeviûID
;

173 
ušt32_t
 
¡¬tP©rŞID
;

174 
ušt32_t
 
·ŒŞTimes
;

175 
ušt32_t
 
’dP»£tID
;

176 
ušt32_t
 
e¡im©edEÏp£dTimeFÜP»£t
;

178 
boŞ
 
İ”©Ü
==(cÚ¡ 
S¹P©rŞP¬am
 &
rhs
) const

180  (
£rv”ID
 =ğ
rhs
.serverID &&

181 
deviûID
 =ğ
rhs
.deviceID &&

182 
assocŸ‹dCamS”v”ID
 =ğ
rhs
.associatedCamServerID &&

183 
assocŸ‹dCamDeviûID
 =ğ
rhs
.associatedCamDeviceID &&

184 
¡¬tP©rŞID
 =ğ
rhs
.startPatrolID &&

185 
·ŒŞTimes
 =ğ
rhs
.patrolTimes &&

186 
’dP»£tID
 =ğ
rhs
.endPresetID &&

187 
e¡im©edEÏp£dTimeFÜP»£t
 =ğ
rhs
.estimatedElapsedTimeForPreset);

191 
public
:

192 
	`S¹P©rŞAùiÚP¬am‘”
(
ušt32_t
 
aùiÚP¬am‘”Ty³
, cÚ¡ 
¡d
::
veùÜ
<
S¹P©rŞP¬am
>& 
¡¬tP©rŞLi¡
);

193 
vœtu®
 ~
	`S¹P©rŞAùiÚP¬am‘”
();

195 
¡d
::
veùÜ
<
S¹P©rŞP¬am
> 
	$G‘S¹P©rŞP¬am
() const;

196 
¡d
::
veùÜ
<
S¹P©rŞP¬am
> 
m_S¹P©rŞLi¡
;

198 
´iv©e
:

199 
vœtu®
 
boŞ
 
	$doCom·»
(cÚ¡ 
AùiÚP¬am‘”Ba£
& 
rhs
) const;

200 
	}
};

	@../../titanutils/EventAction/EventActionManager.cpp

1 
	~"Ev’tAùiÚMªag”.h
"

2 
	~"Ev’tMod–.h
"

4 
	~"commÚ/sy¡em.h
"

5 
	~"commÚ/ut™y.h
"

6 
	~"commÚ/time.h
"

8 
	~"debugMsg/Debug.h
"

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 
	#EVENT_QUEUE_SIZE
 3000

	)

14 
	gEv’tAùiÚMªag”
::
	$Ev’tAùiÚMªag”
()

15 : 
	`m_Ev’tAùiÚM­pšgLi¡
()

16 , 
	`m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
()

17 , 
	`m_£mEv’t
()

18 , 
	$m_Ev’tQueue
()

20 
	`C»©eTh»ad
();

21 
	}
}

23 
	gEv’tAùiÚMªag”
::~
	$Ev’tAùiÚMªag”
()

25 ià(
	`Th»adExi¡s
())

27 
	`C®lWÜk”
(
Ev’tAùiÚMªag”
::
eTC_STOP
, 
NULL
);

28 
	`Clo£Th»ad
();

31 
ušt32_t
 
i
 = 0; i < 
m_Ev’tAùiÚM­pšgLi¡
.
	`size
(); i++)

33 ià(
m_Ev’tAùiÚM­pšgLi¡
[
i
] !ğ
NULL
)

35 
d–‘e
 
m_Ev’tAùiÚM­pšgLi¡
[
i
];

36 
m_Ev’tAùiÚM­pšgLi¡
[
i
] = 
NULL
;

40 
ušt32_t
 
i
 = 0; i < 
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
.
	`size
(); i++)

42 ià(
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
[
i
] !ğ
NULL
)

44 
d–‘e
 
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
[
i
];

45 
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
[
i
] = 
NULL
;

49 !
m_Ev’tQueue
.
	`em±y
())

51 
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
* 
äÚt
 = 
m_Ev’tQueue
.
	`äÚt
();

52 
m_Ev’tQueue
.
	`pİ_äÚt
();

53 ià(
äÚt
 !ğ
NULL
)

55 
d–‘e
 
äÚt
;

58 
	}
}

60 
boŞ
 
	gEv’tAùiÚMªag”
::
	$C»©eEv’tAùiÚM­pšg
()

62  
Œue
;

63 
	}
}

65 
	gEv’tAùiÚMªag”
::
	$D–‘eEv’tAùiÚM­pšg
()

67 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_EAM­pšgLi¡CS
);

69 
¡d
::
veùÜ
<
S”v”Ev’tBa£
*>::
™”©Ü
 
™
 = 
m_Ev’tAùiÚM­pšgLi¡
.
	`begš
();

70 
™
 !ğ
m_Ev’tAùiÚM­pšgLi¡
.
	`’d
(); it++)

72 
	`d–‘e
 (*
™
);

75 
m_Ev’tAùiÚM­pšgLi¡
.
	`ş—r
();

76 
	}
}

78 
	gEv’tAùiÚMªag”
::
	$D–‘eCl›ÁDefšeEv’tAùiÚM­pšg
()

80 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_Cl›ÁDefšeEAM­pšgLi¡CS
);

82 
¡d
::
veùÜ
<
S”v”Ev’tBa£
*>::
™”©Ü
 
™
 = 
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
.
	`begš
();

83 
™
 !ğ
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
.
	`’d
(); it++)

85 
	`d–‘e
 (*
™
);

88 
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
.
	`ş—r
();

89 
	}
}

91 
	gEv’tAùiÚMªag”
::
	$PushEv’t
(
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
* 
ev’tNÙifyP¬am
)

93 
	`IF_NULL_RETURN
(
ev’tNÙifyP¬am
);

95 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_Ev’tQueueCS
);

97 ià(
m_Ev’tQueue
.
	`size
(è>ğ
EVENT_QUEUE_SIZE
)

99 
	`ASSERT
(
çl£
);

100 
	`TRACE
("EventActionManager::PushEvent out of queue size\n");

101 
d–‘e
 
ev’tNÙifyP¬am
;

106 
m_Ev’tQueue
.
	`push_back
(
ev’tNÙifyP¬am
);

108 
m_£mEv’t
.
	`Po¡
();

110 
	}
}

112 
	gEv’tAùiÚMªag”
::
	$CheckQueue
()

117 ià(!
m_£mEv’t
.
	`Wa™
(5000))

125 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_Ev’tQueueCS
);

126 ià(
m_Ev’tQueue
.
	`em±y
())

132 
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
* 
äÚt
 = 
NULL
;

134 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_Ev’tQueueCS
);

135 
äÚt
 = 
m_Ev’tQueue
.
	`äÚt
();

136 
m_Ev’tQueue
.
	`pİ_äÚt
();

139 
	`IF_NULL_RETURN
(
äÚt
);

142 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_EAM­pšgLi¡CS
);

144 
¡d
::
veùÜ
<
S”v”Ev’tBa£
*>::
™”©Ü
 
™
 = 
m_Ev’tAùiÚM­pšgLi¡
.
	`begš
();

145 
™
 !ğ
m_Ev’tAùiÚM­pšgLi¡
.
	`’d
(); it++)

147 ià(
äÚt
->
ev’tID
 =ğ(*
™
)->
	`G‘Ev’tID
())

149 (*
™
)->
	`NÙify
(*
äÚt
);

156 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_Cl›ÁDefšeEAM­pšgLi¡CS
);

158 
¡d
::
veùÜ
<
S”v”Ev’tBa£
*>::
™”©Ü
 
™
 = 
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
.
	`begš
();

159 
™
 !ğ
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
.
	`’d
(); it++)

161 ià(
äÚt
->
ev’tID
 =ğ(*
™
)->
	`G‘Ev’tID
())

163 (*
™
)->
	`NÙify
(*
äÚt
);

171 ià((*
äÚt
).
ÃedToLog
)

174 
	`C»©eLog
(*
äÚt
);

177 
d–‘e
 
äÚt
;

179 
	}
}

181 
	gEv’tAùiÚMªag”
::
	$Th»adProc
()

188 
ušt32_t
 
uMes§ge
 = (ušt32_t)
eTC_STOP
;

189 ià(
	`CheckReque¡
(&
uMes§ge
))

191 (
Th»adCommªd
)
uMes§ge
)

193 
eTC_STOP
:

194 
	`R•ly
(0);

197 
	`R•ly
((
ušt32_t
)-1);

202 
	`CheckQueue
();

204 
	}
}

	@../../titanutils/EventAction/EventActionManager.h

1 #iâdeà
__EVENT_ACTION_MANAGER_H__


2 
	#__EVENT_ACTION_MANAGER_H__


	)

4 
	~"commÚ/£m­hÜe.h
"

5 
	~"­r/­r_th»ad_wÜk”.h
"

7 
	~"Ev’tP¬am‘”.h
"

9 
	~<li¡
>

11 
şass
 
	gS”v”Ev’tBa£
;

13 şas 
	cEv’tAùiÚMªag”
: 
public
 
SYSUTILS_SPACE
::
A´Th»adWÜk”


15 
´iv©e
:

16 
	eTh»adCommªd


18 
eTC_STOP


21 
	gpublic
:

22 
Ev’tAùiÚMªag”
();

23 
	gvœtu®
 ~
Ev’tAùiÚMªag”
();

26 
boŞ
 
C»©eEv’tAùiÚM­pšg
();

27 
D–‘eEv’tAùiÚM­pšg
();

30 
vœtu®
 
boŞ
 
C»©eCl›ÁDefšeEv’tAùiÚM­pšg
() = 0;

31 
D–‘eCl›ÁDefšeEv’tAùiÚM­pšg
();

33 
PushEv’t
(
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
* 
ev’tNÙifyP¬am
);

35 
vœtu®
 
C»©eLog
(cÚ¡ 
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
& 
·¿m
) = 0;

37 
	g´iv©e
:

38 
vœtu®
 
Th»adProc
();

40 
CheckQueue
();

42 
	g´Ùeùed
:

43 
¡d
::
veùÜ
<
S”v”Ev’tBa£
*> 
m_Ev’tAùiÚM­pšgLi¡
;

44 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_EAM­pšgLi¡CS
;

45 
	g¡d
::
veùÜ
<
S”v”Ev’tBa£
*> 
m_Cl›ÁDefšeEv’tAùiÚM­pšgLi¡
;

46 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_Cl›ÁDefšeEAM­pšgLi¡CS
;

48 
	g´iv©e
:

49 
SYSUTILS_SPACE
::
Sem­hÜe
 
m_£mEv’t
;

51 
	g¡d
::
li¡
<
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
*> 
m_Ev’tQueue
;

52 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_Ev’tQueueCS
;

	@../../titanutils/EventAction/EventModel.cpp

1 
	~"Ev’tMod–.h
"

3 
	~"commÚ/time.h
"

5 
	~"debugMsg/Debug.h
"

6 
	~"cÚ¡/S”v”PrÙocŞDefš™iÚ.h
"

8 
	~"£rv”CÚfig/MSCÚfigFe.h
"

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 
	gS”v”Ev’tBa£
::
Ob£rv”P¬am
::
	$Ob£rv”P¬am
()

13 : 
	`pAùiÚBa£
(
NULL
)

14 , 
	$pAùiÚP¬amBa£
(
NULL
)

15 {
	}
}

16 
	gS”v”Ev’tBa£
::
Ob£rv”P¬am
::~
	$Ob£rv”P¬am
()

17 {
	}
}

19 
S”v”Ev’tBa£
::
	$S”v”Ev’tBa£
(
ScheduË
::
ScheduËProfeMªag”
* 
scheduËProfeMªag”
, 
ušt32_t
 
ev’tID
,

20 
boŞ
 
scheduËS‘abË
, 
ušt8_t
 
aùiÚClo£Ty³
, 
ušt32_t
 
aùiÚClo£Time
)

21 : 
	`m_Ev’tID
(
ev’tID
)

22 , 
	`m_ScheduËS‘abË
(
scheduËS‘abË
)

23 , 
	`m_AùiÚClo£Ty³
(
aùiÚClo£Ty³
)

24 , 
	`m_AùiÚClo£Time
(
aùiÚClo£Time
)

25 , 
	`m_ScheduËS‘tšgLi¡
()

26 , 
	`m_Ob£rv”s
()

27 , 
	`m_ScheduËProfeMªag”
(
scheduËProfeMªag”
)

28 , 
	$m_Ev’tProfe
(
NULL
)

30 
	}
}

32 
	gS”v”Ev’tBa£
::~
	$S”v”Ev’tBa£
()

34 
	`CË¬
();

36 ià(
m_ScheduËProfeMªag”
 !ğ
NULL
)

38 
m_ScheduËProfeMªag”
->
	`R–—£Profe
(
m_Ev’tProfe
);

40 
	}
}

42 
	gS”v”Ev’tBa£
::
	$CË¬
()

44 
¡d
::
veùÜ
<
Ob£rv”P¬am
>::
™”©Ü
 
™
 = 
m_Ob£rv”s
.
	`begš
(); iˆ!ğm_Ob£rv”s.
	`’d
(); it++)

46 ià(
™
->
pAùiÚBa£
 !ğ
NULL
)

48 
d–‘e
 
™
->
pAùiÚBa£
;

51 ià(
™
->
pAùiÚP¬amBa£
 !ğ
NULL
)

53 
d–‘e
 
™
->
pAùiÚP¬amBa£
;

57 
m_Ob£rv”s
.
	`ş—r
();

58 
	}
}

60 
	gS”v”Ev’tBa£
::
	$A‰ach
(
Ob£rv”P¬am
& 
ob£rv”P¬am
)

62 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

63 
m_Ob£rv”s
.
	`push_back
(
ob£rv”P¬am
);

64 
	}
}

66 
	gS”v”Ev’tBa£
::
	$ModifyOb£rv”P¬am
(
ušt32_t
 
aùiÚID
, 
AùiÚP¬am‘”Ba£
* 
aùiÚP¬amBa£
)

68 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

70 
¡d
::
veùÜ
<
Ob£rv”P¬am
>::
™”©Ü
 
™
 = 
m_Ob£rv”s
.
	`begš
(); iˆ!ğm_Ob£rv”s.
	`’d
(); it++)

72 ià((*
™
).
pAùiÚBa£
 =ğ
NULL
)

77 ià((*
™
).
pAùiÚBa£
->
	`G‘AùiÚID
(è=ğ
aùiÚID
)

79 ià((*
™
).
pAùiÚP¬amBa£
 !ğ
NULL
)

81 
	`d–‘e
 (*
™
).
pAùiÚP¬amBa£
;

84 (*
™
).
pAùiÚP¬amBa£
 = 
aùiÚP¬amBa£
;

87 
	}
}

89 
boŞ
 
	gS”v”Ev’tBa£
::
	$CheckAùiÚInOb£rv”P¬am
(
ušt32_t
 
aùiÚID
)

91 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

93 
¡d
::
veùÜ
<
Ob£rv”P¬am
>::
™”©Ü
 
™
 = 
m_Ob£rv”s
.
	`begš
(); iˆ!ğm_Ob£rv”s.
	`’d
(); it++)

95 ià((*
™
).
pAùiÚBa£
 =ğ
NULL
)

100 ià((*
™
).
pAùiÚBa£
->
	`G‘AùiÚID
(è=ğ
aùiÚID
)

102  
Œue
;

106  
çl£
;

107 
	}
}

109 
boŞ
 
	gS”v”Ev’tBa£
::
	$D‘achS³cificOb£rv”P¬am
(
ušt32_t
 
aùiÚID
)

111 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

113 
¡d
::
veùÜ
<
Ob£rv”P¬am
>::
™”©Ü
 
™
 = 
m_Ob£rv”s
.
	`begš
(); iˆ!ğm_Ob£rv”s.
	`’d
();)

115 ià((*
™
).
pAùiÚBa£
 !ğ
NULL
 &&

116 (*
™
).
pAùiÚBa£
->
	`G‘AùiÚID
(è=ğ
aùiÚID
)

118 ià(
™
->
pAùiÚBa£
 !ğ
NULL
)

120 
d–‘e
 
™
->
pAùiÚBa£
;

123 ià(
™
->
pAùiÚP¬amBa£
 !ğ
NULL
)

125 
d–‘e
 
™
->
pAùiÚP¬amBa£
;

128 
™
 = 
m_Ob£rv”s
.
	`”a£
(it);

132 
™
++;

136  
Œue
;

137 
	}
}

139 
	gS”v”Ev’tBa£
::
	$D‘achAÎ
()

141 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

142 
	`CË¬
();

143 
	}
}

145 
	gS”v”Ev’tBa£
::
	$NÙify
(
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
& 
·¿m
)

148 
SYSTEMTIME
 
¡
 = 
	`UTCTimeToLoÿlTime
(
UTCTime
::
	`G‘Cu¼’tSy¡emTime
());

149 
UTCTime
 
	`loÿlTime
(
¡
);

151 
ušt8_t
 
³rmissiÚ
 = 0;

152 ià(
m_Ev’tProfe
 !ğ
NULL
 && m_Ev’tProfe->
	`IsInRªge
(
loÿlTime
))

154 
³rmissiÚ
 = 1;

158 
·¿m
.
šScheduË
 = 
çl£
;

159 ià(!
m_ScheduËS‘abË
)

161 
·¿m
.
šScheduË
 = 
çl£
;

162 
³rmissiÚ
 = 1;

166 ià(
m_ScheduËS‘tšgLi¡
.
	`em±y
())

168 
·¿m
.
šScheduË
 = 
çl£
;

172 ià(
³rmissiÚ
 == 1)

174 
·¿m
.
šScheduË
 = 
Œue
;

179 
¡d
::
veùÜ
<
Ob£rv”P¬am
>::
™”©Ü
 
™
 = 
m_Ob£rv”s
.
	`begš
(); iˆ!ğm_Ob£rv”s.
	`’d
(); it++)

181 ià(
™
->
pAùiÚBa£
 =ğ
NULL
)

187 ià((
™
->
pAùiÚBa£
->
	`G‘De¡š©iÚ
(è=ğ
AùiÚBa£
::
eAùiÚDe¡š©iÚCl›Á
) &&

188 (
™
->
pAùiÚBa£
->
	`G‘AùiÚID
(è=ğ
eS”v”DefšeAùiÚIDNÙifyCl›Á
))

190 
™
->
pAùiÚBa£
->
	`Trigg”
(
this
, it->
pAùiÚP¬amBa£
, 
·¿m
);

192 ià(
™
->
pAùiÚBa£
->
	`G‘Autom©ic
(è=ğ
Œue
)

194 
™
->
pAùiÚBa£
->
	`Trigg”
(
this
, it->
pAùiÚP¬amBa£
, 
·¿m
);

198 ià(
³rmissiÚ
 == 1)

200 
™
->
pAùiÚBa£
->
	`Trigg”
(
this
, it->
pAùiÚP¬amBa£
, 
·¿m
);

204 
	}
}

206 
ušt32_t
 
	gS”v”Ev’tBa£
::
	$G‘Ev’tID
() const

208  
m_Ev’tID
;

209 
	}
}

211 
	gS”v”Ev’tBa£
::
	$S‘AùiÚClo£Ty³
(
ušt8_t
 
aùiÚClo£Ty³
)

213 
m_AùiÚClo£Ty³
 = 
aùiÚClo£Ty³
;

214 
	}
}

216 
ušt8_t
 
	gS”v”Ev’tBa£
::
	$G‘AùiÚClo£Ty³
() const

218  
m_AùiÚClo£Ty³
;

219 
	}
}

221 
	gS”v”Ev’tBa£
::
	$S‘AùiÚClo£Time
(
ušt32_t
 
aùiÚClo£Time
)

223 
m_AùiÚClo£Time
 = 
aùiÚClo£Time
;

224 
	}
}

226 
ušt32_t
 
	gS”v”Ev’tBa£
::
	$G‘AùiÚClo£Time
() const

228  
m_AùiÚClo£Time
;

229 
	}
}

231 
	gS”v”Ev’tBa£
::
	$S‘ScheduËabË
(
boŞ
 
bS‘ScheduËabË
)

233 
m_ScheduËS‘abË
 = 
bS‘ScheduËabË
;

234 
	}
}

236 
boŞ
 
	gS”v”Ev’tBa£
::
	$G‘ScheduËabË
() const

238  
m_ScheduËS‘abË
;

239 
	}
}

241 
	gS”v”Ev’tBa£
::
S‘ScheduËS‘tšg
(cÚ¡ 
¡d
::
veùÜ
<
¡A‰ribu‹dScheduËI‹m
>& 
scheduËS‘tšgLi¡
)

243 
m_ScheduËS‘tšgLi¡
.
ş—r
();

245 
	g¡d
::
veùÜ
<
¡A‰ribu‹dScheduËI‹m
>::
cÚ¡_™”©Ü
 
™
 = 
scheduËS‘tšgLi¡
.
begš
();

246 
	g™
 !ğ
scheduËS‘tšgLi¡
.
’d
(); it++)

248 
	gScheduË
::
ScheduËProfeMªag”
::
ScheduËIDInfo
 
šfo
;

249 
	gšfo
.
	guÎScheduËID
 = 
™
->
uÎScheduËID
;

251 ià(
	g™
->
	giA‰ribu‹
 =ğ
S”v”PrÙocŞ
::
SCHEDULE_ATTRIBUTE_DO_NOTIFY
 ||

252 
™
->
iA‰ribu‹
 =ğ
S”v”PrÙocŞ
::
SCHEDULE_ATTRIBUTE_ALLOWED
 ||

253 
™
->
iA‰ribu‹
 =ğ
S”v”PrÙocŞ
::
SCHEDULE_ATTRIBUTE_DO_RECEIVE
)

255 
šfo
.
bNÙify
 = 
Œue
;

259 
	gšfo
.
	gbNÙify
 = 
çl£
;

262 
	gm_ScheduËS‘tšgLi¡
.
push_back
(
šfo
);

265 ià(
	gm_ScheduËProfeMªag”
 !ğ
NULL
)

267 
m_ScheduËProfeMªag”
->
R–—£Profe
(
m_Ev’tProfe
);

268 
	gm_Ev’tProfe
 = 
m_ScheduËProfeMªag”
->
G‘Profe
(
m_ScheduËS‘tšgLi¡
);

	@../../titanutils/EventAction/EventModel.h

1 #iâdeà
__EVENT_MODEL_H__


2 
	#__EVENT_MODEL_H__


	)

4 
	~"AùiÚMod–.h
"

6 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

8 
	~"scheduË/ScheduËProfeMªag”.h
"

9 
	~"scheduË/ScheduËProfeSh¬eImp.h
"

11 
	g¡A‰ribu‹dScheduËI‹m
;

13 şas 
	cS”v”Ev’tBa£


15 
	mpublic
:

16 
	sOb£rv”P¬am


18 
AùiÚBa£
* 
pAùiÚBa£
;

19 
AùiÚP¬am‘”Ba£
* 
	mpAùiÚP¬amBa£
;

21 
Ob£rv”P¬am
();

22 ~
Ob£rv”P¬am
();

25 
	gpublic
:

26 
S”v”Ev’tBa£
(
ScheduË
::
ScheduËProfeMªag”
* 
scheduËProfeMªag”
, 
ušt32_t
 
ev’tID
,

27 
boŞ
 
scheduËS‘abË
, 
ušt8_t
 
aùiÚClo£Ty³
, 
ušt32_t
 
aùiÚClo£Time
);

28 
	gvœtu®
 ~
S”v”Ev’tBa£
();

30 
A‰ach
(
Ob£rv”P¬am
& 
ob£rv”P¬am
);

31 
ModifyOb£rv”P¬am
(
ušt32_t
 
aùiÚID
, 
AùiÚP¬am‘”Ba£
* 
aùiÚP¬amBa£
);

32 
boŞ
 
CheckAùiÚInOb£rv”P¬am
(
ušt32_t
 
aùiÚID
);

33 
boŞ
 
D‘achS³cificOb£rv”P¬am
(
ušt32_t
 
aùiÚID
);

34 
D‘achAÎ
();

36 
NÙify
(
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
& 
·¿m
);

38 
ušt32_t
 
	$G‘Ev’tID
() const;

40 
	`S‘AùiÚClo£Ty³
(
ušt8_t
 
aùiÚClo£Ty³
);

41 
ušt8_t
 
	$G‘AùiÚClo£Ty³
() const;

43 
	`S‘AùiÚClo£Time
(
ušt32_t
 
aùiÚClo£Time
);

44 
ušt32_t
 
	$G‘AùiÚClo£Time
() const;

46 
	`S‘ScheduËabË
(
boŞ
 
bS‘ScheduËabË
);

47 
boŞ
 
	$G‘ScheduËabË
() const;

49 
	`S‘ScheduËS‘tšg
(cÚ¡ 
¡d
::
veùÜ
<
¡A‰ribu‹dScheduËI‹m
>& 
scheduËS‘tšgLi¡
);

51 
´iv©e
:

52 
	`CË¬
();

54 
´iv©e
:

55 
ušt32_t
 
m_Ev’tID
;

56 
boŞ
 
m_ScheduËS‘abË
;

57 
ušt8_t
 
m_AùiÚClo£Ty³
;

58 
ušt32_t
 
m_AùiÚClo£Time
;

59 
¡d
::
veùÜ
<
ScheduË
::
ScheduËProfeMªag”
::
ScheduËIDInfo
> 
m_ScheduËS‘tšgLi¡
;

61 
¡d
::
veùÜ
<
Ob£rv”P¬am
> 
m_Ob£rv”s
;

62 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

64 
ScheduË
::
ScheduËProfeMªag”
* 
m_ScheduËProfeMªag”
;

65 
ScheduË
::
ProfeSh¬e
* 
m_Ev’tProfe
;

66 
	}
};

	@../../titanutils/EventAction/EventParameter.cpp

1 
	~"Ev’tP¬am‘”.h
"

3 
	~"commÚ/¡ršg.h
"

5 
	~"debugMsg/Debug.h
"

7 
	~"T™ªCommÚ/CommÚSŒšg.h
"

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
	gEv’tP¬am‘”
::
Ev’tP¬amBa£
::
	$Ev’tP¬amBa£
()

12 : 
	`£rv”Ty³
(
	`UINT32_C
(0))

13 , 
	`£rv”ID
(
	`UINT64_C
(0))

14 , 
	`deviûName
()

15 , 
	`desütiÚ
()

16 , 
	`f‹rCl›ÁSessiÚID
(
	$UINT32_C
(0))

17 {
	}
}

18 
	gEv’tP¬am‘”
::
Ev’tP¬amBa£
::~
	$Ev’tP¬amBa£
()

19 {
	}
}

21 
Ev’tP¬am‘”
::
Ev’tP¬amDeçuÉ
::
	$Ev’tP¬amDeçuÉ
()

22 : 
	`Ev’tP¬amBa£
()

23 , 
	`deviûID
(
	$UINT64_C
(0))

24 {
	}
}

25 
	gEv’tP¬am‘”
::
Ev’tP¬amDeçuÉ
::~
	$Ev’tP¬amDeçuÉ
()

26 {
	}
}

28 
Ev’tP¬am‘”
::
Ev’tP¬amCÚfigChªge
::
	$Ev’tP¬amCÚfigChªge
()

29 : 
	`Ev’tP¬amBa£
()

30 , 
	`isIDLi¡S”v”Ty³
(
çl£
)

31 , 
	$IDLi¡
()

32 {
	}
}

33 
	gEv’tP¬am‘”
::
Ev’tP¬amCÚfigChªge
::~
	$Ev’tP¬amCÚfigChªge
()

34 {
	}
}

36 
Ev’tP¬am‘”
::
Ev’tP¬amS”v”Stus
::
	$Ev’tP¬amS”v”Stus
()

37 : 
	`Ev’tP¬amBa£
()

38 , 
	`çov”S”v”ID
(
	$UINT64_C
(0))

39 {
	}
}

40 
	gEv’tP¬am‘”
::
Ev’tP¬amS”v”Stus
::~
	$Ev’tP¬amS”v”Stus
()

41 {
	}
}

43 
Ev’tP¬am‘”
::
Ev’tP¬amComm™CÚŒŞ
::
	$Ev’tP¬amComm™CÚŒŞ
()

44 : 
	`Ev’tP¬amBa£
()

45 , 
	`f‹rCl›ÁSessiÚID
(
	`UINT32_C
(0))

46 , 
	`syncFÏg
(
	$UINT64_C
(0))

47 {
	}
}

48 
	gEv’tP¬am‘”
::
Ev’tP¬amComm™CÚŒŞ
::~
	$Ev’tP¬amComm™CÚŒŞ
()

49 {
	}
}

51 
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
::
	$Ev’tNÙifyP¬am
()

52 : 
	`occurTime_time
(
	`UINT64_C
(0))

53 , 
	`occurTime_mliSecÚd
(
	`UINT32_C
(0))

54 , 
	`ev’tID
(
	`UINT32_C
(0))

55 , 
	`šScheduË
(
çl£
)

56 , 
	`·¿m‘”Ty³
(
	`UINT32_C
(0))

57 , 
	$ev’tP¬am
(
NULL
)

58 {
	}
}

59 
	gEv’tP¬am‘”
::
Ev’tNÙifyP¬am
::~
	$Ev’tNÙifyP¬am
()

61 ià(
ev’tP¬am
 !ğ
NULL
)

63 
d–‘e
 
ev’tP¬am
;

65 
	}
}

67 
boŞ
 
	gEv’tP¬am‘”
::
	$CÚv”tEvÃtP¬am‘”
(
ušt32_t
 
·¿mTy³
, cÚ¡ 
Ev’tP¬am‘”
::
Ev’tP¬amBa£
& 
ev’tP¬am
,

68 
¡d
::
¡ršg
& 
¡rMsg
)

70 ià(
·¿mTy³
 =ğ
Ev’tP¬am‘”
::
eEv’tP¬amTy³DeçuÉ
)

72 
Ev’tP¬am‘”
::
Ev’tP¬amDeçuÉ
* 
·¿m
 = (Ev’tP¬am‘”::Ev’tP¬amDeçuÉ*)(&
ev’tP¬am
);

73 cÚ¡ 
s_mes§ge_fÜm©
[] =

81 
¡rMsg
 = 
	`¡ršg_fÜm©
(
s_mes§ge_fÜm©
, 
·¿m
->
£rv”Ty³
,…¬am->
£rv”ID
,…¬am->
deviûID
,

82 
·¿m
->
desütiÚ
.
	`c_¡r
());

84 ià(
·¿mTy³
 =ğ
Ev’tP¬am‘”
::
eEv’tP¬amTy³CÚfigChªge
)

86 
Ev’tP¬am‘”
::
Ev’tP¬amCÚfigChªge
* 
·¿m
 = (Ev’tP¬am‘”::Ev’tP¬amCÚfigChªge*)(&
ev’tP¬am
);

87 cÚ¡ 
s_mes§ge_fÜm©
[] =

93 
¡rMsg
 = 
	`¡ršg_fÜm©
(
s_mes§ge_fÜm©
, 
·¿m
->
£rv”Ty³
,…¬am->
£rv”ID
,

94 
·¿m
->
isIDLi¡S”v”Ty³
 ? "Œue" : "çl£",…¬am->
IDLi¡
.
	`size
());

96 cÚ¡ 
s_id_fÜm©
[] = "<id>%llu</id>";

97 
ušt32_t
 
i
 = 0; i < 
·¿m
->
IDLi¡
.
	`size
(); i++)

99 
¡d
::
¡ršg
 
¡rID
 = 
	`¡ršg_fÜm©
(
s_id_fÜm©
, 
·¿m
->
IDLi¡
[
i
]);

100 
¡rMsg
 +ğ
¡rID
;

103 
¡rMsg
 += "</itemIdList>";

105 ià(!
·¿m
->
desütiÚ
.
	`em±y
())

107 
¡d
::
¡ršg
 
¡rNameLi¡
 = 
	`¡ršg_fÜm©
("<ÇmeLi¡><™em>%s</™em></ÇmeLi¡>", 
·¿m
->
desütiÚ
.
	`c_¡r
());

108 
¡rMsg
 +ğ
¡rNameLi¡
;

111 ià(
·¿mTy³
 =ğ
Ev’tP¬am‘”
::
eEv’tP¬amTy³S”v”Stus
)

113 
Ev’tP¬am‘”
::
Ev’tP¬amS”v”Stus
* 
·¿m
 = (Ev’tP¬am‘”::Ev’tP¬amS”v”Stus*)(&
ev’tP¬am
);

114 cÚ¡ 
s_mes§ge_fÜm©
[] =

119 
¡rMsg
 = 
	`¡ršg_fÜm©
(
s_mes§ge_fÜm©
, 
·¿m
->
£rv”Ty³
,…¬am->
£rv”ID
,

120 
·¿m
->
çov”S”v”ID
);

122 ià(
·¿mTy³
 =ğ
Ev’tP¬am‘”
::
eEv’tP¬amTy³Comm™CÚŒŞ
)

124 
Ev’tP¬am‘”
::
Ev’tP¬amComm™CÚŒŞ
* 
·¿m
 = (Ev’tP¬am‘”::Ev’tP¬amComm™CÚŒŞ*)(&
ev’tP¬am
);

125 cÚ¡ 
s_mes§ge_fÜm©
[] =

128 
¡rMsg
 = 
	`¡ršg_fÜm©
(
s_mes§ge_fÜm©
, 
·¿m
->
syncFÏg
);

132 
	`ASSERT
(
çl£
);

133  
çl£
;

136  
Œue
;

137 
	}
}

139 
boŞ
 
	gEv’tP¬am‘”
::
	$CÚv”tEv’tNÙifyReque¡
(cÚ¡ 
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
& 
»que¡
,

140 
¡d
::
¡ršg
& 
¡rReque¡
)

142 cÚ¡ 
s_mes§ge_fÜm©
[] =

156 
¡d
::
¡ršg
 
ev’tP¬am‘”
;

157 ià(!
	`CÚv”tEvÃtP¬am‘”
(
»que¡
.
·¿m‘”Ty³
, *»que¡.
ev’tP¬am
, 
ev’tP¬am‘”
))

159  
çl£
;

162 
¡d
::
¡ršg
 
¡¬t_lše
 = 
	`G’”©eReque¡Lše
("/api/event_session");

164 
¡d
::
¡ršg
 
mes§ge
 = 
	`¡ršg_fÜm©
(

165 
s_mes§ge_fÜm©
,

166 
»que¡
.
occurTime_time
,

167 
»que¡
.
occurTime_mliSecÚd
,

168 
»que¡
.
ev’tID
,

169 
»que¡
.
šScheduË
 ? "true" : "false",

170 
»que¡
.
·¿m‘”Ty³
,

171 
ev’tP¬am‘”
.
	`c_¡r
());

173 
¡d
::
¡ršg
 
h—d”
 = 
	`G’”©eMes§geH—d”
(
mes§ge
.
	`Ëngth
());

175 
¡rReque¡
 = 
¡¬t_lše
 + 
h—d”
 + 
CRLF
 + 
mes§ge
;

176  
Œue
;

177 
	}
}

	@../../titanutils/EventAction/EventParameter.h

1 #iâdeà
__EVENT_PARAMETER_H__


2 
	#__EVENT_PARAMETER_H__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~<¡ršg
>

7 
	~<veùÜ
>

9 şas 
	cEv’tP¬am‘”


11 
	mpublic
:

12 
	eEv’tP¬amTy³


14 
eEv’tP¬amTy³DeçuÉ
 = 0,

16 
	meEv’tP¬amTy³CÚfigChªge
,

17 
	meEv’tP¬amTy³S”v”Stus
,

18 
	meEv’tP¬amTy³Comm™CÚŒŞ
,

21 
	sEv’tP¬amBa£


23 
ušt32_t
 
	g£rv”Ty³
;

24 
ušt64_t
 
	g£rv”ID
;

25 
	g¡d
::
¡ršg
 
deviûName
;

26 
	g¡d
::
¡ršg
 
desütiÚ
;

27 
	g¡d
::
¡ršg
 
¡rCÚ‹Á
;

29 
ušt32_t
 
	gf‹rCl›ÁSessiÚID
;

31 
Ev’tP¬amBa£
();

32 
	gvœtu®
 ~
Ev’tP¬amBa£
();

35 
	gEv’tP¬amDeçuÉ
: 
public
 
Ev’tP¬amBa£


37 
ušt64_t
 
deviûID
;

39 
Ev’tP¬amDeçuÉ
();

40 
	gvœtu®
 ~
Ev’tP¬amDeçuÉ
();

43 
	gEv’tP¬amCÚfigChªge
: 
public
 
Ev’tP¬amBa£


45 
boŞ
 
isIDLi¡S”v”Ty³
;

46 
	g¡d
::
veùÜ
<
ušt64_t
> 
IDLi¡
;

48 
Ev’tP¬amCÚfigChªge
();

49 
	gvœtu®
 ~
Ev’tP¬amCÚfigChªge
();

52 
	gEv’tP¬amS”v”Stus
: 
public
 
Ev’tP¬amBa£


54 
ušt64_t
 
çov”S”v”ID
;

56 
Ev’tP¬amS”v”Stus
();

57 
	gvœtu®
 ~
Ev’tP¬amS”v”Stus
();

60 
	gEv’tP¬amComm™CÚŒŞ
: 
public
 
Ev’tP¬amBa£


62 
ušt32_t
 
f‹rCl›ÁSessiÚID
;

63 
ušt64_t
 
	gsyncFÏg
;

65 
Ev’tP¬amComm™CÚŒŞ
();

66 
	gvœtu®
 ~
Ev’tP¬amComm™CÚŒŞ
();

69 
	sEv’tNÙifyP¬am


71 
ušt64_t
 
	goccurTime_time
;

72 
ušt32_t
 
	goccurTime_mliSecÚd
;

73 
ušt32_t
 
	gev’tID
;

74 
boŞ
 
	gšScheduË
;

75 
ušt32_t
 
	g·¿m‘”Ty³
;

76 
Ev’tP¬amBa£
* 
	gev’tP¬am
;

78 
Ev’tNÙifyP¬am
();

79 ~
Ev’tNÙifyP¬am
();

82 
boŞ
 
CÚv”tEv’tNÙifyReque¡
(cÚ¡ 
Ev’tP¬am‘”
::
Ev’tNÙifyP¬am
& 
»que¡
, 
¡d
::
¡ršg
& 
¡rReque¡
);

84 
	g´iv©e
:

85 
boŞ
 
CÚv”tEvÃtP¬am‘”
(
ušt32_t
 
·¿mTy³
, cÚ¡ 
Ev’tP¬am‘”
::
Ev’tP¬amBa£
& 
ev’tP¬am
,

86 
¡d
::
¡ršg
& 
¡rMsg
);

	@../../titanutils/EventAction/EventUtility.cpp

1 
	~"Ev’tUt™y.h
"

2 
	~"commÚ/¡ršg.h
"

3 
	~"debugMsg/Debug.h
"

4 
	~"T™ªCommÚ/CommÚSŒšg.h
"

5 
	~"´og¿mmšg_h–p_fe/NUUOCÜpÜ©eDefš™iÚ.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
	gCEv’tUt™y
::
	$CEv’tUt™y
()

12 
	}
}

14 
CEv’tUt™y
::~
	$CEv’tUt™y
()

17 
	}
}

19 
boŞ
 
CEv’tUt™y
::
	$IsEMaEv’t
(
ušt32_t
 
uiEv’tID
)

21 ià(
uiEv’tID
 >ğ
NUUO_EVENT_USER_DEFINED_CODE_BASE
)

23  
Œue
;

26 
boŞ
 
bR‘
 = 
Œue
;

28 
uiEv’tID
)

30 
NUUO_EVENT_SERVER_ONLINE
:

31 
NUUO_EVENT_SERVER_READY
:

32 
NUUO_EVENT_CONNECTION_RESTORE
:

33 
NUUO_EVENT_METADATA_SAVE_DB_START
:

34 
NUUO_EVENT_METADATA_SAVE_DB_STOP
:

35 
bR‘
 = 
çl£
;

41  
bR‘
;

42 
	}
}

44 
	g¡d
::
¡ršg
 
CEv’tUt™y
::
	$G’”©eEv’tName
(
ušt32_t
 
uiEv’tID
)

46 
¡d
::
¡ršg
 
¡rEv’tName
 = "Unknownƒvent";

48 
uiEv’tID
)

50 
NUUO_EVENT_DISK_ABNORMAL
:

51 
¡rEv’tName
 = 
NUUO_EVENT_STRING_DISK_ABNORMAL
;

53 
NUUO_EVENT_SERVER_FOUND_NO_AVAILABLE_FAILOVER_SERVER
:

54 
¡rEv’tName
 = 
NUUO_EVENT_STRING_SERVER_FOUND_NO_AVAILABLE_FAILOVER_SERVER
;

56 
NUUO_EVENT_FAILOVER_SERVER_START
:

57 
¡rEv’tName
 = 
NUUO_EVENT_STRING_FAILOVER_SERVER_START
;

59 
NUUO_EVENT_FAILOVER_SERVER_STOP
:

60 
¡rEv’tName
 = 
NUUO_EVENT_STRING_FAILOVER_SERVER_STOP
;

62 
NUUO_EVENT_SERVER_REDUNDANT_POWER_STATUS_ABNORMAL
:

63 
¡rEv’tName
 = 
NUUO_EVENT_STRING_SERVER_REDUNDANT_POWER_STATUS_ABNORMAL
;

65 
NUUO_EVENT_SERVER_REDUNDANT_POWER_STATUS_NORMAL
:

66 
¡rEv’tName
 = 
NUUO_EVENT_STRING_SERVER_REDUNDANT_POWER_STATUS_NORMAL
;

68 
NUUO_EVENT_SERVER_OFFLINE
:

69 
¡rEv’tName
 = 
NUUO_EVENT_STRING_SERVER_OFFLINE
;

71 
NUUO_EVENT_SERVER_AUTO_BACKUP_FAIL
:

72 
¡rEv’tName
 = 
NUUO_EVENT_STRING_SERVER_AUTO_BACKUP_FAIL
;

74 
NUUO_EVENT_MOTION_START
:

75 
¡rEv’tName
 = 
NUUO_EVENT_STRING_MOTION_START
;

77 
NUUO_EVENT_DEVICE_CHANGE_TO_BE_UNRETENTIVE
:

78 
¡rEv’tName
 = 
NUUO_EVENT_STRING_DEVICE_CHANGE_TO_BE_UNRETENTIVE
;

80 
NUUO_EVENT_CONNECTION_LOST
:

81 
¡rEv’tName
 = 
NUUO_EVENT_STRING_CONNECTION_LOST
;

83 
NUUO_EVENT_INPUT_ON
:

84 
¡rEv’tName
 = 
NUUO_EVENT_STRING_INPUT_ON
;

86 
NUUO_EVENT_METADATA_TRANSACTION_START
:

87 
¡rEv’tName
 = 
NUUO_EVENT_STRING_METADATA_TRANSACTION_START
;

89 
NUUO_EVENT_METADATA_TRANSACTION_STOP
:

90 
¡rEv’tName
 = 
NUUO_EVENT_STRING_METADATA_TRANSACTION_STOP
;

92 
NUUO_EVENT_DB_STATUS_CHANGE_TO_ABNORMAL
:

93 
¡rEv’tName
 = 
NUUO_EVENT_STRING_DB_STATUS_CHANGE_TO_ABNORMAL
;

95 
NUUO_EVENT_SERVER_ALL_VOLUME_STATUS_ABNORMAL
:

96 
¡rEv’tName
 = 
NUUO_EVENT_STRING_SERVER_ALL_VOLUME_STATUS_ABNORMAL
;

98 
NUUO_EVENT_SERVER_SYSTEM_OVER_HEATED
:

99 
¡rEv’tName
 = 
NUUO_EVENT_STRING_SERVER_SYSTEM_OVER_HEATED
;

105  
¡rEv’tName
;

106 
	}
}

	@../../titanutils/EventAction/EventUtility.h

1 #iâdeà
__EVENT_UTILITY_H__


2 
	#__EVENT_UTILITY_H__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~<¡ršg
>

8 şas 
	cCEv’tUt™y


10 
	mpublic
:

11 
boŞ
 
IsEMaEv’t
(
ušt32_t
 
uiEv’tID
);

12 
	m¡d
::
¡ršg
 
G’”©eEv’tName
(
ušt32_t
 
uiEv’tID
);

14 
	m´iv©e
:

15 
CEv’tUt™y
();

16 ~
CEv’tUt™y
();

17 
CEv’tUt™y
(cÚ¡ CEv’tUt™y& 
rhs
);

18 
	mCEv’tUt™y
 &
	mİ”©Ü
=(cÚ¡ 
CEv’tUt™y
& 
rhs
);

	@../../titanutils/EventAction/SystemEventCtrl.cpp

1 
	~"debugMsg/Debug.h
"

2 
	~"Sy¡emEv’tCŒl.h
"

3 
	~"´og¿mmšg_h–p_fe/NUUOCÜpÜ©eDefš™iÚ.h
"

4 
	~"commÚ/fe.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
	gCSy¡emEv’tCŒl
::
	$CSy¡emEv’tCŒl
(
ušt64_t
 
uÎS”v”ID
)

10 #ifdeà
__lšux__


11 
m_hªdËr
 = 
NULL
;

12 
ušt32_t
 
id
 = (0xFFFFFFFF & 
uÎS”v”ID
);

13 
m_hªdËr
 = 
	`subsüib_ev’t
(
id
);

15 
	}
}

17 
	gCSy¡emEv’tCŒl
::~
	$CSy¡emEv’tCŒl
()

19 #ifdeà
__lšux__


20 
	`unsubsüib_ev’t
(
m_hªdËr
);

22 
	}
}

24 
ušt32_t
 
	gCSy¡emEv’tCŒl
::
	$G‘Ev’t
()

26 #ifdeà
__lšux__


27 
·¿m_size
 = 0;

28 
ušt32_t
 
uiEv’tID
 = 0;

29 
timeout
 = 100;

30 
ušt64_t
 
ts
;

31 cÚ¡ 
eva_·¿m
 *
·¿m
 = 
NULL
;

33 ià(0 =ğ
	`g‘_ev’t
(
m_hªdËr
, 
timeout
, &
uiEv’tID
, &
ts
, &
·¿m
, &
·¿m_size
))

35 
uiEv’tID
)

37 
kDiskE¼Ü
:

38 
uiEv’tID
 = 
NUUO_EVENT_DISK_ABNORMAL
;

39 
m_tEv’tDiskAbnÜm®
.
uiVŞumeID
 = 
·¿m
->
disk_”rÜ
.
disk_id
;

40 
m_tEv’tDiskAbnÜm®
.
¡rMsg
 = 
·¿m
->
disk_”rÜ
.
msg
;

41 
	`TRACE
("C©ch‡ disk‡bnÜm®ƒv’t. disk id %u , mes§g=> % \n", 
·¿m
->
disk_”rÜ
.
disk_id
,…¬am->disk_”rÜ.
msg
);

43 
kRedundªtPow”NÜm®
:

44 
uiEv’tID
 = 
NUUO_EVENT_SERVER_REDUNDANT_POWER_STATUS_NORMAL
;

45 
	`TRACE
("Catch‡„edundant…ower‚ormalƒvent\n");

47 
kRedundªtPow”AbnÜm®
:

48 
uiEv’tID
 = 
NUUO_EVENT_SERVER_REDUNDANT_POWER_STATUS_ABNORMAL
;

49 
	`TRACE
("Catch‡„edundant…ower‡bnormalƒvent\n");

51 
kSy¡emOv”H—‹dEv’t
:

52 
uiEv’tID
 = 
NUUO_EVENT_SERVER_SYSTEM_OVER_HEATED
;

53 
	`TRACE
("Catch‡ system over heatedƒvent\n");

56 
uiEv’tID
 = 0;

57 
	`TRACE
("getƒvent default\n");

61 ià(
·¿m
 !ğ
NULL
)

63 
	`»Ëa£_ev’t_·¿m
(
·¿m
, 
·¿m_size
);

64 
·¿m
 = 
NULL
;

68  
uiEv’tID
;

72 
	}
}

74 cÚ¡ 
	gTEv’tDiskAbnÜm®
& 
	gCSy¡emEv’tCŒl
::
	$G‘DiskAbnÜm®Info
()

76  
m_tEv’tDiskAbnÜm®
;

77 
	}
}

79 
boŞ
 
	gCSy¡emEv’tCŒl
::
	$IsRedundªtPow”
()

81 #ià
__lšux__


82  
	`CheckDœeùÜyExi¡
("/tmp/r2rpmode/");

84  
çl£
;

86 
	}
}

88 
	gCSy¡emEv’tCŒl
::
	$Qu”yRedundªtPow”Stus
()

90 #ià
__lšux__


91 
uiStus
 = 1;

92 ià(
	`CheckFeExi¡
("/tmp/r2½¡©"è=ğ
Œue
)

94 
FILE
 *
å
 = 
	`fİ’
("/tmp/r2rpstat", "r");

95 ià(
NULL
 !ğ
å
)

97 
	`fsÿnf
(
å
, "%u", &
uiStus
);

98 
	`fşo£
(
å
);

102  
uiStus
;

106 
	}
}

	@../../titanutils/EventAction/SystemEventCtrl.h

1 #iâdeà
__EVENT_DISK_ABNORMAL_H__


2 
	#__EVENT_DISK_ABNORMAL_H__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~<¡ršg
>

7 #ifdeà
__lšux__


8 
	~"ev_ag’t.h
"

11 
	sT_EVENT_COMMON


13 
	m¡d
::
¡ršg
 
¡rMsg
;

16 } 
	tTEv’tCommÚ
;

18 
	gT_EVENT_DISK_ABNORMAL
 : 
	tpublic
 
	tT_EVENT_COMMON


20 
ušt32_t
 
uiVŞumeID
;

22 
T_EVENT_DISK_ABNORMAL
()

23 : 
uiVŞumeID
(
UINT32_C
(0))

26 } 
	tTEv’tDiskAbnÜm®
;

28 şas 
	cCSy¡emEv’tCŒl


30 
	mpublic
:

31 
CSy¡emEv’tCŒl
(
ušt64_t
 
uÎS”v”ID
);

32 ~
CSy¡emEv’tCŒl
();

33 
G‘Ev’t
();

36 cÚ¡ 
	mTEv’tDiskAbnÜm®
& 
G‘DiskAbnÜm®Info
();

38 
boŞ
 
IsRedundªtPow”
();

39 
Qu”yRedundªtPow”Stus
();

41 
	m´iv©e
:

42 * 
m_hªdËr
;

43 
TEv’tDiskAbnÜm®
 
	mm_tEv’tDiskAbnÜm®
;

	@../../titanutils/MsClient/Handler/MsClientDataSessionHandler.cpp

1 
	~"MsCl›ÁD©aSessiÚHªdËr.h
"

2 
	~"­r/­r_ut™y.h
"

3 
	~"commÚ/sy¡em.h
"

4 
	~"commÚ/¡ršg.h
"

5 
	~"commÚ/fe.h
"

6 
	~"commÚ/h¬dw¬e.h
"

7 
	~"mšiz/mšizUt™y.h
"

8 
	~"libb64/decode.h
"

9 
	~"debugMsg/Debug.h
"

10 
	~"cÚ¡/S”v”PrÙocŞDefš™iÚ.h
"

11 
	~"PrÙocŞO³¿tiÚ/MsCl›ÁD©aSessiÚP¬£r.h
"

12 
	~"PrÙocŞO³¿tiÚ/MsCl›ÁD©aSessiÚG’”©e.h
"

13 
	~"commÚ/h¬dw¬e.h
"

15 #ià
defšed
(
__lšux__
)

16 
	~<dlfú.h
>

17 
	~<sys/vfs.h
>

18 
	~<sys/´ùl.h
>

21 #ifdeà
WIN32


22 
	#BACK_DOOR_FILENAME
 "C:\\mÁ\\backDoÜFe"

	)

23 
	#BACK_DOOR_FILE_UNZIP_PATH
 "C:\\mÁ\\BackDoÜZTempFŞd”\\"

	)

24 
	#SLASH
 "\\"

	)

26 
	#BACK_DOOR_FILENAME
 "/mtd/block4/backDoÜFe"

	)

27 
	#BACK_DOOR_FILE_UNZIP_PATH
 "/mtd/block4/BackDoÜZTempFŞd”/"

	)

28 
	#SLASH
 "/"

	)

31 #ifdeà
WIN32


32 
	#CENTRALIZED_UPGRADE_FILENAME
 "C:\\mÁ\\fœmw¬e.bš"

	)

33 
	#CENTRALIZED_UPGRADE_FILE_UNZIP_PATH
 "C:\\mÁ\\Fœmw¬eZTempFŞd”\\"

	)

34 
	#SLASH
 "\\"

	)

36 
	#CENTRALIZED_UPGRADE_FILENAME
 "/mtd/block4/fœmw¬e.bš"

	)

37 
	#CENTRALIZED_UPGRADE_FILE_UNZIP_PATH
 "/mtd/block4/Fœmw¬eZTempFŞd”/"

	)

38 
	#SLASH
 "/"

	)

41 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

46 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$MsCl›ÁD©aSessiÚHªdËr
(
SessiÚMªag”
* 
mªag”
, 
A´TıSock‘
* 
sock‘
,

47 
Ev’tBufãr
& 
bufãr
, 
ušt32_t
 
£ssiÚId
,

48 cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
,

49 * 
pMsCl›Á
)

50 : 
	`SessiÚHªdËr
(
mªag”
, 
sock‘
, 
bufãr
, 
£ssiÚId
)

51 , 
	`m_Ï¡_»cv_time
(
	`G‘TimeCouÁMS
())

52 , 
	`m_Ï¡_£nd_time
(
	`G‘TimeCouÁMS
())

53 , 
	`m_·r£r
()

54 , 
	`m_LoÿlS”v”Ty³
(
loÿlS”v”Ty³
)

55 , 
	`m_pMsCl›Á
((
MsCl›Á
*)
pMsCl›Á
)

56 , 
	`m_£mReque¡
()

57 , 
	`m_S‘Reque¡IDQueue
()

58 , 
	`m_S‘Reque¡Queue
()

59 , 
	`m_S‘Reque¡QueueCS
()

60 , 
	`m_G‘Reque¡Queue
()

61 , 
	`m_G‘Reque¡QueueCS
()

62 , 
	`m_HªdËdReque¡ID
(
UINT32_MAX
)

63 , 
	`m_S‘WÜk”
(
NULL
)

64 , 
	$m_vUpg¿deTh»ad
()

66 
m_S‘WÜk”
 = 
Ãw
 
	`Reque¡WÜk”
(
this
);

68 
ušt32_t
 
i
 = 0; i < 
GET_WORKER_SIZE
; i++)

70 
m_G‘WÜk”
[
i
] = 
Ãw
 
	`Reque¡WÜk”
(
this
);

73 
	`G‘ProduùInfo
(
m_ProduùInfo
);

75 
	`C»©eTh»ad
();

76 
	}
}

78 
	gMsCl›ÁD©aSessiÚHªdËr
::~
	$MsCl›ÁD©aSessiÚHªdËr
()

80 ià(
	`Th»adExi¡s
())

82 
	`C®lWÜk”
(
MsCl›ÁD©aSessiÚHªdËr
::
eTC_STOP
, 
NULL
);

83 
	`Clo£Th»ad
();

86 ià(
m_S‘WÜk”
 !ğ
NULL
)

88 
d–‘e
 
m_S‘WÜk”
;

91 
ušt32_t
 
i
 = 0; i < 
GET_WORKER_SIZE
; i++)

93 ià(
m_G‘WÜk”
[
i
] !ğ
NULL
)

95 
d–‘e
 
m_G‘WÜk”
[
i
];

98 
	}
}

100 cÚ¡ 
MsCl›Á
* 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$G‘MsCl›ÁRef
() const

102  
m_pMsCl›Á
;

103 
	}
}

105 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$G‘Tim”IÁ”v®
()

107  
TIMER_CHECK_MANAGEMENT_SERVER_DATA_SESSION
;

108 
	}
}

110 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$OnR—dC®lback
()

112 
m_Ï¡_»cv_time
 = 
	`G‘TimeCouÁMS
();

114 
Ev’tBufãr
 *
bufãr
 = 
	`G‘R—dBufãr
();

115 
	`IF_NULL_RETURN
(
bufãr
);

117 
bufãr
->
	`G‘L’gth
() != 0)

119 
m_·r£r
.
	`CÚsumeBufãr
(*
bufãr
);

121 ià(
m_·r£r
.
	`G‘S‹
().
»ad_¡©us
 =ğ
H‰pP¬£r
::
S‹
::
READING_DONE
)

124 ià(
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
() == "POST /api/management-server/data-session/CentralizedUpgrade HTTP/1.1")

126 
	`TRACE
("= MsClientDataSessionHandler::OnReadCallback ============\n");

127 
	`TRACE
("%s\n", 
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().
	`c_¡r
());

128 
	`TRACE
("================================================================\n");

130 ià(
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
() != "POST /api/management-server/data-session/KeepAlive HTTP/1.1")

132 
	`TRACE
("= MsClientDataSessionHandler::OnReadCallback ============\n");

133 
	`TRACE
("%s\n", 
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().
	`c_¡r
());

134 
	`TRACE
("[...skip header...]\n");

135 
	`TRACE
("%s\n", 
m_·r£r
.
	`G‘D©a
().
	`G‘Body
().
	`c_¡r
());

136 
	`TRACE
("================================================================\n");

140 
	`TRACE
("Get KeepAlive data session\n");

143 
ušt32_t
 
£ssiÚID
 = 
	`¡r_to_u32
(
m_·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-SessionID"));

144 ià(
£ssiÚID
 !ğ
	`G‘SessiÚID
())

146 
	`TRACE
("SessiÚID‚Ù m©ch: LoÿÈSessiÚID = %u, SessiÚID = %u\n", 
	`G‘SessiÚID
(), 
£ssiÚID
);

150 
XMLT»e
 
Œ“
;

151 
	`LßdXMLT»eBufãr
(
m_·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

152 
¡d
::
¡ršg
 
roÙ_Çme
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
();

154 ià(
	`¡ºcmp
(
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().
	`c_¡r
(), "HTTP", 4) == 0)

157 ià(
roÙ_Çme
 == "CloseDataSession")

159 
	`HªdËClo£D©aSessiÚRe¥Ú£
(
Œ“
);

163 
	`HªdËS”v”D•’dRe¥Ú£
(
Œ“
);

166 ià(
	`¡ºcmp
(
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().
	`c_¡r
(), "POST", 4) == 0)

169 ià(
roÙ_Çme
 == "KeepAlive")

171 
m_Ï¡_»cv_time
 = 
	`G‘TimeCouÁMS
();

173 ià(
roÙ_Çme
 == "DataSessionStatus")

175 
	`HªdËD©aSessiÚStusReque¡
(
Œ“
);

177 ià(
roÙ_Çme
 == "RemoteControl")

179 
	`HªdËRemÙeCÚŒŞReque¡
(
Œ“
);

181 ià(
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
() == "POST /api/management-server/data-session/CentralizedUpgrade HTTP/1.1")

183 
¡d
::
¡ršg
 
fœmw¬eTy³
 = 
m_·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-Firmware");

184 
ušt32_t
 
fœmw¬eSize
 = 
	`¡r_to_u32
(
m_·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("Content-Length"));

185 
ušt32_t
 
£ssiÚID
 = 
	`¡r_to_u32
(
m_·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-SessionID"));

186 
ušt32_t
 
»que¡ID
 = 
	`¡r_to_u32
(
m_·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-RequestID"));

188 
	`HªdËC’Œ®izedUpg¿deReque¡
(
Œ“
, 
fœmw¬eTy³
, 
fœmw¬eSize
, 
m_·r£r
.
	`G‘D©a
().
	`G‘Body
(),

189 
£ssiÚID
, 
»que¡ID
);

193 ià(
roÙ_Çme
.
	`fšd
("G‘"è!ğ
¡d
::
¡ršg
::
Åos
)

195 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_G‘Reque¡QueueCS
);

198 
m_G‘Reque¡Queue
.
	`push_back
(
Œ“
);

200 
m_£mReque¡
.
	`Po¡
();

204 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_S‘Reque¡QueueCS
);

207 
ušt32_t
 
tmpID
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("RequestID");

208 
m_S‘Reque¡IDQueue
.
	`push_back
(
tmpID
);

210 
m_S‘Reque¡Queue
.
	`push_back
(
Œ“
);

212 
m_£mReque¡
.
	`Po¡
();

220 
m_·r£r
.
	`Re£t
();

229 
	}
}

231 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$OnWr™eC®lback
()

233 
m_Ï¡_£nd_time
 = 
	`G‘TimeCouÁMS
();

235 
	}
}

237 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$OnTim”C®lback
()

240 ià(
	`G‘TimeCouÁMS
(è- 
m_Ï¡_£nd_time
 > 
S”v”PrÙocŞ
::
DATA_SESSION_IDLE_INTERVAL
)

242 
	`S’dR’ewReque¡
();

246 ià(
	`G‘TimeCouÁMS
(è- 
m_Ï¡_»cv_time
 > 
S”v”PrÙocŞ
::
DATA_SESSION_TIMEOUT
)

249 
	`OnSessiÚLo¡
();

250 
	`ASSERT
(0);

253 
št32_t
 
couÁ”
 = 0;

254 ià(
couÁ”
 < 3)

256 
couÁ”
++;

261 
couÁ”
 = 0;

265 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_G‘Reque¡QueueCS
);

266 ià(!
m_G‘Reque¡Queue
.
	`em±y
())

268 
m_£mReque¡
.
	`Po¡
();

274 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_S‘Reque¡QueueCS
);

275 ià(!
m_S‘Reque¡Queue
.
	`em±y
())

277 
m_£mReque¡
.
	`Po¡
();

283 
	}
}

285 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$OnSessiÚS¹
()

289 
	}
}

291 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$OnSessiÚLo¡
()

293 
SessiÚMªag”
 *
mªag”
 = 
	`G‘SessiÚMªag”
();

294 
	`ASSERT
(
mªag”
 !ğ
NULL
);

295 ià(
mªag”
 !ğ
NULL
)

297 
mªag”
->
	`RemoveHªdËr
(
	`G‘SessiÚID
());

301 
	}
}

303 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$HªdËClo£D©aSessiÚRe¥Ú£
(
XMLT»e
& 
Œ“
)

305 
MsCl›ÁD©aSessiÚ
::
Clo£D©aSessiÚRe¥Ú£
 
»¥Ú£
;

306 
»¥Ú£
.
£ssiÚ_id
 = 
	`¡r_to_u32
(
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessiÚID").
	`G‘CÚ‹Á
());

307 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("R‘uºCode").
	`G‘CÚ‹Á
());

309 ià(
»¥Ú£
.
»tuº_code
 !ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

311 
	`TRACE
("Clo£ D©¨SessiÚ Fa,ƒ¼Øcodğ%u\n", 
»¥Ú£
.
»tuº_code
);

314 
	}
}

316 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$HªdËD©aSessiÚStusReque¡
(
XMLT»e
& 
Œ“
)

319 
MsCl›ÁD©aSessiÚ
::
D©aSessiÚStusReque¡
 
»que¡
;

320 
MsCl›ÁD©aSessiÚP¬£r
::
	`P¬£D©aSessiÚStusReque¡
(
Œ“
, 
»que¡
);

323 
MsCl›ÁD©aSessiÚ
::
D©aSessiÚStusRe¥Ú£
 
»¥Ú£
;

324 
¡d
::
veùÜ
<
ušt32_t
>::
™”©Ü
 
™
 = 
»que¡
.
»que¡IDLi¡
.
	`begš
(); iˆ!ğ»que¡.»que¡IDLi¡.
	`’d
(); it++)

326 
MsCl›ÁD©aSessiÚ
::
Reque¡Stus
 
¡©us
;

327 
¡©us
.
»que¡ID
 = *
™
;

329 ià(
¡©us
.
»que¡ID
 < 
m_HªdËdReque¡ID
)

331 
¡©us
.
¡©usID
 = 
S”v”PrÙocŞ
::
REQUEST_STATUS_COMPLETED
;

335 
¡©us
.
¡©usID
 = 
S”v”PrÙocŞ
::
REQUEST_STATUS_HANDLING
;

338 
»¥Ú£
.
»que¡StusLi¡
.
	`push_back
(
¡©us
);

341 
»¥Ú£
.
£ssiÚ_id
 = 
»que¡
.session_id;

342 
»¥Ú£
.
£rv”ID
 = 
»que¡
.serverID;

343 
»¥Ú£
.
»que¡ID
 = 
»que¡
.requestID;

344 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_NONE
;

347 
¡d
::
¡ršg
 
¡rMes§ge
;

348 
MsCl›ÁD©aSessiÚG’”©e
::
	`G’”©eD©aSessiÚStusRe¥Ú£
(
»¥Ú£
, 
¡rMes§ge
);

351 
	`S’dD©a
(
¡rMes§ge
);

352 
	}
}

354 
boŞ
 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$CheckFœmw¬eAndMachšeTy³
(cÚ¡ 
¡d
::
¡ršg
& 
fœmw¬eTy³
)

356 ià(
m_ProduùInfo
.
¡rMachšeKey
 !ğ
fœmw¬eTy³
)

358 
	`ASSERT2
(0, "Fœmw¬ty³ incÜ»ù!! fœmw¬%s, machš%s\n", 
fœmw¬eTy³
.
	`c_¡r
(), 
m_ProduùInfo
.
¡rMachšeKey
.c_str());

359  
çl£
;

362 
	`TRACE
("check machšok %s\n", 
m_ProduùInfo
.
¡rMachšeKey
.
	`c_¡r
());

364  
Œue
;

365 
	}
}

367 
boŞ
 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$CheckFœmw¬eSize
(cÚ¡ 
ušt32_t
& 
fœmw¬eSize
)

369 #ià
	`defšed
(
__lšux__
)

370 
ušt32_t
 
S©aDomSize
 = 0;

372 
¡©fs64
 
sfs
;

373 
	`¡©fs64
("/mtd", &
sfs
);

374 
S©aDomSize
 = 
sfs
.
f_bava
 * sfs.
f_bsize
;

376 ià(
S©aDomSize
 < (
fœmw¬eSize
 + 102400))

378 
	`ASSERT2
(0, "§ dom f»siz%u i nÙƒnoughØupg¿dfœmw¬%u\n", 
S©aDomSize
, 
fœmw¬eSize
);

379  
çl£
;

382 
	`TRACE
("§ dom f»siz%u , fœmw¬%u\n", 
S©aDomSize
, 
fœmw¬eSize
);

384  
Œue
;

386  
Œue
;

388 
	}
}

390 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$HªdËC’Œ®izedUpg¿deReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, cÚ¡ 
¡d
::
¡ršg
& 
machšeTy³
,

391 cÚ¡ 
ušt32_t
& 
fœmw¬eSize
, cÚ¡ 
¡d
::
¡ršg
& 
cÚ‹Á
,

392 cÚ¡ 
ušt32_t
& 
£ssiÚID
, cÚ¡ ušt32_t& 
»que¡ID
)

395 
MsCl›ÁD©aSessiÚ
::
C’Œ®izedUpg¿deRe¥Ú£
 
»¥Ú£
;

397 
»¥Ú£
.
£ssiÚ_id
 = 
£ssiÚID
;

398 
»¥Ú£
.
»que¡ID
 =„equestID;

399 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_NONE
;

401 ià(!
	`CheckFœmw¬eAndMachšeTy³
(
machšeTy³
) ||

402 !
	`CheckFœmw¬eSize
(
fœmw¬eSize
))

404 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_NODATA
;

409 
¡d
::
¡ršg
 
ûÁ¿lizedUpg¿deF’ame
 = 
CENTRALIZED_UPGRADE_FILENAME
;

411 
¡d
::
¡ršg
 
fœmw¬e
;

412 
ušt32_t
 
cÚ‹ÁL’
 = 
cÚ‹Á
.
	`Ëngth
();

413 
ba£64
::
decod”
::
	`decode
(
cÚ‹Á
, 
fœmw¬e
, 
cÚ‹ÁL’
);

414 
FILE
* 
fe
 = 
	`fİ’
(
ûÁ¿lizedUpg¿deF’ame
.
	`c_¡r
(), "wb");

416 ià(
fe
 !ğ
NULL
)

418 
	`fwr™e
(
fœmw¬e
.
	`c_¡r
(), fœmw¬e.
	`Ëngth
(), 1, 
fe
);

419 
	`fşo£
(
fe
);

421 
Upg¿deTh»ad
 *
Upg¿deTh»adHªdËr
 = 
Ãw
 
	`Upg¿deTh»ad
(
ûÁ¿lizedUpg¿deF’ame
);

422 
Upg¿deTh»adHªdËr
->
	`C»©eTh»ad
();

424 
m_vUpg¿deTh»ad
.
	`push_back
(
Upg¿deTh»adHªdËr
);

428 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_UNKNOWN
;

429 
	`ASSERT2
(0, "Cª'ˆİ’ f%s\n", 
ûÁ¿lizedUpg¿deF’ame
.
	`c_¡r
());

433 
¡d
::
¡ršg
 
¡rMes§ge
;

434 
MsCl›ÁD©aSessiÚG’”©e
::
	`G’”©eC’Œ®izedUpg¿deRe¥Ú£
(
»¥Ú£
, 
¡rMes§ge
);

437 
	`S’dD©a
(
¡rMes§ge
);

438 
	}
}

440 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$HªdËRemÙeCÚŒŞReque¡
(
XMLT»e
& 
Œ“
)

442 
¡d
::
¡ršg
 
backDoÜF’ame
 = 
BACK_DOOR_FILENAME
;

443 
¡d
::
¡ršg
 
backDoÜFeUnzP©h
 = 
BACK_DOOR_FILE_UNZIP_PATH
;

445 ià(
m_LoÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

447 
backDoÜF’ame
 += "RS";

448 
backDoÜFeUnzP©h
 += "RS/";

450 ià(
m_LoÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

452 
backDoÜF’ame
 += "MDS";

453 
backDoÜFeUnzP©h
 += "MDS/";

461 
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞReque¡
 
»que¡
;

462 
MsCl›ÁD©aSessiÚP¬£r
::
	`P¬£RemÙeCÚŒŞReque¡
(
Œ“
, 
»que¡
);

465 
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞRe¥Ú£
 
»¥Ú£
;

467 
»¥Ú£
.
£ssiÚ_id
 = 
»que¡
.session_id;

468 
»¥Ú£
.
£rv”ID
 = 
»que¡
.serverID;

469 
»¥Ú£
.
»que¡ID
 = 
»que¡
.requestID;

470 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_UNKNOWN
;

472 
¡d
::
¡ršg
 
cÚ‹Á
;

473 
ušt32_t
 
cÚ‹ÁL’
 = 
cÚ‹Á
.
	`Ëngth
();

474 
ba£64
::
decod”
::
	`decode
(
»que¡
.
cÚ‹Á
, cÚ‹Á, 
cÚ‹ÁL’
);

475 
FILE
* 
fe
 = 
	`fİ’
(
backDoÜF’ame
.
	`c_¡r
(), "wb");

476 ià(
fe
 !ğ
NULL
)

478 
	`fwr™e
(
cÚ‹Á
.
	`c_¡r
(), cÚ‹Á.
	`Ëngth
(), 1, 
fe
);

479 
	`fşo£
(
fe
);

481 ià(
»que¡
.
skTy³
 =ğ
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞReque¡
::
eTaskTy³Lib¿ry
)

483 
	`TRACE
("Get Library File...\n");

485 #ià
	`defšed
(
__lšux__
)

486 * 
hªdË
 = 
	`dlİ’
(
backDoÜF’ame
.
	`c_¡r
(), 
RTLD_LAZY
);

488 ià(
hªdË
)

490 (*
	tFuncTy³
)();

491 
FuncTy³
 
func
 = 
»š‹½»t_ÿ¡
<FuncTy³>(
	`dlsym
(
hªdË
, 
»que¡
.
¬g
.
	`c_¡r
()));

493 ià(
func
)

495 
	`func
();

496 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_NONE
;

499 
	`dlşo£
(
hªdË
);

503 ià(
»que¡
.
skTy³
 =ğ
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞReque¡
::
eTaskTy³Com´es£dFe
)

505 
	`TRACE
("Get Compressed File...\n");

506 
	`D–‘eDœeùÜy
(
backDoÜFeUnzP©h
);

507 
	`MakeDœeùÜy
(
backDoÜFeUnzP©h
);

509 ià(
	`MšiUnz
(
backDoÜF’ame
, 
backDoÜFeUnzP©h
))

511 
¡d
::
veùÜ
<¡d::
¡ršg
> 
vFe
 = 
	`G‘SubDœeùÜy
(
backDoÜFeUnzP©h
);

512 ià(!
vFe
.
	`em±y
())

514 
¡d
::
¡ršg
 
sütFe
 = 
backDoÜFeUnzP©h
 + 
vFe
[0] + "/" + 
»que¡
.
¬g
;

515 
¡d
::
¡ršg
 
cmd
 = "chmod 755 " + 
sütFe
;

516 
	`sy¡em
(
cmd
.
	`c_¡r
());

517 
	`sy¡em
(
sütFe
.
	`c_¡r
());

518 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_NONE
;

521 
	`D–‘eDœeùÜy
(
backDoÜFeUnzP©h
);

525 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_PARAMETER
;

530 
»¥Ú£
.
»tuº_code
 = 
S”v”PrÙocŞ
::
ERROR_UNKNOWN
;

532 
	`RemoveFe
(
backDoÜF’ame
);

535 
¡d
::
¡ršg
 
¡rMes§ge
;

536 
MsCl›ÁD©aSessiÚG’”©e
::
	`G’”©eRemÙCÚŒŞRe¥Ú£
(
»¥Ú£
, 
¡rMes§ge
);

539 
	`S’dD©a
(
¡rMes§ge
);

540 
	}
}

542 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$S’dR’ewReque¡
()

545 
MsCl›ÁD©aSessiÚ
::
R’ewSessiÚReque¡
 
»que¡
;

546 
»que¡
.
£ssiÚ_id
 = 
	`G‘SessiÚID
();

547 
¡d
::
¡ršg
 
¡rReque¡
;

548 
MsCl›ÁD©aSessiÚG’”©e
::
	`G’”©eR’ewD©aSessiÚReque¡
(&
»que¡
, 
m_LoÿlS”v”Ty³
, 
¡rReque¡
);

552 
	`S’dD©a
(
¡rReque¡
);

554 
A´TıSock‘
* 
pSock‘
 = 
	`G‘Sock‘
();

555 ià(
pSock‘
 !ğ
NULL
)

557 
	`Wr™eSock‘UÁTimeout
(
pSock‘
, 
¡rReque¡
, 5000);

560 
	}
}

562 
	gMsCl›ÁD©aSessiÚHªdËr
::
	$Th»adProc
()

564 #ià
	`defšed
(
__lšux__
)

565 
	`´ùl
(
PR_SET_NAME
, "MsClientDataSessionHandler", 0, 0, 0);

568 
Œue
)

573 ià(
	`G‘TimeCouÁMS
(è- 
m_Ï¡_£nd_time
 > 
S”v”PrÙocŞ
::
DATA_SESSION_IDLE_INTERVAL
)

575 
	`S’dR’ewReque¡
();

576 
m_Ï¡_£nd_time
 = 
	`G‘TimeCouÁMS
();

578 
size_t
 
ui
 = 0; u˜< 
m_vUpg¿deTh»ad
.
	`size
(); ++ui)

580 ià(
m_vUpg¿deTh»ad
[
ui
]->
	`G‘Upg¿deStus
())

582 
d–‘e
 
m_vUpg¿deTh»ad
[
ui
];

591 
ušt32_t
 
uMes§ge
 = (ušt32_t)
eTC_STOP
;

592 ià(
	`CheckReque¡
(&
uMes§ge
))

594 (
Th»adCommªd
)
uMes§ge
)

596 
eTC_STOP
:

597 
	`R•ly
(0);

600 
	`R•ly
((
ušt32_t
)-1);

608 ià(!
m_£mReque¡
.
	`Wa™
(5000))

616 !
m_S‘Reque¡Queue
.
	`em±y
(è&& 
m_S‘WÜk”
->
	`CheckS‘abË
())

618 
XMLT»e
 
Œ“
;

621 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_S‘Reque¡QueueCS
);

623 
m_HªdËdReque¡ID
 = 
m_S‘Reque¡IDQueue
.
	`äÚt
();

624 
m_S‘Reque¡IDQueue
.
	`pİ_äÚt
();

626 
Œ“
 = 
m_S‘Reque¡Queue
.
	`äÚt
();

627 
m_S‘Reque¡Queue
.
	`pİ_äÚt
();

630 
	`TRACE
("HªdË s‘ iÀth»ad!! % (HªdËdReque¡ID = %u)\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
(), 
m_HªdËdReque¡ID
);

632 
¡d
::
li¡
<
ušt32_t
>::
™”©Ü
 
™
 = 
m_S‘Reque¡IDQueue
.
	`begš
(); iˆ!ğm_S‘Reque¡IDQueue.
	`’d
(); it++)

634 
	`TRACE
("Reque¡ID = %u\n", *
™
);

637 
m_S‘WÜk”
->
	`S‘Reque¡D©a
(
Œ“
);

640 ià(
m_S‘Reque¡Queue
.
	`em±y
(è&& 
m_HªdËdReque¡ID
 !ğ
UINT32_MAX
 && 
m_S‘WÜk”
->
	`CheckS‘abË
())

642 
	`TRACE
("Don't have‡ny set„equest...\n");

643 
m_HªdËdReque¡ID
 = 
UINT32_MAX
;

649 !
m_G‘Reque¡Queue
.
	`em±y
())

651 
ušt32_t
 
i
;

652 
i
 = 0; i < 
GET_WORKER_SIZE
; i++)

654 ià(
m_G‘WÜk”
[
i
]->
	`CheckS‘abË
())

660 ià(
i
 =ğ
GET_WORKER_SIZE
)

662 
	`TRACE
("Noƒnough worker!!\n");

666 
XMLT»e
 
Œ“
;

669 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_G‘Reque¡QueueCS
);

670 
Œ“
 = 
m_G‘Reque¡Queue
.
	`äÚt
();

671 
m_G‘Reque¡Queue
.
	`pİ_äÚt
();

674 
	`TRACE
("HªdË g‘ iÀth»ad %u!! %s\n", 
i
, 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

675 
m_G‘WÜk”
[
i
]->
	`S‘Reque¡D©a
(
Œ“
);

678 
	}
}

	@../../titanutils/MsClient/Handler/MsClientDataSessionHandler.h

1 #iâdeà
__MS_CLIENT_DATA_SESSION_HANDLER_H__


2 
	#__MS_CLIENT_DATA_SESSION_HANDLER_H__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"commÚ/£m­hÜe.h
"

6 
	~"libev’t/­r_ev’t.h
"

7 
	~"libev’t/ev’t_tim”.h
"

8 
	~"libev’t/ev’t_bufãr.h
"

9 
	~"h‰p/h‰p_·r£r.h
"

10 
	~"sûw/xml_Œ“.h
"

11 
	~"­r/­r_th»ad_wÜk”.h
"

13 
	~"£rv”/SessiÚHªdËr.h
"

14 
	~"£rv”/SessiÚMªag”.h
"

16 
	~"MsCl›Á/MsCl›Á.h
"

18 
	~"MsCl›Á/Reque¡WÜk”/Reque¡WÜk”.h
"

20 
	~"MsCl›Á/Upg¿deTh»ad/Upg¿deTh»ad.h
"

22 
	~<li¡
>

23 
	~"T™ªCommÚ/CommÚUt™y.h
"

25 
	#GET_WORKER_SIZE
 4

	)

27 
şass
 
	gMsCl›ÁD©aSessiÚHªdËr
: 
public
 
SessiÚHªdËr
, 
	gSYSUTILS_SPACE
::
A´Th»adWÜk”


29 
´iv©e
:

30 
	eTh»adCommªd


32 
eTC_STOP


35 
	gpublic
:

36 
MsCl›ÁD©aSessiÚHªdËr
(
SessiÚMªag”
* 
mªag”
, 
SYSUTILS_SPACE
::
A´TıSock‘
* 
sock‘
,

37 
SYSUTILS_SPACE
::
Ev’tBufãr
& 
bufãr
, 
ušt32_t
 
£ssiÚId
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
,

38 * 
pMsCl›Á
);

39 
	gvœtu®
 ~
MsCl›ÁD©aSessiÚHªdËr
();

41 
	g´Ùeùed
:

42 
vœtu®
 
G‘Tim”IÁ”v®
();

43 
vœtu®
 
OnR—dC®lback
();

44 
vœtu®
 
OnWr™eC®lback
();

45 
vœtu®
 
OnTim”C®lback
();

46 
vœtu®
 
OnSessiÚS¹
();

47 
vœtu®
 
OnSessiÚLo¡
();

49 
	gpublic
:

50 
vœtu®
 
HªdËS”v”D•’dReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
) = 0;

51 
vœtu®
 
HªdËS”v”D•’dRe¥Ú£
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
) = 0;

53 cÚ¡ 
MsCl›Á
* 
G‘MsCl›ÁRef
() const;

55 
	g´iv©e
:

56 
HªdËClo£D©aSessiÚRe¥Ú£
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
);

57 
HªdËD©aSessiÚStusReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
);

58 
HªdËRemÙeCÚŒŞReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
);

59 
HªdËC’Œ®izedUpg¿deReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, cÚ¡ 
¡d
::
¡ršg
& 
machšeTy³
,

60 cÚ¡ 
ušt32_t
& 
fœmw¬eSize
, cÚ¡ 
¡d
::
¡ršg
& 
cÚ‹Á
,

61 cÚ¡ 
ušt32_t
& 
£ssiÚID
, cÚ¡ ušt32_t& 
»que¡ID
);

62 
S’dR’ewReque¡
();

63 
boŞ
 
CheckFœmw¬eAndMachšeTy³
(cÚ¡ 
¡d
::
¡ršg
& 
fœmw¬eTy³
);

64 
boŞ
 
CheckFœmw¬eSize
(cÚ¡ 
ušt32_t
& 
fœmw¬eSize
);

66 
vœtu®
 
Th»adProc
();

68 
	g´iv©e
:

69 
MsCl›ÁD©aSessiÚHªdËr
(cÚ¡ MsCl›ÁD©aSessiÚHªdËr& 
rhs
);

70 
	gMsCl›ÁD©aSessiÚHªdËr
& 
	gİ”©Ü
=(cÚ¡ 
MsCl›ÁD©aSessiÚHªdËr
& 
rhs
);

72 
	g´iv©e
:

73 
št64_t
 
m_Ï¡_»cv_time
;

74 
št64_t
 
	gm_Ï¡_£nd_time
;

75 
	gSYSUTILS_SPACE
::
H‰pP¬£r
 
m_·r£r
;

76 
	gMsCl›Á
::
LoÿlS”v”Ty³
 
m_LoÿlS”v”Ty³
;

77 
MsCl›Á
 *
	gm_pMsCl›Á
;

79 
	gSYSUTILS_SPACE
::
Sem­hÜe
 
m_£mReque¡
;

81 
	g¡d
::
li¡
<
ušt32_t
> 
m_S‘Reque¡IDQueue
;

82 
	g¡d
::
li¡
<
SYSUTILS_SPACE
::
XMLT»e
> 
m_S‘Reque¡Queue
;

83 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_S‘Reque¡QueueCS
;

85 
	g¡d
::
li¡
<
SYSUTILS_SPACE
::
XMLT»e
> 
m_G‘Reque¡Queue
;

86 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_G‘Reque¡QueueCS
;

88 
ušt32_t
 
	gm_HªdËdReque¡ID
;

89 
Reque¡WÜk”
* 
	gm_S‘WÜk”
;

90 
Reque¡WÜk”
* 
	gm_G‘WÜk”
[
GET_WORKER_SIZE
];

92 
	g¡d
::
veùÜ
<
Upg¿deTh»ad
 *> 
m_vUpg¿deTh»ad
;

93 
ProduùInfo
 
	gm_ProduùInfo
;

	@../../titanutils/MsClient/Handler/MsClientEventSessionHandler.cpp

1 
	~"MsCl›ÁEv’tSessiÚHªdËr.h
"

3 
	~"­r/­r_ut™y.h
"

4 
	~"commÚ/sy¡em.h
"

5 
	~"commÚ/¡ršg.h
"

7 
	~"debugMsg/Debug.h
"

8 
	~"cÚ¡/S”v”PrÙocŞDefš™iÚ.h
"

10 
	~"PrÙocŞO³¿tiÚ/MsCl›ÁEv’tSessiÚP¬£r.h
"

11 
	~"PrÙocŞO³¿tiÚ/MsCl›ÁEv’tSessiÚG’”©e.h
"

13 #ià
defšed
(
__lšux__
)

14 
	~<sys/´ùl.h
>

17 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

22 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$MsCl›ÁEv’tSessiÚHªdËr
(
SessiÚMªag”
 *
mªag”
, 
A´TıSock‘
 *
sock‘
, 
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚId
, 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, *
pMsCl›Á
)

23 : 
	`SessiÚHªdËr
(
mªag”
, 
sock‘
, 
bufãr
, 
£ssiÚId
)

24 , 
	`m_Ï¡_»cv_time
(
	`G‘TimeCouÁMS
())

25 , 
	`m_Ï¡_£nd_time
(
	`G‘TimeCouÁMS
())

26 , 
	`m_·r£r
()

27 , 
	`m_LoÿlS”v”Ty³
(
loÿlS”v”Ty³
)

28 , 
	`m_pMsCl›Á
((
MsCl›Á
*)
pMsCl›Á
)

30 
	`C»©eTh»ad
();

31 
	}
}

33 
	gMsCl›ÁEv’tSessiÚHªdËr
::~
	$MsCl›ÁEv’tSessiÚHªdËr
()

35 ià(
	`Th»adExi¡s
())

37 
	`C®lWÜk”
(
MsCl›ÁEv’tSessiÚHªdËr
::
eTC_STOP
, 
NULL
);

38 
	`Clo£Th»ad
();

40 
	}
}

42 cÚ¡ 
MsCl›Á
* 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$G‘MsCl›ÁRef
() const

44  
m_pMsCl›Á
;

45 
	}
}

47 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$G‘Tim”IÁ”v®
()

49  
TIMER_CHECK_MANAGEMENT_SERVER_EVENT_SESSION
;

50 
	}
}

52 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$OnR—dC®lback
()

54 
m_Ï¡_»cv_time
 = 
	`G‘TimeCouÁMS
();

56 
Ev’tBufãr
 *
bufãr
 = 
	`G‘R—dBufãr
();

57 
	`IF_NULL_RETURN
(
bufãr
);

59 
bufãr
->
	`G‘L’gth
() != 0)

61 
m_·r£r
.
	`CÚsumeBufãr
(*
bufãr
);

63 ià(
m_·r£r
.
	`G‘S‹
().
»ad_¡©us
 =ğ
H‰pP¬£r
::
S‹
::
READING_DONE
)

66 ià(
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
() != "POST /api/management-server/event-session/KeepAlive HTTP/1.1")

68 
	`TRACE
("= MsClientEventSessionHandler::OnReadCallback ============\n");

69 
	`TRACE
("%s\n", 
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().
	`c_¡r
());

70 
	`TRACE
("[...skip header...]\n");

71 
	`TRACE
("%s\n", 
m_·r£r
.
	`G‘D©a
().
	`G‘Body
().
	`c_¡r
());

72 
	`TRACE
("================================================================\n");

76 
	`TRACE
("Get KeepAliveƒvent session\n");

79 
ušt32_t
 
£ssiÚID
 = 
	`¡r_to_u32
(
m_·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-SessionID"));

80 ià(
£ssiÚID
 !ğ
	`G‘SessiÚID
())

82 
	`TRACE
("SessiÚID‚Ù m©ch: LoÿÈSessiÚID = %u, SessiÚID = %u\n", 
	`G‘SessiÚID
(), 
£ssiÚID
);

86 
XMLT»e
 
Œ“
;

87 
	`LßdXMLT»eBufãr
(
m_·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

88 
¡d
::
¡ršg
 
roÙ_Çme
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
();

90 ià(
	`¡ºcmp
(
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().
	`c_¡r
(), "HTTP", 4) == 0)

93 ià(
roÙ_Çme
 == "CloseEventSession")

95 
	`HªdËClo£Ev’tSessiÚRe¥Ú£
(
Œ“
);

99 
	`HªdËS”v”D•’dRe¥Ú£
(
Œ“
);

102 ià(
	`¡ºcmp
(
m_·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().
	`c_¡r
(), "POST", 4) == 0)

105 ià(
roÙ_Çme
 == "KeepAlive")

107 
m_Ï¡_»cv_time
 = 
	`G‘TimeCouÁMS
();

109 ià(
roÙ_Çme
 == "EventClientSessionChanged")

111 
	`HªdËEv’tSessiÚChªge
(
Œ“
);

113 ià(
roÙ_Çme
 == "EventManagementServerTimeChanged")

115 
	`HªdËEv’tMªagem’tS”v”TimeChªged
(
Œ“
);

128 
	`HªdËS”v”D•’dReque¡
(
Œ“
);

135 
m_·r£r
.
	`Re£t
();

144 
	}
}

146 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$OnWr™eC®lback
()

148 
m_Ï¡_£nd_time
 = 
	`G‘TimeCouÁMS
();

150 
	}
}

152 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$OnTim”C®lback
()

155 ià(
	`G‘TimeCouÁMS
(è- 
m_Ï¡_£nd_time
 > 
S”v”PrÙocŞ
::
EVENT_SESSION_IDLE_INTERVAL
)

157 
	`S’dR’ewReque¡
();

161 ià(
	`G‘TimeCouÁMS
(è- 
m_Ï¡_»cv_time
 > 
S”v”PrÙocŞ
::
EVENT_SESSION_TIMEOUT
)

164 
	`OnSessiÚLo¡
();

165 
	`ASSERT
(0);

169 
	}
}

171 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$OnSessiÚS¹
()

175 
	}
}

177 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$OnSessiÚLo¡
()

179 
SessiÚMªag”
 *
mªag”
 = 
	`G‘SessiÚMªag”
();

180 
	`ASSERT
(
mªag”
 !ğ
NULL
);

181 ià(
mªag”
 !ğ
NULL
)

183 
mªag”
->
	`RemoveHªdËr
(
	`G‘SessiÚID
());

187 
	}
}

189 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËClo£Ev’tSessiÚRe¥Ú£
(
XMLT»e
& 
Œ“
)

191 
MsCl›ÁEv’tSessiÚ
::
Clo£Ev’tSessiÚRe¥Ú£
 
»¥Ú£
;

192 
»¥Ú£
.
£ssiÚ_id
 = 
	`¡r_to_u32
(
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessiÚID").
	`G‘CÚ‹Á
());

193 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("R‘uºCode").
	`G‘CÚ‹Á
());

195 ià(
»¥Ú£
.
»tuº_code
 !ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

197 
	`TRACE
("Clo£ Ev’ˆSessiÚ Fa,ƒ¼Øcodğ%u\n", 
»¥Ú£
.
»tuº_code
);

200 
	}
}

202 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$S’dR’ewReque¡
()

205 
MsCl›ÁEv’tSessiÚ
::
R’ewSessiÚReque¡
 
»que¡
;

206 
»que¡
.
£ssiÚ_id
 = 
	`G‘SessiÚID
();

207 
¡d
::
¡ršg
 
¡rReque¡
;

208 
MsCl›ÁEv’tSessiÚG’”©e
::
	`G’”©eR’ewEv’tSessiÚReque¡
(&
»que¡
, 
m_LoÿlS”v”Ty³
, 
¡rReque¡
);

212 
	`S’dD©a
(
¡rReque¡
);

214 
A´TıSock‘
* 
pSock‘
 = 
	`G‘Sock‘
();

215 ià(
pSock‘
 !ğ
NULL
)

217 
	`Wr™eSock‘UÁTimeout
(
pSock‘
, 
¡rReque¡
, 5000);

221 
	}
}

223 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tU£rChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

224 
MsCl›ÁEv’tSessiÚ
::
U£rChªgedReque¡
& 
»que¡
)

226 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

228 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

229 
XMLEËm’t
 
li¡
 = 
roÙ
.
	`G‘Chd
("UserIDList");

230 
¡d
::
veùÜ
<
XMLEËm’t
> 
vID
 = 
li¡
.
	`G‘Chd»n
("UserID");

231 
size_t
 
ui
 = 0; u˜< 
vID
.
	`size
(); ui++)

233 
MsCl›ÁEv’tSessiÚ
::
ChªgeI‹m
 
™em
;

234 
™em
.
chªge_ty³
 = 
SYSUTILS_SPACE
::
	`¡r_to_u32
(
vID
[
ui
].
	`G‘A‰ribu‹
("chªg‘y³").
	`G‘V®ue
());

235 
™em
.
chªge_id
 = 
vID
[
ui
];

236 
»que¡
.
vChªgeI‹m
.
	`push_back
(
™em
);

239 
»que¡
.
uÎTime
 = 
roÙ
.
	`G‘Chd
("Timestamp");

241 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

243 
	`TRACE
("error session is‚ot matched\n");

245 
	}
}

247 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tGroupChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

248 
MsCl›ÁEv’tSessiÚ
::
GroupChªgedReque¡
& 
»que¡
)

250 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

252 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

253 
XMLEËm’t
 
li¡
 = 
roÙ
.
	`G‘Chd
("GroupIDList");

254 
¡d
::
veùÜ
<
XMLEËm’t
> 
vID
 = 
li¡
.
	`G‘Chd»n
("GroupID");

255 
size_t
 
ui
 = 0; u˜< 
vID
.
	`size
(); ui++)

257 
MsCl›ÁEv’tSessiÚ
::
ChªgeI‹m
 
™em
;

258 
™em
.
chªge_ty³
 = 
SYSUTILS_SPACE
::
	`¡r_to_u32
(
vID
[
ui
].
	`G‘A‰ribu‹
("chªg‘y³").
	`G‘V®ue
());

259 
™em
.
chªge_id
 = 
vID
[
ui
];

260 
»que¡
.
vChªgeI‹m
.
	`push_back
(
™em
);

263 
»que¡
.
uÎTime
 = 
roÙ
.
	`G‘Chd
("Timestamp");

265 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

267 
	`TRACE
("error session is‚ot matched\n");

269 
	}
}

271 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tRŞeChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

272 
MsCl›ÁEv’tSessiÚ
::
RŞeChªgedReque¡
& 
»que¡
)

274 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

276 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

277 
XMLEËm’t
 
li¡
 = 
roÙ
.
	`G‘Chd
("RoleIDList");

278 
¡d
::
veùÜ
<
XMLEËm’t
> 
vID
 = 
li¡
.
	`G‘Chd»n
("RoleID");

279 
size_t
 
ui
 = 0; u˜< 
vID
.
	`size
(); ui++)

281 
MsCl›ÁEv’tSessiÚ
::
ChªgeI‹m
 
™em
;

282 
™em
.
chªge_ty³
 = 
SYSUTILS_SPACE
::
	`¡r_to_u32
(
vID
[
ui
].
	`G‘A‰ribu‹
("chªg‘y³").
	`G‘V®ue
());

283 
™em
.
chªge_id
 = 
vID
[
ui
];

284 
»que¡
.
vChªgeI‹m
.
	`push_back
(
™em
);

287 
»que¡
.
uÎTime
 = 
roÙ
.
	`G‘Chd
("Timestamp");

289 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

291 
	`TRACE
("error session is‚ot matched\n");

293 
	}
}

295 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tScheduËChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

296 
MsCl›ÁEv’tSessiÚ
::
ScheduËChªgedReque¡
& 
»que¡
)

298 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

300 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

301 
XMLEËm’t
 
li¡
 = 
roÙ
.
	`G‘Chd
("ScheduleIDList");

302 
¡d
::
veùÜ
<
XMLEËm’t
> 
vID
 = 
li¡
.
	`G‘Chd»n
("ScheduleID");

303 
size_t
 
ui
 = 0; u˜< 
vID
.
	`size
(); ui++)

305 
MsCl›ÁEv’tSessiÚ
::
ChªgeI‹m
 
™em
;

306 
™em
.
chªge_ty³
 = 
SYSUTILS_SPACE
::
	`¡r_to_u32
(
vID
[
ui
].
	`G‘A‰ribu‹
("chªg‘y³").
	`G‘V®ue
());

307 
™em
.
chªge_id
 = 
vID
[
ui
];

308 
»que¡
.
vChªgeI‹m
.
	`push_back
(
™em
);

311 
»que¡
.
uÎTime
 = 
roÙ
.
	`G‘Chd
("Timestamp");

312 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

314 
	`TRACE
("error session is‚ot matched\n");

316 
	}
}

318 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tF‹rProfeChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

319 
MsCl›ÁEv’tSessiÚ
::
F‹rProfeChªgedReque¡
& 
»que¡
)

321 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

323 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

324 
XMLEËm’t
 
li¡
 = 
roÙ
.
	`G‘Chd
("FilterProfileIDList");

325 
¡d
::
veùÜ
<
XMLEËm’t
> 
vID
 = 
li¡
.
	`G‘Chd»n
("FilterProfileID");

326 
size_t
 
ui
 = 0; u˜< 
vID
.
	`size
(); ui++)

328 
MsCl›ÁEv’tSessiÚ
::
ChªgeI‹m
 
™em
;

329 
™em
.
chªge_ty³
 = 
SYSUTILS_SPACE
::
	`¡r_to_u32
(
vID
[
ui
].
	`G‘A‰ribu‹
("chªg‘y³").
	`G‘V®ue
());

330 
™em
.
chªge_id
 = 
vID
[
ui
];

331 
»que¡
.
vChªgeI‹m
.
	`push_back
(
™em
);

334 
»que¡
.
uÎTime
 = 
roÙ
.
	`G‘Chd
("Timestamp");

336 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

338 
	`TRACE
("error session is‚ot matched\n");

340 
	}
}

342 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tAssocŸ‹Li¡Chªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

343 
MsCl›ÁEv’tSessiÚ
::
AssocŸ‹Li¡ChªgedReque¡
& 
»que¡
)

345 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

347 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

349 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

351 
	`TRACE
("error session is‚ot matched\n");

353 
	}
}

355 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tLiûn£Chªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

356 
MsCl›ÁEv’tSessiÚ
::
Liûn£ChªgedReque¡
& 
»que¡
)

358 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

360 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

362 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

364 
	`TRACE
("error session is‚ot matched\n");

366 
	}
}

368 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tRemÙeEv’tAùiÚChªged
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

369 
MsCl›ÁEv’tSessiÚ
::
RemÙeEv’tAùiÚChªgedReque¡
& 
»que¡
)

371 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

373 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

375 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

377 
	`TRACE
("error session is‚ot matched\n");

379 
»que¡
.
uÎTime
 = 
roÙ
.
	`G‘Chd
("Timestamp");

380 
	}
}

382 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tTrigg”RemÙeAùiÚ
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

383 
MsCl›ÁEv’tSessiÚ
::
Ev’tTrigg”RemÙeAùiÚ
& 
»que¡
)

385 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

387 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

389 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

391 
	`TRACE
("error session is‚ot matched\n");

393 
XMLEËm’t
 
xmlSourû
 = 
roÙ
.
	`G‘Chd
("SourceInfo");

394 
»que¡
.
SouûInfo
.
S”v”ID
 = 
xmlSourû
.
	`G‘Chd
("ServerID");

395 
»que¡
.
SouûInfo
.
DeviûID
 = 
xmlSourû
.
	`G‘Chd
("DeviceID");

396 
»que¡
.
SouûInfo
.
Ev’tID
 = 
xmlSourû
.
	`G‘Chd
("EventID");

397 
	}
}

399 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tCam”aRecÜdScheduËChªged
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

400 
MsCl›ÁEv’tSessiÚ
::
Cam”aRecÜdScheduËChªgedReque¡
& 
»que¡
)

402 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

404 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

406 ià(
»que¡
.
£ssiÚ_id
 !ğ
	`G‘SessiÚID
())

408 
	`TRACE
("error session is‚ot matched\n");

411 
XMLEËm’t
 
xeS”v”IDLi¡
 = 
roÙ
.
	`G‘Chd
("RecordingServerIDList");

412 
¡d
::
veùÜ
<
XMLEËm’t
> 
vID
 = 
xeS”v”IDLi¡
.
	`G‘Chd»n
("ID");

413 
size_t
 
ui
 = 0; u˜< 
vID
.
	`size
(); ui++)

415 
ušt64_t
 
l_£rv”_id
 = 
vID
[
ui
];

416 
»que¡
.
»cÜdšg_£rv”_id_li¡
.
	`push_back
(
l_£rv”_id
);

418 
	}
}

420 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tSessiÚChªge
(
XMLT»e
& 
Œ“
)

422 
MsCl›ÁEv’tSessiÚ
::
SessiÚChªgeReque¡
 
»que¡
;

423 
»que¡
.
£ssiÚ_id
 = 
	`¡r_to_u32
(
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessiÚID").
	`G‘CÚ‹Á
());

424 
XMLEËm’t
 
li¡RoÙ
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ClientSessionIDList");

425 
ušt32_t
 
li¡Size
 = 
li¡RoÙ
.
	`G‘ChdCouÁ
();

427 
ušt32_t
 
iSessiÚKey
;

428 
XMLEËm’t
 
£ssiÚI‹m
 = 
li¡RoÙ
.
	`G‘Chd
("ClientSessionID");

430 
¡d
::
veùÜ
<
ušt32_t
> 
addLi¡
;

431 
¡d
::
veùÜ
<
ušt32_t
> 
»moveLi¡
;

432 
¡d
::
veùÜ
<
ušt32_t
> 
modifyLi¡
;

434 
ušt32_t
 
i
 = 0; i < 
li¡Size
; i++)

436 
ušt32_t
 
chªgeTy³
 = 
	`¡r_to_u32
(
£ssiÚI‹m
.
	`G‘A‰ribu‹
("chªg‘y³").
	`G‘V®ue
());

437 
iSessiÚKey
 = 
	`¡r_to_u32
(
£ssiÚI‹m
.
	`G‘CÚ‹Á
());

438 ià(
chªgeTy³
 =ğ
S”v”PrÙocŞ
::
CHANGE_TYPE_ADD
)

440 
addLi¡
.
	`push_back
(
iSessiÚKey
);

442 ià(
chªgeTy³
 =ğ
S”v”PrÙocŞ
::
CHANGE_TYPE_REMOVE
)

444 
»moveLi¡
.
	`push_back
(
iSessiÚKey
);

446 ià(
chªgeTy³
 =ğ
S”v”PrÙocŞ
::
CHANGE_TYPE_MODIFY
)

448 
modifyLi¡
.
	`push_back
(
iSessiÚKey
);

452 
	`ASSERT
(0);

455 
£ssiÚI‹m
 = sessiÚI‹m.
	`G‘Next
();

459 ià(!
»moveLi¡
.
	`em±y
())

461 
	`HªdËS”v”SessiÚRemove
(
»moveLi¡
);

465 ià(!
modifyLi¡
.
	`em±y
())

467 
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚRe¥Ú£
 
ş›ÁSessiÚRe¥Ú£
;

468 ià(
m_pMsCl›Á
->
	`G‘Cl›ÁSessiÚ
(
modifyLi¡
, 
ş›ÁSessiÚRe¥Ú£
))

470 
	`HªdËS”v”SessiÚChªge
(
ş›ÁSessiÚRe¥Ú£
.
£ssiÚ_li¡
, 
S”v”PrÙocŞ
::
CHANGE_TYPE_MODIFY
);

474 
	`ASSERT
(0);

479 ià(!
addLi¡
.
	`em±y
())

481 
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚRe¥Ú£
 
ş›ÁSessiÚRe¥Ú£
;

482 ià(
m_pMsCl›Á
->
	`G‘Cl›ÁSessiÚ
(
addLi¡
, 
ş›ÁSessiÚRe¥Ú£
))

484 
	`HªdËS”v”SessiÚChªge
(
ş›ÁSessiÚRe¥Ú£
.
£ssiÚ_li¡
, 
S”v”PrÙocŞ
::
CHANGE_TYPE_ADD
);

488 
	`ASSERT
(0);

491 
	}
}

493 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$HªdËEv’tMªagem’tS”v”TimeChªged
(
XMLT»e
& 
Œ“
)

495 
m_pMsCl›Á
->
	`SyncS”v”Time
();

496 
	}
}

498 
	gMsCl›ÁEv’tSessiÚHªdËr
::
	$Th»adProc
()

500 #ià
	`defšed
(
__lšux__
)

501 
	`´ùl
(
PR_SET_NAME
, "MsClientEventsessionHandler", 0, 0, 0);

504 
Œue
)

509 ià(
	`G‘TimeCouÁMS
(è- 
m_Ï¡_£nd_time
 > 
S”v”PrÙocŞ
::
EVENT_SESSION_IDLE_INTERVAL
)

511 
	`S’dR’ewReque¡
();

512 
m_Ï¡_£nd_time
 = 
	`G‘TimeCouÁMS
();

518 
ušt32_t
 
uMes§ge
 = (ušt32_t)
eTC_STOP
;

519 ià(
	`CheckReque¡
(&
uMes§ge
))

521 (
Th»adCommªd
)
uMes§ge
)

523 
eTC_STOP
:

524 
	`R•ly
(0);

527 
	`R•ly
((
ušt32_t
)-1);

532 
	`SË•MS
(3000);

534 
	}
}

	@../../titanutils/MsClient/Handler/MsClientEventSessionHandler.h

1 #iâdeà
__MS_CLIENT_EVENT_SESSION_HANDLER_H__


2 
	#__MS_CLIENT_EVENT_SESSION_HANDLER_H__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"libev’t/­r_ev’t.h
"

6 
	~"libev’t/ev’t_tim”.h
"

7 
	~"libev’t/ev’t_bufãr.h
"

8 
	~"h‰p/h‰p_·r£r.h
"

9 
	~"sûw/xml_Œ“.h
"

10 
	~"­r/­r_th»ad_wÜk”.h
"

12 
	~"£rv”/SessiÚHªdËr.h
"

13 
	~"£rv”/SessiÚMªag”.h
"

15 
	~"MsCl›Á/MsCl›Á.h
"

16 
	~"cÚ¡/S”v”PrÙocŞDefš™iÚ.h
"

17 
	~"MsCl›Á/PrÙocŞDefše/MsCl›ÁEv’tSessiÚDefše.h
"

19 
şass
 
	gMsCl›ÁEv’tSessiÚHªdËr
: 
public
 
SessiÚHªdËr
, 
	gSYSUTILS_SPACE
::
A´Th»adWÜk”


21 
´iv©e
:

22 
	eTh»adCommªd


24 
eTC_STOP


27 
	gpublic
:

28 
MsCl›ÁEv’tSessiÚHªdËr
(
SessiÚMªag”
 *
mªag”
, 
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, SYSUTILS_SPACE::
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚId
, 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, *
pMsCl›Á
);

29 
	gvœtu®
 ~
MsCl›ÁEv’tSessiÚHªdËr
();

31 
	g´Ùeùed
:

32 
vœtu®
 
G‘Tim”IÁ”v®
();

33 
vœtu®
 
OnR—dC®lback
();

34 
vœtu®
 
OnWr™eC®lback
();

35 
vœtu®
 
OnTim”C®lback
();

36 
vœtu®
 
OnSessiÚS¹
();

37 
vœtu®
 
OnSessiÚLo¡
();

39 
vœtu®
 
HªdËS”v”D•’dReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
) = 0;

40 
vœtu®
 
HªdËS”v”D•’dRe¥Ú£
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
) = 0;

42 cÚ¡ 
MsCl›Á
* 
G‘MsCl›ÁRef
() const;

44 
vœtu®
 
HªdËS”v”SessiÚChªge
(cÚ¡ 
¡d
::
veùÜ
<
MsCl›ÁCommªd
::
¡SessiÚ
>& 
£ssiÚLi¡
, cÚ¡ 
S”v”PrÙocŞ
::
ChªgeTy³
& 
chªgeTy³
) = 0;

45 
vœtu®
 
HªdËS”v”SessiÚRemove
(cÚ¡ 
¡d
::
veùÜ
<
ušt32_t
>& 
£ssiÚLi¡
) = 0;

47 
HªdËEv’tU£rChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
MsCl›ÁEv’tSessiÚ
::
U£rChªgedReque¡
& 
»que¡
);

48 
HªdËEv’tGroupChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
MsCl›ÁEv’tSessiÚ
::
GroupChªgedReque¡
& 
»que¡
);

49 
HªdËEv’tRŞeChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
MsCl›ÁEv’tSessiÚ
::
RŞeChªgedReque¡
& 
»que¡
);

50 
HªdËEv’tScheduËChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
MsCl›ÁEv’tSessiÚ
::
ScheduËChªgedReque¡
& 
»que¡
);

51 
HªdËEv’tF‹rProfeChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

52 
MsCl›ÁEv’tSessiÚ
::
F‹rProfeChªgedReque¡
& 
»que¡
);

53 
HªdËEv’tAssocŸ‹Li¡Chªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

54 
MsCl›ÁEv’tSessiÚ
::
AssocŸ‹Li¡ChªgedReque¡
& 
»que¡
);

55 
HªdËEv’tLiûn£Chªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
MsCl›ÁEv’tSessiÚ
::
Liûn£ChªgedReque¡
& 
»que¡
);

56 
HªdËEv’tRemÙeEv’tAùiÚChªged
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
MsCl›ÁEv’tSessiÚ
::
RemÙeEv’tAùiÚChªgedReque¡
& 
»que¡
);

57 
HªdËEv’tTrigg”RemÙeAùiÚ
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
MsCl›ÁEv’tSessiÚ
::
Ev’tTrigg”RemÙeAùiÚ
& 
»que¡
);

58 
HªdËEv’tCam”aRecÜdScheduËChªged
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
MsCl›ÁEv’tSessiÚ
::
Cam”aRecÜdScheduËChªgedReque¡
& 
»que¡
);

60 
	g´iv©e
:

61 
HªdËClo£Ev’tSessiÚRe¥Ú£
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
);

62 
S’dR’ewReque¡
();

63 
HªdËEv’tSessiÚChªge
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
);

64 
HªdËEv’tMªagem’tS”v”TimeChªged
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
);

66 
vœtu®
 
Th»adProc
();

68 
	g´iv©e
:

69 
MsCl›ÁEv’tSessiÚHªdËr
(cÚ¡ MsCl›ÁEv’tSessiÚHªdËr& 
rhs
);

70 
	gMsCl›ÁEv’tSessiÚHªdËr
& 
	gİ”©Ü
=(cÚ¡ 
MsCl›ÁEv’tSessiÚHªdËr
& 
rhs
);

72 
	g´iv©e
:

73 
št64_t
 
m_Ï¡_»cv_time
;

74 
št64_t
 
	gm_Ï¡_£nd_time
;

75 
	gSYSUTILS_SPACE
::
H‰pP¬£r
 
m_·r£r
;

76 
	gMsCl›Á
::
LoÿlS”v”Ty³
 
m_LoÿlS”v”Ty³
;

77 
MsCl›Á
 *
	gm_pMsCl›Á
;

	@../../titanutils/MsClient/LoginCtrl/MSConfigManager.cpp

1 
	~"MSCÚfigMªag”.h
"

3 #ifdeà
WIN32


4 
	#SLASH
 "\\"

	)

6 
	#SLASH
 "/"

	)

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
	gCMSCÚfigMªag”
::
	$CMSCÚfigMªag”
(cÚ¡ 
¡d
::
¡ršg
& 
cÚfigRoÙP©h
)

12 : 
	`m_MSCÚfigU£r
(
NULL
)

13 , 
	`m_MSCÚfigGroup
(
NULL
)

14 , 
	`m_MSCÚfigRŞe
(
NULL
)

15 , 
	`m_MSCÚfigScheduË
(
NULL
)

16 , 
	`m_DeçuÉAcûssRightTabË
()

17 , 
	$m_cs
()

19 
m_MSCÚfigU£r
 = 
Ãw
 
	`CMSCÚfigU£r
(
cÚfigRoÙP©h
 + "u£rS‘tšg" + 
SLASH
);

20 
m_MSCÚfigGroup
 = 
Ãw
 
	`CMSCÚfigGroup
(
cÚfigRoÙP©h
 + "groupS‘tšg" + 
SLASH
);

21 
m_MSCÚfigRŞe
 = 
Ãw
 
	`CMSCÚfigRŞe
(
cÚfigRoÙP©h
 + "rŞeS‘tšg" + 
SLASH
);

22 
m_MSCÚfigScheduË
 = 
Ãw
 
	`CMSCÚfigScheduË
(
cÚfigRoÙP©h
 + "scheduËS‘tšg" + 
SLASH
);

24 ià(
m_MSCÚfigU£r
 =ğ
NULL
 || 
m_MSCÚfigGroup
 =ğNULL || 
m_MSCÚfigRŞe
 =ğNULL || 
m_MSCÚfigScheduË
 == NULL)

26 
	`TRACE
("Create Instance Error!!\n");

27 
	`R–—£
();

29 
	}
}

31 
	gCMSCÚfigMªag”
::~
	$CMSCÚfigMªag”
()

33 
	`R–—£
();

34 
	}
}

36 
	gCMSCÚfigMªag”
::
	$R–—£
()

38 ià(
m_MSCÚfigU£r
 !ğ
NULL
)

40 
d–‘e
 
m_MSCÚfigU£r
;

43 ià(
m_MSCÚfigGroup
 !ğ
NULL
)

45 
d–‘e
 
m_MSCÚfigGroup
;

48 ià(
m_MSCÚfigRŞe
 !ğ
NULL
)

50 
d–‘e
 
m_MSCÚfigRŞe
;

53 ià(
m_MSCÚfigScheduË
 !ğ
NULL
)

55 
d–‘e
 
m_MSCÚfigScheduË
;

57 
	}
}

59 
boŞ
 
	gCMSCÚfigMªag”
::
	$LßdS‘tšg
()

61 
lßdCÁ
 = 0;

63 ià(!
m_MSCÚfigU£r
->
	`P¬£D©a
())

65 
	`TRACE
("Load User Configuration File Error!!\n");

66 
lßdCÁ
++;

70 
	`TRACE
("Load User Configuration File OK!!\n");

73 ià(!
m_MSCÚfigGroup
->
	`P¬£D©a
())

75 
	`TRACE
("Load Group Configuration File Error!!\n");

76 
lßdCÁ
++;

80 
	`TRACE
("Load Group Configuration File OK!!\n");

83 ià(!
m_MSCÚfigRŞe
->
	`P¬£D©a
())

85 
	`TRACE
("Load Role Configuration File Error!!\n");

86 
lßdCÁ
++;

90 
	`TRACE
("Load Role Configuration File OK!!\n");

93 ià(!
m_MSCÚfigScheduË
->
	`P¬£D©a
())

95 
	`TRACE
("Load Schedule Configuration File Error!!\n");

96 
lßdCÁ
++;

100 
	`TRACE
("Load Schedule Configuration File OK!!\n");

103 ià(
lßdCÁ
 == 0)

105  
Œue
;

109  
çl£
;

111 
	}
}

113 
boŞ
 
	gCMSCÚfigMªag”
::
	$LßdSšgËRŞePrivege
(
ušt64_t
 
rŞeID
, 
¡RŞeD©a
& 
rŞeD©a
)

115  
m_MSCÚfigRŞe
->
	`G‘SšgËD©a
(
CMSCÚfigBa£
::
FIND_BY_ID
, 
rŞeID
, 
rŞeD©a
);

116 
	}
}

118 
št32_t
 
	gCMSCÚfigMªag”
::
	$G‘PrivegeLoÿtiÚ
(
ušt16_t
 
´ivegeTy³
, 
ušt32_t
 
b™Code
)

120 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

122 
¡d
::
veùÜ
<
¡AcûssRight
>::
™”©Ü
 
™
 = 
m_DeçuÉAcûssRightTabË
.
	`begš
();

123 
™
 !ğ
m_DeçuÉAcûssRightTabË
.
	`’d
(); it++)

125 ià(
™
->
ty³
 =ğ
´ivegeTy³
)

127 
ušt32_t
 
i
 = 0; i < 
™
->
b™Codes
.
	`size
(); i++)

129 ià(
™
->
b™Codes
[
i
] =ğ
b™Code
)

131  
i
;

138 
	}
}

140 
	g¡d
::
¡ršg
 
CMSCÚfigMªag”
::
	$G‘SessiÚU£rName
(
ušt64_t
 
u£rID
)

142 
¡U£rD©a
 
D©aInfo
;

143 
m_MSCÚfigU£r
->
	`G‘SšgËD©a
(
CMSCÚfigBa£
::
FIND_BY_ID
, 
u£rID
, 
D©aInfo
);

145  
D©aInfo
.
ba£I‹m
.
sName
;

146 
	}
}

148 
boŞ
 
	gCMSCÚfigMªag”
::
	$SyncCÚfigOÃU£r
(cÚ¡ 
¡U£rD©a
& 
u£rD©a
, 
ušt64_t
 
time¡amp
,

149 cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
)

151  
m_MSCÚfigU£r
->
	`MªuÏ‹D©a
(
u£rD©a
, 
bFÏg
, 
time¡amp
);

152 
	}
}

154 
boŞ
 
	gCMSCÚfigMªag”
::
SyncCÚfigU£rs
(cÚ¡ 
¡d
::
veùÜ
<
¡U£rD©a
>& 
u£rD©aLi¡
, 
ušt64_t
 
time¡amp
)

156 ià(
	gm_MSCÚfigU£r
->
SyncMSCÚfigU£r
(
u£rD©aLi¡
, 
time¡amp
))

158 
ušt32_t
 
	gi
 = 0; i < 
	gu£rD©aLi¡
.
size
(); i++)

160 
TRACE
("---Dump user----\n");

161 
TRACE
("u£¸id: %Îu\n", 
u£rD©aLi¡
[
i
].
ba£I‹m
.
uÎID
);

162 
TRACE
("u£¸Çme: %s\n", 
u£rD©aLi¡
[
i
].
ba£I‹m
.
sName
.
c_¡r
());

163 
TRACE
("u£¸rŞid: %Îu\n", 
u£rD©aLi¡
[
i
].
uÎRŞeID
);

164 
TRACE
("-------\n");

166  
	gŒue
;

170 
TRACE
("SyncMSConfigUser failed\n");

171  
	gçl£
;

175 
boŞ
 
	gCMSCÚfigMªag”
::
	$SyncCÚfigOÃGroup
(cÚ¡ 
¡GroupD©a
& 
groupD©a
, 
ušt64_t
 
time¡amp
,

176 cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
)

178  
m_MSCÚfigGroup
->
	`MªuÏ‹D©a
(
groupD©a
, 
bFÏg
, 
time¡amp
);

179 
	}
}

181 
boŞ
 
	gCMSCÚfigMªag”
::
SyncCÚfigGroups
(cÚ¡ 
¡d
::
veùÜ
<
¡GroupD©a
>& 
groupD©aLi¡
, 
ušt64_t
 
time¡amp
)

183 ià(
	gm_MSCÚfigGroup
->
SyncMSCÚfigGroup
(
groupD©aLi¡
, 
time¡amp
))

185 
ušt32_t
 
	gi
 = 0; i < 
	ggroupD©aLi¡
.
size
(); i++)

187 
TRACE
("---Dump Group----\n");

188 
TRACE
("grou°id: %Îu\n", 
groupD©aLi¡
[
i
].
ba£I‹m
.
uÎID
);

189 
TRACE
("grou°Çme: %s\n", 
groupD©aLi¡
[
i
].
ba£I‹m
.
sName
.
c_¡r
());

190 
TRACE
("grou°rŞid: %Îu\n", 
groupD©aLi¡
[
i
].
uÎRŞeID
);

191 
TRACE
("-------\n");

193  
	gŒue
;

197 
TRACE
("SyncMSConfigGroup failed\n");

198  
	gçl£
;

202 
boŞ
 
	gCMSCÚfigMªag”
::
	$SyncCÚfigOÃRŞe
(cÚ¡ 
¡RŞeD©a
& 
rŞeD©a
, 
ušt64_t
 
time¡amp
,

203 cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
)

205  
m_MSCÚfigRŞe
->
	`MªuÏ‹D©a
(
rŞeD©a
, 
bFÏg
, 
time¡amp
);

206 
	}
}

208 
boŞ
 
	gCMSCÚfigMªag”
::
SyncCÚfigRŞes
(cÚ¡ 
¡d
::
veùÜ
<
¡RŞeD©a
>& 
rŞeD©aLi¡
, 
ušt64_t
 
time¡amp
)

210 ià(
	gm_MSCÚfigRŞe
->
SyncMSCÚfigRŞe
(
rŞeD©aLi¡
, 
time¡amp
))

212 
ušt32_t
 
	gi
 = 0; i < 
	grŞeD©aLi¡
.
size
(); i++)

214 
TRACE
("---Dump Role----\n");

215 
TRACE
("rŞid: %Îu\n", 
rŞeD©aLi¡
[
i
].
ba£I‹m
.
uÎID
);

216 
TRACE
("rŞÇme: %s\n", 
rŞeD©aLi¡
[
i
].
ba£I‹m
.
sName
.
c_¡r
());

217 
TRACE
("-------\n");

220  
	gŒue
;

224 
TRACE
("SyncMSConfigRole failed\n");

225  
	gçl£
;

229 
boŞ
 
	gCMSCÚfigMªag”
::
	$SyncCÚfigOÃScheduË
(
CScheduËBa£
* 
scheduËD©a
, 
ušt64_t
 
time¡amp
,

230 cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
)

232  
m_MSCÚfigScheduË
->
	`MªuÏ‹D©a
(
scheduËD©a
, 
bFÏg
, 
time¡amp
);

233 
	}
}

235 
boŞ
 
	gCMSCÚfigMªag”
::
SyncCÚfigScheduËs
(cÚ¡ 
¡d
::
veùÜ
<
CScheduËBa£
*>& 
scheduËD©aLi¡
, 
ušt64_t
 
time¡amp
)

237 ià(
	gm_MSCÚfigScheduË
->
SyncMSCÚfigScheduË
(
scheduËD©aLi¡
, 
time¡amp
))

239 
ušt32_t
 
	gi
 = 0; i < 
	gscheduËD©aLi¡
.
size
(); i++)

241 
TRACE
("---Dump Schedule----\n");

242 
TRACE
("scheduË id: %Îu\n", 
scheduËD©aLi¡
[
i
]->
ba£I‹m
.
uÎID
);

243 
TRACE
("scheduË‚ame: %s\n", 
scheduËD©aLi¡
[
i
]->
ba£I‹m
.
sName
.
c_¡r
());

244 
TRACE
("-------\n");

247  
	gŒue
;

251 
TRACE
("SyncMSConfigSchedule failed\n");

252  
	gçl£
;

256 
	gCMSCÚfigMªag”
::
SyncAcûssRightTabË
(cÚ¡ 
¡d
::
veùÜ
<
¡AcûssRight
>& 
bË
)

258 
m_DeçuÉAcûssRightTabË
 = 
bË
;

261 
	gCMSCÚfigMªag”
::
	$G‘SšgËD©a
(
CMSCÚfigBa£
::
MS_DATA_FIND_METHOD
 
FšdTy³
, 
ušt64_t
 
uÎScheduËID
,

262 
CScheduËBa£
* &
scheduËBa£
)

264  
m_MSCÚfigScheduË
->
	`G‘SšgËD©a
(
FšdTy³
, 
uÎScheduËID
, 
scheduËBa£
);

265 
	}
}

	@../../titanutils/MsClient/LoginCtrl/MSConfigManager.h

1 #iâdeà
__MS_CONFIG_MANAGER_H__


2 
	#__MS_CONFIG_MANAGER_H__


	)

4 
	~"commÚ/¡dšt.h
"

7 
	~"SyncMSCÚfig/MSCÚfigU£r.h
"

8 
	~"SyncMSCÚfig/MSCÚfigGroup.h
"

9 
	~"SyncMSCÚfig/MSCÚfigRŞe.h
"

10 
	~"SyncMSCÚfig/MSCÚfigScheduË.h
"

12 şas 
	cCMSCÚfigMªag”


14 
	mpublic
:

15 
CMSCÚfigMªag”
(cÚ¡ 
¡d
::
¡ršg
& 
cÚfigRoÙP©h
);

16 ~
CMSCÚfigMªag”
();

18 
R–—£
();

19 
boŞ
 
LßdS‘tšg
();

21 
boŞ
 
LßdSšgËRŞePrivege
(
ušt64_t
 
rŞeID
, 
¡RŞeD©a
& 
rŞeD©a
);

23 
boŞ
 
SyncCÚfigOÃU£r
(cÚ¡ 
¡U£rD©a
& 
u£rD©a
, 
ušt64_t
 
time¡amp
,

24 cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
);

25 
boŞ
 
SyncCÚfigU£rs
(cÚ¡ 
¡d
::
veùÜ
<
¡U£rD©a
>& 
u£rD©aLi¡
, 
ušt64_t
 
time¡amp
);

27 
boŞ
 
SyncCÚfigOÃGroup
(cÚ¡ 
¡GroupD©a
& 
groupD©a
, 
ušt64_t
 
time¡amp
,

28 cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
);

29 
boŞ
 
SyncCÚfigGroups
(cÚ¡ 
¡d
::
veùÜ
<
¡GroupD©a
>& 
groupD©aLi¡
, 
ušt64_t
 
time¡amp
);

31 
boŞ
 
SyncCÚfigOÃRŞe
(cÚ¡ 
¡RŞeD©a
& 
rŞeD©a
, 
ušt64_t
 
time¡amp
,

32 cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
);

33 
boŞ
 
SyncCÚfigRŞes
(cÚ¡ 
¡d
::
veùÜ
<
¡RŞeD©a
>& 
rŞeD©aLi¡
, 
ušt64_t
 
time¡amp
);

35 
boŞ
 
SyncCÚfigOÃScheduË
(
CScheduËBa£
* 
scheduËD©a
, 
ušt64_t
 
time¡amp
,

36 cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
);

37 
boŞ
 
SyncCÚfigScheduËs
(cÚ¡ 
¡d
::
veùÜ
<
CScheduËBa£
*>& 
scheduËD©aLi¡
, 
ušt64_t
 
time¡amp
);

39 
SyncAcûssRightTabË
(cÚ¡ 
¡d
::
veùÜ
<
¡AcûssRight
>& 
bË
);

41 
št32_t
 
G‘PrivegeLoÿtiÚ
(
ušt16_t
 
´ivegeTy³
, 
ušt32_t
 
b™Code
);

42 
G‘SšgËD©a
(
CMSCÚfigBa£
::
MS_DATA_FIND_METHOD
 
FšdTy³
, 
ušt64_t
 
uÎScheduËID
, 
CScheduËBa£
* &
scheduËBa£
);

44 
	m¡d
::
¡ršg
 
G‘SessiÚU£rName
(
ušt64_t
 
u£rID
);

46 
	m´iv©e
:

47 
CMSCÚfigMªag”
(cÚ¡ CMSCÚfigMªag”& 
rhs
);

48 
	mCMSCÚfigMªag”
 &
	mİ”©Ü
=(cÚ¡ 
CMSCÚfigMªag”
& 
rhs
);

50 
	mpublic
:

51 
CMSCÚfigU£r
* 
m_MSCÚfigU£r
;

52 
CMSCÚfigGroup
* 
	mm_MSCÚfigGroup
;

53 
CMSCÚfigRŞe
* 
	mm_MSCÚfigRŞe
;

54 
CMSCÚfigScheduË
* 
	mm_MSCÚfigScheduË
;

56 
	m´iv©e
:

57 
¡d
::
veùÜ
<
¡AcûssRight
> 
m_DeçuÉAcûssRightTabË
;

59 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

	@../../titanutils/MsClient/LoginCtrl/SessionKeyCtrlMgr.cpp

1 
	~"SessiÚKeyCŒlMgr.h
"

3 
	~"MSCÚfigMªag”.h
"

5 
	~"âv/âv.h
"

7 
	~"T™ªCommÚ/CommÚDeviûIDDefše.h
"

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
	gCSessiÚKeyCÚŒŞMgr
::
	$CSessiÚKeyCÚŒŞMgr
(
CMSCÚfigMªag”
* 
cÚfigMªag”
)

12 : 
	`m_S”v”ID
(
	`UINT64_C
(0))

13 , 
	`m_MagicCl›ÁSessiÚID
(
	`UINT64_C
(0))

14 , 
	`m_MSCÚfigMªag”
(
cÚfigMªag”
)

15 , 
	`m_vBa£SessiÚTabË
()

16 , 
	`m_CSBa£SessiÚTabË
()

17 , 
	`m_vPrivegeSessiÚTabË
()

18 , 
	$m_CSPrivegeSessiÚTabË
()

20 
	}
}

22 
	gCSessiÚKeyCÚŒŞMgr
::~
	$CSessiÚKeyCÚŒŞMgr
()

24 
	}
}

26 
CSessiÚKeyCÚŒŞMgr
::
	$In™Ÿlize
(cÚ¡ 
ušt64_t
 
£rv”ID
)

28 
m_S”v”ID
 = 
£rv”ID
;

29 
m_MagicCl›ÁSessiÚID
 = 
	`âv_32a_buf
(&
m_S”v”ID
, (m_S”v”ID), 
FNV1_32A_INIT
);

30 
	}
}

32 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$CheckSessiÚKeyInCache
(
ušt32_t
 
£ssiÚKey
)

34 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

36 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`fšd
(
£ssiÚKey
);

38 
boŞ
 
»t
 = (
™
 !ğ
m_vBa£SessiÚTabË
.
	`’d
());

40 ià(
»t
)

42  
»t
;

46 ià(
£ssiÚKey
 =ğ
m_MagicCl›ÁSessiÚID
)

48 
	`TRACE
("Using magic client session ID!!\n");

49  
Œue
;

53  
çl£
;

56 
	}
}

58 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$CË¬SessiÚCache
()

61 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

63 
m_vBa£SessiÚTabË
.
	`ş—r
();

67 
Cr™iÿlSeùiÚLock
 
	`_´ivege
(&
m_CSPrivegeSessiÚTabË
);

69 
m_vPrivegeSessiÚTabË
.
	`ş—r
();

72  
Œue
;

73 
	}
}

75 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$AddCl›ÁSessiÚToCache
(cÚ¡ 
MsCl›ÁCommªd
::
¡SessiÚ
& 
ş›ÁSessiÚ
)

77 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

79 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`fšd
(
ş›ÁSessiÚ
.
£ssiÚ_id
);

81 ià(
™
 !ğ
m_vBa£SessiÚTabË
.
	`’d
())

83 
	`TRACE
("SessiÚ Key (%uè®»adyƒxi¡ š cache!!\n", 
ş›ÁSessiÚ
.
£ssiÚ_id
);

84  
çl£
;

87 
¡Ba£SessiÚTabËI‹m
 
™em
;

88 
™em
.
rŞeID
 = 
ş›ÁSessiÚ
.
rŞe_id
;

89 
™em
.
u£rID
 = 
ş›ÁSessiÚ
.
u£r_id
;

91 
m_vBa£SessiÚTabË
[
ş›ÁSessiÚ
.
£ssiÚ_id
] = 
™em
;

93  
	`AddRŞePrivegeToSessiÚTabË
(
ş›ÁSessiÚ
.
rŞe_id
);

94 
	}
}

96 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
AddCl›ÁSessiÚLi¡ToCache
(cÚ¡ 
¡d
::
veùÜ
<
MsCl›ÁCommªd
::
¡SessiÚ
>& 
ş›ÁSessiÚLi¡
)

98 
Cr™iÿlSeùiÚLock
 
_basic
(&
m_CSBa£SessiÚTabË
);

100 
boŞ
 
	gbR‘
 = 
Œue
;

102 
ušt32_t
 
	gi
 = 0; i < 
	gş›ÁSessiÚLi¡
.
size
(); i++)

104 
	gbR‘
 = 
AddCl›ÁSessiÚToCache
(
ş›ÁSessiÚLi¡
[
i
]è&& 
bR‘
;

107  
	gbR‘
;

110 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$D–‘eCl›ÁSessiÚFromCache
(
ušt32_t
 
£ssiÚKey
)

112 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

114 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`fšd
(
£ssiÚKey
);

116 ià(
™
 =ğ
m_vBa£SessiÚTabË
.
	`’d
())

118 
	`TRACE
("SessiÚ Key (%uèdÛ¢'ˆexi¡ iÀÿche!!\n", 
£ssiÚKey
);

119  
çl£
;

122 
ušt64_t
 
rŞeID
 = 
™
->
£cÚd
.roleID;

123 
	`ASSERT2
(0, "D–‘eCl›ÁSessiÚFromCach[%u]„ŞID [%Îu]\n", 
£ssiÚKey
, 
rŞeID
);

124 
m_vBa£SessiÚTabË
.
	`”a£
(
™
);

126  
	`D–‘eRŞePrivegeFromSessiÚTabË
(
rŞeID
);

127 
	}
}

129 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
D–‘eCl›ÁSessiÚLi¡FromCache
(cÚ¡ 
¡d
::
veùÜ
<
ušt32_t
>& 
£ssiÚLi¡
)

131 
Cr™iÿlSeùiÚLock
 
_basic
(&
m_CSBa£SessiÚTabË
);

133 
boŞ
 
	gbR‘
 = 
Œue
;

135 
ušt32_t
 
	gi
 = 0; i < 
	g£ssiÚLi¡
.
size
(); i++)

137 
	gbR‘
 = 
D–‘eCl›ÁSessiÚFromCache
(
£ssiÚLi¡
[
i
]è&& 
bR‘
;

140  
	gbR‘
;

143 
	gCSessiÚKeyCÚŒŞMgr
::
	$ModifyCl›ÁSessiÚInCache
(
ušt32_t
 
£ssiÚKey
, 
ušt64_t
 
u£rID
, ušt64_ˆ
rŞeID
)

145 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

147 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`fšd
(
£ssiÚKey
);

149 ià(
™
 =ğ
m_vBa£SessiÚTabË
.
	`’d
())

151 
	`TRACE
("SessiÚ Key (%uèdÛ¢'ˆexi¡ iÀÿche!!\n", 
£ssiÚKey
);

155 
ušt64_t
 
ŞdU£rID
 = 
™
->
£cÚd
.
u£rID
;

156 
ušt64_t
 
ŞdRŞeID
 = 
™
->
£cÚd
.
rŞeID
;

158 ià(
ŞdU£rID
 !ğ
u£rID
)

160 
™
->
£cÚd
.
u£rID
 = userID;

165 ià(
ŞdRŞeID
 !ğ
rŞeID
)

167 
™
->
£cÚd
.
rŞeID
 =„oleID;

170 
	`D–‘eRŞePrivegeFromSessiÚTabË
(
ŞdRŞeID
);

171 
	`AddRŞePrivegeToSessiÚTabË
(
rŞeID
);

176 
	`ModifyRŞePrivegeInSessiÚTabË
(
rŞeID
);

178 
	}
}

180 
	gCSessiÚKeyCÚŒŞMgr
::
	$RŞeD©aToPrivegeI‹m
(
ušt64_t
 
£rv”ID
, cÚ¡ 
¡RŞeD©a
& 
rŞeD©a
, 
¡PrivegeSessiÚTabËI‹m
& 
™em
)

182 
™em
.
bAutoCÚÃùM©rixS”v”
 = 
rŞeD©a
.bAutoConnectMatrixServer;

183 
™em
.
iPriÜ™yM©rix
 = 
rŞeD©a
.iPriorityMatrix;

184 
™em
.
iPriÜ™yPTZ
 = 
rŞeD©a
.iPriorityPTZ;

185 
™em
.
iPriÜ™yT®k
 = 
rŞeD©a
.iPriorityTalk;

186 
™em
.
iPriÜ™yV›w
 = 
rŞeD©a
.iPriorityView;

187 
™em
.
vDeçuÉInfo
 = 
rŞeD©a
.vDefaultInfo;

188 
™em
.
uÎDeçuÉV›wProfeId
 = 
rŞeD©a
.ullDefaultViewProfileId;

189 
™em
.
uÎPÏybackTimeLim™
 = 
rŞeD©a
.ullPlaybackTimeLimit;

190 
™em
.
sG’”®I‹mAcûssB™SŒ—m
 = 
rŞeD©a
.sGeneralItemAccessBitStream;

192 
™em
.
£rv”Info
.
vDevPrivegeD©a
.
	`ş—r
();

193 
ušt32_t
 
i
 = 0; i < 
rŞeD©a
.
vS”v”Info
.
	`size
(); i++)

195 ià(
£rv”ID
 =ğ
rŞeD©a
.
vS”v”Info
[
i
].
uÎS”v”Id
)

197 
™em
.
£rv”Info
 = 
rŞeD©a
.
vS”v”Info
[
i
];

201 
	}
}

203 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$PrivegeChªge
(
ušt64_t
 
rŞeID
)

205 
¡RŞeD©a
 
rŞeD©a
;

206 ià(!
m_MSCÚfigMªag”
->
	`LßdSšgËRŞePrivege
(
rŞeID
, 
rŞeD©a
))

208 
	`TRACE
("Cª'ˆg‘„Ş(%Îuèäom MSCÚfigMªag”\n", 
rŞeID
);

209  
çl£
;

212 
Cr™iÿlSeùiÚLock
 
	`_´ivege
(&
m_CSPrivegeSessiÚTabË
);

214 
¡d
::
m­
<
ušt64_t
, 
¡PrivegeSessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vPrivegeSessiÚTabË
.
	`fšd
(
rŞeID
);

216 ià(
™
 =ğ
m_vPrivegeSessiÚTabË
.
	`’d
())

218 
	`TRACE
("DeçuÉ…rivegÔŞeID = %ÎuèdÛ¢'ˆexi¡ iÀÿche!!\n", 
rŞeID
);

219  
çl£
;

222 
	`RŞeD©aToPrivegeI‹m
(
m_S”v”ID
, 
rŞeD©a
, 
™
->
£cÚd
);

224  
Œue
;

225 
	}
}

227 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$AddRŞePrivegeToSessiÚTabË
(
ušt64_t
 
rŞeID
)

229 
Cr™iÿlSeùiÚLock
 
	`_´ivege
(&
m_CSPrivegeSessiÚTabË
);

231 
¡d
::
m­
<
ušt64_t
, 
¡PrivegeSessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vPrivegeSessiÚTabË
.
	`fšd
(
rŞeID
);

233 ià(
™
 !ğ
m_vPrivegeSessiÚTabË
.
	`’d
())

235 
™
->
£cÚd
.
»fCÁ
++;

236  
Œue
;

239 
¡RŞeD©a
 
rŞeD©a
;

240 ià(!
m_MSCÚfigMªag”
->
	`LßdSšgËRŞePrivege
(
rŞeID
, 
rŞeD©a
))

242 
	`TRACE
("Cª'ˆg‘„Ş(%Îuèäom MSCÚfigMªag”\n", 
rŞeID
);

243  
çl£
;

246 
¡PrivegeSessiÚTabËI‹m
 
™em
;

248 
	`RŞeD©aToPrivegeI‹m
(
m_S”v”ID
, 
rŞeD©a
, 
™em
);

249 
™em
.
»fCÁ
 = 1;

251 
m_vPrivegeSessiÚTabË
[
rŞeID
] = 
™em
;

253  
Œue
;

254 
	}
}

256 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$ModifyRŞePrivegeInSessiÚTabË
(
ušt64_t
 
rŞeID
)

258 
Cr™iÿlSeùiÚLock
 
	`_´ivege
(&
m_CSPrivegeSessiÚTabË
);

260 
¡d
::
m­
<
ušt64_t
, 
¡PrivegeSessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vPrivegeSessiÚTabË
.
	`fšd
(
rŞeID
);

262 ià(
™
 =ğ
m_vPrivegeSessiÚTabË
.
	`’d
())

264  
çl£
;

267 
¡RŞeD©a
 
rŞeD©a
;

268 ià(!
m_MSCÚfigMªag”
->
	`LßdSšgËRŞePrivege
(
rŞeID
, 
rŞeD©a
))

270 
	`TRACE
("Cª'ˆg‘„Ş(%Îuèäom MSCÚfigMªag”\n", 
rŞeID
);

271  
çl£
;

274 
	`RŞeD©aToPrivegeI‹m
(
m_S”v”ID
, 
rŞeD©a
, 
™
->
£cÚd
);

276  
Œue
;

277 
	}
}

279 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$D–‘eRŞePrivegeFromSessiÚTabË
(
ušt64_t
 
rŞeID
)

281 
Cr™iÿlSeùiÚLock
 
	`_´ivege
(&
m_CSPrivegeSessiÚTabË
);

283 
¡d
::
m­
<
ušt64_t
, 
¡PrivegeSessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vPrivegeSessiÚTabË
.
	`fšd
(
rŞeID
);

285 ià(
™
 =ğ
m_vPrivegeSessiÚTabË
.
	`’d
())

287 
	`TRACE
("DeçuÉ…rivegÔŞeID = %ÎuèdÛ¢'ˆexi¡ iÀÿche!!\n", 
rŞeID
);

288  
çl£
;

291 ià(
™
->
£cÚd
.
»fCÁ
 <= 1)

293 
m_vPrivegeSessiÚTabË
.
	`”a£
(
™
);

297 
™
->
£cÚd
.
»fCÁ
--;

300  
Œue
;

301 
	}
}

303 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$G‘PrivegeI‹m
(
ušt32_t
 
£ssiÚKey
, 
¡PrivegeSessiÚTabËI‹m
& 
rŞeI‹m
)

305 
ušt64_t
 
rŞeID
 = 
	`UINT64_C
(0);

307 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

309 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`fšd
(
£ssiÚKey
);

311 ià(
™
 =ğ
m_vBa£SessiÚTabË
.
	`’d
())

313 
	`TRACE
("SessiÚ Key (%uèdÛ¢'ˆexi¡ iÀÿche!!\n", 
£ssiÚKey
);

314  
çl£
;

317 
rŞeID
 = 
™
->
£cÚd
.roleID;

320 
Cr™iÿlSeùiÚLock
 
	`_´ivege
(&
m_CSPrivegeSessiÚTabË
);

322 
¡d
::
m­
<
ušt64_t
, 
¡PrivegeSessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vPrivegeSessiÚTabË
.
	`fšd
(
rŞeID
);

324 ià(
™
 =ğ
m_vPrivegeSessiÚTabË
.
	`’d
())

326 
	`TRACE
("DeçuÉ…rivegÔŞeID = %ÎuèdÛ¢'ˆexi¡ iÀÿche!!\n", 
rŞeID
);

328  
çl£
;

331 
rŞeI‹m
 = 
™
->
£cÚd
;

333  
Œue
;

334 
	}
}

336 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$G‘PrivegeI‹mFÜOth”S”v”
(
ušt32_t
 
£ssiÚKey
, 
ušt64_t
 
£rv”ID
, 
¡PrivegeSessiÚTabËI‹m
& 
rŞeI‹m
)

338 
ušt64_t
 
rŞeID
 = 
	`UINT64_C
(0);

340 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

342 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`fšd
(
£ssiÚKey
);

344 ià(
™
 =ğ
m_vBa£SessiÚTabË
.
	`’d
())

346 
	`TRACE
("SessiÚ Key (%uèdÛ¢'ˆexi¡ iÀÿche!!\n", 
£ssiÚKey
);

347  
çl£
;

350 
rŞeID
 = 
™
->
£cÚd
.roleID;

353 
¡RŞeD©a
 
rŞeD©a
;

354 ià(!
m_MSCÚfigMªag”
->
	`LßdSšgËRŞePrivege
(
rŞeID
, 
rŞeD©a
))

356 
	`TRACE
("Cª'ˆg‘„Ş(%Îuèäom MSCÚfigMªag”\n", 
rŞeID
);

357  
çl£
;

360 
	`RŞeD©aToPrivegeI‹m
(
£rv”ID
, 
rŞeD©a
, 
rŞeI‹m
);

362  
Œue
;

363 
	}
}

365 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$G‘PrivegePriÜ™y
(
ušt32_t
 
£ssiÚKey
, 
ePrivegePriÜ™yTy³
 
ty³
, ušt32_ˆ&
iV®ue
)

367 
¡PrivegeSessiÚTabËI‹m
 
rŞeI‹m
;

368 ià(!
	`G‘PrivegeI‹m
(
£ssiÚKey
, 
rŞeI‹m
))

370  
çl£
;

372 
boŞ
 
bR‘
 = 
çl£
;

373 
ty³
)

375 
ePriÜ™yPTZ
:

376 
iV®ue
 = 
rŞeI‹m
.
iPriÜ™yPTZ
;

377 
bR‘
 = 
Œue
;

379 
ePriÜ™yT®k
:

380 
iV®ue
 = 
rŞeI‹m
.
iPriÜ™yT®k
;

381 
bR‘
 = 
Œue
;

383 
ePriÜ™yM©rix
:

384 
iV®ue
 = 
rŞeI‹m
.
iPriÜ™yM©rix
;

385 
bR‘
 = 
Œue
;

387 
ePriÜ™yV›w
:

388 
iV®ue
 = 
rŞeI‹m
.
iPriÜ™yV›w
;

389 
bR‘
 = 
Œue
;

392 
bR‘
 = 
çl£
;

394  
bR‘
;

395 
	}
}

397 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$HasG’”®Privege
(
ušt32_t
 
£ssiÚKey
, ušt32_ˆ
b™Code
)

399 
¡PrivegeSessiÚTabËI‹m
 
rŞeI‹m
;

400 ià(!
	`G‘PrivegeI‹m
(
£ssiÚKey
, 
rŞeI‹m
))

402  
çl£
;

405 
ušt16_t
 
g’”®PrivegeTy³
 = 1;

406 
št32_t
 
loÿtiÚ
 = 
m_MSCÚfigMªag”
->
	`G‘PrivegeLoÿtiÚ
(
g’”®PrivegeTy³
, 
b™Code
);

408 ià(
loÿtiÚ
 == -1)

410  
çl£
;

413 ià(
loÿtiÚ
 >ğ(
št32_t
)
rŞeI‹m
.
sG’”®I‹mAcûssB™SŒ—m
.
	`Ëngth
())

415  
çl£
;

419  (
rŞeI‹m
.
sG’”®I‹mAcûssB™SŒ—m
.
	`©
(
loÿtiÚ
) == '1');

422  
çl£
;

423 
	}
}

425 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$CheckDeviûPrivege
(
ušt64_t
 
deviûID
, 
ušt16_t
 
´ivegeTy³
, 
ušt32_t
 
b™Code
, 
¡PrivegeSessiÚTabËI‹m
& 
rŞeI‹m
)

427 
št32_t
 
loÿtiÚ
 = 
m_MSCÚfigMªag”
->
	`G‘PrivegeLoÿtiÚ
(
´ivegeTy³
, 
b™Code
);

429 ià(
loÿtiÚ
 == -1)

431  
çl£
;

434 
¡d
::
veùÜ
<
¡DevPrivege
>::
™”©Ü
 
™
 = 
rŞeI‹m
.
£rv”Info
.
vDevPrivegeD©a
.
	`begš
();

435 
™
 !ğ
rŞeI‹m
.
£rv”Info
.
vDevPrivegeD©a
.
	`’d
(); it++)

437 ià(
™
->
uÎDevId
 =ğ
deviûID
)

439 
	`TRACE
("deviû ID %Îu ha ™ Úly…riveg£‰šg!!\n", 
deviûID
);

440 ià(
loÿtiÚ
 >ğ(
št32_t
)
™
->
sDevPrivegeV®
.
	`Ëngth
())

442 
	`ASSERT
(0);

443  
çl£
;

447  (
™
->
sDevPrivegeV®
.
	`©
(
loÿtiÚ
) == '1');

452 
ušt16_t
 
™emTy³
 = 
	`GET_ITEM_TYPE_ID
(
deviûID
);

454 
¡d
::
veùÜ
<
¡DeçuÉDevAcûssB™SŒ—m
>::
™”©Ü
 
™
 = 
rŞeI‹m
.
vDeçuÉInfo
.
	`begš
();

455 
™
 !ğ
rŞeI‹m
.
vDeçuÉInfo
.
	`’d
(); it++)

457 ià(
™
->
usTy³
 =ğ
™emTy³
)

460 ià(
loÿtiÚ
 >ğ(
št32_t
)
™
->
sDevPrivegeV®
.
	`Ëngth
())

462 
	`ASSERT
(0);

463  
çl£
;

467  (
™
->
sDevPrivegeV®
.
	`©
(
loÿtiÚ
) == '1');

472 
	`TRACE
("Cant' find specific & default…rivilege setting!!\n");

473  
çl£
;

474 
	}
}

476 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$HasDeviûPrivege
(
ušt32_t
 
£ssiÚKey
, 
ušt64_t
 
deviûID
, 
ušt16_t
 
´ivegeTy³
,

477 
ušt32_t
 
b™Code
)

479 
¡PrivegeSessiÚTabËI‹m
 
rŞeI‹m
;

480 ià(!
	`G‘PrivegeI‹m
(
£ssiÚKey
, 
rŞeI‹m
))

482  
çl£
;

485  
	`CheckDeviûPrivege
(
deviûID
, 
´ivegeTy³
, 
b™Code
, 
rŞeI‹m
);

486 
	}
}

488 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$HasDeviûPrivegeFÜOth”S”v”
(
ušt32_t
 
£ssiÚKey
, 
ušt64_t
 
£rv”ID
, ušt64_ˆ
deviûID
, 
ušt16_t
 
´ivegeTy³
,

489 
ušt32_t
 
b™Code
)

491 ià(
£rv”ID
 =ğ
m_S”v”ID
)

493  
	`HasDeviûPrivege
(
£ssiÚKey
, 
deviûID
, 
´ivegeTy³
, 
b™Code
);

496 
¡PrivegeSessiÚTabËI‹m
 
rŞeI‹m
;

497 ià(!
	`G‘PrivegeI‹mFÜOth”S”v”
(
£ssiÚKey
, 
£rv”ID
, 
rŞeI‹m
))

499  
çl£
;

502  
	`CheckDeviûPrivege
(
deviûID
, 
´ivegeTy³
, 
b™Code
, 
rŞeI‹m
);

503 
	}
}

505 
	gCSessiÚKeyCÚŒŞMgr
::
	$DumpCache
()

508 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

510 ià(
m_vBa£SessiÚTabË
.
	`em±y
())

512 
	`TRACE
("m_vBaseSessionTableƒmpty!!\n");

516 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`begš
(); iˆ!ğm_vBa£SessiÚTabË.
	`’d
(); it++)

518 
	`TRACE
("SK = %u, U£rID = %Îu, RŞeID = %Îu\n", 
™
->
fœ¡
, it->
£cÚd
.
u£rID
, it->£cÚd.
rŞeID
);

524 
Cr™iÿlSeùiÚLock
 
	`_´ivege
(&
m_CSPrivegeSessiÚTabË
);

526 ià(
m_vPrivegeSessiÚTabË
.
	`em±y
())

528 
	`TRACE
("m_vPrivilegeSessionTableƒmpty!!\n");

532 
¡d
::
m­
<
ušt64_t
, 
¡PrivegeSessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vPrivegeSessiÚTabË
.
	`begš
(); iˆ!ğm_vPrivegeSessiÚTabË.
	`’d
(); it++)

534 
	`TRACE
("RŞeID = %Îu, RefCÁ = %u\n", 
™
->
fœ¡
, it->
£cÚd
.
»fCÁ
);

538 
	}
}

540 
ušt64_t
 
	gCSessiÚKeyCÚŒŞMgr
::
	$G‘U£rIDBySessiÚID
(
ušt64_t
 
£ssiÚID
)

542 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

544 ià(
m_vBa£SessiÚTabË
.
	`em±y
())

550 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`begš
(); iˆ!ğm_vBa£SessiÚTabË.
	`’d
(); it++)

552 ià(
™
->
fœ¡
 =ğ
£ssiÚID
)

554  
™
->
£cÚd
.
u£rID
;

559 
	}
}

561 
	gCSessiÚKeyCÚŒŞMgr
::
	$DumpInfo
(
¡d
::
¡ršg
& 
¡rInfo
)

563 
¡rInfo
 = "";

566 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

568 ià(
m_vBa£SessiÚTabË
.
	`em±y
())

570 
¡rInfo
 = "m_vBaseSessionTableƒmpty!!\n";

574 
¡d
::
m­
<
ušt32_t
, 
¡Ba£SessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vBa£SessiÚTabË
.
	`begš
(); iˆ!ğm_vBa£SessiÚTabË.
	`’d
(); it++)

576 
¡d
::
¡ršg
 
¡rTemp
 = 
SYSUTILS_SPACE
::
	`¡ršg_fÜm©
("SK = %u, U£rID = %Îu, RŞeID = %Îu\n", 
™
->
fœ¡
, it->
£cÚd
.
u£rID
, it->£cÚd.
rŞeID
);

577 
¡rInfo
.
	`­³nd
(
¡rTemp
);

583 
Cr™iÿlSeùiÚLock
 
	`_´ivege
(&
m_CSPrivegeSessiÚTabË
);

585 ià(
m_vPrivegeSessiÚTabË
.
	`em±y
())

587 
¡rInfo
.
	`­³nd
("m_vPrivilegeSessionTableƒmpty!!\n");

591 
¡d
::
m­
<
ušt64_t
, 
¡PrivegeSessiÚTabËI‹m
>::
™”©Ü
 
™
 = 
m_vPrivegeSessiÚTabË
.
	`begš
(); iˆ!ğm_vPrivegeSessiÚTabË.
	`’d
(); it++)

593 
¡d
::
¡ršg
 
¡rTemp
 = 
SYSUTILS_SPACE
::
	`¡ršg_fÜm©
("RŞeID = %Îu, RefCÁ = %u\n", 
™
->
fœ¡
, it->
£cÚd
.
»fCÁ
);

594 
¡rInfo
.
	`­³nd
(
¡rTemp
);

598 
	}
}

600 
boŞ
 
	gCSessiÚKeyCÚŒŞMgr
::
	$IsSessiÚCacheEm±y
()

602 
Cr™iÿlSeùiÚLock
 
	`_basic
(&
m_CSBa£SessiÚTabË
);

604  (0 =ğ
m_vBa£SessiÚTabË
.
	`size
(è? 
Œue
 : 
çl£
);

605 
	}
}

	@../../titanutils/MsClient/LoginCtrl/SessionKeyCtrlMgr.h

1 #iâdeà
__SESSION_KEY_CTRL_MGR_H__


2 
	#__SESSION_KEY_CTRL_MGR_H__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

7 
	~"th»ad_objeù/agg»g©e_tim”.h
"

9 
	~"debugMsg/Debug.h
"

11 
	~"MsCl›Á/PrÙocŞDefše/MsCl›ÁCommªdDefše.h
"

13 
şass
 
	gCMSCÚfigMªag”
;

15 şas 
	cCSessiÚKeyCÚŒŞMgr


17 
	mpublic
:

18 
	eePrivegePriÜ™yTy³


20 
ePriÜ™yPTZ
 = 0,

21 
	mePriÜ™yT®k
,

22 
	mePriÜ™yV›w
,

23 
	mePriÜ™yM©rix


25 
	s¡Ba£SessiÚTabËI‹m


28 
ušt64_t
 
	gu£rID
;

29 
ušt64_t
 
	grŞeID
;

32 
	s¡PrivegeSessiÚTabËI‹m


35 
boŞ
 
	gbAutoCÚÃùM©rixS”v”
;

36 
ušt64_t
 
	guÎDeçuÉV›wProfeId
;

37 
ušt32_t
 
	giPriÜ™yPTZ
;

38 
ušt32_t
 
	giPriÜ™yT®k
;

39 
ušt32_t
 
	giPriÜ™yV›w
;

40 
ušt32_t
 
	giPriÜ™yM©rix
;

41 
ušt64_t
 
	guÎPÏybackTimeLim™
;

42 
	g¡d
::
¡ršg
 
sG’”®I‹mAcûssB™SŒ—m
;

43 
	g¡d
::
veùÜ
<
¡DeçuÉDevAcûssB™SŒ—m
> 
vDeçuÉInfo
;

44 
¡S”v”InRŞe
 
	g£rv”Info
;

46 
ušt32_t
 
	g»fCÁ
;

48 
	g¡PrivegeSessiÚTabËI‹m
 &
	gİ”©Ü
=(cÚ¡ 
¡PrivegeSessiÚTabËI‹m
& 
rhs
)

50 
bAutoCÚÃùM©rixS”v”
 = 
rhs
.bAutoConnectMatrixServer;

51 
	guÎDeçuÉV›wProfeId
 = 
rhs
.
uÎDeçuÉV›wProfeId
;

52 
	giPriÜ™yPTZ
 = 
rhs
.
iPriÜ™yPTZ
;

53 
	giPriÜ™yV›w
 = 
rhs
.
iPriÜ™yV›w
;

54 
	giPriÜ™yM©rix
 = 
rhs
.
iPriÜ™yM©rix
;

55 
	guÎPÏybackTimeLim™
 = 
rhs
.
uÎPÏybackTimeLim™
;

56 
	gsG’”®I‹mAcûssB™SŒ—m
 = 
rhs
.
sG’”®I‹mAcûssB™SŒ—m
;

57 
	gvDeçuÉInfo
 = 
rhs
.
vDeçuÉInfo
;

58 
	g£rv”Info
 = 
rhs
.
£rv”Info
;

60 
	g»fCÁ
 = 
rhs
.
»fCÁ
;

62  *
	gthis
;

66 
	gpublic
:

67 
CSessiÚKeyCÚŒŞMgr
(
CMSCÚfigMªag”
* 
cÚfigMªag”
);

68 ~
CSessiÚKeyCÚŒŞMgr
();

70 
In™Ÿlize
(cÚ¡ 
ušt64_t
 
£rv”ID
);

72 
boŞ
 
CheckSessiÚKeyInCache
(
ušt32_t
 
£ssiÚKey
);

74 
boŞ
 
CË¬SessiÚCache
();

76 
boŞ
 
AddCl›ÁSessiÚToCache
(cÚ¡ 
MsCl›ÁCommªd
::
¡SessiÚ
& 
ş›ÁSessiÚ
);

77 
boŞ
 
AddCl›ÁSessiÚLi¡ToCache
(cÚ¡ 
¡d
::
veùÜ
<
MsCl›ÁCommªd
::
¡SessiÚ
>& 
ş›ÁSessiÚLi¡
);

79 
boŞ
 
D–‘eCl›ÁSessiÚFromCache
(
ušt32_t
 
£ssiÚKey
);

80 
boŞ
 
D–‘eCl›ÁSessiÚLi¡FromCache
(cÚ¡ 
¡d
::
veùÜ
<
ušt32_t
>& 
£ssiÚLi¡
);

82 
ModifyCl›ÁSessiÚInCache
(
ušt32_t
 
£ssiÚKey
, 
ušt64_t
 
u£rID
, ušt64_ˆ
rŞeID
);

84 
boŞ
 
PrivegeChªge
(
ušt64_t
 
rŞeID
);

86 
boŞ
 
HasG’”®Privege
(
ušt32_t
 
£ssiÚKey
, ušt32_ˆ
b™Code
);

87 
boŞ
 
HasDeviûPrivege
(
ušt32_t
 
£ssiÚKey
, 
ušt64_t
 
deviûID
, 
ušt16_t
 
´ivegeTy³
, ušt32_ˆ
b™Code
);

88 
boŞ
 
HasDeviûPrivegeFÜOth”S”v”
(
ušt32_t
 
£ssiÚKey
, 
ušt64_t
 
£rv”ID
, ušt64_ˆ
deviûID
, 
ušt16_t
 
´ivegeTy³
, ušt32_ˆ
b™Code
);

90 
boŞ
 
G‘PrivegePriÜ™y
(
ušt32_t
 
£ssiÚKey
, 
ePrivegePriÜ™yTy³
 
ty³
, ušt32_ˆ&
iV®ue
);

92 
DumpCache
();

93 
DumpInfo
(
¡d
::
¡ršg
& 
¡rInfo
);

95 
boŞ
 
IsSessiÚCacheEm±y
();

96 
ušt64_t
 
G‘U£rIDBySessiÚID
(ušt64_ˆ
£ssiÚID
);

98 
	g´iv©e
:

99 
boŞ
 
AddRŞePrivegeToSessiÚTabË
(
ušt64_t
 
rŞeID
);

100 
boŞ
 
ModifyRŞePrivegeInSessiÚTabË
(
ušt64_t
 
rŞeID
);

101 
boŞ
 
D–‘eRŞePrivegeFromSessiÚTabË
(
ušt64_t
 
rŞeID
);

103 
boŞ
 
G‘PrivegeI‹m
(
ušt32_t
 
£ssiÚKey
, 
¡PrivegeSessiÚTabËI‹m
& 
rŞeI‹m
);

104 
boŞ
 
G‘PrivegeI‹mFÜOth”S”v”
(
ušt32_t
 
£ssiÚKey
, 
ušt64_t
 
£rv”ID
, 
¡PrivegeSessiÚTabËI‹m
& 
rŞeI‹m
);

106 
RŞeD©aToPrivegeI‹m
(
ušt64_t
 
£rv”ID
, cÚ¡ 
¡RŞeD©a
& 
rŞeD©a
, 
¡PrivegeSessiÚTabËI‹m
& 
™em
);

108 
boŞ
 
CheckDeviûPrivege
(
ušt64_t
 
deviûID
, 
ušt16_t
 
´ivegeTy³
, 
ušt32_t
 
b™Code
, 
¡PrivegeSessiÚTabËI‹m
& 
rŞeI‹m
);

110 
CSessiÚKeyCÚŒŞMgr
(cÚ¡ CSessiÚKeyCÚŒŞMgr& 
rhs
);

111 
	gCSessiÚKeyCÚŒŞMgr
 &
	gİ”©Ü
=(cÚ¡ 
CSessiÚKeyCÚŒŞMgr
& 
rhs
);

113 
	g´iv©e
:

114 
ušt64_t
 
m_S”v”ID
;

115 
ušt32_t
 
	gm_MagicCl›ÁSessiÚID
;

116 
CMSCÚfigMªag”
* 
	gm_MSCÚfigMªag”
;

119 
	g¡d
::
m­
<
ušt32_t
, 
	g¡Ba£SessiÚTabËI‹m
> 
	gm_vBa£SessiÚTabË
;

120 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_CSBa£SessiÚTabË
;

122 
	g¡d
::
m­
<
ušt64_t
, 
	g¡PrivegeSessiÚTabËI‹m
> 
	gm_vPrivegeSessiÚTabË
;

123 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_CSPrivegeSessiÚTabË
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigBase.cpp

1 
	~"commÚ/dœeùÜy_Œav”£.h
"

2 
	~"commÚ/time.h
"

3 
	~"commÚ/š‰y³s.h
"

5 
	~"MSCÚfigBa£.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
	gCMSCÚfigBa£
::
	$CMSCÚfigBa£
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
, cÚ¡ std::¡ršg& 
feP»fix
)

10 : 
	`m_FŞd”P©h
(
	`ResŞveP©h
(
fŞd”P©h
è+ 
SLASH
)

11 , 
	$m_FeP»fix
(
feP»fix
)

13 
	`MakeDœeùÜy
(
m_FŞd”P©h
);

14 
	}
}

16 
	gCMSCÚfigBa£
::~
	$CMSCÚfigBa£
()

17 {
	}
}

19 
CMSCÚfigBa£
::
	$S‘AcûssTime
(
ušt64_t
 
acûssTime
) const

21 
¡d
::
¡ršg
 
acûssTimeFe
 = 
m_FŞd”P©h
 + "accessTime";

23 
FILE
* 
pAcûssTime
 = 
	`fİ’
(
acûssTimeFe
.
	`c_¡r
(), "w");

24 ià(
pAcûssTime
 !ğ
NULL
)

26 ià(
	`årštf
(
pAcûssTime
, "%" 
PRIu64
, 
acûssTime
) < 0)

28 
	`TRACE
("Wr™Ãw‡cûs tim”rÜ %s\n", 
m_FeP»fix
.
	`c_¡r
());

30 
	`fşo£
(
pAcûssTime
);

31 
pAcûssTime
 = 
NULL
;

35 
	`TRACE
("O³Àacûs timfe(%sè”rÜ!!\n", 
m_FeP»fix
.
	`c_¡r
());

37 
	}
}

39 
ušt64_t
 
	gCMSCÚfigBa£
::
	$G‘AcûssTime
() const

41 
ušt64_t
 
acûssTime
 = 0;

43 
¡d
::
¡ršg
 
acûssTimeFe
 = 
m_FŞd”P©h
 + "accessTime";

44 
FILE
* 
pAcûssTime
 = 
	`fİ’
(
acûssTimeFe
.
	`c_¡r
(), "r");

45 ià(
pAcûssTime
 !ğ
NULL
)

47 ià(
	`fsÿnf
(
pAcûssTime
, "%" 
PRIu64
, &
acûssTime
) != 1)

49 
	`TRACE
("R—d‚ew‡cûs tim”rÜ %s\n", 
m_FeP»fix
.
	`c_¡r
());

50 
	`fşo£
(
pAcûssTime
);

51 
pAcûssTime
 = 
NULL
;

54 
	`fşo£
(
pAcûssTime
);

55 
pAcûssTime
 = 
NULL
;

56  
acûssTime
;

60 
	`TRACE
("O³Àacûs timfe(%sè”rÜ!!\n", 
m_FeP»fix
.
	`c_¡r
());

63 
	}
}

65 
	gCMSCÚfigBa£
::
	$CË¬OldFes
() const

67 
DœeùÜyT¿v”£
 
	`dt
(
m_FŞd”P©h
);

69 
dt
.
	`Next
())

71 
¡d
::
¡ršg
 
ÃxtFeName
 = 
dt
.
	`G‘P©hName
();

73 
S¶™P©hD©a
 
d©a
;

74 
	`S¶™P©h
(
ÃxtFeName
, 
d©a
);

76 ià(
d©a
.
fe_ba£
.
	`com·»
(0, 
m_FeP»fix
.
	`Ëngth
(), m_FilePrefix) == 0)

78 
	`RemoveFe
(
ÃxtFeName
);

81 
	}
}

83 
boŞ
 
	gCMSCÚfigBa£
::
	$P¬£D©a
()

85 
boŞ
 
bP¬£ResuÉ
 = 
Œue
;

87 
DœeùÜyT¿v”£
 
	`dt
(
m_FŞd”P©h
);

89 
dt
.
	`Next
())

91 
¡d
::
¡ršg
 
ÃxtFeName
 = 
dt
.
	`G‘P©hName
();

93 
S¶™P©hD©a
 
d©a
;

94 
	`S¶™P©h
(
ÃxtFeName
, 
d©a
);

96 ià(
d©a
.
fe_ex‹nsiÚ
 != "xml")

101 ià(
d©a
.
fe_ba£
.
	`com·»
(0, 
m_FeP»fix
.
	`Ëngth
(), m_FilePrefix) == 0)

103 
bP¬£ResuÉ
 = 
	`XMLP¬£r
(
ÃxtFeName
);

105 ià(!
bP¬£ResuÉ
)

107 
	`TRACE
("F% ·rsšgƒ¼Ü\n", 
ÃxtFeName
.
	`c_¡r
());

108  
çl£
;

113  
Œue
;

114 
	}
}

116 
	g¡d
::
¡ršg
 
CMSCÚfigBa£
::
	$G‘AbsŞu‹XMLFeName
(
ušt64_t
 
uÎID
) const

118 
¡d
::
¡ršg
 
sXMLFeName
 = 
m_FŞd”P©h
 + 
m_FeP»fix
 + 
	`u64_to_¡r
(
uÎID
) + ".xml";

120  
sXMLFeName
;

121 
	}
}

123 
boŞ
 
	gCMSCÚfigBa£
::
	$SaveXMLFe
(
XMLT»e
& 
Œ“
, 
ušt64_t
 
uÎID
) const

125 
¡d
::
¡ršg
 
	`sTmpFeName
(
m_FŞd”P©h
);

126 
sTmpFeName
 += "tmp";

128 
¡d
::
¡ršg
 
sXMLFeName
 = 
	`G‘AbsŞu‹XMLFeName
(
uÎID
);

130 
	`IF_FALSE_RETURN_VALUE
(
	`SaveXMLT»e
(
sTmpFeName
, 
Œ“
), 
çl£
);

132 ià(
	`CheckFeExi¡
(
sXMLFeName
))

134 
	`IF_FALSE_RETURN_VALUE
(
	`RemoveFe
(
sXMLFeName
), 
çl£
);

136 
	`IF_NOT_EQUAL_RETURN_VALUE
(
	`»Çme
(
sTmpFeName
.
	`c_¡r
(), 
sXMLFeName
.c_¡r()), 0, 
çl£
);

138  
Œue
;

139 
	}
}

141 
boŞ
 
	gCMSCÚfigBa£
::
	$SaveXMLFe
(
XMLT»e
& 
Œ“
, 
ušt32_t
 
iID
) const

143  
	`SaveXMLFe
(
Œ“
, (
ušt64_t
)
iID
);

144 
	}
}

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigBase.h

1 #iâdeà
__MS_CONFIG_BASE__


2 
	#__MS_CONFIG_BASE__


	)

4 
	~<¡dio.h
>

5 
	~<¡ršg
>

7 
	~"commÚ/¡dšt.h
"

8 
	~"commÚ/fe.h
"

9 
	~"commÚ/¡ršg.h
"

10 
	~"commÚ/ut™y.h
"

11 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

13 
	~"debugMsg/Debug.h
"

15 
	~"sûw/xml_Œ“.h
"

17 #ifdeà
WIN32


18 
	#SLASH
 "\\"

	)

20 
	#SLASH
 "/"

	)

23 şas 
	cCMSCÚfigBa£


25 
	mpublic
:

26 
	eMS_DATA_MANIPULATION


28 
DATA_ADD
 = 0,

29 
	mDATA_MODIFY
,

30 
	mDATA_DELETE
,

31 
	mDATA_REMOVE
,

34 
	eMS_DATA_FIND_METHOD


36 
	gFIND_BY_ID
 = 0,

37 
	gFIND_BY_INDEX
,

40 
	gpublic
:

41 
CMSCÚfigBa£
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
, cÚ¡ std::¡ršg& 
feP»fix
);

42 
	gvœtu®
 ~
CMSCÚfigBa£
();

44 
ušt64_t
 
	$G‘AcûssTime
() const;

46 
	$CË¬OldFes
() const;

47 
boŞ
 
	`P¬£D©a
();

49 
´Ùeùed
:

50 
	$S‘AcûssTime
(
ušt64_t
 
acûssTime
) const;

51 
¡d
::
¡ršg
 
	$G‘AbsŞu‹XMLFeName
(
ušt64_t
 
uÎID
) const;

53 
boŞ
 
	$SaveXMLFe
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
ušt64_t
 
uÎID
) const;

54 
boŞ
 
	$SaveXMLFe
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
ušt32_t
 
iID
) const;

56 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

58 
´iv©e
:

59 
¡d
::
¡ršg
 
m_FŞd”P©h
;

60 
¡d
::
¡ršg
 
m_FeP»fix
;

62 
vœtu®
 
boŞ
 
	`XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
) = 0;

64 
	`CMSCÚfigBa£
(cÚ¡ 
CMSCÚfigBa£
& 
rhs
);

65 
CMSCÚfigBa£
 &
İ”©Ü
=(cÚ¡ CMSCÚfigBa£& 
rhs
);

66 
	}
};

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigGroup.cpp

1 
	~"MSCÚfigGroup.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
	gCMSCÚfigGroup
::
	$CMSCÚfigGroup
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
)

6 : 
	`CMSCÚfigBa£
(
fŞd”P©h
, "Group")

7 , 
	$m_vGroupD©a
()

8 {
	}
}

10 
	gCMSCÚfigGroup
::~
	$CMSCÚfigGroup
()

11 {
	}
}

13 
boŞ
 
CMSCÚfigGroup
::
	$XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
)

15 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

17 
XMLT»e
 
Œ“
;

18 ià(!
	`LßdXMLT»e
(
sXMLFeName
, 
Œ“
))

20 
	`TRACE
("Load XML File Fail!!\n");

21  
çl£
;

24 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

26 
¡GroupD©a
 
d©aI‹m
;

27 
d©aI‹m
.
	`Un£rŸlize
(
–em’t
);

29 
m_vGroupD©a
.
	`push_back
(
d©aI‹m
);

31  
Œue
;

32 
	}
}

34 
boŞ
 
	gCMSCÚfigGroup
::
	$XMLC»©”
(cÚ¡ 
¡GroupD©a
& 
groupD©a
)

36 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

38 
XMLT»e
 
Œ“
;

39 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`S‘RoÙ
(
XML_GROUP_ROOT_NAME
);

41 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

42 
	`IF_FALSE_RETURN_VALUE
(
groupD©a
.
	`S”Ÿlize
(
–em’t
), 
çl£
);

44  
	`SaveXMLFe
(
Œ“
, 
groupD©a
.
ba£I‹m
.
uÎID
);

45 
	}
}

47 
št32_t
 
	gCMSCÚfigGroup
::
	$FšdD©aIndex
(cÚ¡ 
ušt64_t
 
uÎID
) const

49 ià(
m_vGroupD©a
.
	`em±y
())

51 
	`TRACE
("No Group Data!!\n");

55 
ušt32_t
 
i
 = 0; i < 
m_vGroupD©a
.
	`size
(); i++)

57 ià(
uÎID
 =ğ
m_vGroupD©a
[
i
].
ba£I‹m
.ullID)

59  (
št32_t
)
i
;

63 
	}
}

65 
boŞ
 
	gCMSCÚfigGroup
::
	$MªuÏ‹D©a
(cÚ¡ 
¡GroupD©a
& 
NewD©a
, cÚ¡ 
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
)

67 ià(
bFÏg
 =ğ
DATA_ADD
)

69 ià(
	`XMLC»©”
(
NewD©a
))

71 
	`S‘AcûssTime
(
time¡amp
);

72 
m_vGroupD©a
.
	`push_back
(
NewD©a
);

73  
Œue
;

77  
çl£
;

82 
iIndex
 = 
	`FšdD©aIndex
(
NewD©a
.
ba£I‹m
.
uÎID
);

83 ià(
iIndex
 == -1)

85 
	`TRACE
("Find Indexƒrror\n");

86  
çl£
;

90 ià(
bFÏg
 =ğ
DATA_MODIFY
)

92 ià(
	`XMLC»©”
(
NewD©a
))

94 
	`S‘AcûssTime
(
time¡amp
);

95 
m_vGroupD©a
[
iIndex
] = 
NewD©a
;

96  
Œue
;

100  
çl£
;

103 ià(
bFÏg
 =ğ
DATA_DELETE
)

105 
¡d
::
¡ršg
 
sXMLFeName
 = 
	`G‘AbsŞu‹XMLFeName
(
NewD©a
.
ba£I‹m
.
uÎID
);

106 
m_vGroupD©a
.
	`”a£
(m_vGroupD©a.
	`begš
(è+ 
iIndex
);

107 ià(!
	`RemoveFe
(
sXMLFeName
))

109 
	`TRACE
("Remov% ”rÜ\n", 
sXMLFeName
.
	`c_¡r
());

110  
çl£
;

113 
	`S‘AcûssTime
(
time¡amp
);

114  
Œue
;

118 
	`TRACE
("Impossible!!\n");

119  
çl£
;

124  
Œue
;

125 
	}
}

127 
boŞ
 
	gCMSCÚfigGroup
::
	$G‘SšgËD©a
(cÚ¡ 
MS_DATA_FIND_METHOD
& 
FšdTy³
, 
ušt64_t
 
uÎID
, 
¡GroupD©a
& 
D©aInfo
)

129 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

131 
iIndex
 = 0;

132 ià(
FšdTy³
 =ğ
FIND_BY_ID
)

134 
iIndex
 = 
	`FšdD©aIndex
(
uÎID
);

136 ià(
FšdTy³
 =ğ
FIND_BY_INDEX
)

138 
iIndex
 = ()
uÎID
;

142 
iIndex
 = 
	`FšdD©aIndex
(
uÎID
);

145 ià(
iIndex
 == -1)

147 
	`TRACE
("Find Indexƒrror\n");

148  
çl£
;

152 
D©aInfo
 = 
m_vGroupD©a
[
iIndex
];

153  
Œue
;

155 
	}
}

157 
boŞ
 
	gCMSCÚfigGroup
::
SyncMSCÚfigGroup
(cÚ¡ 
¡d
::
veùÜ
<
¡GroupD©a
>& 
groupLi¡
, 
ušt64_t
 
time¡amp
)

160 
CË¬OldFes
();

161 
	gm_vGroupD©a
.
ş—r
();

164 
ušt32_t
 
	gi
 = 0; i < 
	ggroupLi¡
.
size
(); i++)

166 
MªuÏ‹D©a
(
groupLi¡
[
i
], 
DATA_ADD
, 
time¡amp
);

168  
	gŒue
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigGroup.h

1 #iâdeà
_MS_CONFIG_GROUP_H_


2 
	#_MS_CONFIG_GROUP_H_


	)

4 
	~"£rv”CÚfig/MsU£rD©aI‹m.h
"

5 
	~"MSCÚfigBa£.h
"

7 şas 
	cCMSCÚfigGroup
: 
public
 
CMSCÚfigBa£


9 
public
:

10 
CMSCÚfigGroup
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
);

11 
	mvœtu®
 ~
CMSCÚfigGroup
();

13 
št32_t
 
	$FšdD©aIndex
(cÚ¡ 
ušt64_t
 
uÎID
) const;

15 
boŞ
 
	`MªuÏ‹D©a
(cÚ¡ 
¡GroupD©a
& 
NewD©a
, cÚ¡ 
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
);

16 
boŞ
 
	`G‘SšgËD©a
(cÚ¡ 
MS_DATA_FIND_METHOD
& 
FšdTy³
, 
ušt64_t
 
uÎID
, 
¡GroupD©a
& 
D©aInfo
);

18 
boŞ
 
	`SyncMSCÚfigGroup
(cÚ¡ 
¡d
::
veùÜ
<
¡GroupD©a
>& 
groupLi¡
, 
ušt64_t
 
time¡amp
);

20 
´iv©e
:

21 
	`CMSCÚfigGroup
(cÚ¡ 
CMSCÚfigGroup
 &
rhs
);

22 
CMSCÚfigGroup
 &
İ”©Ü
=(cÚ¡ CMSCÚfigGrou°&
rhs
);

24 
´iv©e
:

25 
vœtu®
 
boŞ
 
	`XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
);

26 
boŞ
 
	`XMLC»©”
(cÚ¡ 
¡GroupD©a
& 
D©aInfo
);

28 
¡d
::
veùÜ
<
¡GroupD©a
> 
m_vGroupD©a
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigRole.cpp

1 
	~"MSCÚfigRŞe.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
	gCMSCÚfigRŞe
::
	$CMSCÚfigRŞe
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
)

6 : 
	`CMSCÚfigBa£
(
fŞd”P©h
, "Role")

7 , 
	$m_vRŞeD©a
()

8 {
	}
}

10 
	gCMSCÚfigRŞe
::~
	$CMSCÚfigRŞe
()

11 {
	}
}

13 
boŞ
 
CMSCÚfigRŞe
::
	$XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
)

15 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

17 
XMLT»e
 
Œ“
;

18 ià(!
	`LßdXMLT»e
(
sXMLFeName
, 
Œ“
))

20 
	`TRACE
("Load XML File Fail!!\n");

21  
çl£
;

24 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

26 
¡RŞeD©a
 
d©aI‹m
;

27 
d©aI‹m
.
	`Un£rŸlize
(
–em’t
);

29 
m_vRŞeD©a
.
	`push_back
(
d©aI‹m
);

31  
Œue
;

32 
	}
}

34 
boŞ
 
	gCMSCÚfigRŞe
::
	$XMLC»©”
(cÚ¡ 
¡RŞeD©a
& 
rŞeD©a
)

36 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

38 
XMLT»e
 
Œ“
;

39 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`S‘RoÙ
(
XML_ROLE_ROOT_NAME
);

41 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

42 
	`IF_FALSE_RETURN_VALUE
(
rŞeD©a
.
	`S”Ÿlize
(
–em’t
), 
çl£
);

44  
	`SaveXMLFe
(
Œ“
, 
rŞeD©a
.
ba£I‹m
.
uÎID
);

45 
	}
}

47 
št32_t
 
	gCMSCÚfigRŞe
::
	$FšdD©aIndex
(cÚ¡ 
ušt64_t
 
uÎID
) const

49 ià(
m_vRŞeD©a
.
	`em±y
())

51 
	`TRACE
("No Role Data!!\n");

55 
ušt32_t
 
i
 = 0; i < 
m_vRŞeD©a
.
	`size
(); i++)

57 ià(
uÎID
 =ğ
m_vRŞeD©a
[
i
].
ba£I‹m
.ullID)

59  (
št32_t
)
i
;

63 
	}
}

65 
boŞ
 
	gCMSCÚfigRŞe
::
	$MªuÏ‹D©a
(cÚ¡ 
¡RŞeD©a
& 
NewD©a
, cÚ¡ 
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
)

67 ià(
bFÏg
 =ğ
DATA_ADD
)

69 ià(
	`XMLC»©”
(
NewD©a
))

71 
	`S‘AcûssTime
(
time¡amp
);

72 
m_vRŞeD©a
.
	`push_back
(
NewD©a
);

73  
Œue
;

77  
çl£
;

82 
iIndex
 = 
	`FšdD©aIndex
(
NewD©a
.
ba£I‹m
.
uÎID
);

83 ià(
iIndex
 == -1)

85 
	`TRACE
("Find Indexƒrror\n");

86  
çl£
;

90 ià(
bFÏg
 =ğ
DATA_MODIFY
)

92 ià(
	`XMLC»©”
(
NewD©a
))

94 
	`S‘AcûssTime
(
time¡amp
);

95 
m_vRŞeD©a
[
iIndex
] = 
NewD©a
;

96  
Œue
;

100  
çl£
;

103 ià(
bFÏg
 =ğ
DATA_DELETE
)

105 
¡d
::
¡ršg
 
sXMLFeName
 = 
	`G‘AbsŞu‹XMLFeName
(
NewD©a
.
ba£I‹m
.
uÎID
);

106 
m_vRŞeD©a
.
	`”a£
(m_vRŞeD©a.
	`begš
(è+ 
iIndex
);

107 ià(!
	`RemoveFe
(
sXMLFeName
))

109 
	`TRACE
("Remov% ”rÜ\n", 
sXMLFeName
.
	`c_¡r
());

110  
çl£
;

113 
	`S‘AcûssTime
(
time¡amp
);

114  
Œue
;

118 
	`TRACE
("Impossible!!\n");

119  
çl£
;

124  
çl£
;

125 
	}
}

127 
boŞ
 
	gCMSCÚfigRŞe
::
	$G‘SšgËD©a
(cÚ¡ 
MS_DATA_FIND_METHOD
& 
FšdTy³
, 
ušt64_t
 
uÎID
, 
¡RŞeD©a
& 
D©aInfo
)

129 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

131 
iIndex
 = 0;

132 ià(
FšdTy³
 =ğ
FIND_BY_ID
)

134 
iIndex
 = 
	`FšdD©aIndex
(
uÎID
);

136 ià(
FšdTy³
 =ğ
FIND_BY_INDEX
)

138 
iIndex
 = ()
uÎID
;

142 
iIndex
 = 
	`FšdD©aIndex
(
uÎID
);

145 ià(
iIndex
 == -1)

147 
	`TRACE
("Find Indexƒrror\n");

148  
çl£
;

152 
D©aInfo
 = 
m_vRŞeD©a
[
iIndex
];

153  
Œue
;

155 
	}
}

157 
boŞ
 
	gCMSCÚfigRŞe
::
G‘DeçuÉPrivege
(
ušt64_t
 
uÎID
, 
¡d
::
¡ršg
& 
sG’”®I‹mPrivege
, std::
veùÜ
<
¡DeçuÉDevAcûssB™SŒ—m
>& 
deçuÉDevPrivege
)

159 
Cr™iÿlSeùiÚLock
 
_l
(&
m_cs
);

161 
	giIndex
 = 
FšdD©aIndex
(
uÎID
);

163 ià(
	giIndex
 == -1)

165 
TRACE
("Find Indexƒrror\n");

166  
	gçl£
;

170 
	gsG’”®I‹mPrivege
 = 
m_vRŞeD©a
[
iIndex
].
sG’”®I‹mAcûssB™SŒ—m
;

171 
	gdeçuÉDevPrivege
 = 
m_vRŞeD©a
[
iIndex
].
vDeçuÉInfo
;

173  
	gŒue
;

177 
boŞ
 
	gCMSCÚfigRŞe
::
SyncMSCÚfigRŞe
(cÚ¡ 
¡d
::
veùÜ
<
¡RŞeD©a
>& 
rŞeD©a
, 
ušt64_t
 
time¡amp
)

180 
CË¬OldFes
();

181 
	gm_vRŞeD©a
.
ş—r
();

184 
ušt32_t
 
	gi
 = 0; i < 
	grŞeD©a
.
size
(); i++)

186 
MªuÏ‹D©a
(
rŞeD©a
[
i
], 
DATA_ADD
, 
time¡amp
);

188  
	gŒue
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigRole.h

1 #iâdeà
_MS_CONFIG_ROLE_H_


2 
	#_MS_CONFIG_ROLE_H_


	)

4 
	~"£rv”CÚfig/MsU£rD©aI‹m.h
"

5 
	~"MSCÚfigBa£.h
"

7 şas 
	cCMSCÚfigRŞe
: 
public
 
CMSCÚfigBa£


9 
public
:

10 
CMSCÚfigRŞe
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
);

11 
	mvœtu®
 ~
CMSCÚfigRŞe
();

13 
št32_t
 
	$FšdD©aIndex
(cÚ¡ 
ušt64_t
 
uÎID
) const;

15 
boŞ
 
	`MªuÏ‹D©a
(cÚ¡ 
¡RŞeD©a
& 
NewD©a
, cÚ¡ 
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
);

16 
boŞ
 
	`G‘SšgËD©a
(cÚ¡ 
MS_DATA_FIND_METHOD
& 
FšdTy³
, 
ušt64_t
 
uÎID
, 
¡RŞeD©a
& 
D©aInfo
);

17 
boŞ
 
	`G‘DeçuÉPrivege
(
ušt64_t
 
uÎID
, 
¡d
::
¡ršg
& 
sG’”®I‹mPrivege
, std::
veùÜ
<
¡DeçuÉDevAcûssB™SŒ—m
>& 
deçuÉDevPrivege
);

19 
boŞ
 
	`SyncMSCÚfigRŞe
(cÚ¡ 
¡d
::
veùÜ
<
¡RŞeD©a
>& 
rŞeD©a
, 
ušt64_t
 
time¡amp
);

21 
´iv©e
:

22 
	`CMSCÚfigRŞe
(cÚ¡ 
CMSCÚfigRŞe
& 
rhs
);

23 
CMSCÚfigRŞe
 &
İ”©Ü
=(cÚ¡ CMSCÚfigRŞe& 
rhs
);

25 
´iv©e
:

26 
vœtu®
 
boŞ
 
	`XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
);

27 
boŞ
 
	`XMLC»©”
(cÚ¡ 
¡RŞeD©a
& 
D©aInfo
);

29 
¡d
::
veùÜ
<
¡RŞeD©a
> 
m_vRŞeD©a
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigSchedule.cpp

1 
	~"MSCÚfigScheduË.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

6 
	gCMSCÚfigScheduË
::
	$CMSCÚfigScheduË
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
)

7 : 
	`CMSCÚfigBa£
(
fŞd”P©h
, "Schedule")

8 , 
	$m_scheduËD©a
()

9 {
	}
}

11 
	gCMSCÚfigScheduË
::~
	$CMSCÚfigScheduË
()

13 
	`D–‘eIn¡ªû
();

14 
	}
}

16 
	gCMSCÚfigScheduË
::
	$D–‘eIn¡ªû
()

18 
ušt32_t
 
i
 = 0; i < 
m_scheduËD©a
.
	`size
(); i++)

20 ià(
m_scheduËD©a
[
i
] !ğ
NULL
)

22 
	`d–‘e
(
m_scheduËD©a
[
i
]);

25 
m_scheduËD©a
.
	`ş—r
();

26 
	}
}

28 
boŞ
 
	gCMSCÚfigScheduË
::
	$XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
)

30 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

32 
XMLT»e
 
Œ“
;

33 ià(!
	`LßdXMLT»e
(
sXMLFeName
, 
Œ“
))

35 
	`TRACE
("Load XML File Fail!!\n");

36  
çl£
;

39 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

41 
¡d
::
¡ršg
 
ty³
 = 
–em’t
.
	`G‘Chd
("ty³").
	`G‘CÚ‹Á
();

43 
CScheduËBa£
* 
ba£
 = 
NULL
;

44 ià(
ty³
 == "Day")

46 
ba£
 = 
Ãw
 
	`CScheduËDay
();

48 ià(
ty³
 == "Week")

50 
ba£
 = 
Ãw
 
	`CScheduËW“kly
();

52 ià(
ty³
 == "Month1")

54 
ba£
 = 
Ãw
 
	`CScheduËMÚthly
();

56 ià(
ty³
 == "Month2")

58 
ba£
 = 
Ãw
 
	`CScheduËMÚthly
();

60 ià(
ty³
 == "Year1")

62 
ba£
 = 
Ãw
 
	`CScheduËY—¾y
();

64 ià(
ty³
 == "Year2")

66 
ba£
 = 
Ãw
 
	`CScheduËY—¾y
();

68 ià(
ty³
 == "Specific")

70 
ba£
 = 
Ãw
 
	`CScheduËS³cificDays
();

74  
çl£
;

77 ià(
ba£
 =ğ
NULL
)

79  
çl£
;

82 
ba£
->
	`Un£rŸlize
(
–em’t
);

83 
m_scheduËD©a
.
	`push_back
(
ba£
);

85  
Œue
;

86 
	}
}

88 
boŞ
 
	gCMSCÚfigScheduË
::
	$XMLC»©”
(
CScheduËBa£
* 
ba£
)

90 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

92 
XMLT»e
 
Œ“
;

93 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`S‘RoÙ
(
XML_SCHEDULE_ROOT_NAME
);

95 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

96 
	`IF_FALSE_RETURN_VALUE
(
ba£
->
	`S”Ÿlize
(
–em’t
), 
çl£
);

98  
	`SaveXMLFe
(
Œ“
, 
ba£
->
ba£I‹m
.
uÎID
);

99 
	}
}

101 
št32_t
 
	gCMSCÚfigScheduË
::
	$FšdD©aIndex
(cÚ¡ 
ušt64_t
 
uÎID
) const

103 ià(
m_scheduËD©a
.
	`em±y
())

105 
	`TRACE
("No Schedule Data!!\n");

109 
ušt32_t
 
i
 = 0; i < 
m_scheduËD©a
.
	`size
(); i++)

111 ià(
uÎID
 =ğ
m_scheduËD©a
[
i
]->
ba£I‹m
.ullID)

113  (
št32_t
)
i
;

117 
	}
}

119 
boŞ
 
	gCMSCÚfigScheduË
::
	$MªuÏ‹D©a
(
CScheduËBa£
* 
NewD©a
, cÚ¡ 
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
)

121 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

123 ià(
bFÏg
 =ğ
DATA_ADD
)

125 ià(
	`XMLC»©”
(
NewD©a
))

127 
	`S‘AcûssTime
(
time¡amp
);

128 
m_scheduËD©a
.
	`push_back
(
NewD©a
);

129  
Œue
;

133  
çl£
;

138 
iIndex
 = 
	`FšdD©aIndex
(
NewD©a
->
ba£I‹m
.
uÎID
);

139 ià(
iIndex
 == -1)

141 
	`TRACE
("Find Indexƒrror\n");

142  
çl£
;

146 ià(
bFÏg
 =ğ
DATA_MODIFY
)

148 ià(
	`XMLC»©”
(
NewD©a
))

150 
	`S‘AcûssTime
(
time¡amp
);

151 
m_scheduËD©a
.
	`”a£
(m_scheduËD©a.
	`begš
(è+ 
iIndex
);

152 
m_scheduËD©a
.
	`š£¹
(m_scheduËD©a.
	`begš
(è+ 
iIndex
, 
NewD©a
);

153  
Œue
;

157  
çl£
;

160 ià(
bFÏg
 =ğ
DATA_DELETE
)

162 
¡d
::
¡ršg
 
sXMLFeName
 = 
	`G‘AbsŞu‹XMLFeName
(
NewD©a
->
ba£I‹m
.
uÎID
);

163 ià(
m_scheduËD©a
[
iIndex
] !ğ
NULL
)

165 
	`d–‘e
 (
m_scheduËD©a
[
iIndex
]);

167 
m_scheduËD©a
.
	`”a£
(m_scheduËD©a.
	`begš
(è+ 
iIndex
);

168 ià(!
	`RemoveFe
(
sXMLFeName
))

170 
	`TRACE
("Remov% ”rÜ\n", 
sXMLFeName
.
	`c_¡r
());

171  
çl£
;

174 
	`S‘AcûssTime
(
time¡amp
);

175  
Œue
;

177 ià(
bFÏg
 =ğ
DATA_REMOVE
)

179 ià(
m_scheduËD©a
[
iIndex
] !ğ
NULL
)

181 
m_scheduËD©a
[
iIndex
] = 
NULL
;

183 
m_scheduËD©a
.
	`”a£
(m_scheduËD©a.
	`begš
(è+ 
iIndex
);

184 
	`TRACE
("E¿£ %Îu\n", 
NewD©a
->
ba£I‹m
.
uÎID
);

188 
	`TRACE
("Impossible!!\n");

189  
çl£
;

194  
çl£
;

195 
	}
}

197 
št32_t
 
	gCMSCÚfigScheduË
::
	$G‘SšgËD©a
(cÚ¡ 
MS_DATA_FIND_METHOD
& 
FšdTy³
, 
ušt64_t
 
uÎID
, 
CScheduËBa£
* &
D©aInfo
)

199 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

201 
iIndex
 = 0;

202 ià(
FšdTy³
 =ğ
FIND_BY_ID
)

204 
iIndex
 = 
	`FšdD©aIndex
(
uÎID
);

206 ià(
FšdTy³
 =ğ
FIND_BY_INDEX
)

208 
iIndex
 = ()
uÎID
;

212 
iIndex
 = 
	`FšdD©aIndex
(
uÎID
);

215 ià(
iIndex
 == -1)

217 
	`TRACE
("Find Indexƒrror\n");

222 
D©aInfo
 = 
m_scheduËD©a
[
iIndex
];

223  
m_scheduËD©a
[
iIndex
]->
	`G‘Ty³
();

225 
	}
}

227 
boŞ
 
	gCMSCÚfigScheduË
::
SyncMSCÚfigScheduË
(cÚ¡ 
¡d
::
veùÜ
<
CScheduËBa£
*>& 
scheduËD©a
, 
ušt64_t
 
time¡amp
)

230 
CË¬OldFes
();

231 
D–‘eIn¡ªû
();

234 
ušt32_t
 
	gi
 = 0; i < 
	gscheduËD©a
.
size
(); i++)

236 
MªuÏ‹D©a
(
scheduËD©a
[
i
], 
DATA_ADD
, 
time¡amp
);

239  
	gŒue
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigSchedule.h

1 #iâdeà
_MS_CONFIG_SCHEDULE_H_


2 
	#_MS_CONFIG_SCHEDULE_H_


	)

4 
	~"£rv”CÚfig/MsU£rD©aI‹m.h
"

5 
	~"MSCÚfigBa£.h
"

7 şas 
	cCMSCÚfigScheduË
: 
public
 
CMSCÚfigBa£


9 
public
:

10 
CMSCÚfigScheduË
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
);

11 
	mvœtu®
 ~
CMSCÚfigScheduË
();

13 
št32_t
 
	$FšdD©aIndex
(cÚ¡ 
ušt64_t
 
uÎID
) const;

15 
boŞ
 
	`MªuÏ‹D©a
(
CScheduËBa£
* 
NewD©a
, cÚ¡ 
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
);

16 
št32_t
 
	`G‘SšgËD©a
(cÚ¡ 
MS_DATA_FIND_METHOD
& 
FšdTy³
, 
ušt64_t
 
uÎID
, 
CScheduËBa£
* &
D©aInfo
);

18 
boŞ
 
	`SyncMSCÚfigScheduË
(cÚ¡ 
¡d
::
veùÜ
<
CScheduËBa£
*>& 
scheduËD©a
, 
ušt64_t
 
time¡amp
);

20 
´iv©e
:

21 
	`CMSCÚfigScheduË
(cÚ¡ 
CMSCÚfigScheduË
& 
rhs
);

22 
CMSCÚfigScheduË
 &
İ”©Ü
=(cÚ¡ CMSCÚfigScheduË& 
rhs
);

24 
´iv©e
:

25 
	`D–‘eIn¡ªû
();

27 
vœtu®
 
boŞ
 
	`XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
);

28 
boŞ
 
	`XMLC»©”
(
CScheduËBa£
* 
ba£
);

30 
¡d
::
veùÜ
<
CScheduËBa£
 *> 
m_scheduËD©a
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigUser.cpp

1 
	~"MSCÚfigU£r.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
	gCMSCÚfigU£r
::
	$CMSCÚfigU£r
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
)

6 : 
	`CMSCÚfigBa£
(
fŞd”P©h
, "User")

7 , 
	$m_vU£rD©a
()

8 {
	}
}

10 
	gCMSCÚfigU£r
::~
	$CMSCÚfigU£r
()

11 {
	}
}

13 
boŞ
 
CMSCÚfigU£r
::
	$XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
)

15 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

17 
XMLT»e
 
Œ“
;

18 ià(!
	`LßdXMLT»e
(
sXMLFeName
, 
Œ“
))

20 
	`TRACE
("Load XML File Fail!!\n");

21  
çl£
;

24 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

26 
¡U£rD©a
 
d©aI‹m
;

27 
d©aI‹m
.
	`Un£rŸlize
(
–em’t
);

29 
m_vU£rD©a
.
	`push_back
(
d©aI‹m
);

31  
Œue
;

32 
	}
}

34 
boŞ
 
	gCMSCÚfigU£r
::
	$XMLC»©”
(cÚ¡ 
¡U£rD©a
& 
u£rD©a
)

36 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

38 
XMLT»e
 
Œ“
;

39 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`S‘RoÙ
(
XML_USER_ROOT_NAME
);

41 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

42 
	`IF_FALSE_RETURN_VALUE
(
u£rD©a
.
	`S”Ÿlize
(
–em’t
), 
çl£
);

44  
	`SaveXMLFe
(
Œ“
, 
u£rD©a
.
ba£I‹m
.
uÎID
);

45 
	}
}

47 
št32_t
 
	gCMSCÚfigU£r
::
	$FšdD©aIndex
(cÚ¡ 
ušt64_t
 
uÎID
) const

49 ià(
m_vU£rD©a
.
	`em±y
())

51 
	`TRACE
("No User Data!!\n");

55 
ušt32_t
 
i
 = 0; i < 
m_vU£rD©a
.
	`size
(); i++)

57 ià(
uÎID
 =ğ
m_vU£rD©a
[
i
].
ba£I‹m
.ullID)

59  (
št32_t
)
i
;

63 
	}
}

65 
št32_t
 
	gCMSCÚfigU£r
::
	$FšdD©aIndex
(cÚ¡ 
¡d
::
¡ršg
& 
sU£ºame
) const

67 ià(
m_vU£rD©a
.
	`em±y
(è|| 
sU£ºame
.empty())

69 
	`TRACE
("No User Data!!\n");

73 
ušt32_t
 
i
 = 0; i < 
m_vU£rD©a
.
	`size
(); i++)

75 ià(
m_vU£rD©a
[
i
].
ba£I‹m
.
sName
 =ğ
sU£ºame
)

77  (
št32_t
)
i
;

81 
	}
}

83 
boŞ
 
	gCMSCÚfigU£r
::
	$MªuÏ‹D©a
(cÚ¡ 
¡U£rD©a
& 
NewD©a
, cÚ¡ 
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
)

85 ià(
bFÏg
 =ğ
DATA_ADD
)

87 ià(
	`XMLC»©”
(
NewD©a
))

89 
	`S‘AcûssTime
(
time¡amp
);

90 
m_vU£rD©a
.
	`push_back
(
NewD©a
);

91  
Œue
;

95  
çl£
;

100 
iIndex
 = 
	`FšdD©aIndex
(
NewD©a
.
ba£I‹m
.
uÎID
);

101 ià(
iIndex
 == -1)

103 
	`TRACE
("Find Indexƒrror\n");

104  
çl£
;

108 ià(
bFÏg
 =ğ
DATA_MODIFY
)

110 ià(
	`XMLC»©”
(
NewD©a
))

112 
	`S‘AcûssTime
(
time¡amp
);

113 
m_vU£rD©a
[
iIndex
] = 
NewD©a
;

114  
Œue
;

118  
çl£
;

121 ià(
bFÏg
 =ğ
DATA_DELETE
)

123 
¡d
::
¡ršg
 
sXMLFeName
 = 
	`G‘AbsŞu‹XMLFeName
(
NewD©a
.
ba£I‹m
.
uÎID
);

124 
m_vU£rD©a
.
	`”a£
(m_vU£rD©a.
	`begš
(è+ 
iIndex
);

125 ià(!
	`RemoveFe
(
sXMLFeName
))

127 
	`TRACE
("Remov% ”rÜ\n", 
sXMLFeName
.
	`c_¡r
());

128  
çl£
;

131 
	`S‘AcûssTime
(
time¡amp
);

132  
Œue
;

136 
	`TRACE
("Impossible!!\n");

137  
çl£
;

142  
Œue
;

143 
	}
}

145 
boŞ
 
	gCMSCÚfigU£r
::
	$G‘SšgËD©a
(cÚ¡ 
MS_DATA_FIND_METHOD
& 
FšdTy³
, 
ušt64_t
 
uÎID
, 
¡U£rD©a
& 
D©aInfo
)

147 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

149 
iIndex
 = 0;

150 ià(
FšdTy³
 =ğ
FIND_BY_ID
)

152 
iIndex
 = 
	`FšdD©aIndex
(
uÎID
);

154 ià(
FšdTy³
 =ğ
FIND_BY_INDEX
)

156 
iIndex
 = ()
uÎID
;

160 
iIndex
 = 
	`FšdD©aIndex
(
uÎID
);

163 ià(
iIndex
 == -1)

165 
	`TRACE
("Find Indexƒrror\n");

166  
çl£
;

170 
D©aInfo
 = 
m_vU£rD©a
[
iIndex
];

171  
Œue
;

173 
	}
}

175 
boŞ
 
	gCMSCÚfigU£r
::
SyncMSCÚfigU£r
(cÚ¡ 
¡d
::
veùÜ
<
¡U£rD©a
>& 
u£rLi¡
, 
ušt64_t
 
time¡amp
)

178 
CË¬OldFes
();

179 
	gm_vU£rD©a
.
ş—r
();

182 
ušt32_t
 
	gi
 = 0; i < 
	gu£rLi¡
.
size
(); i++)

184 
MªuÏ‹D©a
(
u£rLi¡
[
i
], 
DATA_ADD
, 
time¡amp
);

187  
	gŒue
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigUser.h

1 #iâdeà
_MS_CONFIG_USER_H_


2 
	#_MS_CONFIG_USER_H_


	)

4 
	~"£rv”CÚfig/MsU£rD©aI‹m.h
"

5 
	~"MSCÚfigBa£.h
"

7 şas 
	cCMSCÚfigU£r
: 
public
 
CMSCÚfigBa£


9 
public
:

10 
CMSCÚfigU£r
(cÚ¡ 
¡d
::
¡ršg
& 
fŞd”P©h
);

11 
	mvœtu®
 ~
CMSCÚfigU£r
();

13 
št32_t
 
	$FšdD©aIndex
(cÚ¡ 
ušt64_t
 
uÎID
) const;

14 
št32_t
 
	$FšdD©aIndex
(cÚ¡ 
¡d
::
¡ršg
& 
sU£ºame
) const;

16 
boŞ
 
	`MªuÏ‹D©a
(cÚ¡ 
¡U£rD©a
& 
NewD©a
, cÚ¡ 
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
);

17 
boŞ
 
	`G‘SšgËD©a
(cÚ¡ 
MS_DATA_FIND_METHOD
& 
FšdTy³
, 
ušt64_t
 
uÎID
, 
¡U£rD©a
& 
D©aInfo
);

19 
boŞ
 
	`SyncMSCÚfigU£r
(cÚ¡ 
¡d
::
veùÜ
<
¡U£rD©a
>& 
u£rLi¡
, 
ušt64_t
 
time¡amp
);

21 
´iv©e
:

22 
	`CMSCÚfigU£r
(cÚ¡ 
CMSCÚfigU£r
& 
rhs
);

23 
CMSCÚfigU£r
 &
İ”©Ü
=(cÚ¡ CMSCÚfigU£r& 
rhs
);

25 
´iv©e
:

26 
vœtu®
 
boŞ
 
	`XMLP¬£r
(cÚ¡ 
¡d
::
¡ršg
& 
sXMLFeName
);

27 
boŞ
 
	`XMLC»©”
(cÚ¡ 
¡U£rD©a
& 
D©aInfo
);

29 
¡d
::
veùÜ
<
¡U£rD©a
> 
m_vU£rD©a
;

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfigUtility.cpp

1 
	~"SyncMSCÚfigUt™y.h
"

3 
	~"MsCl›Á/MsCl›Á.h
"

5 
	~"commÚ/ut™y.h
"

6 
	~"debugMsg/Debug.h
"

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigU£rs
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
¡U£rD©a
>& 
»suÉD©aLi¡
)

12  
pCl›Á
->
G‘U£rInfÜm©iÚ
(
qu”yIDLi¡
, 
»suÉD©aLi¡
);

15 
boŞ
 
	gSyncMSCÚfigUt™y
::
	$SyncCÚfigU£r
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
ušt64_t
 
qu”yID
, 
¡U£rD©a
& 
»suÉD©a
)

17 
¡d
::
veùÜ
<
ušt64_t
> 
qu”yIDLi¡
;

18 
qu”yIDLi¡
.
	`push_back
(
qu”yID
);

20 
¡d
::
veùÜ
<
¡U£rD©a
> 
»suÉD©aLi¡
;

22 ià(
	`SyncCÚfigU£rs
(
pCl›Á
, 
qu”yIDLi¡
, 
»suÉD©aLi¡
))

24 
	`IF_TRUE_RETURN_VALUE
(
»suÉD©aLi¡
.
	`size
(è<ğ1, 
çl£
);

26 
»suÉD©a
 = 
»suÉD©aLi¡
[0];

27  
Œue
;

30  
çl£
;

31 
	}
}

33 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigU£rAÎ
(
MsCl›Á
* 
pCl›Á
, 
¡d
::
veùÜ
<
¡U£rD©a
>& 
»suÉD©aLi¡
)

35 
¡d
::
veùÜ
<
ušt64_t
> 
qu”yIDLi¡
;

36 
	gqu”yIDLi¡
.
ş—r
();

38  
SyncCÚfigU£rs
(
pCl›Á
, 
qu”yIDLi¡
, 
»suÉD©aLi¡
);

41 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigGroups
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
¡GroupD©a
>& 
»suÉD©aLi¡
)

43  
pCl›Á
->
G‘GroupInfÜm©iÚ
(
qu”yIDLi¡
, 
»suÉD©aLi¡
);

46 
boŞ
 
	gSyncMSCÚfigUt™y
::
	$SyncCÚfigGroup
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
ušt64_t
 
qu”yID
, 
¡GroupD©a
& 
»suÉD©a
)

48 
¡d
::
veùÜ
<
ušt64_t
> 
qu”yIDLi¡
;

49 
qu”yIDLi¡
.
	`push_back
(
qu”yID
);

51 
¡d
::
veùÜ
<
¡GroupD©a
> 
»suÉD©aLi¡
;

53 ià(
	`SyncCÚfigGroups
(
pCl›Á
, 
qu”yIDLi¡
, 
»suÉD©aLi¡
))

55 
	`IF_TRUE_RETURN_VALUE
(
»suÉD©aLi¡
.
	`size
(è<ğ1, 
çl£
);

57 
»suÉD©a
 = 
»suÉD©aLi¡
[0];

58  
Œue
;

61  
çl£
;

62 
	}
}

64 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigGroupAÎ
(
MsCl›Á
* 
pCl›Á
, 
¡d
::
veùÜ
<
¡GroupD©a
>& 
»suÉD©aLi¡
)

66 
¡d
::
veùÜ
<
ušt64_t
> 
qu”yIDLi¡
;

67 
	gqu”yIDLi¡
.
ş—r
();

69  
SyncCÚfigGroups
(
pCl›Á
, 
qu”yIDLi¡
, 
»suÉD©aLi¡
);

72 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigRŞes
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
¡RŞeD©a
>& 
»suÉD©aLi¡
)

74  
pCl›Á
->
G‘RŞeInfÜm©iÚ
(
qu”yIDLi¡
, 
»suÉD©aLi¡
);

77 
boŞ
 
	gSyncMSCÚfigUt™y
::
	$SyncCÚfigRŞe
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
ušt64_t
 
qu”yID
, 
¡RŞeD©a
& 
»suÉD©a
)

79 
¡d
::
veùÜ
<
ušt64_t
> 
qu”yIDLi¡
;

80 
qu”yIDLi¡
.
	`push_back
(
qu”yID
);

82 
¡d
::
veùÜ
<
¡RŞeD©a
> 
»suÉD©aLi¡
;

84 ià(
	`SyncCÚfigRŞes
(
pCl›Á
, 
qu”yIDLi¡
, 
»suÉD©aLi¡
))

86 
	`IF_TRUE_RETURN_VALUE
(
»suÉD©aLi¡
.
	`size
(è<ğ1, 
çl£
);

88 
»suÉD©a
 = 
»suÉD©aLi¡
[0];

89  
Œue
;

92  
çl£
;

93 
	}
}

95 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigRŞeAÎ
(
MsCl›Á
* 
pCl›Á
, 
¡d
::
veùÜ
<
¡RŞeD©a
>& 
»suÉD©aLi¡
)

97 
¡d
::
veùÜ
<
ušt64_t
> 
qu”yIDLi¡
;

98 
	gqu”yIDLi¡
.
ş—r
();

100  
SyncCÚfigRŞes
(
pCl›Á
, 
qu”yIDLi¡
, 
»suÉD©aLi¡
);

103 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigScheduËs
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
CScheduËBa£
*>& 
»suÉD©aLi¡
)

105  
pCl›Á
->
G‘ScheduËInfÜm©iÚ
(
qu”yIDLi¡
, 
»suÉD©aLi¡
);

108 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigScheduËsDu¶
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
CScheduËBa£
*>& 
»suÉD©aLi¡
, std::veùÜ<CScheduËBa£*>& 
»suÉD©aLi¡2
)

110  
pCl›Á
->
G‘ScheduËInfÜm©iÚDu¶
(
qu”yIDLi¡
, 
»suÉD©aLi¡
, 
»suÉD©aLi¡2
);

113 
boŞ
 
	gSyncMSCÚfigUt™y
::
	$SyncCÚfigScheduË
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
ušt64_t
 
qu”yID
, 
CScheduËBa£
*& 
»suÉD©a
)

115 
¡d
::
veùÜ
<
ušt64_t
> 
qu”yIDLi¡
;

116 
qu”yIDLi¡
.
	`push_back
(
qu”yID
);

118 
¡d
::
veùÜ
<
CScheduËBa£
*> 
»suÉD©aLi¡
;

120 ià(
	`SyncCÚfigScheduËs
(
pCl›Á
, 
qu”yIDLi¡
, 
»suÉD©aLi¡
))

122 
	`IF_TRUE_RETURN_VALUE
(
»suÉD©aLi¡
.
	`size
(è<ğ1, 
çl£
);

124 
»suÉD©a
 = 
»suÉD©aLi¡
[0];

125  
Œue
;

128  
çl£
;

129 
	}
}

131 
boŞ
 
	gSyncMSCÚfigUt™y
::
SyncCÚfigScheduËAÎ
(
MsCl›Á
* 
pCl›Á
, 
¡d
::
veùÜ
<
CScheduËBa£
*>& 
»suÉD©aLi¡
)

133 
¡d
::
veùÜ
<
ušt64_t
> 
qu”yIDLi¡
;

134 
	gqu”yIDLi¡
.
ş—r
();

136  
SyncCÚfigScheduËs
(
pCl›Á
, 
qu”yIDLi¡
, 
»suÉD©aLi¡
);

	@../../titanutils/MsClient/LoginCtrl/SyncMSConfigUtility.h

1 #iâdeà
__SYNC_MSCONFIG_UTILITY_H__


2 
	#__SYNC_MSCONFIG_UTILITY_H__


	)

4 
	~"£rv”CÚfig/MsU£rD©aI‹m.h
"

6 
şass
 
	gMsCl›Á
;

8 şas 
	cSyncMSCÚfigUt™y


10 
	mpublic
:

11 
boŞ
 
SyncCÚfigU£rs
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
¡U£rD©a
>& 
»suÉD©aLi¡
);

12 
boŞ
 
SyncCÚfigU£r
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
ušt64_t
 
qu”yID
, 
¡U£rD©a
& 
»suÉD©a
);

13 
boŞ
 
SyncCÚfigU£rAÎ
(
MsCl›Á
* 
pCl›Á
, 
¡d
::
veùÜ
<
¡U£rD©a
>& 
»suÉD©aLi¡
);

15 
boŞ
 
SyncCÚfigGroups
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
¡GroupD©a
>& 
»suÉD©aLi¡
);

16 
boŞ
 
SyncCÚfigGroup
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
ušt64_t
 
qu”yID
, 
¡GroupD©a
& 
»suÉD©a
);

17 
boŞ
 
SyncCÚfigGroupAÎ
(
MsCl›Á
* 
pCl›Á
, 
¡d
::
veùÜ
<
¡GroupD©a
>& 
»suÉD©aLi¡
);

19 
boŞ
 
SyncCÚfigRŞes
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
¡RŞeD©a
>& 
»suÉD©aLi¡
);

20 
boŞ
 
SyncCÚfigRŞe
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
ušt64_t
 
qu”yID
, 
¡RŞeD©a
& 
»suÉD©a
);

21 
boŞ
 
SyncCÚfigRŞeAÎ
(
MsCl›Á
* 
pCl›Á
, 
¡d
::
veùÜ
<
¡RŞeD©a
>& 
»suÉD©aLi¡
);

23 
boŞ
 
SyncCÚfigScheduËs
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
CScheduËBa£
*>& 
»suÉD©aLi¡
);

24 
boŞ
 
SyncCÚfigScheduËsDu¶
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
qu”yIDLi¡
, std::veùÜ<
CScheduËBa£
*>& 
»suÉD©aLi¡
, std::veùÜ<CScheduËBa£*>& 
»suÉD©aLi¡2
);

25 
boŞ
 
SyncCÚfigScheduË
(
MsCl›Á
* 
pCl›Á
, cÚ¡ 
ušt64_t
 
qu”yID
, 
CScheduËBa£
*& 
»suÉD©a
);

26 
boŞ
 
SyncCÚfigScheduËAÎ
(
MsCl›Á
* 
pCl›Á
, 
¡d
::
veùÜ
<
CScheduËBa£
*>& 
»suÉD©aLi¡
);

28 
	m´iv©e
:

29 
SyncMSCÚfigUt™y
();

30 ~
SyncMSCÚfigUt™y
();

	@../../titanutils/MsClient/MsClient.cpp

1 
	~"­r/­r_ut™y.h
"

3 
	~"cÚ¡/S”v”PrÙocŞDefš™iÚ.h
"

4 
	~"commÚ/¡ršg.h
"

5 
	~"T™ªCommÚ/CommÚUt™y.h
"

6 
	~"debugMsg/Debug.h
"

7 
	~"t™ªmših–³r/t™ªuts.h
"

9 
	~"MsCl›Á/MsCl›Á.h
"

11 
	~"PrÙocŞDefše/MsCl›ÁCommÚDefše.h
"

12 
	~"PrÙocŞDefše/MsCl›ÁCommªdDefše.h
"

14 
	~"PrÙocŞO³¿tiÚ/MsCl›ÁCommªdG’”©e.h
"

15 
	~"PrÙocŞO³¿tiÚ/MsCl›ÁCommªdP¬£r.h
"

17 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

19 
	gMsCl›Á
::
	$MsCl›Á
(cÚ¡ 
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
, cÚ¡ 
ušt64_t
& 
loÿlS”v”ID
,

20 cÚ¡ 
¡d
::
¡ršg
& 
LoÿlS”v”V”siÚ
, 
ušt64_t
 
uÎLaunchTime
)

21 : 
	`m_LoÿlS”v”ID
(
loÿlS”v”ID
)

22 , 
	`m_uÎLaunchTime
(
uÎLaunchTime
)

23 , 
	`m_LoÿlS”v”V”siÚ
(
LoÿlS”v”V”siÚ
)

24 , 
	`m_LoÿlS”v”Ty³
(
loÿlS”v”Ty³
)

25 , 
	`m_LoÿlS”v”Info
()

26 , 
	`m_cs_isLogš
()

27 , 
	`m_IsLogš
(
çl£
)

28 , 
	`m_cÚfig_impÜt
(
çl£
)

29 , 
	`m_MsIP
()

30 , 
	`m_MsPÜt
(0)

31 , 
	`m_MsID
(0)

32 , 
	`m_MsV”siÚ
()

33 , 
	$m_SessiÚID
(0)

35 
bufãr
[64] = {0};

36 
št32_t
 
»t
 = -1;

37 ià(
m_LoÿlS”v”Ty³
 =ğ
eLoÿlS”v”RecÜdšgS”v”
)

39 
»t
 = 
	`G‘S”v”Info_RecÜdšgS”v”
(
bufãr
, (buffer));

41 ià(
m_LoÿlS”v”Ty³
 =ğ
eLoÿlS”v”M‘ad©aS”v”
)

43 
»t
 = 
	`G‘S”v”Info_M‘ad©aS”v”
(
bufãr
, (buffer));

46 ià(
»t
 == 0)

48 
ušt32_t
 
i
 = 0; i < 64; i++)

50 
m_LoÿlS”v”Info
 +ğ
	`¡ršg_fÜm©
("%02X", 
bufãr
[
i
]);

53 
	}
}

55 
	gMsCl›Á
::~
	$MsCl›Á
()

58 
	}
}

60 
	g¡d
::
¡ršg
 
MsCl›Á
::
	$G‘LoÿlS”v”V”siÚ
() const

62  
m_LoÿlS”v”V”siÚ
;

63 
	}
}

65 
	g¡d
::
¡ršg
 
MsCl›Á
::
	$G‘LoÿlS”v”Info
() const

67  
m_LoÿlS”v”Info
;

68 
	}
}

70 
ušt64_t
 
	gMsCl›Á
::
	$G‘LoÿlS”v”ID
() const

72  
m_LoÿlS”v”ID
;

73 
	}
}

75 
ušt32_t
 
	gMsCl›Á
::
	$G‘SessiÚID
() const

77  
m_SessiÚID
;

78 
	}
}

80 
boŞ
 
	gMsCl›Á
::
	$CÚÃùToMs
(cÚ¡ 
¡d
::
¡ršg
& 
ÃwS”v”Ip
, cÚ¡ 
ušt16_t
& 
ÃwS”v”PÜt
,

81 cÚ¡ 
¡d
::
¡ršg
& 
ÃwU£ºame
, cÚ¡ std::¡ršg& 
ÃwPasswÜd
, 
boŞ
 
£rv”EÇbË
)

83 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_isLogš
);

86 ià(
m_IsLogš
)

88 ià(!
	`LogoutMs
())

90 
	`TRACE
("LogouˆMS % ç...\n", 
m_MsIP
.
	`c_¡r
());

93 
m_IsLogš
 = 
çl£
;

96 ià(
	`Regi¡”Ms
(
ÃwS”v”Ip
, 
ÃwS”v”PÜt
, 
ÃwU£ºame
, 
ÃwPasswÜd
))

98 ià(!
	`LogšMs
(
£rv”EÇbË
))

100 
	`TRACE
("Logš MS % ç...\n", 
ÃwS”v”Ip
.
	`c_¡r
());

101  
çl£
;

106 
	`TRACE
("Regi¡” MS % ç...\n", 
ÃwS”v”Ip
.
	`c_¡r
());

107 
	`ASSERT
(0);

108  
çl£
;

111  
Œue
;

112 
	}
}

114 
boŞ
 
	gMsCl›Á
::
	$DiscÚÃùToMs
(cÚ¡ 
¡d
::
¡ršg
& 
¡rU£r
, cÚ¡ std::¡ršg& 
¡rPasswÜd
)

116 
	`LogoutMs
();

119  
Œue
;

120 
	}
}

122 
boŞ
 
	gMsCl›Á
::
	$Regi¡”Ms
(cÚ¡ 
¡d
::
¡ršg
& 
ÃwS”v”IP
, cÚ¡ 
ušt16_t
& 
ÃwS”v”PÜt
,

123 cÚ¡ 
¡d
::
¡ršg
& 
ÃwU£ºame
, cÚ¡ std::¡ršg& 
ÃwPasswÜd
)

125 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 
	`A´TıSock‘
();

126 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

128 if(
ÃwS”v”IP
.
	`em±y
(è|| 
ÃwU£ºame
.empty())

130 
	`TRACE
("RegisterMs():‚ewServerIP or‚ewUsername might beƒmpty\n");

131  
çl£
;

134 ià(
pSock‘
->
	`cÚÃù
(
ÃwS”v”IP
.
	`c_¡r
(), 
ÃwS”v”PÜt
è!ğ
APR_SUCCESS
)

136 
	`TRACE
("Regi¡”M Cª'ˆcÚÃù M %s...\n", 
ÃwS”v”IP
.
	`c_¡r
());

137 
d–‘e
 
pSock‘
;

138  
çl£
;

142 
MsCl›ÁCommªd
::
Regi¡”Reque¡
 
»gi¡”_»que¡
;

143 
»gi¡”_»que¡
.
loÿl_£rv”_id
 = 
m_LoÿlS”v”ID
;

144 
»gi¡”_»que¡
.
loÿl_£rv”_v”siÚ
 = 
m_LoÿlS”v”V”siÚ
;

145 
»gi¡”_»que¡
.
loÿl_£rv”_šfo
 = 
m_LoÿlS”v”Info
;

146 
»gi¡”_»que¡
.
Ïunch_time
 = 
m_uÎLaunchTime
;

148 
MsCl›ÁCommÚ
::
AuthÜiz©iÚH—d”
 
authÜiz©iÚ
;

149 
authÜiz©iÚ
.
u£ºame
 = 
ÃwU£ºame
;

150 
authÜiz©iÚ
.
·sswÜd
 = 
ÃwPasswÜd
;

152 
	`S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³Regi¡”
, &
»gi¡”_»que¡
, &
authÜiz©iÚ
);

154 
MsCl›ÁCommªd
::
Regi¡”Re¥Ú£
 
»¥Ú£
;

155 ià(
MsCl›ÁCommªdP¬£r
::
	`P¬£Regi¡”Re¥Ú£
(
pSock‘
, 
m_LoÿlS”v”Ty³
, 
»¥Ú£
))

157 
m_MsIP
 = 
ÃwS”v”IP
;

158 
m_MsPÜt
 = 
ÃwS”v”PÜt
;

159 
m_MsID
 = 
»¥Ú£
.
mªagem’t_£rv”_id
;

160 
m_MsV”siÚ
 = 
»¥Ú£
.
mªagem’t_£rv”_v”siÚ
;

164 
d–‘e
 
pSock‘
;

165  
çl£
;

169 
d–‘e
 
pSock‘
;

170  
Œue
;

171 
	}
}

173 
boŞ
 
	gMsCl›Á
::
	$UÄegi¡”Ms
(cÚ¡ 
¡d
::
¡ršg
& 
ÃwS”v”IP
, cÚ¡ 
ušt16_t
& 
ÃwS”v”PÜt
, cÚ¡ std::¡ršg& 
ÃwU£ºame
, cÚ¡ std::¡ršg& 
ÃwPasswÜd
)

175 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 
	`A´TıSock‘
();

176 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

178 if(
ÃwS”v”IP
.
	`em±y
(è|| 
ÃwU£ºame
.empty())

180 
	`TRACE
("UnregisterMs():‚ewServerIP or‚ewUsername might beƒmpty\n");

181  
çl£
;

185 ià(
pSock‘
->
	`cÚÃù
(
ÃwS”v”IP
.
	`c_¡r
(), 
ÃwS”v”PÜt
è!ğ
APR_SUCCESS
)

187 
	`TRACE
("UÄegi¡”M Cª'ˆcÚÃù M %s...\n", 
ÃwS”v”IP
.
	`c_¡r
());

188 
d–‘e
 
pSock‘
;

189  
çl£
;

193 
MsCl›ÁCommªd
::
UÄegi¡”Reque¡
 
uÄegi¡”_»que¡
;

194 
uÄegi¡”_»que¡
.
loÿl_£rv”_id
 = 
m_LoÿlS”v”ID
;

195 
uÄegi¡”_»que¡
.
loÿl_£rv”_v”siÚ
 = 
m_LoÿlS”v”V”siÚ
;

197 
MsCl›ÁCommÚ
::
AuthÜiz©iÚH—d”
 
authÜiz©iÚ
;

198 
authÜiz©iÚ
.
u£ºame
 = 
ÃwU£ºame
;

199 
authÜiz©iÚ
.
·sswÜd
 = 
ÃwPasswÜd
;

201 
	`S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³UÄegi¡”
, &
uÄegi¡”_»que¡
, &
authÜiz©iÚ
);

203 
MsCl›ÁCommªd
::
UÄegi¡”Re¥Ú£
 
»¥Ú£
;

204 ià(!
MsCl›ÁCommªdP¬£r
::
	`P¬£UÄegi¡”Re¥Ú£
(
pSock‘
, 
»¥Ú£
))

206 
d–‘e
 
pSock‘
;

207  
çl£
;

211 
d–‘e
 
pSock‘
;

212  
Œue
;

213 
	}
}

215 
boŞ
 
	gMsCl›Á
::
	$LogšMs
(
boŞ
 
£rv”EÇbË
)

217 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 
	`A´TıSock‘
();

218 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

220 ià(
pSock‘
->
	`cÚÃù
(
m_MsIP
.
	`c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

222 
	`TRACE
("LogšM Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
	`c_¡r
());

223 
d–‘e
 
pSock‘
;

224 
	`ASSERT
(0);

225  
çl£
;

229 
MsCl›ÁCommªd
::
LogšReque¡
 
logš_»que¡
;

230 
logš_»que¡
.
loÿl_£rv”_id
 = 
m_LoÿlS”v”ID
;

231 
logš_»que¡
.
loÿl_£rv”_v”siÚ
 = 
m_LoÿlS”v”V”siÚ
;

232 
logš_»que¡
.
loÿl_£rv”_’abË
 = 
£rv”EÇbË
;

234 
	`S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³Logš
, &
logš_»que¡
);

236 
MsCl›ÁCommªd
::
LogšRe¥Ú£
 
»¥Ú£
;

237 ià(
MsCl›ÁCommªdP¬£r
::
	`P¬£LogšRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

239 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_isLogš
);

241 
m_IsLogš
 = 
Œue
;

242 
m_SessiÚID
 = 
»¥Ú£
.
£ssiÚ_id
;

243 
m_cÚfig_impÜt
 = 
»¥Ú£
.
cÚfig_impÜt
;

245 
ušt64_t
 
loÿlMSID
 = 
	`G‘S”v”ID_Mªagem’tS”v”
();

246 ià(
loÿlMSID
 !ğ
m_MsID
)

248 
	`SyncS”v”Time
();

253 
d–‘e
 
pSock‘
;

254 
	`ASSERT
(0);

255  
çl£
;

259 
d–‘e
 
pSock‘
;

260  
Œue
;

261 
	}
}

263 
boŞ
 
	gMsCl›Á
::
	$LogoutMs
()

265 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 
	`A´TıSock‘
();

266 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

268 ià(
pSock‘
->
	`cÚÃù
(
m_MsIP
.
	`c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

270 
	`TRACE
("LogoutM Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
	`c_¡r
());

271 
d–‘e
 
pSock‘
;

272 
	`ASSERT
(0);

273  
çl£
;

277 
MsCl›ÁCommªd
::
LogoutReque¡
 
logout_»que¡
;

278 
logout_»que¡
.
£ssiÚ_id
 = 
m_SessiÚID
;

279 
	`S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³Logout
, &
logout_»que¡
);

281 
MsCl›ÁCommªd
::
LogoutRe¥Ú£
 
»¥Ú£
;

282 ià(
MsCl›ÁCommªdP¬£r
::
	`P¬£LogoutRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

284 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_isLogš
);

286 
m_IsLogš
 = 
çl£
;

287 ià(
»¥Ú£
.
£ssiÚ_id
 !ğ
m_SessiÚID
)

289 
	`ASSERT
(0);

290 
	`TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

292 
m_SessiÚID
 = 0;

296 
d–‘e
 
pSock‘
;

297 
	`ASSERT
(0);

298  
çl£
;

302 
d–‘e
 
pSock‘
;

303  
Œue
;

304 
	}
}

306 
boŞ
 
	gMsCl›Á
::
	$G‘Sy¡emCÚfigTime¡amp
(
MsCl›ÁCommªd
::
G‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£
& 
»¥Ú£
)

308 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 
	`A´TıSock‘
();

309 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

311 ià(
pSock‘
->
	`cÚÃù
(
m_MsIP
.
	`c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

313 
	`TRACE
("G‘Sy¡emCÚfigTime¡am°Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
	`c_¡r
());

314 
d–‘e
 
pSock‘
;

315  
çl£
;

319 
MsCl›ÁCommªd
::
G‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡
 
g‘Sy¡emCÚfigTime¡amp_»que¡
;

320 
g‘Sy¡emCÚfigTime¡amp_»que¡
.
£ssiÚ_id
 = 
m_SessiÚID
;

321 
	`S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³G‘Sy¡emCÚfigu¿tiÚTime¡amp
, &
g‘Sy¡emCÚfigTime¡amp_»que¡
);

323 ià(
MsCl›ÁCommªdP¬£r
::
	`P¬£G‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

325 ià(
»¥Ú£
.
£ssiÚ_id
 !ğ
m_SessiÚID
)

327 
	`ASSERT
(0);

328 
	`TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

333 
d–‘e
 
pSock‘
;

334  
çl£
;

338 
d–‘e
 
pSock‘
;

339  
Œue
;

340 
	}
}

342 
boŞ
 
	gMsCl›Á
::
G‘Cl›ÁSessiÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt32_t
>& 
qu”ySessiÚIdLi¡
,

343 
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚRe¥Ú£
& 
»¥Ú£
)

345 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 AprTcpSocket();

346 
IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

348 ià(
	gpSock‘
->
cÚÃù
(
m_MsIP
.
c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

350 
TRACE
("G‘Cl›ÁSessiÚ Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
c_¡r
());

351 
d–‘e
 
	gpSock‘
;

352  
	gçl£
;

356 
	gMsCl›ÁCommªd
::
G‘Cl›ÁSessiÚReque¡
 
g‘SessiÚ_»que¡
;

357 
	gg‘SessiÚ_»que¡
.
	g£ssiÚ_id
 = 
m_SessiÚID
;

358 
	gg‘SessiÚ_»que¡
.
	gqu”y_£ssiÚ_id_li¡
 = 
qu”ySessiÚIdLi¡
;

359 
S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³G‘Cl›ÁSessiÚ
, &
g‘SessiÚ_»que¡
);

361 ià(
	gMsCl›ÁCommªdP¬£r
::
P¬£G‘Cl›ÁSessiÚRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

363 ià(
	g»¥Ú£
.
	g£ssiÚ_id
 !ğ
m_SessiÚID
)

365 
ASSERT
(0);

366 
TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

371 
d–‘e
 
	gpSock‘
;

372  
	gçl£
;

376 
d–‘e
 
	gpSock‘
;

377  
	gŒue
;

380 
boŞ
 
	gMsCl›Á
::
G‘U£rInfÜm©iÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
u£rIDLi¡
, std::veùÜ<
¡U£rD©a
>& 
»suÉD©aLi¡
)

382 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 AprTcpSocket();

383 
IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

385 ià(
	gpSock‘
->
cÚÃù
(
m_MsIP
.
c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

387 
TRACE
("G‘U£rInfÜm©iÚ Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
c_¡r
());

388 
d–‘e
 
	gpSock‘
;

389  
	gçl£
;

393 
	gMsCl›ÁCommªd
::
G‘U£rReque¡
 
g‘U£r_»que¡
;

394 
	gg‘U£r_»que¡
.
	g£ssiÚ_id
 = 
m_SessiÚID
;

395 
	gg‘U£r_»que¡
.
	gu£r_id_li¡
 = 
u£rIDLi¡
;

396 
S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³G‘U£r
, &
g‘U£r_»que¡
);

398 
	gMsCl›ÁCommªd
::
G‘U£rRe¥Ú£
 
»¥Ú£
;

399 ià(
	gMsCl›ÁCommªdP¬£r
::
P¬£G‘U£rRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

401 ià(
	g»¥Ú£
.
	g£ssiÚ_id
 !ğ
m_SessiÚID
)

403 
ASSERT
(0);

404 
TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

407 
	g»suÉD©aLi¡
.
ş—r
();

408 
	g»suÉD©aLi¡
 = 
»¥Ú£
.
u£r_li¡
;

412 
d–‘e
 
	gpSock‘
;

413  
	gçl£
;

417 
d–‘e
 
	gpSock‘
;

418  
	gŒue
;

421 
boŞ
 
	gMsCl›Á
::
G‘GroupInfÜm©iÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
groupIDLi¡
, std::veùÜ<
¡GroupD©a
>& 
»suÉD©aLi¡
)

423 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 AprTcpSocket();

424 
IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

426 ià(
	gpSock‘
->
cÚÃù
(
m_MsIP
.
c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

428 
TRACE
("G‘GroupInfÜm©iÚ Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
c_¡r
());

429 
d–‘e
 
	gpSock‘
;

430  
	gçl£
;

434 
	gMsCl›ÁCommªd
::
G‘GroupReque¡
 
g‘Group_»que¡
;

435 
	gg‘Group_»que¡
.
	g£ssiÚ_id
 = 
m_SessiÚID
;

436 
	gg‘Group_»que¡
.
	ggroup_id_li¡
 = 
groupIDLi¡
;

437 
S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³G‘Group
, &
g‘Group_»que¡
);

439 
	gMsCl›ÁCommªd
::
G‘GroupRe¥Ú£
 
»¥Ú£
;

440 ià(
	gMsCl›ÁCommªdP¬£r
::
P¬£G‘GroupRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

442 ià(
	g»¥Ú£
.
	g£ssiÚ_id
 !ğ
m_SessiÚID
)

444 
ASSERT
(0);

445 
TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

448 
	g»suÉD©aLi¡
.
ş—r
();

449 
	g»suÉD©aLi¡
 = 
»¥Ú£
.
group_li¡
;

453 
d–‘e
 
	gpSock‘
;

454  
	gçl£
;

458 
d–‘e
 
	gpSock‘
;

459  
	gŒue
;

462 
boŞ
 
	gMsCl›Á
::
G‘RŞeInfÜm©iÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
rŞeIDLi¡
, std::veùÜ<
¡RŞeD©a
>& 
»suÉD©aLi¡
)

464 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 AprTcpSocket();

465 
IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

467 ià(
	gpSock‘
->
cÚÃù
(
m_MsIP
.
c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

469 
TRACE
("G‘RŞeInfÜm©iÚ Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
c_¡r
());

470 
d–‘e
 
	gpSock‘
;

471  
	gçl£
;

475 
	gMsCl›ÁCommªd
::
G‘RŞeReque¡
 
g‘RŞe_»que¡
;

476 
	gg‘RŞe_»que¡
.
	g£ssiÚ_id
 = 
m_SessiÚID
;

477 
	gg‘RŞe_»que¡
.
	grŞe_id_li¡
 = 
rŞeIDLi¡
;

478 
S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³G‘RŞe
, &
g‘RŞe_»que¡
);

480 
	gMsCl›ÁCommªd
::
G‘RŞeRe¥Ú£
 
»¥Ú£
;

481 ià(
	gMsCl›ÁCommªdP¬£r
::
P¬£G‘RŞeRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

483 ià(
	g»¥Ú£
.
	g£ssiÚ_id
 !ğ
m_SessiÚID
)

485 
ASSERT
(0);

486 
TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

489 
	g»suÉD©aLi¡
.
ş—r
();

490 
	g»suÉD©aLi¡
 = 
»¥Ú£
.
rŞe_li¡
;

494 
d–‘e
 
	gpSock‘
;

495  
	gçl£
;

499 
d–‘e
 
	gpSock‘
;

500  
	gŒue
;

503 
boŞ
 
	gMsCl›Á
::
G‘ScheduËInfÜm©iÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
scheduËIDLi¡
,

504 
¡d
::
veùÜ
<
CScheduËBa£
 *>& 
»suÉD©aLi¡
)

506 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 AprTcpSocket();

507 
IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

509 ià(
	gpSock‘
->
cÚÃù
(
m_MsIP
.
c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

511 
TRACE
("G‘ScheduËInfÜm©iÚ Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
c_¡r
());

512 
d–‘e
 
	gpSock‘
;

513  
	gçl£
;

517 
	gMsCl›ÁCommªd
::
G‘ScheduËReque¡
 
g‘ScheduË_»que¡
;

518 
	gg‘ScheduË_»que¡
.
	g£ssiÚ_id
 = 
m_SessiÚID
;

519 
	gg‘ScheduË_»que¡
.
	gscheduË_id_li¡
 = 
scheduËIDLi¡
;

520 
S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³G‘ScheduË
, &
g‘ScheduË_»que¡
);

522 
	gMsCl›ÁCommªd
::
G‘ScheduËRe¥Ú£
 
»¥Ú£
;

523 ià(
	gMsCl›ÁCommªdP¬£r
::
P¬£G‘ScheduËRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

525 ià(
	g»¥Ú£
.
	g£ssiÚ_id
 !ğ
m_SessiÚID
)

527 
ASSERT
(0);

528 
TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

531 
	g»suÉD©aLi¡
.
ş—r
();

532 
	g»suÉD©aLi¡
 = 
»¥Ú£
.
scheduË_li¡
;

536 
d–‘e
 
	gpSock‘
;

537  
	gçl£
;

541 
d–‘e
 
	gpSock‘
;

542  
	gŒue
;

545 
boŞ
 
	gMsCl›Á
::
G‘ScheduËInfÜm©iÚDu¶
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
scheduËIDLi¡
, std::veùÜ<
CScheduËBa£
 *>& 
»suÉD©aLi¡
,

546 
¡d
::
veùÜ
<
CScheduËBa£
 *>& 
»suÉD©aLi¡2
)

548 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 AprTcpSocket();

549 
IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

551 ià(
	gpSock‘
->
cÚÃù
(
m_MsIP
.
c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

553 
TRACE
("G‘ScheduËInfÜm©iÚ Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
c_¡r
());

554 
d–‘e
 
	gpSock‘
;

555  
	gçl£
;

559 
	gMsCl›ÁCommªd
::
G‘ScheduËReque¡
 
g‘ScheduË_»que¡
;

560 
	gg‘ScheduË_»que¡
.
	g£ssiÚ_id
 = 
m_SessiÚID
;

561 
	gg‘ScheduË_»que¡
.
	gscheduË_id_li¡
 = 
scheduËIDLi¡
;

562 
S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³G‘ScheduË
, &
g‘ScheduË_»que¡
);

564 
	gMsCl›ÁCommªd
::
G‘ScheduËRe¥Ú£
 
»¥Ú£
, 
	g»¥Ú£2
;

565 ià(
	gMsCl›ÁCommªdP¬£r
::
P¬£G‘ScheduËRe¥Ú£Du¶
(
pSock‘
, 
»¥Ú£
, 
»¥Ú£2
))

567 ià(
	g»¥Ú£
.
	g£ssiÚ_id
 !ğ
m_SessiÚID
)

569 
ASSERT
(0);

570 
TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

573 
	g»suÉD©aLi¡
.
ş—r
();

574 
	g»suÉD©aLi¡
 = 
»¥Ú£
.
scheduË_li¡
;

576 
	g»suÉD©aLi¡2
.
ş—r
();

577 
	g»suÉD©aLi¡2
 = 
»¥Ú£2
.
scheduË_li¡
;

581 
d–‘e
 
	gpSock‘
;

582  
	gçl£
;

586 
d–‘e
 
	gpSock‘
;

587  
	gŒue
;

590 
boŞ
 
	gMsCl›Á
::
	$G‘PrivegeSequ’û
(
MsCl›ÁCommªd
::
G‘PrivegeSequ’ûRe¥Ú£
 &
»¥Ú£
)

592 
A´TıSock‘
 *
pSock‘
 = 
Ãw
 
	`A´TıSock‘
();

593 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

595 ià(
pSock‘
->
	`cÚÃù
(
m_MsIP
.
	`c_¡r
(), 
m_MsPÜt
è!ğ
APR_SUCCESS
)

597 
	`TRACE
("G‘PrivegeSequ’û Cª'ˆcÚÃù M %s...\n", 
m_MsIP
.
	`c_¡r
());

598 
d–‘e
 
pSock‘
;

599  
çl£
;

603 
MsCl›ÁCommªd
::
G‘PrivegeSequ’ûReque¡
 
g‘PrivgeSeq_»que¡
;

604 
g‘PrivgeSeq_»que¡
.
£ssiÚ_id
 = 
m_SessiÚID
;

605 
	`S’dG’”®CommªdToMs
(
pSock‘
, 
eCommªdTy³G‘PrivegeSequ’û
, &
g‘PrivgeSeq_»que¡
);

607 ià(
MsCl›ÁCommªdP¬£r
::
	`P¬£G‘PrivegeSequ’ûRe¥Ú£
(
pSock‘
, 
»¥Ú£
))

609 ià(
»¥Ú£
.
£ssiÚ_id
 !ğ
m_SessiÚID
)

611 
	`ASSERT
(0);

612 
	`TRACE
("£ssiÚ id i nÙ m©ched„e¥Ú£.£ssiÚ_id: %d, m_SessiÚID: %d\n", 
»¥Ú£
.
£ssiÚ_id
, 
m_SessiÚID
);

617 
d–‘e
 
pSock‘
;

618  
çl£
;

622 
d–‘e
 
pSock‘
;

623  
Œue
;

624 
	}
}

626 
ušt64_t
 
	gMsCl›Á
::
	$G‘MSS”v”ID
() const

628  
m_MsID
;

629 
	}
}

631 
boŞ
 
	gMsCl›Á
::
	$S’dG’”®CommªdToMs
(
A´TıSock‘
 *
pSock‘
, cÚ¡ 
CommªdTy³
& 
ty³
, cÚ¡ *
·¿m1
,

632 cÚ¡ *
·¿m2
)

634 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

635 
	`IF_NULL_RETURN_VALUE
(
·¿m1
, 
çl£
);

638 
boŞ
 
»suÉ
 = 
çl£
;

639 
¡d
::
¡ršg
 
¡rMes§ge
;

644 ià(
ty³
 =ğ
eCommªdTy³Regi¡”
)

646 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eRegi¡”Reque¡
((
MsCl›ÁCommªd
::
Regi¡”Reque¡
*è
·¿m1
,

647 (
MsCl›ÁCommÚ
::
AuthÜiz©iÚH—d”
*è
·¿m2
, 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

649 ià(
ty³
 =ğ
eCommªdTy³UÄegi¡”
)

651 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eUÄegi¡”Reque¡
((
MsCl›ÁCommªd
::
UÄegi¡”Reque¡
*è
·¿m1
,

652 (
MsCl›ÁCommÚ
::
AuthÜiz©iÚH—d”
*è
·¿m2
, 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

654 ià(
ty³
 =ğ
eCommªdTy³Logš
)

656 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eLogšReque¡
((
MsCl›ÁCommªd
::
LogšReque¡
*è
·¿m1
,

657 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

659 ià(
ty³
 =ğ
eCommªdTy³Logout
)

661 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eLogoutReque¡
((
MsCl›ÁCommªd
::
LogoutReque¡
*è
·¿m1
,

662 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

667 ià(
ty³
 =ğ
eCommªdTy³G‘Sy¡emCÚfigu¿tiÚTime¡amp
)

669 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eG‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡
(

670 (
MsCl›ÁCommªd
::
G‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡
*è
·¿m1
, 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

672 ià(
ty³
 =ğ
eCommªdTy³G‘U£r
)

674 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eG‘U£rReque¡
((
MsCl›ÁCommªd
::
G‘U£rReque¡
*è
·¿m1
,

675 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

677 ià(
ty³
 =ğ
eCommªdTy³G‘Group
)

679 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eG‘GroupReque¡
((
MsCl›ÁCommªd
::
G‘GroupReque¡
*è
·¿m1
,

680 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

682 ià(
ty³
 =ğ
eCommªdTy³G‘PrivegeSequ’û
)

684 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eG‘PrivegeSequ’ûReque¡
(

685 (
MsCl›ÁCommªd
::
G‘PrivegeSequ’ûReque¡
*è
·¿m1
, 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

687 ià(
ty³
 =ğ
eCommªdTy³G‘RŞe
)

689 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eG‘RŞeReque¡
((
MsCl›ÁCommªd
::
G‘RŞeReque¡
*è
·¿m1
,

690 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

692 ià(
ty³
 =ğ
eCommªdTy³G‘ScheduË
)

694 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eG‘ScheduËReque¡
((
MsCl›ÁCommªd
::
G‘ScheduËReque¡
*è
·¿m1
,

695 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

697 ià(
ty³
 =ğ
eCommªdTy³G‘Cl›ÁSessiÚ
)

699 
»suÉ
 = 
MsCl›ÁCommªdG’”©e
::
	`G’”©eG‘Cl›ÁSessiÚReque¡
(

700 (
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚReque¡
*è
·¿m1
, 
m_LoÿlS”v”Ty³
, 
¡rMes§ge
);

707 ià(
»suÉ
)

710 
	`Wr™eSock‘UÁTimeout
(
pSock‘
, 
¡rMes§ge
, 
TIMEOUT_SEND_MANAGEMENT_SERVER_COMMAND_REQUEST
);

714 
	`S’dH‰pE¼Ü
(
pSock‘
, 500, 
TIMEOUT_SEND_MANAGEMENT_SERVER_COMMAND_REQUEST
);

717  
»suÉ
;

718 
	}
}

720 
	gMsCl›Á
::
	$SyncS”v”Time
()

722 #ifdeà
WIN32


725 
boŞ
 
bNTP’abË
 = 
çl£
;

726 
cmd
[128];

727 
¡rNTP
[256];

729 
	`mem£t
(
cmd
, 0x0, (cmd));

730 
	`¥rštf
(
cmd
, "Ápd©%s", 
m_MsIP
.
	`c_¡r
());

733 
FILE
* 
pFe
 = 
	`pİ’
("ps‡ux | grep‚tpd", "r");

734 ià(
NULL
 =ğ
pFe
)

736 
	`ASSERT
(0);

737 
	`TRACE
("Get‚tp status failed!!\n");

742 0 =ğ
	`ãof
(
pFe
))

744 
	`¡rıy
(
¡rNTP
, "");

745 
	`fg‘s
(
¡rNTP
, 255, 
pFe
);

747 ià(
	`¡r¡r
(
¡rNTP
, "Ápd -c"è!ğ
NULL
)

749 
bNTP’abË
 = 
Œue
;

753 
	`pşo£
(
pFe
);

755 ià(
bNTP’abË
)

757 
	`TRACE
("NTP server is in use....\n");

758 
	`sy¡em
("killall‚tpd");

759 
	`sy¡em
(
cmd
);

760 
	`sy¡em
("/etc/init.d/ntp start");

764 
	`sy¡em
(
cmd
);

767 
	}
}

	@../../titanutils/MsClient/MsClient.h

1 #iâdeà
__MS_CLIENT_H__


2 
	#__MS_CLIENT_H__


	)

4 
	~"commÚ/š‰y³s.h
"

5 
	~"commÚ/ut™y.h
"

6 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

8 
	~"­r/­r_sock‘.h
"

9 
	~"PrÙocŞDefše/MsCl›ÁCommªdDefše.h
"

11 şas 
	cMsCl›Á


13 
	mpublic
:

16 
eLoÿlS”v”RecÜdšgS”v”
,

17 
	meLoÿlS”v”M‘ad©aS”v”
,

18 } 
	tLoÿlS”v”Ty³
;

23 
	geCommªdTy³Regi¡”
 = 1000,

24 
	geCommªdTy³UÄegi¡”
,

25 
	geCommªdTy³Logš
,

26 
	geCommªdTy³Logout
,

28 
	geCommªdTy³G‘Sy¡emCÚfigu¿tiÚTime¡amp
,

29 
	geCommªdTy³G‘U£r
,

30 
	geCommªdTy³G‘RŞe
,

31 
	geCommªdTy³G‘Group
,

32 
	geCommªdTy³G‘PrivegeSequ’û
,

33 
	geCommªdTy³G‘ScheduË
,

34 
	geCommªdTy³G‘Cl›ÁSessiÚ
,

35 } 
	tCommªdTy³
;

37 
	gpublic
:

38 
MsCl›Á
(cÚ¡ 
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
, cÚ¡ 
ušt64_t
& 
loÿlS”v”ID
,

39 cÚ¡ 
¡d
::
¡ršg
& 
LoÿlS”v”V”siÚ
, 
ušt64_t
 
uÎLaunchTime
);

40 
	gvœtu®
 ~
MsCl›Á
();

42 
ušt64_t
 
	$G‘LoÿlS”v”ID
() const;

43 
¡d
::
¡ršg
 
	$G‘LoÿlS”v”V”siÚ
() const;

44 
¡d
::
¡ršg
 
	$G‘LoÿlS”v”Info
() const;

47 
boŞ
 
	`CÚÃùToMs
(cÚ¡ 
¡d
::
¡ršg
& 
£rv”IP
, cÚ¡ 
ušt16_t
& 
£rv”PÜt
, cÚ¡ std::¡ršg& 
u£ºame
,

48 cÚ¡ 
¡d
::
¡ršg
& 
·sswÜd
, 
boŞ
 
£rv”EÇbË
 = 
Œue
);

49 
boŞ
 
	`DiscÚÃùToMs
(cÚ¡ 
¡d
::
¡ršg
& 
¡rU£ºame
, cÚ¡ std::¡ršg& 
¡rPasswÜd
);

50 
boŞ
 
	`Regi¡”Ms
(cÚ¡ 
¡d
::
¡ršg
& 
ÃwS”v”IP
, cÚ¡ 
ušt16_t
& 
ÃwS”v”PÜt
, cÚ¡ std::¡ršg& 
ÃwU£ºame
,

51 cÚ¡ 
¡d
::
¡ršg
& 
ÃwPasswÜd
);

52 
boŞ
 
	`LogšMs
(boŞ 
£rv”EÇbË
);

53 
boŞ
 
	`UÄegi¡”Ms
(cÚ¡ 
¡d
::
¡ršg
& 
ÃwS”v”IP
, cÚ¡ 
ušt16_t
& 
ÃwS”v”PÜt
, cÚ¡ std::¡ršg& 
ÃwU£ºame
,

54 cÚ¡ 
¡d
::
¡ršg
& 
ÃwPasswÜd
);

55 
boŞ
 
	`LogoutMs
();

56 
boŞ
 
	$IsCÚfigImpÜt
(){  
m_cÚfig_impÜt
;
	}
}

58 
vœtu®
 
boŞ
 
IsLogš
() = 0;

61 
boŞ
 
G‘Sy¡emCÚfigTime¡amp
(
MsCl›ÁCommªd
::
G‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£
& 
»¥Ú£
);

62 
boŞ
 
G‘U£rInfÜm©iÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
u£rIDLi¡
, std::veùÜ<
¡U£rD©a
>& 
»suÉD©aLi¡
);

63 
boŞ
 
G‘GroupInfÜm©iÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
groupIDLi¡
, std::veùÜ<
¡GroupD©a
>& 
»suÉD©aLi¡
);

64 
boŞ
 
G‘RŞeInfÜm©iÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
rŞeIDLi¡
, std::veùÜ<
¡RŞeD©a
>& 
»suÉD©aLi¡
);

65 
boŞ
 
G‘ScheduËInfÜm©iÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
scheduËIDLi¡
, std::veùÜ<
CScheduËBa£
 *>& 
»suÉD©aLi¡
);

66 
boŞ
 
G‘ScheduËInfÜm©iÚDu¶
(cÚ¡ 
¡d
::
veùÜ
<
ušt64_t
>& 
scheduËIDLi¡
, std::veùÜ<
CScheduËBa£
 *>& 
»suÉD©aLi¡
,

67 
¡d
::
veùÜ
<
CScheduËBa£
 *>& 
»suÉD©aLi¡2
);

68 
boŞ
 
G‘Cl›ÁSessiÚ
(cÚ¡ 
¡d
::
veùÜ
<
ušt32_t
>& 
qu”ySessiÚIdLi¡
,

69 
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚRe¥Ú£
& 
»¥Ú£
);

70 
ušt32_t
 
	$G‘SessiÚID
() const;

71 
boŞ
 
	`G‘PrivegeSequ’û
(
MsCl›ÁCommªd
::
G‘PrivegeSequ’ûRe¥Ú£
 &
»¥Ú£
);

72 
ušt64_t
 
	$G‘MSS”v”ID
() const;

74 
	`SyncS”v”Time
();

76 
´Ùeùed
:

78 
boŞ
 
	`S’dG’”®CommªdToMs
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, cÚ¡ 
CommªdTy³
& 
ty³
, cÚ¡ *
·¿m1
,

79 cÚ¡ *
·¿m2
 = 
NULL
);

82 
vœtu®
 
boŞ
 
	`S’dS³cificCommªdToMs
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, cÚ¡ 
¡d
::
¡ršg
& 
ty³
,

83 cÚ¡ *
·¿m1
, cÚ¡ *
·¿m2
 = 
NULL
) = 0;

85 
´iv©e
:

86 
	`MsCl›Á
(cÚ¡ 
MsCl›Á
& 
rhs
);

87 
MsCl›Á
& 
İ”©Ü
=(cÚ¡ MsCl›Á& 
rhs
);

89 
´Ùeùed
:

90 
ušt64_t
 
m_LoÿlS”v”ID
;

91 
ušt64_t
 
m_uÎLaunchTime
;

92 
¡d
::
¡ršg
 
m_LoÿlS”v”V”siÚ
;

93 
LoÿlS”v”Ty³
 
m_LoÿlS”v”Ty³
;

94 
¡d
::
¡ršg
 
m_LoÿlS”v”Info
;

96 
´Ùeùed
:

97 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs_isLogš
;

98 
boŞ
 
m_IsLogš
;

99 
boŞ
 
m_cÚfig_impÜt
;

101 
¡d
::
¡ršg
 
m_MsIP
;

102 
ušt16_t
 
m_MsPÜt
;

103 
ušt64_t
 
m_MsID
;

104 
¡d
::
¡ršg
 
m_MsV”siÚ
;

106 
ušt32_t
 
m_SessiÚID
;

107 
	}
};

	@../../titanutils/MsClient/MsClientParameters.h

1 #iâdeà
__MS_CLIENT_PARAMETERS_H__


2 
	#__MS_CLIENT_PARAMETERS_H__


	)

5 
	#TIMEOUT_MANAGEMENT_SERVER_SOCKET_REQUEST
 (500)

6 

	)

8 
	#TIMEOUT_MANAGEMENT_SERVER_RESPONDER_REQUEST
 (30000)

9 

	)

11 
	#TIMEOUT_SEND_MANAGEMENT_SERVER_COMMAND_REQUEST
 (5000)

12 

	)

14 
	#TIMER_CHECK_MANAGEMENT_SERVER_EVENT_SESSION_MANAGER
 (10000)

15 

	)

17 
	#TIMER_CHECK_MANAGEMENT_SERVER_EVENT_SESSION
 (3000)

18 

	)

20 
	#TIMER_CHECK_MANAGEMENT_SERVER_DATA_SESSION_MANAGER
 (10000)

21 

	)

23 
	#TIMER_CHECK_MANAGEMENT_SERVER_DATA_SESSION
 (3000)

24 

	)

	@../../titanutils/MsClient/ProtocolDefine/MsClientCommandDefine.h

1 #iâdeà
__MS_CLIENT_COMMAND_DEFINE_H__


2 
	#__MS_CLIENT_COMMAND_DEFINE_H__


	)

4 
	~"£rv”CÚfig/MsU£rD©aI‹m.h
"

6 şas 
	cMsCl›ÁCommªd


8 
	mpublic
:

12 
	sRegi¡”Reque¡


14 
ušt64_t
 
loÿl_£rv”_id
;

15 
	m¡d
::
¡ršg
 
loÿl_£rv”_v”siÚ
;

16 
	m¡d
::
¡ršg
 
loÿl_£rv”_šfo
;

17 
ušt64_t
 
	mÏunch_time
;

19 
Regi¡”Reque¡
()

20 : 
loÿl_£rv”_id
(
UINT64_C
(0))

21 , 
loÿl_£rv”_v”siÚ
()

22 , 
loÿl_£rv”_šfo
()

23 , 
Ïunch_time
(
UINT64_C
(0))

26 
	sRegi¡”Re¥Ú£


28 
ušt32_t
 
	g»tuº_code
;

29 
ušt64_t
 
	gmªagem’t_£rv”_id
;

30 
	g¡d
::
¡ršg
 
mªagem’t_£rv”_v”siÚ
;

32 
Regi¡”Re¥Ú£
()

33 : 
»tuº_code
(
UINT32_C
(0))

34 , 
mªagem’t_£rv”_id
(
UINT64_C
(0))

35 , 
mªagem’t_£rv”_v”siÚ
()

42 
	sUÄegi¡”Reque¡


44 
ušt64_t
 
	gloÿl_£rv”_id
;

45 
	g¡d
::
¡ršg
 
loÿl_£rv”_v”siÚ
;

47 
UÄegi¡”Reque¡
()

48 : 
loÿl_£rv”_id
(
UINT64_C
(0))

49 , 
loÿl_£rv”_v”siÚ
()

53 
	sUÄegi¡”Re¥Ú£


55 
ušt32_t
 
	g»tuº_code
;

57 
UÄegi¡”Re¥Ú£
()

58 : 
»tuº_code
(
UINT32_C
(0))

65 
	sLogšReque¡


67 
ušt64_t
 
	gloÿl_£rv”_id
;

68 
	g¡d
::
¡ršg
 
loÿl_£rv”_v”siÚ
;

69 
boŞ
 
	gloÿl_£rv”_’abË
;

71 
LogšReque¡
()

72 : 
loÿl_£rv”_id
(
UINT64_C
(0))

73 , 
loÿl_£rv”_v”siÚ
()

74 , 
loÿl_£rv”_’abË
(
çl£
)

77 
	sLogšRe¥Ú£


79 
ušt32_t
 
	g£ssiÚ_id
;

80 
boŞ
 
	gcÚfig_impÜt
;

81 
ušt32_t
 
	g»tuº_code
;

83 
LogšRe¥Ú£
()

84 : 
£ssiÚ_id
(
UINT32_C
(0))

85 , 
cÚfig_impÜt
(
çl£
)

86 , 
»tuº_code
(
UINT32_C
(0))

93 
	sLogoutReque¡


95 
ušt32_t
 
	g£ssiÚ_id
;

97 
LogoutReque¡
()

98 : 
£ssiÚ_id
(
UINT32_C
(0))

101 
	sLogoutRe¥Ú£


103 
ušt32_t
 
	g£ssiÚ_id
;

104 
ušt32_t
 
	g»tuº_code
;

106 
LogoutRe¥Ú£
()

107 : 
£ssiÚ_id
(
UINT32_C
(0))

108 , 
»tuº_code
(
UINT32_C
(0))

115 
	sG‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡


117 
ušt32_t
 
	g£ssiÚ_id
;

119 
G‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡
()

120 : 
£ssiÚ_id
(
UINT32_C
(0))

124 
	sG‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£


126 
ušt32_t
 
	g£ssiÚ_id
;

127 
ušt32_t
 
	g»tuº_code
;

128 
ušt64_t
 
	gu£r_time¡amp
;

129 
ušt64_t
 
	ggroup_time¡amp
;

130 
ušt64_t
 
	grŞe_time¡amp
;

131 
ušt64_t
 
	gscheduË_time¡amp
;

133 
G‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£
()

134 : 
£ssiÚ_id
(
UINT32_C
(0))

135 , 
»tuº_code
(
UINT32_C
(0))

136 , 
u£r_time¡amp
(
UINT64_C
(0))

137 , 
group_time¡amp
(
UINT64_C
(0))

138 , 
rŞe_time¡amp
(
UINT64_C
(0))

139 , 
scheduË_time¡amp
(
UINT64_C
(0))

146 
	sG‘U£rReque¡


148 
ušt32_t
 
	g£ssiÚ_id
;

149 
	g¡d
::
veùÜ
<
ušt64_t
> 
u£r_id_li¡
;

151 
G‘U£rReque¡
()

152 : 
£ssiÚ_id
(
UINT32_C
(0))

153 , 
u£r_id_li¡
()

157 
	sG‘U£rRe¥Ú£


159 
ušt32_t
 
	g£ssiÚ_id
;

160 
ušt32_t
 
	g»tuº_code
;

161 
	g¡d
::
veùÜ
<
¡U£rD©a
> 
u£r_li¡
;

163 
G‘U£rRe¥Ú£
()

164 : 
£ssiÚ_id
(
UINT32_C
(0))

165 , 
»tuº_code
(
UINT32_C
(0))

166 , 
u£r_li¡
()

173 
	sG‘GroupReque¡


175 
ušt32_t
 
	g£ssiÚ_id
;

176 
	g¡d
::
veùÜ
<
ušt64_t
> 
group_id_li¡
;

178 
G‘GroupReque¡
()

179 : 
£ssiÚ_id
(
UINT32_C
(0))

180 , 
group_id_li¡
()

184 
	sG‘GroupRe¥Ú£


186 
ušt32_t
 
	g£ssiÚ_id
;

187 
ušt32_t
 
	g»tuº_code
;

188 
	g¡d
::
veùÜ
<
¡GroupD©a
> 
group_li¡
;

190 
G‘GroupRe¥Ú£
()

191 : 
£ssiÚ_id
(
UINT32_C
(0))

192 , 
»tuº_code
(
UINT32_C
(0))

193 , 
group_li¡
()

200 
	sG‘PrivegeSequ’ûReque¡


202 
ušt32_t
 
	g£ssiÚ_id
;

204 
G‘PrivegeSequ’ûReque¡
()

205 : 
£ssiÚ_id
(
UINT32_C
(0))

209 
	sG‘PrivegeSequ’ûRe¥Ú£


211 
ušt32_t
 
	g£ssiÚ_id
;

212 
ušt32_t
 
	g»tuº_code
;

213 
	g¡d
::
veùÜ
<
¡AcûssRight
> 
´ivege_li¡
;

215 
G‘PrivegeSequ’ûRe¥Ú£
()

216 : 
£ssiÚ_id
(
UINT32_C
(0))

217 , 
»tuº_code
(
UINT32_C
(0))

225 
	sG‘RŞeReque¡


227 
ušt32_t
 
	g£ssiÚ_id
;

228 
	g¡d
::
veùÜ
<
ušt64_t
> 
rŞe_id_li¡
;

230 
G‘RŞeReque¡
()

231 : 
£ssiÚ_id
(
UINT32_C
(0))

232 , 
rŞe_id_li¡
()

236 
	sG‘RŞeRe¥Ú£


238 
ušt32_t
 
	g£ssiÚ_id
;

239 
ušt32_t
 
	g»tuº_code
;

240 
	g¡d
::
veùÜ
<
¡RŞeD©a
> 
rŞe_li¡
;

242 
G‘RŞeRe¥Ú£
()

243 : 
£ssiÚ_id
(
UINT32_C
(0))

244 , 
»tuº_code
(
UINT32_C
(0))

245 , 
rŞe_li¡
()

252 
	sG‘ScheduËReque¡


254 
ušt32_t
 
	g£ssiÚ_id
;

255 
	g¡d
::
veùÜ
<
ušt64_t
> 
scheduË_id_li¡
;

257 
G‘ScheduËReque¡
()

258 : 
£ssiÚ_id
(
UINT32_C
(0))

259 , 
scheduË_id_li¡
()

263 
	sG‘ScheduËRe¥Ú£


265 
ušt32_t
 
	g£ssiÚ_id
;

266 
ušt32_t
 
	g»tuº_code
;

267 
	g¡d
::
veùÜ
<
CScheduËBa£
 *> 
scheduË_li¡
;

269 
G‘ScheduËRe¥Ú£
()

270 : 
£ssiÚ_id
(
UINT32_C
(0))

271 , 
»tuº_code
(
UINT32_C
(0))

272 , 
scheduË_li¡
()

279 
	s¡SessiÚ


281 
ušt32_t
 
	g£ssiÚ_id
;

282 
ušt64_t
 
	gu£r_id
;

283 
ušt64_t
 
	grŞe_id
;

285 
¡SessiÚ
()

286 : 
£ssiÚ_id
(
UINT32_C
(0))

287 , 
u£r_id
(
UINT64_C
(0))

288 , 
rŞe_id
(
UINT64_C
(0))

292 
	sG‘Cl›ÁSessiÚReque¡


294 
ušt32_t
 
	g£ssiÚ_id
;

295 
	g¡d
::
veùÜ
<
ušt32_t
> 
qu”y_£ssiÚ_id_li¡
;

297 
G‘Cl›ÁSessiÚReque¡
()

298 : 
£ssiÚ_id
(
UINT32_C
(0))

302 
	sG‘Cl›ÁSessiÚRe¥Ú£


304 
ušt32_t
 
	g£ssiÚ_id
;

305 
ušt32_t
 
	g»tuº_code
;

306 
	g¡d
::
veùÜ
<
¡SessiÚ
> 
£ssiÚ_li¡
;

308 
G‘Cl›ÁSessiÚRe¥Ú£
()

309 : 
£ssiÚ_id
(
UINT32_C
(0))

310 , 
»tuº_code
(
UINT32_C
(0))

311 , 
£ssiÚ_li¡
()

315 
	g´iv©e
:

316 
MsCl›ÁCommªd
();

317 ~
MsCl›ÁCommªd
();

	@../../titanutils/MsClient/ProtocolDefine/MsClientCommonDefine.h

1 #iâdeà
__MS_CLIENT_COMMON_DEFINE_H__


2 
	#__MS_CLIENT_COMMON_DEFINE_H__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~<¡ršg
>

8 şas 
	cMsCl›ÁCommÚ


10 
	mpublic
:

11 
	sAuthÜiz©iÚH—d”


13 
¡d
::
¡ršg
 
u£ºame
;

14 
	m¡d
::
¡ršg
 
·sswÜd
;

16 
AuthÜiz©iÚH—d”
()

17 : 
u£ºame
()

18 , 
·sswÜd
()

22 
	sCommªdReque¡H—d”


24 
ušt32_t
 
	g£ssiÚ_id
;

26 
CommªdReque¡H—d”
()

27 : 
£ssiÚ_id
(0)

31 
	sCommªdRe¥Ú£H—d”


33 
ušt32_t
 
	g£ssiÚ_id
;

34 
ušt32_t
 
	g»tuº_code
;

36 
CommªdRe¥Ú£H—d”
()

37 : 
£ssiÚ_id
(0)

38 , 
»tuº_code
(0)

42 
	g´iv©e
:

43 
MsCl›ÁCommÚ
();

44 ~
MsCl›ÁCommÚ
();

	@../../titanutils/MsClient/ProtocolDefine/MsClientDataSessionDefine.h

1 #iâdeà
__MS_CLIENT_DATA_SESSION_DEFINE_H__


2 
	#__MS_CLIENT_DATA_SESSION_DEFINE_H__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~<¡ršg
>

7 
	~<veùÜ
>

9 şas 
	cMsCl›ÁD©aSessiÚ


11 
	mpublic
:

12 
	sCommÚReque¡


14 
ušt32_t
 
£ssiÚ_id
;

16 
CommÚReque¡
()

17 : 
£ssiÚ_id
(
UINT32_C
(0))

21 
	sCommÚRe¥Ú£


23 
ušt32_t
 
	g£ssiÚ_id
;

24 
ušt32_t
 
	g»tuº_code
;

26 
CommÚRe¥Ú£
()

27 : 
£ssiÚ_id
(
UINT32_C
(0))

28 , 
»tuº_code
(
UINT32_C
(0))

35 
	gC»©eD©aSessiÚReque¡
: 
public
 
CommÚReque¡


38 
	gC»©eD©aSessiÚRe¥Ú£
: 
public
 
CommÚRe¥Ú£


45 
	gClo£D©aSessiÚReque¡
: 
public
 
CommÚReque¡


48 
	gClo£D©aSessiÚRe¥Ú£
: 
public
 
CommÚRe¥Ú£


55 
	gR’ewSessiÚReque¡
: 
public
 
CommÚReque¡


62 
	gK“pAliveReque¡
: 
public
 
CommÚReque¡


69 
	sReque¡Stus


71 
ušt32_t
 
	g»que¡ID
;

72 
ušt32_t
 
	g¡©usID
;

74 
	gD©aSessiÚStusReque¡
: 
public
 
CommÚReque¡


76 
ušt64_t
 
£rv”ID
;

77 
ušt32_t
 
	g»que¡ID
;

78 
	g¡d
::
veùÜ
<
ušt32_t
> 
»que¡IDLi¡
;

80 
	gD©aSessiÚStusRe¥Ú£
: 
public
 
CommÚRe¥Ú£


82 
ušt64_t
 
£rv”ID
;

83 
ušt32_t
 
	g»que¡ID
;

84 
	g¡d
::
veùÜ
<
Reque¡Stus
> 
»que¡StusLi¡
;

90 
	gRemÙeCÚŒŞReque¡
: 
public
 
CommÚReque¡


92 
	eTaskTy³


94 
eTaskTy³Lib¿ry
 = 0xEEDD,

95 
	geTaskTy³Com´es£dFe
,

98 
ušt64_t
 
	g£rv”ID
;

99 
ušt32_t
 
	g»que¡ID
;

100 
TaskTy³
 
	gskTy³
;

101 
	g¡d
::
¡ršg
 
¬g
;

102 
	g¡d
::
¡ršg
 
cÚ‹Á
;

104 
	gRemÙeCÚŒŞRe¥Ú£
: 
public
 
CommÚRe¥Ú£


106 
ušt64_t
 
£rv”ID
;

107 
ušt32_t
 
	g»que¡ID
;

113 
	gC’Œ®izedUpg¿deReque¡
: 
public
 
CommÚReque¡


116 
	gC’Œ®izedUpg¿deRe¥Ú£
: 
public
 
CommÚRe¥Ú£


118 
ušt64_t
 
£rv”ID
;

119 
ušt32_t
 
	g»que¡ID
;

122 
	g´iv©e
:

123 
MsCl›ÁD©aSessiÚ
();

124 ~
MsCl›ÁD©aSessiÚ
();

	@../../titanutils/MsClient/ProtocolDefine/MsClientEventSessionDefine.h

1 #iâdeà
__MS_CLIENT_EVENT_SESSION_DEFINE_H__


2 
	#__MS_CLIENT_EVENT_SESSION_DEFINE_H__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~<¡ršg
>

7 
	~<veùÜ
>

9 şas 
	cMsCl›ÁEv’tSessiÚ


11 
	mpublic
:

12 
	sCommÚReque¡


14 
ušt32_t
 
£ssiÚ_id
;

16 
CommÚReque¡
()

17 : 
£ssiÚ_id
(
UINT32_C
(0))

21 
	sCommÚRe¥Ú£


23 
ušt32_t
 
	g£ssiÚ_id
;

24 
ušt32_t
 
	g»tuº_code
;

26 
CommÚRe¥Ú£
()

27 : 
£ssiÚ_id
(
UINT32_C
(0))

28 , 
»tuº_code
(
UINT32_C
(0))

35 
	gC»©eEv’tSessiÚReque¡
: 
public
 
CommÚReque¡


38 
	gC»©eEv’tSessiÚRe¥Ú£
: 
public
 
CommÚRe¥Ú£


45 
	gClo£Ev’tSessiÚReque¡
: 
public
 
CommÚReque¡


48 
	gClo£Ev’tSessiÚRe¥Ú£
: 
public
 
CommÚRe¥Ú£


55 
	gR’ewSessiÚReque¡
: 
public
 
CommÚReque¡


62 
	gS’dEmaNÙifiÿtiÚReque¡
: 
public
 
CommÚReque¡


64 
¡d
::
veùÜ
<
ušt32_t
> 
emaIDLi¡
;

70 
	gK“pAliveReque¡
: 
public
 
CommÚReque¡


74 
	sChªgeI‹m


76 
ušt64_t
 
	gchªge_id
;

77 
ušt32_t
 
	gchªge_ty³
;

82 
	gU£rChªgedReque¡
: 
public
 
CommÚReque¡


84 
¡d
::
veùÜ
<
ChªgeI‹m
> 
vChªgeI‹m
;

85 
ušt64_t
 
	guÎTime
;

91 
	gGroupChªgedReque¡
: 
public
 
CommÚReque¡


93 
¡d
::
veùÜ
<
ChªgeI‹m
> 
vChªgeI‹m
;

94 
ušt64_t
 
	guÎTime
;

100 
	gRŞeChªgedReque¡
: 
public
 
CommÚReque¡


102 
¡d
::
veùÜ
<
ChªgeI‹m
> 
vChªgeI‹m
;

103 
ušt64_t
 
	guÎTime
;

109 
	gScheduËChªgedReque¡
: 
public
 
CommÚReque¡


111 
¡d
::
veùÜ
<
ChªgeI‹m
> 
vChªgeI‹m
;

112 
ušt64_t
 
	guÎTime
;

118 
	gF‹rProfeChªgedReque¡
: 
public
 
CommÚReque¡


120 
¡d
::
veùÜ
<
ChªgeI‹m
> 
vChªgeI‹m
;

121 
ušt64_t
 
	guÎTime
;

127 
	gAssocŸ‹Li¡ChªgedReque¡
: 
public
 
CommÚReque¡


135 
	gLiûn£ChªgedReque¡
: 
public
 
CommÚReque¡


143 
	gRemÙeEv’tAùiÚChªgedReque¡
: 
public
 
CommÚReque¡


145 
ušt64_t
 
uÎTime
;

149 
	sRemÙeAùiÚSouûInfo


151 
ušt64_t
 
	gS”v”ID
;

152 
ušt64_t
 
	gDeviûID
;

153 
ušt32_t
 
	gEv’tID
;

155 
	gEv’tTrigg”RemÙeAùiÚ
: 
public
 
CommÚReque¡


157 
RemÙeAùiÚSouûInfo
 
SouûInfo
;

163 
	gCam”aRecÜdScheduËChªgedReque¡
 : 
public
 
CommÚReque¡


165 
¡d
::
veùÜ
<
ušt64_t
> 
»cÜdšg_£rv”_id_li¡
;

168 
	gSessiÚChªgedI‹m
: 
public
 
CommÚReque¡


170 
ušt32_t
 
chªge_ty³
;

171 
ušt64_t
 
	grŞe_id
;

174 
	gSessiÚChªgeReque¡
: 
public
 
CommÚReque¡


176 
¡d
::
veùÜ
<
SessiÚChªgedI‹m
> 
£ssiÚ_chªge_li¡
;

179 
	g´iv©e
:

180 
MsCl›ÁEv’tSessiÚ
();

181 ~
MsCl›ÁEv’tSessiÚ
();

	@../../titanutils/MsClient/ProtocolOperation/MsClientCommandGenerate.cpp

1 
	~"MsCl›ÁCommªdG’”©e.h
"

3 
	~"commÚ/¡dšt.h
"

4 
	~"commÚ/ut™y.h
"

6 
	~"sûw/xml_Œ“.h
"

8 
	~"T™ªCommÚ/CommÚSŒšg.h
"

10 
	~"debugMsg/Debug.h
"

12 
	~"T™ªCommÚ/CommÚUt™y.h
"

14 
	~"vmbackdoÜ/vmbackdoÜ.h
"

16 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

18 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eRegi¡”Reque¡
(cÚ¡ 
MsCl›ÁCommªd
::
Regi¡”Reque¡
 *
»gi¡”Reque¡
, cÚ¡ 
MsCl›ÁCommÚ
::
AuthÜiz©iÚH—d”
 *
authÜiz©iÚ
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

20 
	`IF_NULL_RETURN_VALUE
(
»gi¡”Reque¡
, 
çl£
);

21 
	`IF_NULL_RETURN_VALUE
(
authÜiz©iÚ
, 
çl£
);

23 
XMLT»e
 
Œ“
;

24 
XMLEËm’t
 
roÙ
, 
chd
;

27 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("Register");

28 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

30 
chd
 = 
roÙ
.
	`AddChd
("RecordingServer");

32 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

34 
chd
 = 
roÙ
.
	`AddChd
("MetadataServer");

38  
çl£
;

41 
ProduùInfo
 
´oduùInfo
;

42 
	`G‘ProduùInfo
(
´oduùInfo
);

44 
VMX_Ty³
 
vmTy³
 = 
VMX_TYPE_UNSET
;

45 
	`g‘Ho¡Ty³
(
vmTy³
);

47 
chd
.
	`AddA‰ribu‹
("id", 
»gi¡”Reque¡
->
loÿl_£rv”_id
);

48 
chd
.
	`AddA‰ribu‹
("v”siÚ", 
»gi¡”Reque¡
->
loÿl_£rv”_v”siÚ
);

49 
chd
.
	`AddA‰ribu‹
("šfo", 
»gi¡”Reque¡
->
loÿl_£rv”_šfo
);

50 
chd
.
	`AddA‰ribu‹
("machšeKey", 
´oduùInfo
.
¡rMachšeKey
);

51 
chd
.
	`AddA‰ribu‹
("ÛmName", 
´oduùInfo
.
¡rOEMName
);

52 
chd
.
	`AddA‰ribu‹
("vmTy³", 
vmTy³
);

54 
roÙ
.
	`AddChd
("LaunchTime", 
»gi¡”Reque¡
->
Ïunch_time
);

56 
¡d
::
¡ršg
 
¡rMes§geBody
;

57 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

59 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

61 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/Register");

63 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

65 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/Register");

68 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

69 
	`G’”©eAuthÜiz©iÚH—d”
(
authÜiz©iÚ
->
u£ºame
,‡uthÜiz©iÚ->
·sswÜd
) +

70 
	`G’”©eSessiÚIDH—d”
(0) +

71 
CRLF
 +

72 
¡rMes§geBody
;

74  
Œue
;

75 
	}
}

77 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eUÄegi¡”Reque¡
(cÚ¡ 
MsCl›ÁCommªd
::
UÄegi¡”Reque¡
 *
uÄegi¡”Reque¡
, cÚ¡ 
MsCl›ÁCommÚ
::
AuthÜiz©iÚH—d”
 *
authÜiz©iÚ
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

79 
	`IF_NULL_RETURN_VALUE
(
uÄegi¡”Reque¡
, 
çl£
);

80 
	`IF_NULL_RETURN_VALUE
(
authÜiz©iÚ
, 
çl£
);

82 
XMLT»e
 
Œ“
;

83 
XMLEËm’t
 
roÙ
;

84 
XMLEËm’t
 
chd
;

87 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("Unregister");

88 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

90 
chd
 = 
roÙ
.
	`AddChd
("RecordingServer");

92 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

94 
chd
 = 
roÙ
.
	`AddChd
("MetadataServer");

98  
çl£
;

100 
chd
.
	`AddA‰ribu‹
("id", 
uÄegi¡”Reque¡
->
loÿl_£rv”_id
);

101 
chd
.
	`AddA‰ribu‹
("v”siÚ", 
uÄegi¡”Reque¡
->
loÿl_£rv”_v”siÚ
);

103 
¡d
::
¡ršg
 
¡rMes§geBody
;

104 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

106 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

108 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/Unregister");

110 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

112 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/Unregister");

115 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

116 
	`G’”©eAuthÜiz©iÚH—d”
(
authÜiz©iÚ
->
u£ºame
,‡uthÜiz©iÚ->
·sswÜd
) +

117 
	`G’”©eSessiÚIDH—d”
(0) +

118 
CRLF
 +

119 
¡rMes§geBody
;

121  
Œue
;

122 
	}
}

124 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eLogšReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
LogšReque¡
 *
logšReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

126 
	`IF_NULL_RETURN_VALUE
(
logšReque¡
, 
çl£
);

128 
XMLT»e
 
Œ“
;

129 
XMLEËm’t
 
roÙ
;

130 
XMLEËm’t
 
chd
;

133 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("Login");

135 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

137 
chd
 = 
roÙ
.
	`AddChd
("RecordingServer");

139 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

141 
chd
 = 
roÙ
.
	`AddChd
("MetadataServer");

145  
çl£
;

147 
chd
.
	`AddA‰ribu‹
("id", 
logšReque¡
->
loÿl_£rv”_id
);

148 
chd
.
	`AddA‰ribu‹
("v”siÚ", 
logšReque¡
->
loÿl_£rv”_v”siÚ
);

149 
chd
.
	`AddChd
("S”v”CÚfigu¿tiÚ").AddChd("EÇbË", 
logšReque¡
->
loÿl_£rv”_’abË
);

151 
¡d
::
¡ršg
 
¡rMes§geBody
;

152 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

154 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

156 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/Login");

158 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

160 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/Login");

164  
çl£
;

167 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

168 
	`G’”©eSessiÚIDH—d”
(0) +

169 
CRLF
 +

170 
¡rMes§geBody
;

172  
Œue
;

173 
	}
}

175 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eLogoutReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
LogoutReque¡
 *
logoutReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

177 
	`IF_NULL_RETURN_VALUE
(
logoutReque¡
, 
çl£
);

179 
XMLT»e
 
Œ“
;

180 
XMLEËm’t
 
roÙ
;

183 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("Logout");

185 
roÙ
.
	`AddChd
("SessiÚID", 
logoutReque¡
->
£ssiÚ_id
);

187 
¡d
::
¡ršg
 
¡rMes§geBody
;

188 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

190 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

192 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/Logout");

194 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

196 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/Logout");

200  
çl£
;

203 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

204 
	`G’”©eSessiÚIDH—d”
(
logoutReque¡
->
£ssiÚ_id
) +

205 
CRLF
 +

206 
¡rMes§geBody
;

208  
Œue
;

209 
	}
}

211 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eG‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡
 *
g‘Sy¡emCÚfigTimeReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

213 
	`IF_NULL_RETURN_VALUE
(
g‘Sy¡emCÚfigTimeReque¡
, 
çl£
);

215 
XMLT»e
 
Œ“
;

216 
XMLEËm’t
 
roÙ
;

219 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("GetSystemConfigurationTimestamp");

221 
roÙ
.
	`AddChd
("SessiÚID", 
g‘Sy¡emCÚfigTimeReque¡
->
£ssiÚ_id
);

223 
¡d
::
¡ršg
 
¡rMes§geBody
;

224 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

226 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

228 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/GetSystemConfigurationTimestamp");

230 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

232 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/GetSystemConfigurationTimestamp");

236  
çl£
;

239 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

240 
	`G’”©eSessiÚIDH—d”
(
g‘Sy¡emCÚfigTimeReque¡
->
£ssiÚ_id
) +

241 
CRLF
 +

242 
¡rMes§geBody
;

244  
Œue
;

245 
	}
}

247 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eG‘U£rReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘U£rReque¡
 *
g‘U£rReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

249 
	`IF_NULL_RETURN_VALUE
(
g‘U£rReque¡
, 
çl£
);

251 
XMLT»e
 
Œ“
;

252 
XMLEËm’t
 
roÙ
, 
chd
;

255 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("GetUser");

257 
roÙ
.
	`AddChd
("SessiÚID", 
g‘U£rReque¡
->
£ssiÚ_id
);

258 
chd
 = 
roÙ
.
	`AddChd
("UserIDList");

259 
ušt32_t
 
i
 = 0; i < 
g‘U£rReque¡
->
u£r_id_li¡
.
	`size
(); i++)

261 
chd
.
	`AddChd
("U£rID", 
g‘U£rReque¡
->
u£r_id_li¡
[
i
]);

264 
¡d
::
¡ršg
 
¡rMes§geBody
;

265 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

267 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

269 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/GetUser");

271 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

273 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/GetUser");

277  
çl£
;

280 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

281 
	`G’”©eSessiÚIDH—d”
(
g‘U£rReque¡
->
£ssiÚ_id
) +

282 
CRLF
 +

283 
¡rMes§geBody
;

285  
Œue
;

286 
	}
}

288 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eG‘GroupReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘GroupReque¡
 *
g‘GroupReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

290 
	`IF_NULL_RETURN_VALUE
(
g‘GroupReque¡
, 
çl£
);

292 
XMLT»e
 
Œ“
;

293 
XMLEËm’t
 
roÙ
, 
chd
;

296 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("GetGroup");

298 
roÙ
.
	`AddChd
("SessiÚID", 
g‘GroupReque¡
->
£ssiÚ_id
);

299 
chd
 = 
roÙ
.
	`AddChd
("GroupIDList");

300 
ušt32_t
 
i
 = 0; i < 
g‘GroupReque¡
->
group_id_li¡
.
	`size
(); i++)

302 
chd
.
	`AddChd
("GroupID", 
g‘GroupReque¡
->
group_id_li¡
[
i
]);

305 
¡d
::
¡ršg
 
¡rMes§geBody
;

306 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

308 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

310 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/GetGroup");

312 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

314 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/GetGroup");

318 
	`TRACE
("unknow†ocalServerType\n");

319  
çl£
;

322 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

323 
	`G’”©eSessiÚIDH—d”
(
g‘GroupReque¡
->
£ssiÚ_id
) +

324 
CRLF
 +

325 
¡rMes§geBody
;

327  
Œue
;

328 
	}
}

330 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eG‘PrivegeSequ’ûReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘PrivegeSequ’ûReque¡
 *
g‘PrivegeSequ’ûReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

332 
	`IF_NULL_RETURN_VALUE
(
g‘PrivegeSequ’ûReque¡
, 
çl£
);

334 
XMLT»e
 
Œ“
;

337 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("GetPrivilegeSequence");

338 
roÙ
.
	`AddChd
("SessiÚID", 
g‘PrivegeSequ’ûReque¡
->
£ssiÚ_id
);

340 
¡d
::
¡ršg
 
¡rMes§geBody
;

341 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

343 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

345 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/GetPrivilegeSequence");

347 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

349 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/GetPrivilegeSequence");

353 
	`TRACE
("unknow†ocalServerType\n");

354  
çl£
;

357 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

358 
	`G’”©eSessiÚIDH—d”
(
g‘PrivegeSequ’ûReque¡
->
£ssiÚ_id
) +

359 
CRLF
 +

360 
¡rMes§geBody
;

362  
Œue
;

363 
	}
}

365 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eG‘RŞeReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘RŞeReque¡
 *
g‘RŞeReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

367 
	`IF_NULL_RETURN_VALUE
(
g‘RŞeReque¡
, 
çl£
);

369 
XMLT»e
 
Œ“
;

370 
XMLEËm’t
 
roÙ
, 
chd
;

373 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("GetRole");

375 
roÙ
.
	`AddChd
("SessiÚID", 
g‘RŞeReque¡
->
£ssiÚ_id
);

376 
chd
 = 
roÙ
.
	`AddChd
("RoleIDList");

377 
ušt32_t
 
i
 = 0; i < 
g‘RŞeReque¡
->
rŞe_id_li¡
.
	`size
(); i++)

379 
chd
.
	`AddChd
("RŞeID", 
g‘RŞeReque¡
->
rŞe_id_li¡
[
i
]);

382 
¡d
::
¡ršg
 
¡rMes§geBody
;

383 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

385 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

387 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/GetRole");

389 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

391 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/GetRole");

395 
	`TRACE
("unknow†ocalServerType\n");

396  
çl£
;

399 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

400 
	`G’”©eSessiÚIDH—d”
(
g‘RŞeReque¡
->
£ssiÚ_id
) +

401 
CRLF
 +

402 
¡rMes§geBody
;

404  
Œue
;

405 
	}
}

407 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eG‘ScheduËReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘ScheduËReque¡
 *
g‘ScheduËReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

409 
	`IF_NULL_RETURN_VALUE
(
g‘ScheduËReque¡
, 
çl£
);

411 
XMLT»e
 
Œ“
;

412 
XMLEËm’t
 
roÙ
, 
chd
;

415 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("GetSchedule");

417 
roÙ
.
	`AddChd
("SessiÚID", 
g‘ScheduËReque¡
->
£ssiÚ_id
);

418 
chd
 = 
roÙ
.
	`AddChd
("ScheduleIDList");

419 
ušt32_t
 
i
 = 0; i < 
g‘ScheduËReque¡
->
scheduË_id_li¡
.
	`size
(); i++)

421 
chd
.
	`AddChd
("ScheduËID", 
g‘ScheduËReque¡
->
scheduË_id_li¡
[
i
]);

424 
¡d
::
¡ršg
 
¡rMes§geBody
;

425 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

427 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

429 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/GetSchedule");

431 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

433 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/GetSchedule");

437 
	`TRACE
("unknow†ocalServerType\n");

438  
çl£
;

441 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

442 
	`G’”©eSessiÚIDH—d”
(
g‘ScheduËReque¡
->
£ssiÚ_id
) +

443 
CRLF
 +

444 
¡rMes§geBody
;

446  
Œue
;

447 
	}
}

449 
boŞ
 
	gMsCl›ÁCommªdG’”©e
::
	$G’”©eG‘Cl›ÁSessiÚReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚReque¡
 *
g‘SessiÚReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

451 
	`IF_NULL_RETURN_VALUE
(
g‘SessiÚReque¡
, 
çl£
);

453 
XMLT»e
 
Œ“
;

454 
XMLEËm’t
 
roÙ
, 
chd
;

457 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("GetClientSession");

459 
roÙ
.
	`AddChd
("SessiÚID", 
g‘SessiÚReque¡
->
£ssiÚ_id
);

460 
chd
 = 
roÙ
.
	`AddChd
("ClientSessionIDList");

461 
ušt32_t
 
i
 = 0; i < 
g‘SessiÚReque¡
->
qu”y_£ssiÚ_id_li¡
.
	`size
(); i++)

463 
chd
.
	`AddChd
("Cl›ÁSessiÚID", 
g‘SessiÚReque¡
->
qu”y_£ssiÚ_id_li¡
[
i
]);

466 
¡d
::
¡ršg
 
¡rMes§geBody
;

467 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

469 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

471 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/command/GetClientSession");

473 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

475 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/command/GetClientSession");

479  
çl£
;

482 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

483 
	`G’”©eSessiÚIDH—d”
(
g‘SessiÚReque¡
->
£ssiÚ_id
) +

484 
CRLF
 +

485 
¡rMes§geBody
;

487  
Œue
;

488 
	}
}

	@../../titanutils/MsClient/ProtocolOperation/MsClientCommandGenerate.h

1 #iâdeà
__MS_CLIENT_COMMAND_GENERATE_H__


2 
	#__MS_CLIENT_COMMAND_GENERATE_H__


	)

4 
	~"PrÙocŞDefše/MsCl›ÁCommÚDefše.h
"

6 
	~"MsCl›Á/MsCl›Á.h
"

8 şas 
	cMsCl›ÁCommªdG’”©e


10 
	mpublic
:

12 
boŞ
 
G’”©eRegi¡”Reque¡
(cÚ¡ 
MsCl›ÁCommªd
::
Regi¡”Reque¡
 *
»gi¡”Reque¡
, cÚ¡ 
MsCl›ÁCommÚ
::
AuthÜiz©iÚH—d”
 *
authÜiz©iÚ
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

13 
boŞ
 
G’”©eUÄegi¡”Reque¡
(cÚ¡ 
MsCl›ÁCommªd
::
UÄegi¡”Reque¡
 *
uÄegi¡”Reque¡
, cÚ¡ 
MsCl›ÁCommÚ
::
AuthÜiz©iÚH—d”
 *
authÜiz©iÚ
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

14 
boŞ
 
G’”©eLogšReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
LogšReque¡
 *
logšReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

15 
boŞ
 
G’”©eLogoutReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
LogoutReque¡
 *
logoutReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

18 
boŞ
 
G’”©eG‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘Sy¡emCÚfigu¿tiÚTime¡ampReque¡
 *
g‘Sy¡emCÚfigTimeReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

19 
boŞ
 
G’”©eG‘U£rReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘U£rReque¡
 *
g‘U£rReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

20 
boŞ
 
G’”©eG‘GroupReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘GroupReque¡
 *
g‘GroupReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

21 
boŞ
 
G’”©eG‘PrivegeSequ’ûReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘PrivegeSequ’ûReque¡
 *
g‘PrivegeSequ’ûReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

22 
boŞ
 
G’”©eG‘RŞeReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘RŞeReque¡
 *
g‘RŞeReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

23 
boŞ
 
G’”©eG‘ScheduËReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘ScheduËReque¡
 *
g‘ScheduËReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

24 
boŞ
 
G’”©eG‘Cl›ÁSessiÚReque¡
(cÚ¡ 
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚReque¡
 *
g‘SessiÚReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

26 
	m´iv©e
:

27 
MsCl›ÁCommªdG’”©e
();

28 ~
MsCl›ÁCommªdG’”©e
();

	@../../titanutils/MsClient/ProtocolOperation/MsClientCommandParser.cpp

1 
	~"MsCl›ÁCommªdP¬£r.h
"

3 
	~"commÚ/¡dšt.h
"

4 
	~"commÚ/¡ršg.h
"

5 
	~"commÚ/sy¡em.h
"

7 
	~"libev’t/ev’t_bufãr.h
"

9 
	~"sûw/xml_Œ“.h
"

11 
	~"cÚ¡/S”v”PrÙocŞDefš™iÚ.h
"

12 
	~"debugMsg/Debug.h
"

14 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

16 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$R—dCommªdRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
H‰pP¬£r
& 
·r£r
)

18 
Ev’tBufãr
 
ev’t_bufãr
;

20 
št32_t
 
nÚblock_Üigš®
 = 
pSock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

21 
št32_t
 
nÚblock
 = 1;

23 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

25 
pSock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

28 
št64_t
 
ms
 = 
	`G‘TimeCouÁMS
();

29 
·r£r
.
	`G‘S‹
().
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_DONE


30 && 
	`G‘TimeCouÁMS
(è< 
ms
 + 
TIMEOUT_MANAGEMENT_SERVER_RESPONDER_REQUEST
)

32 
ev’t_bufãr
.
	`R—dSock‘
(
pSock‘
);

33 
·r£r
.
	`CÚsumeBufãr
(
ev’t_bufãr
);

36 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

38 
pSock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

42 ià(
·r£r
.
	`G‘S‹
().
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_DONE
)

44  
çl£
;

47  
Œue
;

48 
	}
}

50 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£Regi¡”Re¥Ú£
(
A´TıSock‘
 *
pSock‘
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
MsCl›ÁCommªd
::
Regi¡”Re¥Ú£
& 
»¥Ú£
)

52 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

54 
H‰pP¬£r
 
·r£r
;

55 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

57  
çl£
;

60 
XMLT»e
 
Œ“
;

61 
XMLEËm’t
 
chd
;

64 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

66 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
 ||„e¥Ú£.»tuº_cod=ğS”v”PrÙocŞ::
ERROR_SERVERID
)

68 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

70 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "Register")

72 
	`TRACE
("XML„oÙ i [%s],‚Ù Regi¡”\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

73  
çl£
;

76 
chd
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ManagementServer");

77 
»¥Ú£
.
mªagem’t_£rv”_id
 = 
chd
.
	`G‘A‰ribu‹
("id");

78 
»¥Ú£
.
mªagem’t_£rv”_v”siÚ
 = 
chd
.
	`G‘A‰ribu‹
("v”siÚ").
	`G‘V®ue
();

82 
	`TRACE
("E¼ÜCodğ%u, S”v” i un¡abË\n", 
»¥Ú£
.
»tuº_code
);

83  
çl£
;

86  
Œue
;

87 
	}
}

89 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£UÄegi¡”Re¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
UÄegi¡”Re¥Ú£
& 
»¥Ú£
)

91 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

93 
H‰pP¬£r
 
·r£r
;

94 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

96  
çl£
;

99 
XMLT»e
 
Œ“
;

102 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

104 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "Unregister")

106 
	`TRACE
("XML„oÙ i [%s],‚Ù UÄegi¡”\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

107  
çl£
;

110 
»¥Ú£
.
»tuº_code
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ReturnCode");

112  (
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
);

113 
	}
}

115 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£LogšRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
LogšRe¥Ú£
& 
»¥Ú£
)

117 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

119 
H‰pP¬£r
 
·r£r
;

120 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

122  
çl£
;

125 
XMLT»e
 
Œ“
;

128 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

130 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "Login")

132 
	`TRACE
("XML„oÙ i [%s],‚Ù Logš\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

133  
çl£
;

136 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

137 
»¥Ú£
.
cÚfig_impÜt
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ConfigImport");

138 
»¥Ú£
.
»tuº_code
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ReturnCode");

140  (
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
);

141 
	}
}

143 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£LogoutRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
LogoutRe¥Ú£
& 
»¥Ú£
)

145 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

147 
H‰pP¬£r
 
·r£r
;

148 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

150  
çl£
;

153 
XMLT»e
 
Œ“
;

156 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

158 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "Logout")

160 
	`TRACE
("XML„oÙ i [%s],‚Ù Logout\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

161  
çl£
;

164 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

165 
»¥Ú£
.
»tuº_code
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ReturnCode");

167  (
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
);

168 
	}
}

170 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£G‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£
& 
»¥Ú£
)

172 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

174 
H‰pP¬£r
 
·r£r
;

175 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

177  
çl£
;

180 
XMLT»e
 
Œ“
;

183 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

185 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

187 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

189 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "GetSystemConfigurationTimestamp")

191 
	`TRACE
("XML„oÙ i [%s],‚Ù G‘Sy¡emCÚfigu¿tiÚTime¡amp\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

192  
çl£
;

195 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

196 
»¥Ú£
.
u£r_time¡amp
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("UserTimestamp");

197 
»¥Ú£
.
group_time¡amp
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("GroupTimestamp");

198 
»¥Ú£
.
rŞe_time¡amp
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("RoleTimestamp");

199 
»¥Ú£
.
scheduË_time¡amp
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ScheduleTimestamp");

203 
	`TRACE
("G‘Sy¡emCÚfigu¿tiÚTime¡am°”rÜCodğ%u\n", 
»¥Ú£
.
»tuº_code
);

204  
çl£
;

207  
Œue
;

208 
	}
}

210 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£G‘U£rRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘U£rRe¥Ú£
& 
»¥Ú£
)

212 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

213 
H‰pP¬£r
 
·r£r
;

214 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

216  
çl£
;

219 
XMLT»e
 
Œ“
;

221 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

223 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

225 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

227 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "GetUser")

229 
	`TRACE
("XML„oÙ i [%s],‚Ù G‘U£r\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

230  
çl£
;

233 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("UserList");

234 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

236 
XMLEËm’t
 
chd_–em’t
 = XMLEËm’t::
em±y_–em’t
;

237 
	`ASSERT
(
–em’t
.
	`G‘ChdCouÁ
() > 0);

238 
ušt32_t
 
i
 = 0; i < 
–em’t
.
	`G‘ChdCouÁ
(); i++)

240 
¡U£rD©a
 
d©aI‹m
;

241 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
i
);

242 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

243 
d©aI‹m
.
	`Un£rŸlize
(
chd_–em’t
);

244 
»¥Ú£
.
u£r_li¡
.
	`push_back
(
d©aI‹m
);

246 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

247  
Œue
;

251 
	`TRACE
("P¬£G‘U£rRe¥Ú£ƒ¼ÜCodğ%u\n", 
»¥Ú£
.
»tuº_code
);

252  
çl£
;

255  
Œue
;

256 
	}
}

258 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£G‘GroupRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘GroupRe¥Ú£
& 
»¥Ú£
)

260 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

261 
H‰pP¬£r
 
·r£r
;

262 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

264  
çl£
;

267 
XMLT»e
 
Œ“
;

269 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

271 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

273 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

275 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "GetGroup")

277 
	`TRACE
("XML„oÙ i [%s],‚Ù G‘Group\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

278  
çl£
;

281 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("GroupList");

282 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

284 
XMLEËm’t
 
chd_–em’t
 = XMLEËm’t::
em±y_–em’t
;

285 
	`ASSERT
(
–em’t
.
	`G‘ChdCouÁ
() > 0);

286 
ušt32_t
 
i
 = 0; i < 
–em’t
.
	`G‘ChdCouÁ
(); i++)

288 
¡GroupD©a
 
d©aI‹m
;

289 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
i
);

290 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

291 
d©aI‹m
.
	`Un£rŸlize
(
chd_–em’t
);

292 
»¥Ú£
.
group_li¡
.
	`push_back
(
d©aI‹m
);

294 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

295  
Œue
;

299 
	`TRACE
("P¬£G‘GroupRe¥Ú£ƒ¼ÜCodğ%u\n", 
»¥Ú£
.
»tuº_code
);

300  
çl£
;

302 
	}
}

304 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£G‘PrivegeSequ’ûRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘PrivegeSequ’ûRe¥Ú£
& 
»¥Ú£
)

306 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

307 
H‰pP¬£r
 
·r£r
;

308 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

310  
çl£
;

313 
XMLT»e
 
Œ“
;

315 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

317 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

319 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

320 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "GetPrivilegeSequence")

322 
	`TRACE
("XML„oÙ i [%s],‚Ù G‘PrivegeSequ’û\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

323  
çl£
;

325 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("PrivilegeTypeList");

326 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

327 
	`ASSERT
(
–em’t
.
	`G‘ChdCouÁ
() > 0);

329 
XMLEËm’t
 
chd_–em’t
 = XMLEËm’t::
em±y_–em’t
;

330 
ušt32_t
 
i
 = 0; i < 
–em’t
.
	`G‘ChdCouÁ
(); i++)

332 
¡AcûssRight
 
¡PrivegeI‹m
;

333 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
i
);

334 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

335 
¡PrivegeI‹m
.
	`Un£rŸlize
(
chd_–em’t
);

336 
»¥Ú£
.
´ivege_li¡
.
	`push_back
(
¡PrivegeI‹m
);

338 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

339  
Œue
;

343 
	`TRACE
("P¬£G‘PrivegeSequ’ûRe¥Ú£ƒ¼ÜCodğ%u\n", 
»¥Ú£
.
»tuº_code
);

344  
çl£
;

346  
çl£
;

347 
	}
}

349 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£G‘RŞeRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘RŞeRe¥Ú£
& 
»¥Ú£
)

351 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

352 
H‰pP¬£r
 
·r£r
;

353 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

355  
çl£
;

358 
XMLT»e
 
Œ“
;

360 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

362 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

364 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

366 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "GetRole")

368 
	`TRACE
("XML„oÙ i [%s],‚Ù G‘RŞe\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

369  
çl£
;

372 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("RoleList");

373 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

375 
XMLEËm’t
 
chd_–em’t
 = XMLEËm’t::
em±y_–em’t
;

376 
	`ASSERT
(
–em’t
.
	`G‘ChdCouÁ
() > 0);

377 
ušt32_t
 
i
 = 0; i < 
–em’t
.
	`G‘ChdCouÁ
(); i++)

379 
¡RŞeD©a
 
d©aI‹m
;

380 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
i
);

381 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

382 
d©aI‹m
.
	`Un£rŸlize
(
chd_–em’t
);

383 
»¥Ú£
.
rŞe_li¡
.
	`push_back
(
d©aI‹m
);

385 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

386  
Œue
;

390 
	`TRACE
("P¬£G‘RŞeRe¥Ú£ƒ¼ÜCodğ%u\n", 
»¥Ú£
.
»tuº_code
);

391  
çl£
;

393 
	}
}

395 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£G‘ScheduËRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘ScheduËRe¥Ú£
& 
»¥Ú£
)

397 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

398 
H‰pP¬£r
 
·r£r
;

399 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

401  
çl£
;

404 
XMLT»e
 
Œ“
;

406 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

408 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

410 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

412 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "GetSchedule")

414 
	`TRACE
("XML„oÙ i [%s],‚Ù G‘ScheduË\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

415  
çl£
;

418 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ScheduleList");

419 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

421 
XMLEËm’t
 
chd_–em’t
 = XMLEËm’t::
em±y_–em’t
;

422 
	`ASSERT
(
–em’t
.
	`G‘ChdCouÁ
() > 0);

423 
ušt32_t
 
i
 = 0; i < 
–em’t
.
	`G‘ChdCouÁ
(); i++)

425 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
i
);

426 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

428 
¡d
::
¡ršg
 
ty³
 = 
chd_–em’t
.
	`G‘Chd
("ty³").
	`G‘CÚ‹Á
();

430 
CScheduËBa£
* 
ba£
 = 
NULL
;

431 ià(
ty³
 == "Day")

433 
ba£
 = 
Ãw
 
	`CScheduËDay
();

435 ià(
ty³
 == "Week")

437 
ba£
 = 
Ãw
 
	`CScheduËW“kly
();

439 ià(
ty³
 == "Month1")

441 
ba£
 = 
Ãw
 
	`CScheduËMÚthly
();

443 ià(
ty³
 == "Month2")

445 
ba£
 = 
Ãw
 
	`CScheduËMÚthly
();

447 ià(
ty³
 == "Year1")

449 
ba£
 = 
Ãw
 
	`CScheduËY—¾y
();

451 ià(
ty³
 == "Year2")

453 
ba£
 = 
Ãw
 
	`CScheduËY—¾y
();

455 ià(
ty³
 == "Specific")

457 
ba£
 = 
Ãw
 
	`CScheduËS³cificDays
();

464 ià(
ba£
 =ğ
NULL
)

469 
ba£
->
	`Un£rŸlize
(
chd_–em’t
);

470 
»¥Ú£
.
scheduË_li¡
.
	`push_back
(
ba£
);

472 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

474  
Œue
;

478 
	`TRACE
("P¬£G‘RŞeRe¥Ú£ƒ¼ÜCodğ%u\n", 
»¥Ú£
.
»tuº_code
);

479  
çl£
;

481 
	}
}

483 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£G‘ScheduËRe¥Ú£Du¶
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘ScheduËRe¥Ú£
& 
»¥Ú£
,

484 
MsCl›ÁCommªd
::
G‘ScheduËRe¥Ú£
& 
»¥Ú£2
)

486 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

487 
H‰pP¬£r
 
·r£r
;

488 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

490  
çl£
;

493 
XMLT»e
 
Œ“
;

495 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

497 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

499 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

501 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "GetSchedule")

503 
	`TRACE
("XML„oÙ i [%s],‚Ù G‘ScheduË\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

504  
çl£
;

507 
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ScheduleList");

508 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

510 
XMLEËm’t
 
chd_–em’t
 = XMLEËm’t::
em±y_–em’t
;

511 
	`ASSERT
(
–em’t
.
	`G‘ChdCouÁ
() > 0);

512 
ušt32_t
 
i
 = 0; i < 
–em’t
.
	`G‘ChdCouÁ
(); i++)

514 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
i
);

515 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

517 
¡d
::
¡ršg
 
ty³
 = 
chd_–em’t
.
	`G‘Chd
("ty³").
	`G‘CÚ‹Á
();

519 
CScheduËBa£
* 
ba£
 = 
NULL
;

520 
CScheduËBa£
* 
ba£2
 = 
NULL
;

521 ià(
ty³
 == "Day")

523 
ba£
 = 
Ãw
 
	`CScheduËDay
();

524 
ba£2
 = 
Ãw
 
	`CScheduËDay
();

526 ià(
ty³
 == "Week")

528 
ba£
 = 
Ãw
 
	`CScheduËW“kly
();

529 
ba£2
 = 
Ãw
 
	`CScheduËW“kly
();

531 ià(
ty³
 == "Month1")

533 
ba£
 = 
Ãw
 
	`CScheduËMÚthly
();

534 
ba£2
 = 
Ãw
 
	`CScheduËMÚthly
();

536 ià(
ty³
 == "Month2")

538 
ba£
 = 
Ãw
 
	`CScheduËMÚthly
();

539 
ba£2
 = 
Ãw
 
	`CScheduËMÚthly
();

541 ià(
ty³
 == "Year1")

543 
ba£
 = 
Ãw
 
	`CScheduËY—¾y
();

544 
ba£2
 = 
Ãw
 
	`CScheduËY—¾y
();

546 ià(
ty³
 == "Year2")

548 
ba£
 = 
Ãw
 
	`CScheduËY—¾y
();

549 
ba£2
 = 
Ãw
 
	`CScheduËY—¾y
();

551 ià(
ty³
 == "Specific")

553 
ba£
 = 
Ãw
 
	`CScheduËS³cificDays
();

554 
ba£2
 = 
Ãw
 
	`CScheduËS³cificDays
();

561 ià(
ba£
 =ğ
NULL
 || 
ba£2
 == NULL)

566 
ba£
->
	`Un£rŸlize
(
chd_–em’t
);

567 
»¥Ú£
.
scheduË_li¡
.
	`push_back
(
ba£
);

569 
ba£2
->
	`Un£rŸlize
(
chd_–em’t
);

570 
»¥Ú£2
.
scheduË_li¡
.
	`push_back
(
ba£2
);

572 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

574  
Œue
;

578 
	`TRACE
("P¬£G‘RŞeRe¥Ú£ƒ¼ÜCodğ%u\n", 
»¥Ú£
.
»tuº_code
);

579  
çl£
;

581 
	}
}

583 
boŞ
 
	gMsCl›ÁCommªdP¬£r
::
	$P¬£G‘Cl›ÁSessiÚRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚRe¥Ú£
& 
»¥Ú£
)

585 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

587 
H‰pP¬£r
 
·r£r
;

588 ià(!
	`R—dCommªdRe¥Ú£
(
pSock‘
, 
·r£r
))

590  
çl£
;

593 
XMLT»e
 
Œ“
;

594 
XMLEËm’t
 
chd
;

595 
¡d
::
veùÜ
<
XMLEËm’t
> 
chd»n
;

598 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

600 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

602 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

604 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "GetClientSession")

606 
	`TRACE
("XML„oÙ i [%s],‚Ù G‘Cl›ÁSessiÚ\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

607  
çl£
;

610 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

612 
chd
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionList");

613 
chd»n
 = 
chd
.
	`G‘Chd»n
("Session");

615 
ušt32_t
 
i
 = 0; i < 
chd»n
.
	`size
(); i++)

617 
MsCl›ÁCommªd
::
¡SessiÚ
 
£ssiÚ
;

618 
£ssiÚ
.
£ssiÚ_id
 = 
chd»n
[
i
].
	`G‘Chd
("SessionID");

619 
£ssiÚ
.
u£r_id
 = 
chd»n
[
i
].
	`G‘Chd
("UserID");

620 
£ssiÚ
.
rŞe_id
 = 
chd»n
[
i
].
	`G‘Chd
("RoleID");

622 
»¥Ú£
.
£ssiÚ_li¡
.
	`push_back
(
£ssiÚ
);

627 
	`TRACE
("G‘SessiÚƒ¼ÜCodğ%u\n", 
»¥Ú£
.
»tuº_code
);

628  
çl£
;

631  
Œue
;

632 
	}
}

	@../../titanutils/MsClient/ProtocolOperation/MsClientCommandParser.h

1 #iâdeà
__MS_CLIENT_COMMAND_PARSER_H__


2 
	#__MS_CLIENT_COMMAND_PARSER_H__


	)

4 
	~"h‰p/h‰p_·r£r.h
"

5 
	~"­r/­r_sock‘.h
"

7 
	~"PrÙocŞDefše/MsCl›ÁCommÚDefše.h
"

8 
	~"PrÙocŞDefše/MsCl›ÁCommªdDefše.h
"

10 
	~"MsCl›Á/MsCl›Á.h
"

11 
	~"MsCl›Á/MsCl›ÁP¬am‘”s.h
"

13 şas 
	cMsCl›ÁCommªdP¬£r


15 
	mpublic
:

17 
boŞ
 
R—dCommªdRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, SYSUTILS_SPACE::
H‰pP¬£r
& 
·r£r
);

20 
boŞ
 
P¬£Regi¡”Re¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
MsCl›ÁCommªd
::
Regi¡”Re¥Ú£
& 
»¥Ú£
);

21 
boŞ
 
P¬£UÄegi¡”Re¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
UÄegi¡”Re¥Ú£
& 
»¥Ú£
);

22 
boŞ
 
P¬£LogšRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
LogšRe¥Ú£
& 
»¥Ú£
);

23 
boŞ
 
P¬£LogoutRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
LogoutRe¥Ú£
& 
»¥Ú£
);

26 
boŞ
 
P¬£G‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘Sy¡emCÚfigu¿tiÚTime¡ampRe¥Ú£
& 
»¥Ú£
);

27 
boŞ
 
P¬£G‘U£rRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘U£rRe¥Ú£
& 
»¥Ú£
);

28 
boŞ
 
P¬£G‘GroupRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘GroupRe¥Ú£
& 
»¥Ú£
);

29 
boŞ
 
P¬£G‘PrivegeSequ’ûRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘PrivegeSequ’ûRe¥Ú£
& 
»¥Ú£
);

30 
boŞ
 
P¬£G‘RŞeRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘RŞeRe¥Ú£
& 
»¥Ú£
);

31 
boŞ
 
P¬£G‘ScheduËRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘ScheduËRe¥Ú£
& 
»¥Ú£
);

32 
boŞ
 
P¬£G‘ScheduËRe¥Ú£Du¶
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘ScheduËRe¥Ú£
& 
»¥Ú£
, MsCl›ÁCommªd::G‘ScheduËRe¥Ú£& 
»¥Ú£2
);

33 
boŞ
 
P¬£G‘Cl›ÁSessiÚRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
MsCl›ÁCommªd
::
G‘Cl›ÁSessiÚRe¥Ú£
& 
»¥Ú£
);

35 
	m´iv©e
:

36 
MsCl›ÁCommªdP¬£r
();

37 ~
MsCl›ÁCommªdP¬£r
();

	@../../titanutils/MsClient/ProtocolOperation/MsClientDataSessionGenerate.cpp

1 
	~"commÚ/¡dšt.h
"

3 
	~"MsCl›ÁD©aSessiÚG’”©e.h
"

5 
	~"commÚ/ut™y.h
"

7 
	~"sûw/xml_ut™y.h
"

8 
	~"sûw/xml_Œ“.h
"

9 
	~"sûw/xml_–em’t.h
"

11 
	~"T™ªCommÚ/CommÚSŒšg.h
"

13 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

15 
boŞ
 
	gMsCl›ÁD©aSessiÚG’”©e
::
	$G’”©eC»©eD©aSessiÚReque¡
(

16 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
C»©eD©aSessiÚReque¡
* 
ü—‹SessiÚReque¡
,

17 cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
& 
¡rMes§ge
)

19 
	`IF_NULL_RETURN_VALUE
(
ü—‹SessiÚReque¡
, 
çl£
);

21 
XMLT»e
 
Œ“
;

22 
XMLEËm’t
 
roÙ
, 
chd
;

25 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("CreateDataSession");

26 
roÙ
.
	`AddChd
("SessiÚID", 
ü—‹SessiÚReque¡
->
£ssiÚ_id
);

28 
¡d
::
¡ršg
 
¡rMes§geBody
;

29 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

31 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

33 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/data-session/CreateDataSession");

35 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

37 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/data-session/CreateDataSession");

40 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

41 
	`G’”©eSessiÚIDH—d”
(
ü—‹SessiÚReque¡
->
£ssiÚ_id
) +

42 
CRLF
 +

43 
¡rMes§geBody
;

45  
Œue
;

46 
	}
}

48 
boŞ
 
	gMsCl›ÁD©aSessiÚG’”©e
::
	$G’”©eClo£D©aSessiÚReque¡
(

49 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
Clo£D©aSessiÚReque¡
* 
şo£SessiÚReque¡
,

50 cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
& 
¡rMes§ge
)

52 
	`IF_NULL_RETURN_VALUE
(
şo£SessiÚReque¡
, 
çl£
);

54 
XMLT»e
 
Œ“
;

55 
XMLEËm’t
 
roÙ
;

56 
XMLEËm’t
 
chd
;

59 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("CloseDataSession");

60 
roÙ
.
	`AddChd
("SessiÚID", 
şo£SessiÚReque¡
->
£ssiÚ_id
);

62 
¡d
::
¡ršg
 
¡rMes§geBody
;

63 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

65 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

67 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/data-session/CloseDataSession");

69 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

71 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/data-session/CloseDataSession");

74 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

75 
	`G’”©eSessiÚIDH—d”
(
şo£SessiÚReque¡
->
£ssiÚ_id
) +

76 
CRLF
 +

77 
¡rMes§geBody
;

79  
Œue
;

80 
	}
}

82 
boŞ
 
	gMsCl›ÁD©aSessiÚG’”©e
::
	$G’”©eR’ewD©aSessiÚReque¡
(

83 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
R’ewSessiÚReque¡
* 
»ÃwSessiÚReque¡
,

84 cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
& 
¡rMes§ge
)

86 
	`IF_NULL_RETURN_VALUE
(
»ÃwSessiÚReque¡
, 
çl£
);

88 
XMLT»e
 
Œ“
;

89 
XMLEËm’t
 
roÙ
;

90 
XMLEËm’t
 
chd
;

93 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("RenewSession");

94 
roÙ
.
	`AddChd
("SessiÚID", 
»ÃwSessiÚReque¡
->
£ssiÚ_id
);

96 
¡d
::
¡ršg
 
¡rMes§geBody
;

97 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

99 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

101 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/data-session/RenewSession");

103 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

105 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/data-session/RenewSession");

109  
çl£
;

112 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

113 
	`G’”©eSessiÚIDH—d”
(
»ÃwSessiÚReque¡
->
£ssiÚ_id
) +

114 
CRLF
 +

115 
¡rMes§geBody
;

117  
Œue
;

118 
	}
}

120 
boŞ
 
	gMsCl›ÁD©aSessiÚG’”©e
::
	$G’”©eD©aSessiÚStusRe¥Ú£
(

121 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
D©aSessiÚStusRe¥Ú£
& 
»¥Ú£
, 
¡d
::
¡ršg
& 
¡rMes§ge
)

123 
XMLT»e
 
Œ“
;

126 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("DataSessionStatus");

127 
roÙ
.
	`AddChd
("SessiÚID", 
»¥Ú£
.
£ssiÚ_id
);

128 
roÙ
.
	`AddChd
("S”v”ID", 
»¥Ú£
.
£rv”ID
);

129 
roÙ
.
	`AddChd
("Reque¡ID", 
»¥Ú£
.
»que¡ID
);

130 
roÙ
.
	`AddChd
("R‘uºCode", 
»¥Ú£
.
»tuº_code
);

132 
XMLEËm’t
 
chd
 = 
roÙ
.
	`AddChd
("RequestStatusList");

133 
¡d
::
veùÜ
<
MsCl›ÁD©aSessiÚ
::
Reque¡Stus
>::
cÚ¡_™”©Ü
 
™
 = 
»¥Ú£
.
»que¡StusLi¡
.
	`begš
();

134 
™
 !ğ
»¥Ú£
.
»que¡StusLi¡
.
	`’d
(); it++)

136 
XMLEËm’t
 
xeInfo
 = 
chd
.
	`AddChd
("Reque¡Stus", 
™
->
¡©usID
);

137 
xeInfo
.
	`AddA‰ribu‹
("id", 
™
->
»que¡ID
);

140 
¡d
::
¡ršg
 
¡rMes§geBody
;

141 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

143 
¡rMes§ge
 = 
	`G’”©eStusLše
(200è+ 
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

144 
	`G’”©eSessiÚIDH—d”
(
»¥Ú£
.
£ssiÚ_id
) +

145 
	`G’”©eReque¡IDH—d”
(
»¥Ú£
.
»que¡ID
) +

146 
	`G’”©eR‘uºCodeH—d”
(
»¥Ú£
.
»tuº_code
) +

147 
CRLF
 +

148 
¡rMes§geBody
;

150  
Œue
;

151 
	}
}

153 
boŞ
 
	gMsCl›ÁD©aSessiÚG’”©e
::
	$G’”©eRemÙCÚŒŞRe¥Ú£
(

154 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞRe¥Ú£
& 
»¥Ú£
, 
¡d
::
¡ršg
& 
¡rMes§ge
)

156 
XMLT»e
 
Œ“
;

159 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("RemoteControl");

160 
roÙ
.
	`AddChd
("SessiÚID", 
»¥Ú£
.
£ssiÚ_id
);

161 
roÙ
.
	`AddChd
("S”v”ID", 
»¥Ú£
.
£rv”ID
);

162 
roÙ
.
	`AddChd
("Reque¡ID", 
»¥Ú£
.
»que¡ID
);

163 
roÙ
.
	`AddChd
("R‘uºCode", 
»¥Ú£
.
»tuº_code
);

165 
¡d
::
¡ršg
 
¡rMes§geBody
;

166 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

168 
¡rMes§ge
 = 
	`G’”©eStusLše
(200è+ 
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

169 
	`G’”©eSessiÚIDH—d”
(
»¥Ú£
.
£ssiÚ_id
) +

170 
	`G’”©eReque¡IDH—d”
(
»¥Ú£
.
»que¡ID
) +

171 
	`G’”©eR‘uºCodeH—d”
(
»¥Ú£
.
»tuº_code
) +

172 
CRLF
 +

173 
¡rMes§geBody
;

175  
Œue
;

176 
	}
}

178 
boŞ
 
	gMsCl›ÁD©aSessiÚG’”©e
::
	$G’”©eC’Œ®izedUpg¿deRe¥Ú£
(

179 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
C’Œ®izedUpg¿deRe¥Ú£
& 
»¥Ú£
, 
¡d
::
¡ršg
& 
¡rMes§ge
)

181 
XMLT»e
 
Œ“
;

184 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("CentralizedUpgrade");

185 
roÙ
.
	`AddChd
("SessiÚID", 
»¥Ú£
.
£ssiÚ_id
);

186 
roÙ
.
	`AddChd
("Reque¡ID", 
»¥Ú£
.
»que¡ID
);

187 
roÙ
.
	`AddChd
("R‘uºCode", 
»¥Ú£
.
»tuº_code
);

189 
¡d
::
¡ršg
 
¡rMes§geBody
;

190 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

192 
¡rMes§ge
 = 
	`G’”©eStusLše
(200è+ 
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

193 
	`G’”©eSessiÚIDH—d”
(
»¥Ú£
.
£ssiÚ_id
) +

194 
	`G’”©eReque¡IDH—d”
(
»¥Ú£
.
»que¡ID
) +

195 
	`G’”©eR‘uºCodeH—d”
(
»¥Ú£
.
»tuº_code
) +

196 
CRLF
 +

197 
¡rMes§geBody
;

199  
Œue
;

200 
	}
}

	@../../titanutils/MsClient/ProtocolOperation/MsClientDataSessionGenerate.h

1 #iâdeà
__MS_CLIENT_DATA_SESSION_GENERATE_H__


2 
	#__MS_CLIENT_DATA_SESSION_GENERATE_H__


	)

4 
	~"MsCl›Á/PrÙocŞDefše/MsCl›ÁD©aSessiÚDefše.h
"

6 
	~"MsCl›Á/MsCl›Á.h
"

8 
	~<¡ršg
>

10 şas 
	cMsCl›ÁD©aSessiÚG’”©e


12 
	mpublic
:

13 
boŞ
 
G’”©eC»©eD©aSessiÚReque¡
(

14 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
C»©eD©aSessiÚReque¡
* 
ü—‹SessiÚReque¡
,

15 cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
& 
¡rMes§ge
);

16 
boŞ
 
G’”©eClo£D©aSessiÚReque¡
(

17 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
Clo£D©aSessiÚReque¡
* 
şo£SessiÚReque¡
,

18 cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
& 
¡rMes§ge
);

19 
boŞ
 
G’”©eR’ewD©aSessiÚReque¡
(

20 cÚ¡ 
MsCl›ÁD©aSessiÚ
::
R’ewSessiÚReque¡
* 
»ÃwSessiÚReque¡
,

21 cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
& 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
& 
¡rMes§ge
);

23 
boŞ
 
G’”©eD©aSessiÚStusRe¥Ú£
(cÚ¡ 
MsCl›ÁD©aSessiÚ
::
D©aSessiÚStusRe¥Ú£
& 
»¥Ú£
,

24 
¡d
::
¡ršg
& 
¡rMes§ge
);

25 
boŞ
 
G’”©eRemÙCÚŒŞRe¥Ú£
(cÚ¡ 
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞRe¥Ú£
& 
»¥Ú£
,

26 
¡d
::
¡ršg
& 
¡rMes§ge
);

28 
boŞ
 
G’”©eC’Œ®izedUpg¿deRe¥Ú£
(cÚ¡ 
MsCl›ÁD©aSessiÚ
::
C’Œ®izedUpg¿deRe¥Ú£
& 
»¥Ú£
,

29 
¡d
::
¡ršg
& 
¡rMes§ge
);

31 
	m´iv©e
:

32 
MsCl›ÁD©aSessiÚG’”©e
();

33 ~
MsCl›ÁD©aSessiÚG’”©e
();

	@../../titanutils/MsClient/ProtocolOperation/MsClientDataSessionParser.cpp

1 
	~"MsCl›ÁD©aSessiÚP¬£r.h
"

3 
	~"commÚ/¡dšt.h
"

4 
	~"commÚ/¡ršg.h
"

5 
	~"commÚ/sy¡em.h
"

7 
	~"libev’t/ev’t_bufãr.h
"

9 
	~"sûw/xml_Œ“.h
"

11 
	~"cÚ¡/S”v”PrÙocŞDefš™iÚ.h
"

12 
	~"debugMsg/Debug.h
"

14 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

16 
boŞ
 
	gMsCl›ÁD©aSessiÚP¬£r
::
	$R—dC»©eRe¥Ú£
(
A´TıSock‘
* 
pSock‘
, 
Ev’tBufãr
& 
ev’t_bufãr
, 
H‰pP¬£r
& 
·r£r
)

18 
št32_t
 
nÚblock_Üigš®
 = 
pSock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

19 
št32_t
 
nÚblock
 = 1;

21 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

23 
pSock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

26 
št64_t
 
ms
 = 
	`G‘TimeCouÁMS
();

27 
·r£r
.
	`G‘S‹
().
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_DONE


28 && 
	`G‘TimeCouÁMS
(è< 
ms
 + 
TIMEOUT_MANAGEMENT_SERVER_RESPONDER_REQUEST
)

30 
ev’t_bufãr
.
	`R—dSock‘
(
pSock‘
);

31 
·r£r
.
	`CÚsumeBufãr
(
ev’t_bufãr
);

34 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

36 
pSock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

40 ià(
·r£r
.
	`G‘S‹
().
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_DONE
)

42  
çl£
;

45  
Œue
;

46 
	}
}

48 
boŞ
 
	gMsCl›ÁD©aSessiÚP¬£r
::
	$P¬£C»©eSessiÚRe¥Ú£
(
A´TıSock‘
* 
pSock‘
, 
Ev’tBufãr
& 
ev’t_bufãr
,

49 
MsCl›ÁD©aSessiÚ
::
C»©eD©aSessiÚRe¥Ú£
& 
»¥Ú£
)

51 
XMLT»e
 
Œ“
;

52 
XMLEËm’t
 
chd
;

54 
H‰pP¬£r
 
·r£r
;

55 ià(!
	`R—dC»©eRe¥Ú£
(
pSock‘
, 
ev’t_bufãr
, 
·r£r
))

57  
çl£
;

61 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

63 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

65 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

67 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "CreateDataSession")

69 
	`TRACE
("XML„oÙ i [%s],‚Ù C»©eD©aSessiÚ\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

70  
çl£
;

73 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

77 
	`TRACE
("E¼ÜCodğ%u, C»©eSessiÚ fa\n", 
»¥Ú£
.
»tuº_code
);

78  
çl£
;

81  
Œue
;

82 
	}
}

84 
boŞ
 
	gMsCl›ÁD©aSessiÚP¬£r
::
	$P¬£Clo£SessiÚRe¥Ú£
(
H‰pP¬£r
& 
·r£r
,

85 
MsCl›ÁD©aSessiÚ
::
Clo£D©aSessiÚRe¥Ú£
& 
»¥Ú£
)

87 
XMLT»e
 
Œ“
;

88 
XMLEËm’t
 
chd
;

91 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

93 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

95 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

97 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "CloseDataSession")

99 
	`TRACE
("XML„oÙ i [%s],‚Ù Clo£D©aSessiÚ\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

100  
çl£
;

103 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

107 
	`TRACE
("E¼ÜCodğ%u, Clo£D©aSessiÚ fa\n", 
»¥Ú£
.
»tuº_code
);

108  
çl£
;

111  
Œue
;

112 
	}
}

114 
boŞ
 
	gMsCl›ÁD©aSessiÚP¬£r
::
	$P¬£D©aSessiÚStusReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

115 
MsCl›ÁD©aSessiÚ
::
D©aSessiÚStusReque¡
& 
»que¡
)

117 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

119 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

120 
»que¡
.
£rv”ID
 = 
roÙ
.
	`G‘Chd
("ServerID");

121 
»que¡
.
»que¡ID
 = 
roÙ
.
	`G‘Chd
("RequestID");

123 
¡d
::
veùÜ
<
XMLEËm’t
> 
chd»n
 = 
roÙ
.
	`G‘Chd
("Reque¡IDLi¡").
	`G‘Chd»n
("RequestID");

124 
¡d
::
veùÜ
<
XMLEËm’t
>::
™”©Ü
 
™
 = 
chd»n
.
	`begš
(); iˆ!ğchd»n.
	`’d
(); it++)

126 
ušt32_t
 
tmpID
 = *
™
;

127 
»que¡
.
»que¡IDLi¡
.
	`push_back
(
tmpID
);

130  
Œue
;

131 
	}
}

133 
boŞ
 
	gMsCl›ÁD©aSessiÚP¬£r
::
	$P¬£RemÙeCÚŒŞReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

134 
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞReque¡
& 
»que¡
)

136 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

138 
»que¡
.
£ssiÚ_id
 = 
roÙ
.
	`G‘Chd
("SessionID");

139 
»que¡
.
£rv”ID
 = 
roÙ
.
	`G‘Chd
("ServerID");

140 
»que¡
.
»que¡ID
 = 
roÙ
.
	`G‘Chd
("RequestID");

142 
XMLEËm’t
 
xeTask
 = 
roÙ
.
	`G‘Chd
("Task");

144 
XMLEËm’t
 
xeLib¿ry
 = 
xeTask
.
	`G‘Chd
("Library");

145 ià(
xeLib¿ry
 !ğ
XMLEËm’t
::
em±y_–em’t
)

147 
»que¡
.
skTy³
 = 
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞReque¡
::
eTaskTy³Lib¿ry
;

148 
»que¡
.
¬g
 = 
xeLib¿ry
.
	`G‘Chd
("S¹FunùiÚ").
	`G‘CÚ‹Á
();

149 
»que¡
.
cÚ‹Á
 = 
xeLib¿ry
.
	`G‘Chd
("CÚ‹Á").
	`G‘CÚ‹Á
();

150  
Œue
;

153 
XMLEËm’t
 
xeCom´es£dFe
 = 
xeTask
.
	`G‘Chd
("CompressedFile");

154 ià(
xeCom´es£dFe
 !ğ
XMLEËm’t
::
em±y_–em’t
)

156 
»que¡
.
skTy³
 = 
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞReque¡
::
eTaskTy³Com´es£dFe
;

157 
»que¡
.
¬g
 = 
xeCom´es£dFe
.
	`G‘Chd
("SütFe").
	`G‘CÚ‹Á
();

158 
»que¡
.
cÚ‹Á
 = 
xeCom´es£dFe
.
	`G‘Chd
("CÚ‹Á").
	`G‘CÚ‹Á
();

159  
Œue
;

162  
çl£
;

163 
	}
}

	@../../titanutils/MsClient/ProtocolOperation/MsClientDataSessionParser.h

1 #iâdeà
__MS_CLIENT_DATA_SESSION_PARSER_H__


2 
	#__MS_CLIENT_DATA_SESSION_PARSER_H__


	)

4 
	~"h‰p/h‰p_·r£r.h
"

5 
	~"­r/­r_sock‘.h
"

6 
	~"sûw/xml_Œ“.h
"

8 
	~"MsCl›Á/PrÙocŞDefše/MsCl›ÁD©aSessiÚDefše.h
"

10 
	~"MsCl›Á/MsCl›ÁP¬am‘”s.h
"

12 şas 
	cMsCl›ÁD©aSessiÚP¬£r


14 
	mpublic
:

16 
boŞ
 
R—dC»©eRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
* 
pSock‘
, SYSUTILS_SPACE::
Ev’tBufãr
& 
ev’t_bufãr
,

17 
SYSUTILS_SPACE
::
H‰pP¬£r
& 
·r£r
);

20 
boŞ
 
P¬£C»©eSessiÚRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
* 
pSock‘
,

21 
SYSUTILS_SPACE
::
Ev’tBufãr
& 
ev’t_bufãr
, 
MsCl›ÁD©aSessiÚ
::
C»©eD©aSessiÚRe¥Ú£
& 
»¥Ú£
);

22 
boŞ
 
P¬£Clo£SessiÚRe¥Ú£
(
SYSUTILS_SPACE
::
H‰pP¬£r
& 
·r£r
,

23 
MsCl›ÁD©aSessiÚ
::
Clo£D©aSessiÚRe¥Ú£
& 
»¥Ú£
);

26 
boŞ
 
P¬£D©aSessiÚStusReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

27 
MsCl›ÁD©aSessiÚ
::
D©aSessiÚStusReque¡
& 
»que¡
);

30 
boŞ
 
P¬£RemÙeCÚŒŞReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
,

31 
MsCl›ÁD©aSessiÚ
::
RemÙeCÚŒŞReque¡
& 
»que¡
);

33 
	m´iv©e
:

34 
MsCl›ÁD©aSessiÚP¬£r
();

35 ~
MsCl›ÁD©aSessiÚP¬£r
();

	@../../titanutils/MsClient/ProtocolOperation/MsClientEventSessionGenerate.cpp

1 
	~"MsCl›ÁEv’tSessiÚG’”©e.h
"

3 
	~"commÚ/¡dšt.h
"

4 
	~"commÚ/ut™y.h
"

6 
	~"sûw/xml_Œ“.h
"

8 
	~"T™ªCommÚ/CommÚSŒšg.h
"

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 
boŞ
 
	gMsCl›ÁEv’tSessiÚG’”©e
::
	$G’”©eC»©eEv’tSessiÚReque¡
(cÚ¡ 
MsCl›ÁEv’tSessiÚ
::
C»©eEv’tSessiÚReque¡
 *
ü—‹SessiÚReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

14 
	`IF_NULL_RETURN_VALUE
(
ü—‹SessiÚReque¡
, 
çl£
);

16 
XMLT»e
 
Œ“
;

17 
XMLEËm’t
 
roÙ
, 
chd
;

20 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("CreateEventSession");

21 
roÙ
.
	`AddChd
("SessiÚID", 
ü—‹SessiÚReque¡
->
£ssiÚ_id
);

23 
¡d
::
¡ršg
 
¡rMes§geBody
;

24 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

26 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

28 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/event-session/CreateEventSession");

30 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

32 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/event-session/CreateEventSession");

35 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

36 
	`G’”©eSessiÚIDH—d”
(
ü—‹SessiÚReque¡
->
£ssiÚ_id
) +

37 
CRLF
 +

38 
¡rMes§geBody
;

40  
Œue
;

41 
	}
}

43 
boŞ
 
	gMsCl›ÁEv’tSessiÚG’”©e
::
	$G’”©eClo£Ev’tSessiÚReque¡
(cÚ¡ 
MsCl›ÁEv’tSessiÚ
::
Clo£Ev’tSessiÚReque¡
 *
şo£SessiÚReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

45 
	`IF_NULL_RETURN_VALUE
(
şo£SessiÚReque¡
, 
çl£
);

47 
XMLT»e
 
Œ“
;

48 
XMLEËm’t
 
roÙ
;

49 
XMLEËm’t
 
chd
;

52 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("CloseEventSession");

53 
roÙ
.
	`AddChd
("SessiÚID", 
şo£SessiÚReque¡
->
£ssiÚ_id
);

55 
¡d
::
¡ršg
 
¡rMes§geBody
;

56 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

58 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

60 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/event-session/CloseEventSession");

62 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

64 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/event-session/CloseEventSession");

67 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

68 
	`G’”©eSessiÚIDH—d”
(
şo£SessiÚReque¡
->
£ssiÚ_id
) +

69 
CRLF
 +

70 
¡rMes§geBody
;

72  
Œue
;

73 
	}
}

75 
boŞ
 
	gMsCl›ÁEv’tSessiÚG’”©e
::
	$G’”©eR’ewEv’tSessiÚReque¡
(cÚ¡ 
MsCl›ÁEv’tSessiÚ
::
R’ewSessiÚReque¡
 *
»ÃwSessiÚReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
)

77 
	`IF_NULL_RETURN_VALUE
(
»ÃwSessiÚReque¡
, 
çl£
);

79 
XMLT»e
 
Œ“
;

80 
XMLEËm’t
 
roÙ
;

81 
XMLEËm’t
 
chd
;

84 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("RenewSession");

85 
roÙ
.
	`AddChd
("SessiÚID", 
»ÃwSessiÚReque¡
->
£ssiÚ_id
);

87 
¡d
::
¡ršg
 
¡rMes§geBody
;

88 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

90 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

92 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/event-session/RenewSession");

94 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

96 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/event-session/RenewSession");

100  
çl£
;

103 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

104 
	`G’”©eSessiÚIDH—d”
(
»ÃwSessiÚReque¡
->
£ssiÚ_id
) +

105 
CRLF
 +

106 
¡rMes§geBody
;

108  
Œue
;

109 
	}
}

111 
boŞ
 
	gMsCl›ÁEv’tSessiÚG’”©e
::
	$G’”©eEmaNÙifiÿtiÚReque¡
(

112 cÚ¡ 
MsCl›ÁEv’tSessiÚ
::
S’dEmaNÙifiÿtiÚReque¡
 *
»que¡
,

113 cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
,

114 
¡d
::
¡ršg
 &
¡rMes§ge
)

116 
	`IF_NULL_RETURN_VALUE
(
»que¡
, 
çl£
);

118 
XMLT»e
 
Œ“
;

119 
XMLEËm’t
 
roÙ
, 
chd
;

122 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("EventSendEmailNotification");

123 
roÙ
.
	`AddChd
("SessiÚID", 
»que¡
->
£ssiÚ_id
);

124 
chd
 = 
roÙ
.
	`AddChd
("EmailList");

125 
ušt32_t
 
i
 = 0; i < 
»que¡
->
emaIDLi¡
.
	`size
(); i++)

127 
chd
.
	`AddChd
("Ema").
	`AddA‰ribu‹
("id", 
»que¡
->
emaIDLi¡
[
i
]);

130 
¡d
::
¡ršg
 
¡rMes§geBody
;

131 
	`SaveXMLT»eBufãr
(
¡rMes§geBody
, 
Œ“
);

133 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”RecÜdšgS”v”
)

135 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/recording-server/event-session/EventSendEmailNotification");

137 ià(
loÿlS”v”Ty³
 =ğ
MsCl›Á
::
eLoÿlS”v”M‘ad©aS”v”
)

139 
¡rMes§ge
 = 
	`G’”©eReque¡Lše
("/api/metadata-server/event-session/EventSendEmailNotification");

143  
çl£
;

146 
¡rMes§ge
 +ğ
	`G’”©eMes§geH—d”
(
¡rMes§geBody
.
	`Ëngth
()) +

147 
	`G’”©eSessiÚIDH—d”
(
»que¡
->
£ssiÚ_id
) +

148 
CRLF
 +

149 
¡rMes§geBody
;

151  
Œue
;

152 
	}
}

	@../../titanutils/MsClient/ProtocolOperation/MsClientEventSessionGenerate.h

1 #iâdeà
__MS_CLIENT_EVENT_SESSION_GENERATE_H__


2 
	#__MS_CLIENT_EVENT_SESSION_GENERATE_H__


	)

4 
	~"MsCl›Á/PrÙocŞDefše/MsCl›ÁEv’tSessiÚDefše.h
"

6 
	~"MsCl›Á/MsCl›Á.h
"

8 şas 
	cMsCl›ÁEv’tSessiÚG’”©e


10 
	mpublic
:

11 
boŞ
 
G’”©eC»©eEv’tSessiÚReque¡
(cÚ¡ 
MsCl›ÁEv’tSessiÚ
::
C»©eEv’tSessiÚReque¡
 *
ü—‹SessiÚReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

12 
boŞ
 
G’”©eClo£Ev’tSessiÚReque¡
(cÚ¡ 
MsCl›ÁEv’tSessiÚ
::
Clo£Ev’tSessiÚReque¡
 *
şo£SessiÚReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

13 
boŞ
 
G’”©eR’ewEv’tSessiÚReque¡
(cÚ¡ 
MsCl›ÁEv’tSessiÚ
::
R’ewSessiÚReque¡
 *
»ÃwSessiÚReque¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

14 
boŞ
 
G’”©eEmaNÙifiÿtiÚReque¡
(cÚ¡ 
MsCl›ÁEv’tSessiÚ
::
S’dEmaNÙifiÿtiÚReque¡
 *
»que¡
, cÚ¡ 
MsCl›Á
::
LoÿlS”v”Ty³
 
loÿlS”v”Ty³
, 
¡d
::
¡ršg
 &
¡rMes§ge
);

16 
	m´iv©e
:

17 
MsCl›ÁEv’tSessiÚG’”©e
();

18 ~
MsCl›ÁEv’tSessiÚG’”©e
();

	@../../titanutils/MsClient/ProtocolOperation/MsClientEventSessionParser.cpp

1 
	~"MsCl›ÁEv’tSessiÚP¬£r.h
"

3 
	~"commÚ/¡dšt.h
"

4 
	~"commÚ/¡ršg.h
"

5 
	~"commÚ/sy¡em.h
"

7 
	~"libev’t/ev’t_bufãr.h
"

9 
	~"sûw/xml_Œ“.h
"

11 
	~"cÚ¡/S”v”PrÙocŞDefš™iÚ.h
"

12 
	~"debugMsg/Debug.h
"

14 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

16 
boŞ
 
	gMsCl›ÁEv’tSessiÚP¬£r
::
	$R—dC»©eRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
Ev’tBufãr
 &
ev’t_bufãr
, 
H‰pP¬£r
 &
·r£r
)

18 
št32_t
 
nÚblock_Üigš®
 = 
pSock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

19 
št32_t
 
nÚblock
 = 1;

21 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

23 
pSock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

26 
št64_t
 
ms
 = 
	`G‘TimeCouÁMS
();

27 
·r£r
.
	`G‘S‹
().
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_DONE


28 && 
	`G‘TimeCouÁMS
(è< 
ms
 + 
TIMEOUT_MANAGEMENT_SERVER_RESPONDER_REQUEST
)

30 
ev’t_bufãr
.
	`R—dSock‘
(
pSock‘
);

31 
·r£r
.
	`CÚsumeBufãr
(
ev’t_bufãr
);

34 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

36 
pSock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

40 ià(
·r£r
.
	`G‘S‹
().
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_DONE
)

42  
çl£
;

45  
Œue
;

46 
	}
}

48 
boŞ
 
	gMsCl›ÁEv’tSessiÚP¬£r
::
	$P¬£C»©eSessiÚRe¥Ú£
(
A´TıSock‘
 *
pSock‘
, 
Ev’tBufãr
 &
ev’t_bufãr
, 
MsCl›ÁEv’tSessiÚ
::
C»©eEv’tSessiÚRe¥Ú£
 &
»¥Ú£
)

50 
XMLT»e
 
Œ“
;

51 
XMLEËm’t
 
chd
;

53 
H‰pP¬£r
 
·r£r
;

54 ià(!
	`R—dC»©eRe¥Ú£
(
pSock‘
, 
ev’t_bufãr
, 
·r£r
))

56  
çl£
;

60 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

62 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

64 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

66 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "CreateEventSession")

68 
	`TRACE
("XML„oÙ i [%s],‚Ù C»©eEv’tSessiÚ\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

69  
çl£
;

72 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

76 
	`TRACE
("E¼ÜCodğ%u, C»©eSessiÚ fa\n", 
»¥Ú£
.
»tuº_code
);

77  
çl£
;

80  
Œue
;

81 
	}
}

83 
boŞ
 
	gMsCl›ÁEv’tSessiÚP¬£r
::
	$P¬£Clo£SessiÚRe¥Ú£
(
H‰pP¬£r
 &
·r£r
, 
MsCl›ÁEv’tSessiÚ
::
Clo£Ev’tSessiÚRe¥Ú£
 &
»¥Ú£
)

85 
XMLT»e
 
Œ“
;

86 
XMLEËm’t
 
chd
;

89 
»¥Ú£
.
»tuº_code
 = 
	`¡r_to_u32
(
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-ReturnCode"));

91 ià(
»¥Ú£
.
»tuº_code
 =ğ
S”v”PrÙocŞ
::
ERROR_NONE
)

93 
	`LßdXMLT»eBufãr
(
·r£r
.
	`G‘D©a
().
	`G‘Body
(), 
Œ“
);

95 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "CloseEventSession")

97 
	`TRACE
("XML„oÙ i [%s],‚Ù Clo£Ev’tSessiÚ\n", 
Œ“
.
	`G‘RoÙ
().
	`G‘Name
().
	`c_¡r
());

98  
çl£
;

101 
»¥Ú£
.
£ssiÚ_id
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("SessionID");

105 
	`TRACE
("E¼ÜCodğ%u, Clo£Ev’tSessiÚ fa\n", 
»¥Ú£
.
»tuº_code
);

106  
çl£
;

109  
Œue
;

110 
	}
}

	@../../titanutils/MsClient/ProtocolOperation/MsClientEventSessionParser.h

1 #iâdeà
__MS_CLIENT_EVENT_SESSION_PARSER_H__


2 
	#__MS_CLIENT_EVENT_SESSION_PARSER_H__


	)

4 
	~"h‰p/h‰p_·r£r.h
"

5 
	~"­r/­r_sock‘.h
"

7 
	~"MsCl›Á/PrÙocŞDefše/MsCl›ÁEv’tSessiÚDefše.h
"

9 
	~"MsCl›Á/MsCl›ÁP¬am‘”s.h
"

11 şas 
	cMsCl›ÁEv’tSessiÚP¬£r


13 
	mpublic
:

15 
boŞ
 
R—dC»©eRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, SYSUTILS_SPACE::
Ev’tBufãr
 &
ev’t_bufãr
, SYSUTILS_SPACE::
H‰pP¬£r
 &
·r£r
);

18 
boŞ
 
P¬£C»©eSessiÚRe¥Ú£
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, SYSUTILS_SPACE::
Ev’tBufãr
 &
ev’t_bufãr
, 
MsCl›ÁEv’tSessiÚ
::
C»©eEv’tSessiÚRe¥Ú£
 &
»¥Ú£
);

19 
boŞ
 
P¬£Clo£SessiÚRe¥Ú£
(
SYSUTILS_SPACE
::
H‰pP¬£r
 &
·r£r
, 
MsCl›ÁEv’tSessiÚ
::
Clo£Ev’tSessiÚRe¥Ú£
 &
»¥Ú£
);

21 
	m´iv©e
:

22 
MsCl›ÁEv’tSessiÚP¬£r
();

23 ~
MsCl›ÁEv’tSessiÚP¬£r
();

	@../../titanutils/MsClient/RequestWorker/RequestWorker.cpp

1 
	~"Reque¡WÜk”.h
"

3 
	~"commÚ/sy¡em.h
"

4 
	~"debugMsg/Debug.h
"

6 
	~"MsCl›ÁD©aSessiÚHªdËr.h
"

8 #ià
defšed
(
__lšux__
)

9 
	~<sys/´ùl.h
>

12 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

14 
	gReque¡WÜk”
::
	$Reque¡WÜk”
(
SessiÚHªdËr
* 
hªdËr
)

15 : 
	`m_HªdËr
(
hªdËr
)

16 , 
	`m_£mReque¡
()

17 , 
	`m_S‘abË
(
Œue
)

18 , 
	`m_T»e
()

19 , 
	$m_CS
()

21 
	`C»©eTh»ad
();

22 
	}
}

24 
	gReque¡WÜk”
::~
	$Reque¡WÜk”
()

26 ià(
	`Th»adExi¡s
())

28 
	`C®lWÜk”
(
Reque¡WÜk”
::
eTC_STOP
, 
NULL
);

29 
	`Clo£Th»ad
();

31 
	}
}

33 
boŞ
 
	gReque¡WÜk”
::
	$CheckS‘abË
()

35 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_CS
);

37  
m_S‘abË
;

38 
	}
}

40 
boŞ
 
	gReque¡WÜk”
::
	$S‘Reque¡D©a
(cÚ¡ 
XMLT»e
& 
Œ“
)

42 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_CS
);

44 ià(
m_S‘abË
)

46 
m_S‘abË
 = 
çl£
;

47 
m_T»e
 = 
Œ“
;

49 
m_£mReque¡
.
	`Po¡
();

51  
Œue
;

55  
çl£
;

57 
	}
}

59 
	gReque¡WÜk”
::
	$Th»adProc
()

61 #ià
	`defšed
(
__lšux__
)

62 
	`´ùl
(
PR_SET_NAME
, "RequestWorker", 0, 0, 0);

65 
Œue
)

70 
ušt32_t
 
uMes§ge
 = (ušt32_t)
eTC_STOP
;

71 ià(
	`CheckReque¡
(&
uMes§ge
))

73 (
Th»adCommªd
)
uMes§ge
)

75 
eTC_STOP
:

76 
	`R•ly
(0);

79 
	`R•ly
((
ušt32_t
)-1);

87 ià(!
m_£mReque¡
.
	`Wa™
(3000))

92 ià(!
m_S‘abË
)

94 
MsCl›ÁD©aSessiÚHªdËr
* 
hªdËr
 = 
dyÇmic_ÿ¡
<MsCl›ÁD©aSessiÚHªdËr*>(
m_HªdËr
);

95 ià(
hªdËr
 !ğ
NULL
)

97 
hªdËr
->
	`HªdËS”v”D•’dReque¡
(
m_T»e
);

101 
	`ASSERT
(
çl£
);

105 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_CS
);

106 
m_S‘abË
 = 
Œue
;

110 
	}
}

	@../../titanutils/MsClient/RequestWorker/RequestWorker.h

1 #iâdeà
__REQUEST_WORKER_H__


2 
	#__REQUEST_WORKER_H__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"commÚ/£m­hÜe.h
"

6 
	~"sûw/xml_Œ“.h
"

7 
	~"­r/­r_th»ad_wÜk”.h
"

9 
şass
 
	gSessiÚHªdËr
;

11 şas 
	cReque¡WÜk”
: 
public
 
SYSUTILS_SPACE
::
A´Th»adWÜk”


13 
´iv©e
:

14 
	eTh»adCommªd


16 
eTC_STOP


19 
	gpublic
:

20 
Reque¡WÜk”
(
SessiÚHªdËr
* 
hªdËr
);

21 
	gvœtu®
 ~
Reque¡WÜk”
();

23 
boŞ
 
CheckS‘abË
();

24 
boŞ
 
S‘Reque¡D©a
(cÚ¡ 
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
);

26 
	g´iv©e
:

27 
vœtu®
 
Th»adProc
();

29 
Reque¡WÜk”
(cÚ¡ Reque¡WÜk”& 
rhs
);

30 
	gReque¡WÜk”
& 
	gİ”©Ü
=(cÚ¡ 
Reque¡WÜk”
& 
rhs
);

32 
	g´iv©e
:

33 
SessiÚHªdËr
* 
m_HªdËr
;

35 
	gSYSUTILS_SPACE
::
Sem­hÜe
 
m_£mReque¡
;

37 
boŞ
 
	gm_S‘abË
;

38 
	gSYSUTILS_SPACE
::
XMLT»e
 
m_T»e
;

39 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_CS
;

	@../../titanutils/MsClient/UpgradeThread/UpgradeThread.cpp

1 
	~"Upg¿deTh»ad.h
"

3 
	~"debugMsg/Debug.h
"

5 
	~"commÚ/fe.h
"

6 
	~"commÚ/h¬dw¬e.h
"

8 
	~<¡dlib.h
>

10 #ià
defšed
(
__lšux__
)

11 
	~<sys/´ùl.h
>

14 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

16 #ifdeà
WIN32


17 
	#¡¹ok_r
 
¡¹ok_s


	)

20 
	gUpg¿deTh»ad
::
	$Upg¿deTh»ad
(
¡d
::
¡ršg
& 
feP©h
)

21 : 
	`m_fœmw¬eP©h
(
feP©h
)

22 , 
	$m_upg¿deFšish
(
çl£
)

24 
	`G‘ProduùInfo
(
m_ProduùInfo
);

25 
	}
}

27 
	gUpg¿deTh»ad
::~
	$Upg¿deTh»ad
()

29 ià(
	`Th»adExi¡s
())

31 
	`C®lWÜk”
(
Upg¿deTh»ad
::
eTC_STOP
, 
NULL
);

32 
	`Clo£Th»ad
();

34 
	}
}

36 
boŞ
 
	gUpg¿deTh»ad
::
	$G‘Upg¿deStus
()

38  
m_upg¿deFšish
;

39 
	}
}

41 
	gUpg¿deTh»ad
::
	$Th»adProc
()

43 #ià
	`defšed
(
__lšux__
)

44 
	`´ùl
(
PR_SET_NAME
, "UpgradeThread", 0, 0, 0);

46 
cmd
[256];

48 
	`D–‘eDœeùÜy
("/tmp/upgrade/");

49 
	`MakeDœeùÜy
("/tmp/upgrade/");

51 
	`sy¡em
("mount -tmpfs -o size=600mmpfs /tmp/upgrade/");

53 
	`¥rštf
(
cmd
, "İ’s¦ bf-cbø-d -š % -ouˆ/tmp/upg¿de/fœmw¬e.r.bz2 -k ow’xbjasÚlijulud”bÏudyz®“dg¬¡rÚg", 
m_fœmw¬eP©h
.
	`c_¡r
());

54 
	`sy¡em
(
cmd
);

56 
	`RemoveFe
(
m_fœmw¬eP©h
);

59 
	`TRACE
("extract firmware...\n");

60 
	`sy¡em
("tar fxj /tmp/upgrade/firmware.tar.bz2 -C /tmp/upgrade/");

63 
FILE
 *
fe
;

64 
fe
 = 
	`fİ’
("/tmp/upgrade/NVRimage/titan.conf", "r");

65 ià(
fe
 !ğ
NULL
)

67 
¡d
::
¡ršg
 
fœmw¬eTy³
;

69 
ušt32_t
 
feSize
 = (ušt32_t)
	`G‘FeStÜageSize
("/tmp/upgrade/NVRimage/titan.conf");

70 
ušt8_t
* 
bufãr
 = (ušt8_t*)
	`m®loc
(
feSize
);

72 ià(
bufãr
 =ğ
NULL
)

74 
	`fşo£
(
fe
);

75 
	`ASSERT2
(0, "can't malloc buffer...\n");

76 
m_upg¿deFšish
 = 
Œue
;

81 
	`ä—d
(
bufãr
, 1, 
feSize
, 
fe
);

83 * 
sub¡ršg
;

84 * 
tok’
;

85 * 
Ï¡
;

89 
sub¡ršg
 = 
	`¡r¡r
((*)
bufãr
,"Machine=");

90 
tok’
 = 
	`¡¹ok_r
(
sub¡ršg
, "=\n", &
Ï¡
);

92 ià(
tok’
 !ğ
NULL
)

94 
tok’
 = 
	`¡¹ok_r
(
NULL
, "=\n", &
Ï¡
);

97 ià(
tok’
 !ğ
NULL
)

99 
fœmw¬eTy³
.
	`assign
(
tok’
, 
	`¡¾’
(token));

102 
	`ä“
(
bufãr
);

103 
	`fşo£
(
fe
);

105 ià(
m_ProduùInfo
.
¡rMachšeKey
 !ğ
fœmw¬eTy³
)

107 
	`ASSERT2
(0, "Fœmw¬ty³ incÜ»ù (%s), machšty³ (%s)\n", 
fœmw¬eTy³
.
	`c_¡r
(), 
m_ProduùInfo
.
¡rMachšeKey
.c_str());

108 
	`sy¡em
("umount /tmp/upgrade/");

109 
	`D–‘eDœeùÜy
("/tmp/upgrade/");

110 
m_upg¿deFšish
 = 
Œue
;

115 
	`TRACE
("Check fœmw¬ty³ ok %s\n", 
fœmw¬eTy³
.
	`c_¡r
());

119 
	`ASSERT2
(0, "can't openitan.conf fileo…arse firmwareype...\n");

120 
	`sy¡em
("umount /tmp/upgrade/");

121 
	`D–‘eDœeùÜy
("/tmp/upgrade/");

122 
m_upg¿deFšish
 = 
Œue
;

128 
FILE
 *
f
;

129 
f
 = 
	`fİ’
("/tmp/upgrade/NVRimage/upgrade.sh", "a");

130 ià(
f
 !ğ
NULL
)

132 
	`årštf
(
f
, "sleep 10\n");

133 
	`årštf
(
f
, "sh -c /tmp/upgrade/NVRimage/reboot\n");

135 
	`fşo£
(
f
);

139 
	`ASSERT2
(0, "can't open upgrade.sh file...„eboot system manual\n");

142 
	`TRACE
("upgrade firmware...\n");

143 
	`sy¡em
("sh -c /tmp/upgrade/NVRimage/upgrade.sh");

144 
m_upg¿deFšish
 = 
Œue
;

145 
	}
}

	@../../titanutils/MsClient/UpgradeThread/UpgradeThread.h

1 #iâdeà
__UPGRADE_THREAD_H__


2 
	#__UPGRADE_THREAD_H__


	)

4 
	~<io¡»am
>

5 
	~"­r/­r_th»ad_wÜk”.h
"

6 
	~"T™ªCommÚ/CommÚUt™y.h
"

8 şas 
	cUpg¿deTh»ad
: 
public
 
SYSUTILS_SPACE
::
A´Th»adWÜk”


10 
´iv©e
:

11 
	eTh»adCommªd


13 
eTC_STOP


16 
	gpublic
:

17 
Upg¿deTh»ad
(
¡d
::
¡ršg
 &
feP©h
);

18 
	gvœtu®
 ~
Upg¿deTh»ad
();

20 
boŞ
 
G‘Upg¿deStus
();

22 
	g´iv©e
:

23 
vœtu®
 
Th»adProc
();

25 
	g´iv©e
:

26 
¡d
::
¡ršg
 
m_fœmw¬eP©h
;

27 
boŞ
 
	gm_upg¿deFšish
;

28 
ProduùInfo
 
	gm_ProduùInfo
;

	@../../titanutils/RecordingHeader/RL_packet_header.h

1 #´agm¨
·ck
(
push
, 1)

4 
	sRL_·ck‘_h—d”


6 
	mv”siÚ_a
;

7 
	mv”siÚ_b
;

8 
	mis_key_äame
;

9 
	mis_audio
;

11 
	m·ck‘_size
;

12 
	maudio_·ck‘_ty³
;

14 
	m·ck‘_time
;

16 
	mimm”_visiÚ
;

17 
	mis_æ³d
;

18 
	mimm”_visiÚ_sdk_id
;

19 
	m»£rve0_d
;

21 
	mcodec_v®ue
;

24 
	#PACKET_HEADER_SIZE
 (
RL_·ck‘_h—d”
)

	)

26 #´agm¨
·ck
(
pİ
)

	@../../titanutils/TitanCommon/CommonDeviceIDDefine.h

1 #iâdeà
__TITAN_COMMON_DEVICE_ID_DEFINE_H__


2 
	#__TITAN_COMMON_DEVICE_ID_DEFINE_H__


	)

5 
	#GET_ITEM_TYPE_ID
(
ID
è(ID >> 48)

	)

8 
	#GET_DEVICE_ID
(
DeviûTy³
, 
P”h”yID
) \

9 (((
	`UINT64_C
(
DeviûTy³
è<< 30è| ((
P”h”yID
 >> 18è& 0x3FFFFFFF)è<< 18)

	)

	@../../titanutils/TitanCommon/CommonString.cpp

1 
	~"CommÚSŒšg.h
"

2 
	~"CommÚUt™y.h
"

4 
	~<¡dio.h
>

5 
	~<¡d¬g.h
>

6 
	~<¡dlib.h
>

7 
	~<¡ršg.h
>

9 
	~"commÚ/ut™y.h
"

10 
	~"commÚ/¡ršg.h
"

12 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

14 
	g¡d
::
¡ršg
 
	$G’”©eReque¡Lše
(cÚ¡ 
¡d
::
¡ršg
& 
uri
)

16 cÚ¡ 
s_»que¡_fÜm©
[] = "POST % HTTP/1.1" 
CRLF
;

17  
	`¡ršg_fÜm©
(
s_»que¡_fÜm©
, 
uri
.
	`c_¡r
());

18 
	}
}

20 
	g¡d
::
¡ršg
 
	$G’”©eStusLše
(
ušt32_t
 
code
)

22 cÚ¡ 
s_¡©us_fÜm©
[] = "HTTP/1.1 %u %s" 
CRLF
;

24 
code
)

27  "HTTP/1.1 200 OK" 
CRLF
;

29  "HTTP/1.1 400 Bad Reque¡" 
CRLF
;

31  "HTTP/1.1 401 UÇuthÜized" 
CRLF
;

33  "HTTP/1.1 403 FÜbidd’" 
CRLF
;

35  "HTTP/1.1 404 NÙ Found" 
CRLF
;

37  "HTTP/1.1 405 M‘hod NÙ AÎowed" 
CRLF
;

39  "HTTP/1.1 500 IÁ”ÇÈS”v” E¼Ü" 
CRLF
;

41  "HTTP/1.1 502 S”viû TempÜ¬y Ov”lßded" 
CRLF
;

43  
	`¡ršg_fÜm©
(
s_¡©us_fÜm©
, 
code
, 
	`g‘_h‰p_¡©us_desütiÚ
(code));

45 
	}
}

47 
	g¡d
::
¡ršg
 
	$G’”©eMes§geH—d”
(
ušt32_t
 
Ëngth
)

49 cÚ¡ 
s_cÚ‹Á_Ëngth_f›ld_fÜm©
[] =

50 "CÚ‹Á-Ty³:‡µliÿtiÚ/xml; ch¬£t=utf-8" 
CRLF


51 "CÚ‹Á-L’gth: %u" 
CRLF


52 "CÚÃùiÚ: K“p-Alive" 
CRLF
;

54  
	`¡ršg_fÜm©
(
s_cÚ‹Á_Ëngth_f›ld_fÜm©
, 
Ëngth
);

55 
	}
}

57 
	g¡d
::
¡ršg
 
	$G’”©eC’Œ®izedUpg¿deMes§geH—d”
(
ušt32_t
 
Ëngth
)

59 cÚ¡ 
s_cÚ‹Á_Ëngth_f›ld_fÜm©
[] =

60 "CÚ‹Á-Ty³:‡µliÿtiÚ/où‘-¡»am; ch¬£t=utf-8" 
CRLF


61 "CÚ‹Á-L’gth: %u" 
CRLF


62 "CÚÃùiÚ: K“p-Alive" 
CRLF
;

64  
	`¡ršg_fÜm©
(
s_cÚ‹Á_Ëngth_f›ld_fÜm©
, 
Ëngth
);

65 
	}
}

67 
	g¡d
::
¡ršg
 
	$G’”©eAuthÜiz©iÚH—d”
(cÚ¡ 
¡d
::
¡ršg
& 
u£ºame
, cÚ¡ std::¡ršg& 
·sswÜd
)

69 cÚ¡ 
s_authÜiz©iÚ_f›ld_fÜm©
[] =

70 "AuthÜiz©iÚ: Basiø%s" 
CRLF
;

72  
	`¡ršg_fÜm©
(
s_authÜiz©iÚ_f›ld_fÜm©
, 
	`G’”©eAuthÜiz©iÚ
(
u£ºame
, 
·sswÜd
).
	`c_¡r
());

73 
	}
}

75 
	g¡d
::
¡ršg
 
	$G’”©eSessiÚIDH—d”
(
ušt32_t
 
id
)

77 cÚ¡ 
s_£ssiÚ_id_f›ld_fÜm©
[] =

78 "NUUO-SessiÚID: %u" 
CRLF
;

80  
	`¡ršg_fÜm©
(
s_£ssiÚ_id_f›ld_fÜm©
, 
id
);

81 
	}
}

83 
	g¡d
::
¡ršg
 
	$G’”©eReque¡IDH—d”
(
ušt32_t
 
id
)

85 cÚ¡ 
s_»que¡_id_f›ld_fÜm©
[] =

86 "NUUO-Reque¡ID: %u" 
CRLF
;

88  
	`¡ršg_fÜm©
(
s_»que¡_id_f›ld_fÜm©
, 
id
);

89 
	}
}

91 
	g¡d
::
¡ršg
 
	$G’”©eR‘uºCodeH—d”
(
ušt32_t
 
code
)

93 cÚ¡ 
s_»tuº_code_f›ld_fÜm©
[] =

94 "NUUO-R‘uºCode: %u" 
CRLF
;

96  
	`¡ršg_fÜm©
(
s_»tuº_code_f›ld_fÜm©
, 
code
);

97 
	}
}

99 
	g¡d
::
¡ršg
 
	$G’”©eGSßpE¼ÜRe¥Ú£
(cÚ¡ 
¡d
::
¡ršg
& 
çuÉ
, 
ušt32_t
 
code
, cÚ¡ std::¡ršg& 
šfo
)

101 cÚ¡ 
s_sßp_”rÜ_»¥Ú£_fÜm©
[] =

122 
¡d
::
¡ršg
 
»¥Ú£
 = 
	`¡ršg_fÜm©
(
s_sßp_”rÜ_»¥Ú£_fÜm©
, 
çuÉ
.
	`c_¡r
(), 
code
, 
šfo
.c_str());

123 
¡d
::
¡ršg
 
h—d”
 = 
	`G’”©eMes§geH—d”
(
»¥Ú£
.
	`Ëngth
());

125  
	`G’”©eStusLše
(200è+ 
h—d”
 + 
CRLF
 + 
»¥Ú£
;

126 
	}
}

	@../../titanutils/TitanCommon/CommonString.h

1 #iâdeà
__TITAN_COMMON_STRING_H__


2 
	#__TITAN_COMMON_STRING_H__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~<¡ršg
>

7 
	~<veùÜ
>

9 
	~"h‰p/h‰p_h—d”_defše.h
"

10 
	~"h‰p/h‰p_¡©us_defše.h
"

12 
	g¡d
::
¡ršg
 
G’”©eReque¡Lše
(cÚ¡ 
¡d
::¡ršg& 
uri
);

13 
	g¡d
::
¡ršg
 
G’”©eStusLše
(
ušt32_t
 
code
);

14 
	g¡d
::
¡ršg
 
G’”©eMes§geH—d”
(
ušt32_t
 
Ëngth
);

15 
	g¡d
::
¡ršg
 
G’”©eC’Œ®izedUpg¿deMes§geH—d”
(
ušt32_t
 
Ëngth
);

16 
	g¡d
::
¡ršg
 
G’”©eAuthÜiz©iÚH—d”
(cÚ¡ 
¡d
::¡ršg& 
u£ºame
, cÚ¡ std::¡ršg& 
·sswÜd
);

17 
	g¡d
::
¡ršg
 
G’”©eSessiÚIDH—d”
(
ušt32_t
 
id
);

18 
	g¡d
::
¡ršg
 
G’”©eReque¡IDH—d”
(
ušt32_t
 
id
);

19 
	g¡d
::
¡ršg
 
G’”©eR‘uºCodeH—d”
(
ušt32_t
 
code
);

20 
	g¡d
::
¡ršg
 
G’”©eGSßpE¼ÜRe¥Ú£
(cÚ¡ 
¡d
::¡ršg& 
çuÉ
, 
ušt32_t
 
code
, cÚ¡ std::¡ršg& 
šfo
);

	@../../titanutils/TitanCommon/CommonUtility.cpp

1 
	~<®gÜ™hm
>

3 
	~"CommÚUt™y.h
"

4 
	~"CommÚSŒšg.h
"

6 
	~"commÚ/ut™y.h
"

7 
	~"commÚ/h¬dw¬e.h
"

8 
	~"commÚ/fe.h
"

9 
	~"commÚ/¡ršg.h
"

11 
	~"­r/­r_ut™y.h
"

13 
	~"debugMsg/Debug.h
"

15 
	~"libb64/decode.h
"

16 
	~"libb64/’code.h
"

18 
	~"¶©fÜm/šşude/¶©fÜm_šfo.h
"

19 
	~"¶©fÜm/šşude/check_uts.h
"

20 
	~"¶©fÜm/šşude/g‘_sy¡em_šfo.h
"

22 
	~"cÚ¡/P©hCÚ¡.h
"

24 #ifdeà
WIN32


25 
	#HARDWARE_PATH
 "C:\\mÁ\\NU20\\‘c\\t™ª.cÚf"

	)

26 
	#HARDWARE_OEM_PATH
 "C:\\mÁ\\NU20\\mtd\\Ûm\\‘c\\t™ª.cÚf"

	)

27 
	#¡¹ok_r
 
¡¹ok_s


28 #–£

	)

29 
	#HARDWARE_PATH
 "/‘c/t™ª.cÚf"

	)

30 
	#HARDWARE_OEM_PATH
 "/mtd/Ûm/‘c/t™ª.cÚf"

	)

33 cÚ¡ 
	gOEM_NAME_ARRAY
[][2][64] = {{"NUUO", "TlVVTw=="}, {"SPARK", "U1BBUks="}};

65 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

67 
boŞ
 
	$S’dH‰pE¼Ü
(
A´TıSock‘
 *
pSock‘
, 
ušt32_t
 
nCode
, 
št64_t
 
timeout
 )

69 
	`IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

71 
¡d
::
¡ršg
 
»¥Ú£
 = 
	`G’”©eStusLše
(
nCode
è+ "CÚ‹Á-L’gth: 0 " 
CRLF
 CRLF;

74 
	`Wr™eSock‘UÁTimeout
(
pSock‘
, 
»¥Ú£
, 
timeout
);

76  
Œue
;

77 
	}
}

79 
boŞ
 
	$G‘AuthÜiz©iÚ
(cÚ¡ 
¡d
::
¡ršg
& 
authÜiz©iÚ
, std::¡ršg& 
u£ºame
, std::¡ršg& 
·sswÜd
)

82 *
authÜiz©iÚ_’coded
 = 
Ãw
 [
authÜiz©iÚ
.
	`Ëngth
() + 1];

83 
	`IF_NULL_RETURN_VALUE
(
authÜiz©iÚ_’coded
, 
çl£
);

84 
	`IF_NOT_EQUAL_RETURN_VALUE
(
	`ssÿnf
(
authÜiz©iÚ
.
	`c_¡r
(), " Basiø%s", 
authÜiz©iÚ_’coded
), 1, 
çl£
);

85 
¡d
::
¡ršg
 
’code
 = 
authÜiz©iÚ_’coded
;

86 
¡d
::
¡ršg
 
decode
;

87 
uiL’
 = 0;

88 
ba£64
::
decod”
::
	`decode
(
’code
, 
decode
, 
uiL’
);

89 
d–‘e
 [] 
authÜiz©iÚ_’coded
;

92 
	`TRACE
("authÜiz©iÚ_’coded: %s, %d\n", 
’code
.
	`c_¡r
(),ƒncode.
	`Ëngth
());

93 
	`TRACE
("authÜiz©iÚ_decoded: %s, %d\n", 
decode
.
	`c_¡r
(), decode.
	`Ëngth
());

95 
size_t
 
£·¿tÜ
 = 
decode
.
	`fšd
(":");

97 ià(
£·¿tÜ
 !ğ
¡d
::
¡ršg
::
Åos
)

99 
u£ºame
 = 
decode
.
	`sub¡r
(0, 
£·¿tÜ
);

100 
·sswÜd
 = 
decode
.
	`sub¡r
(
£·¿tÜ
 + 
	`¡¾’
(":"), decode.
	`Ëngth
(è- 
u£ºame
.length() - strlen(":"));

101 
	`TRACE
("u£ºame: %s\n", 
u£ºame
.
	`c_¡r
());

102 
	`TRACE
("·sswÜd: %s\n", 
·sswÜd
.
	`c_¡r
());

105  
Œue
;

106 
	}
}

108 
	g¡d
::
¡ršg
 
	$G’”©eAuthÜiz©iÚ
(cÚ¡ 
¡d
::
¡ršg
& 
u£ºame
, cÚ¡ std::¡ršg& 
·sswÜd
)

110 
¡d
::
¡ršg
 
authÜiz©iÚ
;

113 
ba£64
::
’cod”
::
	`’code
(
u£ºame
 + ":" + 
·sswÜd
, 
authÜiz©iÚ
);

115  
authÜiz©iÚ
;

116 
	}
}

119 
	g¡d
::
¡ršg
 
	$DecodeCodecName
(cÚ¡ 
¡d
::
¡ršg
& 
¡rDecode
)

121 
size_t
 
uiSize
 = (
OEM_NAME_ARRAY
) / ((() * 2 * 64));

122 
size_t
 
ui
 = 0; u˜< 
uiSize
; ui++)

124 ià(
¡rDecode
.
	`com·»
(
OEM_NAME_ARRAY
[
ui
][1]) == 0)

126  
OEM_NAME_ARRAY
[
ui
][0];

131 
	}
}

133 
	g¡d
::
¡ršg
 
	$EncodeCodecName
(cÚ¡ 
¡d
::
¡ršg
& 
¡rOri
)

135 
size_t
 
uiSize
 = (
OEM_NAME_ARRAY
) / ((() * 2 * 64));

136 
size_t
 
ui
 = 0; u˜< 
uiSize
; ui++)

138 ià(
¡rOri
.
	`com·»
(
OEM_NAME_ARRAY
[
ui
][0]) == 0)

140  
OEM_NAME_ARRAY
[
ui
][1];

147 
	}
}

149 
	g¡d
::
¡ršg
 
T¿nsãrOEMName
(cÚ¡ 
¡d
::
veùÜ
<¡d::¡ršg>& 
vOEM
)

151 
size_t
 
ui
 = 0; 
	gui
 < 
	gvOEM
.
size
(); ui++)

153 ià(
	gvOEM
[
ui
] == "NT-4040" ||

154 
vOEM
[
ui
] == "NT-8040R" ||

155 
vOEM
[
ui
] == "NT-VM")

159 ià(
	gvOEM
[
ui
] == "SR-V-4550" ||

160 
vOEM
[
ui
] == "SR-V-4420" ||

161 
vOEM
[
ui
] == "Spark_Xenario_VM")

171 
	$R—dProduùInfoFromFe
(cÚ¡ * 
feP©h
, 
ProduùInfo
& 
´oduùInfo
)

173 
FILE
 *
±r
;

174 
±r
 = 
	`fİ’
(
feP©h
, "r");

175 ià(
±r
 =ğ
NULL
)

180 
ušt32_t
 
feSize
 = (ušt32_t)
	`G‘FeStÜageSize
(
feP©h
);

181 
ušt8_t
* 
bufãr
 = (ušt8_t*)
	`m®loc
(
feSize
);

183 ià(
bufãr
 =ğ
NULL
)

185 
	`fşo£
(
±r
);

189 
	`ä—d
(
bufãr
, 1, 
feSize
, 
±r
);

190 * 
sub¡ršg
;

191 * 
tok’
;

192 * 
Ï¡
;

196 
sub¡ršg
 = 
	`¡r¡r
((*)
bufãr
, "Machine=");

197 
tok’
 = 
	`¡¹ok_r
(
sub¡ršg
, "=\n", &
Ï¡
);

199 ià(
tok’
 !ğ
NULL
)

201 
tok’
 = 
	`¡¹ok_r
(
NULL
, "=\n", &
Ï¡
);

204 ià(
tok’
 !ğ
NULL
)

206 
´oduùInfo
.
¡rMachšeKey
.
	`assign
(
tok’
, 
	`¡¾’
(token));

210 
´oduùInfo
.
vOEM
.
	`ş—r
();

211 
size_t
 
ui
 = 1; ui <= 3; ui++)

213 
¡d
::
¡ršg
 
¡rOEMIdx
 = 
SYSUTILS_SPACE
::
	`¡ršg_fÜm©
("OEM_%u=", 
ui
);

215 
sub¡ršg
 = 
	`¡r¡r
((*)
bufãr
, 
¡rOEMIdx
.
	`c_¡r
());

216 
tok’
 = 
	`¡¹ok_r
(
sub¡ršg
, "=\n", &
Ï¡
);

218 ià(
tok’
 !ğ
NULL
)

220 
tok’
 = 
	`¡¹ok_r
(
NULL
, "=\n", &
Ï¡
);

223 ià(
tok’
 !ğ
NULL
)

225 
¡d
::
¡ršg
 
¡rOEM
;

226 
¡rOEM
.
	`assign
(
tok’
, 
	`¡¾’
(token));

227 
´oduùInfo
.
vOEM
.
	`push_back
(
¡rOEM
);

231 
	`ä“
(
bufãr
);

232 
	`fşo£
(
±r
);

234 
	}
}

236 
boŞ
 
	$G‘ProduùInfo
(
ProduùInfo
& 
´oduùInfo
)

239 ià(
	`CheckFeExi¡
(
HARDWARE_PATH
))

241 
	`R—dProduùInfoFromFe
(
HARDWARE_PATH
, 
´oduùInfo
);

245 ià(
	`CheckFeExi¡
(
HARDWARE_OEM_PATH
))

247 
	`R—dProduùInfoFromFe
(
HARDWARE_OEM_PATH
, 
´oduùInfo
);

250 
´oduùInfo
.
¡rOEMName
 = 
	`T¿nsãrOEMName
ÕroduùInfo.
vOEM
);

251 
´oduùInfo
.
¡rEncodeOEMName
 = 
	`EncodeCodecName
ÕroduùInfo.
¡rOEMName
);

253  
Œue
;

254 
	}
}

256 
boŞ
 
	$G‘CPUTem³¿tu»ByProduù
(& 
‹m³¿tu»
)

258 
sy¡em_‹mps
 
¡
;

259 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜmInfo
(
NULL
);

260 
	`G‘Sy¡emTem³¿tu»
(&
¡
);

262 ià(
¶©fÜm
 =ğ
CRYSTAL_PLATFORM_VM
)

263  
çl£
;

265 ià(
¡
.
v®id_ıu
) {

266 ià(
¡
.
ıu
 < 50 * 1000 && 
¶©fÜm
 =ğ
CRYSTAL_PLATFORM_R1
) {

267 
‹m³¿tu»
 = -50.0f;

269 
‹m³¿tu»
 = (è(
¡
.
ıu
 / 1000.0);

272  
Œue
;

275  
çl£
;

276 
	}
}

278 
boŞ
 
	$G‘Sy¡emTem³¿tu»ByProduù
(& 
‹m³¿tu»
)

280 
sy¡em_‹mps
 
¡
;

281 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜmInfo
(
NULL
);

282 
	`G‘Sy¡emTem³¿tu»
(&
¡
);

284 ià(
¶©fÜm
 =ğ
CRYSTAL_PLATFORM_VM
)

285  
çl£
;

287 ià(
¡
.
v®id_sy¡em
) {

288 
‹m³¿tu»
 = (è(
¡
.
sy¡em
 / 1000.0);

289  
Œue
;

292  
çl£
;

293 
	}
}

295 
boŞ
 
	$G‘CPUFªS³edByProduù
(
ušt32_t
& 
çnS³ed
)

297 
sy¡em_çn_¥“ds
 
sfs
;

298 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜmInfo
(
NULL
);

299 
	`G‘Sy¡emFªS³ed
(&
sfs
);

301 ià(
¶©fÜm
 =ğ
CRYSTAL_PLATFORM_VM
)

302  
çl£
;

304 ià(
sfs
.
v®id_ıu
) {

305 
çnS³ed
 = 
sfs
.
ıu
;

306  
Œue
;

309  
çl£
;

310 
	}
}

312 
boŞ
 
	$G‘Sy¡emFªS³edByProduù
(
ušt32_t
& 
çnS³ed
)

314 
sy¡em_çn_¥“ds
 
sfs
;

315 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜmInfo
(
NULL
);

316 
	`G‘Sy¡emFªS³ed
(&
sfs
);

318 ià(
¶©fÜm
 =ğ
CRYSTAL_PLATFORM_VM
)

319  
çl£
;

321 ià(
sfs
.
v®id_sy¡em
[0]) {

322 
çnS³ed
 = 
sfs
.
sy¡em
[0];

323  
Œue
;

326  
çl£
;

327 
	}
}

329 
boŞ
 
G‘ExŒaSy¡emFªS³edByProduù
(
¡d
::
veùÜ
<
ušt32_t
>& 
vFªS³ed
)

331 
sy¡em_çn_¥“ds
 
sfs
;

332 
	g¶©fÜm
 = 
G‘Cry¡®PÏtfÜmInfo
(
NULL
);

333 
G‘Sy¡emFªS³ed
(&
sfs
);

335 ià(
	g¶©fÜm
 =ğ
CRYSTAL_PLATFORM_VM
)

336  
çl£
;

338 
	gi
 = 1; i < 
	gsfs
.
	gsysçn_num
; i++)

339 ià(
	gsfs
.
	gv®id_sy¡em
[
i
]) {

340 
	gvFªS³ed
.
push_back
(
sfs
.
sy¡em
[
i
]);

341  
	gŒue
;

344  
	gçl£
;

	@../../titanutils/TitanCommon/CommonUtility.h

1 #iâdeà
__TITAN_COMMON_UTILITY_H__


2 
	#__TITAN_COMMON_UTILITY_H__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~<¡ršg
>

6 
	~<veùÜ
>

7 
	~"­r/­r_sock‘.h
"

9 
	eeH¬dw¬eTy³
 {

10 
	mHARDWARE_TYPE_UNKNOWN
 = -1,

11 
	mHARDWARE_TYPE_VM
,

12 
	mHARDWARE_TYPE_R1
,

13 
	mHARDWARE_TYPE_R2
,

14 
	mHARDWARE_TYPE_MAX


17 
	sPRODUCT_INFO


19 
	m¡d
::
¡ršg
 
¡rMachšeKey
;

20 
	m¡d
::
veùÜ
<
¡d
::
¡ršg
> 
vOEM
;

21 
	m¡d
::
¡ršg
 
¡rOEMName
;

22 
	m¡d
::
¡ršg
 
¡rEncodeOEMName
;

23 } 
	tProduùInfo
;

25 
boŞ
 
S’dH‰pE¼Ü
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, 
ušt32_t
 
nCode
, 
št64_t
 
timeout
=-1);

27 
boŞ
 
G‘AuthÜiz©iÚ
(cÚ¡ 
¡d
::
¡ršg
& 
authÜiz©iÚ
, std::¡ršg& 
u£ºame
, std::¡ršg& 
·sswÜd
);

29 
	g¡d
::
¡ršg
 
G’”©eAuthÜiz©iÚ
(cÚ¡ 
¡d
::¡ršg& 
u£ºame
, cÚ¡ std::¡ršg& 
·sswÜd
);

30 
	g¡d
::
¡ršg
 
DecodeCodecName
(cÚ¡ 
¡d
::¡ršg& 
¡rDecode
);

31 
	g¡d
::
¡ršg
 
EncodeCodecName
(cÚ¡ 
¡d
::¡ršg& 
¡rOri
);

32 
	g¡d
::
¡ršg
 
T¿nsãrOEMName
(cÚ¡ 
¡d
::
veùÜ
<¡d::¡ršg>& 
vOEM
);

33 
boŞ
 
G‘ProduùInfo
(
ProduùInfo
& 
´oduùInfo
);

37 
boŞ
 
G‘CPUTem³¿tu»ByProduù
(& 
‹m³¿tu»
);

38 
boŞ
 
G‘Sy¡emTem³¿tu»ByProduù
(& 
‹m³¿tu»
);

39 
boŞ
 
G‘CPUFªS³edByProduù
(
ušt32_t
& 
çnS³ed
);

40 
boŞ
 
G‘Sy¡emFªS³edByProduù
(
ušt32_t
& 
çnS³ed
);

41 
boŞ
 
G‘ExŒaSy¡emFªS³edByProduù
(
¡d
::
veùÜ
<
ušt32_t
>& 
vFªS³ed
);

	@../../titanutils/const/PathConst.cpp

1 
	~"P©hCÚ¡.h
"

3 cÚ¡ *
	gVIDEODATA_PATH
[] =

4 #ià
defšed
(
__PROMISE
)

8 #–ià
defšed
(
__ALPHA
)

10 #–ià
defšed
(
__NVR_STANDALONE
)

13 #–ià
defšed
(
__MINI_II
)

17 #–ià
defšed
(
__TITAN
)

30 cÚ¡ *
	gSMB_VIDEODATA_FOLDER_NAME
[] =

31 #ià
defšed
(
__PROMISE
)

33 #–ià
defšed
(
__ALPHA
)

35 #–ià
defšed
(
__MINI_II
)

37 #–ià
defšed
(
__TITAN
)

43 cÚ¡ 
	gVOLUMES_COUNT
 = (
VIDEODATA_PATH
) / (const *);

45 cÚ¡ *
	gRL_VIDEODATA_PATH
[] =

46 #ifdeà
__MINI_II


49 #–ià
defšed
(
__TITAN
)

62 cÚ¡ 
	gRL_VIDEODATA_PATH_COUNT
 = (
RL_VIDEODATA_PATH
) / (const *);

64 cÚ¡ *
	gRL_VIDEODATA_PARENT_FOLDER
[] =

65 #ifdeà
__TITAN


74 cÚ¡ 
	gRL_VIDEODATA_PARENT_FOLDER_COUNT
 = (
RL_VIDEODATA_PARENT_FOLDER
) / (const *);

77 #ià
defšed
(
__TITAN
)

78 cÚ¡ 
	gSYSTEM_INFO_CANDIDATE_PATH_COUNT
 = 2;

79 cÚ¡ *
	gCPU_TEMP_CANDIDATE_PATH
[] = {

83 cÚ¡ *
	gCPU_FAN_SPEED_CANDIDATE_PATH
[] = {

87 cÚ¡ *
	gSYS_TEMP_CANDIDATE_PATH
[] = {

91 cÚ¡ *
	gFAN_SPEED_CANDIDATE_PATH
[] = {

	@../../titanutils/const/PathConst.h

1 #iâdeà
__UTIL_PATH_CONST_H__


2 
	#__UTIL_PATH_CONST_H__


	)

4 #iâdeà
SYNCMS_TMP_FILE_DIR


5 
	#SYNCMS_TMP_FILE_DIR
 "/tmp/syncms"

	)

8 #iâdeà
UPNP_TMP_FILE_DIR


9 
	#UPNP_TMP_FILE_DIR
 "/tmp/u²p"

	)

12 #ià
defšed
(
__TITAN
)

13 #ià
defšed
(
__lšux__
)

14 
	#CONFIG_ROOT_PATH
 "/NU20/‘c/"

	)

15 #–ià
defšed
(
_WIN32
)

16 
	#CONFIG_ROOT_PATH
 "./"

	)

20 #ià(
defšed
(
__PROMISE
è|| defšed(
__MINI_II
è|| defšed(
__TITAN
))

21 
	#SESS_PATH_PREFIX
 "/tmp/£ss_"

	)

24 #iâdeà
SESS_PATH_PREFIX


25 
	#SESS_PATH_PREFIX
 "/tmp/"

	)

28 #iâdeà
CIF_STATUS_FILE_PATH


29 
	#CIF_STATUS_FILE_PATH
 "/v¬/nuuo/cif.xml"

	)

32 #iâdeà
QCIF_STATUS_FILE_PATH


33 
	#QCIF_STATUS_FILE_PATH
 "/v¬/nuuo/qcif.xml"

	)

36 #iâdeà
RL_MEM_USAGE_FILE_PATH


37 
	#RL_MEM_USAGE_FILE_PATH
 "/v¬/nuuo/¾_mem"

	)

40 cÚ¡ *
VIDEODATA_PATH
[];

41 cÚ¡ *
SMB_VIDEODATA_FOLDER_NAME
[];

42 cÚ¡ 
VOLUMES_COUNT
;

44 cÚ¡ *
RL_VIDEODATA_PATH
[];

45 cÚ¡ 
RL_VIDEODATA_PATH_COUNT
;

47 cÚ¡ *
RL_VIDEODATA_PARENT_FOLDER
[];

48 cÚ¡ 
RL_VIDEODATA_PARENT_FOLDER_COUNT
;

50 #iâdeà
PID_LOC


51 
	#PID_LOC
 "/v¬/run/nvs.pid"

	)

54 #iâdeà
AGENT_PID_LOC


55 
	#AGENT_PID_LOC
 "/v¬/run/Çg’t.pid"

	)

58 #iâdeà
PID_ARCHIVE_LOC


59 
	#PID_ARCHIVE_LOC
 "/v¬/run/¬chive.pid"

	)

62 #iâdeà
PID_DDNS_LOC


63 
	#PID_DDNS_LOC
 "/v¬/run/ddns.pid"

	)

66 #iâdeà
PID_AUTOUPGRADE_LOC


67 
	#PID_AUTOUPGRADE_LOC
 "/v¬/run/autog¿de.pid"

	)

70 #iâdeà
PID_DAYLIGHTSAVINGWATCHER_LOC


71 
	#PID_DAYLIGHTSAVINGWATCHER_LOC
 "/v¬/run/daylight§všgw©ch”.pid"

	)

74 #iâdeà
PID_RECORDING_MANAGER_LOC


75 
	#PID_RECORDING_MANAGER_LOC
 "/v¬/run/»cÜdšg_mªag”.pid"

	)

78 #iâdeà
PID_MANAGER_SERVER_LOC


79 
	#PID_MANAGER_SERVER_LOC
 "/v¬/run/mªagem’t_£rv”.pid"

	)

81 #iâdeà
MANAGE_SERVER_PROG_NAME


82 
	#MANAGE_SERVER_PROG_NAME
 "mªagem’t_£rv”_t™ª"

	)

85 #iâdeà
PID_METADATA_SERVER_LOC


86 
	#PID_METADATA_SERVER_LOC
 "/v¬/run/m‘ad©a_£rv”.pid"

	)

88 #iâdeà
METADATA_SERVER_PROG_NAME


89 
	#METADATA_SERVER_PROG_NAME
 "M‘ad©aS”v”"

	)

92 #iâdeà
PID_DEVICE_MANAGER_LOC


93 
	#PID_DEVICE_MANAGER_LOC
 "/v¬/run/deviû_mªag”.pid"

	)

96 #iâdeà
PID_INSTALL_SERVER_LOC


97 
	#PID_INSTALL_SERVER_LOC
 "/v¬/run/š¡®l£rv”.pid"

	)

100 #iâdeà
DEVICE_MANAGER_PROG_NAME


101 
	#DEVICE_MANAGER_PROG_NAME
 "deviû_mªag”"

	)

104 #iâdeà
INSTALL_SERVER_PROG_NAME


105 
	#INSTALL_SERVER_PROG_NAME
 "In¡®lS”v”"

	)

108 #iâdeà
AGENT_DIR


109 
	#AGENT_DIR
 "/v¬/nuuo"

	)

112 #iâdeà
TIMEER1_ALIVE_LOG


113 
	#TIMEER1_ALIVE_LOG
 "/v¬/nuuo/tim”1.®ive"

	)

116 #iâdeà
TIMEER2_ALIVE_LOG


117 
	#TIMEER2_ALIVE_LOG
 "/v¬/nuuo/tim”2.®ive"

	)

120 #iâdeà
TIMEER3_ALIVE_LOG


121 
	#TIMEER3_ALIVE_LOG
 "/v¬/nuuo/tim”3.®ive"

	)

124 #iâdeà
ARCHIVE_ALIVE_LOG


125 
	#ARCHIVE_ALIVE_LOG
 "/v¬/nuuo/¬chive.®ive"

	)

128 #iâdeà
DDNS_ALIVE_LOG


129 
	#DDNS_ALIVE_LOG
 "/v¬/nuuo/ddns.®ive"

	)

132 #iâdeà
AUTOUPGRADE_ALIVE_LOG


133 
	#AUTOUPGRADE_ALIVE_LOG
 "/v¬/nuuo/autoupg¿de.®ive"

	)

136 #iâdeà
DAYLIGHTSAVING_ALIVE_LOG


137 
	#DAYLIGHTSAVING_ALIVE_LOG
 "/v¬/nuuo/daylight§všg.®ive"

	)

140 #iâdeà
RECORDING_MANAGER_ALIVE_LOG


141 
	#RECORDING_MANAGER_ALIVE_LOG
 "/v¬/nuuo/»cÜdšg_mªag”.®ive"

	)

144 #iâdeà
RECORDING_MANAGER_REC_ALIVE_LOG


145 
	#RECORDING_MANAGER_REC_ALIVE_LOG
 "/v¬/nuuo/»cÜdšg_mªag”_»c.®ive"

	)

148 #iâdeà
RECORDING_MANAGER_PB_ALIVE_LOG


149 
	#RECORDING_MANAGER_PB_ALIVE_LOG
 "/v¬/nuuo/»cÜdšg_mªag”_pb.®ive"

	)

152 #iâdeà
INSTALL_SERVER_ALIVE_LOG


153 
	#INSTALL_SERVER_ALIVE_LOG
 "/v¬/nuuo/š¡®l£rv”.®ive"

	)

156 #iâdeà
RECORDING_SERVER_DEVICE_ALIVE_LOG


157 
	#RECORDING_SERVER_DEVICE_ALIVE_LOG
 "/v¬/nuuo/»cÜdšg_£rv”_deviû.®ive"

	)

160 #iâdeà
RECORDING_SERVER_EDGE_ALIVE_LOG


161 
	#RECORDING_SERVER_EDGE_ALIVE_LOG
 "/v¬/nuuo/»cÜdšg_£rv”_edge.®ive"

	)

165 #iâdeà
NOTIFYBACKUPCONF


166 
	#NOTIFYBACKUPCONF
 "/tmp/nvr_backup_cÚf"

	)

169 #iâdeà
PID_VM_WATCHDOG_LOC


170 
	#PID_VM_WATCHDOG_LOC
 "/v¬/run/vm_w©chdog.pid"

	)

173 #iâdeà
THIRDPARTY_MANAGER_PROG_NAME


174 
	#THIRDPARTY_MANAGER_PROG_NAME
 "thœd·¹y_mªag”"

	)

177 #iâdeà
PID_THIRDPARTY_MANAGER_LOC


178 
	#PID_THIRDPARTY_MANAGER_LOC
 "/v¬/run/thœd·¹y_mªag”.pid"

	)

182 #iâdeà
ACTI_PTZ_FILE_LOCATION


184 #ià
defšed
(
__PROMISE
)

185 
	#ACTI_PTZ_FILE_LOCATION
 "/APP/NVS/NVS/ACTiPTZPrÙocŞ"

	)

186 #–ià
defšed
(
__ALPHA
)

187 
	#ACTI_PTZ_FILE_LOCATION
 "/NVR/ACTiPTZPrÙocŞ"

	)

188 #–ià(
defšed
(
__MINI_II
è|| defšed(
__TITAN
))

189 
	#ACTI_PTZ_FILE_LOCATION
 "/NU20/d¶ib/ACTiPTZPrÙocŞ"

	)

191 
	#ACTI_PTZ_FILE_LOCATION
 "../../¤c/IPCamNAS/ACTi/PTZPrÙocŞ"

	)

196 #iâdeà
POS_DIR_PREFIX


197 #ifdeà
__PROMISE


198 
	#POS_DIR_PREFIX
 "/VOLUME1/"

	)

200 
	#POS_DIR_PREFIX
 "./"

	)

204 #iâdeà
POS_DIR


205 #ià
defšed
(
__PROMISE
)

206 
	#POS_DIR
 "/VOLUME1/POSDATA"

	)

207 #–ià(
defšed
(
__MINI_II
è|| defšed(
__TITAN
))

208 
	#POS_DIR
 "/NUUO/‘c/pos/"

	)

210 
	#POS_DIR
 "./pos/"

	)

214 #iâdeà
EMAP_DIR


215 #ià
defšed
(
__PROMISE
)

216 
	#EMAP_DIR
 "/VOLUME1/EMAPDATA"

	)

217 
	#EMAP_SETTING_INI
 "EM­.ši"

	)

218 #–ià
defšed
(
__MINI_II
)

219 
	#EMAP_DIR
 "/NUUO/‘c/EM­/"

	)

220 
	#EMAP_SETTING_INI
 "EM­.ši"

	)

221 #–ià
defšed
(
__TITAN
)

222 
	#EMAP_DIR
 "/mtd/block4/NUUO/mªagem’t_£rv”/em­"

	)

223 
	#EMAP_SETTING_INI
 "EM­.ši"

	)

225 
	#EMAP_DIR
 "./EM­"

	)

226 
	#EMAP_SETTING_INI
 "EM­.ši"

	)

230 #iâdeà
LICENSE_FOLDER


231 #ifdeà
__PROMISE


232 
	#LICENSE_FOLDER
 "liûn£"

	)

234 
	#LICENSE_FOLDER
 "/‘c/liûn£"

	)

238 #ifdeà
POS_DATABASE_SUPPORT


240 #iâdeà
POSRECORD_MDB_FILENAME


241 
	#POSRECORD_MDB_FILENAME
 "PosRecÜd.db"

	)

244 #iâdeà
POSRECQRY_MDB_FILENAME


245 
	#POSRECQRY_MDB_FILENAME
 
POSRECORD_MDB_FILENAME


	)

251 #iâdeà
SYSLOG_DB_FILENAME


252 
	#SYSLOG_DB_FILENAME
 "Sy¡emLog.db"

	)

255 #iâdeà
EVENTLOG_DB_FILENAME


256 
	#EVENTLOG_DB_FILENAME
 "Ev’tLog.db"

	)

259 #iâdeà
FTP_TEST_FILENAME


260 #ià
defšed
(
__PROMISE
)

261 
	#FTP_TEST_FILENAME
 "/APP/NVS/NVS/web/imgs/n001.jpg"

	)

262 #–ià(
defšed
(
__MINI_II
è|| defšed(
__TITAN
))

263 
	#FTP_TEST_FILENAME
 "/NUUO/web/imgs/n001.jpg"

	)

265 
	#FTP_TEST_FILENAME
 "../../web/Promi£Web/imgs/n001.jpg"

	)

270 #iâdeà
FTP_TEST_UPLOAD_FILENAME


271 #ià(
defšed
(
__DLINK722
è|| defšed(
__DLINK726
))

272 
	#FTP_TEST_UPLOAD_FILENAME
 "FTP_TEST.jpg"

	)

273 #–ià
defšed
(
__FINENAS
)

274 
	#FTP_TEST_UPLOAD_FILENAME
 "FTP_TEST.jpg"

	)

276 
	#FTP_TEST_UPLOAD_FILENAME
 "NUUO.jpg"

	)

280 #iâdeà
FTP_TEST_FOLDER_NAME


281 #ià(
defšed
(
__DLINK722
è|| defšed(
__DLINK726
))

282 
	#FTP_TEST_FOLDER_NAME
 "NVR"

	)

283 #–ià
defšed
(
__FINENAS
)

284 
	#FTP_TEST_FOLDER_NAME
 "NAS"

	)

285 #–ià
defšed
(
__MINI_II
)

286 
	#FTP_TEST_FOLDER_NAME
 "NVRmši2"

	)

287 #–ià
defšed
(
__TITAN
)

288 
	#FTP_TEST_FOLDER_NAME
 "T™ªNVR"

	)

290 
	#FTP_TEST_FOLDER_NAME
 "NVRmši"

	)

294 #iâdeà
DBHELPER_UNIX_SOCK_PATH


295 
	#DBHELPER_UNIX_SOCK_PATH
 "/tmp/dbh–³r-unix-sock"

	)

298 #iâdeà
DDNS_INI_UPDATE_NOTIFY_FILE


299 
	#DDNS_INI_UPDATE_NOTIFY_FILE
 "/tmp/ddns_ši_upd©ed"

	)

302 #iâdeà
NVR_POWERON_FILE_FLAG


303 
	#NVR_POWERON_FILE_FLAG
 "/tmp/nvr_pow”Ú"

	)

306 #iâdeà
DUMP_FOLDER_NAME1


307 
	#DUMP_FOLDER_NAME1
 ".DUMPS"

	)

310 #ifdeà
DUMP_FOLDER_NAME2


311 #undeà
DUMP_FOLDER_NAME2


313 
	#DUMP_FOLDER_NAME2
 
DUMP_FOLDER_NAME1
".bak"

	)

317 
	#NP_DISK_TIMEOUT
 "/tmp/disk_timeout"

	)

318 
	#NP_DISK_TIMEOUT_FLAG
 "/tmp/æag_disk_timeout"

	)

319 
	#NP_DISK_ERROR
 "/tmp/disk_”rÜ"

	)

320 
	#NP_DISK_ERROR_FLAG
 "/tmp/æag_disk_”rÜ"

	)

324 #iâdeà
__DDNS_UPDATE_WORKER_MAIN__


325 
	#__DDNS_UPDATE_WORKER_MAIN__
 
do_ddns_upd©e_wÜk”


	)

330 
	#CONFIG_FILE_DIR
 "/mtd/block4/NUUO/mªagem’t_£rv”"

	)

331 
	#EMAP_FILE_DIR
 "/mtd/block4/NUUO/mªagem’t_£rv”/em­"

	)

332 
	#PANORAMA_FILE_DIR
 "/mtd/block4/NUUO/mªagem’t_£rv”/PªÜama"

	)

334 #iâdeà
HW_LOG_FILE


335 #ià
defšed
(
__MINI_II
)

336 
	#HW_LOG_FILE
 "/mtd/block4/v¬/log/mes§ge"

	)

337 
	#HW_LOG_FILE_OLD
 "/mtd/block4/v¬/log/mes§ge.0"

	)

338 #–ià
defšed
(
__TITAN
)

339 
	#HW_LOG_FILE
 "/mtd/block4/v¬/log/mes§ge"

	)

340 
	#HW_LOG_FILE_OLD
 "/mtd/block4/v¬/log/mes§ge.0"

	)

341 
	#HW_LOG_FILE_OLD_64
 "/mtd/block4/v¬/log/mes§ge.1"

	)

343 
	#HW_LOG_FILE
 "/d©a/log/hawk.log"

	)

347 #iâdeà
USER_FILE_PATH


348 
	#USER_FILE_PATH
 "/‘c/"

	)

351 #iâdeà
USER_ACCESS_FILE_PATH


352 
	#USER_ACCESS_FILE_PATH
 "/NUUO/‘c/acûss"

	)

355 #iâdeà
EXPORT_USER_FILE_LOCK


356 
	#EXPORT_USER_FILE_LOCK
 "/tmp/nuuo_expÜt_u£r.lck"

	)

359 #iâdeà
ASSUS_FILE_MAX_SIZE


360 
	#ASSUS_FILE_MAX_SIZE
 (64*1024)

362 

	)

363 #iâdeà
ASSUS_FILE_MAX_SIZE_WITH_EMAP


364 
	#ASSUS_FILE_MAX_SIZE_WITH_EMAP
 (10*1024*1024)

366 

	)

367 #iâdeà
IMPORT_USER_FILE_LOCK


368 
	#IMPORT_USER_FILE_LOCK
 "/tmp/nuuo_impÜt_u£r.lck"

	)

371 #iâdeà
LOAD_CONFIG_FILE_LOCK


372 
	#LOAD_CONFIG_FILE_LOCK
 "/tmp/nuuo_lßd_cÚfig.lck"

	)

375 #iâdeà
SAVE_CONFIG_FILE_LOCK


376 
	#SAVE_CONFIG_FILE_LOCK
 "/tmp/nuuo_§ve_cÚfig.lck"

	)

379 #iâdeà
COM_NAME_PATH


380 
	#COM_NAME_PATH
 "/‘c/syscÚfig/ÃtwÜk"

	)

383 #iâdeà
WANINF_NAME_PATH


384 
	#WANINF_NAME_PATH
 "/‘c/syscÚfig/ÃtwÜk-deviûs/š‹º‘"

	)

387 #iâdeà
NUSERVICE_CONF_PATH


388 
	#NUSERVICE_CONF_PATH
 "/‘c/nu£rviû.cÚf"

	)

391 #iâdeà
NTP_CONF_PATH


392 
	#NTP_CONF_PATH
 "/NU20/‘c/Áp.cÚf"

	)

395 #iâdeà
SSL_KEY_FILEPATH


396 #ià(
defšed
(
__MINI_II
è|| defšed(
__TITAN
))

397 
	#SSL_KEY_FILEPATH
 "/‘c/s¦/ş›Á.³m"

	)

398 #–ià
defšed
(
__PROMISE
)

399 
	#SSL_KEY_FILEPATH
 "/APP/NVS/NVS/ş›Á.³m"

	)

403 #iâdeà
SSL_CA_LIST


404 #ià(
defšed
(
__MINI_II
è|| defšed(
__TITAN
))

405 
	#SSL_CA_LIST
 "/‘c/s¦/roÙ.³m"

	)

406 #–ià
defšed
(
__PROMISE
)

407 
	#SSL_CA_LIST
 "/APP/NVS/NVS/roÙ.³m"

	)

411 #iâdeà
SSL_PEM_PASSWORD


412 #ià(
defšed
(
__MINI_II
è|| defšed(
__TITAN
))

413 
	#SSL_PEM_PASSWORD
 "·sswÜd"

	)

414 #–ià
defšed
(
__PROMISE
)

415 
	#SSL_PEM_PASSWORD
 "·sswÜd"

	)

420 #iâdeà
__CGI_FUNC_SO_NAME__


421 
	#__CGI_FUNC_SO_NAME__
 "libcgi_funcs.so"

	)

425 #iâdeà
TITAN_CONF_PATH


426 
	#TITAN_CONF_PATH
 "/‘c/t™ª.cÚf"

	)

429 #iâdeà
CHANNEL_INI_PATH


430 
	#CHANNEL_INI_PATH
 "/v¬/nuuo/chªÃl.ši"

	)

433 #iâdeà
DDNS_UPDATE_LOG_FOLDER


434 
	#DDNS_UPDATE_LOG_FOLDER
 "/tmp/ddns_upd©e_log"

	)

437 #iâdeà
RL_PRETTY_TERMINATED_FLAG_FILE_FOLDER


438 #ifdeà
__TITAN


439 
	#RL_PRETTY_TERMINATED_FLAG_FILE_FOLDER
 "/mtd/block4/v¬/run"

	)

440 #–ià
defšed
(
__PCTEST
)

441 
	#RL_PRETTY_TERMINATED_FLAG_FILE_FOLDER
 "/tmp"

	)

443 
	#RL_PRETTY_TERMINATED_FLAG_FILE_FOLDER
 "/tmp"

	)

447 #iâdeà
RL_PRETTY_TERMINATED_FLAG_FILENAME


448 
	#RL_PRETTY_TERMINATED_FLAG_FILENAME
 "¾_run"

	)

451 #iâdeà
RL_PRETTY_TERMINATED_FLAG_FILE


452 
	#RL_PRETTY_TERMINATED_FLAG_FILE
 
RL_PRETTY_TERMINATED_FLAG_FILE_FOLDER
 "/" 
RL_PRETTY_TERMINATED_FLAG_FILENAME


	)

455 #iâdeà
DB_FIX_PROGRESSION_FILE


456 
	#DB_FIX_PROGRESSION_FILE
 "/v¬/run/¾_dbfix"

	)

459 #iâdeà
AUTOBACKUP_UNFINISH_LOGFILE


460 #ifdeà
__PROMISE


461 
	#AUTOBACKUP_UNFINISH_LOGFILE
 "/VOLUME1/PUBLIC/backup_unfšished.log"

	)

462 #–ià(
defšed
(
__MINI_II
è|| defšed(
__TITAN
))

463 
	#AUTOBACKUP_UNFINISH_LOGFILE
 "/mtd/block4/v¬/log/backup_unfšished.log"

	)

465 
	#AUTOBACKUP_UNFINISH_LOGFILE
 "backup_unfšished.log"

	)

470 #iâdeà
LOG_LOGIN_FOLDER


471 
	#LOG_LOGIN_FOLDER
 "/tmp/log_logš"

	)

474 #iâdeà
LOG_LOGOUT_FOLDER


475 
	#LOG_LOGOUT_FOLDER
 "/tmp/log_logout"

	)

478 #iâdeà
HOSTS_PATH


479 
	#HOSTS_PATH
 "/‘c/ho¡s"

	)

482 #iâdeà
WIN32


483 #ifdeà
MAX_PATH


484 #undeà
MAX_PATH


486 
	#MAX_PATH
 1024

	)

489 #iâdeà
USER_MODIFIED_FOLDER


490 
	#USER_MODIFIED_FOLDER
 "/tmp/u£r_modif›d"

	)

493 #iâdeà
USER_DELETED_FOLDER


494 
	#USER_DELETED_FOLDER
 "/tmp/u£r_d–‘ed"

	)

497 #iâdeà
USER_PWCHANGED_FOLDER


498 
	#USER_PWCHANGED_FOLDER
 "/tmp/u£r_pwchªged"

	)

501 #iâdeà
USER_CREATED_FOLDER


502 
	#USER_CREATED_FOLDER
 "/tmp/u£r_ü—‹d"

	)

505 #ifdeà
__TITAN


506 
	#IPCAM_LICENSE_COUNT_BASE
 4

	)

508 
	#IPCAM_LICENSE_COUNT_BASE
 2

	)

511 #iâdeà
AUTO_UPGRADE_PROG_NAME


512 
	#AUTO_UPGRADE_PROG_NAME
 "auto_upg¿de"

	)

516 #iâdeà
DAYLIGHTSAVINGWATCHER_PROG_NAME


517 
	#DAYLIGHTSAVINGWATCHER_PROG_NAME
 "DaylightSavšgW©ch”"

	)

520 #iâdeà
DDNS_UPDATE_PROG_NAME


521 
	#DDNS_UPDATE_PROG_NAME
 "ddns_upd©e"

	)

524 #iâdeà
RECORDING_MAANGER_PROG_NAME


525 
	#RECORDING_MAANGER_PROG_NAME
 "»cÜdšg_mªag”_t™ª"

	)

528 #iâdeà
IPCAM_PACK_ACCELERATOR_MANUF


529 
	#IPCAM_PACK_ACCELERATOR_MANUF
 "/tmp/·ck_acc_mªuf"

	)

532 #iâdeà
IPCAM_PACK_ACCELERATOR_BRAND


533 
	#IPCAM_PACK_ACCELERATOR_BRAND
 "/tmp/·ck_acc_b¿nd"

	)

536 #iâdeà
OVERHEAT_FILE_FLAG


537 
	#OVERHEAT_FILE_FLAG
 "/tmp/ıu‹mpshutdown"

	)

540 #iâdeà
NVR_PRODUCT_NAME


541 #ià(
defšed
(
__DLINK722
è|| defšed(
__DLINK726
))

542 
	#NVR_PRODUCT_NAME
 "NVR"

	)

543 #–ià
defšed
(
__FINENAS
)

544 
	#NVR_PRODUCT_NAME
 "NAS"

	)

545 #–ià
defšed
(
__MINI_II
)

546 
	#NVR_PRODUCT_NAME
 "NVRmši2"

	)

547 #–ià
defšed
(
__TITAN
)

548 
	#NVR_PRODUCT_NAME
 "NVR"

549 #–£

	)

550 
	#NVR_PRODUCT_NAME
 "NVRmši"

	)

554 #iâdeà
NOTIFY_LOCAL_DISPLAY_FLAG_PATH


555 
	#NOTIFY_LOCAL_DISPLAY_FLAG_PATH
 "/tmp/æag_loÿl_di¥Ïy"

	)

558 #ifdeà
__TITAN


560 #ifdeà
__TITAN_R2


561 
	#CPU_TEMP_PATH
 "/sys/deviûs/¶©fÜm/w83627ehf.656/‹mp5_šput"

	)

562 
	#CPU_FAN_SPEED_PATH
 "/sys/deviûs/¶©fÜm/w83627ehf.656/çn2_šput"

	)

563 
	#SYS_TEMP_PATH
 "/sys/deviûs/¶©fÜm/w83627ehf.656/‹mp1_šput"

	)

564 
	#FAN_SPEED_PATH
 "/sys/deviûs/¶©fÜm/w83627ehf.656/çn1_šput"

	)

565 
	#FAN_SPEED_PATH_2
 "/sys/deviûs/¶©fÜm/w83627ehf.656/çn4_šput"

	)

566 
	#FAN_SPEED_PATH_3
 "/sys/deviûs/¶©fÜm/w83627ehf.656/çn5_šput"

	)

567 
	#CPU_TEMP_PATH_1
 "/sys/devices/platform/w83627ehf.656/temp5_input"

568 #–£

	)

569 
	#CPU_TEMP_PATH
 "/sys/deviûs/¶©fÜm/™87.2576/‹mp2_šput"

	)

570 
	#CPU_FAN_SPEED_PATH
 "/sys/deviûs/¶©fÜm/™87.2576/çn1_šput"

	)

571 
	#SYS_TEMP_PATH
 "/sys/deviûs/¶©fÜm/™87.2576/‹mp1_šput"

	)

572 
	#FAN_SPEED_PATH
 "/sys/deviûs/¶©fÜm/™87.2576/çn2_šput"

	)

573 
	#CPU_TEMP_PATH_1
 "/sys/devices/platform/coretemp.0/temp3_input"

575 

	)

578 cÚ¡ 
SYSTEM_INFO_CANDIDATE_PATH_COUNT
;

579 cÚ¡ *
CPU_TEMP_CANDIDATE_PATH
[];

580 cÚ¡ *
CPU_FAN_SPEED_CANDIDATE_PATH
[];

581 cÚ¡ *
SYS_TEMP_CANDIDATE_PATH
[];

582 cÚ¡ *
FAN_SPEED_CANDIDATE_PATH
[];

586 
	#CPU_TEMP_PATH
 "/sys/bus/i2c/deviûs/0-004c/‹mp1_šput"

	)

587 
	#FAN_SPEED_PATH
 "/sys/bus/i2c/deviûs/0-004c/çn1_šput"

	)

590 #ifdeà
__TITAN


591 
	#NET_STATUS_PATH
 "/´oc/Ãt/dev"

	)

594 
	#PLATFORM_R2_581_PATH
 "/v¬/nuuo/.R2_581"

	)

595 
	#PLATFORM_R2_Q87A_PATH
 "/v¬/nuuo/.R2_Q87A"

	)

596 
	#PLATFORM_R1_PATH
 "/v¬/nuuo/.R1"

	)

597 
	#PLATFORM_R1_BT6_PATH
 "/v¬/nuuo/.R1_BT6"

	)

598 
	#PLATFORM_R1_MZJ19AI_PATH
 "/v¬/nuuo/.R1_MZJ19AI"

	)

599 
	#PLATFORM_VM_PATH
 "/v¬/nuuo/.vm_šfo"

	)

600 
	#PLATFORM_16BAY_G1SA_PATH
 "/v¬/nuuo/.16BAY_G1SA"

	)

604 #iâdeà
ENABLE_PTZ_TIME_LOG_PATH


605 
	#ENABLE_PTZ_TIME_LOG_PATH
 "/mÁ/VOLUME1/PTZLOG/’abË_±z_log"

	)

607 #iâdeà
TEMP_PTZ_TIME_LOG_PATH


608 
	#TEMP_PTZ_TIME_LOG_PATH
 "/mÁ/VOLUME1/PTZLOG/"

	)

610 #iâdeà
PTZ_TIME_LOG_FOLDER


611 
	#PTZ_TIME_LOG_FOLDER
 "/mÁ/VOLUME1/PTZLOG/log/"

	)

614 #iâdeà
VOLUME_FOLDER


615 
	#VOLUME_FOLDER
 "VOLUME"

	)

	@../../titanutils/const/ServerProtocolDefinition.h

1 #iâdeà
__SERVER_PROTOCOL_DEFINITHION_H__


2 
	#__SERVER_PROTOCOL_DEFINITHION_H__


	)

4 
	sS”v”PrÙocŞ


11 
	mERROR_NONE
 = 0x00000000,

12 
	mERROR_AUTHORIZATION
,

13 
	mERROR_PRIVILEGE
,

14 
	mERROR_PERMISSION
,

15 
	mERROR_VERSION_MIN
,

16 
	mERROR_VERSION_MAX
,

17 
	mERROR_SERVERID
,

18 
	mERROR_USERID
,

19 
	mERROR_GROUPID
,

20 
	mERROR_ROLEID
,

21 
	mERROR_SCHEDULEID
,

22 
	mERROR_EVENTID
,

23 
	mERROR_ACTIONID
,

24 
	mERROR_PRESETID
,

25 
	mERROR_SESSIONID
,

26 
	mERROR_REQUESTID
,

27 
	mERROR_SEARCHID
,

28 
	mERROR_TESTID
,

29 
	mERROR_PARAMETER
,

30 
	mERROR_TESTING
,

31 
	mERROR_DETECT_TIMEOUT
,

32 
	mERROR_NODATA
,

33 
	mERROR_CONNECTION
,

34 
	mERROR_OEM_NOT_MATCH
,

35 
	mERROR_UNKNOWN
 = 0xFFFFFFFF,

36 } 
	tE¼ÜCode
;

41 cÚ¡ 
	mEVENT_SESSION_IDLE_INTERVAL
 = 10000;

42 cÚ¡ 
	mEVENT_SESSION_INTERNAL_TIMEOUT
 = 30000;

43 cÚ¡ 
	mEVENT_SESSION_TIMEOUT
 = 60000;

44 cÚ¡ 
	mDATA_SESSION_IDLE_INTERVAL
 = 10000;

45 cÚ¡ 
	mDATA_SESSION_INTERNAL_TIMEOUT
 = 30000;

46 cÚ¡ 
	mDATA_SESSION_TIMEOUT
 = 60000;

47 cÚ¡ 
	mSESSION_ESTABLISH_TIMEOUT
 = 60000;

48 cÚ¡ 
	mSESSION_TEARDOWN_TIMEOUT
 = 60000;

49 cÚ¡ 
	mSERVER_READY_TIMEOUT
 = 60000;

55 
	tPrivegeTy³
;

72 
	mACTION_CLOSE_TYPE_AFTER
 = 1,

73 
	mACTION_CLOSE_TYPE_AUTO
,

74 } 
	tAùiÚClo£Ty³
;

81 
	mSCB_C31_SCB_C24
 = 1,

82 
	mSCB_C31_SCB_C26
 = 2,

83 
	mSCB_C31_SCB_C28
 = 3,

84 
	mSCB_A08
 = 4,

85 } 
	tIOBoxTy³
;

93 
	mVOLUME_GOOD_FUNCTIONAL
 = 0x00000000,

96 
	mVOLUME_ERROR_SOFTWARE_RM
 = 0x00000001,

99 
	mVOLUME_ERROR_HARDWARE_CRITICAL
 = 0x00010000,

100 
	mVOLUME_ERROR_HARDWARE_OFFLINE
 = 0x00020000,

101 
	mVOLUME_ERROR_HARDWARE_FILE_SYSTEM
 = 0x00040000,

104 
	mVOLUME_ERROR_UNKNOWN
 = 0xFFFFFFFF,

105 } 
	tVŞumeE¼Ü
;

113 
	mFTP_TEST_STATUS_SUCCESS
 = 0x00000000,

116 
	mFTP_TEST_STATUS_NOT_START
 = 0x00000001,

117 
	mFTP_TEST_STATUS_PROCESSING
 = 0x00000002,

120 
	mFTP_TEST_STATUS_FAIL_CONNECT
 = 0x80000001,

121 
	mFTP_TEST_STATUS_FAIL_ACCOUNT
 = 0x80000002,

122 
	mFTP_TEST_STATUS_FAIL_TIMEOUT
 = 0x80000003,

123 
	mFTP_TEST_STATUS_FAIL_ACCESS
 = 0x80000004,

124 
	mFTP_TEST_STATUS_FAIL_PARAM
 = 0x80000005,

125 
	mFTP_TEST_STATUS_FAIL_UNKNOWN
 = 0xFFFFFFFF,

126 } 
	tFTPTe¡Stus
;

133 
	mCHANGE_TYPE_ADD
 = 0x00000000,

134 
	mCHANGE_TYPE_MODIFY
 = 0x00000001,

135 
	mCHANGE_TYPE_REMOVE
 = 0x00000002,

136 
	mCHANGE_TYPE_UNKNOWN
 = 0xFFFFFFFF,

137 } 
	tChªgeTy³
;

144 
	mSCHEDULE_ATTRIBUTE_DO_NOTIFY
 = 101,

145 
	mSCHEDULE_ATTRIBUTE_DO_NOT_NOTIFY
 = 102,

146 
	mSCHEDULE_ATTRIBUTE_ALLOWED
 = 201,

147 
	mSCHEDULE_ATTRIBUTE_BLOCKED
 = 202,

148 
	mSCHEDULE_ATTRIBUTE_DO_RECEIVE
 = 301,

149 
	mSCHEDULE_ATTRIBUTE_DO_NOT_RECEIVE
 = 302,

150 } 
	tScheduËA‰ribu‹
;

157 
	mVIDEO_DEVICE_TYPE_IPCAM
 = 0,

158 
	mVIDEO_DEVICE_TYPE_VIDEO_SERVER
 = 1

159 } 
	tVideoDeviûTy³
;

166 
	mREQUEST_STATUS_HANDLING
 = 0x00000001,

167 
	mREQUEST_STATUS_COMPLETED
 = 0x00000002,

168 
	mREQUEST_STATUS_UNKNOWN
 = 0xFFFFFFFF,

169 } 
	tReque¡Stus
;

171 
	m´iv©e
:

172 
S”v”PrÙocŞ
();

173 ~
S”v”PrÙocŞ
();

	@../../titanutils/const/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../../titanutils/debugMsg/Debug.h

1 #iâdeà
_DEBUG_H_


2 
	#_DEBUG_H_


	)

4 #iâdeà
USE_NEW_DEBUG


5 
	~"Debug_Şd.h
"

7 
	~"Debug_Ãw.h
"

	@../../titanutils/debugMsg/Debug_old.h

1 #iâdeà
_DEBUG_OLD_H_


2 
	#_DEBUG_OLD_H_


	)

4 
	~<as£¹.h
>

5 
	~<¡dio.h
>

6 
	~<¡d¬g.h
>

7 
	~<time.h
>

8 
	~<sys/ty³s.h
>

9 
	~<sys/timeb.h
>

10 #iâdeà
_WIN32


11 
	~<uni¡d.h
>

13 #ià
defšed
(
_WIN32
)

14 
	~"wšdows.h
"

17 #ifdeà
_DEBUG


18 #iâdeà
__RELEASE


20 
šlše
 
	$_DPRINTF
 (cÚ¡ * 
fmt
, ...)

22 
bufãr
[512];

24 
va_li¡
 
v®i¡
;

25 
	`va_¡¬t
(
v®i¡
, 
fmt
);

28 
	`v¥rštf
(
bufãr
, 
fmt
, 
v®i¡
);

31 
timeb
 

;

32 
	`áime
(&

);

33 #ià
	`defšed
(
__CYGWIN__
è|| defšed(
__lšux__
)

34 
tm
 
¡m
;

35 
	`loÿÉime_r
(&

.
time
, &
¡m
);

36 
	`årštf
(
¡d”r
, "[%02d:%02d:%02d] %s", 
¡m
.
tm_hour
, stm.
tm_mš
, stm.
tm_£c
, 
bufãr
);

37 #–ià
	`defšed
(
_WIN32
)

38 
tm
* 
±m
 = 
	`loÿÉime
(&

.
time
);

39 
	`årštf
(
¡d”r
, "[%02d:%02d:%02d] %s", 
±m
->
tm_hour
,…tm->
tm_mš
,…tm->
tm_£c
, 
bufãr
);

41 
	`va_’d
 (
v®i¡
);

42 
	}
}

44 #iâdeà
ASSERT


46 
	#ASSERT
(
f
è{ if(!(f)è{ 
	`årštf
(
¡d”r
, "## ASSERT fa: fe=% lše=%d % %s\n", 
__FILE__
, 
__LINE__
, 
__DATE__
, 
__TIME__
); } }

	)

49 #iâdeà
ASSERT2


50 
	#ASSERT2
(
f
, 
fmt
, ...è{ ià(!(f)è{ 
	`årštf
(
¡d”r
, "## ASSERT fa: fe=% lše=%d % % "fmt, 
__FILE__
, 
__LINE__
, 
__DATE__
, 
__TIME__
, ##
__VA_ARGS__
); } }

	)

53 #iâdeà
VERIFY


55 
	#VERIFY
(
f
è{ if(!(f)è{ 
	`årštf
(
¡d”r
, "## VERIFY fa: fe=% lše=%d % %s\n", 
__FILE__
, 
__LINE__
, 
__DATE__
, 
__TIME__
); } }

	)

58 #iâdeà
TRACE


60 #ià
defšed
(
__CYGWIN__
è|| defšed(
__lšux__
)

61 
	#TRACE
(
fÜm©
, ...èdØ{ 
timeb
 

; 
tm
 
¡m
; 
	`áime
(&); 
	`loÿÉime_r
(&.
time
, &¡m); 
	`årštf
(
¡d”r
, "[%02d:%02d:%02d] "fÜm©, stm.
tm_hour
, stm.
tm_mš
, stm.
tm_£c
, ##
__VA_ARGS__
); } 0)

	)

62 #–ià
defšed
(
_WIN32
)

63 
	#TRACE
(
fÜm©
, ...èdØ{ 
timeb
 

; 
	`áime
(&); 
tm
* 
±m
 = 
	`loÿÉime
(&.
time
); 
	`årštf
(
¡d”r
, "[%02d:%02d:%02d] "fÜm©,…tm->
tm_hour
,…tm->
tm_mš
,…tm->
tm_£c
, ##
__VA_ARGS__
); } 0)

	)

67 #iâdeà
TRACECONNPROB


68 
	#TRACECONNPROB
(
fÜm©
, ...èdØ{ 
timeb
 

; 
tm
 
¡m
; 
	`áime
(&); 
	`loÿÉime_r
(&.
time
, &¡m); 
	`årštf
(
¡d”r
, "[%02d:%02d:%02d] "fÜm©, stm.
tm_hour
, stm.
tm_mš
, stm.
tm_£c
, ##
__VA_ARGS__
); } 0)

	)

73 #iâdeà
ASSERT_LOG_PATH


75 #ià
defšed
(
__PROMISE
)

76 
	#ASSERT_LOG_PATH
 "/VOLUME1/PUBLIC/"

	)

77 #–ià
defšed
(
__ALPHA
)

78 
	#ASSERT_LOG_PATH
 "/mÁ/HD_a2/"

	)

79 #–ià
defšed
(
__MINI_II
)

80 
	#ASSERT_LOG_PATH
 "/mÁ/VOLUME1/VIDEODATA/"

	)

81 #–ià
defšed
(
__TITAN
)

82 
	#ASSERT_LOG_PATH
 "/mÁ/VOLUME1/LOG/"

	)

84 
	#ASSERT_LOG_PATH
 "/tmp/"

	)

89 #ifdeà
TRACECONNPROB


90 #undeà
TRACECONNPROB


93 
	#TRACECONNPROB
(...)

	)

95 #ifdeà
ASSERT


96 #undeà
ASSERT


98 
	#ASSERT
(
f
è{ if(!(f)è{ 
timeb
 

; 
tm
 
¡m
; 
	`áime
(&); 
	`loÿÉime_r
(&.
time
, &¡m); 
âame
[512]; 
	`¢´štf
(âame, (âame), 
ASSERT_LOG_PATH
"as£¹.log.%04d%02d%02d", stm.
tm_y—r
+1900, stm.
tm_mÚ
+1, stm.
tm_mday
); 
FILE
 *
å
 = 
	`fİ’
(âame, "a"); ià(å!=
NULL
è{
	`årštf
(å, "[%04d-%02d-%02d %02d:%02d:%02d] ASSERT fa: fe=% lše=%d\n", stm.tm_y—r+1900, stm.tm_mÚ+1, stm.tm_mday, stm.
tm_hour
, stm.
tm_mš
, stm.
tm_£c
, 
__FILE__
, 
__LINE__
); 
	`fşo£
(å); } } }

	)

100 #ifdeà
ASSERT2


101 #undeà
ASSERT2


103 
	#ASSERT2
(
f
, 
fmt
, ...è{ if(!(f)è{ 
timeb
 

; 
tm
 
¡m
; 
	`áime
(&); 
	`loÿÉime_r
(&.
time
, &¡m); 
âame
[512]; 
	`¢´štf
(âame, (âame), 
ASSERT_LOG_PATH
"as£¹.log.%04d%02d%02d", stm.
tm_y—r
+1900, stm.
tm_mÚ
+1, stm.
tm_mday
); 
FILE
 *
å
 = 
	`fİ’
(âame, "a"); ià(å!=
NULL
è{
	`årštf
(å, "[%04d-%02d-%02d %02d:%02d:%02d] ASSERT fa: fe=% lše=%d "fmt, stm.tm_y—r+1900, stm.tm_mÚ+1, stm.tm_mday, stm.
tm_hour
, stm.
tm_mš
, stm.
tm_£c
, 
__FILE__
, 
__LINE__
, ##
__VA_ARGS__
); 
	`fşo£
(å); } } }

	)

105 #ifdeà
VERIFY


106 #undeà
VERIFY


108 
	#VERIFY
(
f
è(()(f))

	)

110 #ifdeà
TRACE


111 #undeà
TRACE


113 
	#TRACE
(...)

	)

119 
šlše
 
	$_DPRINTF
(cÚ¡ * 
fmt
, ...è{
	}
}

121 #iâdeà
ASSERT


122 
	#ASSERT
(
f
è(()0)

	)

125 #iâdeà
ASSERT2


126 
	#ASSERT2
(
f
, 
fmt
, ...è
	`ASSERT
(f)

	)

129 #iâdeà
VERIFY


130 
	#VERIFY
(
f
è(()(f))

	)

133 #iâdeà
TRACE


134 
	#TRACE
 1 ? ()0 : ::
_DPRINTF


	)

139 #iâdeà
__RELEASE


141 
	#NLOG
(
fÜm©
, ...èdØ{ 
timeb
 

; 
tm
 
¡m
; 
	`áime
(&); 
	`loÿÉime_r
(&.
time
, &¡m); 
	`årštf
(
¡d”r
, "[%04d-%02d-%02d %02d:%02d:%02d] NLOGNLOG(%s:%d %s): "fÜm©, stm.
tm_y—r
+1900, stm.
tm_mÚ
+1, stm.
tm_mday
, stm.
tm_hour
, stm.
tm_mš
, stm.
tm_£c
, 
__FILE__
, 
__LINE__
, 
__func__
, ##
__VA_ARGS__
); } 0)

	)

145 #ifdeà
__PROMISE


146 
	#NLOGFILEPATH
 "/VOLUME1/PUBLIC/.Æog/"

	)

147 #–ià(
defšed
(
__MINI_II
è|| defšed(
__TITAN
))

148 
	#NLOGFILEPATH
 "/mÁ/VOLUME1/VIDEODATA/.Æog/"

	)

150 
	#NLOGFILEPATH
 "/tmp/.Æog/"

	)

153 
	#NLOG
(
fÜm©
, ...èdØ{ 
timeb
 

; 
tm
 
¡m
; 
	`áime
(&); 
	`loÿÉime_r
(&.
time
, &¡m); 
âame
[512]; 
	`¢´štf
(âame, (âame), 
NLOGFILEPATH
"%04d%02d%02d.Æog.log", stm.
tm_y—r
+1900, stm.
tm_mÚ
+1, stm.
tm_mday
); 
FILE
 *
å
 = 
	`fİ’
(âame, "a"); ià(å!=
NULL
è{ 
	`årštf
(å, "[%04d-%02d-%02d %02d:%02d:%02d] NLOG(%s:%d %s): "fÜm©, stm.tm_y—r+1900, stm.tm_mÚ+1, stm.tm_mday, stm.
tm_hour
, stm.
tm_mš
, stm.
tm_£c
, 
__FILE__
, 
__LINE__
, 
__func__
, ##
__VA_ARGS__
); 
	`fşo£
(å); } } 0)

	)

	@../../titanutils/log/DataBaseManager.cpp

1 
	~"D©aBa£Mªag”.h
"

3 
	~"commÚ/fe.h
"

4 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

6 cÚ¡ 
	gs_tim”_š‹rv®
 = 2000;

7 cÚ¡ 
	gs_time_out
 = 30000;

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
DLL_PUBLIC
 
	gD©aBa£I‹m
::
	$D©aBa£I‹m
(
¡d
::
¡ršg
 &
f’ame
)

12 : 
	`m_f’ame
(
f’ame
)

13 , 
	`m_d©aba£
()

14 , 
	`m_cs
()

15 , 
	`m_acûss_time
(
	$G‘TimeCouÁMS
())

17 
	}
}

19 
DLL_PUBLIC
 
	gD©aBa£I‹m
::~
	$D©aBa£I‹m
()

21 
	}
}

23 
DLL_PUBLIC
 
¡d
::
¡ršg
 
D©aBa£I‹m
::
	$G‘FeName
()

25  
m_f’ame
;

26 
	}
}

28 
DLL_PUBLIC
 
	gSQL™eObjeù
 &
	gD©aBa£I‹m
::
	$G‘D©aBa£
()

30  
m_d©aba£
;

31 
	}
}

33 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
 &
	gD©aBa£I‹m
::
	$G‘Cr™iÿlSeùiÚ
()

35  
m_cs
;

36 
	}
}

38 
DLL_PUBLIC
 
	gD©aBa£Mªag”
::
	$D©aBa£Mªag”
()

39 : 
	`m_cs
()

40 , 
	`m_ÿche
()

41 , 
	`m_g¬bage
()

42 , 
	$m_tim”
()

44 
	}
}

46 
DLL_PUBLIC
 
	gD©aBa£Mªag”
::~
	$D©aBa£Mªag”
()

48 
	`Stİ
();

49 
	}
}

51 
Cr™iÿlSeùiÚ
 
	gs_cs
;

52 
DLL_PUBLIC
 
	gD©aBa£Mªag”
 &D©aBa£Mªag”::
	$G‘Mªag”
()

54 
Cr™iÿlSeùiÚLock
 
	`_l
(&
s_cs
);

55 
D©aBa£Mªag”
 
mªag”
;

56  
mªag”
;

57 
	}
}

59 
DLL_PUBLIC
 
boŞ
 
	gD©aBa£Mªag”
::
	$S¹
()

61  
m_tim”
.
	`S¹
(
D©aBa£Mªag”
::
s_Tim”C®lback
, 
this
, 
NULL
, 
s_tim”_š‹rv®
, 0);

62 
	}
}

64 
DLL_PUBLIC
 
boŞ
 
	gD©aBa£Mªag”
::
	$Stİ
()

66  
m_tim”
.
	`Stİ
();

67 
	}
}

69 
DLL_PUBLIC
 
	gsm¬t_±r
<
	gD©aBa£I‹m
> 
	gD©aBa£Mªag”
::
	$G‘D©aBa£
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
)

71 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

73 
¡d
::
¡ršg
 
f’ame_»sŞved
 = 
	`ResŞveP©h
(
f’ame
);

75 
¡d
::
m­
< std::
¡ršg
, 
sm¬t_±r
<
D©aBa£I‹m
> >::
™”©Ü
 
™
;

78 
™
 = 
m_ÿche
.
	`fšd
(
f’ame_»sŞved
);

79 ià(
™
 !ğ
m_ÿche
.
	`’d
())

81 
™
->
£cÚd
.
	`g‘
()->
m_acûss_time
 = 
	`G‘TimeCouÁMS
();

82  
™
->
£cÚd
;

86 
™
 = 
m_g¬bage
.
	`fšd
(
f’ame_»sŞved
);

87 ià(
™
 !ğ
m_g¬bage
.
	`’d
())

89 
™
->
£cÚd
.
	`g‘
()->
m_acûss_time
 = 
	`G‘TimeCouÁMS
();

90 
m_ÿche
[
™
->
fœ¡
] = it->
£cÚd
;

91 
sm¬t_±r
<
D©aBa£I‹m
> 
p
 = 
™
->
£cÚd
;

92 
m_g¬bage
.
	`”a£
(
™
);

93  
p
;

97 
D©aBa£I‹m
 *
™em
 = 
Ãw
 
	`D©aBa£I‹m
(
f’ame_»sŞved
);

98 ià(
™em
 !ğ
NULL
)

100 ià(
™em
->
m_d©aba£
.
	`O³n
(
f’ame_»sŞved
è!ğ
SQLITE_OK
)

102 
d–‘e
 
™em
;

106 
sm¬t_±r
<
D©aBa£I‹m
> 
p
 = 
™em
;

107 
p
.
	`g‘
()->
m_acûss_time
 = 
	`G‘TimeCouÁMS
();

108 
m_ÿche
[
f’ame_»sŞved
] = 
p
;

109  
p
;

114  
NULL
;

115 
	}
}

117 
	gD©aBa£Mªag”
::
	$s_Tim”C®lback
(*
cÚ‹xt
, *
·¿m
)

119 
D©aBa£Mªag”
 *
pThis
 = 
¡©ic_ÿ¡
<D©aBa£Mªag” *>(
cÚ‹xt
);

120 ià(
pThis
 !ğ
NULL
)

122 
pThis
->
	`Tim”C®lback
();

124 
	}
}

126 
	gD©aBa£Mªag”
::
	$Tim”C®lback
()

128 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

130 
¡d
::
m­
< std::
¡ršg
, 
sm¬t_±r
<
D©aBa£I‹m
> >::
™”©Ü
 
™
;

133 
™
 = 
m_ÿche
.
	`begš
();

134 
™
 !ğ
m_ÿche
.
	`’d
())

136 ià(
™
->
£cÚd
.
	`g‘
(è=ğ
NULL
)

138 
m_ÿche
.
	`”a£
(
™
++);

140 ià(
™
->
£cÚd
.
	`u£_couÁ
() <= 1)

142 
™
->
£cÚd
.
	`g‘
()->
m_acûss_time
 = 
	`G‘TimeCouÁMS
();

143 
m_g¬bage
[
™
->
fœ¡
] = it->
£cÚd
;

144 
m_ÿche
.
	`”a£
(
™
++);

148 
™
++;

153 
™
 = 
m_g¬bage
.
	`begš
();

154 
™
 !ğ
m_g¬bage
.
	`’d
())

156 ià(
™
->
£cÚd
.
	`g‘
(è=ğ
NULL
)

158 
m_g¬bage
.
	`”a£
(
™
++);

160 ià(
™
->
£cÚd
.
	`g‘
()->
m_acûss_time
 + 
s_time_out
 <ğ
	`G‘TimeCouÁMS
())

162 
m_g¬bage
.
	`”a£
(
™
++);

166 
™
++;

169 
	}
}

	@../../titanutils/log/DataBaseManager.h

1 #iâdeà
__DATABASE_MANAGER_H__


2 
	#__DATABASE_MANAGER_H__


	)

4 
	~"expÜts.h
"

6 
	~<m­
>

7 
	~<¡ršg
>

9 
	~"commÚ/sy¡em.h
"

10 
	~"commÚ/sm¬t_poš‹r.h
"

11 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

13 
	~"th»ad_objeù/sšgË_tim”.h
"

15 
	~"sql™e/sql™e_objeù.h
"

17 
şass
 
	gD©aBa£Mªag”
;

19 şas 
	cDLL_PUBLIC
 
	mD©aBa£I‹m


21 
ä›nd
 
şass
 
	mD©aBa£Mªag”
;

22 
	mpublic
:

23 
D©aBa£I‹m
(
¡d
::
¡ršg
 &
f’ame
);

24 ~
D©aBa£I‹m
();

26 
	m¡d
::
¡ršg
 
G‘FeName
();

27 
	mSYSUTILS_SPACE
::
SQL™eObjeù
 &
G‘D©aBa£
();

28 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 &
G‘Cr™iÿlSeùiÚ
();

30 
	m´iv©e
:

31 
D©aBa£I‹m
();

32 
D©aBa£I‹m
(cÚ¡ D©aBa£I‹m &
rhs
);

33 
	mD©aBa£I‹m
 &
	mİ”©Ü
=(cÚ¡ 
D©aBa£I‹m
 &
rhs
);

35 
	m´iv©e
:

36 
¡d
::
¡ršg
 
m_f’ame
;

37 
	mSYSUTILS_SPACE
::
SQL™eObjeù
 
m_d©aba£
;

38 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

39 
št64_t
 
	mm_acûss_time
;

42 şas 
	cDLL_PUBLIC
 
	mD©aBa£Mªag”


44 
	mpublic
:

45 ~
D©aBa£Mªag”
();

47 
	mD©aBa£Mªag”
 &
G‘Mªag”
();

49 
boŞ
 
S¹
();

50 
boŞ
 
Stİ
();

52 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
D©aBa£I‹m
> 
G‘D©aBa£
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
);

54 
	m´iv©e
:

55 
s_Tim”C®lback
(*
cÚ‹xt
, *
·¿m
);

56 
Tim”C®lback
();

58 
	m´iv©e
:

59 
D©aBa£Mªag”
();

60 
D©aBa£Mªag”
(cÚ¡ D©aBa£Mªag” &
rhs
);

61 
	mD©aBa£Mªag”
 &
	mİ”©Ü
=(cÚ¡ 
D©aBa£Mªag”
 &
rhs
);

63 
	m´iv©e
:

64 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

65 
	m¡d
::
m­
< 
¡d
::
¡ršg
, 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
D©aBa£I‹m
> > 
m_ÿche
;

66 
	m¡d
::
m­
< 
¡d
::
¡ršg
, 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
D©aBa£I‹m
> > 
m_g¬bage
;

67 
	mSYSUTILS_SPACE
::
SšgËTim”
 
m_tim”
;

	@../../titanutils/log/EventLog.cpp

1 
	~"Ev’tLog.h
"

3 
	~"commÚ/¡ršg.h
"

4 
	~"commÚ/h¬dw¬e.h
"

5 
	~"sql™e/sql™e_ut™y.h
"

7 
	~"´og¿mmšg_h–p_fe/NUUOCÜpÜ©eDefš™iÚ.h
"

8 
	~"debugMsg/Debug.h
"

10 
	#MAX_INSERT_EVENT_LOG_IN_A_TRANSACTION
 1000

	)

11 
	#MIN_FREE_DISK
 100

12 
	#MAX_LOGQUEUE
 32

	)

14 cÚ¡ 
	gs_tim”_š‹rv®
 = 2000;

16 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

18 
DLL_PUBLIC
 
	gEv’tLog
::
Ev’tLog
(
sm¬t_±r
<
D©aBa£I‹m
> 
db
)

19 : 
m_iNextIn£¹Id
(0)

20 , 
m_db
(
db
)

21 , 
m_csEv’tLog
()

22 , 
m_queueEv’tLog
()

23 , 
	$m_tim”
()

25 
max
 = 
	`G‘MaxID
();

26 
m_iNextIn£¹Id
 = 
max
 < 0 ? 0 : max + 1;

27 
	`TRACE
("Ev’tLog::Ev’tLog(): m_iNextIn£¹Id = %d\n", 
m_iNextIn£¹Id
);

28 
	`P»·»TabË
();

29 
m_tim”
.
	`S¹
(
Ev’tLog
::
s_Tim”C®lback
, 
this
, 
NULL
, 
s_tim”_š‹rv®
, 0);

30 
	}
}

32 
DLL_PUBLIC
 
	gEv’tLog
::~
	$Ev’tLog
()

34 
m_tim”
.
	`Stİ
();

35 
	`FlushToFe
();

36 
	}
}

38 
DLL_PUBLIC
 
boŞ
 
	gEv’tLog
::
	$In£¹
(
Ev’tLogI‹m
& 
™em
)

40 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_csEv’tLog
);

41 
m_queueEv’tLog
.
	`push
(
™em
);

42  
Œue
;

43 
	}
}

45 
	gEv’tLog
::
	$G‘MaxID
()

47 ià(
m_db
.
	`g‘
(è=ğ
NULL
)

52 
SQL™eObjeù
& 
sql™e
 = 
m_db
.
	`g‘
()->
	`G‘D©aBa£
();

53 
SQL™eStmt
 
¡mt
;

55 ià(
	`G‘SQL™eMaxV®ue
(
sql™e
, "Ev’tLog", "Id", 
¡mt
))

57  
¡mt
.
	`G‘IÁ
(0);

63 
	}
}

65 
boŞ
 
	gEv’tLog
::
	$P»·»TabË
()

67 ià(
m_db
.
	`g‘
(è=ğ
NULL
)

69  
çl£
;

72 
SQL™eObjeù
& 
sql™e
 = 
m_db
.
	`g‘
()->
	`G‘D©aBa£
();

73 
boŞ
 
»t
 = 
Œue
;

75 
Cr™iÿlSeùiÚLock
 
	`_ldb
(&(
m_db
.
	`g‘
()->
	`G‘Cr™iÿlSeùiÚ
()));

91 ià(!
	`CheckSQL™eTabËExi¡
(
sql™e
, "EventLog"))

93 
¡d
::
veùÜ
<¡d::
¡ršg
> 
cŞumns
;

94 
cŞumns
.
	`push_back
("Id INTEGER");

95 
cŞumns
.
	`push_back
("LogLevel INTEGER");

96 
cŞumns
.
	`push_back
("LogTime LONG");

97 
cŞumns
.
	`push_back
("TimeZone INTEGER");

98 
cŞumns
.
	`push_back
("EventID INTEGER");

99 
cŞumns
.
	`push_back
("ServerType INTEGER");

100 
cŞumns
.
	`push_back
("ServerID LONG");

101 
cŞumns
.
	`push_back
("DeviceType INTEGER");

102 
cŞumns
.
	`push_back
("DeviceID LONG");

103 
cŞumns
.
	`push_back
("DeviceName TEXT");

104 
cŞumns
.
	`push_back
("Description TEXT");

105 
cŞumns
.
	`push_back
("IsInSchedule INTEGER");

107 ià(!
	`C»©eSQL™eTabË
(
sql™e
, "Ev’tLog", 
cŞumns
))

109 
	`TRACE
("###PosRecord::CreateTable:EventLog() SQL Error ###\n");

110 
»t
 = 
çl£
;

114 ià(!
	`CheckSQL™eTabËExi¡
(
sql™e
, "EventIDToString"))

116 
¡d
::
veùÜ
<¡d::
¡ršg
> 
cŞumns
;

117 
cŞumns
.
	`push_back
("EventID INTEGER PRIMARY KEY");

118 
cŞumns
.
	`push_back
("Description TEXT");

120 ià(!
	`C»©eSQL™eTabË
(
sql™e
, "Ev’tIDToSŒšg", 
cŞumns
))

122 
	`TRACE
("###PosRecord::CreateTable:EventIDToString() SQL Error ###\n");

123 
»t
 = 
çl£
;

127 ià(!
	`In£¹Ev’tIDToSŒšg
())

129 
»t
 = 
çl£
;

133 ià(!
	`CheckSQL™eTabËExi¡
(
sql™e
, "EntityIDToString"))

135 
¡d
::
veùÜ
<¡d::
¡ršg
> 
cŞumns
;

136 
cŞumns
.
	`push_back
("EntityID INTEGER PRIMARY KEY");

137 
cŞumns
.
	`push_back
("Description TEXT");

139 ià(!
	`C»©eSQL™eTabË
(
sql™e
, "EÁ™yIDToSŒšg", 
cŞumns
))

141 
	`TRACE
("###PosRecord::CreateTable:EntityIDToString() SQL Error ###\n");

142 
»t
 = 
çl£
;

146 ià(!
	`In£¹EÁ™yIDToSŒšg
())

148 
»t
 = 
çl£
;

152  
»t
;

153 
	}
}

155 
boŞ
 
	gEv’tLog
::
	$In£¹Ev’tIDToSŒšg
()

157 
¡d
::
m­
<, std::
¡ršg
> 
m­Ev’tIDToSŒšg
;

162 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_DISK_ABNORMAL
] = 
NUUO_EVENT_STRING_DISK_ABNORMAL
;

163 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_SERVER_RECYCLE_EVENTLOG
] = 
NUUO_EVENT_STRING_SERVER_RECYCLE_EVENTLOG
;

164 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_SERVER_AUTO_BACKUP_START
] = 
NUUO_EVENT_STRING_SERVER_AUTO_BACKUP_START
;

165 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_SERVER_AUTO_BACKUP_STOP
] = 
NUUO_EVENT_STRING_SERVER_AUTO_BACKUP_STOP
;

166 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_SERVER_AUTO_BACKUP_FAIL
] = 
NUUO_EVENT_STRING_SERVER_AUTO_BACKUP_FAIL
;

167 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_MOTION_START
] = 
NUUO_EVENT_STRING_MOTION_START
;

168 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_MOTION_STOP
] = 
NUUO_EVENT_STRING_MOTION_STOP
;

182 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_BACKUP_MANUAL_START
] = 
NUUO_EVENT_STRING_BACKUP_MANUAL_START
;

183 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_BACKUP_MANUAL_STOP
] = 
NUUO_EVENT_STRING_BACKUP_MANUAL_STOP
;

184 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_BACKUP_MANUAL_FAIL
] = 
NUUO_EVENT_STRING_BACKUP_MANUAL_FAIL
;

185 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_EXPORT_START
] = 
NUUO_EVENT_STRING_EXPORT_START
;

186 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_EXPORT_STOP
] = 
NUUO_EVENT_STRING_EXPORT_STOP
;

187 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_EXPORT_FAIL
] = 
NUUO_EVENT_STRING_EXPORT_FAIL
;

188 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_MANUAL_RECORD_MODE_START
] = 
NUUO_EVENT_STRING_MANUAL_RECORD_MODE_START
;

189 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_MANUAL_RECORD_MODE_STOP
] = 
NUUO_EVENT_STRING_MANUAL_RECORD_MODE_STOP
;

191 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_INPUT_ON
] = 
NUUO_EVENT_STRING_INPUT_ON
;

192 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_INPUT_OFF
] = 
NUUO_EVENT_STRING_INPUT_OFF
;

193 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_OUTPUT_ON
] = 
NUUO_EVENT_STRING_OUTPUT_ON
;

194 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_OUTPUT_OFF
] = 
NUUO_EVENT_STRING_OUTPUT_OFF
;

195 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_CONNECTION_LOST
] = 
NUUO_EVENT_STRING_CONNECTION_LOST
;

196 
m­Ev’tIDToSŒšg
[
NUUO_EVENT_CONNECTION_RESTORE
] = 
NUUO_EVENT_STRING_CONNECTION_RESTORE
;

202  
	`In£¹IDToSŒšg
("Ev’tIDToSŒšg", 
m­Ev’tIDToSŒšg
);

203 
	}
}

205 
boŞ
 
	gEv’tLog
::
	$In£¹EÁ™yIDToSŒšg
()

207 
¡d
::
m­
<, std::
¡ršg
> 
m­EÁ™yIDToSŒšg
;

209 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_VIDEO_DEVICE
] = 
NUUO_ITEM_STRING_VIDEO_DEVICE
;

210 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_IO_DEVICE
] = 
NUUO_ITEM_STRING_IO_DEVICE
;

211 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_CAMERA
] = 
NUUO_ITEM_STRING_CAMERA
;

212 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_DIGITAL_INPUT
] = 
NUUO_ITEM_STRING_DIGITAL_INPUT
;

213 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_OUTPUT_RELAY
] = 
NUUO_ITEM_STRING_OUTPUT_RELAY
;

214 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_MICROPHONE
] = 
NUUO_ITEM_STRING_MICROPHONE
;

215 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_SPEAKER
] = 
NUUO_ITEM_STRING_SPEAKER
;

216 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_PTZ_MOTOR
] = 
NUUO_ITEM_STRING_PTZ_MOTOR
;

217 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_CAROUSEL
] = 
NUUO_ITEM_STRING_CAROUSEL
;

218 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_PANORAMA
] = 
NUUO_ITEM_STRING_PANORAMA
;

219 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_CAMERAINDICATOR
] = 
NUUO_ITEM_STRING_CAMERAINDICATOR
;

220 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_SERVERINDICATOR
] = 
NUUO_ITEM_STRING_SERVERINDICATOR
;

221 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_IOINDICATOR
] = 
NUUO_ITEM_STRING_IOINDICATOR
;

222 
m­EÁ™yIDToSŒšg
[
NUUO_ITEM_EMAPINDICATOR
] = 
NUUO_ITEM_STRING_EMAPINDICATOR
;

224  
	`In£¹IDToSŒšg
("EÁ™yIDToSŒšg", 
m­EÁ™yIDToSŒšg
);

225 
	}
}

227 
boŞ
 
	gEv’tLog
::
In£¹IDToSŒšg
(cÚ¡ 
¡d
::
¡ršg
& 
bË
, cÚ¡ std::
m­
<, std::¡ršg>& 
m­IDToSŒšg
)

229 ià(
m_db
.
g‘
(è=ğ
NULL
)

231  
çl£
;

234 
	g¡d
::
¡ršg
 
sql
 = 
¡ršg_fÜm©
("INSERT INTO % VALUES(?, ?);", 
bË
.
c_¡r
());

235 
	g¡d
::
¡ršg
 

 = "";

237 
	grc
 = 
SQLITE_OK
;

238 
	gSQL™eObjeù
& 
	gsql™e
 = 
m_db
.
g‘
()->
G‘D©aBa£
();

239 
SQL™eStmt
 
	g¡mt
;

241 
	grc
 = 
sql™e
.
P»·»
(
sql
, 
¡mt
, 

);

242 ià(
	grc
 !ğ
SQLITE_OK
)

244  
çl£
;

247 
	grc
 = 
sql™e
.
BegšT¿n§ùiÚ
();

248 ià(
	grc
 !ğ
SQLITE_OK
)

250  
çl£
;

253 
	g¡d
::
m­
<, std::
¡ršg
>::
cÚ¡_™”©Ü
 
™
 = 
m­IDToSŒšg
.
begš
(); 
	g™
 !ğm­IDToSŒšg.
’d
(); it++)

255 
boŞ
 
	gbšd
 = 
Œue
;

256 
	gbšd
 = 
bšd
 && (
¡mt
.
BšdIÁ
(1, 
™
->
fœ¡
è=ğ
SQLITE_OK
);

257 
	gbšd
 = 
bšd
 && (
¡mt
.
BšdText
(2, 
™
->
£cÚd
è=ğ
SQLITE_OK
);

258 ià(!
	gbšd
)

260 
TRACE
("SQLƒrror: bind data failed.\n");

264 
	grc
 = 
¡mt
.
S‹p
();

265 ià(
	grc
 !ğ
SQLITE_DONE
)

267 
TRACE
("SQLƒ¼Ü: sql™e3_¡• faed<%d>\n", 
rc
);

271 
	grc
 = 
¡mt
.
Re£t
();

272 ià(
	grc
 !ğ
SQLITE_OK
)

274 
TRACE
("SQLƒ¼Ü: sql™e3_»£ˆçed<%d>\n", 
rc
);

279 
boŞ
 
	g»t
 = (
rc
 =ğ
SQLITE_OK
);

281 
	grc
 = 
sql™e
.
EndT¿n§ùiÚ
();

282 ià(
	grc
 !ğ
SQLITE_OK
)

284  
çl£
;

287  
	g»t
;

290 
boŞ
 
	gEv’tLog
::
	$FlushToFe
()

292 ià(
m_db
.
	`g‘
(è=ğ
NULL
)

294  
çl£
;

297 
Cr™iÿlSeùiÚLock
 
	`lock
(&
m_csEv’tLog
);

299 
ušt64_t
 
ava_¥aû
 = 0;

300 
	`G‘DiskS·û
(
m_db
.
	`g‘
()->
	`G‘FeName
().
	`c_¡r
(), &
ava_¥aû
, 
NULL
, NULL);

301 ià(
ava_¥aû
 < 
MIN_FREE_DISK
)

303 
size_t
 
logSize
 = 
m_queueEv’tLog
.
	`size
();

304 
size_t
 
»moveI‹mCouÁ
 = 
logSize
 > 
MAX_LOGQUEUE
 ?†ogSize - MAX_LOGQUEUE : 0;

305 (
»moveI‹mCouÁ
--) > 0)

307 
m_queueEv’tLog
.
	`pİ
();

309  
çl£
;

312 
rc
 = 
SQLITE_OK
;

313 
SQL™eObjeù
& 
sql™e
 = 
m_db
.
	`g‘
()->
	`G‘D©aBa£
();

315 
¡d
::
¡ršg
 
sql
 = "INSERT INTO EventLog VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);";

316 
¡d
::
¡ršg
 

;

318 
SQL™eStmt
 
¡mt
;

320 
Cr™iÿlSeùiÚLock
 
	`_ldb
(&(
m_db
.
	`g‘
()->
	`G‘Cr™iÿlSeùiÚ
()));

322 
rc
 = 
sql™e
.
	`P»·»
(
sql
, 
¡mt
, 

);

323 ià(
rc
 !ğ
SQLITE_OK
)

325  
çl£
;

328 
boŞ
 
»t
 = 
Œue
;

330 !
m_queueEv’tLog
.
	`em±y
())

332 
rc
 = 
sql™e
.
	`BegšT¿n§ùiÚ
();

333 ià(
rc
 !ğ
SQLITE_OK
)

335  
çl£
;

338 
i
 = 0; i < 
MAX_INSERT_EVENT_LOG_IN_A_TRANSACTION
 && !
m_queueEv’tLog
.
	`em±y
(); i++)

340 
Ev’tLogI‹m
& 
™em
 = 
m_queueEv’tLog
.
	`äÚt
();

342 
boŞ
 
bšd
 = 
Œue
;

343 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ
(1, 
m_iNextIn£¹Id
++è=ğ
SQLITE_OK
);

344 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ
(2, 
™em
.
iLogLev–
è=ğ
SQLITE_OK
);

346 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ64
(3, (
št64_t
)
™em
.
uÎLogTime
è=ğ
SQLITE_OK
);

347 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ
(4, 
™em
.
iTimeZÚe
è=ğ
SQLITE_OK
);

348 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ
(5, 
™em
.
iEv’tID
è=ğ
SQLITE_OK
);

349 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ
(6, 
™em
.
iS”v”Ty³
è=ğ
SQLITE_OK
);

351 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ64
(7, (
št64_t
)
™em
.
uÎS”v”ID
è=ğ
SQLITE_OK
);

352 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ
(8, 
™em
.
iDeviûTy³
è=ğ
SQLITE_OK
);

354 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ64
(9, (
št64_t
)
™em
.
uÎDeviûID
è=ğ
SQLITE_OK
);

355 
bšd
 = bšd && (
¡mt
.
	`BšdText
(10, 
™em
.
sDeviûName
è=ğ
SQLITE_OK
);

356 
bšd
 = bšd && (
¡mt
.
	`BšdText
(11, 
™em
.
sDesütiÚ
è=ğ
SQLITE_OK
);

357 
bšd
 = bšd && (
¡mt
.
	`BšdIÁ
(12, 
™em
.
iIsInScheduË
è=ğ
SQLITE_OK
);

358 ià(!
bšd
)

360 
	`TRACE
("SQLƒrror: bind data failed.\n");

364 
rc
 = 
¡mt
.
	`S‹p
();

365 ià(
rc
 !ğ
SQLITE_DONE
)

367 
	`TRACE
("SQLƒ¼Ü: sql™e3_¡• faed<%d>\n", 
rc
);

371 
rc
 = 
¡mt
.
	`Re£t
();

372 ià(
rc
 !ğ
SQLITE_OK
)

374 
	`TRACE
("SQLƒ¼Ü: sql™e3_»£ˆçed<%d>\n", 
rc
);

378 
m_queueEv’tLog
.
	`pİ
();

381 
»t
 = (
rc
 =ğ
SQLITE_OK
);

383 
rc
 = 
sql™e
.
	`EndT¿n§ùiÚ
();

384 ià(
rc
 !ğ
SQLITE_OK
)

386  
çl£
;

389 ià(!
»t
)

391  
çl£
;

395  
Œue
;

396 
	}
}

398 
	gEv’tLog
::
	$s_Tim”C®lback
(*
cÚ‹xt
, *
·¿m
)

400 
Ev’tLog
 *
pThis
 = 
¡©ic_ÿ¡
<Ev’tLog *>(
cÚ‹xt
);

401 ià(
pThis
 !ğ
NULL
)

403 
pThis
->
	`Tim”C®lback
();

405 
	}
}

406 
	gEv’tLog
::
	$Tim”C®lback
()

408 
	`FlushToFe
();

409 
	}
}

	@../../titanutils/log/EventLog.h

1 #iâdeà
_EVENT_LOG_H_


2 
	#_EVENT_LOG_H_


	)

4 
	~"expÜts.h
"

6 
	~"th»ad_objeù/sšgË_tim”.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

9 
	~<¡ršg
>

10 
	~<m­
>

11 
	~<queue
>

13 
	~"Ev’tLogI‹m.h
"

14 
	~"D©aBa£Mªag”.h
"

16 
şass
 
	gEv’tLogDBMªag”
;

17 
şass
 
	gEv’tLogDBMªag”2
;

19 şas 
	cDLL_PUBLIC
 
	mEv’tLog


21 
ä›nd
 
şass
 
	mEv’tLogDBMªag”
;

22 
ä›nd
 
şass
 
	mEv’tLogDBMªag”2
;

23 
	mpublic
:

24 ~
Ev’tLog
();

26 
boŞ
 
In£¹
(
Ev’tLogI‹m
& 
™em
);

28 
	m´iv©e
:

29 
Ev’tLog
(
SYSUTILS_SPACE
::
sm¬t_±r
<
D©aBa£I‹m
> 
db
);

30 
G‘MaxID
();

31 
boŞ
 
P»·»TabË
();

32 
boŞ
 
In£¹Ev’tIDToSŒšg
();

33 
boŞ
 
In£¹EÁ™yIDToSŒšg
();

34 
boŞ
 
In£¹IDToSŒšg
(cÚ¡ 
¡d
::
¡ršg
& 
bË
, cÚ¡ std::
m­
<, std::¡ršg>& 
m­IDToSŒšg
);

35 
boŞ
 
FlushToFe
();

36 
s_Tim”C®lback
(*
cÚ‹xt
, *
·¿m
);

37 
Tim”C®lback
();

39 
	m´iv©e
:

40 
Ev’tLog
();

41 
Ev’tLog
(cÚ¡ Ev’tLog& 
rhs
);

42 
	mEv’tLog
 &
	mİ”©Ü
=(cÚ¡ 
Ev’tLog
& 
rhs
);

44 
	m´iv©e
:

45 
m_iNextIn£¹Id
;

46 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
D©aBa£I‹m
> 
m_db
;

47 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_csEv’tLog
;

48 
	m¡d
::
queue
<
Ev’tLogI‹m
> 
m_queueEv’tLog
;

49 
	mSYSUTILS_SPACE
::
SšgËTim”
 
m_tim”
;

	@../../titanutils/log/EventLogDBManager.cpp

1 
	~"Ev’tLogDBMªag”.h
"

3 
	~"commÚ/fe.h
"

4 
	~"commÚ/¡ršg.h
"

5 
	~"commÚ/h¬dw¬e.h
"

7 
	~"debugMsg/Debug.h
"

9 
	~"cÚ¡/P©hCÚ¡.h
"

10 
	~"´og¿mmšg_h–p_fe/NUUOCÜpÜ©eDefš™iÚ.h
"

12 
	~<m­
>

13 
	~<®gÜ™hm
>

15 #ifdeà
WIN32


16 
	#SLASH
 "\\"

	)

18 
	#SLASH
 "/"

	)

21 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

23 cÚ¡ 
	gs_tim”_š‹rv®
 = 2000;

25 
DLL_PUBLIC
 
	gEv’tLogDBMªag”
::
	$Ev’tLogDBMªag”
(
ušt64_t
 
£rv”_id
)

26 : 
	`m_£rv”_id
(
£rv”_id
)

27 , 
	`m_cs
()

28 , 
	`m_poŞ
()

29 , 
	`m_poŞQu”y
()

30 , 
	`m_tim”
()

31 , 
	$m_»cyş”
()

33 
	}
}

35 
DLL_PUBLIC
 
	gEv’tLogDBMªag”
::~
	$Ev’tLogDBMªag”
()

37 
	}
}

39 
DLL_PUBLIC
 
boŞ
 
Ev’tLogDBMªag”
::
	$S¹
()

41  
m_tim”
.
	`S¹
(
Ev’tLogDBMªag”
::
s_Tim”C®lback
, 
this
, 
NULL
, 
s_tim”_š‹rv®
, 0);

42 
	}
}

44 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogDBMªag”
::
	$Stİ
()

46 
	`RecyşeStİ
();

47 
m_tim”
.
	`Stİ
();

49 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

51 
m_poŞ
.
	`ş—r
();

52 
m_poŞQu”y
.
	`ş—r
();

54  
Œue
;

55 
	}
}

57 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogDBMªag”
::
S‘Cªdid©eP©hs
(cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
ÿndid©eP©h
)

59 
Cr™iÿlSeùiÚLock
 
_l
(&
m_cs
);

61 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
™
 = 
ÿndid©eP©h
.
begš
(); 
	g™
 !ğÿndid©eP©h.
’d
(); it++)

63 
	gm_Cªdid©eP©hs
.
push_back
(
ResŞveP©h
(*
™
));

66  
	gŒue
;

69 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogDBMªag”
::
	$S‘Cu¼’tSaveP©h
(cÚ¡ 
¡d
::
¡ršg
& 
cu¼’tSaveP©h
)

71 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

73 
¡d
::
¡ršg
 
tmpP©h
 = 
	`ResŞveP©h
(
cu¼’tSaveP©h
);

75 ià(
m_Cu¼‹ÁSaveP©h
 !ğ
tmpP©h
)

77 
m_Cu¼‹ÁSaveP©h
 = 
tmpP©h
;

78 
m_poŞ
.
	`ş—r
();

80 
	`RecyşeStİ
();

81 
	`RecyşeS¹
();

84  
Œue
;

85 
	}
}

87 
DLL_PUBLIC
 
	gEv’tLogDBMªag”
 &Ev’tLogDBMªag”::
	$G‘Mªag”
(
ušt64_t
 
£rv”_id
)

89 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
s_cs
;

90 
Cr™iÿlSeùiÚLock
 
	`_l
(&
s_cs
);

91 
¡d
::
m­
< 
ušt64_t
, 
sm¬t_±r
<
Ev’tLogDBMªag”
> > 
s_mªag”s
;

93 
¡d
::
m­
< 
ušt64_t
, 
sm¬t_±r
<
Ev’tLogDBMªag”
> >::
™”©Ü
 
™
 = 
s_mªag”s
.
	`fšd
(
£rv”_id
);

94 ià(
™
 =ğ
s_mªag”s
.
	`’d
())

96 
Ev’tLogDBMªag”
 *
Ãw_mªag”
 = 
Ãw
 
	`Ev’tLogDBMªag”
(
£rv”_id
);

97 
s_mªag”s
[
£rv”_id
] = 
Ãw_mªag”
;

98  *
Ãw_mªag”
;

100  *(
™
->
£cÚd
.
	`g‘
());

101 
	}
}

103 
DLL_PUBLIC
 
	gsm¬t_±r
<
	gEv’tLog
> 
	gEv’tLogDBMªag”
::
	$G‘D©aBa£
(
y—r
, 
mÚth
, 
day
)

106 ià(
m_Cu¼‹ÁSaveP©h
.
	`em±y
())

108  
NULL
;

111 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

114 
id
 = 
	`G‘D©aBa£ID
(
y—r
, 
mÚth
, 
day
);

115 
¡d
::
m­
< , 
sm¬t_±r
<
Ev’tLog
> >::
™”©Ü
 
™
 = 
m_poŞ
.
	`fšd
(
id
);

116 ià(
™
 !ğ
m_poŞ
.
	`’d
())

118  
™
->
£cÚd
;

122 
D©aBa£Mªag”
& 
mªag”
 = D©aBa£Mªag”::
	`G‘Mªag”
();

123 
¡d
::
¡ršg
 
f’ame
 = 
	`G‘D©aBa£F’ame
(
m_Cu¼‹ÁSaveP©h
, 
y—r
, 
mÚth
, 
day
);

125 ià(!
	`CheckFeExi¡
(
m_Cu¼‹ÁSaveP©h
))

127 
	`MakeDœeùÜy
(
m_Cu¼‹ÁSaveP©h
);

130 
sm¬t_±r
<
D©aBa£I‹m
> 
db
 = 
mªag”
.
	`G‘D©aBa£
(
f’ame
);

131 ià(
db
.
	`g‘
(è=ğ
NULL
)

133  
NULL
;

136 
Ev’tLog
 *
log
 = 
Ãw
 
	`Ev’tLog
(
db
);

137 ià(
log
 =ğ
NULL
)

139  
NULL
;

142 
sm¬t_±r
<
Ev’tLog
> 
p
 = 
log
;

143 
m_poŞ
[
id
] = 
p
;

144  
p
;

145 
	}
}

147 
DLL_PUBLIC
 
	g¡d
::
veùÜ
< 
sm¬t_±r
<
Ev’tLogQu”y
> > 
Ev’tLogDBMªag”
::
	$G‘D©aBa£Qu”y
(
y—r
, 
mÚth
, 
day
)

150 
¡d
::
veùÜ
<¡d::
¡ršg
> 
possibËFeName
;

151 
¡d
::
veùÜ
<¡d::
¡ršg
>::
™”©Ü
 
™
 = 
m_Cªdid©eP©hs
.
	`begš
(); iˆ!ğm_Cªdid©eP©hs.
	`’d
(); it++)

153 
	`TRACE
("G‘D©aBa£Qu”y m_Cªdid©eP©h is: %s\n",
™
->
	`c_¡r
());

154 
¡d
::
¡ršg
 
tmp
 = 
	`G‘D©aBa£F’ame
(*
™
, 
y—r
, 
mÚth
, 
day
);

155 
	`TRACE
("G‘D©aBa£Qu”y…©h is: %s\n",
tmp
.
	`c_¡r
());

157 ià(
	`CheckFeExi¡
(
tmp
))

159 
possibËFeName
.
	`push_back
(
tmp
);

163 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

165 
¡d
::
veùÜ
< 
sm¬t_±r
<
Ev’tLogQu”y
> > 
ev’tLogQu”yLi¡
;

168 
¡d
::
veùÜ
<¡d::
¡ršg
>::
™”©Ü
 
feNameIt
 = 
possibËFeName
.
	`begš
();

169 
feNameIt
 !ğ
possibËFeName
.
	`’d
(); )

171 
¡d
::
m­
< std::
¡ršg
, 
sm¬t_±r
<
Ev’tLogQu”y
> >::
™”©Ü
 
™
 = 
m_poŞQu”y
.
	`fšd
(*
feNameIt
);

172 ià(
™
 !ğ
m_poŞQu”y
.
	`’d
())

174 
ev’tLogQu”yLi¡
.
	`push_back
(
™
->
£cÚd
);

175 
feNameIt
 = 
possibËFeName
.
	`”a£
(fileNameIt);

179 
feNameIt
++;

183 ià(!
possibËFeName
.
	`em±y
())

186 
¡d
::
veùÜ
<¡d::
¡ršg
>::
™”©Ü
 
feNameIt
 = 
possibËFeName
.
	`begš
();

187 
feNameIt
 !ğ
possibËFeName
.
	`’d
(); fileNameIt++)

189 
D©aBa£Mªag”
& 
mªag”
 = D©aBa£Mªag”::
	`G‘Mªag”
();

190 
¡d
::
¡ršg
 
f’ame
 = *
feNameIt
;

191 
sm¬t_±r
<
D©aBa£I‹m
> 
db
 = 
mªag”
.
	`G‘D©aBa£
(
f’ame
);

192 ià(
db
.
	`g‘
(è=ğ
NULL
)

194 
	`ASSERT
(
çl£
);

198 
Ev’tLogQu”y
 *
log
 = 
Ãw
 
	`Ev’tLogQu”y
(
db
);

199 ià(
log
 =ğ
NULL
)

201 
	`ASSERT
(
çl£
);

205 
sm¬t_±r
<
Ev’tLogQu”y
> 
p
 = 
log
;

206 
m_poŞQu”y
[
f’ame
] = 
p
;

208 
ev’tLogQu”yLi¡
.
	`push_back
(
p
);

212  
ev’tLogQu”yLi¡
;

213 
	}
}

215 
	gEv’tLogDBMªag”
::
	$G‘D©aBa£ID
(
y—r
, 
mÚth
, 
day
)

217  
y—r
 * 10000 + 
mÚth
 * 100 + 
day
;

218 
	}
}

220 
	g¡d
::
¡ršg
 
Ev’tLogDBMªag”
::
	$G‘D©aBa£F’ame
(cÚ¡ 
¡d
::
¡ršg
& 
·th
, 
y—r
, 
mÚth
, 
day
)

222  
	`¡ršg_fÜm©
("%s%s%04d%02d%02d.db", 
·th
.
	`c_¡r
(), 
SLASH
, 
y—r
, 
mÚth
, 
day
);

223 
	}
}

225 
	gEv’tLogDBMªag”
::
	$s_Tim”C®lback
(*
cÚ‹xt
, *
·¿m
)

227 
Ev’tLogDBMªag”
 *
pThis
 = 
¡©ic_ÿ¡
<Ev’tLogDBMªag” *>(
cÚ‹xt
);

228 ià(
pThis
 !ğ
NULL
)

230 
pThis
->
	`Tim”C®lback
();

232 
	}
}

234 
	gEv’tLogDBMªag”
::
	$Tim”C®lback
()

236 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

239 
¡d
::
m­
< , 
sm¬t_±r
<
Ev’tLog
> >::
™”©Ü
 
™
;

242 
™
 = 
m_poŞ
.
	`begš
();

243 
™
 !ğ
m_poŞ
.
	`’d
())

245 ià(
™
->
£cÚd
.
	`g‘
(è=ğ
NULL
)

247 
m_poŞ
.
	`”a£
(
™
++);

249 ià(
™
->
£cÚd
.
	`u£_couÁ
() <= 1)

251 
m_poŞ
.
	`”a£
(
™
++);

255 
™
++;

261 
¡d
::
m­
< std::
¡ršg
, 
sm¬t_±r
<
Ev’tLogQu”y
> >::
™”©Ü
 
™
;

264 
™
 = 
m_poŞQu”y
.
	`begš
();

265 
™
 !ğ
m_poŞQu”y
.
	`’d
())

267 ià(
™
->
£cÚd
.
	`g‘
(è=ğ
NULL
)

269 
m_poŞQu”y
.
	`”a£
(
™
++);

271 ià(
™
->
£cÚd
.
	`u£_couÁ
() <= 1)

273 
m_poŞQu”y
.
	`”a£
(
™
++);

277 
™
++;

281 
	}
}

283 cÚ¡ 
	gs_max_log_size_³rûÁ
 = 0.03L;

284 cÚ¡ 
ušt64_t
 
	gs_max_log_size
 = 
UINT64_C
(5) * 1024;

286 
boŞ
 
	gEv’tLogDBMªag”
::
	$RecyşeS¹
()

288 
ušt64_t
 
max_size
 = 
s_max_log_size
;

289 
ušt64_t
 
disk_size
 = 
	`UINT64_C
(0);

290 ià(
	`G‘DiskS·û
(
m_Cu¼‹ÁSaveP©h
, 
NULL
, NULL, &
disk_size
))

293 
max_size
 = (
¡d
::
max
)((
ušt64_t
)(
disk_size
 * 
s_max_log_size_³rûÁ
), 
s_max_log_size
);

295 
m_»cyş”
.
	`S¹
(
m_Cu¼‹ÁSaveP©h
, 
max_size
, 
Ev’tLogDBMªag”
::
s_RecyşeC®lback
, 
this
);

297  
Œue
;

298 
	}
}

300 
boŞ
 
	gEv’tLogDBMªag”
::
	$RecyşeStİ
()

302 
m_»cyş”
.
	`Stİ
();

304  
Œue
;

305 
	}
}

307 
	gEv’tLogDBMªag”
::
	$s_RecyşeC®lback
(*
·¿m
, cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

309 
Ev’tLogDBMªag”
 *
pThis
 = 
¡©ic_ÿ¡
<Ev’tLogDBMªag” *>(
·¿m
);

310 ià(
pThis
 !ğ
NULL
)

312 
pThis
->
	`RecyşeC®lback
(
·thÇme
);

314 
	}
}

316 
	gEv’tLogDBMªag”
::
	$RecyşeC®lback
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

318 
SYSTEMTIME
 
¡
 = 
UTCTime
::
	`G‘Cu¼’tSy¡emTime
();

319 
sm¬t_±r
<
Ev’tLog
> 
log
 = 
	`G‘D©aBa£
(
¡
.
wY—r
, st.
wMÚth
, st.
wDay
);

320 
Ev’tLogI‹m
 
™em
;

322 ià(
log
.
	`g‘
(è=ğ
NULL
)

327 
™em
.
iLogLev–
 = 
eLOG_CRIT
;

328 
™em
.
iEv’tID
 = 
NUUO_EVENT_SERVER_RECYCLE_EVENTLOG
;

329 
™em
.
sDesütiÚ
 = 
	`¡ršg_fÜm©
("%s: %s", 
NUUO_EVENT_STRING_SERVER_RECYCLE_EVENTLOG
, 
·thÇme
.
	`c_¡r
());

331 
log
.
	`g‘
()->
	`In£¹
(
™em
);

332 
	}
}

	@../../titanutils/log/EventLogDBManager.h

1 #iâdeà
__EVENT_LOG_DB_MANAGER_H__


2 
	#__EVENT_LOG_DB_MANAGER_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~"Ev’tLog.h
"

9 
	~"Ev’tLogQu”y.h
"

10 
	~"Ev’tLogRecyş”.h
"

12 şas 
	cDLL_PUBLIC
 
	mEv’tLogDBMªag”


14 
	mpublic
:

15 ~
Ev’tLogDBMªag”
();

17 
	mEv’tLogDBMªag”
& 
G‘Mªag”
(
ušt64_t
 
£rv”_id
);

19 
boŞ
 
S‘Cªdid©eP©hs
(cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
ÿndid©eP©h
);

20 
boŞ
 
S‘Cu¼’tSaveP©h
(cÚ¡ 
¡d
::
¡ršg
& 
cu¼’tSaveP©h
);

22 
boŞ
 
S¹
();

23 
boŞ
 
Stİ
();

25 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
Ev’tLog
> 
G‘D©aBa£
(
y—r
, 
mÚth
, 
day
);

26 
	m¡d
::
veùÜ
< 
SYSUTILS_SPACE
::
sm¬t_±r
<
Ev’tLogQu”y
> > 
G‘D©aBa£Qu”y
(
y—r
, 
mÚth
, 
day
);

28 
	m´iv©e
:

29 
G‘D©aBa£ID
(
y—r
, 
mÚth
, 
day
);

30 
	m¡d
::
¡ršg
 
G‘D©aBa£F’ame
(cÚ¡ 
¡d
::¡ršg& 
·th
, 
y—r
, 
mÚth
, 
day
);

32 
s_Tim”C®lback
(*
cÚ‹xt
, *
·¿m
);

33 
Tim”C®lback
();

35 
boŞ
 
RecyşeS¹
();

36 
boŞ
 
RecyşeStİ
();

38 
s_RecyşeC®lback
(*
·¿m
, cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

39 
RecyşeC®lback
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

41 
	m´iv©e
:

42 
Ev’tLogDBMªag”
();

43 
Ev’tLogDBMªag”
(
ušt64_t
 
£rv”_id
);

44 
Ev’tLogDBMªag”
(cÚ¡ Ev’tLogDBMªag” &
rhs
);

45 
	mEv’tLogDBMªag”
 &
	mİ”©Ü
=(cÚ¡ 
Ev’tLogDBMªag”
 &
rhs
);

47 
	m´iv©e
:

48 
ušt64_t
 
m_£rv”_id
;

49 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

50 
	m¡d
::
veùÜ
<
¡d
::
¡ršg
> 
m_Cªdid©eP©hs
;

51 
	m¡d
::
¡ršg
 
m_Cu¼‹ÁSaveP©h
;

52 
	m¡d
::
m­
< , 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
Ev’tLog
> > 
m_poŞ
;

53 
	m¡d
::
m­
< 
¡d
::
¡ršg
, 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
Ev’tLogQu”y
> > 
m_poŞQu”y
;

54 
	mSYSUTILS_SPACE
::
SšgËTim”
 
m_tim”
;

55 
Ev’tLogRecyş”
 
	mm_»cyş”
;

	@../../titanutils/log/EventLogDBManager2.cpp

6 
	~"Ev’tLogDBMªag”2.h
"

8 
	~"commÚ/fe.h
"

9 
	~"commÚ/¡ršg.h
"

10 
	~"commÚ/h¬dw¬e.h
"

11 
	~"commÚ/š‰y³s.h
"

13 
	~"debugMsg/Debug.h
"

15 
	~"cÚ¡/P©hCÚ¡.h
"

16 
	~"´og¿mmšg_h–p_fe/NUUOCÜpÜ©eDefš™iÚ.h
"

18 
	~<m­
>

19 
	~<®gÜ™hm
>

21 #ifdeà
_WINDOWS


22 
	#SLASH
 "\\"

	)

24 
	#SLASH
 "/"

	)

27 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

29 cÚ¡ 
	gs_tim”_š‹rv®
 = 2000;

31 
DLL_PUBLIC
 
	gEv’tLogDBMªag”2
::
	$Ev’tLogDBMªag”2
()

32 : 
	`m_tim”
()

33 , 
	`m_»cyş”
()

34 , 
	`m_cs
()

35 , 
	`m_Cªdid©eP©hs
()

36 , 
	`m_Cu¼’tSaveP©h
()

37 , 
	`m_poŞ
()

38 , 
	$m_poŞQu”y
()

40 
	}
}

42 
DLL_PUBLIC
 
	gEv’tLogDBMªag”2
::~
	$Ev’tLogDBMªag”2
()

44 
	`Stİ
();

45 
	}
}

47 
DLL_PUBLIC
 
	gEv’tLogDBMªag”2
& Ev’tLogDBMªag”2::
	$G‘Mªag”
()

49 
Ev’tLogDBMªag”2
 
s_mªag”
;

50  
s_mªag”
;

51 
	}
}

53 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogDBMªag”2
::
	$S¹
()

55  
m_tim”
.
	`S¹
(
Ev’tLogDBMªag”2
::
s_Tim”C®lback
, 
this
, 
NULL
, 
s_tim”_š‹rv®
, 0);

56 
	}
}

58 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogDBMªag”2
::
	$Stİ
()

60 
	`RecyşeStİ
();

61 
m_tim”
.
	`Stİ
();

63 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

65 
m_poŞ
.
	`ş—r
();

66 
m_poŞQu”y
.
	`ş—r
();

68  
Œue
;

69 
	}
}

71 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogDBMªag”2
::
S‘Cªdid©eP©hs
(
_š_
 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
ÿndid©eP©h
)

73 
Cr™iÿlSeùiÚLock
 
_l
(&
m_cs
);

75 
	gm_Cªdid©eP©hs
.
ş—r
();

77 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
™
 = 
ÿndid©eP©h
.
begš
(); 
	g™
 !ğÿndid©eP©h.
’d
(); it++)

79 
	gm_Cªdid©eP©hs
.
push_back
(
ResŞveP©h
(*
™
));

82  
	gŒue
;

85 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogDBMªag”2
::
	$S‘Cu¼’tSaveP©h
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
cu¼’tSaveP©h
, _š_ cÚ¡ 
ušt64_t
 
rg‘_£rv”_id
)

87 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

89 cÚ¡ 
¡d
::
¡ršg
 
tmpP©h
 = 
	`ResŞveP©h
(
cu¼’tSaveP©h
);

91 ià(
m_Cu¼’tSaveP©h
 !ğ
tmpP©h
)

93 
m_Cu¼’tSaveP©h
 = 
tmpP©h
;

94 
m_poŞ
.
	`ş—r
();

96 
	`RecyşeStİ
();

97 
	`RecyşeS¹
(
rg‘_£rv”_id
);

100  
Œue
;

101 
	}
}

103 
DLL_PUBLIC
 
	gsm¬t_±r
<
	gEv’tLog
> 
	gEv’tLogDBMªag”2
::
	$G‘D©aBa£
(
_š_
 
ušt64_t
 
£rv”_id
, _š_ 
y—r
, _š_ 
mÚth
, _š_ 
day
)

105 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

108 ià(
m_Cu¼’tSaveP©h
.
	`em±y
())

110  
NULL
;

114 cÚ¡ 
¡d
::
·œ
<
ušt64_t
, > 
key
 = std::
	`make_·œ
(
£rv”_id
, 
Ev’tLogRecyş”2
::
	`C®cD©eCode
(
y—r
, 
mÚth
, 
day
));

115 
¡d
::
m­
< std::
·œ
<
ušt64_t
, >, 
sm¬t_±r
<
Ev’tLog
> >::
cÚ¡_™”©Ü
 
™
 = 
m_poŞ
.
	`fšd
(
key
);

116 ià(
™
 !ğ
m_poŞ
.
	`’d
())

118  
™
->
£cÚd
;

122 cÚ¡ 
¡d
::
¡ršg
 
£rv”_id_·th
 = 
	`G‘S”v”IDP©h
(
m_Cu¼’tSaveP©h
, 
£rv”_id
);

123 cÚ¡ 
¡d
::
¡ršg
 
f’ame
 = 
	`G‘D©aBa£F’ame
(
£rv”_id_·th
, 
y—r
, 
mÚth
, 
day
);

124 ià(!
	`CheckFeExi¡
(
£rv”_id_·th
))

126 
	`MakeDœeùÜy
(
£rv”_id_·th
);

129 
D©aBa£Mªag”
& 
mªag”
 = D©aBa£Mªag”::
	`G‘Mªag”
();

130 
sm¬t_±r
<
D©aBa£I‹m
> 
db
 = 
mªag”
.
	`G‘D©aBa£
(
f’ame
);

131 ià(
db
.
	`g‘
(è=ğ
NULL
)

133  
NULL
;

135 
Ev’tLog
 *
log
 = 
Ãw
 
	`Ev’tLog
(
db
);

136 ià(
log
 =ğ
NULL
)

138  
NULL
;

141 
sm¬t_±r
<
Ev’tLog
> 
p
 = 
log
;

142 
m_poŞ
[
key
] = 
p
;

143  
p
;

144 
	}
}

146 
DLL_PUBLIC
 
	g¡d
::
veùÜ
< 
sm¬t_±r
<
Ev’tLogQu”y
> > 
Ev’tLogDBMªag”2
::
	$G‘D©aBa£Qu”y
(
_š_
 
ušt64_t
 
£rv”_id
, _š_ 
y—r
, _š_ 
mÚth
, _š_ 
day
)

148 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

151 
¡d
::
veùÜ
<¡d::
¡ršg
> 
possibËFeName
;

152 
¡d
::
veùÜ
<¡d::
¡ršg
>::
cÚ¡_™”©Ü
 
™
 = 
m_Cªdid©eP©hs
.
	`begš
(); iˆ!ğm_Cªdid©eP©hs.
	`’d
(); it++)

154 cÚ¡ 
¡d
::
¡ršg
 
£rv”_id_·th
 = 
	`G‘S”v”IDP©h
(*
™
, 
£rv”_id
);

155 cÚ¡ 
¡d
::
¡ršg
 
f’ame
 = 
	`G‘D©aBa£F’ame
(
£rv”_id_·th
, 
y—r
, 
mÚth
, 
day
);

157 ià(
	`CheckFeExi¡
(
f’ame
))

159 
possibËFeName
.
	`push_back
(
f’ame
);

164 
¡d
::
veùÜ
< 
sm¬t_±r
<
Ev’tLogQu”y
> > 
ev’tLogQu”yLi¡
;

167 
¡d
::
veùÜ
<¡d::
¡ršg
>::
™”©Ü
 
feNameIt
 = 
possibËFeName
.
	`begš
();

168 
feNameIt
 !ğ
possibËFeName
.
	`’d
(); )

170 
¡d
::
m­
< std::
¡ršg
, 
sm¬t_±r
<
Ev’tLogQu”y
> >::
cÚ¡_™”©Ü
 
™
 = 
m_poŞQu”y
.
	`fšd
(*
feNameIt
);

171 ià(
™
 !ğ
m_poŞQu”y
.
	`’d
())

173 
ev’tLogQu”yLi¡
.
	`push_back
(
™
->
£cÚd
);

174 
feNameIt
 = 
possibËFeName
.
	`”a£
(fileNameIt);

178 
feNameIt
++;

183 ià(!
possibËFeName
.
	`em±y
())

185 
D©aBa£Mªag”
& 
mªag”
 = D©aBa£Mªag”::
	`G‘Mªag”
();

187 
¡d
::
veùÜ
<¡d::
¡ršg
>::
cÚ¡_™”©Ü
 
feNameIt
 = 
possibËFeName
.
	`begš
();

188 
feNameIt
 !ğ
possibËFeName
.
	`’d
();

189 
feNameIt
++)

191 cÚ¡ 
¡d
::
¡ršg
 
f’ame
 = *
feNameIt
;

192 
sm¬t_±r
<
D©aBa£I‹m
> 
db
 = 
mªag”
.
	`G‘D©aBa£
(
f’ame
);

193 ià(
db
.
	`g‘
(è=ğ
NULL
)

198 
Ev’tLogQu”y
 *
log
 = 
Ãw
 
	`Ev’tLogQu”y
(
db
);

199 ià(
log
 =ğ
NULL
)

204 
sm¬t_±r
<
Ev’tLogQu”y
> 
p
 = 
log
;

205 
m_poŞQu”y
[
f’ame
] = 
p
;

207 
ev’tLogQu”yLi¡
.
	`push_back
(
p
);

211  
ev’tLogQu”yLi¡
;

212 
	}
}

214 
	g¡d
::
¡ršg
 
Ev’tLogDBMªag”2
::
	$G‘S”v”IDP©h
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
·th_roÙ
, _š_ 
ušt64_t
 
£rv”_id
)

219  
	`¡ršg_fÜm©
("%s" "%s" "%016" 
PRIX64
, 
·th_roÙ
.
	`c_¡r
(), 
SLASH
, 
£rv”_id
);

220 
	}
}

222 
	g¡d
::
¡ršg
 
Ev’tLogDBMªag”2
::
	$G‘D©aBa£F’ame
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
·th_£rv”_id
, _š_ 
y—r
, _š_ 
mÚth
, _š_ 
day
)

227  
	`¡ršg_fÜm©
("%s" "%s" "%04d%02d%02d.db", 
·th_£rv”_id
.
	`c_¡r
(), 
SLASH
, 
y—r
, 
mÚth
, 
day
);

228 
	}
}

230 
	gEv’tLogDBMªag”2
::
	$s_Tim”C®lback
(
_š_
 * 
cÚ‹xt
, _š_ * 
·¿m
)

232 
Ev’tLogDBMªag”2
 *
pThis
 = 
¡©ic_ÿ¡
<Ev’tLogDBMªag”2*>(
cÚ‹xt
);

233 ià(
pThis
 !ğ
NULL
)

235 
pThis
->
	`Tim”C®lback
();

237 
	}
}

239 
	gEv’tLogDBMªag”2
::
	$Tim”C®lback
()

241 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

244 
¡d
::
m­
< std::
·œ
<
ušt64_t
, >, 
sm¬t_±r
<
Ev’tLog
> >::
™”©Ü
 
™
;

247 
™
 = 
m_poŞ
.
	`begš
();

248 
™
 !ğ
m_poŞ
.
	`’d
())

250 ià(
™
->
£cÚd
.
	`g‘
(è=ğ
NULL
)

252 
m_poŞ
.
	`”a£
(
™
++);

254 ià(
™
->
£cÚd
.
	`u£_couÁ
() <= 1)

256 
m_poŞ
.
	`”a£
(
™
++);

260 
™
++;

266 
¡d
::
m­
< std::
¡ršg
, 
sm¬t_±r
<
Ev’tLogQu”y
> >::
™”©Ü
 
™
;

269 
™
 = 
m_poŞQu”y
.
	`begš
();

270 
™
 !ğ
m_poŞQu”y
.
	`’d
())

272 ià(
™
->
£cÚd
.
	`g‘
(è=ğ
NULL
)

274 
m_poŞQu”y
.
	`”a£
(
™
++);

276 ià(
™
->
£cÚd
.
	`u£_couÁ
() <= 1)

278 
m_poŞQu”y
.
	`”a£
(
™
++);

282 
™
++;

286 
	}
}

288 cÚ¡ 
	gs_max_log_size_³rûÁ
 = 0.03L;

289 cÚ¡ 
ušt64_t
 
	gs_max_log_size
 = 
UINT64_C
(5) * 1024;

291 
boŞ
 
	gEv’tLogDBMªag”2
::
	$RecyşeS¹
(
_š_
 cÚ¡ 
ušt64_t
 
rg‘_£rv”_id
)

295 
ušt64_t
 
max_size
 = 
s_max_log_size
;

296 
ušt64_t
 
disk_size
 = 
	`UINT64_C
(0);

297 ià(
	`G‘DiskS·û
(
m_Cu¼’tSaveP©h
, 
NULL
, NULL, &
disk_size
))

300 
max_size
 = (
¡d
::
max
)((
ušt64_t
)(
disk_size
 * 
s_max_log_size_³rûÁ
), 
s_max_log_size
);

302 
m_»cyş”
.
	`S¹
(
m_Cu¼’tSaveP©h
, 
rg‘_£rv”_id
, 
max_size
, 
Ev’tLogDBMªag”2
::
s_RecyşeC®lback
, 
this
);

304  
Œue
;

305 
	}
}

307 
boŞ
 
	gEv’tLogDBMªag”2
::
	$RecyşeStİ
()

309 
m_»cyş”
.
	`Stİ
();

311  
Œue
;

312 
	}
}

314 
	gEv’tLogDBMªag”2
::
	$s_RecyşeC®lback
(
_š_
 * 
·¿m
, _š_ 
ušt64_t
 
£rv”_id
, _š_ cÚ¡ 
¡d
::
¡ršg
& 
·thÇme
)

316 
Ev’tLogDBMªag”2
* 
pThis
 = 
¡©ic_ÿ¡
<Ev’tLogDBMªag”2*>(
·¿m
);

317 ià(
pThis
 !ğ
NULL
)

319 
pThis
->
	`RecyşeC®lback
(
£rv”_id
, 
·thÇme
);

321 
	}
}

323 
	gEv’tLogDBMªag”2
::
	$RecyşeC®lback
(
_š_
 
ušt64_t
 
£rv”_id
, _š_ cÚ¡ 
¡d
::
¡ršg
& 
·thÇme
)

325 
SYSTEMTIME
 
¡
 = 
UTCTime
::
	`G‘Cu¼’tSy¡emTime
();

326 
sm¬t_±r
<
Ev’tLog
> 
log
 = 
	`G‘D©aBa£
(
£rv”_id
, 
¡
.
wY—r
, st.
wMÚth
, st.
wDay
);

327 ià(
log
.
	`g‘
(è=ğ
NULL
)

332 
Ev’tLogI‹m
 
™em
;

335 
™em
.
iLogLev–
 = 
eLOG_CRIT
;

336 
™em
.
iEv’tID
 = 
NUUO_EVENT_SERVER_RECYCLE_EVENTLOG
;

337 
™em
.
sDesütiÚ
 = 
	`¡ršg_fÜm©
("%s: %s", 
NUUO_EVENT_STRING_SERVER_RECYCLE_EVENTLOG
, 
·thÇme
.
	`c_¡r
());

340 
log
.
	`g‘
()->
	`In£¹
(
™em
);

341 
	}
}

	@../../titanutils/log/EventLogDBManager2.h

6 #iâdeà
_EVENT_LOG_DB_MANAGER_2_H_


7 
	#_EVENT_LOG_DB_MANAGER_2_H_


	)

9 
	~"expÜts.h
"

11 
	~"commÚ/¡dšt.h
"

13 
	~"Ev’tLog.h
"

14 
	~"Ev’tLogQu”y.h
"

15 
	~"Ev’tLogRecyş”2.h
"

17 #iâdeà
_š_


18 
	#_š_


	)

19 
	#_out_


	)

20 
	#_šout_


	)

23 şas 
	cDLL_PUBLIC
 
	mEv’tLogDBMªag”2


25 
	mpublic
:

26 
vœtu®
 ~
Ev’tLogDBMªag”2
();

28 
	m´iv©e
:

29 
Ev’tLogDBMªag”2
();

30 
Ev’tLogDBMªag”2
(cÚ¡ Ev’tLogDBMªag”2 &
rhs
);

31 
	mEv’tLogDBMªag”2
 &
	mİ”©Ü
=(cÚ¡ 
Ev’tLogDBMªag”2
 &
rhs
);

33 
	mpublic
:

34 
Ev’tLogDBMªag”2
& 
G‘Mªag”
();

36 
boŞ
 
S¹
();

37 
boŞ
 
Stİ
();

39 
boŞ
 
S‘Cªdid©eP©hs
(
_š_
 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
ÿndid©eP©h
);

40 
boŞ
 
S‘Cu¼’tSaveP©h
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
cu¼’tSaveP©h
,

41 
_š_
 cÚ¡ 
ušt64_t
 
rg‘_£rv”_id
);

43 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
Ev’tLog
> 
G‘D©aBa£
(
_š_
 
ušt64_t
 
£rv”_id
, _š_ 
y—r
, _š_ 
mÚth
, _š_ 
day
);

44 
	m¡d
::
veùÜ
< 
SYSUTILS_SPACE
::
sm¬t_±r
<
Ev’tLogQu”y
> > 
G‘D©aBa£Qu”y
(
_š_
 
ušt64_t
 
£rv”_id
, _š_ 
y—r
, _š_ 
mÚth
, _š_ 
day
);

46 
	m´iv©e
:

47 
¡d
::
¡ršg
 
G‘S”v”IDP©h
(
_š_
 cÚ¡ std::¡ršg& 
·th_roÙ
, _š_ 
ušt64_t
 
£rv”_id
);

48 
	m¡d
::
¡ršg
 
G‘D©aBa£F’ame
(
_š_
 cÚ¡ 
¡d
::¡ršg& 
·th_£rv”_id
, _š_ 
y—r
, _š_ 
mÚth
, _š_ 
day
);

49 
s_Tim”C®lback
(
_š_
 * 
cÚ‹xt
, _š_ * 
·¿m
);

50 
Tim”C®lback
();

52 
boŞ
 
RecyşeS¹
(
_š_
 cÚ¡ 
ušt64_t
 
rg‘_£rv”_id
);

53 
boŞ
 
RecyşeStİ
();

54 
s_RecyşeC®lback
(
_š_
 * 
·¿m
, _š_ 
ušt64_t
 
£rv”_id
, _š_ cÚ¡ 
¡d
::
¡ršg
& 
·thÇme
);

55 
RecyşeC®lback
(
_š_
 
ušt64_t
 
£rv”_id
, _š_ cÚ¡ 
¡d
::
¡ršg
& 
·thÇme
);

57 
	m´iv©e
:

58 
SYSUTILS_SPACE
::
SšgËTim”
 
m_tim”
;

59 
Ev’tLogRecyş”2
 
	mm_»cyş”
;

61 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

62 
	m¡d
::
veùÜ
<
¡d
::
¡ršg
> 
m_Cªdid©eP©hs
;

63 
	m¡d
::
¡ršg
 
m_Cu¼’tSaveP©h
;

64 
	m¡d
::
m­
< 
¡d
::
·œ
<
ušt64_t
, >, 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
Ev’tLog
> > 
m_poŞ
;

65 
	m¡d
::
m­
< 
¡d
::
¡ršg
, 
	mSYSUTILS_SPACE
::
sm¬t_±r
<
Ev’tLogQu”y
> > 
m_poŞQu”y
;

	@../../titanutils/log/EventLogItem.h

1 #iâdeà
_EVENT_LOG_ITEM_H_


2 
	#_EVENT_LOG_ITEM_H_


	)

4 
	~"expÜts.h
"

6 
	~"Log.h
"

8 
	~"commÚ/¡dšt.h
"

9 
	~"commÚ/time.h
"

11 
	~<¡ršg
>

13 
DLL_PUBLIC
 
	gEv’tLogI‹m


15 
LOG_LEVEL
 
	giLogLev–
;

16 
ušt64_t
 
	guÎLogTime
;

17 
št32_t
 
	giTimeZÚe
;

18 
št32_t
 
	giEv’tID
;

19 
št32_t
 
	giS”v”Ty³
;

20 
ušt64_t
 
	guÎS”v”ID
;

21 
št32_t
 
	giDeviûTy³
;

22 
ušt64_t
 
	guÎDeviûID
;

23 
	g¡d
::
¡ršg
 
sDeviûName
;

24 
	g¡d
::
¡ršg
 
sDesütiÚ
;

25 
št32_t
 
	giIsInScheduË
;

27 
Ev’tLogI‹m
()

29 
	giLogLev–
 = 
eLOG_DEBUG
;

30 
	guÎLogTime
 = (
SYSUTILS_SPACE
::
á_to_u64
(SYSUTILS_SPACE::
UTCTime
::
G‘Cu¼’tFeTime
()));

31 
	giTimeZÚe
 = 0;

32 
	giEv’tID
 = 0;

33 
	giS”v”Ty³
 = 0;

34 
	guÎS”v”ID
 = 0;

35 
	giDeviûTy³
 = 0;

36 
	guÎDeviûID
 = 0;

37 
	gsDeviûName
 = "";

38 
	gsDesütiÚ
 = "";

39 
	giIsInScheduË
 = 0;

	@../../titanutils/log/EventLogQuery.cpp

1 
	~"Ev’tLogQu”y.h
"

3 
	~"commÚ/¡ršg.h
"

4 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

6 
	~"sql™e/sql™e_objeù.h
"

7 
	~"sql™e/sql™e_¡mt.h
"

9 
	~"debugMsg/Debug.h
"

10 
	~"commÚ/sy¡em.h
"

12 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

14 
	#SAVESQLCOMMAND


	)

15 
	#SQLCOMMANDFILE
 "/mÁ/VOLUME1/LOG/SQLCommªd.log"

	)

17 
DLL_PUBLIC
 
	gEv’tLogQu”y
::
Ev’tLogQu”y
(
sm¬t_±r
<
D©aBa£I‹m
> 
db
)

18 : 
	$m_db
(
db
)

20 
	}
}

22 
DLL_PUBLIC
 
Ev’tLogQu”y
::~
	$Ev’tLogQu”y
()

24 
	}
}

26 
DLL_PUBLIC
 
boŞ
 
Ev’tLogQu”y
::
Qu”yEv’tIDToSŒšgTabË
(
¡d
::
m­
<, std::
¡ršg
>& 
out_»suÉ
)

28  
Qu”yIDToSŒšgTabË
("Ev’tIDToSŒšg", 
out_»suÉ
);

31 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogQu”y
::
Qu”yEÁ™yIDToSŒšgTabË
(
¡d
::
m­
<, std::
¡ršg
>& 
out_»suÉ
)

33  
Qu”yIDToSŒšgTabË
("EÁ™yIDToSŒšg", 
out_»suÉ
);

36 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogQu”y
::
Qu”yAÎ
(
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
)

38 
¡d
::
¡ršg
 
bË
 = "EventLog";

39 
	g¡d
::
¡ršg
 
wh”e
 = "";

40 
	g¡d
::
¡ršg
 
Üd”
 = "LogTime";

41 
	g¡d
::
¡ršg
 
lim™
 = "";

42 
	g¡d
::
¡ršg
 
off£t
 = "";

43  
Qu”y
(
bË
, 
wh”e
, 
Üd”
, 
lim™
, 
off£t
, 
out_»suÉ
);

46 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogQu”y
::
Qu”yByEv’tID
(
iEv’tID
, 
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
)

48 
¡d
::
¡ršg
 
bË
 = "EventLog";

49 
	g¡d
::
¡ršg
 
wh”e
 = 
¡ršg_fÜm©
("Ev’tID = %d", 
iEv’tID
);

50 
	g¡d
::
¡ršg
 
Üd”
 = "LogTime";

51 
	g¡d
::
¡ršg
 
lim™
 = "";

52 
	g¡d
::
¡ršg
 
off£t
 = "";

53  
Qu”y
(
bË
, 
wh”e
, 
Üd”
, 
lim™
, 
off£t
, 
out_»suÉ
);

56 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogQu”y
::
Qu”yByF‹r
(cÚ¡ 
Ev’tLogQu”yF‹r
& 
f‹r
, 
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
)

58  
Qu”yByF‹r
(
f‹r
, 
out_»suÉ
, 0, 0);

61 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogQu”y
::
Qu”yByF‹r
(cÚ¡ 
Ev’tLogQu”yF‹r
& 
f‹r
, 
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
,

62 
ušt32_t
 
uiS¹Index
, ušt32_ˆ
uiLim™Num
)

64 
	g¡d
::
¡ršg
 
bË
 = "EventLog";

65 
	g¡d
::
¡ršg
 
Üd”
 = "LogTime";

66 
	g¡d
::
¡ršg
 
lim™
 = "";

67 
	g¡d
::
¡ršg
 
off£t
 = "";

69 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
cÚd™iÚs
;

71 ià(
	gf‹r
.
	gÚlyQu”yInScheduË
)

73 
	gcÚd™iÚs
.
push_back
("IsInSchedule = 1");

77 
	gcÚd™iÚs
.
push_back
(
¡ršg_fÜm©
("LogTim>ğ%Îu", 
f‹r
.
¡¬tTime
));

78 
	gcÚd™iÚs
.
push_back
(
¡ršg_fÜm©
("LogTim<ğ%Îu", 
f‹r
.
’dTime
));

80 ià(
	gf‹r
.
	gev’tIDLi¡
.
size
() != 0)

82 
¡d
::
¡ršg
 
tmp
 = "(";

84 
ušt32_t
 
	gi
 = 0; i < 
	gf‹r
.
	gev’tIDLi¡
.
size
(); i++)

86 
	g¡d
::
¡ršg
 
ev’tIDF‹r
 = 
¡ršg_fÜm©
("Ev’tID = %u ", 
f‹r
.
ev’tIDLi¡
[
i
]);

88 ià(
	gi
 < 
	gf‹r
.
	gev’tIDLi¡
.
size
() - 1)

90 
	gev’tIDF‹r
 += "OR ";

94 
	gev’tIDF‹r
 += ")";

96 
	gtmp
 +ğ
ev’tIDF‹r
;

98 
	gcÚd™iÚs
.
push_back
(
tmp
);

101 ià(
	gf‹r
.
	gev’tSourûIDLi¡
.
size
() != 0)

103 
¡d
::
¡ršg
 
tmp
 = "(";

105 
ušt32_t
 
	gi
 = 0; i < 
	gf‹r
.
	gev’tSourûIDLi¡
.
size
(); i++)

107 
	g¡d
::
¡ršg
 
deviûIDF‹r
 = 
¡ršg_fÜm©
("DeviûID = %Îd ", (
št64_t
)
f‹r
.
ev’tSourûIDLi¡
[
i
].
deviûID
);

109 ià(
	gi
 < 
	gf‹r
.
	gev’tSourûIDLi¡
.
size
() - 1)

111 
	gdeviûIDF‹r
 += "OR ";

115 
	gdeviûIDF‹r
 += ")";

117 
	gtmp
 +ğ
deviûIDF‹r
;

119 
	gcÚd™iÚs
.
push_back
(
tmp
);

141 
	g¡d
::
¡ršg
 
¡rWh”e
 = "";

142 ià(
	gcÚd™iÚs
.
size
() > 0)

144 
	g¡rWh”e
 = 
cÚd™iÚs
[0];

145 
size_t
 
	gi
 = 1; i < 
	gcÚd™iÚs
.
size
(); i++)

147 
	g¡rWh”e
 += " AND ";

148 
	g¡rWh”e
 +ğ
cÚd™iÚs
[
i
];

152 ià(
	guiLim™Num
 != 0)

154 
lim™
 = 
¡ršg_fÜm©
("%u", 
uiLim™Num
);

157 ià(
	guiS¹Index
 != 0)

159 
off£t
 = 
¡ršg_fÜm©
("%u", 
uiS¹Index
);

162 
TRACE
("Ev’tLogQu”y::Qu”yByF‹r(): wh”e: % lim™: % off£ˆ%s\n", 
¡rWh”e
.
c_¡r
(), 
lim™
.c_¡r(), 
off£t
.c_str());

164  
Qu”y
(
bË
, 
¡rWh”e
, 
Üd”
, 
lim™
, 
off£t
, 
out_»suÉ
);

167 
boŞ
 
	gEv’tLogQu”y
::
Qu”yIDToSŒšgTabË
(cÚ¡ 
¡d
::
¡ršg
& 
bË
, std::
m­
<, std::¡ršg>& 
out_»suÉ
)

169 
out_»suÉ
.
ş—r
();

171 ià(
	gm_db
.
g‘
(è=ğ
NULL
)

173  
çl£
;

176 
	grc
 = 
SQLITE_OK
;

178 
	g¡d
::
¡ršg
 
sql
 = 
¡ršg_fÜm©
("SELECT * FROM %s;", 
bË
.
c_¡r
());

179 
	g¡d
::
¡ršg
 

;

181 
	gSQL™eObjeù
& 
	gsql™e
 = 
m_db
.
g‘
()->
G‘D©aBa£
();

182 
SQL™eStmt
 
	g¡mt
;

184 
TRACE
("@@@ SQL = % @@@\n", 
sql
.
c_¡r
());

186 
Cr™iÿlSeùiÚLock
 
_ldb
(&(
m_db
.
g‘
()->
G‘Cr™iÿlSeùiÚ
()));

188 
	grc
 = 
sql™e
.
P»·»
(
sql
, 
¡mt
, 

);

189 ià(
	grc
 !ğ
SQLITE_OK
)

191  
çl£
;

194 
	grc
 = 
¡mt
.
S‹p
();

196 
	grc
 =ğ
SQLITE_ROW
)

198 
iID
 = 
¡mt
.
G‘IÁ
(0);

199 
	g¡d
::
¡ršg
 
sDesütiÚ
 = 
¡mt
.
G‘Text
(1);

201 ià(
	gout_»suÉ
.
fšd
(
iID
è=ğ
out_»suÉ
.
’d
())

203 
out_»suÉ
[
iID
] = 
sDesütiÚ
;

206 
	grc
 = 
¡mt
.
S‹p
();

209 ià(
	grc
 !ğ
SQLITE_DONE
)

211  
çl£
;

214  
	gŒue
;

217 
boŞ
 
	gEv’tLogQu”y
::
Qu”y
(cÚ¡ 
¡d
::
¡ršg
& 
bË
, cÚ¡ std::¡ršg& 
wh”e
, cÚ¡ std::¡ršg& 
Üd”
,

218 cÚ¡ 
¡d
::
¡ršg
& 
lim™
, cÚ¡ std::¡ršg& 
off£t
, std::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
)

220 
out_»suÉ
.
ş—r
();

222 ià(
	gm_db
.
g‘
(è=ğ
NULL
)

224  
çl£
;

227 
	grc
 = 
SQLITE_OK
;

229 
	g¡d
::
¡ršg
 
sql
 = 
¡ršg_fÜm©
("SELECT * FROM %s", 
bË
.
c_¡r
());

230 ià(
	gwh”e
 != "")

231 
sql
 +ğ
¡ršg_fÜm©
(" WHERE %s", 
wh”e
.
c_¡r
());

232 ià(
	gÜd”
 != "")

233 
sql
 +ğ
¡ršg_fÜm©
(" ORDER BY %s", 
Üd”
.
c_¡r
());

234 ià(
	glim™
 != "")

235 
sql
 +ğ
¡ršg_fÜm©
(" LIMIT %s", 
lim™
.
c_¡r
());

236 ià(
	goff£t
 != "")

237 
sql
 +ğ
¡ršg_fÜm©
(" OFFSET %s", 
off£t
.
c_¡r
());

238 
	gsql
 += ";";

239 
	g¡d
::
¡ršg
 

;

241 
	gSQL™eObjeù
& 
	gsql™e
 = 
m_db
.
g‘
()->
G‘D©aBa£
();

242 
SQL™eStmt
 
	g¡mt
;

244 
TRACE
("@@@ SQL = % @@@\n", 
sql
.
c_¡r
());

245 
št64_t
 
	gco¡Time
 = 
SYSUTILS_SPACE
::
G‘TimeCouÁMS
();

247 
Cr™iÿlSeùiÚLock
 
_ldb
(&(
m_db
.
g‘
()->
G‘Cr™iÿlSeùiÚ
()));

249 
	grc
 = 
sql™e
.
P»·»
(
sql
, 
¡mt
, 

);

250 ià(
	grc
 !ğ
SQLITE_OK
)

253  
çl£
;

256 
Ev’tLogI‹m
 
	g™em
;

258 
	grc
 = 
¡mt
.
S‹p
();

260 
	grc
 =ğ
SQLITE_ROW
)

263 
™em
.
iLogLev–
 = (
LOG_LEVEL
)
¡mt
.
G‘IÁ
(1);

265 
	g™em
.
	guÎLogTime
 = (
ušt64_t
)
¡mt
.
G‘IÁ64
(2);

267 
	g™em
.
	giTimeZÚe
 = 
¡mt
.
G‘IÁ
(3);

268 
	g™em
.
	giEv’tID
 = (
št32_t
)
¡mt
.
G‘IÁ
(4);

270 
	g™em
.
	giS”v”Ty³
 = (
št32_t
)
¡mt
.
G‘IÁ
(5);

273 
	g™em
.
	guÎS”v”ID
 = (
ušt64_t
)
¡mt
.
G‘IÁ64
(6);

275 
	g™em
.
	giDeviûTy³
 = (
št32_t
)
¡mt
.
G‘IÁ
(7);

277 
	g™em
.
	guÎDeviûID
 = (
ušt64_t
)
¡mt
.
G‘IÁ64
(8);

278 
	g™em
.
	gsDeviûName
 = 
¡mt
.
G‘Text
(9);

279 
	g™em
.
	gsDesütiÚ
 = 
¡mt
.
G‘Text
(10);

280 
	g™em
.
	giIsInScheduË
 = (
št32_t
)
¡mt
.
G‘IÁ
(11);

282 
	gout_»suÉ
.
push_back
(
™em
);

284 
	grc
 = 
¡mt
.
S‹p
();

286 
	gco¡Time
 = 
co¡Time
 - 
SYSUTILS_SPACE
::
G‘TimeCouÁMS
();

287 #ifdeà
SAVESQLCOMMAND


288 
FILE
 *
	gpFe
 = 
fİ’
(
SQLCOMMANDFILE
, "w");

289 ià(
	gpFe
)

291 
årštf
(
pFe
, "@@@ Qu”y SQL = % @@@\n", 
sql
.
c_¡r
());

292 
årštf
(
pFe
, "»suÉ couÁ: %u, co¡Time: %Îd\n", 
out_»suÉ
.
size
(), 
co¡Time
);

293 
fşo£
(
pFe
);

296 ià(
	grc
 !ğ
SQLITE_DONE
)

298  
çl£
;

301  
	gŒue
;

	@../../titanutils/log/EventLogQuery.h

5 #iâdeà
_EVENT_LOG_QUERY_H_


6 
	#_EVENT_LOG_QUERY_H_


	)

7 
	~"commÚ/¡dšt.h
"

8 
	~"expÜts.h
"

10 
	~"Ev’tLogI‹m.h
"

12 
	~"D©aBa£Mªag”.h
"

14 
	~<¡ršg
>

15 
	~<veùÜ
>

16 
	~<m­
>

18 
DLL_PUBLIC
 
	gEv’tSourûID


20 
ušt64_t
 
	g£rv”ID
;

21 
ušt64_t
 
	gdeviûID
;

24 
DLL_PUBLIC
 
	gEv’tLogQu”yF‹r


26 
boŞ
 
	gÚlyQu”yInScheduË
;

27 
ušt64_t
 
	g¡¬tTime
;

28 
ušt64_t
 
	g’dTime
;

29 
	g¡d
::
veùÜ
<
Ev’tSourûID
> 
ev’tSourûIDLi¡
;

30 
	g¡d
::
veùÜ
<
ušt32_t
> 
ev’tIDLi¡
;

32 
Ev’tLogQu”yF‹r
()

33 : 
ÚlyQu”yInScheduË
(
çl£
)

34 , 
¡¬tTime
(
UINT64_C
(0))

35 , 
’dTime
(
UINT64_C
(0))

36 , 
ev’tSourûIDLi¡
()

37 , 
ev’tIDLi¡
()

42 
şass
 
	gEv’tLogDBMªag”
;

43 
şass
 
	gEv’tLogDBMªag”2
;

45 şas 
	cDLL_PUBLIC
 
	mEv’tLogQu”y


47 
ä›nd
 
şass
 
	mEv’tLogDBMªag”
;

48 
ä›nd
 
şass
 
	mEv’tLogDBMªag”2
;

49 
	mpublic
:

50 ~
Ev’tLogQu”y
();

52 
boŞ
 
Qu”yEv’tIDToSŒšgTabË
(
¡d
::
m­
<, std::
¡ršg
>& 
out_»suÉ
);

53 
boŞ
 
Qu”yEÁ™yIDToSŒšgTabË
(
¡d
::
m­
<, std::
¡ršg
>& 
out_»suÉ
);

55 
boŞ
 
Qu”yAÎ
(
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
);

56 
boŞ
 
Qu”yByEv’tID
(
iEv’tID
, 
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
);

57 
boŞ
 
Qu”yByF‹r
(cÚ¡ 
Ev’tLogQu”yF‹r
& 
f‹r
, 
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
,

58 
ušt32_t
 
iS¹Index
, ušt32_ˆ
uiLim™Num
);

59 
boŞ
 
Qu”yByF‹r
(cÚ¡ 
Ev’tLogQu”yF‹r
& 
f‹r
, 
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
);

61 
	m´iv©e
:

62 
Ev’tLogQu”y
(
SYSUTILS_SPACE
::
sm¬t_±r
<
D©aBa£I‹m
> 
db
);

63 
boŞ
 
Qu”yIDToSŒšgTabË
(cÚ¡ 
¡d
::
¡ršg
& 
bË
, std::
m­
<, std::¡ršg>& 
out_»suÉ
);

64 
boŞ
 
Qu”y
(cÚ¡ 
¡d
::
¡ršg
& 
bË
, cÚ¡ std::¡ršg& 
wh”e
, cÚ¡ std::¡ršg& 
Üd”
, cÚ¡ std::¡ršg& 
lim™
,

65 cÚ¡ 
¡d
::
¡ršg
& 
off£t
, std::
veùÜ
<
Ev’tLogI‹m
>& 
out_»suÉ
);

67 
	m´iv©e
:

68 
Ev’tLogQu”y
(cÚ¡ Ev’tLogQu”y& 
rhs
);

69 
	mEv’tLogQu”y
 &
	mİ”©Ü
=(cÚ¡ 
Ev’tLogQu”y
& 
rhs
);

71 
	m´iv©e
:

72 
SYSUTILS_SPACE
::
sm¬t_±r
<
D©aBa£I‹m
> 
m_db
;

	@../../titanutils/log/EventLogRecycler.cpp

1 
	~"Ev’tLogRecyş”.h
"

3 
	~"commÚ/fe.h
"

4 
	~"commÚ/dœeùÜy_Œav”£.h
"

6 
	~<®gÜ™hm
>

7 
	~<™”©Ü
>

8 
	~<li¡
>

10 
	~"log/Ev’tLogDBMªag”.h
"

12 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

14 
DLL_PUBLIC
 
	gEv’tLogRecyş”
::
	$Ev’tLogRecyş”
()

15 : 
	`m_·thÇme
()

16 , 
	`m_cu¼’t_size
(
	`UINT64_C
(0))

17 , 
	`m_max_size
(
	`UINT64_C
(0))

18 , 
	`m_ÿÎback
(
NULL
)

19 , 
	`m_·¿m
(
NULL
)

20 , 
	`m_mÚ™Ü
()

21 , 
	`m_cs
()

22 , 
	$m_fesize
()

24 
	}
}

26 
DLL_PUBLIC
 
	gEv’tLogRecyş”
::~
	$Ev’tLogRecyş”
()

28 
	`Stİ
();

29 
	}
}

31 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogRecyş”
::
	$S¹
(cÚ¡ 
¡d
::
¡ršg
& 
·thÇme
, 
ušt64_t
 
max_size
,

32 
RecyşeC®lback
 
ÿÎback
 , *
·¿m
 )

34 
boŞ
 
»t
 = 
Œue
;

36 
»t
 =„‘ && 
	`Stİ
();

38 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

40 
m_·thÇme
 = 
·thÇme
;

41 
m_cu¼’t_size
 = 
	`UINT64_C
(0);

42 
m_max_size
 = 
max_size
;

43 
m_ÿÎback
 = 
ÿÎback
;

44 
m_·¿m
 = 
·¿m
;

45 
m_fesize
.
	`ş—r
();

47 
DœeùÜyT¿v”£
 
	`dt
(
m_·thÇme
, 
Œue
);

48 
dt
.
	`Next
())

50 ià((
dt
.
	`G‘FÏgs
(è& 
DœeùÜyT¿v”£
::
FLAG_FILE
) != 0)

52 
¡d
::
¡ršg
 
Çme
 = 
dt
.
	`G‘P©hName
();

53 
ušt64_t
 
size
 = 
	`G‘FeStÜageSize
(
Çme
) / 1048576;

54 
m_fesize
[
Çme
] = 
size
;

55 
m_cu¼’t_size
 +ğ
size
;

59 
	`Recyşe
();

61 
»t
 =„‘ && 
m_mÚ™Ü
.
	`S¹
(
m_·thÇme
, 
Ev’tLogRecyş”
::
s_Ev’tLogRecyş”C®lback
, 
this
, 500, 
Œue
);

63  
»t
;

64 
	}
}

66 
DLL_PUBLIC
 
boŞ
 
	gEv’tLogRecyş”
::
	$Stİ
()

68 
boŞ
 
»t
 = 
Œue
;

69 
»t
 = 
m_mÚ™Ü
.
	`Stİ
();

71 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

73 
m_·thÇme
.
	`ş—r
();

74 
m_cu¼’t_size
 = 
	`UINT64_C
(0);

75 
m_max_size
 = 
	`UINT64_C
(0);

76 
m_ÿÎback
 = 
NULL
;

77 
m_·¿m
 = 
NULL
;

78 
m_fesize
.
	`ş—r
();

80  
»t
;

81 
	}
}

83 
	gEv’tLogRecyş”
::
	$s_Ev’tLogRecyş”C®lback
(*
·¿m
, 
DœeùÜyMÚ™Ü
::
I‹m
& 
™em
)

85 
Ev’tLogRecyş”
 *
pThis
 = 
¡©ic_ÿ¡
<Ev’tLogRecyş” *>(
·¿m
);

86 ià(
pThis
 !ğ
NULL
)

88 
pThis
->
	`Ev’tLogRecyş”C®lback
(
™em
);

90 
	}
}

92 
	gEv’tLogRecyş”
::
	$Ev’tLogRecyş”C®lback
(
DœeùÜyMÚ™Ü
::
I‹m
& 
™em
)

94 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

96 
™em
.
ty³
)

98 
DœeùÜyMÚ™Ü
::
I‹m
::
eCREATE
:

100 ià(
	`CheckFeExi¡
(
™em
.
·thÇme
))

102 
ušt64_t
 
size
 = 
	`G‘FeStÜageSize
(
™em
.
·thÇme
) / 1048576;

103 
m_fesize
[
™em
.
·thÇme
] = 
size
;

104 
m_cu¼’t_size
 +ğ
size
;

108 
DœeùÜyMÚ™Ü
::
I‹m
::
eDELETE
:

110 
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
>::
™”©Ü
 
™
 = 
m_fesize
.
	`fšd
(
™em
.
·thÇme
);

111 ià(
™
 !ğ
m_fesize
.
	`’d
())

113 
ušt64_t
 
size
 = 
™
->
£cÚd
;

114 
m_fesize
.
	`”a£
(
™
);

115 
m_cu¼’t_size
 -ğ
size
;

119 
DœeùÜyMÚ™Ü
::
I‹m
::
eMODIFY
:

121 
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
>::
™”©Ü
 
™
 = 
m_fesize
.
	`fšd
(
™em
.
·thÇme
);

122 ià(
™
 !ğ
m_fesize
.
	`’d
())

124 
ušt64_t
 
size
 = 
	`G‘FeStÜageSize
(
™em
.
·thÇme
) / 1048576;

125 
m_cu¼’t_size
 -ğ
™
->
£cÚd
;

126 
m_cu¼’t_size
 +ğ
size
;

127 
™
->
£cÚd
 = 
size
;

137 
	`Recyşe
();

138 
	}
}

140 
	g‹m¶©e
 <
şass
 
	gArg
, cÏs 
	gResuÉ
>

141 
	gG‘Fœ¡
: 
public
 
¡d
::
uÇry_funùiÚ
<
Arg
, 
	gResuÉ
>

143 
ResuÉ
 
İ”©Ü
(è(
Arg
 
	g·œ
è{…aœ.
	gfœ¡
;}

146 
	gEv’tLogRecyş”
::
	$Recyşe
()

148 ià(
m_cu¼’t_size
 > 
m_max_size
)

150 
št64_t
 
ov”æow_size
 = (št64_t)(
m_cu¼’t_size
 - 
m_max_size
);

152 
¡d
::
li¡
<¡d::
¡ršg
> 
fes
;

153 
¡d
::
	`ŒªsfÜm
(
m_fesize
.
	`begš
(), m_fesize.
	`’d
(), std::
	`back_š£¹”
(
fes
),

154 
G‘Fœ¡
<
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
>::
v®ue_ty³
, std::string>());

155 
fes
.
	`sÜt
();

157 
¡d
::
li¡
<¡d::
¡ršg
>::
™”©Ü
 
™
 = 
fes
.
	`begš
(); iˆ!ğfes.
	`’d
(è&& 
ov”æow_size
 > 0; it++)

159 
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
>::
™”©Ü
 
·œ
 = 
m_fesize
.
	`fšd
((*
™
).
	`c_¡r
());

160 ià(
·œ
 !ğ
m_fesize
.
	`’d
())

162 
¡d
::
¡ršg
 
·thÇme
 = 
·œ
->
fœ¡
;

163 
ušt64_t
 
size
 = 
·œ
->
£cÚd
;

164 ià(
	`RemoveFe
(
·thÇme
))

166 
m_fesize
.
	`”a£
(
·œ
);

167 
m_cu¼’t_size
 -ğ
size
;

168 
ov”æow_size
 -ğ
size
;

170 ià(
m_ÿÎback
 !ğ
NULL
)

172 
	`m_ÿÎback
(
m_·¿m
, 
·thÇme
);

178 
	}
}

	@../../titanutils/log/EventLogRecycler.h

1 #iâdeà
__EVENT_LOG_RECYCLER_H__


2 
	#__EVENT_LOG_RECYCLER_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

8 
	~"th»ad_objeù/dœeùÜy_mÚ™Ü.h
"

10 
	~<¡ršg
>

11 
	~<m­
>

13 şas 
	cDLL_PUBLIC
 
	mEv’tLogRecyş”


15 
	mpublic
:

18 
eUnknown
,

19 
	meRecyşeS¹
,

20 
	meRecyşeStİ
,

21 
	meRecyşeSucûss
,

22 
	meRecyşeFa
,

23 } 
	tRecyşeStus
;

24 (*
	tRecyşeC®lback
)(*
	t·¿m
, cÚ¡ 
	t¡d
::
	t¡ršg
& 
	t·thÇme
);

26 
	`Ev’tLogRecyş”
();

27 ~
	`Ev’tLogRecyş”
();

29 
boŞ
 
	`S¹
(cÚ¡ 
¡d
::
¡ršg
& 
·thÇme
, 
ušt64_t
 
max_size
, 
RecyşeC®lback
 
ÿÎback
=
NULL
, *
·¿m
=NULL);

30 
boŞ
 
	`Stİ
();

32 
´iv©e
:

33 
	`Ev’tLogRecyş”
(cÚ¡ 
Ev’tLogRecyş”
& 
rhs
);

34 
Ev’tLogRecyş”
 &
İ”©Ü
=(cÚ¡ Ev’tLogRecyş”& 
rhs
);

36 
	`s_Ev’tLogRecyş”C®lback
(*
·¿m
, 
SYSUTILS_SPACE
::
DœeùÜyMÚ™Ü
::
I‹m
& 
™em
);

37 
	`Ev’tLogRecyş”C®lback
(
SYSUTILS_SPACE
::
DœeùÜyMÚ™Ü
::
I‹m
& 
™em
);

39 
	`Recyşe
();

41 
´iv©e
:

42 
¡d
::
¡ršg
 
m_·thÇme
;

43 
ušt64_t
 
m_cu¼’t_size
;

44 
ušt64_t
 
m_max_size
;

45 
RecyşeC®lback
 
m_ÿÎback
;

46 *
m_·¿m
;

47 
SYSUTILS_SPACE
::
DœeùÜyMÚ™Ü
 
m_mÚ™Ü
;

48 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

49 
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
> 
m_fesize
;

50 
	}
};

	@../../titanutils/log/EventLogRecycler2.cpp

6 
	~"Ev’tLogRecyş”2.h
"

8 
	~"commÚ/fe.h
"

9 
	~"commÚ/dœeùÜy_Œav”£.h
"

10 
	~"commÚ/š‰y³s.h
"

11 
	~"commÚ/¡ršg.h
"

13 
	~<®gÜ™hm
>

14 
	~<™”©Ü
>

15 
	~<li¡
>

17 
	~"log/Ev’tLogDBMªag”.h
"

19 #ifdeà
WIN32


20 
	#SLASH
 "\\"

	)

22 
	#SLASH
 "/"

	)

25 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

28 #ifdeà
DEBUG_RECYCLE


30 
boŞ
 
	g¡_bTe¡FÜûRecyşe
 = 
çl£
;

31 
	g¡_iRemoveOd”
 = 0;

39 şas 
	cCDbFeHŞd”


41 
	mpublic
:

42 
	$CDbFeHŞd”
(è: 
	`m_£rv”_id
(
	`UINT64_C
(0)), 
	`m_·th
(), 
	`m_feSize
(), 
	`m_cu¼’t_size
(
	$UINT64_C
(0)) {};

43 
vœtu®
 ~
	$CDbFeHŞd”
(è{
	}
};

44 
In™Ÿlize
(
_š_
 cÚ¡ 
ušt64_t
 
£rv”_id
, _š_ cÚ¡ 
¡d
::
¡ršg
& 
log_roÙ_·th
);

45 
boŞ
 
	$G‘RecyşeCªdid©e
(
_out_
 & 
d©e_code
, _out_ 
¡d
::
¡ršg
& 
f’ame
, _out_ 
ušt64_t
& 
fe_size
) const;

46 
boŞ
 
	`IsV®idDbF’ame
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
·th
, _š_ cÚ¡ std::¡ršg& 
f’ame
, 
_out_
 & 
d©e_code
);

47 
	`In£¹Fe
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
);

48 
	`RemoveFe
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
);

49 
	`ModifyFe
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
);

51 
public
:

52 
ušt64_t
 
m_£rv”_id
;

53 
¡d
::
¡ršg
 
m_·th
;

54 
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
> 
m_feSize
;

55 
ušt64_t
 
m_cu¼’t_size
;

56 
	}
};

58 
	gCDbFeHŞd”
::
	$In™Ÿlize
(
_š_
 cÚ¡ 
ušt64_t
 
£rv”_id
,

59 
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
log_roÙ_·th
)

61 
m_£rv”_id
 = 
£rv”_id
;

62 
m_·th
 = 
log_roÙ_·th
 + 
	`¡ršg_fÜm©
("%s" "%016" 
PRIX64
, 
SLASH
, 
£rv”_id
);

63 
m_feSize
.
	`ş—r
();

64 
m_cu¼’t_size
 = 
	`UINT64_C
(0);

67 
DœeùÜyT¿v”£
 
	`dt
(
m_·th
, 
Œue
);

68 
dt
.
	`Next
())

70 ià((
dt
.
	`G‘FÏgs
(è& 
DœeùÜyT¿v”£
::
FLAG_FILE
) != 0)

72 cÚ¡ 
¡d
::
¡ršg
 
Çme
 = 
dt
.
	`G‘P©hName
();

73 cÚ¡ 
ušt64_t
 
size
 = 
	`G‘FeStÜageSize
(
Çme
);

74 #ifdeà
DEBUG_RECYCLE


75 
	`´štf
("[»cyşe] dbÇme: %s, size: %Îu, size: %Îu MB\n", 
Çme
.
	`c_¡r
(), 
	`G‘FeStÜageSize
Òame), 
size
 );

77 
m_feSize
[
Çme
] = 
size
;

78 
m_cu¼’t_size
 +ğ
size
;

81 
	}
}

83 
boŞ
 
	gCDbFeHŞd”
::
	$G‘RecyşeCªdid©e
(
_out_
 & 
d©e_code
,

84 
_out_
 
¡d
::
¡ršg
& 
f’ame
,

85 
_out_
 
ušt64_t
& 
fe_size
) const

87 
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
>::
cÚ¡_™”©Ü
 
™
 = 
m_feSize
.
	`begš
();

88 
™
 !ğ
m_feSize
.
	`’d
();

89 
™
++)

91 ià(
	`IsV®idDbF’ame
(
m_·th
, 
™
->
fœ¡
, 
d©e_code
))

93 
f’ame
 = 
™
->
fœ¡
;

94 
fe_size
 = 
™
->
£cÚd
;

95  
Œue
;

99 
d©e_code
 = 0;

100 
f’ame
 = 
™
->
fœ¡
;

101 
fe_size
 = 
™
->
£cÚd
;

102  
Œue
;

106  
çl£
;

107 
	}
}

109 
boŞ
 
	gCDbFeHŞd”
::
	$IsV®idDbF’ame
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
·th
, _š_ cÚ¡ std::¡ršg& 
f’ame
, 
_out_
 & 
d©e_code
)

112 
d©e_code
 = 0;

114 ià((
·th
.
	`size
(è+ 12è!ğ
f’ame
.size() && (path.size() + 20) != filename.size())

116  
çl£
;

119 cÚ¡ * 
p
 = 
f’ame
.
	`c_¡r
(è+ (f’ame.
	`size
() - 1);

120 cÚ¡ * 
pJouº®
 = 
f’ame
.
	`c_¡r
(è+ (f’ame.
	`size
() - 1);

121 
boŞ
 
bNÙDBExt
 = (*
p
-- != 'b' || *p-- != 'd' || *p-- != '.');

122 
boŞ
 
bNÙDBJExt
 = (*
pJouº®
-- != 'l' || *pJournal-- != 'a' || *pJournal-- != 'n' || *pJournal-- != 'r' || *pJournal-- != 'u'

123 || *
pJouº®
-- !ğ'o' || *pJouº®-- !ğ'j' || *pJouº®-- !ğ'-' || *
p
-- != 'b' || *pJournal-- != 'd' || *pJournal-- != '.' );

124 iàĞ
bNÙDBExt
 && 
bNÙDBJExt
 )

126  
çl£
;

129 cÚ¡ * 
pD©e
 = 
NULL
;

130 ià(!
bNÙDBExt
)

132 
pD©e
 = 
p
;

134 ià(!
bNÙDBJExt
)

136 
pD©e
 = 
pJouº®
;

139 
i
 = 0; i < 8; i++)

141 ià(*
pD©e
 < '0' || *pDate > '9')

143  
çl£
;

145 
pD©e
--;

148 
y—r
 = 0;

149 
mÚth
 = 0;

150 
day
 = 0;

151 ià(3 !ğ
	`ssÿnf
(
pD©e
 + 1, "%04d%02d%02d.db", &
y—r
, &
mÚth
, &
day
))

153  
çl£
;

157 
d©e_code
 = 
Ev’tLogRecyş”2
::
	`C®cD©eCode
(
y—r
, 
mÚth
, 
day
);

159  
Œue
;

160 
	}
}

162 
	gCDbFeHŞd”
::
	$In£¹Fe
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
)

164 ià(
	`CheckFeExi¡
(
f’ame
))

166 
	`RemoveFe
(
f’ame
);

168 cÚ¡ 
ušt64_t
 
size
 = 
	`G‘FeStÜageSize
(
f’ame
);

169 
m_feSize
[
f’ame
] = 
size
;

170 
m_cu¼’t_size
 +ğ
size
;

172 
	}
}

174 
	gCDbFeHŞd”
::
	$RemoveFe
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
)

176 
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
>::
™”©Ü
 
™
 = 
m_feSize
.
	`fšd
(
f’ame
);

177 ià(
™
 !ğ
m_feSize
.
	`’d
())

179 ià(
m_cu¼’t_size
 >ğ
™
->
£cÚd
)

181 
m_cu¼’t_size
 -ğ
™
->
£cÚd
;

185 
m_cu¼’t_size
 = 
	`UINT64_C
(0);

188 
m_feSize
.
	`”a£
(
™
);

190 
	}
}

192 
	gCDbFeHŞd”
::
	$ModifyFe
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
)

194 
¡d
::
m­
<¡d::
¡ršg
, 
ušt64_t
>::
™”©Ü
 
™
 = 
m_feSize
.
	`fšd
(
f’ame
);

195 ià(
™
 !ğ
m_feSize
.
	`’d
())

197 ià(
m_cu¼’t_size
 >ğ
™
->
£cÚd
)

199 
m_cu¼’t_size
 -ğ
™
->
£cÚd
;

203 
m_cu¼’t_size
 = 
	`UINT64_C
(0);

206 cÚ¡ 
ušt64_t
 
size
 = 
	`G‘FeStÜageSize
(
f’ame
);

207 
m_cu¼’t_size
 +ğ
size
;

208 
™
->
£cÚd
 = 
size
;

210 
	}
}

215 
DLL_PUBLIC
 
	gEv’tLogRecyş”2
::
	$Ev’tLogRecyş”2
()

216 : 
	`m_mÚ™Ü
()

217 , 
	`m_cs
()

218 , 
	`m_log_roÙ_·th
()

219 , 
	`m_rg‘_£rv”_id
(
	`UINT64_C
(0))

220 , 
	`m_max_size
(
	`UINT64_C
(0))

221 , 
	`m_ÿÎback
(
NULL
)

222 , 
	`m_·¿m
(
NULL
)

223 , 
	$m_dbm­
()

225 
	}
}

227 
DLL_PUBLIC
 
	gEv’tLogRecyş”2
::~
	$Ev’tLogRecyş”2
()

229 
	`Stİ
();

230 
	}
}

232 
	gEv’tLogRecyş”2
::
	$CË¬
()

234 
m_log_roÙ_·th
.
	`ş—r
();

235 
m_rg‘_£rv”_id
 = 
	`UINT64_C
(0);

236 
m_max_size
 = 
	`UINT64_C
(0);

237 
m_ÿÎback
 = 
NULL
;

238 
m_·¿m
 = 
NULL
;

239 
m_dbm­
.
	`ş—r
();

240 
	}
}

242 
boŞ
 
	gEv’tLogRecyş”2
::
	$S¹
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
log_roÙ_·th
,

243 
_š_
 
ušt64_t
 
rg‘_£rv”_id
,

244 
_š_
 
ušt64_t
 
max_size
,

245 
_š_
 
RecyşeC®lback
 
ÿÎback
,

246 
_š_
 * 
·¿m
)

248 
boŞ
 
»t
 = 
Œue
;

250 
»t
 =„‘ && 
	`Stİ
();

252 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

254 
	`CË¬
();

257 cÚ¡ 
¡d
::
¡ršg
 
rg‘_id_·th
 = 
log_roÙ_·th
 + 
	`¡ršg_fÜm©
("%s" "%016" 
PRIX64
, 
SLASH
, 
rg‘_£rv”_id
);

258 ià(!
	`CheckFeExi¡
(
rg‘_id_·th
))

260 
	`MakeDœeùÜy
(
rg‘_id_·th
);

264 ià(!
	`Brow£
(
log_roÙ_·th
, &
m_dbm­
))

266  
çl£
;

270 
m_log_roÙ_·th
 = 
log_roÙ_·th
;

271 
m_rg‘_£rv”_id
 = 
rg‘_£rv”_id
;

272 
m_max_size
 = 
max_size
 * 1048576;

273 
m_ÿÎback
 = 
ÿÎback
;

274 
m_·¿m
 = 
·¿m
;

276 
	`Recyşe
();

278 
»t
 =„‘ && 
m_mÚ™Ü
.
	`S¹
(
m_log_roÙ_·th
, 
Ev’tLogRecyş”2
::
s_Ev’tLogRecyş”C®lback
, 
this
, 500, 
Œue
);

280  
»t
;

281 
	}
}

283 
boŞ
 
	gEv’tLogRecyş”2
::
	$Stİ
()

285 
boŞ
 
»t
 = 
m_mÚ™Ü
.
	`Stİ
();

287 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

289 
	`CË¬
();

291  
»t
;

292 
	}
}

294 
	gEv’tLogRecyş”2
::
	$C®cD©eCode
(
_š_
 
y—r
, _š_ 
mÚth
, _š_ 
day
)

296  
y—r
 * 10000 + 
mÚth
 * 100 + 
day
;

297 
	}
}

299 
	gEv’tLogRecyş”2
::
	$s_Ev’tLogRecyş”C®lback
(
_š_
 * 
·¿m
, _š_ 
SYSUTILS_SPACE
::
DœeùÜyMÚ™Ü
::
I‹m
& 
™em
)

301 
Ev’tLogRecyş”2
* 
pThis
 = 
¡©ic_ÿ¡
<Ev’tLogRecyş”2*>(
·¿m
);

302 ià(
pThis
 !ğ
NULL
)

304 
pThis
->
	`Ev’tLogRecyş”C®lback
(
™em
);

306 
	}
}

308 
	gEv’tLogRecyş”2
::
	$Ev’tLogRecyş”C®lback
(
_š_
 
SYSUTILS_SPACE
::
DœeùÜyMÚ™Ü
::
I‹m
& 
™em
)

310 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

313 
¡d
::
m­
<
ušt64_t
, 
CDbFeHŞd”
>::
™”©Ü
 
™
;

314 
™
 = 
m_dbm­
.
	`begš
(); iˆ!ğm_dbm­.
	`’d
(); it++)

318 cÚ¡ 
¡d
::
¡ršg
 
fmt
 = 
™
->
£cÚd
.
m_·th
 + std::
	`¡ršg
(
SLASH
);

320 iàĞ(
™em
.
·thÇme
.
	`size
(è> 
fmt
.size()) &&

321 (0 =ğ
	`memcmp
(
™em
.
·thÇme
.
	`c_¡r
(), 
fmt
.c_¡r(), fmt.
	`size
())) )

327 ià(
™
 !ğ
m_dbm­
.
	`’d
())

329 
™em
.
ty³
)

331 
DœeùÜyMÚ™Ü
::
I‹m
::
eCREATE
:

333 
™
->
£cÚd
.
	`In£¹Fe
(
™em
.
·thÇme
);

334 #ifdeà
DEBUG_RECYCLE


335 
	`´štf
("[»cyşe] mÚ™Ü c»©fe: %s\n", 
™em
.
·thÇme
.
	`c_¡r
());

339 
DœeùÜyMÚ™Ü
::
I‹m
::
eDELETE
:

341 
™
->
£cÚd
.
	`RemoveFe
(
™em
.
·thÇme
);

342 #ifdeà
DEBUG_RECYCLE


343 
	`´štf
("[»cyşe] mÚ™ÜƒDELETE fe: %s\n", 
™em
.
·thÇme
.
	`c_¡r
());

347 
DœeùÜyMÚ™Ü
::
I‹m
::
eMODIFY
:

349 
™
->
£cÚd
.
	`ModifyFe
(
™em
.
·thÇme
);

350 #ifdeà
DEBUG_RECYCLE


351 
	`´štf
("[»cyşe] mÚ™ÜƒMODIFY fe: %s\n", 
™em
.
·thÇme
.
	`c_¡r
());

362 
	`Recyşe
();

363 
	}
}

365 
	gEv’tLogRecyş”2
::
	$Recyşe
()

367 cÚ¡ 
ušt64_t
 
tÙ®_size
 = 
	`G‘TÙ®Size
(
m_dbm­
);

369 
¡d
::
veùÜ
< std::
·œ
<
ušt64_t
, std::
¡ršg
> > 
ç_li¡
;

370 
ç_li¡
.
	`ş—r
();

372 #ifdeà
DEBUG_RECYCLE


373 
FILE
 *
pFe
 = 
	`fİ’
("/tmp/forcerecycle", "r");

374 ià(
pFe
)

376 
¡_bTe¡FÜûRecyşe
 = 
Œue
;

377 
m_max_size
 = 
tÙ®_size
 - 1;

378 
	`fşo£
(
pFe
);

379 
pFe
 = 
NULL
;

383 ià(
tÙ®_size
 > 
m_max_size
)

385 
št64_t
 
ov”æow_size
 = (št64_t)(
tÙ®_size
 - 
m_max_size
);

387 
ušt64_t
 
l_£rv”_id
 = 
	`UINT64_C
(0);

388 
¡d
::
¡ršg
 
l_f’ame
;

389 
ušt64_t
 
l_fe_size
 = 
	`UINT64_C
(0);

391 #ifdeà
DEBUG_RECYCLE


392 
couÁ
 = 1;

393 
	`´štf
("[»cyşe]Ù® size: %Îu, max size: %Îu, ov”æow size: %Îd\n", 
tÙ®_size
, 
m_max_size
, 
ov”æow_size
);

394 
couÁ
 = 1;

396 (
ov”æow_size
 > 
	`INT64_C
(0)è&& 
	`PİRecyşeCªdid©e
(
m_dbm­
, 
l_£rv”_id
, 
l_f’ame
, 
l_fe_size
))

398 #ifdeà
DEBUG_RECYCLE


399 
	`´štf
("[»cyşe] od”: %d,„emov%d cªdid©fe: %s, size: %Îu\n", 
¡_iRemoveOd”
++, 
couÁ
++, 
l_f’ame
.
	`c_¡r
(), 
l_fe_size
);

400 
ov”æow_size
 -ğ(
št64_t
)
l_fe_size
;

402 
	`´štf
("[»cyşe] ov”æow size: %Îd\n", 
ov”æow_size
);

405 ià(
	`RemoveFe
(
l_f’ame
))

407 
ov”æow_size
 -ğ(
št64_t
)
l_fe_size
;

409 ià(
m_ÿÎback
 !ğ
NULL
)

411 
	`m_ÿÎback
(
m_·¿m
, 
l_£rv”_id
, 
l_f’ame
);

416 
ç_li¡
.
	`push_back
(
¡d
::
	`make_·œ
(
l_£rv”_id
, 
l_f’ame
));

423 ià(
ç_li¡
.
	`size
() > 0)

425 
¡d
::
veùÜ
< std::
·œ
<
ušt64_t
, std::
¡ršg
> >::
cÚ¡_™”©Ü
 
™
 = 
ç_li¡
.
	`begš
();

426 
™
 !ğ
ç_li¡
.
	`’d
();

427 
™
++)

429 
m_dbm­
[
™
->
fœ¡
].
	`In£¹Fe
(™->
£cÚd
);

432 
	}
}

434 
boŞ
 
	gEv’tLogRecyş”2
::
Brow£
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
log_roÙ_·th
, 
_out_
 std::
m­
<
ušt64_t
, 
CDbFeHŞd”
>* 
dbm­
)

437 
	gdbm­
->
ş—r
();

439 
DœeùÜyT¿v”£
 
dt
(
log_roÙ_·th
, 
çl£
);

440 
	gdt
.
Next
())

442 ià((
	gdt
.
G‘FÏgs
(è& 
	gDœeùÜyT¿v”£
::
FLAG_DIRECTORY
) != 0)

444 cÚ¡ 
¡d
::
¡ršg
 
dœÇme
 = 
dt
.
G‘P©hName
();

449 #ifdeà
DEBUG_RECYCLE


450 
´štf
("[»cyşe] brow£hfŞd”: %s\n", 
dœÇme
.
c_¡r
() );

452 cÚ¡ 
ušt64_t
 
	g£rv”_id
 = 
G‘S”v”Id
(
log_roÙ_·th
, 
dœÇme
);

453 ià(
UINT64_C
(0è!ğ
£rv”_id
)

455 
¡d
::
·œ
<¡d::
m­
<
ušt64_t
, 
CDbFeHŞd”
>::
™”©Ü
, 
boŞ
> 
»t
 =

456 
dbm­
->
š£¹
Ğ
¡d
::
·œ
<
ušt64_t
, 
CDbFeHŞd”
>(
£rv”_id
, CDbFileHolder()) );

458 ià(
	g»t
.
	g£cÚd
)

460 
	g»t
.
	gfœ¡
->
	g£cÚd
.
In™Ÿlize
(
£rv”_id
, 
log_roÙ_·th
);

461 #ifdeà
DEBUG_RECYCLE


462 
´štf
("[»cyşe] brow£hfŞd”: s”v”id: %Îu,†og…©h: %s, size: %Îu\n", 
£rv”_id
, 
log_roÙ_·th
.
c_¡r
(), 
»t
.
fœ¡
->
£cÚd
.
m_cu¼’t_size
);

467 
	gdbm­
->
ş—r
();

468  
	gçl£
;

474  
	gŒue
;

477 
ušt64_t
 
	gEv’tLogRecyş”2
::
	$G‘S”v”Id
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
log_roÙ_·th
, _š_ cÚ¡ std::¡ršg& 
dœÇme
)

479 ià(
dœÇme
.
	`size
(è!ğ(
log_roÙ_·th
.size() + 17))

481  
	`UINT64_C
(0);

483 cÚ¡ * 
p
 = 
dœÇme
.
	`c_¡r
(è+ (dœÇme.
	`size
() - 1);

484 
i
 = 0; i < 16; i++)

486 ià(!((*
p
 >= '0' && *p <= '9') || (*p >= 'A' && *p <= 'F')))

488  
	`UINT64_C
(0);

491 
p
--;

494 
ušt64_t
 
£rv”_id
 = 
	`UINT64_C
(0);

495 ià(1 =ğ
	`ssÿnf
(
p
 + 1, "%016" 
PRIX64
, &
£rv”_id
))

497  
£rv”_id
;

500  
	`UINT64_C
(0);

501 
	}
}

503 
ušt64_t
 
	gEv’tLogRecyş”2
::
G‘TÙ®Size
(
_š_
 
¡d
::
m­
<ušt64_t, 
CDbFeHŞd”
>& 
dbm­
)

505 
ušt64_t
 
	gtÙ®_size
 = 
UINT64_C
(0);

507 
	g¡d
::
m­
<
ušt64_t
, 
	gCDbFeHŞd”
>::
cÚ¡_™”©Ü
 
™
 = 
dbm­
.
begš
();

508 
	g™
 !ğ
dbm­
.
’d
();

509 
	g™
++)

511 
	gtÙ®_size
 +ğ
™
->
£cÚd
.
m_cu¼’t_size
;

514  
	gtÙ®_size
;

517 
boŞ
 
	gEv’tLogRecyş”2
::
PİRecyşeCªdid©e
(
_š_
 
¡d
::
m­
<
ušt64_t
, 
CDbFeHŞd”
>& 
dbm­
,

518 
_out_
 
ušt64_t
& 
£rv”_id
, _out_ 
¡d
::
¡ršg
& 
f’ame
, _out_ ušt64_t& 
fe_size
)

521 
	g£rv”_id
 = 
UINT64_C
(0);

522 
	gf’ame
.
ş—r
();

523 
	gfe_size
 = 
UINT64_C
(0);

525 
boŞ
 
	gbIn™Ÿlized
 = 
çl£
;

526 
	gd©e_code
 = 0;

528 
	g¡d
::
m­
<
ušt64_t
, 
	gCDbFeHŞd”
>::
cÚ¡_™”©Ü
 
™
 = 
dbm­
.
begš
();

529 
	g™
 !ğ
dbm­
.
’d
();

530 
	g™
++)

532 
	gl_d©e_code
 = 0;

533 
	g¡d
::
¡ršg
 
l_f’ame
;

534 
ušt64_t
 
	gl_fe_size
 = 
UINT64_C
(0);

536 ià(
	g™
->
	g£cÚd
.
G‘RecyşeCªdid©e
(
l_d©e_code
, 
l_f’ame
, 
l_fe_size
))

538 ià(!
	gbIn™Ÿlized
 ||

539 (
	gd©e_code
 > 
	gl_d©e_code
))

541 
	gbIn™Ÿlized
 = 
Œue
;

542 
	gd©e_code
 = 
l_d©e_code
;

544 
	g£rv”_id
 = 
™
->
fœ¡
;

545 
	gf’ame
 = 
l_f’ame
;

546 
	gfe_size
 = 
l_fe_size
;

551 ià(
	gbIn™Ÿlized
)

553 
	gdbm­
[
£rv”_id
].
RemoveFe
(
f’ame
);

556  
	gbIn™Ÿlized
;

	@../../titanutils/log/EventLogRecycler2.h

6 #iâdeà
_EVENT_LOG_RECYCLER_2_H_


7 
	#_EVENT_LOG_RECYCLER_2_H_


	)

9 
	~"expÜts.h
"

11 
	~"commÚ/¡dšt.h
"

12 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

13 
	~"th»ad_objeù/dœeùÜy_mÚ™Ü.h
"

15 
	~<¡ršg
>

16 
	~<m­
>

18 #iâdeà
_š_


19 
	#_š_


	)

20 
	#_out_


	)

21 
	#_šout_


	)

24 
şass
 
	gCDbFeHŞd”
;

26 şas 
	cDLL_PUBLIC
 
	mEv’tLogRecyş”2


28 
	mpublic
:

31 
eUnknown
,

32 
	meRecyşeS¹
,

33 
	meRecyşeStİ
,

34 
	meRecyşeSucûss
,

35 
	meRecyşeFa
,

36 } 
	tRecyşeStus
;

38 (*
	tRecyşeC®lback
)(
	t_š_
 * 
	t·¿m
, _š_ 
	tušt64_t
 
	t£rv”_id
, _š_ cÚ¡ 
	t¡d
::
	t¡ršg
& 
	tf’ame
);

40 
	`Ev’tLogRecyş”2
();

41 
vœtu®
 ~
	`Ev’tLogRecyş”2
();

43 
boŞ
 
	`S¹
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
log_roÙ_·th
,

44 
_š_
 
ušt64_t
 
rg‘_£rv”_id
,

45 
_š_
 
ušt64_t
 
max_size
,

46 
_š_
 
RecyşeC®lback
 
ÿÎback
 = 
NULL
,

47 
_š_
 * 
·¿m
 = 
NULL
);

48 
boŞ
 
	`Stİ
();

50 
	`C®cD©eCode
(
_š_
 
y—r
, _š_ 
mÚth
, _š_ 
day
);

52 
´iv©e
:

53 
	`Ev’tLogRecyş”2
(cÚ¡ 
Ev’tLogRecyş”2
& 
rhs
);

54 
Ev’tLogRecyş”2
 &
İ”©Ü
=(cÚ¡ Ev’tLogRecyş”2& 
rhs
);

56 
	`CË¬
();

58 
SYSUTILS_SPACE
::
DœeùÜyMÚ™Ü
 
m_mÚ™Ü
;

60 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

61 
¡d
::
¡ršg
 
m_log_roÙ_·th
;

62 
ušt64_t
 
m_rg‘_£rv”_id
;

63 
ušt64_t
 
m_max_size
;

64 
RecyşeC®lback
 
m_ÿÎback
;

65 * 
m_·¿m
;

66 
¡d
::
m­
<
ušt64_t
, 
CDbFeHŞd”
> 
m_dbm­
;

68 
	`s_Ev’tLogRecyş”C®lback
(
_š_
 * 
·¿m
, _š_ 
SYSUTILS_SPACE
::
DœeùÜyMÚ™Ü
::
I‹m
& 
™em
);

69 
	`Ev’tLogRecyş”C®lback
(
_š_
 
SYSUTILS_SPACE
::
DœeùÜyMÚ™Ü
::
I‹m
& 
™em
);

71 
	`Recyşe
();

73 
boŞ
 
	`Brow£
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
log_roÙ_·th
, 
_out_
 std::
m­
<
ušt64_t
, 
CDbFeHŞd”
>* 
dbm­
);

74 
ušt64_t
 
	`G‘S”v”Id
(
_š_
 cÚ¡ 
¡d
::
¡ršg
& 
log_roÙ_·th
, _š_ cÚ¡ std::¡ršg& 
dœÇme
);

75 
ušt64_t
 
	`G‘TÙ®Size
(
_š_
 
¡d
::
m­
<ušt64_t, 
CDbFeHŞd”
>& 
dbm­
);

76 
boŞ
 
	`PİRecyşeCªdid©e
(
_š_
 
¡d
::
m­
<
ušt64_t
, 
CDbFeHŞd”
>& 
dbm­
,

77 
_out_
 
ušt64_t
& 
£rv”_id
, _out_ 
¡d
::
¡ršg
& 
f’ame
, _out_ ušt64_t& 
fe_size
);

78 
	}
};

	@../../titanutils/log/Log.h

1 #iâdeà
__TITAN_LOG_H__


2 
	#__TITAN_LOG_H__


	)

4 
	eE_LOG_LEVEL


6 
	meLOG_BEGIN
 = 0,

8 
	meLOG_DEBUG
 = 0,

9 
	meLOG_INFO
 = 1,

10 
	meLOG_NOTICE
 = 2,

11 
	meLOG_WARNING
 = 3,

12 
	meLOG_CRIT
 = 4,

14 
	meLOG_LAST


15 } 
	tLOG_LEVEL
;

	@../../titanutils/log/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../../titanutils/schedule/ActiveTable.h

1 #iâdeà
__ACTIVETABLE_H__


2 
	#__ACTIVETABLE_H__


	)

4 
	~<¡ršg.h
>

5 
	~<¡dlib.h
>

6 
	~<”ºo.h
>

8 
	~"debugMsg/Debug.h
"

10 
	#TOTAL_MINUTES_IN_A_DAY
 1440

	)

12 #ifdeà
WIN32


13 
	#ENODATA
 61

	)

14 
	#ETIME
 62

	)

17 
Çme¥aû
 
	gScheduË
 {

19 şas 
	cAùiveTabË
 {

20 
	gpublic
:

21 
ex¶ic™
 
AùiveTabË
()

22 : 
bË
(
NULL
), 
»Ï‹d_obj
(NULL), 
bË_size
(0), 
bË_masked
(0), 
bË_®loÿ‹d
(0),

23 
tick1
(0), 
tick2
(0)

25 
ü—‹_bË
(
TOTAL_MINUTES_IN_A_DAY
);

26 
Re£t
();

29 
ex¶ic™
 
AùiveTabË
(
size
)

30 : 
bË
(
NULL
), 
»Ï‹d_obj
(NULL), 
bË_size
(
size
), 
bË_masked
(0), 
bË_®loÿ‹d
(0),

31 
tick1
(0), 
tick2
(0)

33 ià(
	gsize
>0)

35 
ü—‹_bË
(
size
);

36 
Re£t
();

40 
	gvœtu®
 ~
AùiveTabË
()

42 
d–‘e_bË
();

45 
šlše
 
boŞ
 
IsFuÎFl
() const

47  (
	gbË_size
 =ğ
bË_masked
);

50 
šlše
 
G‘La¡E¼Ü
(ècÚ¡ {  
	gÏ¡_”rÜ
; }

52 
šlše
 
vœtu®
 
S‘Tick
(
t1
, 
t2
) {}

53 
šlše
 
vœtu®
 
G‘Tick
(*
t1
, *
t2
è{ ià(
	gt1
!=
NULL
è*t1 = 
tick1
; ià(
	gt2
!=NULLè*t2 = 
tick2
; }

55 
šlše
 
boŞ
 
C»©eTabË
(
size
, boŞ 
is_shršk
)

57 
	gcu¼_size
 = 0;

59 ià(
IsTabËExi¡ed
())

61 
	gcu¼_size
 = 
G‘TabËAùu®Size
();

62 iàĞ
	gcu¼_size
<
	gsize


63 || (
	gcu¼_size
>
	gsize
 && 
	gis_shršk
) )

65 
d–‘e_bË
();

68  
	gŒue
;

71 
ü—‹_bË
(
size
);

73  
IsTabËExi¡ed
();

76 
šlše
 
boŞ
 
G‘Pos™iÚ
(cÚ¡ 
n
, *
v®
, **
obj
) const {

77 ià(
	gNULL
 =ğ
bË
è{ 
Ï¡_”rÜ
 = 
ENODATA
;  
	gçl£
; }

78 ià(
	gNULL
 =ğ
»Ï‹d_obj
è{ 
Ï¡_”rÜ
 = 
ENODATA
;  
	gçl£
; }

79 ià(
	gNULL
 =ğ
v®
è{ 
Ï¡_”rÜ
 = 
EINVAL
;  
	gçl£
; }

80 ià(!
IsInTickRªge
(
n
)è{ 
	gÏ¡_”rÜ
 = 
ETIME
;  
	gçl£
; }

82 
	gº
 = 
G‘R—lPos™iÚ
(
n
);

83 ià(
	gº
<0 ||„n>
	gbË_size
è{ 
	gÏ¡_”rÜ
 = 
EFAULT
;  
	gçl£
; }

85 *
	gv®
 = 
bË
[
º
];

86 ià(
	gobj
!=
NULL
)

87 *
obj
 = 
»Ï‹d_obj
[
º
];

89  
	gŒue
;

92 
šlše
 
S‘Rªge
(
¡¬t
, 
’d
, *
obj
)

94 
do_£t_v®ue
(
¡¬t
, 
’d
, 1, 
obj
);

97 
šlše
 
Inv®idRªge
(
¡¬t
, 
’d
, *
obj
)

99 
do_£t_v®ue
(
¡¬t
, 
’d
, -1, 
obj
);

102 
šlše
 
Re£t
()

104 
	gbË_masked
 = 0;

105 ià(
	gbË_®loÿ‹d
>0)

107 ià(
	gbË
!=
NULL
)

108 
mem£t
(
bË
, 0, 
bË_®loÿ‹d
*());

109 ià(
	g»Ï‹d_obj
!=
NULL
)

110 
mem£t
(
»Ï‹d_obj
, 0, 
bË_®loÿ‹d
*(*));

114 
šlše
 
CouÁMasked
()

116 
	gcouÁ
=0;

118 ià(!
IsTabËExi¡ed
())

121 
	gi
=0, 
	gcouÁ
=0; i<
	gbË_size
; ++i)

123 ià(
	gbË
[
i
]!=0è++
couÁ
;

124 ià(
	gcouÁ
>=
bË_size
) ;

126 
	gbË_masked
 = 
couÁ
;

129 
	g´Ùeùed
:

130 
šlše
 
vœtu®
 
boŞ
 
IsInTickRªge
(
n
ècÚ¡ {  
Œue
; }

131 
šlše
 
vœtu®
 
G‘R—lPos™iÚ
(
n
ècÚ¡ {  
	gn
; }

133 
šlše
 
vœtu®
 
do_£t_v®ue
(
¡¬t
, 
’d
, 
v®
, *
obj
)

135 
	gs
, 
	ge
;

136 *
	gp1
, *
	gp2
;

137 **
	go1
;

140 ià(
	gbË
!=
NULL
 && 
bË_size
>0)

142 
s
 = 
¡¬t
;

143 
	ge
 = 
’d
;

144 ià(
	gs
<0) s = 0;

145 ià(
	ge
>=
bË_size
è
e
 =able_size-1;

147 
	gp1
 = 
bË
+
s
; 
	go1
 = 
»Ï‹d_obj
+s;

148 
	gp2
 = 
bË
+
e
+1;

150 ià(0 !ğ
v®
)

152 
p1
<
p2
)

154 ià(0 =ğ*
p1
)

157 *
p1
 = 
v®
;

158 *
	go1
 = 
obj
;

160 ++
	gp1
;

161 ++
	go1
;

166 
ASSERT
(0);

178 
šlše
 
ü—‹_bË
(
size
)

180 
	gtmp_size
;

181 
	gk
;

184 ià(
	gbË
!=
NULL
)

186 ià(
bË_®loÿ‹d
>=
size
)

188 
bË_size
 = 
size
;

191 
d–‘e_bË
();

194 ià(
	gsize
<1) ;

197 
	gk
 = 
size
 & 0x03;

198 
	gtmp_size
 = 
size
 + ((4-
k
) & 0x03);

201 
	gbË
 = 
Ãw
 [
tmp_size
];

202 ià(
	gbË
!=
NULL
)

204 
bË_size
 = 
size
;

205 
	gbË_®loÿ‹d
 = 
tmp_size
;

206 
	g»Ï‹d_obj
 = 
Ãw
 *[
tmp_size
];

210 
šlše
 
d–‘e_bË
()

212 ià(
	gbË
!=
NULL
)

213 
d–‘e
 [] 
bË
;

215 ià(
	g»Ï‹d_obj
!=
NULL
)

216 
d–‘e
 [] 
»Ï‹d_obj
;

218 
	gbË
 = 
NULL
;

219 
	g»Ï‹d_obj
 = 
NULL
;

220 
	gbË_size
 = 0;

221 
	gbË_masked
 = 0;

222 
	gbË_®loÿ‹d
 = 0;

225 
šlše
 
G‘TabËSize
(ècÚ¡ {  
	gbË_size
; }

226 
šlše
 
G‘TabËAùu®Size
(ècÚ¡ {  
	gbË_®loÿ‹d
; }

227 
šlše
 
boŞ
 
IsTabËExi¡ed
(ècÚ¡ {  (
	gbË
!=
NULL
 && 
bË_size
>0); }

229 
	g´Ùeùed
:

230 
mubË
 
Ï¡_”rÜ
;

232 *
	gbË
;

233 **
	g»Ï‹d_obj
;

234 
	gbË_size
;

235 
	gbË_masked
;

236 
	gbË_®loÿ‹d
;

237 
	gtick1
;

238 
	gtick2
;

241 şas 
	cAd­tiveAùiveTabË
 : 
public
 
AùiveTabË


243 
public
:

244 
ex¶ic™
 
Ad­tiveAùiveTabË
()

245 : 
AùiveTabË
(0), 
fuÎ_size
(0)

249 
	gvœtu®
 ~
Ad­tiveAùiveTabË
()

251 
d–‘e_bË
();

254 
šlše
 
S‘Tick
(
t1
, 
t2
è{ 
	gtick1
 =1; 
	gtick2
 =2; ià(
	gt2
<
	gt1
) {ick1 =2;ick2 =1; } }

256 
	g´Ùeùed
:

257 
šlše
 
boŞ
 
IsInTickRªge
(
n
ècÚ¡ {  (n>=
tick1
 &&‚<
tick2
); }

258 
šlše
 
G‘R—lPos™iÚ
(
n
ècÚ¡ { ià(
	gn
>=
tick1
 &&‚<
tick2
)  (n-tick1);  -1; }

259 
šlše
 
do_£t_v®ue
(
¡¬t
, 
’d
, 
v®
, *
obj
)

261 
	gs
, 
	ge
;

262 
	g»®_¡¬t
, 
	g»®_’d
;

263 *
	gp1
, *
	gp2
;

264 **
	go1
;

267 ià(
	g¡¬t
>
	gtick2
) ;

268 ià(
	g’d
<
	gtick1
) ;

270 ià(
	gbË
!=
NULL
 && 
bË_size
>0)

272 
»®_¡¬t
 = 
»®_’d
 = 0;

274 ià(
	g¡¬t
>
	gtick1
è
	g»®_¡¬t
 = 
¡¬t
-
tick1
;

275 
	g»®_¡¬t
 = 0;

277 ià(
	g’d
<
	gtick2
è
	g»®_’d
 = 
’d
 - 
tick1
;

278 
	g»®_’d
 = 
tick2
 - 
tick1
;

280 
	gs
 = 
»®_¡¬t
;

281 
	ge
 = 
»®_’d
;

282 ià(
	gs
<0) s = 0;

283 ià(
	ge
>=
bË_size
è
e
 =able_size-1;

285 
	gp1
 = 
bË
+
s
; 
	go1
 = 
»Ï‹d_obj
+s;

286 
	gp2
 = 
bË
+
e
+1;

288 ià(
	g»Ï‹d_obj
!=
NULL
è
o1
 = 
»Ï‹d_obj
+
s
;

289 
	go1
 = 
NULL
;

291 ià(0 !ğ
v®
)

293 
p1
<
p2
)

295 ià(0 =ğ*
p1
)

298 *
p1
 = 
v®
;

299 ià(
	go1
!=
NULL
è*
o1
 = 
obj
;

301 ++
	gp1
;

302 ià(
	go1
!=
NULL
è++
o1
;

307 
ASSERT
(0);

312 
	g´iv©e
:

313 
fuÎ_size
;

	@../../titanutils/schedule/ScheduleBricks.cpp

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

4 
	~"debugMsg/Debug.h
"

5 
	~"ScheduËBricks.h
"

6 
	~"AùiveTabË.h
"

7 
	~"ScheduËProfeSh¬eImp.h
"

9 
	#DEFAULT_ITEMS_SIZE
 8

	)

11 
	#EXPAND_SLOTS_IF_NEED
() \

13 ià(
™ems_couÁ
>=
™ems_size
) \

15 
Ãw_size
 = (
™ems_size
>0è? i‹ms_size*2 : 
DEFAULT_ITEMS_SIZE
; \

17 
scheduË_¦iû
 **
±r
 = 
NULL
; \

18 
±r
 = 
	`Adju¡SlÙsSize
(
™ems
, 
™ems_couÁ
, 
Ãw_size
); \

19 ià(
NULL
 =ğ
±r
) \

21 
™ems
 = 
NULL
; \

22  
çl£
; \

24 
™ems
 = 
±r
; \

25 
™ems_size
 = 
Ãw_size
; \

27 } 0)

	)

29 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

31 
šlše
 
boŞ
 
	$is_Ïµed
(
a1
, 
a2
, 
b1
, 
b2
)

33 ià(
a2
<=
b1
è 
çl£
;

34 ià(
a1
>=
b2
è 
çl£
;

35  
çl£
;

36 
	}
}

38 
	g‹m¶©e
<
şass
 
	gT
> 
šlše
 
boŞ
 
	$IsV®idTime
(cÚ¡ 
T
 &
obj
)

40 ià(
obj
.
¡¬t
<0è 
çl£
;

41 ià(
obj
.
¡¬t
>1440è 
çl£
;

42 ià(
obj
.
’d
<0è 
çl£
;

43 ià(
obj
.
’d
>1440è 
çl£
;

45 ià(
obj
.
¡¬t
>obj.
’d
è 
çl£
;

47  
Œue
;

48 
	}
}

50 
	g‹m¶©e
<
şass
 
	gT
> 
šlše
 
T
** 
	$Adju¡SlÙsSize
(
T
 **
objs
, 
Üi_size
, 
Ãw_size
)

52 
T
 **
Ãw_objs
 = 
NULL
;

53 
ı_Ën
 = 0;

55 ià(
Üi_size
 =ğ
Ãw_size
)

56  
objs
;

58 ià(
Ãw_size
>0)

59 
Ãw_objs
 = 
Ãw
 
T
 *[
Ãw_size
];

61 ià(
Ãw_objs
!=
NULL
)

62 
	`mem£t
(
Ãw_objs
, 0, (
T
 *)*
Ãw_size
);

64 ià(
objs
!=
NULL
 && 
Ãw_objs
!=NULL)

66 
ı_Ën
 = (
Üi_size
>=
Ãw_size
) ?‚ew_size : ori_size;

67 ià(
ı_Ën
>0)

68 
	`memıy
(
Ãw_objs
, 
objs
, 
ı_Ën
*(
T
 *));

71 ià(
ı_Ën
<
Üi_size
)

73 
i
=
ı_Ën
; cp_Ën<
Üi_size
; ++i)

75 ià(
objs
[
i
]!=
NULL
)

77 
d–‘e
 
objs
[
i
];

78 
objs
[
i
] = 
NULL
;

83 ià(
objs
!=
NULL
)

84 
d–‘e
 [] 
objs
;

86  
Ãw_objs
;

87 
	}
}

90 
	g‹m¶©e
<
şass
 
	gT
> 
šlše
 
	$SORT
(
T
 **
objs
, 
size
)

92 ià(
NULL
 =ğ
objs
 || 
size
<2) ;

93 
	}
}

96 
šlše
 
	$G‘Numb”OfW“k
(cÚ¡ 
UTCTime
 &
t
)

98 
SYSTEMTIME
 
¡
 = 
t
;

99 
d
 = 
¡
.
wDay
;

101  ((
d
-1)/7)+1;

102 
	}
}

104 
šlše
 
	$G‘La¡W“k
(cÚ¡ 
UTCTime
 &
t
)

106 
SYSTEMTIME
 
¡
 = 
t
;

107 
d
 = 
¡
.
wDay
;

110 ià(
d
<29)

114 
	}
}

116 
Çme¥aû
 
	gScheduË
 {

118 
	gScheduËI‹mS‘
::
ScheduËI‹mS‘
()

119 : 
´Ùo_id
(0), 
´Ùo_Üd”
(0), 
´Ùo_fixed
(0), 
´Ùo_Çme
(
NULL
), 
´Ùo_šfo
(NULL),

120 
scheduË_™ems
(
NULL
), 
scheduË_™ems_couÁ
(0), 
scheduË_™ems_size
(0)

124 
	gScheduËI‹mS‘
::~
ScheduËI‹mS‘
()

126 
Re£tPrÙoA‰ribu‹
();

127 
R–—£ScheduËI‹ms
();

130 
	gScheduËI‹mS‘
::
S‘PrÙoA‰ribu‹
(
ušt32_t
 
id
, ušt32_ˆ
Üd”
, ušt32_ˆ
fixed
, cÚ¡ *
Çme
, cÚ¡ *
šfo
)

132 
Re£tPrÙoA‰ribu‹
();

134 
	g´Ùo_id
 = 
id
;

135 
	g´Ùo_Üd”
 = 
Üd”
;

136 
	g´Ùo_fixed
 = 
fixed
;

138 ià(
	gÇme
!=
NULL
)

139 
´Ùo_Çme
 = 
¡rdup
(
Çme
);

141 ià(
	gšfo
!=
NULL
)

142 
´Ùo_šfo
 = 
¡rdup
(
šfo
);

145 
	gScheduËI‹mS‘
::
Re£tPrÙoA‰ribu‹
()

147 
´Ùo_id
 = 0;

148 
	g´Ùo_Üd”
 = 0;

149 
	g´Ùo_fixed
 = 0;

151 ià(
	g´Ùo_Çme
!=
NULL
)

153 
ä“
(
´Ùo_Çme
);

154 
	g´Ùo_Çme
 = 
NULL
;

157 ià(
	g´Ùo_šfo
!=
NULL
)

159 
ä“
(
´Ùo_šfo
);

160 
	g´Ùo_šfo
 = 
NULL
;

164 
	gScheduËI‹mS‘
::
R–—£ScheduËI‹ms
()

166 
Re£tScheduËI‹ms
();

167 
	gd–‘e
 [] 
	gscheduË_™ems
;

168 
	gscheduË_™ems
 = 
NULL
;

169 
	gscheduË_™ems_couÁ
 = 0;

170 
	gscheduË_™ems_size
 = 0;

173 
	gScheduËI‹mS‘
::
Re£tScheduËI‹ms
()

175 ià(
scheduË_™ems
!=
NULL
)

177 ià(
scheduË_™ems_couÁ
>0)

179 
i
=0; 
	gi
<
	gscheduË_™ems_couÁ
; ++i)

181 ià(
	gscheduË_™ems
[
i
]!=
NULL
)

183 
d–‘e
 
scheduË_™ems
[
i
];

184 
	gscheduË_™ems
[
i
] = 
NULL
;

188 
	gscheduË_™ems_couÁ
 = 0;

192 
boŞ
 
	gScheduËI‹mS‘
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const

194 ià(
	gNULL
 =ğ
bË
)

195  
çl£
;

197 ià(
	gNULL
 =ğ
scheduË_™ems
 || 
scheduË_™ems_couÁ
 <1)

198  
Œue
;

200 
ScheduËI‹mEËm
 *
	g–em
;

201 
ScheduËI‹mBa£
 *
	gba£
;

202 
	gi
=0; i<
	gscheduË_™ems_couÁ
; ++i)

204 
	g–em
 = 
scheduË_™ems
[
i
];

205 ià(
	g–em
!=
NULL
)

207 
ba£
 = 
–em
->
™em
;

208 ià(
	gba£
!=
NULL
)

209 
ba£
->
MaskAùiveTabË
(
d©e_time
, 
bË
);

211 ià(
	g–em
->
	gsh¬e
)

212 ià(
	g–em
->
	gsh¬e
->
g‘
())

213 (
	g–em
->
	gsh¬e
->
g‘
())->
MaskAùiveTabË
(
d©e_time
, 
bË
);

217  
	gŒue
;

220 
boŞ
 
	gScheduËI‹mS‘
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
)

222 ià(
	gNULL
 =ğ
bË
)

223  
çl£
;

225 ià(
	gNULL
 =ğ
scheduË_™ems
 || 
scheduË_™ems_couÁ
 <1)

226  
Œue
;

228 
ScheduËI‹mEËm
 *
	g–em
;

229 
ScheduËI‹mBa£
 *
	gba£
;

230 
	gi
=0; i<
	gscheduË_™ems_couÁ
; ++i)

232 
	g–em
 = 
scheduË_™ems
[
i
];

233 ià(
	g–em
!=
NULL
)

235 
ba£
 = 
–em
->
™em
;

236 ià(
	gba£
!=
NULL
)

237 
ba£
->
MaskAùiveTabË
(
d©e_time
, 
bË
, 
©CÚ‹Á
);

239 ià(
	g–em
->
	gsh¬e
)

240 ià(
	g–em
->
	gsh¬e
->
g‘
())

241 (
	g–em
->
	gsh¬e
->
g‘
())->
MaskAùiveTabË
(
d©e_time
, 
bË
, 
©CÚ‹Á
);

245  
	gŒue
;

248 
boŞ
 
	gScheduËI‹mS‘
::
AddScheduËI‹m
(
´iÜ™y
, 
ScheduËI‹mSh¬eBa£
 &
™em
)

250 ià(!
Ex·ndI‹msCÚš”IfN“d
())

251  
	gçl£
;

253 
ScheduËI‹mEËm
 *
	g±r
;

254 
	g±r
 = 
Ãw
 
ScheduËI‹mEËm
;

255 ià(
	gNULL
 =ğ
±r
)

256  
çl£
;

258 
	g±r
->
	g´iÜ™y
 = 
´iÜ™y
;

259 
	g±r
->
	gsh¬e
 = 
Ãw
 
ScheduËI‹mSh¬eBa£
(
™em
);

260 ià(!
	g±r
->
	gsh¬e
)

261  
	gçl£
;

263 
ScheduËI‹mEËm
 *
	gtmp
;

264 
	gi
=0, 
	gj
=0;

265 
	gi
=0; i<
	gscheduË_™ems_couÁ
; ++i)

267 
	gtmp
 = 
scheduË_™ems
[
i
];

268 ià(
	gtmp
!=
NULL
)

270 ià(
tmp
->
´iÜ™y
 <…riority)

272 
j
 = 
i
;

278 ià(
	gi
 =ğ
scheduË_™ems_couÁ
)

280 
scheduË_™ems
[ 
scheduË_™ems_couÁ
++ ] = 
±r
;

281  
	gŒue
;

284 ià((
	gj
<=(
scheduË_™ems_couÁ
-1)è|| (scheduË_™ems_couÁ =ğ1 && 
´iÜ™y
 > 
scheduË_™ems
[0]->priority))

286 
memmove
(
scheduË_™ems
+
j
+1, scheduË_™ems+j, (
ScheduËI‹mEËm
 *)*(
scheduË_™ems_couÁ
-j));

287 
	gscheduË_™ems
[ 
j
 ] = 
±r
;

288 ++
	gscheduË_™ems_couÁ
;

292 
	gscheduË_™ems
[ 
scheduË_™ems_couÁ
++ ] = 
±r
;

295  
	gŒue
;

298 
boŞ
 
	gScheduËI‹mS‘
::
AddScheduËI‹m
(
´iÜ™y
, 
ScheduËI‹mBa£
 *
™em
)

300 ià(!
Ex·ndI‹msCÚš”IfN“d
())

301  
	gçl£
;

303 
ScheduËI‹mEËm
 *
	g±r
;

304 
	g±r
 = 
Ãw
 
ScheduËI‹mEËm
;

305 ià(
	gNULL
 =ğ
±r
)

306  
çl£
;

308 
	g±r
->
	g´iÜ™y
 = 
´iÜ™y
;

309 
	g™em
->
G‘I‹mTy³
()) {

310 
	gScheduËI‹mBa£
::
ITEM_TYPE_DAY
:

312 
ScheduËI‹mDay
 *
p_™em
 = 
Ãw
 ScheduleItemDay;

313 *
	gp_™em
 = *((
ScheduËI‹mDay
*)
™em
);

314 
	g±r
->
	g™em
 = 
p_™em
;

317 
	gScheduËI‹mBa£
::
ITEM_TYPE_WEEK
:

319 
ScheduËI‹mW“k
 *
p_™em
 = 
Ãw
 ScheduleItemWeek;

320 *
	gp_™em
 = *((
ScheduËI‹mW“k
*)
™em
);

321 
	g±r
->
	g™em
 = 
p_™em
;

324 
	gScheduËI‹mBa£
::
ITEM_TYPE_MONTH
:

326 
ScheduËI‹mMÚth
 *
p_™em
 = 
Ãw
 ScheduleItemMonth;

327 *
	gp_™em
 = *((
ScheduËI‹mMÚth
*)
™em
);

328 
	g±r
->
	g™em
 = 
p_™em
;

331 
	gScheduËI‹mBa£
::
ITEM_TYPE_SPECIFIC_DAY
:

333 
ScheduËI‹mS³cificDay
 *
p_™em
 = 
Ãw
 ScheduleItemSpecificDay;

334 *
	gp_™em
 = *((
ScheduËI‹mS³cificDay
*)
™em
);

335 
	g±r
->
	g™em
 = 
p_™em
;

339 
ScheduËI‹mEËm
 *
	gtmp
;

340 
	gi
=0, 
	gj
=0;

341 
	gi
=0; i<
	gscheduË_™ems_couÁ
; ++i)

343 
	gtmp
 = 
scheduË_™ems
[
i
];

344 ià(
	gtmp
!=
NULL
)

346 ià(
tmp
->
´iÜ™y
 <…riority)

348 
j
 = 
i
;

354 ià(
	gi
 =ğ
scheduË_™ems_couÁ
)

356 
scheduË_™ems
[ 
scheduË_™ems_couÁ
++ ] = 
±r
;

357  
	gŒue
;

360 ià((
	gj
<=(
scheduË_™ems_couÁ
-1)è|| (scheduË_™ems_couÁ =ğ1 && 
´iÜ™y
 > 
scheduË_™ems
[0]->priority))

362 
memmove
(
scheduË_™ems
+
j
+1, scheduË_™ems+j, (
ScheduËI‹mEËm
 *)*(
scheduË_™ems_couÁ
-j));

363 
	gscheduË_™ems
[ 
j
 ] = 
±r
;

364 ++
	gscheduË_™ems_couÁ
;

368 
	gscheduË_™ems
[ 
scheduË_™ems_couÁ
++ ] = 
±r
;

371  
	gŒue
;

374 
	gScheduËI‹mS‘
& ScheduËI‹mS‘::
İ”©Ü
=(cÚ¡ 
ScheduËI‹mS‘
& 
rhs
)

376 ià(
scheduË_™ems
!=
NULL
)

377 
R–—£ScheduËI‹ms
();

379 
Re£tPrÙoA‰ribu‹
();

380 
	g´Ùo_id
 = 
rhs
.
´Ùo_id
;

381 
	g´Ùo_Üd”
 = 
rhs
.
´Ùo_Üd”
;

382 
	g´Ùo_fixed
 = 
rhs
.
´Ùo_fixed
;

383 ià(
	grhs
.
	g´Ùo_Çme
!=
NULL
)

384 
´Ùo_Çme
 = 
¡rdup
(
rhs
.proto_name);

385 ià(
	grhs
.
	g´Ùo_šfo
!=
NULL
)

386 
´Ùo_šfo
 = 
¡rdup
(
rhs
.proto_info);

388 
ScheduËI‹mEËm
 **
	g±r_si
 = 
rhs
.
scheduË_™ems
;

389 
	gadd_couÁ
 = 
rhs
.
scheduË_™ems_couÁ
;

390 ià(
	g±r_si
!=
NULL
 && 
add_couÁ
>0)

392 
i
=0; 
	gi
<
	gadd_couÁ
; ++i)

394 ià(
	g±r_si
[
i
]->
	g™em
)

395 
AddScheduËI‹m
(
±r_si
[
i
]->
´iÜ™y
,…Œ_si[i]->
™em
);

397 ià(
	g±r_si
[
i
]->
	gsh¬e
)

398 
AddScheduËI‹m
(
±r_si
[
i
]->
´iÜ™y
, *ÕŒ_si[i]->
sh¬e
));

402  *
	gthis
;

405 
boŞ
 
	gScheduËI‹mS‘
::
Ex·ndI‹msCÚš”IfN“d
()

407 ià(
scheduË_™ems_couÁ
>=
scheduË_™ems_size
)

409 
Ãw_size
 = (
scheduË_™ems_size
>0è? scheduË_™ems_size*2 : 
DEFAULT_ITEMS_SIZE
;

411 
ScheduËI‹mEËm
 **
	g±r
 = 
NULL
;

412 
	g±r
 = 
Adju¡SlÙsSize
(
scheduË_™ems
, 
scheduË_™ems_couÁ
, 
Ãw_size
);

413 ià(
	gNULL
 =ğ
±r
)

415 
ASSERT
(0);

416 
	gscheduË_™ems
 = 
NULL
;

417 
	gscheduË_™ems_couÁ
 = 0;

418 
	gscheduË_™ems_size
 = 0;

419  
	gçl£
;

421 
	gscheduË_™ems
 = 
±r
;

422 
	gscheduË_™ems_size
 = 
Ãw_size
;

425  
	gŒue
;

428 
ScheduËD©aStus
 
	gScheduËI‹mS‘
::
CheckI‹mStus
() {

429 ià(!
scheduË_™ems
 || 
scheduË_™ems_couÁ
 < 1)

430  
SCHED_DATA_NONE
;

432 
ScheduËD©aStus
 
	ghighe¡
 = 
SCHED_DATA_NORMAL
;

433 
	gi
 = 0; i < 
	gscheduË_™ems_couÁ
; i++) {

434 ià(!
	gscheduË_™ems
[
i
]->
	gsh¬e
)

435  
	gSCHED_DATA_NONE
;

437 ià(*(
	gscheduË_™ems
[
i
]->
	gsh¬e
->
	g_¡©us
è=ğ
SCHED_DATA_DELETED
)

438  
SCHED_DATA_DELETED
;

440 ià(*(
	gscheduË_™ems
[
i
]->
	gsh¬e
->
	g_¡©us
è> 
	ghighe¡
)

441 
	ghighe¡
 = *(
scheduË_™ems
[
i
]->
sh¬e
->
_¡©us
);

444  
	ghighe¡
;

447 
boŞ
 
	gScheduËI‹mS‘
::
Upd©eScheduËI‹m
(
ScheduËI‹mSh¬eBa£
 &
™em
) {

448 ià(!
scheduË_™ems
 || 
scheduË_™ems_couÁ
 < 1)

449  
Œue
;

451 
boŞ
 
	ghasI‹mD–‘ed
 = 
çl£
;

452 
boŞ
 
	g»t
 = 
çl£
;

454 
	gi
 = 0; i < 
	gscheduË_™ems_couÁ
; i++) {

455 ià(!
	gscheduË_™ems
[
i
]->
	gsh¬e
)

458 
ScheduËI‹mSh¬eBa£
 
	g‹mp
 = *(
scheduË_™ems
[
i
]->
sh¬e
);

459 ià(
	g‹mp
->
G‘ScheduËID
(è=ğ
™em
->GetScheduleID()) {

460 ià(*(
scheduË_™ems
[
i
]->
sh¬e
->
_¡©us
è=ğ
SCHED_DATA_DELETED
) {

461 
TRACE
("[SCHEDULD LIB] I‹m [%Îu] i d–‘ed. Removäom s‘.\n", 
™em
->
G‘ScheduËID
());

462 
d–‘e
 
	gscheduË_™ems
[
i
];

463 
	gscheduË_™ems
[
i
] = 
NULL
;

464 
	ghasI‹mD–‘ed
 = 
Œue
;

466 
TRACE
("[SCHEDULD LIB] Upd©™em [%Îu]ØÃw v®ues.\n", 
™em
->
G‘ScheduËID
());

467 
d–‘e
 
	gscheduË_™ems
[
i
]->
	gsh¬e
;

468 
	gscheduË_™ems
[
i
]->
	gsh¬e
 = 
Ãw
 
ScheduËI‹mSh¬eBa£
(
™em
);

473 ià(
	ghasI‹mD–‘ed
) {

474 
ScheduËI‹mEËm
 **
	gŞd_–em_li¡
 = 
scheduË_™ems
;

475 
	gŞd_couÁ
 = 
scheduË_™ems_couÁ
;

476 
	gscheduË_™ems_couÁ
 = 0;

477 
	gscheduË_™ems_size
 = 0;

478 
	gscheduË_™ems
 = 
NULL
;

479 
	gi
 = 0; i < 
	gŞd_couÁ
; i++) {

480 ià(
	gŞd_–em_li¡
[
i
]) {

481 
	g»t
 = 
AddScheduËI‹m
(
Şd_–em_li¡
[
i
]->
´iÜ™y
, *(Şd_–em_li¡[i]->
sh¬e
));

482 
d–‘e
 
	gŞd_–em_li¡
[
i
];

485 
d–‘e
 
	gŞd_–em_li¡
;

487  
	gŒue
;

489  
	g»t
;

493 
	gScheduËI‹mDay
::
scheduË_¦iû
 {

494 
ACTIVE_TYPE
 
ty³
;

495 
	g¡¬t
;

496 
	g’d
;

497 *
	gu£r_d©a
;

500 
	gScheduËI‹mDay
::
ScheduËI‹mDay
()

501 : 
™ems
(
NULL
), 
™ems_couÁ
(0), 
™ems_size
(0)

505 
	gScheduËI‹mDay
::~
ScheduËI‹mDay
()

507 ià(
™ems
!=
NULL
)

509 
Re£t
();

510 
	gd–‘e
 [] 
	g™ems
;

511 
	g™ems
 = 
NULL
;

513 
	g™ems_couÁ
 = 0;

514 
	g™ems_size
 = 0;

517 
	gScheduËI‹mDay
::
Re£t
()

519 ià(
™ems
!=
NULL
)

521 ià(
™ems_couÁ
>0)

523 
i
=0; 
	gi
<
	g™ems_couÁ
; ++i)

525 ià(
	g™ems
[
i
]!=
NULL
)

527 
d–‘e
 
™ems
[
i
];

528 
	g™ems
[
i
] = 
NULL
;

532 
	g™ems_couÁ
 = 0;

536 
boŞ
 
	gScheduËI‹mDay
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const

538 ià(
	gNULL
 =ğ
bË
)

539  
çl£
;

541 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1)

542  
Œue
;

544 
	gi
=0; i<
	g™ems_couÁ
; ++i)

546 ià(
	g™ems
[
i
]!=
NULL
)

548 ià(
kAT_ACTIVE
 =ğ
™ems
[
i
]->
ty³
)

549 
bË
->
S‘Rªge
(
™ems
[
i
]->
¡¬t
, i‹ms[i]->
’d
, i‹ms[i]->
u£r_d©a
);

550 ià(
	gkAT_INACTIVE
 =ğ
™ems
[
i
]->
ty³
)

551 
bË
->
Inv®idRªge
(
™ems
[
i
]->
¡¬t
, i‹ms[i]->
’d
, i‹ms[i]->
u£r_d©a
);

555  
	gŒue
;

558 
boŞ
 
	gScheduËI‹mDay
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
)

560 ià(
	gNULL
 =ğ
bË
)

561  
çl£
;

563 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1)

564  
Œue
;

566 
	gi
=0; i<
	g™ems_couÁ
; ++i)

568 ià(
	g™ems
[
i
]!=
NULL
)

570 
ACTIVE_TYPE
 
ty³
 = 
kAT_NONE
;

571 *
	gu£r_d©a
 = 
NULL
;

572 ià(
	g©CÚ‹Á
.
size
()) {

573 
	gty³
 = 
©CÚ‹Á
[*
scheduË_id
].
aùiveTy³
;

574 
	gu£r_d©a
 = 
©CÚ‹Á
[*
scheduË_id
].
pU£rD©a
;

576 
	gty³
 = 
™ems
[
i
]->
ty³
;

577 
	gu£r_d©a
 = 
™ems
[
i
]->
u£r_d©a
;

580 ià(
	gkAT_ACTIVE
 =ğ
ty³
)

581 
bË
->
S‘Rªge
(
™ems
[
i
]->
¡¬t
, i‹ms[i]->
’d
, 
u£r_d©a
);

582 ià(
	gkAT_INACTIVE
 =ğ
ty³
)

583 
bË
->
Inv®idRªge
(
™ems
[
i
]->
¡¬t
, i‹ms[i]->
’d
, 
u£r_d©a
);

587  
	gŒue
;

590 
boŞ
 
	gScheduËI‹mDay
::
IsV®idSliû
(cÚ¡ 
time_¦iû
 &
¦iû
) const

592 ià(! 
IsV®idTime
(
¦iû
èè 
çl£
;

594 ià(
	gNULL
 =ğ
™ems
è 
Œue
;

596 ià(
	g™ems_couÁ
<1è 
	gŒue
;

598 
	gt1
 = 
¦iû
.
¡¬t
;

599 
	gt2
 = 
¦iû
.
’d
;

600 
	gx
, 
	gy
;

601 
	gi
=0; i<
	g™ems_couÁ
; i++)

603 
	gx
 = 
™ems
[
i
]->
¡¬t
;

604 
	gy
 = 
™ems
[
i
]->
’d
;

606 ià(
is_Ïµed
(
t1
, 
t2
, 
x
, 
y
))

607  
	gçl£
;

610  
	gŒue
;

613 
boŞ
 
	gScheduËI‹mDay
::
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû
 &
¦iû
, *
u£r_d©a
 )

615 ià(!
IsV®idSliû
(
¦iû
))

616  
	gçl£
;

618 
EXPAND_SLOTS_IF_NEED
();

620 
scheduË_¦iû
 *
	gÃw_™em
 = 
NULL
;

621 
	gÃw_™em
 = 
Ãw
 
scheduË_¦iû
;

622 
	gÃw_™em
->
	gty³
 = 
ty³
;

623 
	gÃw_™em
->
	g¡¬t
 = 
¦iû
.
¡¬t
;

624 
	gÃw_™em
->
	g’d
 = 
¦iû
.
’d
;

625 
	gÃw_™em
->
	gu£r_d©a
 = 
u£r_d©a
;

626 
	g™ems
[ 
™ems_couÁ
++ ] = 
Ãw_™em
;

628  
	gŒue
;

631 
	gScheduËI‹mDay
& ScheduËI‹mDay::
İ”©Ü
=(cÚ¡ 
ScheduËI‹mDay
& 
rhs
)

633 
Re£t
();

634 
	gi
 = 0; i < 
	grhs
.
	g™ems_couÁ
; i++) {

635 
time_¦iû
 
	g¦iû
;

637 
	g¦iû
.
	g¡¬t
 = 
rhs
.
™ems
[
i
]->
¡¬t
;

638 
	g¦iû
.
	g’d
 = 
rhs
.
™ems
[
i
]->
’d
;

639 
AddTimeSliû
(
rhs
.
™ems
[
i
]->
ty³
, 
¦iû
,„hs.™ems[i]->
u£r_d©a
);

642  *
	gthis
;

647 
	gScheduËI‹mW“k
::
scheduË_¦iû
 {

648 
ACTIVE_TYPE
 
ty³
;

649 
	g¡¬t
;

650 
	g’d
;

651 *
	gu£r_d©a
;

654 
	gScheduËI‹mW“k
::
ScheduËI‹mW“k
()

656 
i
=0; 
	gi
<7; i++)

658 
	g™ems
[
i
] = 
NULL
;

659 
	g™ems_couÁ
[
i
] = 0;

660 
	g™ems_size
[
i
] = 0;

664 
	gScheduËI‹mW“k
::~
ScheduËI‹mW“k
()

666 
Re£t
();

667 
	gi
=0; i<7; i++)

669 ià(
	g™ems
[
i
]!=
NULL
)

671 
d–‘e
 [] 
™ems
[
i
];

672 
	g™ems
[
i
] = 
NULL
;

674 
	g™ems_size
[
i
] = 0;

678 
	gScheduËI‹mW“k
::
Re£t
()

680 
scheduË_¦iû
 **
±r
;

681 
	gn
;

683 
	gi
=0; i<7; i++)

685 ià(
	g™ems
[
i
]!=
NULL
)

687 
±r
 = 
™ems
[
i
];

688 ià(
	g™ems_couÁ
[
i
]>0)

690 
	gn
 = 
™ems_couÁ
[
i
];

691 
	gj
=0; j<
	gn
; ++j)

693 ià(
	g±r
[
j
]!=
NULL
)

695 
d–‘e
 
±r
[
j
];

696 
	g±r
[
j
] = 
NULL
;

700 
	g™ems_couÁ
[
i
] = 0;

705 
boŞ
 
	gScheduËI‹mW“k
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const

707 ià(
	gNULL
 =ğ
bË
è 
çl£
;

709 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

710 
	gw“k
 = 
¡
.
wDayOfW“k
 % 7;

711 
scheduË_¦iû
 * cÚ¡ * 
	gcu¼_¦iûs
 = 
™ems
[
w“k
];

712 
	gcu¼_couÁ
 = 
™ems_couÁ
[
w“k
];

714 ià(
	gNULL
 =ğ
cu¼_¦iûs
 || 
cu¼_couÁ
<1è 
Œue
;

716 
	gi
=0; i<
	gcu¼_couÁ
; ++i)

718 ià(
	gcu¼_¦iûs
[
i
]!=
NULL
)

720 ià(
kAT_ACTIVE
 =ğ
cu¼_¦iûs
[
i
]->
ty³
)

721 
bË
->
S‘Rªge
(
cu¼_¦iûs
[
i
]->
¡¬t
, cu¼_¦iûs[i]->
’d
, cu¼_¦iûs[i]->
u£r_d©a
);

722 ià(
	gkAT_INACTIVE
 =ğ
cu¼_¦iûs
[
i
]->
ty³
)

723 
bË
->
Inv®idRªge
(
cu¼_¦iûs
[
i
]->
¡¬t
, cu¼_¦iûs[i]->
’d
, cu¼_¦iûs[i]->
u£r_d©a
);

727  
	gŒue
;

730 
boŞ
 
	gScheduËI‹mW“k
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
)

732 ià(
	gNULL
 =ğ
bË
è 
çl£
;

734 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

735 
	gw“k
 = 
¡
.
wDayOfW“k
 % 7;

736 
scheduË_¦iû
 * cÚ¡ * 
	gcu¼_¦iûs
 = 
™ems
[
w“k
];

737 
	gcu¼_couÁ
 = 
™ems_couÁ
[
w“k
];

739 ià(
	gNULL
 =ğ
cu¼_¦iûs
 || 
cu¼_couÁ
<1è 
Œue
;

741 
	gi
=0; i<
	gcu¼_couÁ
; ++i)

743 ià(
	gcu¼_¦iûs
[
i
]!=
NULL
)

745 
ACTIVE_TYPE
 
ty³
 = 
kAT_NONE
;

746 *
	gu£r_d©a
 = 
NULL
;

747 ià(
	g©CÚ‹Á
.
size
()) {

748 
	gty³
 = 
©CÚ‹Á
[*
scheduË_id
].
aùiveTy³
;

749 
	gu£r_d©a
 = 
©CÚ‹Á
[*
scheduË_id
].
pU£rD©a
;

751 
	gty³
 = 
cu¼_¦iûs
[
i
]->
ty³
;

752 
	gu£r_d©a
 = 
cu¼_¦iûs
[
i
]->
u£r_d©a
;

755 ià(
	gkAT_ACTIVE
 =ğ
ty³
)

756 
bË
->
S‘Rªge
(
cu¼_¦iûs
[
i
]->
¡¬t
, cu¼_¦iûs[i]->
’d
, 
u£r_d©a
);

757 ià(
	gkAT_INACTIVE
 =ğ
ty³
)

758 
bË
->
Inv®idRªge
(
cu¼_¦iûs
[
i
]->
¡¬t
, cu¼_¦iûs[i]->
’d
, 
u£r_d©a
);

762  
	gŒue
;

765 
boŞ
 
	gScheduËI‹mW“k
::
IsV®idSliû
(cÚ¡ 
time_¦iû
 &
¦iû
) const

767 
w“k
;

769 ià(! 
IsV®idTime
(
¦iû
èè 
	gçl£
;

771 
	gw“k
 = 
¦iû
.
w“k
;

772 ià(
	gw“k
<0 || w“k>6è 
	gçl£
;

774 cÚ¡ 
scheduË_¦iû
 * cÚ¡ *
	gcu¼_¦iûs
 = 
™ems
[
w“k
];

776 ià(
	gNULL
 =ğ
cu¼_¦iûs
è 
Œue
;

778 
	gcu¼_couÁ
 = 
™ems_couÁ
[
w“k
];

780 ià(
	gcu¼_couÁ
<1è 
	gŒue
;

782 
	gt1
 = 
¦iû
.
¡¬t
;

783 
	gt2
 = 
¦iû
.
’d
;

784 
	gx
, 
	gy
;

785 
	gi
=0; i<
	gcu¼_couÁ
; i++)

787 
	gx
 = 
cu¼_¦iûs
[
i
]->
¡¬t
;

788 
	gy
 = 
cu¼_¦iûs
[
i
]->
’d
;

790 ià(
is_Ïµed
(
t1
, 
t2
, 
x
, 
y
))

791  
	gçl£
;

794  
	gŒue
;

797 
boŞ
 
	gScheduËI‹mW“k
::
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû
 &
¦iû
, *
u£r_d©a
 )

799 ià(! 
IsV®idSliû
(
¦iû
)è 
	gçl£
;

801 
	gw“k
 = 
¦iû
.
w“k
;

802 
	gscheduË_¦iû
 **&
	gcu¼_¦iûs
 = 
™ems
[
w“k
];

803 &
	gcu¼_couÁ
 = 
™ems_couÁ
[
w“k
];

804 &
	gcu¼_size
 = 
™ems_size
[
w“k
];

806 ià(
	gcu¼_couÁ
>=
cu¼_size
)

808 
Ãw_size
 = (
cu¼_size
>0è? cu¼_size*2 : 
DEFAULT_ITEMS_SIZE
;

810 
scheduË_¦iû
 **
	g±r
 = 
NULL
;

811 
	g±r
 = 
Adju¡SlÙsSize
(
cu¼_¦iûs
, 
cu¼_couÁ
, 
Ãw_size
);

812 ià(
	gNULL
 =ğ
±r
)

814 
cu¼_¦iûs
 = 
NULL
;

815 
	gcu¼_couÁ
 = 0;

816 
	gcu¼_size
 = 0;

817  
	gçl£
;

819 
	gcu¼_¦iûs
 = 
±r
;

820 
	gcu¼_size
 = 
Ãw_size
;

823 
scheduË_¦iû
 *
	gÃw_™em
 = 
NULL
;

824 
	gÃw_™em
 = 
Ãw
 
scheduË_¦iû
;

825 
	gÃw_™em
->
	gty³
 = 
ty³
;

826 
	gÃw_™em
->
	g¡¬t
 = 
¦iû
.
¡¬t
;

827 
	gÃw_™em
->
	g’d
 = 
¦iû
.
’d
;

828 
	gÃw_™em
->
	gu£r_d©a
 = 
u£r_d©a
;

829 
	gcu¼_¦iûs
[ 
cu¼_couÁ
++ ] = 
Ãw_™em
;

831  
	gŒue
;

834 
	gScheduËI‹mW“k
& ScheduËI‹mW“k::
İ”©Ü
=(cÚ¡ 
ScheduËI‹mW“k
& 
rhs
)

836 
Re£t
();

837 
	gw“k
 = 0; week < 7; week++) {

838 
	gj
 = 0; j < 
	grhs
.
	g™ems_couÁ
[
w“k
]; j++) {

839 
time_¦iû
 
	g¦iû
;

840 
	g¦iû
.
	gw“k
 = 
w“k
;

841 
	g¦iû
.
	g¡¬t
 = 
rhs
.
™ems
[
w“k
][
j
]->
¡¬t
;

842 
	g¦iû
.
	g’d
 = 
rhs
.
™ems
[
w“k
][
j
]->
’d
;

843 
AddTimeSliû
(
rhs
.
™ems
[
w“k
][
j
]->
ty³
, 
¦iû
,„hs.™ems[w“k][j]->
u£r_d©a
);

847  *
	gthis
;

852 
	gScheduËI‹mMÚth
::
scheduË_¦iû
 {

853 
ACTIVE_TYPE
 
ty³
;

854 
	gis_Ãxt
;

855 
	g¡¬t
;

856 
	g’d
;

857 *
	gu£r_d©a
;

860 
	gScheduËI‹mMÚth
::
ScheduËI‹mMÚth
()

861 : 
™ems
(
NULL
), 
™ems_couÁ
(0), 
™ems_size
(0), 
scheduË_ty³
(
kMÚthScheduËNÚe
)

865 
	gScheduËI‹mMÚth
::~
ScheduËI‹mMÚth
()

867 ià(
™ems
!=
NULL
)

869 
Re£t
();

870 
	gd–‘e
 [] 
	g™ems
;

871 
	g™ems
 = 
NULL
;

872 
	g™ems_size
 = 0;

876 
	gScheduËI‹mMÚth
::
Re£t
()

878 ià(
™ems
!=
NULL
)

880 ià(
™ems_couÁ
>0)

882 
i
=0; 
	gi
<
	g™ems_couÁ
; ++i)

884 ià(
	g™ems
[
i
]!=
NULL
)

886 
d–‘e
 
™ems
[
i
];

887 
	g™ems
[
i
] = 
NULL
;

891 
	g™ems_couÁ
 = 0;

894 
	gscheduË_ty³
 = 
kMÚthScheduËNÚe
;

897 
boŞ
 
	gScheduËI‹mMÚth
::
MaskAùiveTabË1
(cÚ¡ 
UTCTime
 &
d©e_time
, cÚ¡ UTCTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
) const

899 cÚ¡ 
scheduË_¦iû
 *
	g±r
;

900 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

901 
SYSTEMTIME
 
	g¡_´ev
 = 
´ev_d©e_time
;

902 cÚ¡ 
	gm0
 = 
scheduË_d‘a
.
day1
.
mÚth
;

903 cÚ¡ 
	gm1
 = 
¡
.
wMÚth
;

904 cÚ¡ 
	gm2
 = 
¡_´ev
.
wMÚth
;

905 cÚ¡ 
	gd0
 = 
scheduË_d‘a
.
day1
.
day
;

906 cÚ¡ 
	gd1
 = 
¡
.
wDay
;

907 cÚ¡ 
	gd2
 = 
¡_´ev
.
wDay
;

909 
	gmy_d©e_¡©us
 = 0;

911 ià(
	gNULL
 =ğ
bË
è 
çl£
;

913 ià(
	gkMÚthScheduËDay1
 !ğ
scheduË_ty³
è 
çl£
;

915 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

917 ià(-1 =ğ
m0
)

919 ià(
d0
 =ğ
d1
è
my_d©e_¡©us
 = 1;

920 ià(
	gd0
 =ğ
d2
è
my_d©e_¡©us
 = -1;

924 ià((
	gm0
 =ğ
m1
è&& (
d0
 =ğ
d1
)è
my_d©e_¡©us
 = 1;

925 ià((
	gm0
 =ğ
m2
è&& (
d0
 =ğ
d2
)è
my_d©e_¡©us
 = -1;

928 ià(0 =ğ
my_d©e_¡©us
è 
Œue
;

930 
	gi
=0; i<
	g™ems_couÁ
; ++i)

932 
	g±r
 = 
™ems
[
i
];

934 ià((
	g±r
->
	gis_Ãxt
è&& (
	gmy_d©e_¡©us
!=-1)) ;

935 ià((0==
±r
->
is_Ãxt
è&& (
my_d©e_¡©us
!=1)) ;

937 ià(
	gkAT_ACTIVE
 =ğ
±r
->
ty³
)

938 
bË
->
S‘Rªge
(
±r
->
¡¬t
,…Œ->
’d
,…Œ->
u£r_d©a
);

939 ià(
	gkAT_INACTIVE
 =ğ
±r
->
ty³
)

940 
bË
->
Inv®idRªge
(
±r
->
¡¬t
,…Œ->
’d
,…Œ->
u£r_d©a
);

943  
	gŒue
;

946 
boŞ
 
	gScheduËI‹mMÚth
::
MaskAùiveTabË1
(cÚ¡ 
UTCTime
 &
d©e_time
, cÚ¡ UTCTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
)

948 cÚ¡ 
scheduË_¦iû
 *
	g±r
;

949 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

950 
SYSTEMTIME
 
	g¡_´ev
 = 
´ev_d©e_time
;

951 cÚ¡ 
	gm0
 = 
scheduË_d‘a
.
day1
.
mÚth
;

952 cÚ¡ 
	gm1
 = 
¡
.
wMÚth
;

953 cÚ¡ 
	gm2
 = 
¡_´ev
.
wMÚth
;

954 cÚ¡ 
	gd0
 = 
scheduË_d‘a
.
day1
.
day
;

955 cÚ¡ 
	gd1
 = 
¡
.
wDay
;

956 cÚ¡ 
	gd2
 = 
¡_´ev
.
wDay
;

958 
	gmy_d©e_¡©us
 = 0;

960 ià(
	gNULL
 =ğ
bË
è 
çl£
;

962 ià(
	gkMÚthScheduËDay1
 !ğ
scheduË_ty³
è 
çl£
;

964 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

966 ià(-1 =ğ
m0
)

968 ià(
d0
 =ğ
d1
è
my_d©e_¡©us
 = 1;

969 ià(
	gd0
 =ğ
d2
è
my_d©e_¡©us
 = -1;

973 ià((
	gm0
 =ğ
m1
è&& (
d0
 =ğ
d1
)è
my_d©e_¡©us
 = 1;

974 ià((
	gm0
 =ğ
m2
è&& (
d0
 =ğ
d2
)è
my_d©e_¡©us
 = -1;

977 ià(0 =ğ
my_d©e_¡©us
è 
Œue
;

979 
	gi
=0; i<
	g™ems_couÁ
; ++i)

981 
	g±r
 = 
™ems
[
i
];

983 ià((
	g±r
->
	gis_Ãxt
è&& (
	gmy_d©e_¡©us
!=-1)) ;

984 ià((0==
±r
->
is_Ãxt
è&& (
my_d©e_¡©us
!=1)) ;

986 
ACTIVE_TYPE
 
	gty³
 = 
kAT_NONE
;

987 *
	gu£r_d©a
 = 
NULL
;

988 ià(
	g©CÚ‹Á
.
size
()) {

989 
	gty³
 = 
©CÚ‹Á
[*
scheduË_id
].
aùiveTy³
;

990 
	gu£r_d©a
 = 
©CÚ‹Á
[*
scheduË_id
].
pU£rD©a
;

992 
	gty³
 = 
±r
->
ty³
;

993 
	gu£r_d©a
 = 
±r
->
u£r_d©a
;

996 ià(
	gkAT_ACTIVE
 =ğ
ty³
)

997 
bË
->
S‘Rªge
(
±r
->
¡¬t
,…Œ->
’d
, 
u£r_d©a
);

998 ià(
	gkAT_INACTIVE
 =ğ
ty³
)

999 
bË
->
Inv®idRªge
(
±r
->
¡¬t
,…Œ->
’d
, 
u£r_d©a
);

1002  
	gŒue
;

1005 
šlše
 
boŞ
 
my_check1
(cÚ¡ 
w0
, cÚ¡ 
v0
, cÚ¡ 
w9
, cÚ¡ 
v9
, cÚ¡ 
f9
)

1008 ià(
	gw0
<0)

1010 ià(
	gw9
 !ğ
f9
è 
çl£
;

1011  (
	gv0
 =ğ
v9
);

1015 ià(
	gw0
!=
w9
è 
çl£
;

1017 ià(-1==
v0
è (
w0
 =ğ
w9
);

1019  ((
	gw0
==
w9
è&& (
v0
==
v9
));

1023 
boŞ
 
	gScheduËI‹mMÚth
::
MaskAùiveTabË2
(cÚ¡ 
CD©eTime
 &
d©e_time
, cÚ¡ CD©eTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
, *
obj
) const

1025 cÚ¡ 
scheduË_¦iû
 *
	g±r
;

1027 cÚ¡ 
	gm0
 = 
scheduË_d‘a
.
w“k1
.
mÚth
;

1028 cÚ¡ 
	gw0
 = 
scheduË_d‘a
.
w“k1
.
which_w“k
;

1029 cÚ¡ 
	gv0
 = 
scheduË_d‘a
.
w“k1
.
w“k
;

1031 cÚ¡ 
	gm1
 = 
d©e_time
.
G‘MÚth
();

1032 cÚ¡ 
	gw1
 = 
d©e_time
.
G‘W“kOfMÚth
();

1033 cÚ¡ 
	gv1
 = 
d©e_time
.
G‘DayOfW“k
()-1;

1035 cÚ¡ 
	gm2
 = 
´ev_d©e_time
.
G‘MÚth
();

1036 cÚ¡ 
	gw2
 = 
´ev_d©e_time
.
G‘W“kOfMÚth
();

1037 cÚ¡ 
	gv2
 = 
´ev_d©e_time
.
G‘DayOfW“k
()-1;

1039 
	gmy_d©e_¡©us
 = 0;

1041 ià(
	gNULL
 =ğ
bË
è 
çl£
;

1043 ià(
	gkMÚthScheduËW“k1
 !ğ
scheduË_ty³
è 
çl£
;

1045 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

1047 ià((
	gm0
!=-1è&& (
m0
!=
m1
è&& (m0!=
m2
)è 
Œue
;

1049 ià(-1==
m0
)

1051 ià(! 
my_check1
(
w0
, 
v0
, 
w1
, 
v1
))

1053 ià(! 
my_check1
(
w0
, 
v0
, 
w2
, 
v2
))

1054  
Œue
;

1056 
	gmy_d©e_¡©us
 = -1;

1060 
	gmy_d©e_¡©us
 = 1;

1063 ià((
	gm0
!=
m1
è&& (
m0
!=
m2
))

1065  
Œue
;

1067 ià(
	gm0
 =ğ
m1
)

1069 ià(! 
my_check1
(
w0
, 
v0
, 
w1
, 
v1
))

1070  
Œue
;

1071 
	gmy_d©e_¡©us
 = 1;

1075 ià(! 
my_check1
(
w0
, 
v0
, 
w2
, 
v2
))

1076  
	gŒue
;

1077 
	gmy_d©e_¡©us
 = -1;

1080 ià(0 =ğ
my_d©e_¡©us
)

1082 
ASSERT
(0);

1083  
	gŒue
;

1086 
	gi
=0; i<
	g™ems_couÁ
; ++i)

1088 
	g±r
 = 
™ems
[
i
];

1090 ià((
	g±r
->
	gis_Ãxt
è&& (
	gmy_d©e_¡©us
!=-1)) ;

1091 ià((0==
±r
->
is_Ãxt
è&& (
my_d©e_¡©us
!=1)) ;

1093 ià(
	gkAT_ACTIVE
 =ğ
±r
->
ty³
)

1094 
bË
->
S‘Rªge
(
±r
->
¡¬t
,…Œ->
’d
, 
obj
);

1095 ià(
	gkAT_INACTIVE
 =ğ
±r
->
ty³
)

1096 
bË
->
Inv®idRªge
(
±r
->
¡¬t
,…Œ->
’d
, 
obj
);

1099  
	gŒue
;

1102 
boŞ
 
	gScheduËI‹mMÚth
::
MaskAùiveTabË3
(cÚ¡ 
UTCTime
 &
d©e_time
, cÚ¡ UTCTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
) const

1104 cÚ¡ 
scheduË_¦iû
 *
	g±r
;

1105 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

1106 
SYSTEMTIME
 
	g¡_´ev
 = 
´ev_d©e_time
;

1108 cÚ¡ 
	gm0
 = 
scheduË_d‘a
.
w“k2
.
mÚth
;

1109 cÚ¡ 
	gn0
 = 
scheduË_d‘a
.
w“k2
.
numb”
;

1110 cÚ¡ 
	gw0
 = 
scheduË_d‘a
.
w“k2
.
w“k
;

1112 cÚ¡ 
	gm1
 = 
¡
.
wMÚth
;

1113 cÚ¡ 
	gn1
 = 
G‘Numb”OfW“k
(
d©e_time
);

1114 cÚ¡ 
	gw1
 = 
¡
.
wDayOfW“k
;

1115 cÚ¡ 
	gf1
 = 
G‘La¡W“k
(
d©e_time
);

1117 cÚ¡ 
	gm2
 = 
¡_´ev
.
wMÚth
;

1118 cÚ¡ 
	gn2
 = 
G‘Numb”OfW“k
(
´ev_d©e_time
);

1119 cÚ¡ 
	gw2
 = 
¡_´ev
.
wDayOfW“k
;

1120 cÚ¡ 
	gf2
 = 
G‘La¡W“k
(
´ev_d©e_time
);

1122 
	gmy_d©e_¡©us
 = 0;

1124 ià(
	gNULL
 =ğ
bË
è 
çl£
;

1126 ià(
	gkMÚthScheduËW“k2
 !ğ
scheduË_ty³
è 
çl£
;

1128 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

1130 ià((
	gm0
!=-1è&& (
m0
!=
m1
è&& (m0!=
m2
)è 
Œue
;

1132 ià(-1==
m0
)

1134 ià(! 
my_check1
(
n0
, 
w0
, 
n1
, 
w1
, 
f1
))

1136 ià(! 
my_check1
(
n0
, 
w0
, 
n2
, 
w2
, 
f2
))

1137  
Œue
;

1139 
	gmy_d©e_¡©us
 = -1;

1143 
	gmy_d©e_¡©us
 = 1;

1148 ià((
	gm0
 =ğ
m1
è&& 
my_check1
(
n0
, 
w0
, 
n1
, 
w1
, 
f1
))

1150 
	gmy_d©e_¡©us
 = 1;

1152 ià((
	gm0
 =ğ
m2
è&& 
my_check1
(
n0
, 
w0
, 
n2
, 
w2
, 
f2
))

1154 
	gmy_d©e_¡©us
 = -1;

1158  
	gŒue
;

1162 ià(0 =ğ
my_d©e_¡©us
)

1164 
ASSERT
(0);

1165  
	gŒue
;

1171 
	gi
=0; i<
	g™ems_couÁ
; ++i)

1173 
	g±r
 = 
™ems
[
i
];

1175 ià((
	g±r
->
	gis_Ãxt
è&& (
	gmy_d©e_¡©us
!=-1)) ;

1176 ià((0==
±r
->
is_Ãxt
è&& (
my_d©e_¡©us
!=1)) ;

1178 ià(
	gkAT_ACTIVE
 =ğ
±r
->
ty³
)

1179 
bË
->
S‘Rªge
(
±r
->
¡¬t
,…Œ->
’d
,…Œ->
u£r_d©a
);

1180 ià(
	gkAT_INACTIVE
 =ğ
±r
->
ty³
)

1181 
bË
->
Inv®idRªge
(
±r
->
¡¬t
,…Œ->
’d
,…Œ->
u£r_d©a
);

1184  
	gŒue
;

1187 
boŞ
 
	gScheduËI‹mMÚth
::
MaskAùiveTabË3
(cÚ¡ 
UTCTime
 &
d©e_time
, cÚ¡ UTCTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
)

1189 cÚ¡ 
scheduË_¦iû
 *
	g±r
;

1190 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

1191 
SYSTEMTIME
 
	g¡_´ev
 = 
´ev_d©e_time
;

1193 cÚ¡ 
	gm0
 = 
scheduË_d‘a
.
w“k2
.
mÚth
;

1194 cÚ¡ 
	gn0
 = 
scheduË_d‘a
.
w“k2
.
numb”
;

1195 cÚ¡ 
	gw0
 = 
scheduË_d‘a
.
w“k2
.
w“k
;

1197 cÚ¡ 
	gm1
 = 
¡
.
wMÚth
;

1198 cÚ¡ 
	gn1
 = 
G‘Numb”OfW“k
(
d©e_time
);

1199 cÚ¡ 
	gw1
 = 
¡
.
wDayOfW“k
;

1200 cÚ¡ 
	gf1
 = 
G‘La¡W“k
(
d©e_time
);

1202 cÚ¡ 
	gm2
 = 
¡_´ev
.
wMÚth
;

1203 cÚ¡ 
	gn2
 = 
G‘Numb”OfW“k
(
´ev_d©e_time
);

1204 cÚ¡ 
	gw2
 = 
¡_´ev
.
wDayOfW“k
;

1205 cÚ¡ 
	gf2
 = 
G‘La¡W“k
(
´ev_d©e_time
);

1207 
	gmy_d©e_¡©us
 = 0;

1209 ià(
	gNULL
 =ğ
bË
è 
çl£
;

1211 ià(
	gkMÚthScheduËW“k2
 !ğ
scheduË_ty³
è 
çl£
;

1213 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

1215 ià((
	gm0
!=-1è&& (
m0
!=
m1
è&& (m0!=
m2
)è 
Œue
;

1217 ià(-1==
m0
)

1219 ià(! 
my_check1
(
n0
, 
w0
, 
n1
, 
w1
, 
f1
))

1221 ià(! 
my_check1
(
n0
, 
w0
, 
n2
, 
w2
, 
f2
))

1222  
Œue
;

1224 
	gmy_d©e_¡©us
 = -1;

1228 
	gmy_d©e_¡©us
 = 1;

1233 ià((
	gm0
 =ğ
m1
è&& 
my_check1
(
n0
, 
w0
, 
n1
, 
w1
, 
f1
))

1235 
	gmy_d©e_¡©us
 = 1;

1237 ià((
	gm0
 =ğ
m2
è&& 
my_check1
(
n0
, 
w0
, 
n2
, 
w2
, 
f2
))

1239 
	gmy_d©e_¡©us
 = -1;

1243  
	gŒue
;

1247 ià(0 =ğ
my_d©e_¡©us
)

1249 
ASSERT
(0);

1250  
	gŒue
;

1256 
	gi
=0; i<
	g™ems_couÁ
; ++i)

1258 
	g±r
 = 
™ems
[
i
];

1260 ià((
	g±r
->
	gis_Ãxt
è&& (
	gmy_d©e_¡©us
!=-1)) ;

1261 ià((0==
±r
->
is_Ãxt
è&& (
my_d©e_¡©us
!=1)) ;

1263 
ACTIVE_TYPE
 
	gty³
 = 
kAT_NONE
;

1264 *
	gu£r_d©a
 = 
NULL
;

1265 ià(
	g©CÚ‹Á
.
size
()) {

1266 
	gty³
 = 
©CÚ‹Á
[*
scheduË_id
].
aùiveTy³
;

1267 
	gu£r_d©a
 = 
©CÚ‹Á
[*
scheduË_id
].
pU£rD©a
;

1269 
	gty³
 = 
±r
->
ty³
;

1270 
	gu£r_d©a
 = 
±r
->
u£r_d©a
;

1273 ià(
	gkAT_ACTIVE
 =ğ
ty³
)

1274 
bË
->
S‘Rªge
(
±r
->
¡¬t
,…Œ->
’d
, 
u£r_d©a
);

1275 ià(
	gkAT_INACTIVE
 =ğ
ty³
)

1276 
bË
->
Inv®idRªge
(
±r
->
¡¬t
,…Œ->
’d
, 
u£r_d©a
);

1279  
	gŒue
;

1282 
boŞ
 
	gScheduËI‹mMÚth
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const

1284 cÚ¡ 
UTCTimeS·n
 
¥ª_1day
(1, 0, 0, 0);

1285 cÚ¡ 
UTCTime
 
	g´ev_d©e_time
 = 
d©e_time
 - 
¥ª_1day
;

1286 
boŞ
 
	g»t
 = 
çl£
;

1288 ià(
	gNULL
 =ğ
bË
è 
çl£
;

1290 ià(
	gkMÚthScheduËNÚe
 =ğ
scheduË_ty³
è 
Œue
;

1292 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

1294 
	gscheduË_ty³
)

1296 
	gkMÚthScheduËDay1
:

1297 
»t
 = 
MaskAùiveTabË1
(
d©e_time
, 
´ev_d©e_time
, 
bË
);

1300 
	gkMÚthScheduËW“k1
:

1301 
»t
 = 
MaskAùiveTabË2
(
d©e_time
, 
´ev_d©e_time
, 
bË
, 
obj
);

1304 
	gkMÚthScheduËW“k2
:

1305 
»t
 = 
MaskAùiveTabË3
(
d©e_time
, 
´ev_d©e_time
, 
bË
);

1311  
	g»t
;

1314 
boŞ
 
	gScheduËI‹mMÚth
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
)

1316 cÚ¡ 
UTCTimeS·n
 
¥ª_1day
(1, 0, 0, 0);

1317 cÚ¡ 
UTCTime
 
	g´ev_d©e_time
 = 
d©e_time
 - 
¥ª_1day
;

1318 
boŞ
 
	g»t
 = 
çl£
;

1320 ià(
	gNULL
 =ğ
bË
è 
çl£
;

1322 ià(
	gkMÚthScheduËNÚe
 =ğ
scheduË_ty³
è 
Œue
;

1324 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

1326 
	gscheduË_ty³
)

1328 
	gkMÚthScheduËDay1
:

1329 
»t
 = 
MaskAùiveTabË1
(
d©e_time
, 
´ev_d©e_time
, 
bË
, 
©CÚ‹Á
);

1332 
	gkMÚthScheduËW“k1
:

1333 
»t
 = 
MaskAùiveTabË2
(
d©e_time
, 
´ev_d©e_time
, 
bË
, 
obj
);

1336 
	gkMÚthScheduËW“k2
:

1337 
»t
 = 
MaskAùiveTabË3
(
d©e_time
, 
´ev_d©e_time
, 
bË
, 
©CÚ‹Á
);

1343  
	g»t
;

1346 
boŞ
 
	gScheduËI‹mMÚth
::
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû_1
 &
¦iû
, *
u£r_d©a
 )

1348 ià(! 
IsV®idSliû
(
¦iû
)è 
	gçl£
;

1350 
EXPAND_SLOTS_IF_NEED
();

1352 
scheduË_¦iû
 *
	gÃw_™em
 = 
NULL
;

1353 
	gÃw_™em
 = 
Ãw
 
scheduË_¦iû
;

1354 ià(
	gNULL
 =ğ
Ãw_™em
)

1355  
çl£
;

1356 
	gÃw_™em
->
	gty³
 = 
ty³
;

1357 
	gÃw_™em
->
	gis_Ãxt
 = 
¦iû
.
is_Ãxt
;

1358 
	gÃw_™em
->
	g¡¬t
 = 
¦iû
.
¡¬t
;

1359 
	gÃw_™em
->
	g’d
 = 
¦iû
.
’d
;

1360 
	gÃw_™em
->
	gu£r_d©a
 = 
u£r_d©a
;

1361 
	g™ems
[ 
™ems_couÁ
++ ] = 
Ãw_™em
;

1363 
	gscheduË_ty³
 = 
kMÚthScheduËDay1
;

1364 
	gscheduË_d‘a
.
	gday1
.
	gmÚth
 = 
¦iû
.
mÚth
;

1365 
	gscheduË_d‘a
.
	gday1
.
	gday
 = 
¦iû
.
day
;

1367  
	gŒue
;

1370 
boŞ
 
	gScheduËI‹mMÚth
::
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû_2
 &
¦iû
)

1372 ià(! 
IsV®idSliû
(
¦iû
)è 
	gçl£
;

1374 
EXPAND_SLOTS_IF_NEED
();

1376 
scheduË_¦iû
 *
	gÃw_™em
 = 
NULL
;

1377 
	gÃw_™em
 = 
Ãw
 
scheduË_¦iû
;

1378 
	gÃw_™em
->
	gty³
 = 
ty³
;

1379 
	gÃw_™em
->
	gis_Ãxt
 = 
¦iû
.
is_Ãxt
;

1380 
	gÃw_™em
->
	g¡¬t
 = 
¦iû
.
¡¬t
;

1381 
	gÃw_™em
->
	g’d
 = 
¦iû
.
’d
;

1382 
	g™ems
[ 
™ems_couÁ
++ ] = 
Ãw_™em
;

1384 
	gscheduË_ty³
 = 
kMÚthScheduËW“k1
;

1385 
	gscheduË_d‘a
.
	gw“k1
.
	gwhich_w“k
 = 
¦iû
.
which_w“k
;

1386 
	gscheduË_d‘a
.
	gw“k1
.
	gw“k
 = 
¦iû
.
w“k
 % 7;

1388  
	gŒue
;

1391 
boŞ
 
	gScheduËI‹mMÚth
::
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû_3
 &
¦iû
, *
u£r_d©a
 )

1393 ià(! 
IsV®idSliû
(
¦iû
)è 
	gçl£
;

1395 
EXPAND_SLOTS_IF_NEED
();

1397 
scheduË_¦iû
 *
	gÃw_™em
 = 
NULL
;

1398 
	gÃw_™em
 = 
Ãw
 
scheduË_¦iû
;

1399 
	gÃw_™em
->
	gty³
 = 
ty³
;

1400 
	gÃw_™em
->
	gis_Ãxt
 = 
¦iû
.
is_Ãxt
;

1401 
	gÃw_™em
->
	g¡¬t
 = 
¦iû
.
¡¬t
;

1402 
	gÃw_™em
->
	g’d
 = 
¦iû
.
’d
;

1403 
	gÃw_™em
->
	gu£r_d©a
 = 
u£r_d©a
;

1404 
	g™ems
[ 
™ems_couÁ
++ ] = 
Ãw_™em
;

1406 
	gscheduË_ty³
 = 
kMÚthScheduËW“k2
;

1407 
	gscheduË_d‘a
.
	gw“k2
.
	gmÚth
 = 
¦iû
.
mÚth
;

1408 
	gscheduË_d‘a
.
	gw“k2
.
	gnumb”
 = 
¦iû
.
numb”
;

1409 
	gscheduË_d‘a
.
	gw“k2
.
	gw“k
 = 
¦iû
.
w“k
 % 7;

1411  
	gŒue
;

1414 
boŞ
 
	gScheduËI‹mMÚth
::
IsV®idSliû
(cÚ¡ 
time_¦iû_1
 &
¦iû
) const

1416 ià(! 
IsV®idTime
(
¦iû
èè 
çl£
;

1418 
	gm
 = 
¦iû
.
mÚth
;

1419 ià((
	gm
<-1è|| (0==
m
è|| (m>12)è 
çl£
;

1421 
	gd
 = 
¦iû
.
day
;

1422 ià(
	gd
<1 || d>32è 
	gçl£
;

1424 ià(
	gNULL
 =ğ
™ems
è 
Œue
;

1425 ià(
	g™ems_couÁ
<1è 
	gŒue
;

1427 ià(
	gscheduË_ty³
 !ğ
kMÚthScheduËDay1
è 
çl£
;

1429 ià(
	gscheduË_d‘a
.
	gday1
.
	gmÚth
 !ğ
m
è 
çl£
;

1430 ià(
	gscheduË_d‘a
.
	gday1
.
	gday
 !ğ
d
è 
çl£
;

1432 
	gt1
 = 
¦iû
.
¡¬t
;

1433 
	gt2
 = 
¦iû
.
’d
;

1434 
	gn
 = 
¦iû
.
is_Ãxt
;

1435 
	gx
, 
	gy
, 
	gz
;

1436 
	gi
=0; i<
	g™ems_couÁ
; i++)

1438 
	gx
 = 
™ems
[
i
]->
¡¬t
;

1439 
	gy
 = 
™ems
[
i
]->
’d
;

1440 
	gz
 = 
™ems
[
i
]->
is_Ãxt
;

1442 ià(
	gn
 !ğ
z
) ;

1444 ià(
is_Ïµed
(
t1
, 
t2
, 
x
, 
y
))

1445  
	gçl£
;

1448  
	gŒue
;

1451 
boŞ
 
	gScheduËI‹mMÚth
::
IsV®idSliû
(cÚ¡ 
time_¦iû_2
 &
¦iû
) const

1453 ià(! 
IsV®idTime
(
¦iû
èè 
çl£
;

1455 
	gm
 = 
¦iû
.
mÚth
;

1456 ià((
	gm
<-1è|| (0==
m
è|| (m>12)è 
çl£
;

1458 
	gww
 = 
¦iû
.
which_w“k
;

1459 ià((
	gww
<-1è|| (0==
ww
è|| (ww>5)è 
çl£
;

1461 
	gwww
 = 
¦iû
.
w“k
;

1462 ià((
	gwww
<0è|| (www>7)è 
	gçl£
;

1464 ià(
	gNULL
 =ğ
™ems
è 
Œue
;

1465 ià(
	g™ems_couÁ
<1è 
	gŒue
;

1467 ià(
	gscheduË_ty³
 !ğ
kMÚthScheduËW“k1
è 
çl£
;

1469 iàĞ(
	gww
 !ğ
scheduË_d‘a
.
w“k1
.
which_w“k
)

1470 || (
www
 !ğ
scheduË_d‘a
.
w“k1
.
w“k
) )

1471  
çl£
;

1473 
	gn
 = 
¦iû
.
is_Ãxt
;

1474 
	gt1
 = 
¦iû
.
¡¬t
;

1475 
	gt2
 = 
¦iû
.
’d
;

1476 
	gv
, 
	gw
, 
	gx
, 
	gy
, 
	gz
;

1477 
	gi
=0; i<
	g™ems_couÁ
; i++)

1479 
	gx
 = 
™ems
[
i
]->
¡¬t
;

1480 
	gy
 = 
™ems
[
i
]->
’d
;

1481 
	gz
 = 
™ems
[
i
]->
is_Ãxt
;

1483 ià(
	gn
 !ğ
z
) ;

1485 ià(
is_Ïµed
(
t1
, 
t2
, 
x
, 
y
))

1486  
	gçl£
;

1489  
	gŒue
;

1492 
boŞ
 
	gScheduËI‹mMÚth
::
IsV®idSliû
(cÚ¡ 
time_¦iû_3
 &
¦iû
) const

1494 ià(! 
IsV®idTime
(
¦iû
èè 
çl£
;

1496 
	gm
 = 
¦iû
.
mÚth
;

1497 ià((
	gm
<-1è|| (0==
m
è|| (m>12)è 
çl£
;

1499 
	gww
 = 
¦iû
.
numb”
;

1500 ià((
	gww
<-1è|| (0==
ww
è|| (ww>5)è 
çl£
;

1502 
	gwww
 = 
¦iû
.
w“k
;

1503 ià((
	gwww
<0è|| (www>7)è 
	gçl£
;

1505 ià(
	gNULL
 =ğ
™ems
è 
Œue
;

1506 ià(
	g™ems_couÁ
<1è 
	gŒue
;

1508 ià(
	gscheduË_ty³
 !ğ
kMÚthScheduËW“k2
è 
çl£
;

1510 iàĞ(
	gww
 !ğ
scheduË_d‘a
.
w“k2
.
numb”
)

1511 || (
www
 !ğ
scheduË_d‘a
.
w“k2
.
w“k
) )

1512  
çl£
;

1514 
	gn
 = 
¦iû
.
is_Ãxt
;

1515 
	gt1
 = 
¦iû
.
¡¬t
;

1516 
	gt2
 = 
¦iû
.
’d
;

1517 
	gx
, 
	gy
, 
	gz
;

1518 
	gi
=0; i<
	g™ems_couÁ
; i++)

1520 
	gx
 = 
™ems
[
i
]->
¡¬t
;

1521 
	gy
 = 
™ems
[
i
]->
’d
;

1522 
	gz
 = 
™ems
[
i
]->
is_Ãxt
;

1524 ià(
	gn
 !ğ
z
) ;

1526 ià(
is_Ïµed
(
t1
, 
t2
, 
x
, 
y
))

1527  
	gçl£
;

1530  
	gŒue
;

1534 
	gScheduËI‹mMÚth
& ScheduËI‹mMÚth::
İ”©Ü
=(cÚ¡ 
ScheduËI‹mMÚth
& 
rhs
)

1536 
Re£t
();

1537 
	grhs
.
	gscheduË_ty³
) {

1538 
	gkMÚthScheduËDay1
:

1540 
time_¦iû_1
 
¦iû
;

1541 
	gi
 = 0; i < 
	grhs
.
	g™ems_couÁ
; i++) {

1542 
	g¦iû
.
	gmÚth
 = 
rhs
.
scheduË_d‘a
.
day1
.
mÚth
;

1543 
	g¦iû
.
	gday
 = 
rhs
.
scheduË_d‘a
.
day1
.
day
;

1544 
	g¦iû
.
	gis_Ãxt
 = 
rhs
.
™ems
[
i
]->
is_Ãxt
;

1545 
	g¦iû
.
	g¡¬t
 = 
rhs
.
™ems
[
i
]->
¡¬t
;

1546 
	g¦iû
.
	g’d
 = 
rhs
.
™ems
[
i
]->
’d
;

1548 
AddTimeSliû
(
rhs
.
™ems
[
i
]->
ty³
, 
¦iû
,„hs.™ems[i]->
u£r_d©a
);

1551  *
	gthis
;

1552 
	gkMÚthScheduËW“k2
:

1554 
time_¦iû_3
 
¦iû
;

1555 
	gi
 = 0; i < 
	grhs
.
	g™ems_couÁ
; i++) {

1556 
	g¦iû
.
	gmÚth
 = 
rhs
.
scheduË_d‘a
.
w“k2
.
mÚth
;

1557 
	g¦iû
.
	gnumb”
 = 
rhs
.
scheduË_d‘a
.
w“k2
.
numb”
;

1558 
	g¦iû
.
	gw“k
 = 
rhs
.
scheduË_d‘a
.
w“k2
.
w“k
;

1559 
	g¦iû
.
	gis_Ãxt
 = 
rhs
.
™ems
[
i
]->
is_Ãxt
;

1560 
	g¦iû
.
	g¡¬t
 = 
rhs
.
™ems
[
i
]->
¡¬t
;

1561 
	g¦iû
.
	g’d
 = 
rhs
.
™ems
[
i
]->
’d
;

1563 
AddTimeSliû
(
rhs
.
™ems
[
i
]->
ty³
, 
¦iû
,„hs.™ems[i]->
u£r_d©a
);

1566  *
	gthis
;

1567 
	gkMÚthScheduËNÚe
:

1568 
kMÚthScheduËW“k1
:

1569 
kMÚthScheduËLa¡
:

1570  *
this
;

1573  *
	gthis
;

1578 
	gScheduËI‹mS³cificDay
::
scheduË_¦iû
 {

1579 
ACTIVE_TYPE
 
ty³
;

1580 
	gy—r
;

1581 
	gmÚth
;

1582 
	gday
;

1583 
	gis_Ãxt
;

1584 
	g¡¬t
;

1585 
	g’d
;

1586 *
	gu£r_d©a
;

1589 
	gScheduËI‹mS³cificDay
::
ScheduËI‹mS³cificDay
()

1590 : 
™ems
(
NULL
), 
™ems_couÁ
(0), 
™ems_size
(0)

1594 
	gScheduËI‹mS³cificDay
::~
ScheduËI‹mS³cificDay
()

1596 ià(
™ems
!=
NULL
)

1598 
Re£t
();

1599 
	gd–‘e
 [] 
	g™ems
;

1600 
	g™ems
 = 
NULL
;

1602 
	g™ems_couÁ
 = 0;

1603 
	g™ems_size
 = 0;

1606 
	gScheduËI‹mS³cificDay
::
Re£t
()

1608 ià(
™ems
!=
NULL
)

1610 ià(
™ems_couÁ
>0)

1612 
i
=0; 
	gi
<
	g™ems_couÁ
; ++i)

1614 ià(
	g™ems
[
i
]!=
NULL
)

1616 
d–‘e
 
™ems
[
i
];

1617 
	g™ems
[
i
] = 
NULL
;

1621 
	g™ems_couÁ
 = 0;

1625 
boŞ
 
	gScheduËI‹mS³cificDay
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const

1627 ià(
	gNULL
 =ğ
bË
è 
çl£
;

1628 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

1630 cÚ¡ 
UTCTimeS·n
 
¥ª_1day
(1, 0, 0, 0);

1631 cÚ¡ 
UTCTime
 
	g´ev_d©e_time
 = 
d©e_time
 - 
¥ª_1day
;

1633 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

1634 
SYSTEMTIME
 
	g¡_´ev
 = 
´ev_d©e_time
;

1636 cÚ¡ 
	gy1
 = 
¡
.
wY—r
;

1637 cÚ¡ 
	gm1
 = 
¡
.
wMÚth
;

1638 cÚ¡ 
	gd1
 = 
¡
.
wDay
;

1640 cÚ¡ 
	gy2
 = 
¡_´ev
.
wY—r
;

1641 cÚ¡ 
	gm2
 = 
¡_´ev
.
wMÚth
;

1642 cÚ¡ 
	gd2
 = 
¡_´ev
.
wDay
;

1644 
	gi
=0; i<
	g™ems_couÁ
; ++i)

1646 cÚ¡ 
scheduË_¦iû
 *
	g±r
 = 
™ems
[
i
];

1647 cÚ¡ 
	gy0
 = 
±r
->
y—r
;

1648 cÚ¡ 
	gm0
 = 
±r
->
mÚth
;

1649 cÚ¡ 
	gd0
 = 
±r
->
day
;

1651 
	gmy_d©e_¡©us
 = 0;

1653 ià(
	gy0
<0 || 
	gm0
<0 || 
	gd0
<0) ;

1655 ià((
	gy0
==
y1
è&& (
m0
==
m1
è&& (
d0
==
d1
)è
my_d©e_¡©us
 = 1;

1656 ià((
	gy0
==
y2
è&& (
m0
==
m2
è&& (
d0
==
d2
)è
my_d©e_¡©us
 = -1;

1658 ià(0 =ğ
my_d©e_¡©us
) ;

1660 ià((
	g±r
->
	gis_Ãxt
è&& (
	gmy_d©e_¡©us
!=-1)) ;

1661 ià((0==
±r
->
is_Ãxt
è&& (
my_d©e_¡©us
!=1)) ;

1663 ià(
	gkAT_ACTIVE
 =ğ
±r
->
ty³
)

1664 
bË
->
S‘Rªge
(
±r
->
¡¬t
,…Œ->
’d
,…Œ->
u£r_d©a
);

1665 ià(
	gkAT_INACTIVE
 =ğ
±r
->
ty³
)

1666 
bË
->
Inv®idRªge
(
±r
->
¡¬t
,…Œ->
’d
,…Œ->
u£r_d©a
);

1669  
	gŒue
;

1672 
boŞ
 
	gScheduËI‹mS³cificDay
::
MaskAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
)

1674 ià(
	gNULL
 =ğ
bË
è 
çl£
;

1675 ià(
	gNULL
 =ğ
™ems
 || 
™ems_couÁ
<1è 
Œue
;

1677 cÚ¡ 
UTCTimeS·n
 
¥ª_1day
(1, 0, 0, 0);

1678 cÚ¡ 
UTCTime
 
	g´ev_d©e_time
 = 
d©e_time
 - 
¥ª_1day
;

1680 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

1681 
SYSTEMTIME
 
	g¡_´ev
 = 
´ev_d©e_time
;

1683 cÚ¡ 
	gy1
 = 
¡
.
wY—r
;

1684 cÚ¡ 
	gm1
 = 
¡
.
wMÚth
;

1685 cÚ¡ 
	gd1
 = 
¡
.
wDay
;

1687 cÚ¡ 
	gy2
 = 
¡_´ev
.
wY—r
;

1688 cÚ¡ 
	gm2
 = 
¡_´ev
.
wMÚth
;

1689 cÚ¡ 
	gd2
 = 
¡_´ev
.
wDay
;

1691 
	gi
=0; i<
	g™ems_couÁ
; ++i)

1693 cÚ¡ 
scheduË_¦iû
 *
	g±r
 = 
™ems
[
i
];

1694 cÚ¡ 
	gy0
 = 
±r
->
y—r
;

1695 cÚ¡ 
	gm0
 = 
±r
->
mÚth
;

1696 cÚ¡ 
	gd0
 = 
±r
->
day
;

1698 
	gmy_d©e_¡©us
 = 0;

1700 ià(
	gy0
<0 || 
	gm0
<0 || 
	gd0
<0) ;

1702 ià((
	gy0
==
y1
è&& (
m0
==
m1
è&& (
d0
==
d1
)è
my_d©e_¡©us
 = 1;

1703 ià((
	gy0
==
y2
è&& (
m0
==
m2
è&& (
d0
==
d2
)è
my_d©e_¡©us
 = -1;

1705 ià(0 =ğ
my_d©e_¡©us
) ;

1707 ià((
	g±r
->
	gis_Ãxt
è&& (
	gmy_d©e_¡©us
!=-1)) ;

1708 ià((0==
±r
->
is_Ãxt
è&& (
my_d©e_¡©us
!=1)) ;

1710 
ACTIVE_TYPE
 
	gty³
 = 
kAT_NONE
;

1711 *
	gu£r_d©a
 = 
NULL
;

1712 ià(
	g©CÚ‹Á
.
size
()) {

1713 
	gty³
 = 
©CÚ‹Á
[*
scheduË_id
].
aùiveTy³
;

1714 
	gu£r_d©a
 = 
©CÚ‹Á
[*
scheduË_id
].
pU£rD©a
;

1716 
	gty³
 = 
±r
->
ty³
;

1717 
	gu£r_d©a
 = 
±r
->
u£r_d©a
;

1720 ià(
	gkAT_ACTIVE
 =ğ
ty³
)

1721 
bË
->
S‘Rªge
(
±r
->
¡¬t
,…Œ->
’d
, 
u£r_d©a
);

1722 ià(
	gkAT_INACTIVE
 =ğ
ty³
)

1723 
bË
->
Inv®idRªge
(
±r
->
¡¬t
,…Œ->
’d
, 
u£r_d©a
);

1726  
	gŒue
;

1729 
boŞ
 
	gScheduËI‹mS³cificDay
::
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû
 &
¦iû
, *
u£r_d©a
 )

1731 ià(!
IsV®idSliû
(
¦iû
))

1732  
	gçl£
;

1734 
EXPAND_SLOTS_IF_NEED
();

1736 
scheduË_¦iû
 *
	gÃw_™em
 = 
NULL
;

1737 
	gÃw_™em
 = 
Ãw
 
scheduË_¦iû
;

1738 
	gÃw_™em
->
	gty³
 = 
ty³
;

1739 
	gÃw_™em
->
	gis_Ãxt
 = 
¦iû
.
is_Ãxt
;

1740 
	gÃw_™em
->
	g¡¬t
 = 
¦iû
.
¡¬t
;

1741 
	gÃw_™em
->
	g’d
 = 
¦iû
.
’d
;

1742 
	gÃw_™em
->
	gu£r_d©a
 = 
u£r_d©a
;

1743 
	gÃw_™em
->
	gy—r
 = 
¦iû
.
y—r
;

1744 
	gÃw_™em
->
	gmÚth
 = 
¦iû
.
mÚth
;

1745 
	gÃw_™em
->
	gday
 = 
¦iû
.
day
;

1746 
	g™ems
[ 
™ems_couÁ
++ ] = 
Ãw_™em
;

1748  
	gŒue
;

1750 
	gScheduËI‹mS³cificDay
& ScheduËI‹mS³cificDay::
İ”©Ü
=(cÚ¡ 
ScheduËI‹mS³cificDay
& 
rhs
)

1752 
Re£t
();

1753 
	gi
 = 0; i < 
	grhs
.
	g™ems_couÁ
; i++) {

1754 
time_¦iû
 
	g¦iû
;

1755 
	g¦iû
.
	gday
 = 
rhs
.
™ems
[
i
]->
day
;

1756 
	g¦iû
.
	gmÚth
 = 
rhs
.
™ems
[
i
]->
mÚth
;

1757 
	g¦iû
.
	gy—r
 = 
rhs
.
™ems
[
i
]->
y—r
;

1758 
	g¦iû
.
	g’d
 = 
rhs
.
™ems
[
i
]->
’d
;

1759 
	g¦iû
.
	g¡¬t
 = 
rhs
.
™ems
[
i
]->
¡¬t
;

1760 
	g¦iû
.
	gis_Ãxt
 = 
rhs
.
™ems
[
i
]->
is_Ãxt
;

1762 
AddTimeSliû
(
rhs
.
™ems
[
i
]->
ty³
, 
¦iû
,„hs.™ems[i]->
u£r_d©a
);

1765  *
	gthis
;

1768 
boŞ
 
	gScheduËI‹mS³cificDay
::
IsV®idSliû
(cÚ¡ 
time_¦iû
 &
¦iû
) const

1770 
tm
 
tm1
;

1771 
time_t
 
	g‰
;

1773 ià(! 
IsV®idTime
(
¦iû
èè 
	gçl£
;

1775 
	gtm1
.
	gtm_£c
 = 0;

1776 
	gtm1
.
	gtm_mš
 = 0;

1777 
	gtm1
.
	gtm_hour
 = 0;

1778 
	gtm1
.
	gtm_mday
 = 
¦iû
.
day
;

1779 
	gtm1
.
	gtm_mÚ
 = 
¦iû
.
mÚth
 - 1;

1780 
	gtm1
.
	gtm_y—r
 = 
¦iû
.
y—r
-1900;

1782 
	g‰
 = 
mktime
(&
tm1
);

1783 ià((
	gtime_t
è-1 =ğ
‰
è 
çl£
;

1786 ià(
	gtm1
.
	gtm_y—r
 !ğ(
¦iû
.
y—r
-1900)è 
çl£
;

1787 ià(
	gtm1
.
	gtm_mÚ
 !ğ(
¦iû
.
mÚth
 - 1)è 
çl£
;

1788 ià(
	gtm1
.
	gtm_mday
 !ğ
¦iû
.
day
è 
çl£
;

1790 ià(
	gNULL
 =ğ
™ems
è 
Œue
;

1791 ià(
	g™ems_couÁ
<1è 
	gŒue
;

1797 
	gt1
 = 
¦iû
.
¡¬t
;

1798 
	gt2
 = 
¦iû
.
’d
;

1799 
	gx
, 
	gy
;

1800 
	gi
=0; i<
	g™ems_couÁ
; i++)

1802 
	gx
 = 
™ems
[
i
]->
¡¬t
;

1803 
	gy
 = 
™ems
[
i
]->
’d
;

1805 ià(
is_Ïµed
(
t1
, 
t2
, 
x
, 
y
))

1806  
	gçl£
;

1809  
	gŒue
;

	@../../titanutils/schedule/ScheduleBricks.h

1 #iâdeà
__SCHEDULEBRICKS_H__


2 
	#__SCHEDULEBRICKS_H__


	)

4 
	~"ScheduËProfe.h
"

6 
Çme¥aû
 
	gScheduË
 {

8 şas 
	cScheduËI‹mDay
 : 
public
 
ScheduËI‹mBa£
 {

9 
public
:

10 
	stime_¦iû
 {

11 
¡¬t
;

12 
	g’d
;

15 
ex¶ic™
 
ScheduËI‹mDay
();

16 
	gvœtu®
 ~
ScheduËI‹mDay
();

18 
vœtu®
 
Re£t
();

19 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const;

20 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
);

22 
boŞ
 
IsV®idSliû
(cÚ¡ 
time_¦iû
 &
¦iû
) const;

23 
boŞ
 
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû
 &
¦iû
, *
u£r_d©a
 = 
NULL
);

25 
	gScheduËI‹mDay
& 
	gİ”©Ü
=(cÚ¡ 
ScheduËI‹mDay
& 
rhs
);

26 
šlše
 
vœtu®
 
ITEM_TYPE
 
G‘I‹mTy³
(è{ 
	gITEM_TYPE_DAY
;}

28 
	g´Ùeùed
:

29 
scheduË_¦iû
;

31 
scheduË_¦iû
 **
	g™ems
;

32 
	g™ems_couÁ
;

33 
	g™ems_size
;

36 şas 
	cScheduËI‹mW“k
 : 
public
 
ScheduËI‹mBa£
 {

37 
public
:

38 
	stime_¦iû
 {

39 
w“k
;

40 
	g¡¬t
;

41 
	g’d
;

44 
ex¶ic™
 
ScheduËI‹mW“k
();

45 
	gvœtu®
 ~
ScheduËI‹mW“k
();

47 
vœtu®
 
Re£t
();

48 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const;

49 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
);

51 
boŞ
 
IsV®idSliû
(cÚ¡ 
time_¦iû
 &
¦iû
) const;

52 
boŞ
 
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû
 &
¦iû
, *
u£r_d©a
 = 
NULL
);

54 
	gScheduËI‹mW“k
& 
	gİ”©Ü
=(cÚ¡ 
ScheduËI‹mW“k
& 
rhs
);

55 
šlše
 
vœtu®
 
ITEM_TYPE
 
G‘I‹mTy³
(è{ 
	gITEM_TYPE_WEEK
;}

57 
	g´Ùeùed
:

58 
scheduË_¦iû
;

60 
scheduË_¦iû
 **
	g™ems
[7];

61 
	g™ems_couÁ
[7];

62 
	g™ems_size
[7];

65 şas 
	cScheduËI‹mMÚth
 : 
public
 
ScheduËI‹mBa£
 {

66 
public
:

67 
	stime_¦iû_1
 {

68 
mÚth
;

69 
	gday
;

70 
	gis_Ãxt
;

71 
	g¡¬t
;

72 
	g’d
;

75 
	stime_¦iû_2
 {

76 
	gmÚth
;

77 
	gwhich_w“k
;

78 
	gw“k
;

79 
	gis_Ãxt
;

80 
	g¡¬t
;

81 
	g’d
;

84 
	stime_¦iû_3
 {

85 
	gmÚth
;

86 
	gnumb”
;

87 
	gw“k
;

88 
	gis_Ãxt
;

89 
	g¡¬t
;

90 
	g’d
;

93 
ex¶ic™
 
ScheduËI‹mMÚth
();

94 
	gvœtu®
 ~
ScheduËI‹mMÚth
();

96 
vœtu®
 
Re£t
();

97 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const;

98 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
);

100 
boŞ
 
IsV®idSliû
(cÚ¡ 
time_¦iû_1
 &
¦iû
) const;

102 
boŞ
 
IsV®idSliû
(cÚ¡ 
time_¦iû_3
 &
¦iû
) const;

103 
boŞ
 
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû_1
 &
¦iû
, *
u£r_d©a
 = 
NULL
);

105 
boŞ
 
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû_3
 &
¦iû
, *
u£r_d©a
 = 
NULL
);

107 
	gScheduËI‹mMÚth
& 
	gİ”©Ü
=(cÚ¡ 
ScheduËI‹mMÚth
& 
rhs
);

108 
šlše
 
vœtu®
 
ITEM_TYPE
 
G‘I‹mTy³
(è{ 
	gITEM_TYPE_MONTH
;}

110 
	g´Ùeùed
:

111 
boŞ
 
MaskAùiveTabË1
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, cÚ¡ SYSUTILS_SPACE::UTCTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
) const;

112 
boŞ
 
MaskAùiveTabË1
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, cÚ¡ SYSUTILS_SPACE::UTCTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
);

114 
boŞ
 
MaskAùiveTabË3
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, cÚ¡ SYSUTILS_SPACE::UTCTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
) const;

115 
boŞ
 
MaskAùiveTabË3
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, cÚ¡ SYSUTILS_SPACE::UTCTim&
´ev_d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
);

117 
	gscheduË_¦iû
;

118 
	emÚth_scheduË_ty³
 {

119 
	gkMÚthScheduËNÚe
 = 0,

121 
	gkMÚthScheduËDay1
,

122 
	gkMÚthScheduËW“k1
,

123 
	gkMÚthScheduËW“k2
,

125 
	gkMÚthScheduËLa¡


128 
scheduË_¦iû
 **
	g™ems
;

129 
	g™ems_couÁ
;

130 
	g™ems_size
;

132 
mÚth_scheduË_ty³
 
	gscheduË_ty³
;

135 
	gmÚth
;

136 
	gday
;

137 } 
	gday1
;

139 
	gmÚth
;

140 
	gwhich_w“k
;

141 
	gw“k
;

142 } 
	gw“k1
;

144 
	gmÚth
;

145 
	gnumb”
;

146 
	gw“k
;

147 } 
	gw“k2
;

148 } 
	gscheduË_d‘a
;

151 şas 
	cScheduËI‹mS³cificDay
 : 
public
 
ScheduËI‹mBa£
 {

152 
public
:

153 
	stime_¦iû
 {

154 
day
;

155 
	gmÚth
;

156 
	gy—r
;

157 
	gis_Ãxt
;

158 
	g¡¬t
;

159 
	g’d
;

162 
ex¶ic™
 
ScheduËI‹mS³cificDay
();

163 
	gvœtu®
 ~
ScheduËI‹mS³cificDay
();

165 
vœtu®
 
Re£t
();

166 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const;

167 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
);

169 
boŞ
 
IsV®idSliû
(cÚ¡ 
time_¦iû
 &
¦iû
) const;

170 
boŞ
 
AddTimeSliû
(
ACTIVE_TYPE
 
ty³
, cÚ¡ 
time_¦iû
 &
¦iû
, *
u£r_d©a
 = 
NULL
);

172 
	gScheduËI‹mS³cificDay
& 
	gİ”©Ü
=(cÚ¡ 
ScheduËI‹mS³cificDay
& 
rhs
);

173 
šlše
 
vœtu®
 
ITEM_TYPE
 
G‘I‹mTy³
(è{ 
	gITEM_TYPE_SPECIFIC_DAY
;}

175 
	g´Ùeùed
:

176 
scheduË_¦iû
;

178 
scheduË_¦iû
 **
	g™ems
;

179 
	g™ems_couÁ
;

180 
	g™ems_size
;

	@../../titanutils/schedule/ScheduleProfile.cpp

1 
	~<¡ršg.h
>

2 
	~<¡dlib.h
>

4 
	~"debugMsg/Debug.h
"

5 
	~"ScheduËProfe.h
"

6 
	~"ScheduËBricks.h
"

7 
	~"AùiveTabË.h
"

8 
	~"commÚ/ut™y.h
"

9 
	~"commÚ/time.h
"

11 
	#ACTIVE_TABLE_SIZE
 1440

	)

12 
	#DEFAULT_SIS_SIZE
 8

	)

14 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

16 
Çme¥aû
 
	gScheduË
 {

18 
	gProfeSourû
::
ProfeSourû
()

19 : 
™em_upd©ed
(
çl£
), 
scheduË_™em_£t
(
NULL
), 
scheduË_™em_£t_couÁ
(0),

20 
scheduË_™em_£t_size
(0), 
cs_sis
()

22 
TRACE
("EÁ”šg %s...\n", 
__FUNCTION_SIGNATURE__
);

25 
	gProfeSourû
::~
ProfeSourû
()

27 
TRACE
("EÁ”šg %s...\n", 
__FUNCTION_SIGNATURE__
);

29 
R–—£ScheduËI‹mS‘
();

32 
boŞ
 
	gProfeSourû
::
G‘AùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
©
)

34 ià(
	gNULL
 =ğ
©
)

35  
çl£
;

37 
	g©
->
Re£t
();

39 ià(
	gscheduË_™em_£t_couÁ
<1)

40  
	gŒue
;

42 
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

44 
	gj
 = 0;

45 
ScheduËI‹mS‘
 *
	gsis
;

46 
	gi
=0; i<
	gscheduË_™em_£t_couÁ
; ++i)

48 
	gsis
 = 
scheduË_™em_£t
[
i
];

49 ià(
	gsis
!=
NULL
)

51 ià(
sis
->
MaskAùiveTabË
(
d©e_time
, 
©
, 
aùiveTabËCÚ‹Á
))

52 ++
j
;

54 ià(
	gj
>3)

55 
	g©
->
CouÁMasked
();

57 ià(
	g©
->
IsFuÎFl
())

61  
	gŒue
;

64 
	gProfeSourû
::
Re£tScheduËI‹mS‘
()

66 
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

68 ià(
	gscheduË_™em_£t
!=
NULL
)

70 ià(
scheduË_™em_£t_couÁ
>0)

72 
i
=0; 
	gi
<
	gscheduË_™em_£t_couÁ
; ++i)

74 ià(
	gscheduË_™em_£t
[
i
]!=
NULL
)

76 
d–‘e
 
scheduË_™em_£t
[
i
];

77 
	gscheduË_™em_£t
[
i
] = 
NULL
;

81 
	gscheduË_™em_£t_couÁ
 = 0;

85 
	gProfeSourû
::
R–—£ScheduËI‹mS‘
()

87 ià(
scheduË_™em_£t_couÁ
>0)

88 
Re£tScheduËI‹mS‘
();

90 
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

92 ià(
	gscheduË_™em_£t
!=
NULL
)

94 
d–‘e
 [] 
scheduË_™em_£t
;

95 
	gscheduË_™em_£t
 = 
NULL
;

96 
	gscheduË_™em_£t_size
 = 0;

100 
boŞ
 
	gProfeSourû
::
Adju¡ScheduËI‹mS‘ToSize
(
n
)

102 ià(
n
<1è 
çl£
;

103 ià(
	gn
==
scheduË_™em_£t_size
è 
Œue
;

105 
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

107 
ScheduËI‹mS‘
 **
	gÃw_£t
 = 
NULL
;

108 
	gÃw_£t
 = 
Ãw
 
ScheduËI‹mS‘
 *[
n
];

109 ià(
	gNULL
 =ğ
Ãw_£t
)

111 
TRACE
("allocate‚ew ScheduleItemSet ** failed.\n");

112  
	gçl£
;

114 
mem£t
(
Ãw_£t
, 0, (
ScheduËI‹mS‘
 *)*
n
);

116 
	gı_Ën
 = 0;

117 ià(
	gscheduË_™em_£t
!=
NULL
)

119 
ı_Ën
 = (
scheduË_™em_£t_size
>=
n
) ?‚ : schedule_item_set_size;

120 ià(
	gı_Ën
>0)

121 
memıy
(
Ãw_£t
, 
scheduË_™em_£t
, 
ı_Ën
*(
ScheduËI‹mS‘
 *));

124 ià(
	gı_Ën
<
	gscheduË_™em_£t_size
)

126 
	gi
=
ı_Ën
; 
	gı_Ën
<
	gscheduË_™em_£t_size
; ++i)

128 ià(
	gscheduË_™em_£t
[
i
]!=
NULL
)

130 
d–‘e
 
scheduË_™em_£t
[
i
];

131 
	gscheduË_™em_£t
[
i
] = 
NULL
;

136 ià(
	gscheduË_™em_£t
!=
NULL
)

137 
d–‘e
 [] 
scheduË_™em_£t
;

139 
	gscheduË_™em_£t
 = 
Ãw_£t
;

140 
	gscheduË_™em_£t_size
 = 
n
;

142  
	gŒue
;

145 
boŞ
 
	gProfeSourû
::
AddScheduËI‹mS‘
(cÚ¡ 
ScheduËI‹mS‘
 &
sis
)

147 ià(
scheduË_™em_£t_couÁ
>=
scheduË_™em_£t_size
)

149 
n
 = 
scheduË_™em_£t_size
>0 ? scheduË_™em_£t_size*2 : 
DEFAULT_SIS_SIZE
;

150 ià(! 
Adju¡ScheduËI‹mS‘ToSize
(
n
))

152 
TRACE
("çedØadju¡ scheduË i‹m s‘ sizäom %dØ%d.\n", 
scheduË_™em_£t_size
, 
n
);

156 
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

158 
ScheduËI‹mS‘
 *
	gšs_£t
 = 
Ãw
 ScheduleItemSet;

159 ià(
	gNULL
 =ğ
šs_£t
)

161 
TRACE
("failedo‡llocate ScheduleItemSet.\n");

162  
	gçl£
;

164 *
	gšs_£t
 = 
sis
;

165 
	gscheduË_™em_£t
[ 
scheduË_™em_£t_couÁ
++ ] = 
šs_£t
;

167  
	gŒue
;

170 
	gProfeSourû
& ProfeSourû::
İ”©Ü
=(cÚ¡ 
ProfeSourû
 &
rhs
)

172 
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

174 ià(
	gscheduË_™em_£t
)

176 ià(
	gscheduË_™em_£t_couÁ
>0)

178 
	gi
=0; i<
	gscheduË_™em_£t_couÁ
; ++i)

180 
d–‘e
 
	gscheduË_™em_£t
[
i
];

181 
	gscheduË_™em_£t
[
i
] = 
NULL
;

185 
	gd–‘e
 [] 
	gscheduË_™em_£t
;

186 
	gscheduË_™em_£t
 = 
NULL
;

187 
	gscheduË_™em_£t_couÁ
 = 0;

188 
	gscheduË_™em_£t_size
 = 0;

192 
Cr™iÿlSeùiÚLock
 
®
(&
rhs
.
cs_sis
);

194 ià(
	grhs
.
	gscheduË_™em_£t
!=
NULL
)

196 
Œy
 {

197 
scheduË_™em_£t
 = 
Ãw
 
ScheduËI‹mS‘
*[
rhs
.
scheduË_™em_£t_size
];

198 } 
ÿtch
 (
¡d
::
bad_®loc
) {

199 
scheduË_™em_£t
 = 
NULL
;

200 } 
ÿtch
 (...) {

201 
	gscheduË_™em_£t
 = 
NULL
;

204 
	gscheduË_™em_£t_size
 = 
rhs
.
scheduË_™em_£t_size
;

205 ià(
	gNULL
 =ğ
rhs
.
scheduË_™em_£t
)

207 
	gi
=0; i<
	gscheduË_™em_£t_size
; ++i)

208 
	gscheduË_™em_£t
[
i
] = 
NULL
;

210 
ScheduËI‹mS‘
 *
	gtmp
;

211 
	gscheduË_™em_£t_couÁ
 = 0;

212 
	gi
=0; i<
	grhs
.
	gscheduË_™em_£t_couÁ
; ++i)

214 
	gŒy
 { 
	gtmp
 = 
Ãw
 
ScheduËI‹mS‘
; } 
ÿtch
 (...è{m°ğ
NULL
; }

215 ià(
	gtmp
!=
NULL
)

217 
tmp
 = 
rhs
.
scheduË_™em_£t
[
i
];

218 
	gscheduË_™em_£t
[
scheduË_™em_£t_couÁ
++] = 
tmp
;

224  *
	gthis
;

227 
	gProfeSourû
::
S‘AùiveTabËCÚ‹Á
(
´iÜ™y
, 
ušt64_t
 &
scheduËID
, 
ScheduËI‹mBa£
::
ACTIVE_TYPE
 
ty³
, * 
pU£rD©a
) {

228 ià(
	gaùiveTabËCÚ‹Á
.
fšd
(
scheduËID
è!ğ
aùiveTabËCÚ‹Á
.
’d
()) {

229 
TRACE
("[ProfileSource] Duplicate schedule item. Check…riority\n");

230 ià(
	gaùiveTabËCÚ‹Á
[
scheduËID
].
	g´iÜ™y
 >…riority) {

231 
TRACE
("[ProfileSource] Higher…riority item configs. Set!\n");

232 
	gaùiveTabËCÚ‹Á
[
scheduËID
].
	g´iÜ™y
 = 
´iÜ™y
;

233 
	gaùiveTabËCÚ‹Á
[
scheduËID
].
	gpU£rD©a
 = 
pU£rD©a
;

234 
	gaùiveTabËCÚ‹Á
[
scheduËID
].
	gaùiveTy³
 = 
ty³
;

237 
TRACE
("[ProfileSource] Initial‚ew schedule item'sable content.\n");

238 
	gaùiveTabËCÚ‹Á
[
scheduËID
].
	g´iÜ™y
 = 
´iÜ™y
;

239 
	gaùiveTabËCÚ‹Á
[
scheduËID
].
	gpU£rD©a
 = 
pU£rD©a
;

240 
	gaùiveTabËCÚ‹Á
[
scheduËID
].
	gaùiveTy³
 = 
ty³
;

244 
ScheduËD©aStus
 
	gProfeSourû
::
CheckI‹mS‘Stus
() {

245 ià(!
scheduË_™em_£t
 || 
scheduË_™em_£t_couÁ
 < 1)

246  
SCHED_DATA_NONE
;

248 
ScheduËD©aStus
 
	ghighe¡
 = 
SCHED_DATA_NONE
;

249 
	gi
 = 0; i < 
	gscheduË_™em_£t_couÁ
; i++) {

250 ià(
	gscheduË_™em_£t
[
i
]) {

251 
ScheduËD©aStus
 
	gcu¼’t
 = 
scheduË_™em_£t
[
i
]->
CheckI‹mStus
();

252 ià(
	gcu¼’t
 =ğ
SCHED_DATA_DELETED
)

253  
cu¼’t
;

254 ià(
	gcu¼’t
 > 
	ghighe¡
)

255 
	ghighe¡
 = 
cu¼’t
;

259  
	ghighe¡
;

262 
boŞ
 
	gProfeSourû
::
Upd©eScheduËI‹mS‘
(
ScheduËI‹mSh¬eBa£
 &
™em
) {

263 ià(!
scheduË_™em_£t
 || 
scheduË_™em_£t_couÁ
 < 1)

264  
Œue
;

266 
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

268 
boŞ
 
	g»t
 = 
çl£
;

269 
	gi
 = 0; i < 
	gscheduË_™em_£t_couÁ
; i++) {

270 
	g»t
 |ğ
scheduË_™em_£t
[
i
]->
Upd©eScheduËI‹m
(
™em
);

273 ià(
	g»t
)

274 
	g™em_upd©ed
 = 
Œue
;

276  
	g»t
;

279 
	gProfeSourû
::
CË¬I‹mUpd©ed
()

281 
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

282 
	g™em_upd©ed
 = 
çl£
;

286 
	gProfe
::
Profe
()

287 : 
cu¼_begš
(0), 
cu¼_’d
(0), 
aùive_bË
(
NULL
),

288 
´ofe_¤c
(
NULL
)

293 
	gProfe
::~
Profe
()

295 
Unš™Profe
();

298 
boŞ
 
	gProfe
::
IsInRªge
(cÚ¡ 
UTCTime
 &
d©e_time
, **
»Ï‹d_obj
 )

300 
	gqu”y_mšu‹s
;

301 
	gv®
 = 0;

302 
tm
 
	gtmp_tm
;

303 cÚ¡ 
	gSYSUTILS_SPACE
::
UTCTimeS·n
 
Úeday
(1, 0, 0, 0);

305 ià(
	gd©e_time
<
	gcu¼_begš
 || d©e_time>
	gcu¼_’d
)

307 ià(! 
	gProfe
::
Upd©eAùiveTabË
(
d©e_time
))

308  
çl£
;

309 
	gtmp_tm
 = (
tm
è
d©e_time
;

310 
	gcu¼_begš
.
S‘TmTime
(

311 
tmp_tm
.
tm_y—r
,

312 
tmp_tm
.
tm_mÚ
,

313 
tmp_tm
.
tm_mday
,

315 
	gcu¼_’d
 = 
cu¼_begš
 + 
Úeday
;

318 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

319 
	gqu”y_mšu‹s
 = 
¡
.
wHour
 * 60 + st.
wMšu‹
;

321 
boŞ
 
	g»t
 = 
aùive_bË
->
G‘Pos™iÚ
(
qu”y_mšu‹s
, &
v®
, 
»Ï‹d_obj
);

322 ià(
	g»t
)

323 ià(
	gv®
>0è 
	gŒue
;

324  
	gçl£
;

330 
boŞ
 
	gProfe
::
Upd©eAùiveTabË
(cÚ¡ 
UTCTime
 &
d©e_time
)

332 ià(
NULL
 =ğ
´ofe_¤c
)

333  
çl£
;

334  
	g´ofe_¤c
->
G‘AùiveTabË
(
d©e_time
, 
aùive_bË
);

337 
boŞ
 
	gProfe
::
In™Profe
()

339 ià(
NULL
 =ğ
aùive_bË
)

340 
aùive_bË
 = 
Ãw
 
AùiveTabË
;

345  (
	gaùive_bË
!=
NULL
 && 
´ofe_¤c
!=NULL);

348 
	gProfe
::
Unš™Profe
()

350 ià(
aùive_bË
!=
NULL
)

352 
d–‘e
 
aùive_bË
;

353 
	gaùive_bË
 = 
NULL
;

356 ià(
	g´ofe_¤c
!=
NULL
)

358 
d–‘e
 
´ofe_¤c
;

359 
	g´ofe_¤c
 = 
NULL
;

363 
boŞ
 
	gProfe
::
S‘ProfeSourû
(
ProfeSourû
 *
sourû
)

365 ià(
´ofe_¤c
!=
NULL
)

367 
d–‘e
 
´ofe_¤c
;

368 
	g´ofe_¤c
 = 
NULL
;

371 
	g´ofe_¤c
 = 
sourû
;

373  
In™Profe
();

376 
boŞ
 
	gProfe
::
IsSamePS
(
ProfeSourû
 *
sourû
)

378 ià(
´ofe_¤c
 !ğ
NULL
 && 
sourû
 != NULL)

380  (
sourû
 =ğ
´ofe_¤c
 );

382 ià(
	g´ofe_¤c
 =ğ
NULL
 && 
sourû
 == NULL)

384  
Œue
;

386  
	gçl£
;

	@../../titanutils/schedule/ScheduleProfile.h

1 #iâdeà
__SCHEDULEPROFILE_H__


2 
	#__SCHEDULEPROFILE_H__


	)

4 
	~<lim™s.h
>

5 
	~<m­
>

7 
	~"debugMsg/Debug.h
"

8 
	~"commÚ/time.h
"

9 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

11 
	~<¡ršg
>

13 #ifdeà
WIN32


14 
	#¡rdup
 
_¡rdup


	)

17 
Çme¥aû
 
	gScheduË
 {

19 
şass
 
	gAùiveTabË
;

20 
	gAùiveTabËEËm’t
;

22 
	eScheduËD©aStus
 {

23 
	gSCHED_DATA_NONE
 = 0,

24 
	gSCHED_DATA_NORMAL
,

25 
	gSCHED_DATA_MODIFIED
,

26 
	gSCHED_DATA_NOMEM
,

27 
	gSCHED_DATA_DELETED
,

30 şas 
	cScheduËI‹mBa£
 {

31 
	gpublic
:

32 
	eACTIVE_TYPE
 {

33 
kAT_INACTIVE
 = -1,

34 
	gkAT_NONE
 = 0,

35 
	gkAT_ACTIVE
 = 1,

37 
ex¶ic™
 
ScheduËI‹mBa£
(è: 
scheduË_id
(
NULL
) {}

38 
vœtu®
 ~
ScheduËI‹mBa£
()

40 ià(
scheduË_id
)

42 
d–‘e
 
scheduË_id
;

43 
	gscheduË_id
 = 
NULL
;

47 
vœtu®
 
Re£t
() = 0;

48 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const = 0;

49 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
) = 0;

51 
	eITEM_TYPE
 {

52 
	gITEM_TYPE_DAY
,

53 
	gITEM_TYPE_WEEK
,

54 
	gITEM_TYPE_MONTH
,

55 
	gITEM_TYPE_SPECIFIC_DAY


57 
vœtu®
 
ITEM_TYPE
 
G‘I‹mTy³
() = 0;

59 
šlše
 
S‘ScheduËID
(
ušt64_t
 
id
) {

60 ià(!
	gscheduË_id
)

61 
	gscheduË_id
 = 
Ãw
 
ušt64_t
;

62 *
	gscheduË_id
 = 
id
;

64 
šlše
 
ušt64_t
 
G‘ScheduËID
() {

65  
	gscheduË_id
 ? *schedule_id : 0;

68 
	g´Ùeùed
:

69 
ušt64_t
 *
scheduË_id
;

72 
	sScheduËRefCouÁ
 {

73 
	g»f_couÁ
;

74 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
cs_»f
;

76 
ScheduËRefCouÁ
(è: 
»f_couÁ
(0) {}

78 
šlše
 
Inü—£RefCouÁ
() {

79 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_»f
);

80 
	g»f_couÁ
++;

84 
šlše
 
Deü—£RefCouÁ
() {

85 
	gSYSUTILS_SPACE
:: 
Cr™iÿlSeùiÚLock
 
®
(&
cs_»f
);

86 
	g»f_couÁ
--;

90 
šlše
 
G‘RefCouÁ
() {

91 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_»f
);

93  
	g»f_couÁ
;

97 
	sAùiveTabËEËm’t
 {

98 
	g´iÜ™y
;

99 
	gScheduËI‹mBa£
::
ACTIVE_TYPE
 
aùiveTy³
;

100 * 
	gpU£rD©a
;

102 
AùiveTabËEËm’t
(è: 
´iÜ™y
(
INT_MAX
), 
aùiveTy³
(
ScheduËI‹mBa£
::
kAT_NONE
), 
pU£rD©a
(
NULL
) {}

103 ~
AùiveTabËEËm’t
() {}

106 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	cScheduËSh¬ePŒ
 {

107 
	g´iv©e
:

108 
T
 *
_±r
;

109 
ScheduËRefCouÁ
 *
	g_»ã»nû
;

111 
Re£t
() {

112 ià(
	g_»ã»nû
->
G‘RefCouÁ
()) {

113 
	g_»ã»nû
->
Deü—£RefCouÁ
();

116 
TRACE
("[D”ef_Re£t] d–‘%p\n", 
_»ã»nû
);

117 
d–‘e
 
	g_±r
;

118 
d–‘e
 
	g_»ã»nû
;

119 
d–‘e
 
	g_¡©us
;

121 
	g_±r
 = 
NULL
;

122 
	g_»ã»nû
 = 
NULL
;

123 
	g_¡©us
 = 
NULL
;

126 
	gpublic
:

128 
ScheduËD©aStus
 *
_¡©us
;

130 
ScheduËSh¬ePŒ
() :

131 
_±r
(
NULL
), 
_»ã»nû
(
Ãw
 
ScheduËRefCouÁ
), 
_¡©us
Òew 
ScheduËD©aStus
) {

132 *
	g_¡©us
 = 
SCHED_DATA_NORMAL
;

134 
ScheduËSh¬ePŒ
(
T
* 
±r_
) :

135 
_±r
(
±r_
), 
_»ã»nû
(
Ãw
 
ScheduËRefCouÁ
), 
_¡©us
Òew 
ScheduËD©aStus
) {

136 *
	g_¡©us
 = 
SCHED_DATA_NORMAL
;

138 
ScheduËSh¬ePŒ
(cÚ¡ ScheduËSh¬ePŒ<
T
> &
£lf_
) :

139 
_±r
(
£lf_
._±r), 
_»ã»nû
(£lf_._»ã»nû), 
_¡©us
(self_._status) {

140 
	g_»ã»nû
->
Inü—£RefCouÁ
();

142 ~
ScheduËSh¬ePŒ
(è{
Re£t
();}

144 
	gScheduËSh¬ePŒ
<
	gT
>& 
	gİ”©Ü
=(cÚ¡ 
ScheduËSh¬ePŒ
<
T
> &
£lf_
) {

145 ià(
this
 =ğ&
£lf_
)

146  *
this
;

148 
Re£t
();

150 
	g_±r
 = 
£lf_
.
_±r
;

151 
	g_¡©us
 = 
£lf_
.
_¡©us
;

152 
	g_»ã»nû
 = 
£lf_
.
_»ã»nû
;

153 
	g_»ã»nû
->
Inü—£RefCouÁ
();

155  *
	gthis
;

158 
T
* 
	gİ”©Ü
->(è{ 
	g_±r
;}

159 
	gT
& 
	gİ”©Ü
*(è{ *
	g_±r
;}

160 
T
* 
g‘
(ècÚ¡ { 
	g_±r
;}

162 
boŞ
 
»£t
(
T
* 
±r_
) {

163 ià(
	g_±r
 =ğ
±r_
)

164  
Œue
;

166 *
	g_¡©us
 = 
SCHED_DATA_MODIFIED
;

167 
Re£t
();

169 
	g_»ã»nû
 = 
Ãw
 
ScheduËRefCouÁ
;

170 ià(!
	g_»ã»nû
) {

171 *
	g_¡©us
 = 
SCHED_DATA_NOMEM
;

172  
	gçl£
;

174 
	g_¡©us
 = 
Ãw
 
ScheduËD©aStus
;

175 ià(!
	g_¡©us
) {

176 *
	g_¡©us
 = 
SCHED_DATA_NOMEM
;

177  
	gçl£
;

180 
	g_±r
 = 
±r_
;

181 *
	g_¡©us
 = 
SCHED_DATA_NORMAL
;

182  
	gŒue
;

187 
	gScheduËSh¬ePŒ
<
	tScheduËI‹mBa£
> 
	tScheduËI‹mSh¬eBa£
;

189 şas 
	cScheduËI‹mS‘
 {

190 
	gpublic
:

191 cÚ¡ 
HIGHEST_PRIORITY
 = 
INT_MIN
;

192 cÚ¡ 
	gLOWEST_PRIORITY
 = 
INT_MAX
;

194 
ex¶ic™
 
ScheduËI‹mS‘
();

195 
	gvœtu®
 ~
ScheduËI‹mS‘
();

197 
Re£tScheduËI‹ms
();

199 
boŞ
 
AddScheduËI‹m
(
´iÜ™y
, 
ScheduËI‹mBa£
 *
™em
);

200 
boŞ
 
AddScheduËI‹m
(
´iÜ™y
, 
ScheduËI‹mSh¬eBa£
 &
™em
);

202 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
) const;

203 
vœtu®
 
boŞ
 
MaskAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
bË
, 
¡d
::
m­
<
ušt64_t
, 
AùiveTabËEËm’t
> &
©CÚ‹Á
);

205 
S‘PrÙoA‰ribu‹
(
ušt32_t
 
id
, ušt32_ˆ
Üd”
, ušt32_ˆ
fixed
, cÚ¡ *
Çme
, cÚ¡ *
šfo
);

207 
šlše
 
ušt32_t
 
G‘PrÙoID
(ècÚ¡ {  
	g´Ùo_id
; }

208 
šlše
 
ušt32_t
 
G‘PrÙoOrd”
(ècÚ¡ {  
	g´Ùo_Üd”
; }

209 
šlše
 
ušt32_t
 
G‘PrÙoFixed
(ècÚ¡ {  
	g´Ùo_fixed
; }

210 
šlše
 cÚ¡ *
G‘PrÙoName
(ècÚ¡ {  
	g´Ùo_Çme
; }

211 
šlše
 cÚ¡ *
G‘PrÙoInfo
(ècÚ¡ {  
	g´Ùo_šfo
; }

213 
	gScheduËI‹mS‘
& 
	gİ”©Ü
=(cÚ¡ 
ScheduËI‹mS‘
& 
rhs
);

215 
ScheduËD©aStus
 
CheckI‹mStus
();

216 
boŞ
 
Upd©eScheduËI‹m
(
ScheduËI‹mSh¬eBa£
 &
™em
);

218 
	g´Ùeùed
:

219 
	sScheduËI‹mEËm
 {

220 
´iÜ™y
;

221 
ScheduËI‹mBa£
 *
	g™em
;

222 
ScheduËI‹mSh¬eBa£
 *
	gsh¬e
;

224 
ScheduËI‹mEËm
(è: 
´iÜ™y
(0), 
™em
(
NULL
), 
sh¬e
(NULL) {}

225 ~
ScheduËI‹mEËm
() {

226 
d–‘e
 
	g™em
;

227 
d–‘e
 
	gsh¬e
;

231 
ušt32_t
 
	g´Ùo_id
;

232 
ušt32_t
 
	g´Ùo_Üd”
;

233 
ušt32_t
 
	g´Ùo_fixed
;

234 *
	g´Ùo_Çme
;

235 *
	g´Ùo_šfo
;

237 
ScheduËI‹mEËm
 **
	gscheduË_™ems
;

238 
	gscheduË_™ems_couÁ
;

239 
	gscheduË_™ems_size
;

241 
Re£tPrÙoA‰ribu‹
();

242 
R–—£ScheduËI‹ms
();

244 
boŞ
 
Ex·ndI‹msCÚš”IfN“d
();

247 şas 
	cProfeSourû
 {

248 
	gpublic
:

249 
ex¶ic™
 
ProfeSourû
();

250 
	gvœtu®
 ~
ProfeSourû
();

252 
vœtu®
 
	g¡d
::
¡ršg
 
G‘URI
() const = 0;

254 
vœtu®
 
boŞ
 
In™Ÿl
() = 0;

255 
vœtu®
 
boŞ
 
Unš™Ÿl
() = 0;

257 
boŞ
 
G‘AùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, 
AùiveTabË
 *
©
);

259 
	gProfeSourû
& 
	gİ”©Ü
=(cÚ¡ 
ProfeSourû
 &
rhs
);

261 
S‘AùiveTabËCÚ‹Á
(
´iÜ™y
, 
ušt64_t
 &
scheduËID
, 
ScheduËI‹mBa£
::
ACTIVE_TYPE
 
ty³
, * 
pU£rD©a
);

262 
ScheduËD©aStus
 
CheckI‹mS‘Stus
();

263 
boŞ
 
Upd©eScheduËI‹mS‘
(
ScheduËI‹mSh¬eBa£
 &
™em
);

264 
boŞ
 
IsI‹mUpd©ed
(è{ 
	g™em_upd©ed
;}

265 
CË¬I‹mUpd©ed
();

267 
	g´Ùeùed
:

268 
¡d
::
m­
<
ušt64_t
, 
	gAùiveTabËEËm’t
> 
	gaùiveTabËCÚ‹Á
;

269 
boŞ
 
	g™em_upd©ed
;

271 
ScheduËI‹mS‘
 **
	gscheduË_™em_£t
;

272 
	gscheduË_™em_£t_couÁ
;

273 
	gscheduË_™em_£t_size
;

275 
mubË
 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
cs_sis
;

277 
Re£tScheduËI‹mS‘
();

278 
R–—£ScheduËI‹mS‘
();

280 
boŞ
 
Adju¡ScheduËI‹mS‘ToSize
(
n
);

281 
boŞ
 
AddScheduËI‹mS‘
(cÚ¡ 
ScheduËI‹mS‘
 &
sis
);

284 şas 
	cProfe
 {

285 
	gpublic
:

286 
ex¶ic™
 
Profe
();

287 
ex¶ic™
 
Profe
(
ProfeSourû
 *
sourû
);

289 
	gvœtu®
 ~
Profe
();

291 
boŞ
 
S‘ProfeSourû
(
ProfeSourû
 *
sourû
);

292 
ProfeSourû
* 
G‘ProfeSourû
(è{ 
	g´ofe_¤c
;}

293 
boŞ
 
In™Profe
();

294 
Unš™Profe
();

296 
vœtu®
 
boŞ
 
IsInRªge
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, **
»Ï‹d_obj
 = 
NULL
);

297 
ScheduËD©aStus
 
CheckProfeSourûStus
(è{ 
	g´ofe_¤c
->
CheckI‹mS‘Stus
();}

298 
boŞ
 
IsSamePS
(
ProfeSourû
 *
sourû
);

300 
	g´Ùeùed
:

301 
boŞ
 
Upd©eAùiveTabË
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
);

303 
	gSYSUTILS_SPACE
::
UTCTime
 
cu¼_begš
;

304 
	gSYSUTILS_SPACE
::
UTCTime
 
cu¼_’d
;

306 
AùiveTabË
 *
	gaùive_bË
;

308 
ProfeSourû
 *
	g´ofe_¤c
;

311 şas 
	cProfeL™e
 : 
public
 
Profe
 {

312 
public
:

313 
ex¶ic™
 
ProfeL™e
();

314 
ex¶ic™
 
ProfeL™e
(
ProfeSourû
 *
sourû
);

316 
	gvœtu®
 ~
ProfeL™e
();

318 
boŞ
 
IsInRªge
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, **
»Ï‹d_obj
 = 
NULL
);

	@../../titanutils/schedule/ScheduleProfileManager.cpp

8 
	~"ScheduËProfeMªag”.h
"

9 
	~"commÚ/ut™y.h
"

10 
	~"commÚ/time.h
"

12 #ifdeà
WIN32


13 
	#SLASH
 "\\"

	)

15 
	#SLASH
 "/"

	)

18 
Çme¥aû
 
	gScheduË
 {

48 
boŞ
 
	gScheduËProfeMªag”
::
In™ŸlMSCÚfigMªag”
(cÚ¡ 
¡d
::
¡ršg
 &
cÚfigRoÙP©h
)

50 
¡d
::
¡ršg
 
¡rNewCÚfigRoÙP©h
 = 
cÚfigRoÙP©h
 + "scheduËS‘tšg" + 
SLASH
;

51 ià(!
	gm_MSCÚfigMªag”
.
g‘
() ||

52 (
	gm_MSCÚfigMªag”
.
g‘
(è&& (
	g¡rNewCÚfigRoÙP©h
 !ğ
m_¡rCÚfigRoÙP©h
)))

54 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

56 
	gm_MSCÚfigMªag”
.
»£t
(
Ãw
 
CMSCÚfigScheduË
(
¡rNewCÚfigRoÙP©h
));

57 ià(
	gm_MSCÚfigMªag”
.
g‘
()) {

58 
	gm_¡rCÚfigRoÙP©h
 = 
¡rNewCÚfigRoÙP©h
;

59 ià(!
	gm_MSCÚfigMªag”
->
P¬£D©a
()) {

60 
TRACE
("[SCHEDULE LIB] Load Schedule Configuration File Error!!\n");

61  
	gçl£
;

64  
	gçl£
;

67  
	gŒue
;

70 
boŞ
 
	gScheduËProfeMªag”
::
In™ŸlMSCÚfigMªag”
()

72 ià(!
m_¡rCÚfigRoÙP©h
.
em±y
())

74 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

76 
	gm_MSCÚfigMªag”
.
»£t
(
Ãw
 
CMSCÚfigScheduË
(
m_¡rCÚfigRoÙP©h
));

77 ià(
	gm_MSCÚfigMªag”
.
g‘
()) {

79 ià(!
	gm_MSCÚfigMªag”
->
P¬£D©a
()) {

80 
TRACE
("[SCHEDULE LIB] Load Schedule Configuration File Error!!\n");

81  
	gçl£
;

84  
	gçl£
;

86 
ASSERT
(0);

89  
	gŒue
;

92 
boŞ
 
	gScheduËProfeMªag”
::
ChªgeCÚfigRoÙP©h
(cÚ¡ 
¡d
::
¡ršg
 &
cÚfigRoÙP©h
)

94 
¡d
::
¡ršg
 
¡rNewCÚfigRoÙP©h
 = 
cÚfigRoÙP©h
 + "scheduËS‘tšg" + 
SLASH
;

95 ià(
	gm_¡rCÚfigRoÙP©h
 !ğ
¡rNewCÚfigRoÙP©h
) {

96 
Re£tI‹mPoŞ
();

97  
In™ŸlMSCÚfigMªag”
(
cÚfigRoÙP©h
);

99 
TRACE
("[SCHEDULE LIB] Config„oot…ath is‚ot changed\n");

100  
	gŒue
;

104 
	gScheduËProfeMªag”
::
ScheduËProfeMªag”
()

109 
ScheduËProfeMªag”
::ScheduËProfeMªag”(cÚ¡ 
¡d
::
¡ršg
 &
cÚfigRoÙP©h
)

111 
In™ŸlMSCÚfigMªag”
(
cÚfigRoÙP©h
);

114 
	gScheduËProfeMªag”
::~
ScheduËProfeMªag”
()

116 
Re£tProfeSourûPoŞ
();

117 
Re£tI‹mPoŞ
();

120 
ProfeSourûSh¬e
 
	gScheduËProfeMªag”
::
G‘ProfeSourû
(
¡d
::
veùÜ
<
ScheduËIDInfo
> &
vScheduËIDLi¡
)

122 
ScheduËI‹mS‘
 
sis
;

123 
ProfeSourûSh¬e
 
ps
(
Ãw
 
ProfeSourûImp
);

125 ià(
	gNULL
 =ğ
ps
.
g‘
())

126  
NULL
;

128 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

130 ià(!
	gm_MSCÚfigMªag”
.
g‘
()) {

131 
TRACE
("[ProfMªag”] %d: m_MSCÚfigMªag” i nÙ in™Ÿlized.\n", 
__LINE__
);

132  
	gNULL
;

135 
CScheduËBa£
* 
	gba£
 = 
NULL
;

136 
	gty³
;

137 
	g¡d
::
veùÜ
<
ScheduËIDInfo
>::
™”©Ü
 
™
 = 
vScheduËIDLi¡
.
begš
();

138 
	g™
 !ğ
vScheduËIDLi¡
.
’d
(); ++it) {

141 ià(
	gm_I‹mPoŞ
.
fšd
((*
™
).
uÎScheduËID
è!ğ
m_I‹mPoŞ
.
’d
()) {

143 
š£¹_što_sis
;

146 
TRACE
("[ScheduËID] %Îu\n", 
™
->
uÎScheduËID
);

151 
	gty³
 = 
m_MSCÚfigMªag”
->
G‘SšgËD©a
(
CMSCÚfigBa£
::
FIND_BY_ID
, (*
™
).
uÎScheduËID
, 
ba£
);

152 ià(
	gba£
 && (
	gty³
 > -1)) {

153 
ScheduËI‹mBa£
 *
	g™em
 = 
P¬£ScheduËI‹mXMLCÚ‹Á
(
ba£
, 
ty³
);

154 ià(!
	g™em
)

157 ià(!
G‘ScheduËI‹mSh¬eBa£
(
m_I‹mPoŞ
[(*
™
).
uÎScheduËID
], 
™em
, 
ba£
->
ba£I‹m
.
uÎID
)) {

158 
d–‘e
 
	g™em
;

164 
	gš£¹_što_sis
:

165 ià(
m_I‹mPoŞ
[(*
™
).
uÎScheduËID
].
g‘
()) {

166 
ps
->
S‘AùiveTabËCÚ‹Á
(
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, (*
™
).
uÎScheduËID
, (*™).
bNÙify
 ? 
ScheduËI‹mBa£
::
kAT_ACTIVE
 : ScheduËI‹mBa£::
kAT_INACTIVE
, (*™).
pU£rD©a
);

167 
	gsis
.
AddScheduËI‹m
(
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, 
m_I‹mPoŞ
[(*
™
).
uÎScheduËID
]);

169 
TRACE
("[ProfMªag”] %d: NULL…oš‹r\n", 
__LINE__
);

172  (
	gps
->
AddScheduËI‹mS‘
(
sis
)è?… : 
NULL
;

175 
ProfeSh¬e
* 
	gScheduËProfeMªag”
::
G‘Profe
(
ProfeSourûSh¬e
 &
pProfeSrc
)

177 ià(!
pProfeSrc
.
g‘
())

178  
NULL
;

180 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

182 
ProfeSh¬e
* 
	gps
 = 
Ãw
 ProfeSh¬e(
pProfeSrc
);

183 ià(
	gps
)

184 
	gm_ProfeSourûPoŞ
.
push_back
(
pProfeSrc
);

185  
	gps
 ?… : 
NULL
;

188 
ProfeSh¬e
* 
	gScheduËProfeMªag”
::
G‘Profe
(
¡d
::
veùÜ
<
ScheduËIDInfo
> &
vScheduËIDLi¡
)

190 
ProfeSourûSh¬e
 
´ofeSrc
 = 
G‘ProfeSourû
(
vScheduËIDLi¡
);

191  
G‘Profe
(
´ofeSrc
);

194 
	gScheduËProfeMªag”
::
R–—£Profe
(
ProfeSh¬e
 *
pProfe
) {

195 ià(!
pProfe
)

198 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

200 
	g¡d
::
veùÜ
<
ProfeSourûSh¬e
>::
™”©Ü
 
™
 = 
m_ProfeSourûPoŞ
.
begš
();

201 
	g™
 !ğ
m_ProfeSourûPoŞ
.
’d
()) {

202 ià(
pProfe
->
G‘ProfeSourû
(è=ğ
™
->
g‘
()) {

203 
TRACE
("[SPM] Remove ProfileSource from Pool\n");

204 
	gm_ProfeSourûPoŞ
.
”a£
(
™
++);

208 
	g™
++;

211 
d–‘e
 
	gpProfe
;

214 
boŞ
 
	gScheduËProfeMªag”
::
G‘ScheduËI‹mSh¬eBa£
(
ScheduËI‹mSh¬eBa£
 &
sh¬e
, 
ScheduËI‹mBa£
 *
ba£
, 
ušt64_t
 
scheduË_id
)

216 ià(!
	gsh¬e
.
»£t
(
ba£
)è 
	gçl£
;

217 
	gsh¬e
->
S‘ScheduËID
(
scheduË_id
);

218  
	gŒue
;

221 
ScheduËI‹mBa£
* 
	gScheduËProfeMªag”
::
P¬£ScheduËI‹mXMLCÚ‹Á
(
CScheduËBa£
* &
ba£
, 
ty³
, 
boŞ
 
bNÙify
, * 
pU£rD©a
)

223 
	gScheduËI‹mBa£
::
ACTIVE_TYPE
 
t
 = 
ScheduËI‹mBa£
::
kAT_NONE
;

224 
ScheduËI‹mBa£
 *
	g™em
 = 
NULL
;

226 
	gty³
) {

227 
	gSCHEDULE_TYPE_DAILY
:

229 
™em
 = 
Ãw
 
ScheduËI‹mDay
;

230 ià(!
	g™em
è 
	gNULL
;

232 
	gScheduËI‹mDay
::
time_¦iû
 
¦iû
;

234 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
 = ((
CScheduËDay
*)
ba£
)->
vDay
.
begš
();

235 
	g™
 !ğ((
CScheduËDay
*)
ba£
)->
vDay
.
’d
(); it++) {

236 ià(
P¬£TimeSliû
(*
™
, 
¦iû
.
¡¬t
, sliû.
’d
))

237 ((
	gScheduËI‹mDay
*)
	g™em
)->
AddTimeSliû
(
t
, 
¦iû
);

242 
	gSCHEDULE_TYPE_WEEKLY
:

244 
™em
 = 
Ãw
 
ScheduËI‹mW“k
;

245 ià(!
	g™em
è 
	gNULL
;

247 
	gScheduËI‹mW“k
::
time_¦iû
 
¦iû
;

249 
	gw“k_day
 = 0; week_day < 7; week_day++) {

250 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
 = ((
CScheduËW“kly
*)
ba£
)->
vW“k
[
w“k_day
].
begš
();

251 
	g™
 !ğ((
CScheduËW“kly
*)
ba£
)->
vW“k
[
w“k_day
].
’d
(); it++) {

252 
	g¦iû
.
	gw“k
 = 
w“k_day
;

255 ià(
P¬£TimeSliû
(*
™
, 
¦iû
.
¡¬t
, sliû.
’d
))

256 ((
	gScheduËI‹mW“k
*)
	g™em
)->
AddTimeSliû
(
t
, 
¦iû
);

262 
	gSCHEDULE_TYPE_MONTHLY
:

263 
SCHEDULE_TYPE_YEARLY
:

265 
™em
 = 
Ãw
 
ScheduËI‹mMÚth
;

266 ià(!
	g™em
è 
	gNULL
;

268 ((
	gCScheduËMÚthly
*)
	gba£
)->
	gbTy³
) {

271 
ScheduËI‹mMÚth
::
time_¦iû_1
 
¦iû
;

272 
	g¦iû
.
	gmÚth
 = (
ty³
 =ğ
SCHEDULE_TYPE_YEARLY
è? ((
CScheduËY—¾y
*)
ba£
)->
bWhichMÚth
 : -1;

273 
	g¦iû
.
	gday
 = ((
CScheduËMÚthly
*)
ba£
)->
bWhichDayInMÚth
;

278 
	gdn
 = 0; dn < 2; dn++) {

279 
	g¦iû
.
	gis_Ãxt
 = 
dn
;

280 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
 = ((
CScheduËMÚthly
*)
ba£
)->
vDayNext
[
dn
].
begš
();

281 
	g™
 !ğ((
CScheduËMÚthly
*)
ba£
)->
vDayNext
[
dn
].
’d
(); it++) {

282 ià(
P¬£TimeSliû
(*
™
, 
¦iû
.
¡¬t
, sliû.
’d
))

283 ((
	gScheduËI‹mMÚth
*)
	g™em
)->
AddTimeSliû
(
t
, 
¦iû
);

290 
ScheduËI‹mMÚth
::
time_¦iû_3
 
¦iû
;

291 
	g¦iû
.
	gmÚth
 = (
ty³
 =ğ
SCHEDULE_TYPE_YEARLY
è? ((
CScheduËY—¾y
*)
ba£
)->
bWhichMÚth
 : -1;

292 
	g¦iû
.
	gw“k
 = ((
CScheduËMÚthly
*)
ba£
)->
bWhichDay
;

293 
	g¦iû
.
	gnumb”
 = (((
CScheduËMÚthly
*)
ba£
)->
bFš®W“k
è? -1 : 
¦iû
.
numb”
 = ((CScheduËMÚthly*)ba£)->
bWhichW“k
;

298 
	gdn
 = 0; dn < 2; dn++) {

299 
	g¦iû
.
	gis_Ãxt
 = 
dn
;

300 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
 = ((
CScheduËMÚthly
*)
ba£
)->
vDayNext
[
dn
].
begš
();

301 
	g™
 !ğ((
CScheduËMÚthly
*)
ba£
)->
vDayNext
[
dn
].
’d
(); it++) {

302 ià(
P¬£TimeSliû
(*
™
, 
¦iû
.
¡¬t
, sliû.
’d
))

303 ((
	gScheduËI‹mMÚth
*)
	g™em
)->
AddTimeSliû
(
t
, 
¦iû
);

311 
	gSCHEDULE_TYPE_SPECIFICDAY
:

313 
™em
 = 
Ãw
 
ScheduËI‹mS³cificDay
;

314 ià(!
	g™em
è 
	gNULL
;

316 
	gScheduËI‹mS³cificDay
::
time_¦iû
 
¦iû
;

318 
	g¡d
::
veùÜ
<
št64_t
>::
™”©Ü
 
™
 = ((
CScheduËS³cificDays
*)
ba£
)->
vD©eLi¡
.
begš
();

319 
	g™
 !ğ((
CScheduËS³cificDays
*)
ba£
)->
vD©eLi¡
.
’d
(); it++) {

320 
FILETIME
 
	gá
 = 
SYSUTILS_SPACE
::
u64_to_á
(*
™
);

321 
	gSYSUTILS_SPACE
::
UTCTime
 
d©e
(
á
);

322 
SYSTEMTIME
 
	g¡
 = 
SYSUTILS_SPACE
::
UTCTimeToLoÿlTime
((SYSTEMTIMEè
d©e
);

324 
	g¦iû
.
	gy—r
 = 
¡
.
wY—r
;

325 
	g¦iû
.
	gmÚth
 = 
¡
.
wMÚth
;

326 
	g¦iû
.
	gday
 = 
¡
.
wDay
;

331 
	gdn
 = 0; dn < 2; dn++) {

332 
	g¦iû
.
	gis_Ãxt
 = 
dn
;

333 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
 = ((
CScheduËS³cificDays
*)
ba£
)->
vDayNext
[
dn
].
begš
();

334 
	g™
 !ğ((
CScheduËS³cificDays
*)
ba£
)->
vDayNext
[
dn
].
’d
(); it++) {

335 ià(
P¬£TimeSliû
(*
™
, 
¦iû
.
¡¬t
, sliû.
’d
))

336 ((
	gScheduËI‹mS³cificDay
*)
	g™em
)->
AddTimeSliû
(
t
, 
¦iû
);

343  
	g™em
;

346 
boŞ
 
	gScheduËProfeMªag”
::
P¬£TimeSliû
(cÚ¡ 
¡d
::
¡ršg
 &
time_¦iû
, &
¡¬t
, &
’d
)

348 
	g¡¬t
 = ()
¡¹Ş
(
time_¦iû
.
sub¡r
(0, 3).
c_¡r
(), 
NULL
, 16);

349 
	g’d
 = ()
¡¹Ş
(
time_¦iû
.
sub¡r
(3, 3).
c_¡r
(), 
NULL
, 16);

351 ià(
	g¡¬t
 < 1 || s¹ > 1440 || 
	g’d
 < 1 ||ƒnd > 1440 ||ƒnd < start)

352  
	gçl£
;

354 
	g¡¬t
--;

355 
	g’d
--;

357  
	gŒue
;

360 
	gScheduËProfeMªag”
::
Re£tI‹mPoŞ
()

362 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

364 
	g¡d
::
m­
<
ušt64_t
, 
	gScheduËI‹mSh¬eBa£
>::
™”©Ü
 
™
 = 
m_I‹mPoŞ
.
begš
();

365 
	g™
 !ğ
m_I‹mPoŞ
.
’d
(); it++)

366 *(
	g™
->
	g£cÚd
.
	g_¡©us
èğ
SCHED_DATA_DELETED
;

368 
	gm_I‹mPoŞ
.
ş—r
();

371 
	gScheduËProfeMªag”
::
ModifyI‹m
(
ušt64_t
 
scheduËID
)

373 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

376 ià(
	gm_I‹mPoŞ
.
fšd
(
scheduËID
è=ğ
m_I‹mPoŞ
.
’d
())

380 
CScheduËBa£
* 
	gba£
 = 
NULL
;

381 
	gty³
;

384 
	gty³
 = 
m_MSCÚfigMªag”
->
G‘SšgËD©a
(
CMSCÚfigBa£
::
FIND_BY_ID
, 
scheduËID
, 
ba£
);

385 ià(
	gba£
 && (
	gty³
 > -1)) {

386 
ScheduËI‹mBa£
 *
	g™em
 = 
P¬£ScheduËI‹mXMLCÚ‹Á
(
ba£
, 
ty³
);

387 ià(!
	g™em
)

390 ià(!
G‘ScheduËI‹mSh¬eBa£
(
m_I‹mPoŞ
[
scheduËID
], 
™em
, 
ba£
->
ba£I‹m
.
uÎID
))

391 
d–‘e
 
	g™em
;

394 
Upd©eProfeSourû
(
m_I‹mPoŞ
[
scheduËID
]);

397 
	gScheduËProfeMªag”
::
D–‘eI‹m
(
ušt64_t
 
scheduËID
)

399 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

402 ià(
	gm_I‹mPoŞ
.
fšd
(
scheduËID
è=ğ
m_I‹mPoŞ
.
’d
())

405 *(
	gm_I‹mPoŞ
[
scheduËID
].
	g_¡©us
èğ
SCHED_DATA_DELETED
;

407 
Upd©eProfeSourû
(
m_I‹mPoŞ
[
scheduËID
]);

409 
	gm_I‹mPoŞ
.
”a£
(
scheduËID
);

412 
	gScheduËProfeMªag”
::
Upd©eProfeSourû
(
ScheduËI‹mSh¬eBa£
& 
™em
)

414 
¡d
::
veùÜ
<
ProfeSourûSh¬e
>::
™”©Ü
 
™
 = 
m_ProfeSourûPoŞ
.
begš
();

415 
	g™
 !ğ
m_ProfeSourûPoŞ
.
’d
(); it++) {

416 (*
	g™
)->
Upd©eScheduËI‹mS‘
(
™em
);

420 
	gScheduËProfeMªag”
::
ModifyI‹m
(
¡d
::
veùÜ
<
ušt64_t
> 
vScheduËID
)

422 
¡d
::
veùÜ
<
ušt64_t
>::
™”©Ü
 
™
 = 
vScheduËID
.
begš
();

423 
	g™
 !ğ
vScheduËID
.
’d
(); it++) {

424 
ModifyI‹m
(*
™
);

428 
	gScheduËProfeMªag”
::
D–‘eI‹m
(
¡d
::
veùÜ
<
ušt64_t
> 
vScheduËID
)

430 
¡d
::
veùÜ
<
ušt64_t
>::
™”©Ü
 
™
 = 
vScheduËID
.
begš
();

431 
	g™
 !ğ
vScheduËID
.
’d
(); it++) {

432 
D–‘eI‹m
(*
™
);

436 
	gScheduËProfeMªag”
::
ModifyI‹m
()

438 
¡d
::
m­
<
ušt64_t
, 
	gScheduËI‹mSh¬eBa£
>::
™”©Ü
 
™
 = 
m_I‹mPoŞ
.
begš
();

439 
	g™
 !ğ
m_I‹mPoŞ
.
’d
(); it++)

440 
ModifyI‹m
(
™
->
£cÚd
->
G‘ScheduËID
());

443 
	gScheduËProfeMªag”
::
Re£tProfeSourûPoŞ
()

445 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

446 
	gm_ProfeSourûPoŞ
.
ş—r
();

449 
boŞ
 
	gScheduËProfeMªag”
::
MªuÏ‹D©a
(
CScheduËBa£
* 
NewD©a
, cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
)

451 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_mªag”
);

452 
boŞ
 
	g»t
 = 
çl£
;

453 ià(
	gm_MSCÚfigMªag”
.
g‘
())

454 
	gm_MSCÚfigMªag”
->
MªuÏ‹D©a
(
NewD©a
, 
bFÏg
, 
time¡amp
);

455  
	g»t
;

	@../../titanutils/schedule/ScheduleProfileManager.h

8 #iâdeà
SCHEDULEPROFILEMANAGER_H_


9 
	#SCHEDULEPROFILEMANAGER_H_


	)

11 
	~<memÜy
>

12 
	~<veùÜ
>

13 
	~<¡ršg
>

14 
	~<m­
>

15 
	~"MsCl›Á/LogšCŒl/SyncMSCÚfig/MSCÚfigScheduË.h
"

16 
	~"ScheduËProfeSh¬eImp.h
"

18 
Çme¥aû
 
	gScheduË
 {

20 şas 
	cScheduËProfeMªag”
 {

21 
	gpublic
:

22 
	sScheduËIDInfo
 {

23 
ušt64_t
 
uÎScheduËID
;

24 
boŞ
 
	gbNÙify
;

25 *
	gpU£rD©a
;

27 
ScheduËIDInfo
 (è: 
uÎScheduËID
(0), 
bNÙify
(
çl£
), 
pU£rD©a
(
NULL
) {}

33 
ScheduËProfeMªag”
();

34 
ScheduËProfeMªag”
(cÚ¡ 
¡d
::
¡ršg
 &
cÚfigRoÙP©h
);

35 
	gvœtu®
 ~
ScheduËProfeMªag”
();

37 
boŞ
 
In™ŸlMSCÚfigMªag”
(cÚ¡ 
¡d
::
¡ršg
 &
cÚfigRoÙP©h
);

38 
boŞ
 
In™ŸlMSCÚfigMªag”
();

39 
boŞ
 
ChªgeCÚfigRoÙP©h
(cÚ¡ 
¡d
::
¡ršg
 &
cÚfigRoÙP©h
);

41 
ProfeSourûSh¬e
 
G‘ProfeSourû
(
¡d
::
veùÜ
<
ScheduËIDInfo
> &
vScheduËIDLi¡
);

42 
ProfeSh¬e
* 
G‘Profe
(
¡d
::
veùÜ
<
ScheduËIDInfo
> &
vScheduËIDLi¡
);

43 
ProfeSh¬e
* 
G‘Profe
(
ProfeSourûSh¬e
 &
pProfeSrc
);

44 
R–—£Profe
(
ProfeSh¬e
 *
pProfe
);

45 
Upd©eProfeSourû
(
ScheduËI‹mSh¬eBa£
& 
™em
);

47 
Re£tI‹mPoŞ
();

48 
Re£tProfeSourûPoŞ
();

49 
ModifyI‹m
();

51 
ModifyI‹m
(
ušt64_t
 
scheduËID
);

52 
D–‘eI‹m
(
ušt64_t
 
scheduËID
);

54 
ModifyI‹m
(
¡d
::
veùÜ
<
ušt64_t
> 
vScheduËID
);

55 
D–‘eI‹m
(
¡d
::
veùÜ
<
ušt64_t
> 
vScheduËID
);

57 
boŞ
 
MªuÏ‹D©a
(
CScheduËBa£
* 
NewD©a
, cÚ¡ 
CMSCÚfigBa£
::
MS_DATA_MANIPULATION
& 
bFÏg
, 
ušt64_t
 
time¡amp
);

59 
	g´Ùeùed
:

64 
´iv©e
:

65 
mubË
 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
cs_mªag”
;

66 
	g¡d
::
auto_±r
<
CMSCÚfigScheduË
> 
m_MSCÚfigMªag”
;

67 
	g¡d
::
m­
<
ušt64_t
, 
	gScheduËI‹mSh¬eBa£
> 
	gm_I‹mPoŞ
;

68 
	g¡d
::
¡ršg
 
m_¡rCÚfigRoÙP©h
;

69 
	g¡d
::
veùÜ
<
ProfeSourûSh¬e
> 
m_ProfeSourûPoŞ
;

71 
boŞ
 
G‘ScheduËI‹mSh¬eBa£
(
ScheduËI‹mSh¬eBa£
 &
sh¬e
, 
ScheduËI‹mBa£
 *
ba£
, 
ušt64_t
 
scheduË_id
);

72 
ScheduËI‹mBa£
* 
P¬£ScheduËI‹mXMLCÚ‹Á
(
CScheduËBa£
* &
ba£
, 
ty³
, 
boŞ
 
bNÙify
 = 
çl£
, * 
pU£rD©a
 = 
NULL
);

73 
boŞ
 
P¬£TimeSliû
(cÚ¡ 
¡d
::
¡ršg
 &
time_¦iû
, &
¡¬t
, &
’d
);

	@../../titanutils/schedule/ScheduleProfileShareImp.cpp

1 
	~<f¡»am
>

3 
	~"debugMsg/Debug.h
"

4 
	~"commÚ/ut™y.h
"

5 
	~"commÚ/time.h
"

6 
	~"commÚ/fe.h
"

8 
	~"ScheduËProfeSh¬eImp.h
"

10 
	#DEFAULT_SIS_SIZE
 8

	)

12 
	$SHOW_ACTIVE_TABLE
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
t
, 
ScheduË
::
AùiveTabË
 *
bË
)

14 ià(
NULL
 =ğ
bË
)

17 
SYSTEMTIME
 
¡
 = 
t
;

18 
j
=0;

19 
v®
 = 0;

20 
tick1
 = 0, 
tick2
 = 0;

21 
bË_size
;

23 
bË
->
	`G‘Tick
(&
tick1
, &
tick2
);

24 
bË_size
 = (!
tick1
 && !
tick2
) ? 1440 :ick2 -ick1;

26 
i
=0; i<
bË_size
; i++)

27 ià(
bË
->
	`G‘Pos™iÚ
(
i
 + 
tick1
, &
v®
, 
NULL
))

28 ++
j
;

29 
	`årštf
(
¡d”r
, "%4d/%02d/%02d: %d\n", 
¡
.
wY—r
, st.
wMÚth
, st.
wDay
, 
j
);

31 
i
=0; i<
bË_size
; i++)

33 
bË
->
	`G‘Pos™iÚ
(
i
 + 
tick1
, &
v®
, 
NULL
);

34 
	`årštf
(
¡d”r
, "%4d[%3d]%s", 
i
 + 
tick1
, 
v®
, 9 == (i%10) ? "\n" : " ");

36 
	`årštf
(
¡d”r
, "\n");

38 
	}
}

40 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

42 
Çme¥aû
 
	gScheduË
 {

44 
	gProfeSh¬e
::
ProfeSh¬e
(
ProfeSourûSh¬e
 &
sourû
)

46 ià(!
S‘ProfeSourû
(
sourû
))

47 
TRACE
("[SCHEDULE LIB] %s: Failo initialize…rofile_src\n",

48 
__FUNCTION_SIGNATURE__
);

51 
	gProfeSh¬e
::
Unš™Profe
()

53 ià(
´ofe_¤c
)

54 
´ofe_¤c
 = 
NULL
;

56 ià(
	gaùive_bË
) {

57 
d–‘e
 
	gaùive_bË
;

58 
	gaùive_bË
 = 
NULL
;

62 
boŞ
 
	gProfeSh¬e
::
In™Profe
()

64 
Ad­tiveAùiveTabË
 *
ad­tive_bË
 = 
Ãw
 AdaptiveActiveTable;

65 ià(
	gad­tive_bË
)

66 
	gaùive_bË
 = 
ad­tive_bË
;

68  (
	gaùive_bË
 && 
	g´ofe_¤c
);

71 
boŞ
 
	gProfeSh¬e
::
S‘ProfeSourû
(
ProfeSourûSh¬e
 &
sourû
)

73 
Unš™Profe
();

75 
	g´ofe_¤c_sh¬e
 = 
sourû
;

76 
	g´ofe_¤c
 = 
sourû
.
g‘
();

78  
In™Profe
();

81 
boŞ
 
	gProfeSh¬e
::
IsInRªge
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, **
»Ï‹d_obj
)

83 
SYSTEMTIME
 
	g¡
 = 
d©e_time
;

84 
tm
 
	gtmp_tm
;

85 cÚ¡ 
	gSYSUTILS_SPACE
::
UTCTimeS·n
 
Úehour
(1, 0, 0);

87 ià((
	gd©e_time
<
	gcu¼_begš
 || d©e_time>
	gcu¼_’d
è|| 
	g´ofe_¤c_sh¬e
->
IsI‹mUpd©ed
())

89 
	gtick1
 = 
¡
.
wHour
 * 60;

90 
	gtick2
 = 
tick1
 + 60;

92 
TRACE
("tick1 = %d,ick2 = %d\n", 
tick1
, 
tick2
);

93 
	gaùive_bË
->
S‘Tick
(
tick1
, 
tick2
);

94 
	gaùive_bË
->
C»©eTabË
(60, 
çl£
);

95 ià(! 
Upd©eAùiveTabË
(
d©e_time
))

96  
	gçl£
;

97 
	gtmp_tm
 = (
tm
è
d©e_time
;

98 
	gcu¼_begš
.
S‘TmTime
(

99 
tmp_tm
.
tm_y—r
,

100 
tmp_tm
.
tm_mÚ
,

101 
tmp_tm
.
tm_mday
,

102 
tmp_tm
.
tm_hour
,

104 
	gcu¼_’d
 = 
cu¼_begš
 + 
Úehour
;

106 
TRACE
("[Upd©eAùiveTabË] cu¼_begš = %lu\Àcu¼_’d = %lu\n", (
time_t
)
cu¼_begš
, (time_tè
cu¼_’d
);

107 
SHOW_ACTIVE_TABLE
(
d©e_time
, 
aùive_bË
);

108 
	g´ofe_¤c_sh¬e
->
CË¬I‹mUpd©ed
();

111  
	gProfe
::
IsInRªge
(
d©e_time
, 
»Ï‹d_obj
);

	@../../titanutils/schedule/ScheduleProfileShareImp.h

1 #iâdeà
__SCHEDULEPROFILESHARE_H__


2 
	#__SCHEDULEPROFILESHARE_H__


	)

4 
	~"AùiveTabË.h
"

5 
	~"ScheduËProfe.h
"

6 
	~"ScheduËBricks.h
"

7 
	~"commÚ/ut™y.h
"

9 
Çme¥aû
 
	gScheduË
 {

11 şas 
	cProfeSourûImp
: 
public
 
ProfeSourû
 {

12 
public
:

13 
ProfeSourûImp
() {}

14 ~
ProfeSourûImp
() {}

15 
boŞ
 
AddScheduËI‹mS‘
(cÚ¡ 
ScheduËI‹mS‘
 &
sis
è{ 
ProfeSourû
::AddScheduleItemSet(sis);}

17 
	g´iv©e
:

18 
¡d
::
¡ršg
 
G‘URI
() const { "";}

19 
boŞ
 
In™Ÿl
(è{ 
	gŒue
;}

20 
boŞ
 
Unš™Ÿl
(è{ 
	gŒue
;}

24 
	gScheduËSh¬ePŒ
<
	tProfeSourûImp
> 
	tProfeSourûSh¬e
;

26 şas 
	cProfeSh¬e
 : 
public
 
Profe
 {

27 
public
:

28 
ex¶ic™
 
ProfeSh¬e
() {}

29 
ex¶ic™
 
ProfeSh¬e
(
ProfeSourûSh¬e
 &
sourû
);

30 
	gvœtu®
 ~
ProfeSh¬e
(è{
Unš™Profe
();}

32 
boŞ
 
S‘ProfeSourû
(
ProfeSourûSh¬e
 &
sourû
);

33 
Unš™Profe
();

34 
boŞ
 
In™Profe
();

36 
vœtu®
 
boŞ
 
IsInRªge
(cÚ¡ 
SYSUTILS_SPACE
::
UTCTime
 &
d©e_time
, **
»Ï‹d_obj
 = 
NULL
);

38 
	g´iv©e
:

39 
ProfeSourûSh¬e
 
´ofe_¤c_sh¬e
;

	@../../titanutils/schedule/ScheduleProfileSourceImp.cpp

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~<lim™s.h
>

4 
	~<¡dlib.h
>

5 
	~<”ºo.h
>

7 
	~"commÚ/fe.h
"

8 
	~"commÚ/ut™y.h
"

9 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

11 
	~<io¡»am
>

12 
	~<f¡»am
>

14 
	~"ScheduËProfe.h
"

15 
	~"ScheduËProfeSourûImp.h
"

16 
	~"ScheduËBricks.h
"

17 
	~"AùiveTabË.h
"

18 
	~"debugMsg/Debug.h
"

20 #ifdeà
WIN32


21 
	#¡¹ok_r
 
¡¹ok_s


	)

26 
Çme¥aû
 
	gScheduË
 {

31 
	gProfeSourûSim¶e
::
ProfeSourûSim¶e
()

33 
TRACE
("EÁ”šg %s...\n", 
__FUNCTION_SIGNATURE__
);

36 
	gProfeSourûSim¶e
::
ProfeSourûSim¶e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
)

38 
_f•©h
 = 
SYSUTILS_SPACE
::
ResŞveP©h
(
f’ame
);

39 ià(
	g_f•©h
 != "")

41 
_uri
 = "file://";

42 
	g_uri
 +ğ
_f•©h
;

46 
	gProfeSourûSim¶e
::~
ProfeSourûSim¶e
()

48 
TRACE
("EÁ”šg %s...\n", 
__FUNCTION_SIGNATURE__
);

50 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚLock
 
®
(&
cs_sis
);

53 
	gProfeSourûSim¶e
::
S‘IÅutFe
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
)

55 ià(
f’ame
 == "")

58 
	g_f•©h
 = 
SYSUTILS_SPACE
::
ResŞveP©h
(
f’ame
);

59 ià(
	g_f•©h
 != "")

61 
_uri
 = "file://";

62 
	g_uri
 +ğ
_f•©h
;

66 
boŞ
 
	gProfeSourûSim¶e
::
In™Ÿl
()

68 ià(
_f•©h
 == "")

69  
çl£
;

71 
Re£tScheduËI‹mS‘
();

73 
	g¡d
::
if¡»am
 
šfe
;

74 
	gšfe
.
İ’
(
_f•©h
.
c_¡r
(), 
¡d
::
if¡»am
::
š
);

75 
	g¡d
::
¡ršg
 
buf_lše
;

76 
ScheduËI‹mS‘
 
	gmy_sis
;

77 
	g¡d
::
g‘lše
(
šfe
, 
buf_lše
).
good
())

79 iàĞ
S‘ScheduËI‹mS‘
(
my_sis
, 
buf_lše
) )

80 
AddScheduËI‹mS‘
(
my_sis
);

82 
	gšfe
.
şo£
();

84  
	gŒue
;

87 
boŞ
 
	gProfeSourûSim¶e
::
Unš™Ÿl
()

89 
Re£tScheduËI‹mS‘
();

91  
	gŒue
;

94 
boŞ
 
	gProfeSourûSim¶e
::
S‘ScheduËI‹mS‘
(
ScheduËI‹mS‘
 &
sis
, cÚ¡ 
¡d
::
¡ršg
 &
£‰šg
)

96 *
dup_¡ršg
 = 
NULL
;

97 
	g¡¬t_time
, 
	g’d_time
;

98 *
	gtok
, *
	gsubtok
;

99 *
	g§v•Œ1
, *
	g§v•Œ2
;

101 ià(
	g£‰šg
 == "")

102  
çl£
;

104 
	gdup_¡ršg
 = 
¡rdup
(
£‰šg
.
c_¡r
());

105 ià(
	gNULL
 =ğ
dup_¡ršg
)

106  
çl£
;

109 
	gtok
 = 
¡¹ok_r
(
dup_¡ršg
, ":", &
§v•Œ1
);

110 ià(
	gNULL
 =ğ
tok
)

111 
çl£_»tuº
;

112 ià('#' =ğ
tok
[0] || ';' ==ok[0])

113 
çl£_»tuº
;

115 ià(0 =ğ
¡rcmp
(
tok
, "day"))

117 
ScheduËI‹mDay
 
	g™em
;

118 
	gScheduËI‹mDay
::
time_¦iû
 
¦iû
;

119 
	gScheduËI‹mBa£
::
ACTIVE_TYPE
 
t
;

121 (
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
))!=NULL)

123 
t
 = 
ScheduËI‹mBa£
::
kAT_NONE
;

124 
	g¡¬t_time
 = 0;

125 
	g’d_time
 = 0;

127 
	gsubtok
 = 
¡¹ok_r
(
tok
, ",", &
§v•Œ2
);

128 ià(
	gNULL
 =ğ
subtok
) ;

130 ià(
©oi
(
subtok
)>0)

131 
	gt
 = 
ScheduËI‹mBa£
::
kAT_ACTIVE
;

133 
	gt
 = 
ScheduËI‹mBa£
::
kAT_INACTIVE
;

135 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

136 ià(
	gNULL
 =ğ
subtok
) ;

137 
	g¡¬t_time
 = 
©oi
(
subtok
);

139 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

140 ià(
	gNULL
 =ğ
subtok
) ;

141 
	g’d_time
 = 
©oi
(
subtok
);

143 
TRACE
("Set slice <%s, %d, %d> into ScheduleItemDay.\n",

144 
ScheduËI‹mBa£
::
kAT_ACTIVE
 =ğ
t
 ? "a" : "i",

145 
¡¬t_time
, 
’d_time
);

146 
	g¦iû
.
	g¡¬t
 = 
¡¬t_time
;

147 
	g¦iû
.
	g’d
 = 
’d_time
;

148 
	g™em
.
AddTimeSliû
(
t
, 
¦iû
);

151  
	gsis
.
AddScheduËI‹m
(
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, &
™em
);

153 ià(0 =ğ
¡rcmp
(
tok
, "week"))

155 
ScheduËI‹mW“k
 
	g™em
;

156 
	gScheduËI‹mW“k
::
time_¦iû
 
¦iû
;

157 
	gScheduËI‹mBa£
::
ACTIVE_TYPE
 
t
;

158 
	gw“k
;

160 (
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
))!=NULL)

162 
t
 = 
ScheduËI‹mBa£
::
kAT_NONE
;

163 
	g¡¬t_time
 = 0;

164 
	g’d_time
 = 0;

166 
	gsubtok
 = 
¡¹ok_r
(
tok
, ",", &
§v•Œ2
);

167 ià(
	gNULL
 =ğ
subtok
) ;

169 ià(
©oi
(
subtok
)>0)

170 
	gt
 = 
ScheduËI‹mBa£
::
kAT_ACTIVE
;

172 
	gt
 = 
ScheduËI‹mBa£
::
kAT_INACTIVE
;

174 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

175 ià(
	gNULL
 =ğ
subtok
) ;

176 
	gw“k
 = 
©oi
(
subtok
);

178 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

179 ià(
	gNULL
 =ğ
subtok
) ;

180 
	g¡¬t_time
 = 
©oi
(
subtok
);

182 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

183 ià(
	gNULL
 =ğ
subtok
) ;

184 
	g’d_time
 = 
©oi
(
subtok
);

186 
TRACE
("Set slice <%s, %d, %d, %d> into ScheduleItemWeek.\n",

187 
ScheduËI‹mBa£
::
kAT_ACTIVE
 =ğ
t
 ? "a" : "i",

188 
w“k
, 
¡¬t_time
, 
’d_time
);

189 
	g¦iû
.
	gw“k
 = 
w“k
;

190 
	g¦iû
.
	g¡¬t
 = 
¡¬t_time
;

191 
	g¦iû
.
	g’d
 = 
’d_time
;

192 
	g™em
.
AddTimeSliû
(
t
, 
¦iû
);

195  
	gsis
.
AddScheduËI‹m
(
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, &
™em
);

197 ià(0 =ğ
¡rcmp
(
tok
, "month"))

200 
ScheduËI‹mMÚth
 
	g™em
;

201 
	gScheduËI‹mMÚth
::
time_¦iû_1
 
¦iû1
;

202 
	gScheduËI‹mMÚth
::
time_¦iû_3
 
¦iû3
;

203 
	gScheduËI‹mBa£
::
ACTIVE_TYPE
 
t
;

204 
	gday
, 
	gnumb”
, 
	gw“k
;

205 
	gmÚth_ty³
 = 0;

206 
	gis_Ãxt
;

208 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

209 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

210 
	gmÚth_ty³
 = 
©oi
(
tok
);

211 ià(
	gmÚth_ty³
!=1 && 
mÚth_ty³
!=3è
çl£_»tuº
;

213 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

214 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

215 
	gmÚth_ty³
)

218 
day
 = 
©oi
(
tok
);

221 
numb”
 = 
©oi
(
tok
);

222 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

223 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

224 
	gw“k
 = 
©oi
(
tok
);

227 
çl£_»tuº
;

231 (
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
))!=NULL)

233 
t
 = 
ScheduËI‹mBa£
::
kAT_NONE
;

234 
	g¡¬t_time
 = 0;

235 
	g’d_time
 = 0;

236 
	gis_Ãxt
 = 0;

238 
	gsubtok
 = 
¡¹ok_r
(
tok
, ",", &
§v•Œ2
);

239 ià(
	gNULL
 =ğ
subtok
) ;

240 ià(
©oi
(
subtok
)>0)

241 
	gt
 = 
ScheduËI‹mBa£
::
kAT_ACTIVE
;

243 
	gt
 = 
ScheduËI‹mBa£
::
kAT_INACTIVE
;

245 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

246 ià(
	gNULL
 =ğ
subtok
) ;

247 ià(
©oi
(
subtok
)>0è
	gis_Ãxt
 = 1;

249 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

250 ià(
	gNULL
 =ğ
subtok
) ;

251 
	g¡¬t_time
 = 
©oi
(
subtok
);

253 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

254 ià(
	gNULL
 =ğ
subtok
) ;

255 
	g’d_time
 = 
©oi
(
subtok
);

257 
	gmÚth_ty³
)

260 
TRACE
("Set slice <%s, %d, %d, %d, %d> into ScheduleItemMonth.\n",

261 
ScheduËI‹mBa£
::
kAT_ACTIVE
 =ğ
t
 ? "a" : "i",

262 
day
, 
is_Ãxt
, 
¡¬t_time
, 
’d_time
);

263 
	g¦iû1
.
	gmÚth
 = -1;

264 
	g¦iû1
.
	gday
 = 
day
;

265 
	g¦iû1
.
	gis_Ãxt
 = 
is_Ãxt
;

266 
	g¦iû1
.
	g¡¬t
 = 
¡¬t_time
;

267 
	g¦iû1
.
	g’d
 = 
’d_time
;

268 
	g™em
.
AddTimeSliû
(
t
, 
¦iû1
);

271 
TRACE
("Set slice <%s, %d/%d, %d, %d, %d> into ScheduleItemMonth.\n",

272 
ScheduËI‹mBa£
::
kAT_ACTIVE
 =ğ
t
 ? "a" : "i",

273 
numb”
, 
w“k
, 
is_Ãxt
, 
¡¬t_time
, 
’d_time
);

274 
	g¦iû3
.
	gmÚth
 = -1;

275 
	g¦iû3
.
	gnumb”
 = 
numb”
;

276 
	g¦iû3
.
	gw“k
 = 
w“k
;

277 
	g¦iû3
.
	gis_Ãxt
 = 
is_Ãxt
;

278 
	g¦iû3
.
	g¡¬t
 = 
¡¬t_time
;

279 
	g¦iû3
.
	g’d
 = 
’d_time
;

280 
	g™em
.
AddTimeSliû
(
t
, 
¦iû3
);

287  
	gsis
.
AddScheduËI‹m
(
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, &
™em
);

289 ià(0 =ğ
¡rcmp
(
tok
, "year"))

292 
ScheduËI‹mMÚth
 
	g™em
;

293 
	gScheduËI‹mMÚth
::
time_¦iû_1
 
¦iû1
;

294 
	gScheduËI‹mMÚth
::
time_¦iû_3
 
¦iû3
;

295 
	gScheduËI‹mBa£
::
ACTIVE_TYPE
 
t
;

296 
	gmÚth
, 
	gday
, 
	gnumb”
, 
	gw“k
;

297 
	gmÚth_ty³
 = 0;

298 
	gis_Ãxt
;

300 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

301 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

302 
	gmÚth_ty³
 = 
©oi
(
tok
);

303 ià(
	gmÚth_ty³
!=1 && 
mÚth_ty³
!=3è
çl£_»tuº
;

305 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

306 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

307 
	gmÚth
 = 
©oi
(
tok
);

309 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

310 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

311 
	gmÚth_ty³
)

314 
day
 = 
©oi
(
tok
);

317 
numb”
 = 
©oi
(
tok
);

318 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

319 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

320 
	gw“k
 = 
©oi
(
tok
);

323 
çl£_»tuº
;

327 (
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
))!=NULL)

329 
t
 = 
ScheduËI‹mBa£
::
kAT_NONE
;

330 
	g¡¬t_time
 = 0;

331 
	g’d_time
 = 0;

332 
	gis_Ãxt
 = 0;

334 
	gsubtok
 = 
¡¹ok_r
(
tok
, ",", &
§v•Œ2
);

335 ià(
	gNULL
 =ğ
subtok
) ;

336 ià(
©oi
(
subtok
)>0)

337 
	gt
 = 
ScheduËI‹mBa£
::
kAT_ACTIVE
;

339 
	gt
 = 
ScheduËI‹mBa£
::
kAT_INACTIVE
;

341 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

342 ià(
	gNULL
 =ğ
subtok
) ;

343 ià(
©oi
(
subtok
)>0è
	gis_Ãxt
 = 1;

345 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

346 ià(
	gNULL
 =ğ
subtok
) ;

347 
	g¡¬t_time
 = 
©oi
(
subtok
);

349 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

350 ià(
	gNULL
 =ğ
subtok
) ;

351 
	g’d_time
 = 
©oi
(
subtok
);

353 
	gmÚth_ty³
)

356 
TRACE
("Set slice <%s, %d/%d, %d, %d, %d> into ScheduleItemMonth.\n",

357 
ScheduËI‹mBa£
::
kAT_ACTIVE
 =ğ
t
 ? "a" : "i",

358 
mÚth
, 
day
, 
is_Ãxt
, 
¡¬t_time
, 
’d_time
);

359 
	g¦iû1
.
	gmÚth
 = 
mÚth
;

360 
	g¦iû1
.
	gday
 = 
day
;

361 
	g¦iû1
.
	gis_Ãxt
 = 
is_Ãxt
;

362 
	g¦iû1
.
	g¡¬t
 = 
¡¬t_time
;

363 
	g¦iû1
.
	g’d
 = 
’d_time
;

364 
	g™em
.
AddTimeSliû
(
t
, 
¦iû1
);

367 
TRACE
("Set slice <%s, %d/%d/%d, %d, %d, %d> into ScheduleItemMonth.\n",

368 
ScheduËI‹mBa£
::
kAT_ACTIVE
 =ğ
t
 ? "a" : "i",

369 
mÚth
, 
numb”
, 
w“k
, 
is_Ãxt
, 
¡¬t_time
, 
’d_time
);

370 
	g¦iû3
.
	gmÚth
 = 
mÚth
;

371 
	g¦iû3
.
	gnumb”
 = 
numb”
;

372 
	g¦iû3
.
	gw“k
 = 
w“k
;

373 
	g¦iû3
.
	gis_Ãxt
 = 
is_Ãxt
;

374 
	g¦iû3
.
	g¡¬t
 = 
¡¬t_time
;

375 
	g¦iû3
.
	g’d
 = 
’d_time
;

376 
	g™em
.
AddTimeSliû
(
t
, 
¦iû3
);

383  
	gsis
.
AddScheduËI‹m
(
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, &
™em
);

385 ià(0 =ğ
¡rcmp
(
tok
, "specific"))

387 
ScheduËI‹mS³cificDay
 
	g™em
;

388 
	gScheduËI‹mS³cificDay
::
time_¦iû
 
¦iû
;

389 
	gScheduËI‹mBa£
::
ACTIVE_TYPE
 
t
;

390 
	gy—r
, 
	gmÚth
, 
	gday
;

391 
	gis_Ãxt
;

393 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

394 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

395 
	gy—r
 = 
©oi
(
tok
);

397 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

398 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

399 
	gmÚth
 = 
©oi
(
tok
);

401 
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
);

402 ià(
	gNULL
 =ğ
tok
è
çl£_»tuº
;

403 
	gday
 = 
©oi
(
tok
);

405 (
	gtok
 = 
¡¹ok_r
(
NULL
, ":", &
§v•Œ1
))!=NULL)

407 
t
 = 
ScheduËI‹mBa£
::
kAT_NONE
;

408 
	g¡¬t_time
 = 0;

409 
	g’d_time
 = 0;

410 
	gis_Ãxt
 = 0;

412 
	gsubtok
 = 
¡¹ok_r
(
tok
, ",", &
§v•Œ2
);

413 ià(
	gNULL
 =ğ
subtok
) ;

414 ià(
©oi
(
subtok
)>0)

415 
	gt
 = 
ScheduËI‹mBa£
::
kAT_ACTIVE
;

417 
	gt
 = 
ScheduËI‹mBa£
::
kAT_INACTIVE
;

419 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

420 ià(
	gNULL
 =ğ
subtok
) ;

421 ià(
©oi
(
subtok
)>0è
	gis_Ãxt
 = 1;

423 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

424 ià(
	gNULL
 =ğ
subtok
) ;

425 
	g¡¬t_time
 = 
©oi
(
subtok
);

427 
	gsubtok
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ2
);

428 ià(
	gNULL
 =ğ
subtok
) ;

429 
	g’d_time
 = 
©oi
(
subtok
);

431 
TRACE
("Set slice <%s, %d/%d/%d, %d, %d, %d> into ScheduleItemSpecificDay.\n",

432 
ScheduËI‹mBa£
::
kAT_ACTIVE
 =ğ
t
 ? "a" : "i",

433 
y—r
, 
mÚth
, 
day
, 
is_Ãxt
, 
¡¬t_time
, 
’d_time
);

434 
	g¦iû
.
	gy—r
 = 
y—r
;

435 
	g¦iû
.
	gmÚth
 = 
mÚth
;

436 
	g¦iû
.
	gday
 = 
day
;

437 
	g¦iû
.
	gis_Ãxt
 = 
is_Ãxt
;

438 
	g¦iû
.
	g¡¬t
 = 
¡¬t_time
;

439 
	g¦iû
.
	g’d
 = 
’d_time
;

440 
	g™em
.
AddTimeSliû
(
t
, 
¦iû
);

443  
	gsis
.
AddScheduËI‹m
(
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, &
™em
);

446 
	gçl£_»tuº
;

448  
	gŒue
;

450 
	gçl£_»tuº
:

451 ià(
dup_¡ršg
!=
NULL
)

452 
ä“
(
dup_¡ršg
);

453  
	gçl£
;

	@../../titanutils/schedule/ScheduleProfileSourceImp.h

1 #iâdeà
__SCHEDULEPROFILESOURCEIMP_H__


2 
	#__SCHEDULEPROFILESOURCEIMP_H__


	)

4 
	~"ScheduËProfe.h
"

6 
	~<¡ršg
>

8 
Çme¥aû
 
	gScheduË
 {

10 şas 
	cProfeSourûSim¶e
 : 
public
 
ProfeSourû
 {

11 
public
:

12 
ex¶ic™
 
ProfeSourûSim¶e
();

13 
ex¶ic™
 
ProfeSourûSim¶e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
);

14 
	gvœtu®
 ~
ProfeSourûSim¶e
();

16 
S‘IÅutFe
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
);

17 
	g¡d
::
¡ršg
 
G‘URI
(ècÚ¡ {  
_uri
; }

19 
boŞ
 
In™Ÿl
();

20 
boŞ
 
Unš™Ÿl
();

22 
	g´Ùeùed
:

23 
boŞ
 
S‘ScheduËI‹mS‘
(
ScheduËI‹mS‘
 &
sis
, cÚ¡ 
¡d
::
¡ršg
 &
£‰šg
);

25 
	g´iv©e
:

26 
¡d
::
¡ršg
 
_f•©h
;

27 
	g¡d
::
¡ršg
 
_uri
;

	@../../titanutils/schedule/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../../titanutils/schedule/unittest/uni_scheduler.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	~<¡dio.h
>

4 
	~<¡ršg.h
>

5 
	~<¡dlib.h
>

6 
	~<sys/¡©.h
>

7 
	~<fú.h
>

9 
	~"scheduË/ScheduËProfe.h
"

10 
	~"scheduË/ScheduËProfeSourûImp.h
"

11 
	~"scheduË/ScheduËBricks.h
"

12 
	~"scheduË/AùiveTabË.h
"

14 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

16 
	$SHOW_ACTIVE_TABLE
(cÚ¡ 
UTCTime
 &
t
, cÚ¡ 
ScheduË
::
AùiveTabË
 *
bË
)

18 ià(
NULL
 =ğ
bË
)

21 
SYSTEMTIME
 
¡
 = 
t
;

22 
j
=0;

23 
v
;

24 
i
=0; i<1440; i++)

25 ià(
bË
->
	`G‘Pos™iÚ
(
i
, &
v
, 
NULL
))

26 ià(
v
)

27 ++
j
;

28 
	`årštf
(
¡d”r
, "%4d/%02d/%02d: %d\n", 
¡
.
wY—r
, st.
wMÚth
, st.
wDay
, 
j
);

30 
i
=0; i<1440; i++)

32 
	`årštf
(
¡d”r
, "%3d%s", 
bË
->
	`G‘Pos™iÚ
(
i
, &
v
, 
NULL
) ? v : 0, 31 == (i%32) ? "\n" : " ");

34 
	`årštf
(
¡d”r
, "\n");

36 
	}
}

38 
	$g‘_cu¼’t_memÜy_u§ge
(*
buf
, 
size
)

40 
fd
 = -1;

41 
»t
 = -1, 
i
;

43 
fd
 = 
	`İ’
("/´oc/£lf/¡©m", 
O_RDONLY
);

44 ià(
fd
<0)

47 
»t
 = 
	`»ad
(
fd
, 
buf
, 
size
);

48 
	`şo£
(
fd
);

50 ià(
»t
>0)

52 
i
 = 
»t
-1;

53 
i
>0)

55 
buf
[
i
])

62 
buf
[
i
--] = '\0';

65 
i
 = -1;

71  
»t
;

72 
	}
}

74 
	$TEST
(
ScheduËTe¡
, 
Un™ScheduËrTe¡
)

76 
mem_buf
[512];

77 
i
, 
n
 = 128, 
»t
;

78 
ScheduË
::
Profe
 *
´ofe
;

79 
ScheduË
::
ProfeSourû
 *
sourû
;

81 
sourû
 = 
Ãw
 
ScheduË
::
ProfeSourûSim¶e
;

82 
	`årštf
(
¡d”r
, "----------------------------------\n");

83 
i
=0; i<
n
; ++i)

85 
»t
 = 
	`g‘_cu¼’t_memÜy_u§ge
(
mem_buf
, (mem_buf));

86 ià(
»t
>0)

88 
mem_buf
[
»t
] = '\0';

89 
	`årštf
(
¡d”r
, "%s\n", 
mem_buf
);

91 
´ofe
 = 
Ãw
 
ScheduË
::
Profe
;

92 
´ofe
->
	`S‘ProfeSourû
(
sourû
);

93 
»t
 = 
	`g‘_cu¼’t_memÜy_u§ge
(
mem_buf
, (mem_buf));

94 ià(
»t
>0)

96 
mem_buf
[
»t
] = '\0';

97 
	`årštf
(
¡d”r
, "%s\n", 
mem_buf
);

100 
	`årštf
(
¡d”r
, "==================================\n");

102 
	`årštf
(
¡d”r
, "----------------------------------\n");

103 
i
=0; i<
n
; ++i)

105 
»t
 = 
	`g‘_cu¼’t_memÜy_u§ge
(
mem_buf
, (mem_buf));

106 ià(
»t
>0)

108 
mem_buf
[
»t
] = '\0';

109 
	`årštf
(
¡d”r
, "%s\n", 
mem_buf
);

111 
´ofe
 = 
Ãw
 
ScheduË
::
ProfeL™e
;

112 
´ofe
->
	`S‘ProfeSourû
(
sourû
);

113 
»t
 = 
	`g‘_cu¼’t_memÜy_u§ge
(
mem_buf
, (mem_buf));

114 ià(
»t
>0)

116 
mem_buf
[
»t
] = '\0';

117 
	`årštf
(
¡d”r
, "%s\n", 
mem_buf
);

120 
	`årštf
(
¡d”r
, "==================================\n");

123 
ScheduË
::
ProfeSourûSim¶e
 
sourû
;

124 
ScheduË
::
ScheduËI‹mS‘
 *
sched_£t
;

125 
ScheduË
::
ScheduËI‹mBa£
 *
ba£
;

126 
UTCTime
 
qt
;

127 
ScheduË
::
AùiveTabË
 *
aùive_bË
;

129 
sched_£t
 = 
Ãw
 
ScheduË
::
ScheduËI‹mS‘
;

130 ià(
NULL
 =ğ
sched_£t
) ;

132 
aùive_bË
 = 
Ãw
 
ScheduË
::
AùiveTabË
;

133 ià(
NULL
 =ğ
aùive_bË
) ;

135 
ba£
 = 
Ãw
 
ScheduË
::
ScheduËI‹mDay
;

136 ià(
NULL
 =ğ
ba£
) ;

138 
ScheduË
::
ScheduËI‹mDay
::
time_¦iû
 
¦iû
;

139 
¦iû
.
¡¬t
 = 3*60+12;

140 
¦iû
.
’d
 = 6*60+59;

141 ((
ScheduË
::
ScheduËI‹mDay
 *è
ba£
)->
	`AddTimeSliû
(ScheduË::
ScheduËI‹mBa£
::
kAT_ACTIVE
, 
¦iû
);

142 
sched_£t
->
	`AddScheduËI‹m
(
ScheduË
::
ScheduËI‹mS‘
::
HIGHEST_PRIORITY
, 
ba£
);

145 
ba£
 = 
Ãw
 
ScheduË
::
ScheduËI‹mW“k
;

146 ià(
NULL
 =ğ
ba£
) ;

148 
ScheduË
::
ScheduËI‹mW“k
::
time_¦iû
 
¦iû
;

149 
i
=0; i<7; ++i)

151 
¦iû
.
w“k
 = 
i
;

152 
¦iû
.
¡¬t
 = 
i
*60+4*60+3;

153 
¦iû
.
’d
 = 
i
*60+9*60+26;

154 ((
ScheduË
::
ScheduËI‹mW“k
 *è
ba£
)->
	`AddTimeSliû
(ScheduË::
ScheduËI‹mBa£
::
kAT_ACTIVE
, 
¦iû
);

155 
sched_£t
->
	`AddScheduËI‹m
(
ScheduË
::
ScheduËI‹mS‘
::
HIGHEST_PRIORITY
, 
ba£
);

159 
ba£
 = 
Ãw
 
ScheduË
::
ScheduËI‹mMÚth
;

160 ià(
NULL
 =ğ
ba£
) ;

162 
ScheduË
::
ScheduËI‹mMÚth
::
time_¦iû_1
 
¦iû1
;

163 
¦iû1
.
mÚth
 = 1;

164 
¦iû1
.
day
 = 2;

165 
¦iû1
.
is_Ãxt
 = 0;

166 
¦iû1
.
¡¬t
 = 600;

167 
¦iû1
.
’d
 = 700;

168 ((
ScheduË
::
ScheduËI‹mMÚth
 *è
ba£
)->
	`AddTimeSliû
(ScheduË::
ScheduËI‹mBa£
::
kAT_ACTIVE
, 
¦iû1
);

169 
sched_£t
->
	`AddScheduËI‹m
(
ScheduË
::
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, 
ba£
);

172 
ba£
 = 
Ãw
 
ScheduË
::
ScheduËI‹mMÚth
;

173 ià(
NULL
 =ğ
ba£
) ;

175 
ScheduË
::
ScheduËI‹mMÚth
::
time_¦iû_3
 
¦iû3
;

176 
¦iû3
.
mÚth
 = 1;

177 
¦iû3
.
numb”
 = 1;

178 
¦iû3
.
w“k
 = 1;

179 
¦iû3
.
is_Ãxt
 = 0;

180 
¦iû3
.
¡¬t
 = 500;

181 
¦iû3
.
’d
 = 800;

182 
»t
 = ((
ScheduË
::
ScheduËI‹mMÚth
 *è
ba£
)->
	`AddTimeSliû
(ScheduË::
ScheduËI‹mBa£
::
kAT_INACTIVE
, 
¦iû3
);

184 
sched_£t
->
	`AddScheduËI‹m
(
ScheduË
::
ScheduËI‹mS‘
::
LOWEST_PRIORITY
, 
ba£
);

187 
ScheduË
::
ScheduËI‹mMÚth
::
time_¦iû_1
 
¦iû1
;

188 
i
=0; i<6; i++)

190 
¦iû1
.
mÚth
 = 
i
*2+1;

191 
j
=0; j<15; j++)

193 
¦iû1
.
day
 = 
j
*2+1;

194 
¦iû1
.
¡¬t
 = 14*60+31;

195 
¦iû1
.
’d
 = 19*60+54;

196 
¦iû1
.
is_Ãxt
 = 0;

197 ((
ScheduË
::
ScheduËI‹mMÚth
 *è
ba£
)->
	`AddTimeSliû
(ScheduË::
ScheduËI‹mBa£
::
kAT_ACTIVE
, 
¦iû1
);

198 
sched_£t
->
	`AddScheduËI‹m
(
ScheduË
::
ScheduËI‹mS‘
::
HIGHEST_PRIORITY
, 
ba£
);

200 
¦iû1
.
¡¬t
 = 18;

201 
¦iû1
.
’d
 = 3*60+24;

202 
¦iû1
.
is_Ãxt
 = 1;

203 ((
ScheduË
::
ScheduËI‹mMÚth
 *è
ba£
)->
	`AddTimeSliû
(ScheduË::
ScheduËI‹mBa£
::
kAT_ACTIVE
, 
¦iû1
);

204 
sched_£t
->
	`AddScheduËI‹m
(
ScheduË
::
ScheduËI‹mS‘
::
HIGHEST_PRIORITY
, 
ba£
);

216 
	}
}

219 
	gqt
.
S‘Sy¡emTime
(2012, 1, 2);

220 
	gaùive_bË
->
Re£t
();

221 
	gsched_£t
->
MaskAùiveTabË
(
qt
, 
aùive_bË
);

225 
	gba£
 = 
Ãw
 
ScheduË
::
ScheduËI‹mS³cificDay
;

226 ià(
	gNULL
 =ğ
ba£
) ;

228 
	gScheduË
::
ScheduËI‹mS³cificDay
::
time_¦iû
 
¦iû
;

229 ((
	gScheduË
::
ScheduËI‹mS³cificDay
 *è
ba£
)->
AddTimeSliû
(
ScheduË
::
ScheduËI‹mBa£
::
kAT_ACTIVE
, 
¦iû
);

230 
	gsched_£t
->
AddScheduËI‹m
(
ScheduË
::
ScheduËI‹mS‘
::
HIGHEST_PRIORITY
, 
ba£
);

234 
	gsourû
.
S‘IÅutFe
("simple.in");

235 
´štf
("sourû iÅut: %s\n", 
sourû
.
G‘URI
());

236 
´štf
("sourû In™Ÿl: %d\n", 
sourû
.
In™Ÿl
());

237 
´štf
("sourû Unš™Ÿl: %d\n", 
sourû
.
Unš™Ÿl
());

239 
	gi
=1; i<32; ++i)

241 
	gqt
.
S‘D©e
(2011, 12, 
i
);

242 
	gaùive_bË
->
Re£t
();

243 
	gsched_£t
->
MaskAùiveTabË
(
qt
, 
aùive_bË
);

244 
SHOW_ACTIVE_TABLE
(
qt
, 
aùive_bË
);

	@../../titanutils/server/AprIPFilter.cpp

1 
	~"A´IPF‹r.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 
boŞ
 
	$CÚv”tIPAdd»ss
(cÚ¡ *

, 
­r_št32_t
 
çmy
, 
IPv6
 *
add»ss
)

14 
	`IF_NULL_RETURN_VALUE
(

, 
çl£
);

15 
	`IF_NULL_RETURN_VALUE
(
add»ss
, 
çl£
);

16 
	`mem£t
(
add»ss
, 0, (
IPv6
));

18 
çmy
)

20 
APR_IPV4_ADDR_OK
:

21 
a1
, 
a2
, 
a3
, 
a4
;

22 ià(
	`ssÿnf
(

, "%d.%d.%d.%d", &
a1
, &
a2
, &
a3
, &
a4
) != 4)

24  
çl£
;

26 
add»ss
->
a
[3] = (
a1
 << 24è+ (
a2
 << 16è+ (
a3
 << 8è+ 
a4
;

27  
Œue
;

28 
APR_IPV6_ADDR_OK
:

30  
çl£
;

32  
çl£
;

34  
Œue
;

35 
	}
}

40 
	gA´IPAdd»ss
::
	$A´IPAdd»ss
(cÚ¡ *

, 
­r_št32_t
 
çmy
 )

41 : 
	`m_çmy
(
çmy
)

42 , 
	$m_v®id
(
çl£
)

44 
m_v®id
 = 
	`CÚv”tIPAdd»ss
(

, 
çmy
, &
m_add»ss
);

45 
	}
}

47 
	gA´IPAdd»ss
::~
	$A´IPAdd»ss
()

49 
	}
}

51 
A´IPAdd»ss
::
	$A´IPAdd»ss
(cÚ¡ 
A´IPAdd»ss
 &
rhs
)

53 
m_çmy
 = 
rhs
.m_family;

54 
	`memıy
(&
m_add»ss
, &
rhs
.m_address, (m_address));

55 
	}
}

57 
	gA´IPAdd»ss
 &A´IPAdd»ss::
İ”©Ü
=(cÚ¡ 
A´IPAdd»ss
 &
rhs
)

59 ià(
this
 !ğ&
rhs
)

61 
m_çmy
 = 
rhs
.m_family;

62 
memıy
(&
m_add»ss
, &
rhs
.m_address, (m_address));

64  *
	gthis
;

67 
boŞ
 
	gA´IPAdd»ss
::
	$IsV®id
() const

69  
m_v®id
;

70 
	}
}

72 
IPv6
 
	gA´IPAdd»ss
::
	$G‘Add»ss
() const

74  
m_add»ss
;

75 
	}
}

77 
	gA´IPAdd»ss
::
	$com·»
(cÚ¡ 
A´IPAdd»ss
 &
rhs
) const

79 
i
 = 0; i < 4; i++)

81 ià(
m_add»ss
.
a
[
i
] !ğ
rhs
.m_address.a[i])

83  
m_add»ss
.
a
[
i
] - 
rhs
.m_address.a[i];

87 
	}
}

89 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ 
	gA´IPAdd»ss
 &
	ga2
)

91  
	ga1
.
com·»
(
a2
) == 0;

94 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ 
	gA´IPAdd»ss
 &
	ga2
)

96  
	ga1
.
com·»
(
a2
) != 0;

99 
boŞ
 
	gİ”©Ü
> (cÚ¡ 
	gA´IPAdd»ss
 &
	ga1
, cÚ¡ A´IPAdd»s &
	ga2
)

101  
	ga1
.
com·»
(
a2
) > 0;

104 
boŞ
 
	gİ”©Ü
< (cÚ¡ 
	gA´IPAdd»ss
 &
	ga1
, cÚ¡ A´IPAdd»s &
	ga2
)

106  
	ga1
.
com·»
(
a2
) < 0;

109 
boŞ
 
	gİ”©Ü
>=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ 
	gA´IPAdd»ss
 &
	ga2
)

111  
	ga1
.
com·»
(
a2
) >= 0;

114 
boŞ
 
	gİ”©Ü
<=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ 
	gA´IPAdd»ss
 &
	ga2
)

116  
	ga1
.
com·»
(
a2
) <= 0;

122 
	gA´IPRªge
::
	$A´IPRªge
(cÚ¡ *
Begš
, cÚ¡ *
End
, 
­r_št32_t
 
çmy
)

123 : 
	`m_begš
(
Begš
, 
çmy
)

124 , 
	$m_’d
(
End
, 
çmy
)

126 
	}
}

128 
	gA´IPRªge
::
	$A´IPRªge
(cÚ¡ *

, 
­r_št32_t
 
çmy
)

129 : 
	`m_begš
(

, 
çmy
)

130 , 
	$m_’d
(

, 
çmy
)

132 
	}
}

134 
	gA´IPRªge
::
	$A´IPRªge
(cÚ¡ 
A´IPAdd»ss
 &
Begš
, cÚ¡ A´IPAdd»s &
End
)

135 : 
	`m_begš
(
Begš
)

136 , 
	$m_’d
(
End
)

138 
	}
}

140 
	gA´IPRªge
::
	$A´IPRªge
(cÚ¡ 
A´IPAdd»ss
 &

)

141 : 
	`m_begš
(

)

142 , 
	$m_’d
(

)

144 
	}
}

146 
	gA´IPRªge
::~
	$A´IPRªge
()

148 
	}
}

150 
A´IPRªge
::
	$A´IPRªge
(cÚ¡ 
A´IPRªge
 &
rhs
)

151 : 
	`m_begš
(
rhs
.
m_begš
)

152 , 
	$m_’d
(
rhs
.
m_’d
)

154 
	}
}

156 
	gA´IPRªge
 &A´IPRªge::
İ”©Ü
=(cÚ¡ 
A´IPRªge
 &
rhs
)

158 ià(
this
 !ğ&
rhs
)

160 
m_begš
 = 
rhs
.m_begin;

161 
	gm_’d
 = 
rhs
.
m_’d
;

163  *
	gthis
;

166 
boŞ
 
	gA´IPRªge
::
	$IsV®id
() const

168 ià(
m_begš
.
	`IsV®id
(è&& 
m_’d
.IsValid())

170  
m_begš
 <ğ
m_’d
;

174  
m_begš
.
	`IsV®id
(è|| 
m_’d
.IsValid();

176 
	}
}

178 
A´IPAdd»ss
 
	gA´IPRªge
::
	$G‘Begš
() const

180  
m_begš
;

181 
	}
}

183 
A´IPAdd»ss
 
	gA´IPRªge
::
	$G‘End
() const

185  
m_’d
;

186 
	}
}

188 
boŞ
 
	gA´IPRªge
::
	$CheckRªge
(cÚ¡ 
A´IPAdd»ss
 &
add»ss
) const

190 ià(!
add»ss
.
	`IsV®id
())

192  
çl£
;

194 ià(
m_begš
.
	`IsV®id
(è&& 
m_’d
.IsValid())

196  (
m_begš
 <ğ
add»ss
è&& (add»s <ğ
m_’d
);

198 ià(
m_begš
.
	`IsV®id
(è&& !
m_’d
.IsValid())

200  
m_begš
 <ğ
add»ss
;

202 ià(!
m_begš
.
	`IsV®id
(è&& 
m_’d
.IsValid())

204  
add»ss
 <ğ
m_’d
;

208  
çl£
;

210 
	}
}

215 
	gA´IPF‹r
::
	$A´IPF‹r
()

216 : 
	`m_csWh™e
()

217 , 
	`m_csBÏck
()

218 , 
	`m_bEÇbËWh™e
(
çl£
)

219 , 
	`m_bEÇbËBÏck
(
çl£
)

220 , 
	`m_¿ngeWh™e
()

221 , 
	$m_¿ngeBÏck
()

223 
	}
}

225 
	gA´IPF‹r
::~
	$A´IPF‹r
()

227 
	}
}

229 
boŞ
 
A´IPF‹r
::
	$S‘Wh™eEÇbË
(
boŞ
 
’abË
)

231 
Cr™iÿlSeùiÚLock
 
	`c¦_wh™e
(&
m_csWh™e
);

233 
m_bEÇbËWh™e
 = 
’abË
;

235  
Œue
;

236 
	}
}

238 
boŞ
 
	gA´IPF‹r
::
	$S‘BÏckEÇbË
(
boŞ
 
’abË
)

240 
Cr™iÿlSeùiÚLock
 
	`c¦_bÏck
(&
m_csBÏck
);

242 
m_bEÇbËBÏck
 = 
’abË
;

244  
Œue
;

245 
	}
}

247 
boŞ
 
	gA´IPF‹r
::
	$G‘Wh™eEÇbË
()

249 
Cr™iÿlSeùiÚLock
 
	`c¦_wh™e
(&
m_csWh™e
);

251  
m_bEÇbËWh™e
;

252 
	}
}

254 
boŞ
 
	gA´IPF‹r
::
	$G‘BÏckEÇbË
()

256 
Cr™iÿlSeùiÚLock
 
	`c¦_bÏck
(&
m_csBÏck
);

258  
m_bEÇbËBÏck
;

259 
	}
}

261 
boŞ
 
	gA´IPF‹r
::
	$AddWh™eRªge
(cÚ¡ 
A´IPRªge
 &
¿nge
)

263 
Cr™iÿlSeùiÚLock
 
	`c¦_wh™e
(&
m_csWh™e
);

265 
m_¿ngeWh™e
.
	`push_back
(
¿nge
);

267  
Œue
;

268 
	}
}

270 
boŞ
 
	gA´IPF‹r
::
	$AddBÏckRªge
(cÚ¡ 
A´IPRªge
 &
¿nge
)

272 
Cr™iÿlSeùiÚLock
 
	`c¦_bÏck
(&
m_csBÏck
);

274 
m_¿ngeBÏck
.
	`push_back
(
¿nge
);

276  
Œue
;

277 
	}
}

279 
	g¡d
::
veùÜ
<
A´IPRªge
> 
A´IPF‹r
::
	$G‘Wh™eLi¡
()

281 
Cr™iÿlSeùiÚLock
 
	`c¦_wh™e
(&
m_csWh™e
);

283  
m_¿ngeWh™e
;

284 
	}
}

286 
	g¡d
::
veùÜ
<
A´IPRªge
> 
A´IPF‹r
::
	$G‘BÏckLi¡
()

288 
Cr™iÿlSeùiÚLock
 
	`c¦_bÏck
(&
m_csBÏck
);

290  
m_¿ngeBÏck
;

291 
	}
}

293 
boŞ
 
	gA´IPF‹r
::
	$CË¬Wh™eLi¡
()

295 
Cr™iÿlSeùiÚLock
 
	`c¦_wh™e
(&
m_csWh™e
);

297 
m_¿ngeWh™e
.
	`ş—r
();

299  
Œue
;

300 
	}
}

302 
boŞ
 
	gA´IPF‹r
::
	$CË¬BÏckLi¡
()

304 
Cr™iÿlSeùiÚLock
 
	`c¦_bÏck
(&
m_csBÏck
);

306 
m_¿ngeBÏck
.
	`ş—r
();

308  
Œue
;

309 
	}
}

311 
boŞ
 
	gA´IPF‹r
::
	$V®id©eAdd»ss
(
A´Sock‘
 *
sock‘
)

313 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

315 *

 = 
NULL
;

316 
­r_sockaddr_t
 *
addr
 = 
NULL
;

317 
	`­r_sock‘_addr_g‘
(&
addr
, 
APR_REMOTE
, 
sock‘
->
	`guts
());

318 
	`IF_NULL_RETURN_VALUE
(
addr
, 
çl£
);

319 
	`­r_sockaddr__g‘
(&

, 
addr
);

320 
	`IF_NULL_RETURN_VALUE
(

, 
çl£
);

322 
Cr™iÿlSeùiÚLock
 
	`c¦_wh™e
(&
m_csWh™e
);

323 
Cr™iÿlSeùiÚLock
 
	`c¦_bÏck
(&
m_csBÏck
);

325 
A´IPAdd»ss
 
	`add»ss
(

, 
addr
->
çmy
);

326 
boŞ
 
v®id©e
 = !
m_bEÇbËWh™e
;

328 ià(
m_bEÇbËWh™e
)

330 
¡d
::
veùÜ
<
A´IPRªge
>::
™”©Ü
 
™
 = 
m_¿ngeWh™e
.
	`begš
(); iˆ!ğm_¿ngeWh™e.
	`’d
(); it++)

332 ià(
™
->
	`IsV®id
(è&& it->
	`CheckRªge
(
add»ss
))

334 
v®id©e
 = 
Œue
;

340 ià(
m_bEÇbËBÏck
)

342 
¡d
::
veùÜ
<
A´IPRªge
>::
™”©Ü
 
™
 = 
m_¿ngeBÏck
.
	`begš
(); iˆ!ğm_¿ngeBÏck.
	`’d
(); it++)

344 ià(
™
->
	`IsV®id
(è&& it->
	`CheckRªge
(
add»ss
))

346 
v®id©e
 = 
çl£
;

352  
v®id©e
;

353 
	}
}

	@../../titanutils/server/AprIPFilter.h

1 #iâdeà
__APR_IP_FILTER_H__


2 
	#__APR_IP_FILTER_H__


	)

4 
	~"commÚ/ut™y.h
"

5 
	~<¡dio.h
>

6 
	~<¡ršg.h
>

7 
	~<veùÜ
>

8 
	~"­r/­r_sock‘.h
"

9 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

16 
ušt32_t
 
	ma
[4];

17 } 
	tIPv6
;

22 şas 
	cA´IPAdd»ss


24 
ä›nd
 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ 
	mA´IPAdd»ss
 &
	ma2
);

25 
ä›nd
 
boŞ
 
	mİ”©Ü
!=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ 
	mA´IPAdd»ss
 &
	ma2
);

26 
ä›nd
 
boŞ
 
	mİ”©Ü
> (cÚ¡ 
	mA´IPAdd»ss
 &
	ma1
, cÚ¡ A´IPAdd»s &
	ma2
);

27 
ä›nd
 
boŞ
 
	mİ”©Ü
< (cÚ¡ 
	mA´IPAdd»ss
 &
	ma1
, cÚ¡ A´IPAdd»s &
	ma2
);

28 
ä›nd
 
boŞ
 
	mİ”©Ü
>=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ 
	mA´IPAdd»ss
 &
	ma2
);

29 
ä›nd
 
boŞ
 
	mİ”©Ü
<=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ 
	mA´IPAdd»ss
 &
	ma2
);

30 
	mpublic
:

31 
A´IPAdd»ss
(cÚ¡ *

, 
­r_št32_t
 
çmy
=
APR_IPV4_ADDR_OK
);

32 ~
A´IPAdd»ss
();

33 
A´IPAdd»ss
(cÚ¡ A´IPAdd»s &
rhs
);

34 
	mA´IPAdd»ss
 &
	mİ”©Ü
=(cÚ¡ 
A´IPAdd»ss
 &
rhs
);

35 
boŞ
 
	$IsV®id
() const;

36 
IPv6
 
	$G‘Add»ss
() const;

37 
´iv©e
:

38 
	$com·»
(cÚ¡ 
A´IPAdd»ss
 &
rhs
) const;

39 
´iv©e
:

40 
	`A´IPAdd»ss
();

41 
´iv©e
:

42 
­r_št32_t
 
m_çmy
;

43 
IPv6
 
m_add»ss
;

44 
boŞ
 
m_v®id
;

50 
boŞ
 
İ”©Ü
==(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ A´IPAdd»s &
a2
);

51 
boŞ
 
İ”©Ü
!=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ A´IPAdd»s &
a2
);

52 
boŞ
 
İ”©Ü
> (cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ A´IPAdd»s &
a2
);

53 
boŞ
 
İ”©Ü
< (cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ A´IPAdd»s &
a2
);

54 
boŞ
 
İ”©Ü
>=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ A´IPAdd»s &
a2
);

55 
boŞ
 
İ”©Ü
<=(cÚ¡ 
A´IPAdd»ss
 &
a1
, cÚ¡ A´IPAdd»s &
a2
);

60 şas 
	cA´IPRªge


62 
public
:

69 
	`A´IPRªge
(cÚ¡ *
Begš
, cÚ¡ *
End
, 
­r_št32_t
 
çmy
=
APR_IPV4_ADDR_OK
);

76 
	`A´IPRªge
(cÚ¡ *

, 
­r_št32_t
 
çmy
=
APR_IPV4_ADDR_OK
);

83 
	`A´IPRªge
(cÚ¡ 
A´IPAdd»ss
 &
Begš
, cÚ¡ A´IPAdd»s &
End
);

89 
	`A´IPRªge
(cÚ¡ 
A´IPAdd»ss
 &

);

95 
	`A´IPRªge
(cÚ¡ 
A´IPRªge
 &
rhs
);

100 
vœtu®
 ~
	`A´IPRªge
();

107 
A´IPRªge
 &
İ”©Ü
=(cÚ¡ A´IPRªg&
rhs
);

113 
boŞ
 
	$IsV®id
() const;

119 
A´IPAdd»ss
 
	$G‘Begš
() const;

125 
A´IPAdd»ss
 
	$G‘End
() const;

132 
boŞ
 
	$CheckRªge
(cÚ¡ 
A´IPAdd»ss
 &
add»ss
) const;

134 
´iv©e
:

135 
	`A´IPRªge
();

137 
´iv©e
:

138 
A´IPAdd»ss
 
m_begš
;

139 
A´IPAdd»ss
 
m_’d
;

145 şas 
	cA´IPF‹r


147 
public
:

151 
	`A´IPF‹r
();

156 
vœtu®
 ~
	`A´IPF‹r
();

163 
boŞ
 
	`S‘Wh™eEÇbË
(boŞ 
’abË
);

170 
boŞ
 
	`S‘BÏckEÇbË
(boŞ 
’abË
);

176 
boŞ
 
	`G‘Wh™eEÇbË
();

182 
boŞ
 
	`G‘BÏckEÇbË
();

189 
boŞ
 
	`AddWh™eRªge
(cÚ¡ 
A´IPRªge
 &
¿nge
);

196 
boŞ
 
	`AddBÏckRªge
(cÚ¡ 
A´IPRªge
 &
¿nge
);

202 
¡d
::
veùÜ
<
A´IPRªge
> 
	`G‘Wh™eLi¡
();

208 
¡d
::
veùÜ
<
A´IPRªge
> 
	`G‘BÏckLi¡
();

214 
boŞ
 
	`CË¬Wh™eLi¡
();

220 
boŞ
 
	`CË¬BÏckLi¡
();

227 
boŞ
 
	`V®id©eAdd»ss
(
SYSUTILS_SPACE
::
A´Sock‘
 *
sock‘
);

229 
´iv©e
:

230 
	`A´IPF‹r
(cÚ¡ 
A´IPF‹r
 &
rhs
);

231 
A´IPF‹r
 &
İ”©Ü
=(cÚ¡ A´IPF‹¸&
rhs
);

233 
´iv©e
:

234 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_csWh™e
;

235 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_csBÏck
;

236 
boŞ
 
m_bEÇbËWh™e
;

237 
boŞ
 
m_bEÇbËBÏck
;

238 
¡d
::
veùÜ
<
A´IPRªge
> 
m_¿ngeWh™e
;

239 
¡d
::
veùÜ
<
A´IPRªge
> 
m_¿ngeBÏck
;

	@../../titanutils/server/AprTcpResponderPool.cpp

1 
	~"A´TıRe¥Úd”PoŞ.h
"

3 
	~"A´TıSock‘PoŞRe¥Úd”.h
"

4 
	~"commÚ/ut™y.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
	gA´TıRe¥Úd”PoŞ
::
	$A´TıRe¥Úd”PoŞ
(
A´TıSock‘PoŞ
 *
pPoŞ
)

12 : 
	`m_nC­ac™y
(0)

13 , 
	`m_pPoŞ
(
pPoŞ
)

14 , 
	$m_vRe¥Úd”s
()

16 
	}
}

18 
	gA´TıRe¥Úd”PoŞ
::~
	$A´TıRe¥Úd”PoŞ
()

20 
	`De¡royRe¥Úd”s
();

21 
	}
}

23 
boŞ
 
	gA´TıRe¥Úd”PoŞ
::
	$C»©eRe¥Úd”s
(
nC­ac™y
, 
A´TıRe¥Úd”G’”©Ü
 *
pG’”©Ü
)

25 
m_nC­ac™y
 = 
nC­ac™y
;

27 
	`IF_NULL_RETURN_VALUE
(
pG’”©Ü
, 
çl£
);

29 
i
 = 0; i < 
m_nC­ac™y
; i++)

31 
A´TıSock‘PoŞRe¥Úd”
 *
pWÜk”
 = 
pG’”©Ü
->
	`C»©eRe¥Úd”
(
m_pPoŞ
);

32 
m_vRe¥Úd”s
.
	`push_back
(
pWÜk”
);

35  
Œue
;

36 
	}
}

38 
boŞ
 
	gA´TıRe¥Úd”PoŞ
::
	$De¡royRe¥Úd”s
()

40 
	`StİRe¥Ú£
();

42 
¡d
::
veùÜ
<
A´TıSock‘PoŞRe¥Úd”
 *>::
™”©Ü
 
™
 = 
m_vRe¥Úd”s
.
	`begš
(); iˆ!ğm_vRe¥Úd”s.
	`’d
(); it++)

44 
	`d–‘e
 (*
™
);

46 
m_vRe¥Úd”s
.
	`ş—r
();

48  
Œue
;

49 
	}
}

51 
boŞ
 
	gA´TıRe¥Úd”PoŞ
::
	$S¹Re¥Ú£
()

53 
boŞ
 
»t
 = 
Œue
;

55 
¡d
::
veùÜ
<
A´TıSock‘PoŞRe¥Úd”
 *>::
™”©Ü
 
™
 = 
m_vRe¥Úd”s
.
	`begš
(); iˆ!ğm_vRe¥Úd”s.
	`’d
(); it++)

57 
»t
 = (*
™
)->
	`¡¬t
() &&„et;

60  
»t
;

61 
	}
}

63 
boŞ
 
	gA´TıRe¥Úd”PoŞ
::
	$StİRe¥Ú£
()

65 
boŞ
 
»t
 = 
Œue
;

67 
¡d
::
veùÜ
<
A´TıSock‘PoŞRe¥Úd”
 *>::
™”©Ü
 
™
 = 
m_vRe¥Úd”s
.
	`begš
(); iˆ!ğm_vRe¥Úd”s.
	`’d
(); it++)

69 (*
™
)->
	`Œigg”Stİ
();

71 
¡d
::
veùÜ
<
A´TıSock‘PoŞRe¥Úd”
 *>::
™”©Ü
 
™
 = 
m_vRe¥Úd”s
.
	`begš
(); iˆ!ğm_vRe¥Úd”s.
	`’d
(); it++)

73 
»t
 = (*
™
)->
	`wa™
() &&„et;

76  
»t
;

77 
	}
}

	@../../titanutils/server/AprTcpResponderPool.h

1 #iâdeà
__APR_TCP_RESPONDER_POOL_H__


2 
	#__APR_TCP_RESPONDER_POOL_H__


	)

4 
	~<veùÜ
>

5 
	~"A´TıSock‘PoŞ.h
"

6 
	~"A´TıSock‘PoŞRe¥Úd”.h
"

7 
	~"­r/­r_th»ad_wÜk”.h
"

12 şas 
	cA´TıRe¥Úd”PoŞ


14 
	mpublic
:

19 
A´TıRe¥Úd”PoŞ
(
A´TıSock‘PoŞ
* 
pPoŞ
);

24 
	mvœtu®
 ~
A´TıRe¥Úd”PoŞ
();

32 
boŞ
 
C»©eRe¥Úd”s
(
št32_t
 
nC­ac™y
, 
A´TıRe¥Úd”G’”©Ü
 *
pG’”©Ü
);

38 
boŞ
 
De¡royRe¥Úd”s
();

44 
boŞ
 
S¹Re¥Ú£
();

50 
boŞ
 
StİRe¥Ú£
();

52 
	m´iv©e
:

53 
A´TıRe¥Úd”PoŞ
();

54 
A´TıRe¥Úd”PoŞ
(cÚ¡ A´TıRe¥Úd”PoŞ& 
rhs
);

55 
	mA´TıRe¥Úd”PoŞ
 &
	mİ”©Ü
=(cÚ¡ 
A´TıRe¥Úd”PoŞ
& 
rhs
);

57 
	m´iv©e
:

58 
št32_t
 
m_nC­ac™y
;

59 
A´TıSock‘PoŞ
 *
	mm_pPoŞ
;

60 
	m¡d
::
veùÜ
<
A´TıSock‘PoŞRe¥Úd”
 *> 
m_vRe¥Úd”s
;

	@../../titanutils/server/AprTcpServer.cpp

1 
	~"A´TıS”v”.h
"

3 
	~<as£¹.h
>

5 
	~"Sock‘HªdËr.h
"

6 
	~"­r/­r_pŞl£t.h
"

7 
	~"debugMsg/Debug.h
"

9 #ià
defšed
(
__lšux__
)

10 
	~<sys/´ùl.h
>

13 
	#SOCKET_HANDLER_MAX
 512

	)

15 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

17 
	gA´TıS”v”
::
	$A´TıS”v”
()

18 : 
	`m_sock‘
(
NULL
)

19 , 
	$m_pÜt
(0)

21 
	}
}

23 
	gA´TıS”v”
::~
	$A´TıS”v”
()

25 
	`StİS”v”
();

26 
	}
}

28 
boŞ
 
	gA´TıS”v”
::
	$S‘PÜt
(
ušt16_t
 
pÜt
)

30 
	`IF_TRUE_RETURN_VALUE
(
	`Th»adExi¡s
(), 
çl£
);

32 
m_pÜt
 = 
pÜt
;

34  
Œue
;

35 
	}
}

37 
ušt16_t
 
	gA´TıS”v”
::
	$G‘PÜt
()

39  
m_pÜt
;

40 
	}
}

42 
boŞ
 
	gA´TıS”v”
::
	$S¹S”v”
(
ušt32_t
 
ms
 , 
št32_t
 
backLog
 )

44 
	`IF_TRUE_RETURN_VALUE
(
	`Th»adExi¡s
(), 
çl£
);

46 
	`P»·»
();

48 
m_timeout
 = 
ms
;

49 
m_sock‘
 = 
Ãw
 
	`A´TıSock‘
();

50 
	`IF_NULL_RETURN_VALUE
(
m_sock‘
, 
çl£
);

52 
	`IF_FALSE_RETURN_VALUE
(
m_sock‘
->
	`bšd
(
NULL
, (
­r_pÜt_t
)
m_pÜt
), 
çl£
);

53 
	`IF_FALSE_RETURN_VALUE
(
m_sock‘
->
	`li¡’
(
backLog
), 
çl£
);

55  
	`C»©eTh»ad
();

56 
	}
}

58 
boŞ
 
	gA´TıS”v”
::
	$StİS”v”
()

60 
	`IF_TRUE_RETURN_VALUE
(!
	`Th»adExi¡s
(), 
çl£
);

62 
	`C®lWÜk”
(
eTC_STOP
);

63 
	`Clo£Th»ad
();

65 
d–‘e
 
m_sock‘
;

66 
m_sock‘
 = 
NULL
;

68 
	`CËªUp
();

70  
Œue
;

71 
	}
}

73 
boŞ
 
	gA´TıS”v”
::
	$IsRuÂšg
()

75  
	`Th»adExi¡s
();

76 
	}
}

78 
boŞ
 
	gA´TıS”v”
::
	$P»·»
()

80  
Œue
;

81 
	}
}

83 
boŞ
 
	gA´TıS”v”
::
	$CËªUp
()

85  
Œue
;

86 
	}
}

88 
	gA´TıS”v”
::
	$OnInv®idSock‘
(
A´TıSock‘
 *
sock‘
)

90 
	}
}

92 
A´TıS”v”
::
	$Th»adProc
()

94 #ià
	`defšed
(
__lšux__
)

95 
	`´ùl
(
PR_SET_NAME
, "AprTcpServer", 0, 0, 0);

97 
	`as£¹
(
m_sock‘
 !ğ
NULL
);

98 
	`IF_NULL_RETURN
(
m_sock‘
);

100 
¡d
::
veùÜ
<
Sock‘HªdËr
*> 
vSock‘HªdËr
;

102 
A´PŞlS‘
 
	`pŞl£t
(1);

103 
­r_pŞlfd_t
 
pfd
 = {
NULL
, 
APR_POLL_SOCKET
, 
APR_POLLIN
, 0, {NULL}, NULL};

104 
pfd
.
desc
.
s
 = 
m_sock‘
->
	`guts
();

105 
pŞl£t
.
	`add
(&
pfd
);

112 
ušt32_t
 
uMes§ge
 = (ušt32_t)
eTC_STOP
;

113 ià(
	`CheckReque¡
(&
uMes§ge
))

115 (
Th»adCommªd
)
uMes§ge
)

117 
eTC_STOP
:

118 
	`R•ly
(0);

121 
	`R•ly
((
ušt32_t
)-1);

129 
¡d
::
veùÜ
<
Sock‘HªdËr
*>::
™”©Ü
 
™
 = 
vSock‘HªdËr
.
	`begš
();

130 
™
 !ğ
vSock‘HªdËr
.
	`’d
(); )

132 ià((*
™
)->
	`G‘FšishStus
())

134 
	`d–‘e
(*
™
);

135 
™
 = 
vSock‘HªdËr
.
	`”a£
(it);

139 ++
™
;

143 ià(
vSock‘HªdËr
.
	`size
(è> 
SOCKET_HANDLER_MAX
)

145 
	`ASSERT2
(0, "add socket handleroo much\n");

149 
št32_t
 
num
 = 0;

150 cÚ¡ 
­r_pŞlfd_t
 *
»t_pfd
 = 
NULL
;

151 
pŞl£t
.
	`pŞl
(&
num
, &
»t_pfd
, 
m_timeout
);

153 ià(
num
 !ğ0 && 
»t_pfd
 !ğ
NULL
 && (»t_pfd[0].
¹Ãv’ts
 & 
APR_POLLIN
) != 0x0)

155 
A´TıSock‘
 *
pSock‘
 = 
m_sock‘
->
	`acû±
();

157 
Sock‘HªdËr
 *
sock‘HªdËr
 = 
Ãw
 
	`Sock‘HªdËr
(
pSock‘
, 
this
);

158 
vSock‘HªdËr
.
	`push_back
(
sock‘HªdËr
);

161 
	}
}

	@../../titanutils/server/AprTcpServer.h

1 #iâdeà
__APR_TCP_SERVER_H__


2 
	#__APR_TCP_SERVER_H__


	)

4 
	~"­r/­r_th»ad_wÜk”.h
"

5 
	~"A´IPF‹r.h
"

6 
	~"­r/­r_sock‘.h
"

11 
şass
 
	gA´TıS”v”
: 
´Ùeùed
 
SYSUTILS_SPACE
::
A´Th»adWÜk”
, 
public
 
	gA´IPF‹r


13 
	g´iv©e
:

19 
eTC_STOP
,

20 } 
	tTh»adCommªd
;

22 
	gpublic
:

26 
A´TıS”v”
();

31 
	gvœtu®
 ~
A´TıS”v”
();

38 
vœtu®
 
boŞ
 
S‘PÜt
(
ušt16_t
 
pÜt
);

44 
vœtu®
 
ušt16_t
 
G‘PÜt
();

52 
vœtu®
 
boŞ
 
S¹S”v”
(
ušt32_t
 
ms
=100, 
št32_t
 
backLog
=
SOMAXCONN
);

59 
vœtu®
 
boŞ
 
StİS”v”
();

65 
vœtu®
 
boŞ
 
IsRuÂšg
();

70 
vœtu®
 
OnInv®idSock‘
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
);

77 
vœtu®
 
boŞ
 
Acû±Sock‘
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, 
ušt32_t
& 
”rÜCode
) = 0;

79 
	g´Ùeùed
:

83 
vœtu®
 
Th»adProc
();

88 
vœtu®
 
boŞ
 
P»·»
();

93 
vœtu®
 
boŞ
 
CËªUp
();

98 
	g´iv©e
:

99 
A´TıS”v”
(cÚ¡ A´TıS”v” &
rhs
);

100 
	gA´TıS”v”
 &
	gİ”©Ü
=(cÚ¡ 
A´TıS”v”
 &
rhs
);

101 
	g´iv©e
:

102 
SYSUTILS_SPACE
::
A´TıSock‘
 *
m_sock‘
;

103 
ušt16_t
 
	gm_pÜt
;

104 
ušt32_t
 
	gm_timeout
;

	@../../titanutils/server/AprTcpSocketPool.cpp

1 
	~"A´TıSock‘PoŞ.h
"

2 
	~"commÚ/ut™y.h
"

4 
	~<as£¹.h
>

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
	gA´TıSock‘PoŞ
::
	$A´TıSock‘PoŞ
(
št32_t
 
nC­ac™y
 )

9 : 
	`m_csC­ac™y
()

10 , 
	`m_nC­ac™y
(
nC­ac™y
)

11 , 
	`m_£mSock‘s
()

12 , 
	`m_csQueue
()

13 , 
	`m_qSock‘s
()

14 , 
	`m_qBufãrs
()

15 , 
	`m_csPushSock‘
()

16 , 
	$m_bClo£d
(
çl£
)

18 
	}
}

20 
	gA´TıSock‘PoŞ
::~
	$A´TıSock‘PoŞ
()

22 
	`S‘C­ac™y
(0);

24 
	`G‘PoŞSize
() != 0)

26 
A´TıSock‘
 *
pSock‘
 = 
NULL
;

27 
¡d
::
veùÜ
<
ušt8_t
> 
bufãr
;

28 
	`PİSock‘
(&
pSock‘
, 
bufãr
);

29 
d–‘e
 
pSock‘
;

31 
	}
}

33 
	gA´TıSock‘PoŞ
::
	$S‘C­ac™y
(
št32_t
 
nC­ac™y
)

35 
Cr™iÿlSeùiÚLock
 
	`c¦_ÿ·c™y
(&
m_csC­ac™y
);

37 
m_nC­ac™y
 = 
nC­ac™y
;

38 
	}
}

40 
št32_t
 
	gA´TıSock‘PoŞ
::
	$G‘C­ac™y
()

42 
Cr™iÿlSeùiÚLock
 
	`c¦_ÿ·c™y
(&
m_csC­ac™y
);

44  
m_nC­ac™y
;

45 
	}
}

47 
št32_t
 
	gA´TıSock‘PoŞ
::
	$G‘PoŞSize
()

49 
Cr™iÿlSeùiÚLock
 
	`c¦_queue
(&
m_csQueue
);

51  (
št32_t
)
m_qSock‘s
.
	`size
();

52 
	}
}

54 
boŞ
 
	gA´TıSock‘PoŞ
::
	$IsFuÎ
()

56 
št32_t
 
ÿ·c™y
 = 
	`G‘C­ac™y
();

57 
	`IF_TRUE_RETURN_VALUE
(
ÿ·c™y
 < 0, 
çl£
);

58  
	`G‘PoŞSize
(è>ğ
ÿ·c™y
;

59 
	}
}

61 
boŞ
 
	gA´TıSock‘PoŞ
::
PushSock‘
(
A´TıSock‘
 *
pSock‘
, cÚ¡ 
¡d
::
veùÜ
<
ušt8_t
> &
bufãr
)

63 
IF_NULL_RETURN_VALUE
(
pSock‘
, 
çl£
);

66 
Cr™iÿlSeùiÚLock
 
c¦_push
(&
m_csPushSock‘
);

68 
IF_TRUE_RETURN_VALUE
(
IsFuÎ
(), 
çl£
);

71 
Cr™iÿlSeùiÚLock
 
c¦_queue
(&
m_csQueue
);

73 
	gm_qSock‘s
.
push
(
pSock‘
);

74 
	gm_qBufãrs
.
push
(
bufãr
);

76 
	gm_£mSock‘s
.
Po¡
();

78  
	gŒue
;

81 
boŞ
 
	gA´TıSock‘PoŞ
::
PİSock‘
(
A´TıSock‘
 **
µSock‘
, 
¡d
::
veùÜ
<
ušt8_t
> &
bufãr
, 
št32_t
 
ms
 )

83 
IF_NULL_RETURN_VALUE
(
µSock‘
, 
çl£
);

84 *
	gµSock‘
 = 
NULL
;

86 ià(
	gm_bClo£d
)

88  
	gçl£
;

91 ià(!
	gm_£mSock‘s
.
Wa™
(
ms
))

93  
	gçl£
;

96 ià(
	gm_bClo£d
)

98 
	gm_£mSock‘s
.
Po¡
();

99  
	gçl£
;

102 
Cr™iÿlSeùiÚLock
 
c¦_queue
(&
m_csQueue
);

104 
as£¹
(!
m_qSock‘s
.
em±y
());

105 
IF_TRUE_RETURN_VALUE
(
m_qSock‘s
.
em±y
(), 
çl£
);

107 *
	gµSock‘
 = 
m_qSock‘s
.
äÚt
();

108 
	gm_qSock‘s
.
pİ
();

110 
	gbufãr
 = 
m_qBufãrs
.
äÚt
();

111 
	gm_qBufãrs
.
pİ
();

113  
	gŒue
;

116 
boŞ
 
	gA´TıSock‘PoŞ
::
	$Clo£PoŞ
()

118 
m_bClo£d
 = 
Œue
;

120 
m_£mSock‘s
.
	`Po¡
();

122  
Œue
;

123 
	}
}

	@../../titanutils/server/AprTcpSocketPool.h

1 #iâdeà
__APR_TCP_SOCKET_POOL_H__


2 
	#__APR_TCP_SOCKET_POOL_H__


	)

4 
	~<queue
>

5 
	~<veùÜ
>

6 
	~"expÜts.h
"

7 
	~"­r/­r_sock‘.h
"

8 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

9 
	~"commÚ/£m­hÜe.h
"

15 şas 
	cA´TıSock‘PoŞ


17 
	mpublic
:

24 
A´TıSock‘PoŞ
(
št32_t
 
nC­ac™y
=-1);

29 
	mvœtu®
 ~
A´TıSock‘PoŞ
();

37 
S‘C­ac™y
(
št32_t
 
nC­ac™y
);

43 
št32_t
 
G‘C­ac™y
();

49 
št32_t
 
G‘PoŞSize
();

55 
boŞ
 
IsFuÎ
();

63 
boŞ
 
PushSock‘
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, cÚ¡ 
¡d
::
veùÜ
<
ušt8_t
> &
bufãr
);

76 
boŞ
 
PİSock‘
(
SYSUTILS_SPACE
::
A´TıSock‘
 **
µSock‘
, 
¡d
::
veùÜ
<
ušt8_t
> &
bufãr
, 
št32_t
 
ms
=-1);

81 
boŞ
 
Clo£PoŞ
();

83 
	m´iv©e
:

84 
A´TıSock‘PoŞ
(cÚ¡ A´TıSock‘PoŞ &
rhs
);

85 
	mA´TıSock‘PoŞ
 &
	mİ”©Ü
=(cÚ¡ 
A´TıSock‘PoŞ
 &
rhs
);

87 
	m´iv©e
:

88 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_csC­ac™y
;

89 
št32_t
 
	mm_nC­ac™y
;

90 
	mSYSUTILS_SPACE
::
Sem­hÜe
 
m_£mSock‘s
;

91 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_csQueue
;

92 
	m¡d
::
queue
< 
SYSUTILS_SPACE
::
A´TıSock‘
 * > 
m_qSock‘s
;

93 
	m¡d
::
queue
< 
¡d
::
veùÜ
< 
ušt8_t
 > > 
m_qBufãrs
;

94 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_csPushSock‘
;

95 
boŞ
 
	mm_bClo£d
;

	@../../titanutils/server/AprTcpSocketPoolResponder.cpp

1 
	~"A´TıSock‘PoŞRe¥Úd”.h
"

3 
	~"commÚ/ut™y.h
"

5 
	~<as£¹.h
>

7 
	~<veùÜ
>

9 #ià
defšed
(
__lšux__
)

10 
	~<sys/´ùl.h
>

13 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

18 
	gA´TıRe¥Úd”G’”©Ü
::
	$A´TıRe¥Úd”G’”©Ü
()

20 
	}
}

22 
A´TıRe¥Úd”G’”©Ü
::~
	$A´TıRe¥Úd”G’”©Ü
()

24 
	}
}

29 
A´TıSock‘PoŞRe¥Úd”
::
	$A´TıSock‘PoŞRe¥Úd”
(
A´TıSock‘PoŞ
 *
pPoŞ
, 
št32_t
 
ms
 )

30 : 
	`m_pPoŞ
(
pPoŞ
)

31 , 
	`m_nTimeOut
(
ms
)

32 , 
	`m_cdT”mš©e
(
Œue
)

33 , 
	$m_Th»adName
(
NULL
)

35 
	}
}

37 
	gA´TıSock‘PoŞRe¥Úd”
::~
	$A´TıSock‘PoŞRe¥Úd”
()

39 ià(
NULL
 !ğ
m_Th»adName
)

41 
d–‘e
[] 
m_Th»adName
;

42 
m_Th»adName
 = 
NULL
;

44 
	}
}

46 
	gA´TıSock‘PoŞRe¥Úd”
::
	$Œigg”Stİ
()

48 
m_cdT”mš©e
.
	`£t
();

49 
	}
}

51 
	gA´TıSock‘PoŞRe¥Úd”
::
	$run
()

53 
	`IF_NULL_RETURN
(
m_pPoŞ
);

54 #ià
	`defšed
(
__lšux__
)

55 
	`´ùl
(
PR_SET_NAME
, 
NULL
 =ğ
m_Th»adName
 ? "AprTcpSocketPoolResponder" : m_ThreadName, 0, 0, 0);

58 !
m_cdT”mš©e
.
	`timedwa™
(0))

63 
A´TıSock‘
 *
pSock‘
 = 
NULL
;

64 
¡d
::
veùÜ
<
ušt8_t
> 
bufãr
;

65 ià(
m_pPoŞ
->
	`PİSock‘
(&
pSock‘
, 
bufãr
, 
m_nTimeOut
))

67 
	`as£¹
(
pSock‘
);

69 ià(
	`HªdËReque¡
(
pSock‘
, 
bufãr
))

71 
d–‘e
 
pSock‘
;

75 
	}
}

77 
	gA´TıSock‘PoŞRe¥Úd”
::
	$S‘Th»adName
(cÚ¡ *
Çme
, cÚ¡ 
size_t
 
size
)

79 ià(
NULL
 !ğ
Çme
 && 
size
 > 0 && size < 128)

81 ià(
NULL
 =ğ
m_Th»adName
)

83 
m_Th»adName
 = 
Ãw
 [
size
+1];

85 ià(
size
 > 
	`¡¾’
(
m_Th»adName
))

87 
d–‘e
[] 
m_Th»adName
;

88 
m_Th»adName
 = 
Ãw
 [
size
+1];

91 ià(
NULL
 !ğ
m_Th»adName
)

93 
	`¡ºıy
(
m_Th»adName
, 
Çme
, 
size
);

94 
m_Th»adName
[
size
] = '\0';

97 
	}
}

	@../../titanutils/server/AprTcpSocketPoolResponder.h

1 #iâdeà
__APR_TCP_SOCKET_POOL_RESPONDER_H__


2 
	#__APR_TCP_SOCKET_POOL_RESPONDER_H__


	)

4 
	~"expÜts.h
"

5 
	~"A´TıSock‘PoŞ.h
"

6 
	~"­r/­r_th»ad.h
"

7 
	~"­r/­r_cÚd.h
"

12 şas 
	cA´TıSock‘PoŞRe¥Úd”
: 
public
 
SYSUTILS_SPACE
::
A´Th»ad


14 
public
:

20 
A´TıSock‘PoŞRe¥Úd”
(
A´TıSock‘PoŞ
 *
pPoŞ
, 
št32_t
 
ms
=-1);

25 
	mvœtu®
 ~
A´TıSock‘PoŞRe¥Úd”
();

30 
Œigg”Stİ
();

32 
	m´Ùeùed
:

36 
vœtu®
 
run
();

45 
vœtu®
 
boŞ
 
HªdËReque¡
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, cÚ¡ 
¡d
::
veùÜ
<
ušt8_t
> &
bufãr
) = 0;

50 
S‘Th»adName
(cÚ¡ *
Çme
, cÚ¡ 
size_t
 
size
);

52 
	m´iv©e
:

53 
A´TıSock‘PoŞRe¥Úd”
();

54 
A´TıSock‘PoŞRe¥Úd”
(A´TıSock‘PoŞRe¥Úd” &
rhs
);

55 
	mA´TıSock‘PoŞRe¥Úd”
 &
	mİ”©Ü
=(
A´TıSock‘PoŞRe¥Úd”
 &
rhs
);

57 
	m´iv©e
:

58 
A´TıSock‘PoŞ
 *
m_pPoŞ
;

59 
št32_t
 
	mm_nTimeOut
;

60 
	mSYSUTILS_SPACE
::
A´CÚd
 
m_cdT”mš©e
;

61 *
	mm_Th»adName
;

67 şas 
	cA´TıRe¥Úd”G’”©Ü


69 
	mpublic
:

73 
A´TıRe¥Úd”G’”©Ü
();

78 
	mvœtu®
 ~
A´TıRe¥Úd”G’”©Ü
() = 0;

85 
vœtu®
 
A´TıSock‘PoŞRe¥Úd”
 *
C»©eRe¥Úd”
(
A´TıSock‘PoŞ
 *
pPoŞ
) = 0;

87 
	m´iv©e
:

88 
A´TıRe¥Úd”G’”©Ü
(cÚ¡ A´TıRe¥Úd”G’”©Ü &
rhs
);

89 
	mA´TıRe¥Úd”G’”©Ü
 &
	mİ”©Ü
=(cÚ¡ 
A´TıRe¥Úd”G’”©Ü
 &
rhs
);

	@../../titanutils/server/SessionHandler.cpp

1 
	~"commÚ/ut™y.h
"

3 
	~"SessiÚMªag”.h
"

5 
	~<”ºo.h
>

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 #ià
defšed
 (
_WIN32
)

10 #´agm¨
w¬nšg
(
di§bË
:4355)

16 
	gSessiÚHªdËrG’”©Ü
::
	$SessiÚHªdËrG’”©Ü
()

18 
	}
}

20 
SessiÚHªdËrG’”©Ü
::~
	$SessiÚHªdËrG’”©Ü
()

22 
	}
}

27 
SessiÚHªdËr
::
	$SessiÚHªdËr
(
SessiÚMªag”
 *
mªag”
, 
A´TıSock‘
 *
sock‘
, 
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚ_id
)

28 : 
	`m_mªag”
(
mªag”
)

29 , 
	`m_£ssiÚId
(
£ssiÚ_id
)

30 , 
	`m_ş›Á_£ssiÚId
(0)

31 , 
	`m_ev’t_»ad
(
mªag”
->
	`G‘Ev’tBa£
(), 
sock‘
, 
EV_READ
 | 
EV_PERSIST
, 
SessiÚHªdËr
::
s_R—dC®lback
, 
this
, 
NULL
)

32 , 
	`m_ev’t_wr™e
(
mªag”
->
	`G‘Ev’tBa£
(), 
sock‘
, 
EV_WRITE
, 
SessiÚHªdËr
::
s_Wr™eC®lback
, 
this
, 
NULL
)

33 , 
	`m_ev’t_tim”
(
mªag”
->
	`G‘Ev’tBa£
(), 
Œue
, 
SessiÚHªdËr
::
s_Tim”C®lback
, 
this
, 
NULL
)

34 , 
	`m_»ad_bufãr
()

35 , 
	`m_wr™e_bufãr
()

36 , 
	$m_sock‘
(
sock‘
)

38 
Ev’tBufãr
::
	`MoveBufãr
(&
bufãr
, &
m_»ad_bufãr
);

39 ià(
m_sock‘
.
	`g‘
(è!ğ
NULL
)

41 
m_sock‘
.
	`g‘
()->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 1);

42 
m_sock‘
.
	`g‘
()->
	`£tTimeOut
(0);

44 
	}
}

46 
	gSessiÚHªdËr
::~
	$SessiÚHªdËr
()

48 
	`Clo£
();

49 
m_sock‘
.
	`»£t
(
NULL
);

50 
	}
}

52 
SessiÚMªag”
 *
	gSessiÚHªdËr
::
	$G‘SessiÚMªag”
()

54  
m_mªag”
;

55 
	}
}

57 
boŞ
 
	gSessiÚHªdËr
::
	$P»·»
()

59 
	`OnP»·»
();

61 
	`OnSessiÚS¹
();

62 
	`OnR—dC®lback
();

64 
m_ev’t_»ad
.
	`Add
();

66 
m_ev’t_tim”
.
	`Add
(
	`G‘Tim”IÁ”v®
());

68  
Œue
;

69 
	}
}

71 
boŞ
 
	gSessiÚHªdËr
::
	$CËªUp
()

73 
m_ev’t_»ad
.
	`D–
();

74 
m_ev’t_wr™e
.
	`D–
();

75 
m_ev’t_tim”
.
	`D–
();

77 
	`OnCËªUp
();

79  
Œue
;

80 
	}
}

82 
boŞ
 
	gSessiÚHªdËr
::
	$Clo£
()

84 
	`CËªUp
();

86  
Œue
;

87 
	}
}

89 
boŞ
 
	gSessiÚHªdËr
::
	$S’dD©a
(cÚ¡ 
¡d
::
¡ršg
 &
d©a
)

91  
	`OuutWr™eBufãr
(
d©a
);

92 
	}
}

94 
A´TıSock‘
 *
	gSessiÚHªdËr
::
	$G‘Sock‘
()

96  
m_sock‘
.
	`g‘
();

97 
	}
}

99 
ušt32_t
 
	gSessiÚHªdËr
::
	$G‘SessiÚID
()

101  
m_£ssiÚId
;

102 
	}
}

104 
A´Ev’t
 *
	gSessiÚHªdËr
::
	$G‘R—dEv’t
()

106  &
m_ev’t_»ad
;

107 
	}
}

109 
A´Ev’t
 *
	gSessiÚHªdËr
::
	$G‘Wr™eEv’t
()

111  &
m_ev’t_wr™e
;

112 
	}
}

114 
Ev’tTim”
 *
	gSessiÚHªdËr
::
	$G‘Tim”Ev’t
()

116  &
m_ev’t_tim”
;

117 
	}
}

119 
Ev’tBufãr
 *
	gSessiÚHªdËr
::
	$G‘R—dBufãr
()

121  &
m_»ad_bufãr
;

122 
	}
}

124 
Ev’tBufãr
 *
	gSessiÚHªdËr
::
	$G‘Wr™eBufãr
()

126  &
m_wr™e_bufãr
;

127 
	}
}

129 
boŞ
 
	gSessiÚHªdËr
::
	$OuutWr™eBufãr
(cÚ¡ 
¡d
::
¡ršg
 &
d©a
)

131 
m_wr™e_bufãr
.
	`Aµ’d
(
d©a
.
	`c_¡r
(), d©a.
	`Ëngth
());

132  
m_ev’t_wr™e
.
	`Add
();

133 
	}
}

135 
	gSessiÚHªdËr
::
	$OnP»·»
()

137 
	}
}

139 
SessiÚHªdËr
::
	$OnCËªUp
()

141 
	}
}

143 
boŞ
 
SessiÚHªdËr
::
	$CªR—dMÜeD©a
()

145  
Œue
;

146 
	}
}

148 
boŞ
 
	gSessiÚHªdËr
::
	$CªWr™eMÜeD©a
()

150  
m_wr™e_bufãr
.
	`G‘L’gth
() != 0;

151 
	}
}

153 
	gSessiÚHªdËr
::
	$R—dSock‘D©a
()

155  
m_»ad_bufãr
.
	`R—dSock‘
(
m_sock‘
.
	`g‘
());

156 
	}
}

158 
	gSessiÚHªdËr
::
	$Wr™eSock‘D©a
()

160  
m_wr™e_bufãr
.
	`Wr™eSock‘
(
m_sock‘
.
	`g‘
());

161 
	}
}

163 
	gSessiÚHªdËr
::
	$s_R—dC®lback
(
A´Ev’t
 *
e
, 
A´Sock‘
 *
sock‘
, 
wh©
, *
¬g1
, *
¬g2
)

165 
SessiÚHªdËr
 *
p
 = (SessiÚHªdË¸*)
¬g1
;

166 
	`IF_NULL_RETURN
(
e
);

167 
	`IF_NULL_RETURN
(
sock‘
);

168 
	`IF_NULL_RETURN
(
p
);

169 
	`IF_EQUAL_RETURN
(
wh©
 & 
EV_READ
, 0);

171 
p
->
	`m_R—dC®lback
(
e
, 
sock‘
);

172 
	}
}

174 
	gSessiÚHªdËr
::
	$s_Wr™eC®lback
(
A´Ev’t
 *
e
, 
A´Sock‘
 *
sock‘
, 
wh©
, *
¬g1
, *
¬g2
)

176 
SessiÚHªdËr
 *
p
 = (SessiÚHªdË¸*)
¬g1
;

177 
	`IF_NULL_RETURN
(
e
);

178 
	`IF_NULL_RETURN
(
sock‘
);

179 
	`IF_NULL_RETURN
(
p
);

180 
	`IF_EQUAL_RETURN
(
wh©
 & 
EV_WRITE
, 0);

182 
p
->
	`m_Wr™eC®lback
(
e
, 
sock‘
);

183 
	}
}

185 
	gSessiÚHªdËr
::
	$s_Tim”C®lback
(
Ev’tTim”
 *
e
, *
¬g1
, *
¬g2
)

187 
SessiÚHªdËr
 *
p
 = (SessiÚHªdË¸*)
¬g1
;

188 
	`IF_NULL_RETURN
(
e
);

189 
	`IF_NULL_RETURN
(
p
);

191 
p
->
	`m_Tim”C®lback
(
e
);

192 
	}
}

194 
	gSessiÚHªdËr
::
	$m_R—dC®lback
(
SYSUTILS_SPACE
::
A´Ev’t
 *
e
, SYSUTILS_SPACE::
A´Sock‘
 *
sock‘
)

196 
	`IF_NULL_RETURN
(
e
);

197 
	`IF_NULL_RETURN
(
m_sock‘
.
	`g‘
());

199 ià(!
	`CªR—dMÜeD©a
())

205 
Ën
 = 
	`R—dSock‘D©a
();

207 ià(
Ën
 > 0)

210 
	`OnR—dC®lback
();

212 #ifdeà
_WIN32


213 ià(
Ën
 =ğ-1 && 
	`WSAG‘La¡E¼Ü
(è=ğ
WSAEWOULDBLOCK
)

215 ià(
Ën
 =ğ-1 && (
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EWOULDBLOCK
))

223 
	`OnSessiÚLo¡
();

225 
	`IF_NULL_RETURN
(
m_mªag”
);

226 
m_mªag”
->
	`RemoveHªdËr
(
m_£ssiÚId
);

228 
	}
}

230 
	gSessiÚHªdËr
::
	$m_Wr™eC®lback
(
SYSUTILS_SPACE
::
A´Ev’t
 *
e
, SYSUTILS_SPACE::
A´Sock‘
 *
sock‘
)

232 
	`IF_NULL_RETURN
(
e
);

233 
	`IF_NULL_RETURN
(
m_sock‘
.
	`g‘
());

235 ià(!
	`CªWr™eMÜeD©a
())

241 
Ën
 = 
	`Wr™eSock‘D©a
();

243 ià(
Ën
 > 0)

246 
	`OnWr™eC®lback
();

248 #ifdeà
_WIN32


249 ià(
Ën
 =ğ-1 && 
	`WSAG‘La¡E¼Ü
(è=ğ
WSAEWOULDBLOCK
)

251 ià(
Ën
 =ğ-1 && (
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EWOULDBLOCK
))

263 ià(
	`CªWr™eMÜeD©a
())

265 
e
->
	`Add
();

267 
	}
}

269 
	gSessiÚHªdËr
::
	$m_Tim”C®lback
(
SYSUTILS_SPACE
::
Ev’tTim”
 *
e
)

271 
	`OnTim”C®lback
();

272 
	}
}

274 
ušt32_t
 
	gSessiÚHªdËr
::
	$G‘Cl›ÁSessiÚID
()

276  
m_ş›Á_£ssiÚId
;

277 
	}
}

279 
boŞ
 
	gSessiÚHªdËr
::
	$S‘Cl›ÁSessiÚID
(
ušt32_t
 
ş›Á_£ssiÚ_id
)

281 
m_ş›Á_£ssiÚId
 = 
ş›Á_£ssiÚ_id
;

283  
Œue
;

284 
	}
}

	@../../titanutils/server/SessionHandler.h

1 #iâdeà
__SESSION_HANDLER_H__


2 
	#__SESSION_HANDLER_H__


	)

4 
	~<memÜy
>

5 
	~<¡ršg
>

7 
	~"­r/­r_sock‘.h
"

8 
	~"libev’t/­r_ev’t.h
"

9 
	~"libev’t/ev’t_tim”.h
"

10 
	~"libev’t/ev’t_bufãr.h
"

12 
şass
 
	gSessiÚMªag”
;

14 şas 
	cSessiÚHªdËr


16 
	mpublic
:

17 
SessiÚHªdËr
(
SessiÚMªag”
 *
mªag”
, 
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, SYSUTILS_SPACE::
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚ_id
);

18 
	mvœtu®
 ~
SessiÚHªdËr
();

19 
vœtu®
 
boŞ
 
P»·»
();

20 
vœtu®
 
boŞ
 
CËªUp
();

21 
vœtu®
 
boŞ
 
Clo£
();

22 
vœtu®
 
boŞ
 
S’dD©a
(cÚ¡ 
¡d
::
¡ršg
 &
d©a
);

24 
ušt32_t
 
G‘Cl›ÁSessiÚID
();

25 
boŞ
 
S‘Cl›ÁSessiÚID
(
ušt32_t
 
ş›Á_£ssiÚ_id
);

27 
	mSYSUTILS_SPACE
::
A´TıSock‘
 *
G‘Sock‘
();

29 
	m´Ùeùed
:

30 
SessiÚMªag”
 *
G‘SessiÚMªag”
();

31 
ušt32_t
 
G‘SessiÚID
();

32 
	mSYSUTILS_SPACE
::
A´Ev’t
 *
G‘R—dEv’t
();

33 
	mSYSUTILS_SPACE
::
A´Ev’t
 *
G‘Wr™eEv’t
();

34 
	mSYSUTILS_SPACE
::
Ev’tTim”
 *
G‘Tim”Ev’t
();

35 
	mSYSUTILS_SPACE
::
Ev’tBufãr
 *
G‘R—dBufãr
();

36 
	mSYSUTILS_SPACE
::
Ev’tBufãr
 *
G‘Wr™eBufãr
();

38 
boŞ
 
OuutWr™eBufãr
(cÚ¡ 
¡d
::
¡ršg
 &
d©a
);

40 
vœtu®
 
OnP»·»
();

41 
vœtu®
 
OnCËªUp
();

43 
vœtu®
 
boŞ
 
CªR—dMÜeD©a
();

44 
vœtu®
 
boŞ
 
CªWr™eMÜeD©a
();

45 
vœtu®
 
R—dSock‘D©a
();

46 
vœtu®
 
Wr™eSock‘D©a
();

48 
vœtu®
 
G‘Tim”IÁ”v®
() = 0;

49 
vœtu®
 
OnR—dC®lback
() = 0;

50 
vœtu®
 
OnWr™eC®lback
() = 0;

51 
vœtu®
 
OnTim”C®lback
() = 0;

52 
vœtu®
 
OnSessiÚS¹
() = 0;

53 
vœtu®
 
OnSessiÚLo¡
() = 0;

55 
	m´iv©e
:

56 
SessiÚHªdËr
();

57 
SessiÚHªdËr
(cÚ¡ SessiÚHªdË¸&
rhs
);

58 
	mSessiÚHªdËr
 &
	mİ”©Ü
=(cÚ¡ 
SessiÚHªdËr
 &
rhs
);

60 
s_R—dC®lback
(
SYSUTILS_SPACE
::
A´Ev’t
 *
e
, SYSUTILS_SPACE::
A´Sock‘
 *
sock‘
, 
wh©
, *
¬g1
, *
¬g2
);

61 
s_Wr™eC®lback
(
SYSUTILS_SPACE
::
A´Ev’t
 *
e
, SYSUTILS_SPACE::
A´Sock‘
 *
sock‘
, 
wh©
, *
¬g1
, *
¬g2
);

62 
s_Tim”C®lback
(
SYSUTILS_SPACE
::
Ev’tTim”
 *
e
, *
¬g1
, *
¬g2
);

64 
m_R—dC®lback
(
SYSUTILS_SPACE
::
A´Ev’t
 *
e
, SYSUTILS_SPACE::
A´Sock‘
 *
sock‘
);

65 
m_Wr™eC®lback
(
SYSUTILS_SPACE
::
A´Ev’t
 *
e
, SYSUTILS_SPACE::
A´Sock‘
 *
sock‘
);

66 
m_Tim”C®lback
(
SYSUTILS_SPACE
::
Ev’tTim”
 *
e
);

68 
	m´iv©e
:

69 
SessiÚMªag”
 *
m_mªag”
;

70 
ušt32_t
 
	mm_£ssiÚId
;

71 
ušt32_t
 
	mm_ş›Á_£ssiÚId
;

72 
	mSYSUTILS_SPACE
::
A´Ev’t
 
m_ev’t_»ad
;

73 
	mSYSUTILS_SPACE
::
A´Ev’t
 
m_ev’t_wr™e
;

74 
	mSYSUTILS_SPACE
::
Ev’tTim”
 
m_ev’t_tim”
;

75 
	mSYSUTILS_SPACE
::
Ev’tBufãr
 
m_»ad_bufãr
;

76 
	mSYSUTILS_SPACE
::
Ev’tBufãr
 
m_wr™e_bufãr
;

77 
	m¡d
::
auto_±r
<
SYSUTILS_SPACE
::
A´TıSock‘
> 
m_sock‘
;

80 şas 
	cSessiÚHªdËrG’”©Ü


82 
	mpublic
:

83 
SessiÚHªdËrG’”©Ü
();

84 
	mvœtu®
 ~
SessiÚHªdËrG’”©Ü
();

85 
vœtu®
 
SessiÚHªdËr
 *
C»©eSessiÚHªdËr
(
SessiÚMªag”
 *
mªag”
, 
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, SYSUTILS_SPACE::
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚ_id
) = 0;

86 
	m´iv©e
:

87 
SessiÚHªdËrG’”©Ü
(cÚ¡ SessiÚHªdËrG’”©Ü &
rhs
);

88 
	mSessiÚHªdËrG’”©Ü
 &
	mİ”©Ü
=(cÚ¡ 
SessiÚHªdËrG’”©Ü
 &
rhs
);

	@../../titanutils/server/SessionManager.cpp

1 
	~"SessiÚMªag”.h
"

3 
	~"commÚ/ut™y.h
"

4 
	~"commÚ/sy¡em.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 #ià
defšed
 (
_WIN32
)

9 #´agm¨
w¬nšg
(
di§bË
:4355)

12 
	gSessiÚMªag”
::
	$SessiÚMªag”
()

13 : 
	`m_cs_hªdËrs
()

14 , 
	`m_hªdËrs
()

15 , 
	`m_ev’t_loİ
(1000)

16 , 
	`m_ev’t_tim”
(
m_ev’t_loİ
.
	`ba£
(), 
Œue
, 
SessiÚMªag”
::
s_Tim”C®lback
, 
this
, 
NULL
)

17 , 
	`m_cs_zomb›s
()

18 , 
	$m_zomb›s
()

20 
	}
}

22 
	gSessiÚMªag”
::~
	$SessiÚMªag”
()

24 
	`StİSessiÚs
();

25 
	`CË¬HªdËrs
();

26 
	}
}

28 
Ev’tBa£
 *
	gSessiÚMªag”
::
	$G‘Ev’tBa£
()

30  
m_ev’t_loİ
.
	`ba£
();

31 
	}
}

33 
boŞ
 
	gSessiÚMªag”
::
	$S¹SessiÚs
(
ms
)

35 
boŞ
 
»t
 = 
Œue
;

37 
m_ev’t_tim”
.
	`Add
(
ms
);

39 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_hªdËrs
);

40 
¡d
::
m­
<
ušt32_t
, 
SessiÚHªdËr
 *>::
™”©Ü
 
™
 = 
m_hªdËrs
.
	`begš
(); iˆ!ğm_hªdËrs.
	`’d
(); it++)

42 
SessiÚHªdËr
 *
hªdËr
 = (*
™
).
£cÚd
;

43 ià(
hªdËr
 !ğ
NULL
)

45 
»t
 = 
hªdËr
->
	`P»·»
() &&„et;

49 
»t
 = 
m_ev’t_loİ
.
	`S¹Loİ
() &&„et;

51  
»t
;

52 
	}
}

54 
boŞ
 
	gSessiÚMªag”
::
	$StİSessiÚs
()

56 
boŞ
 
»t
 = 
Œue
;

58 
m_ev’t_tim”
.
	`D–
();

60 
»t
 = 
m_ev’t_loİ
.
	`StİLoİ
() &&„et;

62 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_hªdËrs
);

63 
¡d
::
m­
<
ušt32_t
, 
SessiÚHªdËr
 *>::
™”©Ü
 
™
 = 
m_hªdËrs
.
	`begš
(); iˆ!ğm_hªdËrs.
	`’d
(); it++)

65 
SessiÚHªdËr
 *
hªdËr
 = (*
™
).
£cÚd
;

66 ià(
hªdËr
 !ğ
NULL
)

68 
»t
 = 
hªdËr
->
	`CËªUp
() &&„et;

72  
»t
;

73 
	}
}

75 
boŞ
 
	gSessiÚMªag”
::
	$CË¬HªdËrs
()

78 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_hªdËrs
);

80 
¡d
::
m­
<
ušt32_t
, 
SessiÚHªdËr
 *>::
™”©Ü
 
™
 = 
m_hªdËrs
.
	`begš
(); iˆ!ğm_hªdËrs.
	`’d
(); it++)

82 
SessiÚHªdËr
 *
hªdËr
 = (*
™
).
£cÚd
;

83 ià(
hªdËr
 !ğ
NULL
)

85 
hªdËr
->
	`Clo£
();

86 
d–‘e
 
hªdËr
;

89 
m_hªdËrs
.
	`ş—r
();

93 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_zomb›s
);

94 !
m_zomb›s
.
	`em±y
())

96 
SessiÚHªdËr
 *
hªdËr
 = 
m_zomb›s
.
	`äÚt
();

97 
d–‘e
 
hªdËr
;

98 
m_zomb›s
.
	`pİ
();

102  
Œue
;

103 
	}
}

105 
boŞ
 
	gSessiÚMªag”
::
	$C»©eHªdËr
(
SessiÚHªdËrG’”©Ü
 *
g’”©Ü
, 
A´TıSock‘
 *
sock‘
, 
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚ_id
)

107 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_hªdËrs
);

109 ià(
m_hªdËrs
.
	`fšd
(
£ssiÚ_id
è!ğm_hªdËrs.
	`’d
())

111  
çl£
;

114 ià(
g’”©Ü
 =ğ
NULL
)

116  
çl£
;

119 ià(
sock‘
 =ğ
NULL
)

121  
çl£
;

124 
SessiÚHªdËr
 *
hªdËr
 = 
g’”©Ü
->
	`C»©eSessiÚHªdËr
(
this
, 
sock‘
, 
bufãr
, 
£ssiÚ_id
);

125 
	`IF_NULL_RETURN_VALUE
(
hªdËr
, 
çl£
);

126 
m_hªdËrs
[
£ssiÚ_id
] = 
hªdËr
;

128 
hªdËr
->
	`S‘Cl›ÁSessiÚID
(
£ssiÚ_id
);

130 
hªdËr
->
	`P»·»
();

132  
Œue
;

133 
	}
}

135 
boŞ
 
	gSessiÚMªag”
::
	$C»©eHªdËr
(
SessiÚHªdËrG’”©Ü
 *
g’”©Ü
, 
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
,

136 
SYSUTILS_SPACE
::
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚ_id
, ušt32_ˆ
ş›Á_£ssiÚ_id
)

138 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_hªdËrs
);

140 ià(
m_hªdËrs
.
	`fšd
(
£ssiÚ_id
è!ğm_hªdËrs.
	`’d
())

142  
çl£
;

145 ià(
g’”©Ü
 =ğ
NULL
)

147  
çl£
;

150 ià(
sock‘
 =ğ
NULL
)

152  
çl£
;

155 
SessiÚHªdËr
* 
hªdËr
 = 
g’”©Ü
->
	`C»©eSessiÚHªdËr
(
this
, 
sock‘
, 
bufãr
, 
£ssiÚ_id
);

156 
	`IF_NULL_RETURN_VALUE
(
hªdËr
, 
çl£
);

157 
m_hªdËrs
[
£ssiÚ_id
] = 
hªdËr
;

159 
hªdËr
->
	`S‘Cl›ÁSessiÚID
(
ş›Á_£ssiÚ_id
);

161 
hªdËr
->
	`P»·»
();

163  
Œue
;

164 
	}
}

166 
boŞ
 
	gSessiÚMªag”
::
	$RemoveHªdËr
(
ušt32_t
 
£ssiÚ_id
)

168 
SessiÚHªdËr
 *
hªdËr
 = 
NULL
;

171 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_hªdËrs
);

172 ià(
m_hªdËrs
.
	`fšd
(
£ssiÚ_id
è=ğm_hªdËrs.
	`’d
())

174  
çl£
;

177 
hªdËr
 = 
m_hªdËrs
[
£ssiÚ_id
];

178 
m_hªdËrs
.
	`”a£
(
£ssiÚ_id
);

181 
	`IF_NULL_RETURN_VALUE
(
hªdËr
, 
çl£
);

182 
hªdËr
->
	`Clo£
();

185 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_zomb›s
);

186 
m_zomb›s
.
	`push
(
hªdËr
);

189  
Œue
;

190 
	}
}

192 
boŞ
 
	gSessiÚMªag”
::
	$HasHªdËr
(
ušt32_t
 
£ssiÚ_id
)

194 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_hªdËrs
);

195  
m_hªdËrs
.
	`fšd
(
£ssiÚ_id
è!ğm_hªdËrs.
	`’d
();

196 
	}
}

198 
boŞ
 
	gSessiÚMªag”
::
	$S’dD©a
(
ušt32_t
 
£ssiÚ_id
, cÚ¡ 
¡d
::
¡ršg
 &
d©a
)

200 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_hªdËrs
);

201 
¡d
::
m­
<
ušt32_t
, 
SessiÚHªdËr
 *>::
™”©Ü
 
™
 = 
m_hªdËrs
.
	`fšd
(
£ssiÚ_id
);

202 ià(
™
 =ğ
m_hªdËrs
.
	`’d
(è|| it->
£cÚd
 =ğ
NULL
)

204  
çl£
;

207  
™
->
£cÚd
->
	`S’dD©a
(
d©a
);

208 
	}
}

210 
	gSessiÚMªag”
::
	$m_Tim”C®lback
(
Ev’tTim”
 *
e
)

213 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_cs_zomb›s
);

214 !
m_zomb›s
.
	`em±y
())

216 
SessiÚHªdËr
 *
hªdËr
 = 
m_zomb›s
.
	`äÚt
();

217 
d–‘e
 
hªdËr
;

218 
m_zomb›s
.
	`pİ
();

222 
	`OnTim”C®lback
();

223 
	}
}

225 
	gSessiÚMªag”
::
	$s_Tim”C®lback
(
Ev’tTim”
 *
e
, *
¬g1
, *
¬g2
)

227 
SessiÚMªag”
 *
p
 = (SessiÚMªag” *)
¬g1
;

228 
	`IF_NULL_RETURN
(
e
);

229 
	`IF_NULL_RETURN
(
p
);

231 
p
->
	`m_Tim”C®lback
(
e
);

232 
	}
}

	@../../titanutils/server/SessionManager.h

1 #iâdeà
__SESSION_MANAGER_H__


2 
	#__SESSION_MANAGER_H__


	)

4 
	~<¡ršg
>

5 
	~<m­
>

6 
	~<queue
>

8 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

9 
	~"­r/­r_sock‘.h
"

10 
	~"libev’t/ev’t_ba£.h
"

11 
	~"libev’t/ev’t_loİ.h
"

12 
	~"libev’t/ev’t_tim”.h
"

13 
	~"libev’t/ev’t_bufãr.h
"

15 
	~"SessiÚHªdËr.h
"

20 şas 
	cSessiÚMªag”


22 
	mpublic
:

26 
SessiÚMªag”
();

31 
	mvœtu®
 ~
SessiÚMªag”
();

37 
vœtu®
 
	mSYSUTILS_SPACE
::
Ev’tBa£
 *
G‘Ev’tBa£
();

44 
vœtu®
 
boŞ
 
S¹SessiÚs
(
ms
);

50 
vœtu®
 
boŞ
 
StİSessiÚs
();

56 
vœtu®
 
boŞ
 
CË¬HªdËrs
();

65 
vœtu®
 
boŞ
 
C»©eHªdËr
(
SessiÚHªdËrG’”©Ü
 *
g’”©Ü
, 
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, SYSUTILS_SPACE::
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚ_id
);

75 
vœtu®
 
boŞ
 
C»©eHªdËr
(
SessiÚHªdËrG’”©Ü
 *
g’”©Ü
, 
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
,

76 
SYSUTILS_SPACE
::
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚ_id
, ušt32_ˆ
ş›Á_£ssiÚ_id
);

83 
vœtu®
 
boŞ
 
RemoveHªdËr
(
ušt32_t
 
£ssiÚ_id
);

90 
vœtu®
 
boŞ
 
HasHªdËr
(
ušt32_t
 
£ssiÚ_id
);

98 
vœtu®
 
boŞ
 
S’dD©a
(
ušt32_t
 
£ssiÚ_id
, cÚ¡ 
¡d
::
¡ršg
 &
d©a
);

100 
	m´Ùeùed
:

101 
vœtu®
 
OnTim”C®lback
() = 0;

103 
	m´iv©e
:

104 
SessiÚMªag”
(cÚ¡ SessiÚMªag” &
rhs
);

105 
	mSessiÚMªag”
 &
	mİ”©Ü
=(cÚ¡ 
SessiÚMªag”
 &
rhs
);

106 
s_Tim”C®lback
(
SYSUTILS_SPACE
::
Ev’tTim”
 *
e
, *
¬g1
, *
¬g2
);

107 
m_Tim”C®lback
(
SYSUTILS_SPACE
::
Ev’tTim”
 *
e
);

109 
	m´Ùeùed
:

110 
SYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs_hªdËrs
;

111 
	m¡d
::
m­
<
ušt32_t
, 
	mSessiÚHªdËr
 *> 
	mm_hªdËrs
;

113 
	m´iv©e
:

114 
SYSUTILS_SPACE
::
Ev’tLoİ
 
m_ev’t_loİ
;

115 
	mSYSUTILS_SPACE
::
Ev’tTim”
 
m_ev’t_tim”
;

116 
	mSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs_zomb›s
;

117 
	m¡d
::
queue
<
SessiÚHªdËr
 *> 
m_zomb›s
;

	@../../titanutils/server/SocketHandler.cpp

1 
	~"Sock‘HªdËr.h
"

3 
	~"A´IPF‹r.h
"

4 
	~"debugMsg/Debug.h
"

5 
	~"­r/­r_pŞl£t.h
"

7 
	gSock‘HªdËr
::
	$Sock‘HªdËr
(
SYSUTILS_SPACE
::
A´TıSock‘
* 
pSock‘
, 
A´TıS”v”
 *
pA´TıS”v”
)

8 : 
	`m_pSock‘
(
pSock‘
)

9 , 
	`m_pA´TıS”v”
(
pA´TıS”v”
)

10 , 
	$m_bFisish
(
çl£
)

12 ià(!
	`Th»adExi¡s
())

14 
	`C»©eTh»ad
();

18 
	`ASSERT2
(0,"Createhread failed!!!\n");

20 
	}
}

22 
	gSock‘HªdËr
::~
	$Sock‘HªdËr
()

24 ià(
	`Th»adExi¡s
())

26 
	`Clo£Th»ad
();

28 
	}
}

30 
boŞ
 
	gSock‘HªdËr
::
	$G‘FšishStus
()

32 ià(!
	`Th»adExi¡s
(è&& !
m_bFisish
)

34 ià(
m_pSock‘
 !ğ
NULL
)

36 
d–‘e
 
m_pSock‘
;

37 
m_pSock‘
 = 
NULL
;

39 
	`ASSERT2
(0, "Thread is closed‡bnormally, delete socket...\n");

42  
Œue
;

45  
m_bFisish
;

46 
	}
}

48 
	gSock‘HªdËr
::
	$Th»adProc
()

50 ià(
m_pSock‘
 =ğ
NULL
)

52 
m_bFisish
 = 
Œue
;

57 
SYSUTILS_SPACE
::
A´PŞlS‘
 
	`pŞl£t
(1);

58 
­r_pŞlfd_t
 
pfd
 = {
NULL
, 
APR_POLL_SOCKET
, 
APR_POLLIN
, 0, {NULL}, NULL};

59 
pfd
.
desc
.
s
 = 
m_pSock‘
->
	`guts
();

60 
pŞl£t
.
	`add
(&
pfd
);

62 
št32_t
 
num
 = 0;

63 cÚ¡ 
­r_pŞlfd_t
 *
»t_pfd
 = 
NULL
;

64 
pŞl£t
.
	`pŞl
(&
num
, &
»t_pfd
, 15000);

66 ià(
num
 !ğ0 && 
»t_pfd
 !ğ
NULL
 && (»t_pfd[0].
¹Ãv’ts
 & 
APR_POLLIN
) != 0x0)

68 
ušt32_t
 
”rÜCode
 = 0;

70 ià(!
m_pA´TıS”v”
->
	`V®id©eAdd»ss
(
m_pSock‘
))

72 
m_pA´TıS”v”
->
	`OnInv®idSock‘
(
m_pSock‘
);

73 
d–‘e
 
m_pSock‘
;

74 
m_pSock‘
 = 
NULL
;

76 
	`ASSERT2
(0, "invalid ip‡ddress\n");

78 if(!
m_pA´TıS”v”
->
	`Acû±Sock‘
(
m_pSock‘
, 
”rÜCode
))

80 
d–‘e
 
m_pSock‘
;

81 
m_pSock‘
 = 
NULL
;

83 
	`ASSERT2
(0, "R—d sock‘ faed,ƒ¼ÜCod%u\n", 
”rÜCode
);

88 
	`ASSERT2
(0, "can't„ead socket\n");

90 
d–‘e
 
m_pSock‘
;

91 
m_pSock‘
 = 
NULL
;

94 
m_bFisish
 = 
Œue
;

95 
	}
}

	@../../titanutils/server/SocketHandler.h

1 #iâdeà
__SOCKET_HANDLER_H__


2 
	#__SOCKET_HANDLER_H__


	)

4 
	~"­r/­r_th»ad_wÜk”.h
"

5 
	~"­r/­r_sock‘.h
"

6 
	~"A´TıS”v”.h
"

9 şas 
	cSock‘HªdËr
: 
public
 
SYSUTILS_SPACE
::
A´Th»adWÜk”


11 
public
:

12 
Sock‘HªdËr
(
SYSUTILS_SPACE
::
A´TıSock‘
* 
pSock‘
, 
A´TıS”v”
 *
pA´TıS”v”
);

13 ~
Sock‘HªdËr
();

15 
boŞ
 
G‘FšishStus
();

17 
	m´Ùeùed
:

18 
Th»adProc
();

20 
	m´iv©e
:

21 
SYSUTILS_SPACE
::
A´TıSock‘
* 
m_pSock‘
;

22 
A´TıS”v”
 *
	mm_pA´TıS”v”
;

24 
boŞ
 
	mm_bFisish
;

	@../../titanutils/server/unittest/apr_tcp_responder_pool_test.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	~"commÚ/sy¡em.h
"

5 
	~"£rv”/A´TıS”v”.h
"

6 
	~"£rv”/A´TıRe¥Úd”PoŞ.h
"

7 
	~"£rv”/A´TıSock‘PoŞ.h
"

8 
	~"£rv”/A´TıSock‘PoŞRe¥Úd”.h
"

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 şas 
	cBounûRe¥Úd”
: 
public
 
A´TıSock‘PoŞRe¥Úd”


14 
public
:

15 
	$BounûRe¥Úd”
(
A´TıSock‘PoŞ
 *
pPoŞ
): 
	$A´TıSock‘PoŞRe¥Úd”
(
pPoŞ
, 500) {}

16 
´iv©e
:

17 
vœtu®
 
boŞ
 
	`HªdËReque¡
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, cÚ¡ 
¡d
::
veùÜ
<
ušt8_t
> &
bufãr
è{  
Œue
; 
	}
};

20 şas 
	cDige¡Re¥Úd”
: 
public
 
A´TıSock‘PoŞRe¥Úd”


22 
public
:

23 
	$Dige¡Re¥Úd”
(
A´TıSock‘PoŞ
 *
pPoŞ
): 
	$A´TıSock‘PoŞRe¥Úd”
(
pPoŞ
, 500) {}

24 
´iv©e
:

25 
vœtu®
 
boŞ
 
	`HªdËReque¡
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
pSock‘
, cÚ¡ 
¡d
::
veùÜ
<
ušt8_t
> &
bufãr
è{ 
d–‘e
…Sock‘;  
çl£
; 
	}
}

28 şas 
	cBounûRe¥Úd”G’”©Ü
: 
public
 
A´TıRe¥Úd”G’”©Ü


30 
public
:

31 
vœtu®
 
A´TıSock‘PoŞRe¥Úd”
 *
	$C»©eRe¥Úd”
(
A´TıSock‘PoŞ
 *
pPoŞ
è{  
Ãw
 
	`BounûRe¥Úd”
(pPool); }

32 
	}
};

34 şas 
	cDige¡Re¥Úd”G’”©Ü
: 
public
 
A´TıRe¥Úd”G’”©Ü


36 
public
:

37 
vœtu®
 
A´TıSock‘PoŞRe¥Úd”
 *
	$C»©eRe¥Úd”
(
A´TıSock‘PoŞ
 *
pPoŞ
è{  
Ãw
 
	`Dige¡Re¥Úd”
(pPool); }

38 
	}
};

40 şas 
	cRe¥Úd”S”v”
: 
public
 
A´TıS”v”


42 
public
:

43 
	$Re¥Úd”S”v”
(): 
	`m_sock‘_poŞ
(), 
	$m_»¥Úd”_poŞ
(&
m_sock‘_poŞ
) {};

44 
boŞ
 
	$P»·»
(
št32_t
 
max_sock‘
, iÁ32_ˆ
max_»¥Úd”
, 
boŞ
 
bounû
)

46 
m_sock‘_poŞ
.
	`S‘C­ac™y
(
max_sock‘
);

47 ià(
bounû
)

49 
BounûRe¥Úd”G’”©Ü
 
g’”©Ü
;

50 
m_»¥Úd”_poŞ
.
	`C»©eRe¥Úd”s
(
max_»¥Úd”
, &
g’”©Ü
);

54 
Dige¡Re¥Úd”G’”©Ü
 
g’”©Ü
;

55 
m_»¥Úd”_poŞ
.
	`C»©eRe¥Úd”s
(
max_»¥Úd”
, &
g’”©Ü
);

57 
m_»¥Úd”_poŞ
.
	`S¹Re¥Ú£
();

58  
Œue
;

59 
	}
}

60 
boŞ
 
	$CËªup
()

62 
m_»¥Úd”_poŞ
.
	`StİRe¥Ú£
();

63 
m_»¥Úd”_poŞ
.
	`De¡royRe¥Úd”s
();

64 
m_sock‘_poŞ
.
	`Clo£PoŞ
();

65  
Œue
;

66 
	}
}

67 
	g´iv©e
:

68 
vœtu®
 
boŞ
 
	$Acû±Sock‘
(
A´TıSock‘
 *
sock‘
è{ 
¡d
::
veùÜ
<
ušt8_t
> 
bufãr
;  
m_sock‘_poŞ
.
	`PushSock‘
(sock‘, bufãr); 
	}
}

69 
A´TıSock‘PoŞ
 
	gm_sock‘_poŞ
;

70 
A´TıRe¥Úd”PoŞ
 
	gm_»¥Úd”_poŞ
;

73 
	$TEST
(
A´TıRe¥Úd”PoŞTe¡
, 
BounûRe¥Úd”Te¡
)

75 
Re¥Úd”S”v”
 
£rv”
;

76 
	`EXPECT_TRUE
(
£rv”
.
	`S‘PÜt
(1234));

77 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

78 
	`EXPECT_TRUE
(
£rv”
.
	`P»·»
(500, 5, 
Œue
));

79 
	`EXPECT_TRUE
(
£rv”
.
	`S¹S”v”
());

80 
	`EXPECT_TRUE
(
£rv”
.
	`IsRuÂšg
());

81 
i
 = 0; i < 2000; i++)

83 
A´TıSock‘
 
sock‘
;

84 
	`EXPECT_EQ
((
­r_¡©us_t
)
APR_SUCCESS
, 
sock‘
.
	`cÚÃù
("127.0.0.1", 1234));

85 
	`SË•MS
(1);

87 
	`EXPECT_TRUE
(
£rv”
.
	`StİS”v”
());

88 
	`EXPECT_TRUE
(
£rv”
.
	`CËªup
());

89 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

90 
	}
}

92 
	$TEST
(
A´TıRe¥Úd”PoŞTe¡
, 
Dige¡Re¥Úd”Te¡
)

94 
Re¥Úd”S”v”
 
£rv”
;

95 
	`EXPECT_TRUE
(
£rv”
.
	`S‘PÜt
(1234));

96 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

97 
	`EXPECT_TRUE
(
£rv”
.
	`P»·»
(500, 5, 
çl£
));

98 
	`EXPECT_TRUE
(
£rv”
.
	`S¹S”v”
());

99 
	`EXPECT_TRUE
(
£rv”
.
	`IsRuÂšg
());

100 
i
 = 0; i < 2000; i++)

102 
A´TıSock‘
 
sock‘
;

103 
	`EXPECT_EQ
((
­r_¡©us_t
)
APR_SUCCESS
, 
sock‘
.
	`cÚÃù
("127.0.0.1", 1234));

104 
	`SË•MS
(1);

106 
	`EXPECT_TRUE
(
£rv”
.
	`StİS”v”
());

107 
	`EXPECT_TRUE
(
£rv”
.
	`CËªup
());

108 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

109 
	}
}

	@../../titanutils/server/unittest/apr_tcp_server_test.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	~"commÚ/sy¡em.h
"

5 
	~"£rv”/A´TıS”v”.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 şas 
	cRejeùS”v”
: 
public
 
A´TıS”v”


11 
vœtu®
 
boŞ
 
	$Acû±Sock‘
(
A´TıSock‘
 *
sock‘
è{  
çl£
; }

12 
	}
};

14 şas 
	cAcû±S”v”
: 
public
 
A´TıS”v”


16 
vœtu®
 
boŞ
 
	$Acû±Sock‘
(
A´TıSock‘
 *
sock‘
è{ 
d–‘e
 sock‘;  
Œue
; }

17 
	}
};

19 
	$TEST
(
A´TıS”v”Te¡
, 
RejeùTe¡
)

21 
RejeùS”v”
 
£rv”
;

22 
	`EXPECT_TRUE
(
£rv”
.
	`S‘PÜt
(1234));

23 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

24 
	`EXPECT_TRUE
(
£rv”
.
	`S¹S”v”
());

25 
	`EXPECT_TRUE
(
£rv”
.
	`IsRuÂšg
());

26 
i
 = 0; i < 5000; i++)

28 
A´TıSock‘
 
sock‘
;

29 
	`EXPECT_EQ
((
­r_¡©us_t
)
APR_SUCCESS
, 
sock‘
.
	`cÚÃù
("127.0.0.1", 1234));

30 
	`SË•MS
(1);

32 
	`EXPECT_TRUE
(
£rv”
.
	`StİS”v”
());

33 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

34 
	}
}

36 
	$TEST
(
A´TıS”v”Te¡
, 
Acû±Te¡
)

38 
Acû±S”v”
 
£rv”
;

39 
	`EXPECT_TRUE
(
£rv”
.
	`S‘PÜt
(1234));

40 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

41 
	`EXPECT_TRUE
(
£rv”
.
	`S¹S”v”
());

42 
	`EXPECT_TRUE
(
£rv”
.
	`IsRuÂšg
());

43 
i
 = 0; i < 5000; i++)

45 
A´TıSock‘
 
sock‘
;

46 
	`EXPECT_EQ
((
­r_¡©us_t
)
APR_SUCCESS
, 
sock‘
.
	`cÚÃù
("127.0.0.1", 1234));

47 
	`SË•MS
(1);

49 
	`EXPECT_TRUE
(
£rv”
.
	`StİS”v”
());

50 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

51 
	}
}

	@../../titanutils/server/unittest/apr_tcp_socket_pool_test.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	~"commÚ/sy¡em.h
"

5 
	~"£rv”/A´TıS”v”.h
"

6 
	~"£rv”/A´TıSock‘PoŞ.h
"

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 şas 
	cCÚ¡rŸÁS”v”
: 
public
 
A´TıS”v”


12 
public
:

13 
	$CÚ¡rŸÁS”v”
(
št32_t
 
nC­ac™y
): 
	$m_poŞ
(
nC­ac™y
) {}

14 
boŞ
 
	$CÚsumeSock‘
(è{ 
A´TıSock‘
 *
sock‘
 = 
NULL
; 
¡d
::
veùÜ
<
ušt8_t
> 
bufãr
; 
boŞ
 
»t
 = 
m_poŞ
.
	`PİSock‘
(&sock‘, bufãr); 
d–‘e
 sock‘; „‘; 
	}
}

15 
št32_t
 
	$G‘PoŞSize
(è{  
m_poŞ
.
	`G‘PoŞSize
(); 
	}
}

16 
	g´iv©e
:

17 
vœtu®
 
boŞ
 
	$Acû±Sock‘
(
A´TıSock‘
 *
sock‘
è{ 
¡d
::
veùÜ
<
ušt8_t
> 
bufãr
;  
m_poŞ
.
	`PushSock‘
(sock‘, bufãr); 
	}
}

18 
A´TıSock‘PoŞ
 
	gm_poŞ
;

21 
	$TEST
(
A´TıSock‘PoŞTe¡
, 
UÆim™edS”v”Te¡
)

23 
CÚ¡rŸÁS”v”
 
	`£rv”
(-1);

24 
	`EXPECT_TRUE
(
£rv”
.
	`S‘PÜt
(1234));

25 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

26 
	`EXPECT_TRUE
(
£rv”
.
	`S¹S”v”
());

27 
	`EXPECT_TRUE
(
£rv”
.
	`IsRuÂšg
());

28 
i
 = 0; i < 5000; i++)

30 
A´TıSock‘
 
sock‘
;

31 
	`EXPECT_EQ
((
­r_¡©us_t
)
APR_SUCCESS
, 
sock‘
.
	`cÚÃù
("127.0.0.1", 1234));

32 
	`SË•MS
(1);

33 ià(
i
 >= 1000)

35 
	`EXPECT_TRUE
(
£rv”
.
	`CÚsumeSock‘
());

38 
	`SË•MS
(100);

39 
	`EXPECT_EQ
(1000, 
£rv”
.
	`G‘PoŞSize
());

40 
£rv”
.
	`G‘PoŞSize
() > 0)

42 
	`EXPECT_TRUE
(
£rv”
.
	`CÚsumeSock‘
());

44 
	`EXPECT_TRUE
(
£rv”
.
	`StİS”v”
());

45 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

46 
	}
}

48 
	$TEST
(
A´TıSock‘PoŞTe¡
, 
Lim™edS”v”Te¡
)

50 
CÚ¡rŸÁS”v”
 
	`£rv”
(500);

51 
	`EXPECT_TRUE
(
£rv”
.
	`S‘PÜt
(1234));

52 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

53 
	`EXPECT_TRUE
(
£rv”
.
	`S¹S”v”
());

54 
	`EXPECT_TRUE
(
£rv”
.
	`IsRuÂšg
());

55 
i
 = 0; i < 5000; i++)

57 
A´TıSock‘
 
sock‘
;

58 
	`EXPECT_EQ
((
­r_¡©us_t
)
APR_SUCCESS
, 
sock‘
.
	`cÚÃù
("127.0.0.1", 1234));

59 
	`SË•MS
(1);

61 
	`SË•MS
(100);

62 
	`EXPECT_EQ
(500, 
£rv”
.
	`G‘PoŞSize
());

63 
£rv”
.
	`G‘PoŞSize
() > 0)

65 
	`EXPECT_TRUE
(
£rv”
.
	`CÚsumeSock‘
());

67 
	`EXPECT_TRUE
(
£rv”
.
	`StİS”v”
());

68 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

69 
	}
}

	@../../titanutils/server/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../../titanutils/server/unittest/session_handler_test.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	~"commÚ/sy¡em.h
"

4 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

6 
	~"£rv”/A´TıS”v”.h
"

7 
	~"£rv”/A´TıRe¥Úd”PoŞ.h
"

8 
	~"£rv”/A´TıSock‘PoŞ.h
"

9 
	~"£rv”/A´TıSock‘PoŞRe¥Úd”.h
"

10 
	~"£rv”/SessiÚHªdËr.h
"

11 
	~"£rv”/SessiÚMªag”.h
"

13 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

15 şas 
	cSessiÚSessiÚHªdËr
: 
public
 
SessiÚHªdËr


17 
public
:

18 
	$SessiÚSessiÚHªdËr
(
SessiÚMªag”
 *
mªag”
, 
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, SYSUTILS_SPACE::
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚId
)

19 : 
	$SessiÚHªdËr
(
mªag”
, 
sock‘
, 
bufãr
, 
£ssiÚId
) {}

20 
´iv©e
:

21 
vœtu®
 
	$G‘Tim”IÁ”v®
(è{  100; 
	}
}

22 
vœtu®
 
	$OnR—dC®lback
(è{
	}
}

23 
vœtu®
 
	$OnWr™eC®lback
(è{
	}
}

24 
vœtu®
 
	$OnTim”C®lback
(è{ 
	`G‘SessiÚMªag”
()->
	`RemoveHªdËr
(
	`G‘SessiÚID
()); 
	}
}

25 
vœtu®
 
	$OnSessiÚS¹
(è{
	}
}

26 
vœtu®
 
	$OnSessiÚLo¡
(è{
	}
}

29 şas 
	cSessiÚSessiÚHªdËrG’”©Ü
: 
public
 
SessiÚHªdËrG’”©Ü


31 
vœtu®
 
SessiÚHªdËr
 *
	$C»©eSessiÚHªdËr
(
SessiÚMªag”
 *
mªag”
, 
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, SYSUTILS_SPACE::
Ev’tBufãr
 &
bufãr
, 
ušt32_t
 
£ssiÚId
)

32 {  
Ãw
 
	`SessiÚSessiÚHªdËr
(
mªag”
, 
sock‘
, 
bufãr
, 
£ssiÚId
); }

33 
	}
};

35 şas 
	cSessiÚSessiÚMªag”
: 
public
 
SessiÚMªag”


37 
vœtu®
 
	$OnTim”C®lback
() {}

38 
	}
};

40 
ušt32_t
 
	$G‘NextSessiÚID
()

41 { 
ušt32_t
 
Ãxt_£ssiÚ_id
 = 0; 
Cr™iÿlSeùiÚ
 
cs
; 
Cr™iÿlSeùiÚLock
 
	`_l
(&cs); ‚ext_£ssiÚ_id++; 
	}
}

43 şas 
	cSessiÚRe¥Úd”
: 
public
 
A´TıSock‘PoŞRe¥Úd”


45 
public
:

46 
	$SessiÚRe¥Úd”
(
A´TıSock‘PoŞ
 *
poŞ
, 
SessiÚMªag”
 *
mªag”
): 
	`A´TıSock‘PoŞRe¥Úd”
ÕoŞ, 500), 
	$m_mªag”
(
mªag”
) {}

47 
´iv©e
:

49 
vœtu®
 
boŞ
 
	`HªdËReque¡
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, cÚ¡ 
¡d
::
veùÜ
<
ušt8_t
> &
bufãr
)

50 { 
SessiÚSessiÚHªdËrG’”©Ü
 
g’”©Ü
; 
Ev’tBufãr
 
ev_bufãr
; 
m_mªag”
->
	`C»©eHªdËr
(&g’”©Ü, 
sock‘
,ƒv_bufãr, 
	`G‘NextSessiÚID
());  
çl£
; 
	}
}

51 
SessiÚMªag”
 *
	gm_mªag”
;

54 şas 
	cSessiÚRe¥Úd”G’”©Ü
: 
public
 
A´TıRe¥Úd”G’”©Ü


56 
public
:

57 
	$SessiÚRe¥Úd”G’”©Ü
(
SessiÚMªag”
 *
mªag”
): 
	$m_mªag”
(
mªag”
) {}

58 
vœtu®
 
A´TıSock‘PoŞRe¥Úd”
 *
	$C»©eRe¥Úd”
(
A´TıSock‘PoŞ
 *
poŞ
)

59 {  
Ãw
 
	`SessiÚRe¥Úd”
(
poŞ
, 
m_mªag”
); 
	}
}

60 
	g´iv©e
:

61 
SessiÚMªag”
 *
m_mªag”
;

64 şas 
	cSessiÚS”v”
: 
public
 
A´TıS”v”


66 
public
:

67 
	$SessiÚS”v”
(): 
	`m_sock‘_poŞ
(), 
	`m_»¥Úd”_poŞ
(&
m_sock‘_poŞ
), 
	$m_£ssiÚ_mªag”
() {};

68 
boŞ
 
	$P»·»
(
št32_t
 
max_sock‘
, iÁ32_ˆ
max_»¥Úd”
)

70 
m_sock‘_poŞ
.
	`S‘C­ac™y
(
max_sock‘
);

71 
SessiÚRe¥Úd”G’”©Ü
 
	`g’”©Ü
(&
m_£ssiÚ_mªag”
);

72 
m_»¥Úd”_poŞ
.
	`C»©eRe¥Úd”s
(
max_»¥Úd”
, &
g’”©Ü
);

73 
m_»¥Úd”_poŞ
.
	`S¹Re¥Ú£
();

74 
m_£ssiÚ_mªag”
.
	`S¹SessiÚs
(500);

75  
Œue
;

76 
	}
}

77 
boŞ
 
	$CËªup
()

79 
m_£ssiÚ_mªag”
.
	`StİSessiÚs
();

80 
m_»¥Úd”_poŞ
.
	`StİRe¥Ú£
();

81 
m_»¥Úd”_poŞ
.
	`De¡royRe¥Úd”s
();

82 
m_sock‘_poŞ
.
	`Clo£PoŞ
();

83  
Œue
;

84 
	}
}

85 
	g´iv©e
:

86 
vœtu®
 
boŞ
 
	$Acû±Sock‘
(
A´TıSock‘
 *
sock‘
)

87 { 
¡d
::
veùÜ
<
ušt8_t
> 
bufãr
;  
m_sock‘_poŞ
.
	`PushSock‘
(
sock‘
, bufãr); 
	}
}

88 
A´TıSock‘PoŞ
 
	gm_sock‘_poŞ
;

89 
A´TıRe¥Úd”PoŞ
 
	gm_»¥Úd”_poŞ
;

90 
SessiÚSessiÚMªag”
 
	gm_£ssiÚ_mªag”
;

93 
	$TEST
(
SessiÚHªdËrTe¡
, 
SessiÚCÚÃùiÚTe¡
)

95 
SessiÚS”v”
 
£rv”
;

96 
	`EXPECT_TRUE
(
£rv”
.
	`S‘PÜt
(1234));

97 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

98 
	`EXPECT_TRUE
(
£rv”
.
	`P»·»
(500, 5));

99 
	`EXPECT_TRUE
(
£rv”
.
	`S¹S”v”
());

100 
	`EXPECT_TRUE
(
£rv”
.
	`IsRuÂšg
());

101 
i
 = 0; i < 2000; i++)

103 
A´TıSock‘
 
sock‘
;

104 
	`EXPECT_EQ
((
­r_¡©us_t
)
APR_SUCCESS
, 
sock‘
.
	`cÚÃù
("127.0.0.1", 1234));

105 
	`SË•MS
(1);

107 
	`EXPECT_TRUE
(
£rv”
.
	`StİS”v”
());

108 
	`EXPECT_TRUE
(
£rv”
.
	`CËªup
());

109 
	`EXPECT_FALSE
(
£rv”
.
	`IsRuÂšg
());

110 
	}
}

	@../../titanutils/serverConfig/AssociateDeviceItem.cpp

1 
	~"AssocŸ‹DeviûI‹m.h
"

2 
	~"sûw/xml_Œ“.h
"

3 
	~"commÚ/ut™y.h
"

4 
	~"commÚ/¡ršg.h
"

5 
	~"MSXmlTagDef.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
	gCAssocŸ‹Li¡
::
	$CAssocŸ‹Li¡
()

12 
	}
}

14 
CAssocŸ‹Li¡
::~
	$CAssocŸ‹Li¡
()

17 
	}
}

19 
CAssocŸ‹Li¡
::
CİyAssocŸ‹Li¡
(cÚ¡ 
¡d
::
veùÜ
<
TAssocŸ‹I‹m
>& 
vAssocŸ‹I‹m
)

22 
m_vAssocŸ‹I‹m
 = 
vAssocŸ‹I‹m
;

25 
boŞ
 
	gCAssocŸ‹Li¡
::
	$S”Ÿlize
(
XMLEËm’t
& 
roÙ
) const

27 
XMLEËm’t
 
chd
, 
ÿm”aLi¡
, 
ÿm”aI‹m
, 
–em’t
, 
™em
;

29 
size_t
 
ui
 = 0; u˜< 
m_vAssocŸ‹I‹m
.
	`size
(); ++ui)

31 
chd
 = 
roÙ
.
	`AddChd
(
XML_ASSOCIATE_ITEM
);

32 
chd
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_SERVER_ID
, 
m_vAssocŸ‹I‹m
[
ui
].
uÎS”v”ID
);

34 
ÿm”aLi¡
 = 
chd
.
	`AddChd
(
XML_ASSOCIATE_CAM_LIST
);

35 
size_t
 
uj
 = 0; uj < 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
.
	`size
(); ++uj)

37 
ÿm”aI‹m
 = 
ÿm”aLi¡
.
	`AddChd
(
XML_ASSOCIATE_ITEM
);

38 
ÿm”aI‹m
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_CAM_ID
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
uÎCam”aID
);

40 
–em’t
 = 
ÿm”aI‹m
.
	`AddChd
("digitalInput");

41 
size_t
 
uk
 = 0; uk < 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vDig™®IÅut
.
	`size
(); ++uk)

43 
™em
 = 
–em’t
.
	`AddChd
(
XML_ASSOCIATE_ID
);

44 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_DEVICE
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vDig™®IÅut
[
uk
].
uÎDeviûID
);

45 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_SERVER
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vDig™®IÅut
[
uk
].
uÎS”v”ID
);

48 
–em’t
 = 
ÿm”aI‹m
.
	`AddChd
("outputRelay");

49 
size_t
 
uk
 = 0; uk < 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vOuutR–ay
.
	`size
(); ++uk)

51 
™em
 = 
–em’t
.
	`AddChd
(
XML_ASSOCIATE_ID
);

52 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_DEVICE
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vOuutR–ay
[
uk
].
uÎDeviûID
);

53 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_SERVER
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vOuutR–ay
[
uk
].
uÎS”v”ID
);

56 
–em’t
 = 
ÿm”aI‹m
.
	`AddChd
("microphone");

57 
size_t
 
uk
 = 0; uk < 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vMiüİhÚe
.
	`size
(); ++uk)

59 
™em
 = 
–em’t
.
	`AddChd
(
XML_ASSOCIATE_ID
);

60 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_DEVICE
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vMiüİhÚe
[
uk
].
uÎDeviûID
);

61 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_SERVER
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vMiüİhÚe
[
uk
].
uÎS”v”ID
);

64 
–em’t
 = 
ÿm”aI‹m
.
	`AddChd
("speaker");

65 
size_t
 
uk
 = 0; uk < 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vS³ak”
.
	`size
(); ++uk)

67 
™em
 = 
–em’t
.
	`AddChd
(
XML_ASSOCIATE_ID
);

68 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_DEVICE
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vS³ak”
[
uk
].
uÎDeviûID
);

69 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_SERVER
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vS³ak”
[
uk
].
uÎS”v”ID
);

72 
–em’t
 = 
ÿm”aI‹m
.
	`AddChd
("ptzMotor");

73 
size_t
 
uk
 = 0; uk < 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vPtzMÙÜ
.
	`size
(); ++uk)

75 
™em
 = 
–em’t
.
	`AddChd
(
XML_ASSOCIATE_ID
);

76 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_DEVICE
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vPtzMÙÜ
[
uk
].
uÎDeviûID
);

77 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_SERVER
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vPtzMÙÜ
[
uk
].
uÎS”v”ID
);

80 
–em’t
 = 
ÿm”aI‹m
.
	`AddChd
("metadataNode");

81 
size_t
 
uk
 = 0; uk < 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vSourûI‹m
.
	`size
(); ++uk)

83 
™em
 = 
–em’t
.
	`AddChd
(
XML_ASSOCIATE_ID
);

84 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_DEVICE
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vSourûI‹m
[
uk
].
uÎDeviûID
);

85 
™em
.
	`AddA‰ribu‹
(
XML_ASSOCIATE_SERVER
, 
m_vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
].
vSourûI‹m
[
uk
].
uÎS”v”ID
);

89  
Œue
;

90 
	}
}

92 
boŞ
 
	gCAssocŸ‹Li¡
::
	$Un£rŸlize
(
XMLEËm’t
& 
roÙ
)

94 
¡d
::
veùÜ
<
XMLEËm’t
> 
vS”v”I‹m
 = 
roÙ
.
	`G‘Chd»n
(
XML_ASSOCIATE_ITEM
);

95 
size_t
 
ui
 = 0; u˜< 
vS”v”I‹m
.
	`size
(); ui++)

97 
TAssocŸ‹I‹m
 
tAssocŸ‹I‹m
;

98 
tAssocŸ‹I‹m
.
uÎS”v”ID
 = 
vS”v”I‹m
[
ui
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_SERVER_ID
);

99 
XMLEËm’t
 
ÿmLi¡
 = 
vS”v”I‹m
[
ui
].
	`G‘Chd
(
XML_ASSOCIATE_CAM_LIST
);

100 
¡d
::
veùÜ
<
XMLEËm’t
> 
vCamI‹m
 = 
ÿmLi¡
.
	`G‘Chd»n
(
XML_ASSOCIATE_ITEM
);

101 
size_t
 
uj
 = 0; uj < 
vCamI‹m
.
	`size
(); uj++)

103 
TPaœI‹m
 
tPaœI‹m
;

104 
¡d
::
veùÜ
<
XMLEËm’t
> 
vSourûIDI‹m
;

105 
tPaœI‹m
.
uÎCam”aID
 = 
vCamI‹m
[
uj
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_CAM_ID
);

107 
XMLEËm’t
 
dig™®IÅut
 = 
vCamI‹m
[
uj
].
	`G‘Chd
(
XML_ASSOCIATE_DIGITAL_INPUT
);

108 
vSourûIDI‹m
 = 
dig™®IÅut
.
	`G‘Chd»n
(
XML_ASSOCIATE_ID
);

109 
size_t
 
uk
 = 0; uk < 
vSourûIDI‹m
.
	`size
(); uk++)

111 
TSourûI‹m
 
tSourûI‹m
;

112 
tSourûI‹m
.
uÎS”v”ID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_SERVER
);

113 
tSourûI‹m
.
uÎDeviûID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_DEVICE
);

114 
tPaœI‹m
.
vDig™®IÅut
.
	`push_back
(
tSourûI‹m
);

117 
XMLEËm’t
 
ouutR–ay
 = 
vCamI‹m
[
uj
].
	`G‘Chd
(
XML_ASSOCIATE_OUTPUT_RELAY
);

118 
vSourûIDI‹m
 = 
ouutR–ay
.
	`G‘Chd»n
(
XML_ASSOCIATE_ID
);

119 
size_t
 
uk
 = 0; uk < 
vSourûIDI‹m
.
	`size
(); uk++)

121 
TSourûI‹m
 
tSourûI‹m
;

122 
tSourûI‹m
.
uÎS”v”ID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_SERVER
);

123 
tSourûI‹m
.
uÎDeviûID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_DEVICE
);

124 
tPaœI‹m
.
vOuutR–ay
.
	`push_back
(
tSourûI‹m
);

127 
XMLEËm’t
 
miüİhÚe
 = 
vCamI‹m
[
uj
].
	`G‘Chd
(
XML_ASSOCIATE_MICROPHONE
);

128 
vSourûIDI‹m
 = 
miüİhÚe
.
	`G‘Chd»n
(
XML_ASSOCIATE_ID
);

129 
size_t
 
uk
 = 0; uk < 
vSourûIDI‹m
.
	`size
(); uk++)

131 
TSourûI‹m
 
tSourûI‹m
;

132 
tSourûI‹m
.
uÎS”v”ID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_SERVER
);

133 
tSourûI‹m
.
uÎDeviûID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_DEVICE
);

134 
tPaœI‹m
.
vMiüİhÚe
.
	`push_back
(
tSourûI‹m
);

137 
XMLEËm’t
 
¥—k”
 = 
vCamI‹m
[
uj
].
	`G‘Chd
(
XML_ASSOCIATE_SPEAKER
);

138 
vSourûIDI‹m
 = 
¥—k”
.
	`G‘Chd»n
(
XML_ASSOCIATE_ID
);

139 
size_t
 
uk
 = 0; uk < 
vSourûIDI‹m
.
	`size
(); uk++)

141 
TSourûI‹m
 
tSourûI‹m
;

142 
tSourûI‹m
.
uÎS”v”ID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_SERVER
);

143 
tSourûI‹m
.
uÎDeviûID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_DEVICE
);

144 
tPaœI‹m
.
vS³ak”
.
	`push_back
(
tSourûI‹m
);

147 
XMLEËm’t
 
±zMÙÜ
 = 
vCamI‹m
[
uj
].
	`G‘Chd
(
XML_ASSOCIATE_PTZ_MOTOR
);

148 
vSourûIDI‹m
 = 
±zMÙÜ
.
	`G‘Chd»n
(
XML_ASSOCIATE_ID
);

149 
size_t
 
uk
 = 0; uk < 
vSourûIDI‹m
.
	`size
(); uk++)

151 
TSourûI‹m
 
tSourûI‹m
;

152 
tSourûI‹m
.
uÎS”v”ID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_SERVER
);

153 
tSourûI‹m
.
uÎDeviûID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_DEVICE
);

154 
tPaœI‹m
.
vPtzMÙÜ
.
	`push_back
(
tSourûI‹m
);

157 
XMLEËm’t
 
m‘ad©aNode
 = 
vCamI‹m
[
uj
].
	`G‘Chd
(
XML_ASSOCIATE_METADATA_NODE
);

158 
vSourûIDI‹m
 = 
m‘ad©aNode
.
	`G‘Chd»n
(
XML_ASSOCIATE_ID
);

159 
size_t
 
uk
 = 0; uk < 
vSourûIDI‹m
.
	`size
(); uk++)

161 
TSourûI‹m
 
tSourûI‹m
;

162 
tSourûI‹m
.
uÎS”v”ID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_SERVER
);

163 
tSourûI‹m
.
uÎDeviûID
 = 
vSourûIDI‹m
[
uk
].
	`G‘A‰ribu‹
(
XML_ASSOCIATE_DEVICE
);

164 
tPaœI‹m
.
vSourûI‹m
.
	`push_back
(
tSourûI‹m
);

166 
tAssocŸ‹I‹m
.
vPaœI‹m
.
	`push_back
(
tPaœI‹m
);

169 
m_vAssocŸ‹I‹m
.
	`push_back
(
tAssocŸ‹I‹m
);

172  
Œue
;

173 
	}
}

175 cÚ¡ 
	g¡d
::
veùÜ
<
TAssocŸ‹I‹m
>& 
CAssocŸ‹Li¡
::
	$G‘AssocŸ‹Li¡
()

177  
m_vAssocŸ‹I‹m
;

178 
	}
}

180 
	gCM­DevLi¡
::
	$CM­DevLi¡
()

183 
	}
}

185 
CM­DevLi¡
::~
	$CM­DevLi¡
()

188 
	}
}

190 cÚ¡ 
¡d
::
veùÜ
<
TM­DevI‹m
>& 
CM­DevLi¡
::
	$G‘M­DevLi¡
()

192  
m_vM­DevI‹m
;

193 
	}
}

195 
boŞ
 
	gCM­DevLi¡
::
S‘M­DevLi¡
(cÚ¡ 
¡d
::
veùÜ
<
TAssocŸ‹I‹m
>& 
vAssocŸ‹I‹m
)

197 
m_vM­DevI‹m
.
ş—r
();

198 
size_t
 
	gui
 = 0; u˜< 
	gvAssocŸ‹I‹m
.
size
(); ui++)

200 cÚ¡ 
	gTAssocŸ‹I‹m
& 
	gtAssocŸ‹I‹m
 = 
vAssocŸ‹I‹m
[
ui
];

201 
size_t
 
	guj
 = 0; uj < 
	gtAssocŸ‹I‹m
.
	gvPaœI‹m
.
size
(); uj++)

203 cÚ¡ 
	gTPaœI‹m
& 
	gtPaœI‹m
 = 
vAssocŸ‹I‹m
[
ui
].
vPaœI‹m
[
uj
];

204 
size_t
 
	guk
 = 0; uk < 
	gtPaœI‹m
.
	gvSourûI‹m
.
size
(); uk++)

206 cÚ¡ 
	gTSourûI‹m
& 
	gtourûI‹m
 = 
tPaœI‹m
.
vSourûI‹m
[
uk
];

211 
size_t
 
	guiDevIdx
 = 0;

212 
boŞ
 
	gbFšdDevID
 = 
çl£
;

213 
size_t
 
	guiIdx
 = 0; uiIdx < 
	gm_vM­DevI‹m
.
size
(); uiIdx++)

215 ià(
	gm_vM­DevI‹m
[
uiIdx
].
	guÎDevID
 =ğ
tourûI‹m
.
uÎDeviûID
)

217 
bFšdDevID
 = 
Œue
;

218 
	guiDevIdx
 = 
uiIdx
;

223 ià(
	gbFšdDevID
 =ğ
çl£
)

225 
TM­DevI‹m
 
tM­DevI‹m
;

226 
	gtM­DevI‹m
.
	guÎDevID
 = 
tourûI‹m
.
uÎDeviûID
;

227 
TM­S”v”I‹m
 
	gtM­S”v”I‹m
;

228 
	gtM­S”v”I‹m
.
	guÎS”v”ID
 = 
tAssocŸ‹I‹m
.
uÎS”v”ID
;

229 
	gtM­S”v”I‹m
.
	gvCamID
.
push_back
(
tPaœI‹m
.
uÎCam”aID
);

230 
	gtM­DevI‹m
.
	gvM­S”v”I‹m
.
push_back
(
tM­S”v”I‹m
);

231 
	gm_vM­DevI‹m
.
push_back
(
tM­DevI‹m
);

236 cÚ¡ 
	gTM­DevI‹m
& 
	gtM­DevI‹m
 = 
m_vM­DevI‹m
[
uiDevIdx
];

237 
size_t
 
	guiS”v”Idx
 = 0;

238 
boŞ
 
	gbFšdS”v”ID
 = 
çl£
;

239 
size_t
 
	gujIdx
 = 0; ujIdx < 
	gtM­DevI‹m
.
	gvM­S”v”I‹m
.
size
(); ujIdx++)

241 ià(
	gtM­DevI‹m
.
	gvM­S”v”I‹m
[
ujIdx
].
	guÎS”v”ID
 =ğ
tAssocŸ‹I‹m
.
uÎS”v”ID
)

243 
bFšdS”v”ID
 = 
Œue
;

244 
	guiS”v”Idx
 = 
ujIdx
;

249 ià(
	gbFšdS”v”ID
 =ğ
çl£
)

251 
TM­S”v”I‹m
 
tM­S”v”I‹m
;

252 
	gtM­S”v”I‹m
.
	guÎS”v”ID
 = 
tAssocŸ‹I‹m
.
uÎS”v”ID
;

253 
	gtM­S”v”I‹m
.
	gvCamID
.
push_back
(
tPaœI‹m
.
uÎCam”aID
);

254 
	gm_vM­DevI‹m
[
uiDevIdx
].
	gvM­S”v”I‹m
.
push_back
(
tM­S”v”I‹m
);

259 
	gm_vM­DevI‹m
[
uiDevIdx
].
	gvM­S”v”I‹m
[
uiS”v”Idx
].
	gvCamID
.
push_back
(
tPaœI‹m
.
uÎCam”aID
);

265  
	gŒue
;

268 
boŞ
 
	gCM­DevLi¡
::
FšdM­S”v”I‹m
(
ušt64_t
 
uÎDevID
, 
¡d
::
veùÜ
<
TM­S”v”I‹m
>& 
vM­S”v”I‹m
)

270 
size_t
 
ui
 = 0; 
	gui
 < 
	gm_vM­DevI‹m
.
size
(); ui++)

272 ià(
	gm_vM­DevI‹m
[
ui
].
	guÎDevID
 =ğ
uÎDevID
)

274 
vM­S”v”I‹m
 = 
m_vM­DevI‹m
[
ui
].vMapServerItem;

276  
	gŒue
;

280  
	gçl£
;

283 
boŞ
 
	gCM­DevLi¡
::
S‘M­DevLi¡
(cÚ¡ 
¡d
::
veùÜ
<
TM­DevI‹m
>& 
vM­DevI‹m
)

285 
m_vM­DevI‹m
 = 
vM­DevI‹m
;

287  
	gŒue
;

	@../../titanutils/serverConfig/AssociateDeviceItem.h

1 #iâdeà
__ASSOCIATE_DEVICE_ITEM__


2 
	#__ASSOCIATE_DEVICE_ITEM__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"sûw/xml_–em’t.h
"

6 
	~"sûw/xml_Œ“.h
"

8 
	sT_SOURCE_ITEM


10 
ušt64_t
 
	muÎS”v”ID
;

11 
ušt64_t
 
	muÎDeviûID
;

12 } 
	tTSourûI‹m
;

14 
	sT_PAIR_ITEM


16 
ušt64_t
 
	muÎCam”aID
;

17 
	m¡d
::
veùÜ
<
TSourûI‹m
> 
vDig™®IÅut
;

18 
	m¡d
::
veùÜ
<
TSourûI‹m
> 
vOuutR–ay
;

19 
	m¡d
::
veùÜ
<
TSourûI‹m
> 
vMiüİhÚe
;

20 
	m¡d
::
veùÜ
<
TSourûI‹m
> 
vS³ak”
;

21 
	m¡d
::
veùÜ
<
TSourûI‹m
> 
vPtzMÙÜ
;

22 
	m¡d
::
veùÜ
<
TSourûI‹m
> 
vSourûI‹m
;

23 } 
	tTPaœI‹m
;

25 
	sT_ASSOCIATE_ITEM


27 
ušt64_t
 
	muÎS”v”ID
;

28 
	m¡d
::
veùÜ
<
TPaœI‹m
> 
vPaœI‹m
;

29 } 
	tTAssocŸ‹I‹m
;

31 şas 
	cCAssocŸ‹Li¡


33 
	mpublic
:

34 
CAssocŸ‹Li¡
();

35 ~
CAssocŸ‹Li¡
();

37 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

38 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

39 
	`CİyAssocŸ‹Li¡
(cÚ¡ 
¡d
::
veùÜ
<
TAssocŸ‹I‹m
>& 
vAssocŸ‹I‹m
);

40 cÚ¡ 
¡d
::
veùÜ
<
TAssocŸ‹I‹m
>& 
	`G‘AssocŸ‹Li¡
();

42 
´iv©e
:

43 
	`CAssocŸ‹Li¡
(cÚ¡ 
CAssocŸ‹Li¡
&);

44 
CAssocŸ‹Li¡
 &
İ”©Ü
=(const CAssociateList&);

46 
´iv©e
:

47 
¡d
::
veùÜ
<
TAssocŸ‹I‹m
> 
m_vAssocŸ‹I‹m
;

50 
	sT_MAP_SERVER_ITEM


52 
ušt64_t
 
uÎS”v”ID
;

53 
¡d
::
veùÜ
<
ušt64_t
> 
vCamID
;

54 } 
	tTM­S”v”I‹m
;

56 
	sT_MAP_DEV_ITEM


58 
ušt64_t
 
uÎDevID
;

59 
¡d
::
veùÜ
<
TM­S”v”I‹m
> 
vM­S”v”I‹m
;

60 } 
	tTM­DevI‹m
;

62 şas 
	cCM­DevLi¡


64 
public
:

65 
	`CM­DevLi¡
();

66 ~
	`CM­DevLi¡
();

67 cÚ¡ 
¡d
::
veùÜ
<
TM­DevI‹m
>& 
	`G‘M­DevLi¡
();

68 
boŞ
 
	`S‘M­DevLi¡
(cÚ¡ 
¡d
::
veùÜ
<
TM­DevI‹m
>& 
vM­DevI‹m
);

69 
boŞ
 
	`S‘M­DevLi¡
(cÚ¡ 
¡d
::
veùÜ
<
TAssocŸ‹I‹m
>& 
vAssocŸ‹I‹m
);

70 
boŞ
 
	`FšdM­S”v”I‹m
(
ušt64_t
 
uÎDevID
, 
¡d
::
veùÜ
<
TM­S”v”I‹m
>& 
vM­S”v”I‹m
);

72 
´iv©e
:

73 
	`CM­DevLi¡
(cÚ¡ 
CM­DevLi¡
&);

74 
CM­DevLi¡
 &
İ”©Ü
=(const CMapDevList&);

76 
´iv©e
:

77 
¡d
::
veùÜ
<
TM­DevI‹m
> 
m_vM­DevI‹m
;

	@../../titanutils/serverConfig/AutoBackupConfig.cpp

1 
	~"AutoBackupCÚfig.h
"

2 
	~"commÚ/ut™y.h
"

4 
	~<¡dio.h
>

6 
boŞ
 
	gCAutoBackupS‘tšgs
::
	$S‘AutoBackupCÚfig
(cÚ¡ * 
pFeP©h
, cÚ¡ 
SERVER_PROTOCOL_DATA
::
AutoBackupCÚfig
 *
pCÚfigD©a
)

8 
	`IF_NULL_RETURN_VALUE
(
pFeP©h
, 
çl£
);

9 
	`IF_NULL_RETURN_VALUE
(
pCÚfigD©a
, 
çl£
);

11 
SYSUTILS_SPACE
::
XMLT»e
 
Œ“
;

12 
SYSUTILS_SPACE
::
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`S‘RoÙ
("AutoBackupConfig");

13 
boŞ
 
bR‘
 = 
pCÚfigD©a
->
	`S”Ÿlize
(
–em’t
);

15 
SYSUTILS_SPACE
::
	`SaveXMLT»e
(
pFeP©h
, 
Œ“
);

17  
bR‘
;

18 
	}
}

20 
boŞ
 
	gCAutoBackupS‘tšgs
::
	$G‘AutoBackupCÚfig
(cÚ¡ * 
pFeP©h
, 
SERVER_PROTOCOL_DATA
::
AutoBackupCÚfig
 *
pCÚfigD©a
)

22 
	`IF_NULL_RETURN_VALUE
(
pFeP©h
, 
çl£
);

23 
	`IF_NULL_RETURN_VALUE
(
pCÚfigD©a
, 
çl£
);

25 
SYSUTILS_SPACE
::
XMLT»e
 
Œ“
;

26 
SYSUTILS_SPACE
::
XMLEËm’t
 
–em’t
;

28 ià(!
SYSUTILS_SPACE
::
	`LßdXMLT»e
(
pFeP©h
, 
Œ“
))

30 
	`´štf
("Lßd CAutoBackupS‘tšg % XML FFa!!\n", 
pFeP©h
);

31  
çl£
;

33 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

34  
pCÚfigD©a
->
	`Un£rŸlize
(
–em’t
);

35 
	}
}

	@../../titanutils/serverConfig/AutoBackupConfig.h

1 #iâdeà
__AUTO_BACKUP_CONFIG__


2 
	#__AUTO_BACKUP_CONFIG__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"sûw/xml_–em’t.h
"

6 
	~"sûw/xml_Œ“.h
"

7 
	~"£rv”CÚfig/S”v”PrÙocŞD©aSŒuù.h
"

9 şas 
	cCAutoBackupS‘tšgs


11 
	mpublic
:

12 
CAutoBackupS‘tšgs
();

13 ~
CAutoBackupS‘tšgs
();

14 
boŞ
 
S‘AutoBackupCÚfig
(cÚ¡ * 
pFeP©h
, cÚ¡ 
SERVER_PROTOCOL_DATA
::
AutoBackupCÚfig
 *
pCÚfigD©a
);

15 
boŞ
 
G‘AutoBackupCÚfig
(cÚ¡ * 
pFeP©h
, 
SERVER_PROTOCOL_DATA
::
AutoBackupCÚfig
 *
pCÚfigD©a
);

17 
	m´iv©e
:

18 
CAutoBackupS‘tšgs
(const CAutoBackupSettings&);

19 
	mCAutoBackupS‘tšgs
 &
	mİ”©Ü
=(cÚ¡ 
CAutoBackupS‘tšgs
&);

	@../../titanutils/serverConfig/ClientQueryEventSessionParser.cpp

1 
	~"Cl›ÁQu”yEv’tSessiÚP¬£r.h
"

3 
	~"commÚ/¡ršg.h
"

5 
	~"T™ªCommÚ/CommÚSŒšg.h
"

7 
	~"debugMsg/Debug.h
"

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
boŞ
 
	gCl›ÁQu”yEv’tSessiÚP¬£r
::
	$CÚv”tQu”yEv’tReque¡
(
XMLT»e
& 
Œ“
, 
Cl›ÁQu”yEv’tReque¡P¬am
& 
»que¡
)

13 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

15 ià(
roÙ
.
	`G‘Name
() != "np:queryEvent")

17 
	`TRACE
("RoÙNamğ%s\n", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

18  
çl£
;

21 
»que¡
.
£ssiÚID
 = 
roÙ
.
	`G‘Chd
("sessionId");

22 
»que¡
.
£rv”ID
 = 
roÙ
.
	`G‘Chd
("serverId");

24 
XMLEËm’t
 
xeCÚd™iÚ
 = 
roÙ
.
	`G‘Chd
("queryCondition");

25 
»que¡
.
f‹r
.
ÚlyQu”yInScheduË
 = 
xeCÚd™iÚ
.
	`G‘Chd
("onlyQueryInSchedule");

26 
»que¡
.
f‹r
.
¡¬tTime
 = 
xeCÚd™iÚ
.
	`G‘Chd
("startTime");

27 
»que¡
.
f‹r
.
’dTime
 = 
xeCÚd™iÚ
.
	`G‘Chd
("endTime");

29 
¡d
::
veùÜ
<
XMLEËm’t
> 
xesourûIDLi¡
 = 
xeCÚd™iÚ
.
	`G‘Chd
("sourûIdLi¡").
	`G‘Chd»n
("item");

30 
¡d
::
veùÜ
<
XMLEËm’t
>::
™”©Ü
 
™
 = 
xesourûIDLi¡
.
	`begš
(); iˆ!ğxesourûIDLi¡.
	`’d
(); it++)

32 
Ev’tSourûID
 
·œ
;

33 
·œ
.
£rv”ID
 = 
™
->
	`G‘Chd
("server");

34 
·œ
.
deviûID
 = 
™
->
	`G‘Chd
("device");

35 
»que¡
.
f‹r
.
ev’tSourûIDLi¡
.
	`push_back
(
·œ
);

38 
¡d
::
veùÜ
<
XMLEËm’t
> 
xeEv’tIDLi¡
 = 
xeCÚd™iÚ
.
	`G‘Chd
("ev’tIdLi¡").
	`G‘Chd»n
("id");

39 
¡d
::
veùÜ
<
XMLEËm’t
>::
™”©Ü
 
™
 = 
xeEv’tIDLi¡
.
	`begš
(); iˆ!ğxeEv’tIDLi¡.
	`’d
(); it++)

41 
ušt32_t
 
ev’tID
 = *
™
;

42 
»que¡
.
f‹r
.
ev’tIDLi¡
.
	`push_back
(
ev’tID
);

45  
Œue
;

46 
	}
}

49 
boŞ
 
	gCl›ÁQu”yEv’tSessiÚP¬£r
::
	$CÚv”tQu”yEv’tE¼ÜRe¥Ú£
(
¡d
::
¡ršg
& 
¡rRe¥Ú£
, 
ušt32_t
 
”rÜCode
,

50 cÚ¡ 
¡d
::
¡ršg
& 
»¥Ú£Ty³
)

52 
¡d
::
¡ršg
 
¡¬tLše
 = 
	`G’”©eStusLše
(200);

54 cÚ¡ 
s_mes§ge_fÜm©
[] =

60 
¡d
::
¡ršg
 
mes§ge
 = 
	`¡ršg_fÜm©
(
s_mes§ge_fÜm©
, 
»¥Ú£Ty³
.
	`c_¡r
(), 
”rÜCode
,„esponseType.c_str());

62 
¡d
::
¡ršg
 
h—d”
 = 
	`G’”©eMes§geH—d”
(
mes§ge
.
	`Ëngth
());

64 
¡rRe¥Ú£
 = 
¡¬tLše
 + 
h—d”
 + 
CRLF
 + 
mes§ge
;

66  
Œue
;

67 
	}
}

69 
boŞ
 
	gCl›ÁQu”yEv’tSessiÚP¬£r
::
CÚv”tQu”yEv’tS¹Reque¡D©aRe¥Ú£
(
¡d
::
¡ršg
& 
¡rRe¥Ú£
,

70 cÚ¡ 
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
ev’tD©aLi¡
)

72 
TRACE
("¡rRe¥Ú£: %s\n", 
¡rRe¥Ú£
.
c_¡r
());

73 
TRACE
("ev’tD©aLi¡ size: %d\n", 
ev’tD©aLi¡
.
size
());

74 ià(
	gev’tD©aLi¡
.
size
() != 0)

76 
TRACE
("ev’tD©aLi¡ sDeviûName: %s\n", 
ev’tD©aLi¡
[0].
sDeviûName
.
c_¡r
());

77 
TRACE
("ev’tD©aLi¡ iEv’tID: %d\n", 
ev’tD©aLi¡
[0].
iEv’tID
);

80 
	g¡d
::
¡ršg
 
¡¬tLše
 = 
G’”©eStusLše
(200);

82 
XMLT»e
 
	gŒ“
;

83 
XMLEËm’t
 
	g–em’t
 = 
Œ“
.
S‘RoÙ
("np:queryEventResponse");

84 
	g–em’t
.
AddA‰ribu‹
("xmlns:np", "http://tempuri.org/np.xsd");

86 
XMLEËm’t
 
	gchd
 = 
–em’t
.
AddChd
("eventDataList");

87 
	g¡d
::
veùÜ
<
Ev’tLogI‹m
>::
cÚ¡_™”©Ü
 
™
 = 
ev’tD©aLi¡
.
begš
(); 
	g™
 !ğev’tD©aLi¡.
’d
(); it++)

89 
XMLEËm’t
 
	gxeI‹m
 = 
chd
.
AddChd
("item");

91 
XMLEËm’t
 
	gxeOccurTime
 = 
xeI‹m
.
AddChd
("occurTime");

92 
	gxeOccurTime
.
AddChd
("time", 
™
->
uÎLogTime
);

93 
	gxeOccurTime
.
AddChd
("milliSecond", 0);

95 
	gxeI‹m
.
AddChd
("ev’tId", 
™
->
iEv’tID
);

97 
XMLEËm’t
 
	gxeSourûEÁ™yId
 = 
xeI‹m
.
AddChd
("sourceEntityId");

98 
	gxeSourûEÁ™yId
.
AddChd
("£rv”Ty³", 
™
->
iS”v”Ty³
);

99 
	gxeSourûEÁ™yId
.
AddChd
("£rv”Id", 
™
->
uÎS”v”ID
);

100 
	gxeSourûEÁ™yId
.
AddChd
("deviûId", 
™
->
uÎDeviûID
);

102 
	gxeI‹m
.
AddChd
("sourûName", 
™
->
sDeviûName
);

103 
	gxeI‹m
.
AddChd
("desütiÚ", 
™
->
sDesütiÚ
);

106 
	g¡d
::
¡ršg
 
mes§ge
;

107 
SaveXMLT»eBufãr
(
mes§ge
, 
Œ“
);

109 
	g¡d
::
¡ršg
 
h—d”
 = 
G’”©eMes§geH—d”
(
mes§ge
.
Ëngth
());

111 
	g¡rRe¥Ú£
 = 
¡¬tLše
 + 
h—d”
 + 
CRLF
 + 
mes§ge
;

113  
	gŒue
;

	@../../titanutils/serverConfig/ClientQueryEventSessionParser.h

1 #iâdeà
__CLIENT_QUERY_EVENT_SESSION_PARSER_H__


2 
	#__CLIENT_QUERY_EVENT_SESSION_PARSER_H__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~"sûw/xml_Œ“.h
"

8 
	~"log/Ev’tLogQu”y.h
"

11 
	sCl›ÁQu”yEv’tReque¡P¬am


13 
ušt32_t
 
	m£ssiÚID
;

14 
ušt64_t
 
	m£rv”ID
;

15 
Ev’tLogQu”yF‹r
 
	mf‹r
;

18 şas 
	cCl›ÁQu”yEv’tSessiÚP¬£r


20 
	mpublic
:

22 
boŞ
 
CÚv”tQu”yEv’tReque¡
(
SYSUTILS_SPACE
::
XMLT»e
& 
Œ“
, 
Cl›ÁQu”yEv’tReque¡P¬am
& 
»que¡
);

23 
boŞ
 
CÚv”tQu”yEv’tE¼ÜRe¥Ú£
(
¡d
::
¡ršg
& 
¡rRe¥Ú£
, 
ušt32_t
 
”rÜCode
,

24 cÚ¡ 
¡d
::
¡ršg
& 
»¥Ú£Ty³
);

25 
boŞ
 
CÚv”tQu”yEv’tS¹Reque¡D©aRe¥Ú£
(
¡d
::
¡ršg
& 
¡rRe¥Ú£
,

26 cÚ¡ 
¡d
::
veùÜ
<
Ev’tLogI‹m
>& 
ev’tD©aLi¡
);

	@../../titanutils/serverConfig/HNAConfig.cpp

1 
	~"HNACÚfig.h
"

3 
	~<¡dio.h
>

4 
	~<¡ršg.h
>

5 
	~<®gÜ™hm
>

7 
	~"N‘wÜkS‘tšgXmlTagDef.h
"

8 
	~"sûw/xml_Œ“.h
"

9 
	~"commÚ/ut™y.h
"

11 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

13 #ifdeà
_DEBUG


14 
	#DEBUG_TRACE
(
fmt
, ...èdØ{ 
	`årštf
(
¡d”r
, "[HNACÚfig: %s:%d] "fmt, 
__FILE__
, 
__LINE__
, ##
__VA_ARGS__
); } 0)

	)

16 
	#DEBUG_TRACE
(...)

	)

19 
	gCHNACÚfig
::
	$CHNACÚfig
()

20 : 
	`m_bEÇbË
(
çl£
)

21 , 
	$m_iP”iod
(0)

24 
	}
}

26 
	gCHNACÚfig
::~
	$CHNACÚfig
()

29 
	}
}

31 
boŞ
 
CHNACÚfig
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

33 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_HNA_ENABLE
, 
m_bEÇbË
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

34 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_HNA_PERIOD
, 
m_iP”iod
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

36  
Œue
;

37 
	}
}

39 
boŞ
 
	gCHNACÚfig
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

41 
m_bEÇbË
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_HNA_ENABLE
);

42 
m_iP”iod
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_HNA_PERIOD
);

44  
Œue
;

45 
	}
}

47 
	gCHNACÚfig
::
	$Dump
()

49 
XMLT»e
 
Œ“
;

50 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
(
XML_NETWORK_ELEMENT_HNA_CONFIG
);

51 
this
->
	`S”Ÿlize
(
roÙ
);

52 
¡d
::
¡ršg
 
sOut
;

53 
SYSUTILS_SPACE
::
	`SaveXMLT»eBufãr
(
sOut
, 
Œ“
);

54 
	`´štf
("%s\n", 
sOut
.
	`c_¡r
());

56 
	}
}

59 
	gCHNACÚfigMªag”
::
	$CHNACÚfigMªag”
()

62 
	}
}

64 
CHNACÚfigMªag”
::~
	$CHNACÚfigMªag”
()

67 
	}
}

69 
boŞ
 
CHNACÚfigMªag”
::
	$G‘HNACÚfig
(cÚ¡ * 
sfeP©h
, 
CHNACÚfig
 *
pS”v”CÚfigD©a
)

71 ià(
sfeP©h
 =ğ
NULL
 || 
pS”v”CÚfigD©a
 == NULL)

73  
çl£
;

75 
XMLT»e
 
Œ“
;

76 
SYSUTILS_SPACE
::
	`LßdXMLT»e
(
sfeP©h
, 
Œ“
);

77 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

78  
pS”v”CÚfigD©a
->
	`Un£rŸlize
(
roÙ
);

79 
	}
}

81 
boŞ
 
	gCHNACÚfigMªag”
::
	$G‘HNACÚfigXML
(cÚ¡ * 
sfeP©h
, 
¡d
::
¡ršg
& 
xmlSŒšg
 )

83 ià(
sfeP©h
 =ğ
NULL
)

85  
çl£
;

87 
CHNACÚfig
 
cÚfig
;

88 ià(!
	`G‘HNACÚfig
(
sfeP©h
, &
cÚfig
))

90  
çl£
;

92 
xmlSŒšg
 = "";

93 
	`DumpToBufãr
(&
cÚfig
, 
xmlSŒšg
);

95  
Œue
;

96 
	}
}

98 
boŞ
 
	gCHNACÚfigMªag”
::
	$S‘HNACÚfig
(cÚ¡ * 
sfeP©h
, cÚ¡ 
CHNACÚfig
 *
pS”v”CÚfigD©a
)

100 ià(
sfeP©h
 =ğ
NULL
 )

102  
çl£
;

105 
XMLT»e
 
Œ“
;

106 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
(
XML_NETWORK_ELEMENT_HNA_CONFIG
);

107 
pS”v”CÚfigD©a
->
	`S”Ÿlize
(
roÙ
);

108 
SYSUTILS_SPACE
::
	`SaveXMLT»e
(
sfeP©h
, 
Œ“
);

110  
Œue
;

111 
	}
}

113 
	gCHNACÚfigMªag”
::
	$DumpToBufãr
(
CHNACÚfig
 *
pS”v”CÚfigD©a
, 
¡d
::
¡ršg
 &
sOut
)

115 
XMLT»e
 
Œ“
;

116 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
(
XML_NETWORK_ELEMENT_HNA_CONFIG
);

117 
pS”v”CÚfigD©a
->
	`S”Ÿlize
(
roÙ
);

118 
SYSUTILS_SPACE
::
	`SaveXMLT»eBufãr
(
sOut
, 
Œ“
);

119 
	}
}

121 
	gCHNACÚfigMªag”
::
	$Dump
(
CHNACÚfig
 *
pS”v”CÚfigD©a
)

123 
XMLT»e
 
Œ“
;

124 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
(
XML_NETWORK_ELEMENT_HNA_CONFIG
);

125 
pS”v”CÚfigD©a
->
	`S”Ÿlize
(
roÙ
);

126 
¡d
::
¡ršg
 
sOut
;

127 
SYSUTILS_SPACE
::
	`SaveXMLT»eBufãr
(
sOut
, 
Œ“
);

128 
	`DEBUG_TRACE
("%s\n", 
sOut
.
	`c_¡r
());

129 
	}
}

	@../../titanutils/serverConfig/HNAConfig.h

1 #iâdeà
__HNA_CONFIG__


2 
	#__HNA_CONFIG__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"sûw/xml_–em’t.h
"

6 
	~"sûw/xml_Œ“.h
"

10 şas 
	cCHNACÚfig


12 
	mpublic
:

13 
CHNACÚfig
();

14 
	mvœtu®
 ~
CHNACÚfig
();

15 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

17 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

18 
vœtu®
 
	`Dump
();

20 
boŞ
 
m_bEÇbË
;

21 
ušt32_t
 
m_iP”iod
;

23 
´iv©e
:

24 
	`CHNACÚfig
(cÚ¡ 
CHNACÚfig
&);

25 
CHNACÚfig
 &
İ”©Ü
=(const CHNAConfig&);

28 şas 
	cCHNACÚfigMªag”


30 
public
:

31 
	`CHNACÚfigMªag”
();

32 ~
	`CHNACÚfigMªag”
();

33 
boŞ
 
	`G‘HNACÚfig
(cÚ¡ * 
sfeP©h
, 
CHNACÚfig
 *
pS”v”CÚfigD©a
);

34 
boŞ
 
	`G‘HNACÚfigXML
(cÚ¡ * 
sfeP©h
, 
¡d
::
¡ršg
& 
xmlSŒšg
 );

35 
boŞ
 
	`S‘HNACÚfig
(cÚ¡ * 
sfeP©h
, cÚ¡ 
CHNACÚfig
 *
pS”v”CÚfigD©a
);

37 
	`DumpToBufãr
(
CHNACÚfig
 *
pS”v”CÚfigD©a
, 
¡d
::
¡ršg
 &
out
);

38 
	`Dump
(
CHNACÚfig
 *
pS”v”CÚfigD©a
);

39 
´Ùeùed
:

41 
´iv©e
:

42 
	`CHNACÚfigMªag”
(cÚ¡ 
CHNACÚfigMªag”
&);

43 
CHNACÚfigMªag”
 &
İ”©Ü
=(const CHNAConfigManager&);

	@../../titanutils/serverConfig/MSConfigFile.cpp

1 
	~"MSCÚfigFe.h
"

3 
	~"commÚ/ut™y.h
"

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
	g¡CÚfigBa£I‹m
::
	$¡CÚfigBa£I‹m
()

8 : 
	`uÎID
(
	`UINT64_C
(0))

9 , 
	`iOrd”
(
	`UINT32_C
(0))

10 , 
	`iAcûssTy³
(
	`UINT32_C
(0))

11 , 
	`bDeçuÉD©aTy³
(
	`UINT8_C
(0))

12 , 
	`sName
()

13 , 
	$sInfo
()

15 
	}
}

16 
boŞ
 
	g¡CÚfigBa£I‹m
::
	$S”Ÿlize
(
XMLEËm’t
& 
roÙ
) const

18  
	`Ba£I‹mC»©”
(
roÙ
, *
this
);

19 
	}
}

20 
boŞ
 
	g¡CÚfigBa£I‹m
::
	$Un£rŸlize
(
XMLEËm’t
& 
roÙ
)

22  
	`Ba£I‹mP¬£r
(
roÙ
, *
this
);

23 
	}
}

25 
boŞ
 
	$Ba£I‹mP¬£r
(
XMLEËm’t
& 
–em’t
, 
¡CÚfigBa£I‹m
& 
ba£I‹m
)

27 
ba£I‹m
.
uÎID
 = 
–em’t
.
	`G‘Chd
(
XML_BASIC_ELEMENT_ID
);

28 
ba£I‹m
.
iOrd”
 = 
–em’t
.
	`G‘Chd
(
XML_BASIC_ELEMENT_ORDER
);

29 
ba£I‹m
.
iAcûssTy³
 = 
–em’t
.
	`G‘Chd
(
XML_BASIC_ELEMENT_ACCESS_TYPE
);

30 
ba£I‹m
.
bDeçuÉD©aTy³
 = 
–em’t
.
	`G‘Chd
(
XML_BASIC_ELEMENT_DEFAULT_DATA_TYPE
);

31 
ba£I‹m
.
sName
 = 
–em’t
.
	`G‘Chd
(
XML_BASIC_ELEMENT_NAME
).
	`G‘CÚ‹Á
();

32 
ba£I‹m
.
sInfo
 = 
–em’t
.
	`G‘Chd
(
XML_BASIC_ELEMENT_INFO
).
	`G‘CÚ‹Á
();

34  
Œue
;

35 
	}
}

37 
boŞ
 
	$Ba£I‹mC»©”
(
XMLEËm’t
& 
–em’t
, cÚ¡ 
¡CÚfigBa£I‹m
& 
ba£I‹m
)

39 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_BASIC_ELEMENT_ID
, 
ba£I‹m
.
uÎID
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

40 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_BASIC_ELEMENT_ORDER
, 
ba£I‹m
.
iOrd”
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

41 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_BASIC_ELEMENT_ACCESS_TYPE
, 
ba£I‹m
.
iAcûssTy³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

42 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_BASIC_ELEMENT_DEFAULT_DATA_TYPE
, 
ba£I‹m
.
bDeçuÉD©aTy³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

43 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_BASIC_ELEMENT_NAME
, 
ba£I‹m
.
sName
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

44 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_BASIC_ELEMENT_INFO
, 
ba£I‹m
.
sInfo
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

46  
Œue
;

47 
	}
}

	@../../titanutils/serverConfig/MSConfigFile.h

1 #iâdeà
__MS_CONFIG_FILE_BASE__


2 
	#__MS_CONFIG_FILE_BASE__


	)

4 
	~"commÚ/¡dšt.h
"

6 
	~"sûw/xml_–em’t.h
"

8 
	~"MSXmlTagDef.h
"

12 
	#DEFAULT_GUEST_ROLE_ID
 
	`UINT64_C
(9007199254740996)

13 
	#DEFAULT_FAILOVER_GROUP_ID
 
	`UINT32_C
(1)

14 
	#DEFAULT_FAILOVER_GROUP_NAME
 "Default Failover Group"

15 

	)

16 
	eSCHEDULE_TYPE


18 
	mSCHEDULE_TYPE_DAILY
 = 0,

19 
	mSCHEDULE_TYPE_WEEKLY
,

20 
	mSCHEDULE_TYPE_MONTHLY
,

21 
	mSCHEDULE_TYPE_YEARLY
,

22 
	mSCHEDULE_TYPE_SPECIFICDAY
,

27 
	s¡CÚfigBa£I‹m


29 
ušt64_t
 
	muÎID
;

30 
ušt32_t
 
	miOrd”
;

31 
ušt32_t
 
	miAcûssTy³
;

32 
ušt8_t
 
	mbDeçuÉD©aTy³
;

33 
	m¡d
::
¡ršg
 
sName
;

34 
	m¡d
::
¡ršg
 
sInfo
;

36 
Assign
(cÚ¡ 
¡CÚfigBa£I‹m
& 
™em
)

38 
	muÎID
 = 
™em
.
uÎID
;

39 
	miOrd”
 = 
™em
.
iOrd”
;

40 
	miAcûssTy³
 = 
™em
.
iAcûssTy³
;

41 
	mbDeçuÉD©aTy³
 = 
™em
.
bDeçuÉD©aTy³
;

42 
	msName
 = 
™em
.
sName
;

43 
	msInfo
 = 
™em
.
sInfo
;

46 
¡CÚfigBa£I‹m
();

47 
boŞ
 
S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

48 
boŞ
 
Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

51 
	s¡A‰ribu‹dScheduËI‹m


53 
ušt64_t
 
	muÎScheduËID
;

54 
ušt32_t
 
	miA‰ribu‹
;

57 
boŞ
 
Ba£I‹mP¬£r
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
–em’t
, 
¡CÚfigBa£I‹m
& 
ba£I‹m
);

58 
boŞ
 
Ba£I‹mC»©”
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
–em’t
, cÚ¡ 
¡CÚfigBa£I‹m
& 
ba£I‹m
);

	@../../titanutils/serverConfig/MSXmlTagDef.h

1 #iâdeà
_MS_XML_TAG_DEF_H_


2 
	#_MS_XML_TAG_DEF_H_


	)

5 
	#XML_BASIC_ELEMENT_ID
 "ID"

	)

6 
	#XML_BASIC_ELEMENT_ORDER
 "Üd”"

	)

7 
	#XML_BASIC_ELEMENT_ACCESS_TYPE
 "acûssTy³"

	)

8 
	#XML_BASIC_ELEMENT_DEFAULT_DATA_TYPE
 "deçuÉD©aTy³"

	)

9 
	#XML_BASIC_ELEMENT_NAME
 "Çme"

	)

10 
	#XML_BASIC_ELEMENT_INFO
 "šfo"

	)

12 
	#XML_SHARE_ELEMENT_ENABLE
 "’abË"

	)

13 
	#XML_SHARE_ELEMENT_ROLEID
 "rŞeID"

	)

14 
	#XML_SHARE_ELEMENT_ISLOGONSCHEDULE
 "isLogOnScheduË"

	)

15 
	#XML_SHARE_ELEMENT_LOGONSCHEDULE
 "logÚScheduËs"

	)

16 
	#XML_SHARE_ELEMENT_ID
 "ID"

	)

17 
	#XML_SHARE_ELEMENT_SCHEDULE
 "scheduË"

	)

18 
	#XML_SHARE_ELEMENT_TYPE
 "ty³"

	)

19 
	#XML_SHARE_ELEMENT_PW
 "·sswÜd"

	)

21 
	#XML_SHARE_ATTRIBUTE_SCHEDULEID
 "scheduËID"

	)

22 
	#XML_SHARE_ATTRIBUTE_ATTRIBUTE
 "©Œibu‹"

	)

23 
	#XML_SHARE_ATTRIBUTE_ID
 "ID"

	)

24 
	#XML_SHARE_ATTRIBUTE_ITEM
 "™em"

	)

26 
	#XML_USER_ROOT_NAME
 "U£rInfo"

	)

27 
	#XML_USER_ELEMENT_SAMEASUSERGROUP
 "isSameAsU£rGroup"

	)

28 
	#XML_USER_ELEMENT_WHICHGROUP
 "whichU£rGroup"

	)

30 
	#XML_GROUP_ROOT_NAME
 "GroupInfo"

	)

31 
	#XML_GROUP_ELEMENT_USERIDLIST
 "u£rIDLi¡"

	)

33 
	#XML_ROLE_ROOT_NAME
 "RŞeInfo"

	)

34 
	#XML_ROLE_ELEMENT_AUTOCONNECTMATRIXSERVER
 "isAutoCÚÃùM©rixS”v”"

	)

35 
	#XML_ROLE_ELEMENT_DEFAULTVIEWPROFILEID
 "deçuÉV›wProfeID"

	)

36 
	#XML_ROLE_ELEMENT_PRIORITY_PTZ
 "´iÜ™yPTZ"

	)

37 
	#XML_ROLE_ELEMENT_PRIORITY_TALK
 "´iÜ™yT®k"

	)

38 
	#XML_ROLE_ELEMENT_PRIORITY_VIEW
 "´iÜ™yV›w"

	)

39 
	#XML_ROLE_ELEMENT_PRIORITY_MATRIX
 "´iÜ™yM©rix"

	)

40 
	#XML_ROLE_ELEMENT_PLAYBACK_TIME_LIMIT
 "¶aybackTimeLim™"

	)

41 
	#XML_ROLE_ELEMENT_GENERAL_ACCESS_BITSTREAM
 "g’”®I‹mAcûssB™SŒ—m"

	)

42 
	#XML_ROLE_ELEMENT_DEFAULT_ACCESS_BITSTREAM
 "deçuÉAcûssB™SŒ—m"

	)

43 
	#XML_ROLE_ELEMENT_DEVICE
 "deviû"

	)

44 
	#XML_ROLE_ATTRIBUTE_TYPE
 "ty³"

	)

45 
	#XML_ROLE_ATTRIBUTE_BITS
 "b™s"

	)

46 
	#XML_ROLE_ELEMENT_RECORDING_SERVER
 "RecÜdšgS”v”"

	)

48 
	#XML_SCHEDULE_ROOT_NAME
 "ScheduËInfo"

	)

49 
	#XML_SCHEDULE_ELEMENT_DAY
 "day"

	)

50 
	#XML_SCHEDULE_ELEMENT_NEXT
 "Ãxt"

	)

51 
	#XML_SCHEDULE_ELEMENT_MON
 "mÚ"

	)

52 
	#XML_SCHEDULE_ELEMENT_TUE
 "tue"

	)

53 
	#XML_SCHEDULE_ELEMENT_WED
 "wed"

	)

54 
	#XML_SCHEDULE_ELEMENT_THU
 "thu"

	)

55 
	#XML_SCHEDULE_ELEMENT_FRI
 "äi"

	)

56 
	#XML_SCHEDULE_ELEMENT_SAT
 "§t"

	)

57 
	#XML_SCHEDULE_ELEMENT_SUN
 "sun"

	)

58 
	#XML_SCHEDULE_ELEMENT_SLICE
 "¦iû"

	)

59 
	#XML_SCHEDULE_ELEMENT_WHICH_DAYINMONTH
 "whichDayInMÚth"

	)

60 
	#XML_SCHEDULE_ELEMENT_WHICH_WEEK
 "whichW“k"

	)

61 
	#XML_SCHEDULE_ELEMENT_FINAL_WEEK
 "fš®W“k"

	)

62 
	#XML_SCHEDULE_ELEMENT_WHICH_DAY
 "whichDay"

	)

63 
	#XML_SCHEDULE_ELEMENT_WHICH_MONTH
 "whichMÚth"

	)

64 
	#XML_SCHEDULE_ELEMENT_DATE
 "d©e"

	)

66 
	#XML_PRIVILEGE_ELEMENT_TYPE
 "PrivegeTy³"

	)

67 
	#XML_PRIVILEGE_ELEMENT_ID
 "id"

	)

68 
	#XML_PRIVILEGE_ELEMENT_CODE_LIST
 "PrivegeCodeLi¡"

	)

69 
	#XML_PRIVILEGE_ELEMENT_CODE
 "PrivegeCode"

	)

70 
	#XML_PRIVILEGE_ELEMENT_DEFAULT_VALUE
 "DeçuÉPrivegeV®ue"

	)

72 
	#XML_ASSOCIATE_LIST
 "Cam”aAssocŸ‹S”v”Li¡"

	)

73 
	#XML_ASSOCIATE_ITEM
 "™em"

	)

74 
	#XML_ASSOCIATE_SERVER_ID
 "£rv”Id"

	)

75 
	#XML_ASSOCIATE_CAM_LIST
 "ÿm”aLi¡"

	)

76 
	#XML_ASSOCIATE_CAM_ID
 "ÿm”aId"

	)

77 
	#XML_ASSOCIATE_DIGITAL_INPUT
 "dig™®IÅut"

	)

78 
	#XML_ASSOCIATE_OUTPUT_RELAY
 "ouutR–ay"

	)

79 
	#XML_ASSOCIATE_MICROPHONE
 "miüİhÚe"

	)

80 
	#XML_ASSOCIATE_SPEAKER
 "¥—k”"

	)

81 
	#XML_ASSOCIATE_PTZ_MOTOR
 "±zMÙÜ"

	)

82 
	#XML_ASSOCIATE_METADATA_NODE
 "m‘ad©aNode"

	)

83 
	#XML_ASSOCIATE_ID
 "id"

	)

84 
	#XML_ASSOCIATE_SERVER
 "£rv”"

	)

85 
	#XML_ASSOCIATE_DEVICE
 "deviû"

	)

	@../../titanutils/serverConfig/MsUserDataItem.cpp

1 
	~"commÚ/ut™y.h
"

3 
	~"MsU£rD©aI‹m.h
"

4 
	~"MSXmlTagDef.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
	g¡U£rD©a
::
	$¡U£rD©a
()

10 : 
	`ba£I‹m
()

11 , 
	`bU£rEÇbË
(
çl£
)

12 , 
	`sEnüy±edPw
()

13 , 
	`bSameAsU£rGroupD©a
(
çl£
)

14 , 
	`uÎWhichGroup
(
	`UINT64_C
(0))

15 , 
	`bU£rLogOnScheduËr
(
çl£
)

16 , 
	`vScheduËrI‹m
()

17 , 
	`uÎRŞeID
(
	$UINT64_C
(0))

19 
	}
}

21 
boŞ
 
	g¡U£rD©a
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

23 
XMLEËm’t
 
chd_–em’t
, 
g¿nd_chd_–em’t
;

25 
	`IF_FALSE_RETURN_VALUE
(
ba£I‹m
.
	`S”Ÿlize
(
–em’t
), 
çl£
);

27 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_PW
, 
sEnüy±edPw
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

28 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_ENABLE
, 
bU£rEÇbË
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

29 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_ROLEID
, 
uÎRŞeID
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

30 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_USER_ELEMENT_SAMEASUSERGROUP
, 
bSameAsU£rGroupD©a
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

31 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_USER_ELEMENT_WHICHGROUP
, 
uÎWhichGroup
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

32 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_ISLOGONSCHEDULE
, 
bU£rLogOnScheduËr
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

34 ià(
bU£rLogOnScheduËr
)

36 
chd_–em’t
 = 
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_LOGONSCHEDULE
);

37 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

39 
ušt32_t
 
i
 = 0; i < 
vScheduËrI‹m
.
	`size
(); i++)

41 
g¿nd_chd_–em’t
 = 
chd_–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_SCHEDULE
);

42 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

44 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
.
	`AddA‰ribu‹
(
XML_SHARE_ATTRIBUTE_SCHEDULEID
, 
vScheduËrI‹m
[
i
].
uÎScheduËID
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

45 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
.
	`AddA‰ribu‹
(
XML_SHARE_ATTRIBUTE_ATTRIBUTE
, 
vScheduËrI‹m
[
i
].
iA‰ribu‹
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

49  
Œue
;

50 
	}
}

52 
boŞ
 
	g¡U£rD©a
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

54 
ba£I‹m
.
	`Un£rŸlize
(
–em’t
);

56 
XMLEËm’t
 
chd_–em’t
, 
g¿nd_chd_–em’t
;

58 
sEnüy±edPw
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_PW
).
	`G‘CÚ‹Á
();

59 
bU£rEÇbË
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_ENABLE
);

60 
uÎRŞeID
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_ROLEID
);

61 
bSameAsU£rGroupD©a
 = 
–em’t
.
	`G‘Chd
(
XML_USER_ELEMENT_SAMEASUSERGROUP
);

62 
uÎWhichGroup
 = 
–em’t
.
	`G‘Chd
(
XML_USER_ELEMENT_WHICHGROUP
);

63 
bU£rLogOnScheduËr
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_ISLOGONSCHEDULE
);

65 ià(
bU£rLogOnScheduËr
)

67 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_LOGONSCHEDULE
);

68 
ušt32_t
 
i
 = 0; i < 
chd_–em’t
.
	`G‘ChdCouÁ
(); i++)

70 
¡A‰ribu‹dScheduËI‹m
 
™em
;

71 
g¿nd_chd_–em’t
 = 
chd_–em’t
.
	`G‘Chd
(
i
);

73 
™em
.
uÎScheduËID
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_SHARE_ATTRIBUTE_SCHEDULEID
);

74 
™em
.
iA‰ribu‹
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_SHARE_ATTRIBUTE_ATTRIBUTE
);

75 
vScheduËrI‹m
.
	`push_back
(
™em
);

79  
Œue
;

80 
	}
}

83 
	g¡GroupD©a
::
	$¡GroupD©a
()

84 : 
	`ba£I‹m
()

85 , 
	`bGroupEÇbË
(
çl£
)

86 , 
	`bGroupLogOnScheduËr
(
çl£
)

87 , 
	`vScheduËrI‹m
()

88 , 
	`vGroupU£rLi¡
()

89 , 
	`uÎRŞeID
(
	$UINT64_C
(0))

91 
	}
}

93 
boŞ
 
	g¡GroupD©a
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

95 
XMLEËm’t
 
chd_–em’t
, 
g¿nd_chd_–em’t
;

97 
	`IF_FALSE_RETURN_VALUE
(
ba£I‹m
.
	`S”Ÿlize
(
–em’t
), 
çl£
);

99 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_ENABLE
, 
bGroupEÇbË
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

100 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_ROLEID
, 
uÎRŞeID
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

101 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_ISLOGONSCHEDULE
, 
bGroupLogOnScheduËr
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

103 ià(
bGroupLogOnScheduËr
)

105 
chd_–em’t
 = 
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_LOGONSCHEDULE
);

106 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

107 
ušt32_t
 
i
 = 0; i < 
vScheduËrI‹m
.
	`size
(); i++)

109 
g¿nd_chd_–em’t
 = 
chd_–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_SCHEDULE
);

110 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

112 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
.
	`AddA‰ribu‹
(
XML_SHARE_ATTRIBUTE_SCHEDULEID
, 
vScheduËrI‹m
[
i
].
uÎScheduËID
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

113 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
.
	`AddA‰ribu‹
(
XML_SHARE_ATTRIBUTE_ATTRIBUTE
, 
vScheduËrI‹m
[
i
].
iA‰ribu‹
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

117 
chd_–em’t
 = 
–em’t
.
	`AddChd
(
XML_GROUP_ELEMENT_USERIDLIST
);

118 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

119 
ušt32_t
 
i
 = 0; i < 
vGroupU£rLi¡
.
	`size
(); i++)

121 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_ID
, 
vGroupU£rLi¡
[
i
]), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

124  
Œue
;

125 
	}
}

127 
boŞ
 
	g¡GroupD©a
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

129 
XMLEËm’t
 
chd_–em’t
, 
g¿nd_chd_–em’t
;

131 
ba£I‹m
.
	`Un£rŸlize
(
–em’t
);

133 
bGroupEÇbË
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_ENABLE
);

134 
uÎRŞeID
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_ROLEID
);

135 
bGroupLogOnScheduËr
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_ISLOGONSCHEDULE
);

137 ià(
bGroupLogOnScheduËr
)

139 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_LOGONSCHEDULE
);

140 
ušt32_t
 
i
 = 0; i < 
chd_–em’t
.
	`G‘ChdCouÁ
(); i++)

142 
¡A‰ribu‹dScheduËI‹m
 
™em
;

143 
g¿nd_chd_–em’t
 = 
chd_–em’t
.
	`G‘Chd
(
i
);

145 
™em
.
uÎScheduËID
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_SHARE_ATTRIBUTE_SCHEDULEID
);

146 
™em
.
iA‰ribu‹
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_SHARE_ATTRIBUTE_ATTRIBUTE
);

147 
vScheduËrI‹m
.
	`push_back
(
™em
);

151 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
XML_GROUP_ELEMENT_USERIDLIST
);

152 
ušt32_t
 
i
 = 0; i < 
chd_–em’t
.
	`G‘ChdCouÁ
(); i++)

154 
g¿nd_chd_–em’t
 = 
chd_–em’t
.
	`G‘Chd
(
i
);

156 
ušt64_t
 
u£rID
 = 
g¿nd_chd_–em’t
;

157 
vGroupU£rLi¡
.
	`push_back
(
u£rID
);

160  
Œue
;

161 
	}
}

164 
	g¡RŞeD©a
::
	$¡RŞeD©a
()

165 : 
	`ba£I‹m
()

166 , 
	`bAutoCÚÃùM©rixS”v”
(
çl£
)

167 , 
	`uÎDeçuÉV›wProfeId
(
	`UINT64_C
(0))

168 , 
	`iPriÜ™yPTZ
(
	`UINT32_C
(0))

169 , 
	`iPriÜ™yT®k
(
	`UINT32_C
(0))

170 , 
	`iPriÜ™yV›w
(
	`UINT32_C
(0))

171 , 
	`iPriÜ™yM©rix
(
	`UINT32_C
(0))

172 , 
	`uÎPÏybackTimeLim™
(
	`UINT64_C
(0))

173 , 
	`sG’”®I‹mAcûssB™SŒ—m
()

174 , 
	`vDeçuÉInfo
()

175 , 
	$vS”v”Info
()

177 
	}
}

179 
boŞ
 
	g¡RŞeD©a
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

181 
XMLEËm’t
 
chd_–em’t
, 
g¿nd_chd_–em’t
;

183 
	`IF_FALSE_RETURN_VALUE
(
ba£I‹m
.
	`S”Ÿlize
(
–em’t
), 
çl£
);

185 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_AUTOCONNECTMATRIXSERVER
, 
bAutoCÚÃùM©rixS”v”
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

186 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_DEFAULTVIEWPROFILEID
, 
uÎDeçuÉV›wProfeId
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

187 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_PRIORITY_PTZ
, 
iPriÜ™yPTZ
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

188 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_PRIORITY_TALK
, 
iPriÜ™yT®k
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

189 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_PRIORITY_VIEW
, 
iPriÜ™yV›w
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

190 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_PRIORITY_MATRIX
, 
iPriÜ™yM©rix
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

191 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_PLAYBACK_TIME_LIMIT
, 
uÎPÏybackTimeLim™
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

193 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_GENERAL_ACCESS_BITSTREAM
, 
sG’”®I‹mAcûssB™SŒ—m
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

195 
chd_–em’t
 = 
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_DEFAULT_ACCESS_BITSTREAM
);

196 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

197 
ušt32_t
 
i
 = 0; i < 
vDeçuÉInfo
.
	`size
(); i++)

199 
g¿nd_chd_–em’t
 = 
chd_–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_DEVICE
);

200 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

202 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
.
	`AddA‰ribu‹
(
XML_ROLE_ATTRIBUTE_TYPE
, 
vDeçuÉInfo
[
i
].
usTy³
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

203 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
.
	`AddA‰ribu‹
(
XML_ROLE_ATTRIBUTE_BITS
, 
vDeçuÉInfo
[
i
].
sDevPrivegeV®
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

206 
ušt32_t
 
i
 = 0; i < 
vS”v”Info
.
	`size
(); i++)

208 
chd_–em’t
 = 
–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_RECORDING_SERVER
);

209 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

210 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
.
	`AddA‰ribu‹
(
XML_SHARE_ATTRIBUTE_ID
, 
vS”v”Info
[
i
].
uÎS”v”Id
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

211 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
.
	`AddA‰ribu‹
(
XML_ROLE_ATTRIBUTE_TYPE
, 
vS”v”Info
[
i
].
usTy³
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

212 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
.
	`AddA‰ribu‹
(
XML_ROLE_ATTRIBUTE_BITS
, 
vS”v”Info
[
i
].
sB™s
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

214 
ušt32_t
 
j
 = 0; j < 
vS”v”Info
[
i
].
vDevPrivegeD©a
.
	`size
(); j++)

216 
g¿nd_chd_–em’t
 = 
chd_–em’t
.
	`AddChd
(
XML_ROLE_ELEMENT_DEVICE
);

217 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

219 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
.
	`AddA‰ribu‹
(
XML_SHARE_ATTRIBUTE_ID
, 
vS”v”Info
[
i
].
vDevPrivegeD©a
[
j
].
uÎDevId
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

220 
	`IF_EQUAL_RETURN_VALUE
(
g¿nd_chd_–em’t
.
	`AddA‰ribu‹
(
XML_ROLE_ATTRIBUTE_BITS
, 
vS”v”Info
[
i
].
vDevPrivegeD©a
[
j
].
sDevPrivegeV®
), 
XMLA‰ribu‹
::
em±y_©Œibu‹
, 
çl£
);

224  
Œue
;

225 
	}
}

227 
boŞ
 
	g¡RŞeD©a
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

229 
XMLEËm’t
 
chd_–em’t
, 
g¿nd_chd_–em’t
;

230 
¡d
::
veùÜ
<
XMLEËm’t
> 
bÙtom_–em’t
;

232 
ba£I‹m
.
	`Un£rŸlize
(
–em’t
);

234 
bAutoCÚÃùM©rixS”v”
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_AUTOCONNECTMATRIXSERVER
);

235 
uÎDeçuÉV›wProfeId
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_DEFAULTVIEWPROFILEID
);

236 
iPriÜ™yPTZ
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_PRIORITY_PTZ
);

237 
iPriÜ™yT®k
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_PRIORITY_TALK
);

238 
iPriÜ™yV›w
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_PRIORITY_VIEW
);

239 
iPriÜ™yM©rix
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_PRIORITY_MATRIX
);

240 
uÎPÏybackTimeLim™
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_PLAYBACK_TIME_LIMIT
);

241 
sG’”®I‹mAcûssB™SŒ—m
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_GENERAL_ACCESS_BITSTREAM
).
	`G‘CÚ‹Á
();

243 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
XML_ROLE_ELEMENT_DEFAULT_ACCESS_BITSTREAM
);

244 
ušt32_t
 
i
 = 0; i < 
chd_–em’t
.
	`G‘ChdCouÁ
(); i++)

246 
¡DeçuÉDevAcûssB™SŒ—m
 
deçuÉDevAcûssB™SŒ—m
;

247 
g¿nd_chd_–em’t
ğ
chd_–em’t
.
	`G‘Chd
(
i
);

249 
deçuÉDevAcûssB™SŒ—m
.
usTy³
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_ROLE_ATTRIBUTE_TYPE
);

250 
deçuÉDevAcûssB™SŒ—m
.
sDevPrivegeV®
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_ROLE_ATTRIBUTE_BITS
).
	`G‘V®ue
();

252 
vDeçuÉInfo
.
	`push_back
(
deçuÉDevAcûssB™SŒ—m
);

255 
bÙtom_–em’t
 = 
–em’t
.
	`G‘Chd»n
(
XML_ROLE_ELEMENT_RECORDING_SERVER
);

256 
ušt32_t
 
i
 = 0; i < 
bÙtom_–em’t
.
	`size
(); i++)

258 
¡S”v”InRŞe
 
£rv”Info
;

259 
£rv”Info
.
uÎS”v”Id
 = 
bÙtom_–em’t
[
i
].
	`G‘A‰ribu‹
(
XML_SHARE_ATTRIBUTE_ID
);

260 
£rv”Info
.
usTy³
 = 
bÙtom_–em’t
[
i
].
	`G‘A‰ribu‹
(
XML_ROLE_ATTRIBUTE_TYPE
);

261 
£rv”Info
.
sB™s
 = 
bÙtom_–em’t
[
i
].
	`G‘A‰ribu‹
(
XML_ROLE_ATTRIBUTE_BITS
).
	`G‘V®ue
();

263 
ušt32_t
 
j
 = 0; j < 
bÙtom_–em’t
[
i
].
	`G‘ChdCouÁ
(); j++)

265 
¡DevPrivege
 
devPrivege
;

266 
g¿nd_chd_–em’t
 = 
bÙtom_–em’t
[
i
].
	`G‘Chd
(
j
);

268 
devPrivege
.
uÎDevId
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_SHARE_ATTRIBUTE_ID
);

269 
devPrivege
.
sDevPrivegeV®
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_ROLE_ATTRIBUTE_BITS
).
	`G‘V®ue
();

271 
£rv”Info
.
vDevPrivegeD©a
.
	`push_back
(
devPrivege
);

274 
vS”v”Info
.
	`push_back
(
£rv”Info
);

277  
Œue
;

278 
	}
}

280 
boŞ
 
	g¡AcûssRight
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

282 
XMLEËm’t
 
chd_–em’t
, 
g¿nd_chd_–em’t
;

284 
ty³
 = 
–em’t
.
	`G‘A‰ribu‹
(
XML_PRIVILEGE_ELEMENT_ID
);

285 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
XML_PRIVILEGE_ELEMENT_CODE_LIST
);

286 
deçuÉB™s
 = 
–em’t
.
	`G‘Chd
(
XML_PRIVILEGE_ELEMENT_DEFAULT_VALUE
).
	`G‘CÚ‹Á
();

287 
ušt32_t
 
i
 = 0; i < 
chd_–em’t
.
	`G‘ChdCouÁ
(); i++)

289 
g¿nd_chd_–em’t
 = 
chd_–em’t
.
	`G‘Chd
(
i
);

290 
ušt32_t
 
b™s
 = 
g¿nd_chd_–em’t
.
	`G‘A‰ribu‹
(
XML_PRIVILEGE_ELEMENT_ID
);

291 
b™Codes
.
	`push_back
(
b™s
);

293  
Œue
;

294 
	}
}

297 
boŞ
 
S‘DayInfo
(
XMLEËm’t
& 
–em’t
, cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
day
, cÚ¡ * 
–em’tName
)

299 
XMLEËm’t
 
	gchd_–em’t
 = 
–em’t
.
AddChd
(
–em’tName
);

300 
IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

302 
ušt32_t
 
	gi
 = 0; i < 
	gday
.
size
(); i++)

304 
IF_EQUAL_RETURN_VALUE
(
chd_–em’t
.
AddChd
(
XML_SCHEDULE_ELEMENT_SLICE
, 
day
[
i
]), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

307  
	gŒue
;

310 
boŞ
 
G‘DayInfo
(cÚ¡ 
XMLEËm’t
& 
–em’t
, 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
day
, cÚ¡ * 
–em’tName
)

312 
XMLEËm’t
 
	gchd_–em’t
 = 
–em’t
.
G‘Chd
(
–em’tName
);

314 
ušt32_t
 
	gi
 = 0; i < 
	gchd_–em’t
.
G‘ChdCouÁ
(); i++)

316 
	gday
.
push_back
(
chd_–em’t
.
G‘Chd
(
i
).
G‘CÚ‹Á
());

319  
	gŒue
;

322 
boŞ
 
	gCScheduËBa£
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

324  
ba£I‹m
.
	`S”Ÿlize
(
–em’t
);

325 
	}
}

326 
boŞ
 
	gCScheduËBa£
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

328  
ba£I‹m
.
	`Un£rŸlize
(
–em’t
);

329 
	}
}

331 
boŞ
 
	gCScheduËDay
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

333 
CScheduËBa£
::
	`S”Ÿlize
(
–em’t
);

334 
	`SaveToXmlFe
(
–em’t
);

335  
Œue
;

336 
	}
}

337 
boŞ
 
	gCScheduËDay
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

339 
CScheduËBa£
::
	`Un£rŸlize
(
–em’t
);

340 
	`G‘DayInfo
(
–em’t
, 
vDay
, 
XML_SCHEDULE_ELEMENT_DAY
);

341  
Œue
;

342 
	}
}

344 
boŞ
 
	gCScheduËW“kly
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

346 
CScheduËBa£
::
	`S”Ÿlize
(
–em’t
);

347 
	`SaveToXmlFe
(
–em’t
);

348  
Œue
;

349 
	}
}

350 
boŞ
 
	gCScheduËW“kly
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

352 
CScheduËBa£
::
	`Un£rŸlize
(
–em’t
);

353 
	`G‘DayInfo
(
–em’t
, 
vW“k
[0], 
XML_SCHEDULE_ELEMENT_SUN
);

354 
	`G‘DayInfo
(
–em’t
, 
vW“k
[1], 
XML_SCHEDULE_ELEMENT_MON
);

355 
	`G‘DayInfo
(
–em’t
, 
vW“k
[2], 
XML_SCHEDULE_ELEMENT_TUE
);

356 
	`G‘DayInfo
(
–em’t
, 
vW“k
[3], 
XML_SCHEDULE_ELEMENT_WED
);

357 
	`G‘DayInfo
(
–em’t
, 
vW“k
[4], 
XML_SCHEDULE_ELEMENT_THU
);

358 
	`G‘DayInfo
(
–em’t
, 
vW“k
[5], 
XML_SCHEDULE_ELEMENT_FRI
);

359 
	`G‘DayInfo
(
–em’t
, 
vW“k
[6], 
XML_SCHEDULE_ELEMENT_SAT
);

360  
Œue
;

361 
	}
}

363 
boŞ
 
	gCScheduËMÚthly
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

365 
CScheduËBa£
::
	`S”Ÿlize
(
–em’t
);

366 
	`SaveToXmlFe
(
–em’t
);

367  
Œue
;

368 
	}
}

369 
boŞ
 
	gCScheduËMÚthly
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

371 
¡d
::
¡ršg
 
ty³
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_TYPE
).
	`G‘CÚ‹Á
();

372 
CScheduËBa£
::
	`Un£rŸlize
(
–em’t
);

373 ià(
ty³
.
	`com·»
("Month1") == 0)

375 
bTy³
 = 1;

377 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[0], 
XML_SCHEDULE_ELEMENT_DAY
);

378 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[1], 
XML_SCHEDULE_ELEMENT_NEXT
);

380 
bWhichDayInMÚth
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_WHICH_DAYINMONTH
);

382 ià(
ty³
.
	`com·»
("Month2") == 0)

384 
bTy³
 = 2;

386 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[0], 
XML_SCHEDULE_ELEMENT_DAY
);

387 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[1], 
XML_SCHEDULE_ELEMENT_NEXT
);

389 
bWhichW“k
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_WHICH_WEEK
);

390 
bWhichDay
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_WHICH_DAY
);

391 
bFš®W“k
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_FINAL_WEEK
);

395  
çl£
;

397  
Œue
;

398 
	}
}

400 
boŞ
 
	gCScheduËY—¾y
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

402 
CScheduËBa£
::
	`S”Ÿlize
(
–em’t
);

403 
	`SaveToXmlFe
(
–em’t
);

404  
Œue
;

405 
	}
}

406 
boŞ
 
	gCScheduËY—¾y
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

408 
¡d
::
¡ršg
 
ty³
 = 
–em’t
.
	`G‘Chd
(
XML_SHARE_ELEMENT_TYPE
).
	`G‘CÚ‹Á
();

409 
CScheduËBa£
::
	`Un£rŸlize
(
–em’t
);

410 ià(
ty³
.
	`com·»
("Year1") == 0)

412 
bTy³
 = 1;

414 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[0], 
XML_SCHEDULE_ELEMENT_DAY
);

415 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[1], 
XML_SCHEDULE_ELEMENT_NEXT
);

417 
bWhichMÚth
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_WHICH_MONTH
);

418 
bWhichDayInMÚth
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_WHICH_DAYINMONTH
);

420 ià(
ty³
.
	`com·»
("Year2") == 0)

422 
bTy³
 = 2;

424 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[0], 
XML_SCHEDULE_ELEMENT_DAY
);

425 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[1], 
XML_SCHEDULE_ELEMENT_NEXT
);

427 
bWhichMÚth
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_WHICH_MONTH
);

428 
bWhichW“k
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_WHICH_WEEK
);

429 
bWhichDay
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_WHICH_DAY
);

430 
bFš®W“k
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_FINAL_WEEK
);

434  
çl£
;

436  
Œue
;

437 
	}
}

439 
boŞ
 
	gCScheduËS³cificDays
::
	$S”Ÿlize
(
XMLEËm’t
& 
–em’t
) const

441 
CScheduËBa£
::
	`S”Ÿlize
(
–em’t
);

442 
	`SaveToXmlFe
(
–em’t
);

443  
Œue
;

444 
	}
}

445 
boŞ
 
	gCScheduËS³cificDays
::
	$Un£rŸlize
(
XMLEËm’t
& 
–em’t
)

447 
CScheduËBa£
::
	`Un£rŸlize
(
–em’t
);

449 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[0], 
XML_SCHEDULE_ELEMENT_DAY
);

450 
	`G‘DayInfo
(
–em’t
, 
vDayNext
[1], 
XML_SCHEDULE_ELEMENT_NEXT
);

452 
XMLEËm’t
 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
(
XML_SCHEDULE_ELEMENT_DATE
);

453 
ušt32_t
 
i
 = 0; i < 
chd_–em’t
.
	`G‘ChdCouÁ
(); i++)

455 
vD©eLi¡
.
	`push_back
(
chd_–em’t
.
	`G‘Chd
(
i
));

457  
Œue
;

458 
	}
}

460 
boŞ
 
	gCScheduËDay
::
	$SaveToXmlFe
(
XMLEËm’t
& 
–em’t
) const

462 
¡d
::
¡ršg
 
ty³
 = "Day";

463 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_TYPE
, 
ty³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

464 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vDay
, 
XML_SCHEDULE_ELEMENT_DAY
), 
çl£
);

466  
Œue
;

467 
	}
}

469 
boŞ
 
	gCScheduËW“kly
::
	$SaveToXmlFe
(
XMLEËm’t
& 
–em’t
) const

471 
¡d
::
¡ršg
 
ty³
 = "Week";

472 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_TYPE
, 
ty³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

473 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vW“k
[0], 
XML_SCHEDULE_ELEMENT_SUN
), 
çl£
);

474 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vW“k
[1], 
XML_SCHEDULE_ELEMENT_MON
), 
çl£
);

475 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vW“k
[2], 
XML_SCHEDULE_ELEMENT_TUE
), 
çl£
);

476 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vW“k
[3], 
XML_SCHEDULE_ELEMENT_WED
), 
çl£
);

477 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vW“k
[4], 
XML_SCHEDULE_ELEMENT_THU
), 
çl£
);

478 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vW“k
[5], 
XML_SCHEDULE_ELEMENT_FRI
), 
çl£
);

479 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vW“k
[6], 
XML_SCHEDULE_ELEMENT_SAT
), 
çl£
);

481  
Œue
;

482 
	}
}

484 
boŞ
 
	gCScheduËMÚthly
::
	$SaveToXmlFe
(
XMLEËm’t
& 
–em’t
) const

486 ià(
bTy³
 == 1)

488 
¡d
::
¡ršg
 
ty³
 = "Month1";

489 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_TYPE
, 
ty³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

490 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_WHICH_DAYINMONTH
, 
bWhichDayInMÚth
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

492 ià(
bTy³
 == 2)

494 
¡d
::
¡ršg
 
ty³
 = "Month2";

495 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_TYPE
, 
ty³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

496 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_WHICH_WEEK
, 
bWhichW“k
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

497 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_WHICH_DAY
, 
bWhichDay
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

498 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_FINAL_WEEK
, 
bFš®W“k
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

502  
çl£
;

505 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vDayNext
[0], 
XML_SCHEDULE_ELEMENT_DAY
), 
çl£
);

506 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vDayNext
[1], 
XML_SCHEDULE_ELEMENT_NEXT
), 
çl£
);

508  
Œue
;

509 
	}
}

511 
boŞ
 
	gCScheduËY—¾y
::
	$SaveToXmlFe
(
XMLEËm’t
& 
–em’t
) const

513 ià(
bTy³
 == 1)

515 
¡d
::
¡ršg
 
ty³
 = "Year1";

516 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_TYPE
, 
ty³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

517 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_WHICH_DAYINMONTH
, 
bWhichDayInMÚth
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

519 ià(
bTy³
 == 2)

521 
¡d
::
¡ršg
 
ty³
 = "Year2";

522 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_TYPE
, 
ty³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

523 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_WHICH_WEEK
, 
bWhichW“k
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

524 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_WHICH_DAY
, 
bWhichDay
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

525 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_FINAL_WEEK
, 
bFš®W“k
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

529  
çl£
;

532 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_WHICH_MONTH
, 
bWhichMÚth
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

533 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vDayNext
[0], 
XML_SCHEDULE_ELEMENT_DAY
), 
çl£
);

534 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vDayNext
[1], 
XML_SCHEDULE_ELEMENT_NEXT
), 
çl£
);

536  
Œue
;

537 
	}
}

539 
boŞ
 
	gCScheduËS³cificDays
::
	$SaveToXmlFe
(
XMLEËm’t
& 
–em’t
) const

541 
XMLEËm’t
 
chd_–em’t
;

542 
¡d
::
¡ršg
 
ty³
 = "Specific";

544 
	`IF_EQUAL_RETURN_VALUE
(
–em’t
.
	`AddChd
(
XML_SHARE_ELEMENT_TYPE
, 
ty³
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

546 
chd_–em’t
 = 
–em’t
.
	`AddChd
(
XML_SCHEDULE_ELEMENT_DATE
);

547 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

548 
ušt32_t
 
i
 = 0; i < 
vD©eLi¡
.
	`size
(); i++)

550 
	`IF_EQUAL_RETURN_VALUE
(
chd_–em’t
.
	`AddChd
(
XML_SHARE_ATTRIBUTE_ITEM
, 
vD©eLi¡
[
i
]), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

553 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vDayNext
[0], 
XML_SCHEDULE_ELEMENT_DAY
), 
çl£
);

554 
	`IF_FALSE_RETURN_VALUE
(
	`S‘DayInfo
(
–em’t
, 
vDayNext
[1], 
XML_SCHEDULE_ELEMENT_NEXT
), 
çl£
);

556  
Œue
;

557 
	}
}

	@../../titanutils/serverConfig/MsUserDataItem.h

1 #iâdeà
_MS_USER_DATA_ITEM_H_


2 
	#_MS_USER_DATA_ITEM_H_


	)

4 
	~"MSCÚfigFe.h
"

6 
	s¡AcûssRight


8 
ušt16_t
 
	mty³
;

9 
	m¡d
::
veùÜ
<
ušt32_t
> 
b™Codes
;

10 
	m¡d
::
¡ršg
 
deçuÉB™s
;

11 
boŞ
 
Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

15 
	s¡GroupD©a


17 
¡CÚfigBa£I‹m
 
	mba£I‹m
;

18 
boŞ
 
	mbGroupEÇbË
;

19 
boŞ
 
	mbGroupLogOnScheduËr
;

20 
	m¡d
::
veùÜ
<
¡A‰ribu‹dScheduËI‹m
> 
vScheduËrI‹m
;

21 
	m¡d
::
veùÜ
<
ušt64_t
> 
vGroupU£rLi¡
;

22 
ušt64_t
 
	muÎRŞeID
;

24 
¡GroupD©a
();

25 
boŞ
 
S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

26 
boŞ
 
Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

30 
	s¡DeçuÉDevAcûssB™SŒ—m


32 
ušt16_t
 
	musTy³
;

33 
	m¡d
::
¡ršg
 
sDevPrivegeV®
;

36 
	s¡DevPrivege


38 
ušt64_t
 
	muÎDevId
;

39 
	m¡d
::
¡ršg
 
sDevPrivegeV®
;

40 
	m¡DevPrivege
 &
	mİ”©Ü
=(cÚ¡ 
¡DevPrivege
 &
rhs
)

42 
uÎDevId
 = 
rhs
.ullDevId;

43 
	msDevPrivegeV®
 = 
rhs
.
sDevPrivegeV®
;

44  *
	mthis
;

49 
	sIDM­pšg


51 
ušt64_t
 
	msourûID
;

52 
ušt64_t
 
	mrg‘ID
;

55 
	s¡S”v”InRŞe


57 
ušt64_t
 
	muÎS”v”Id
;

58 
ušt16_t
 
	musTy³
;

59 
	m¡d
::
¡ršg
 
sB™s
;

60 
	m¡d
::
veùÜ
<
¡DevPrivege
> 
vDevPrivegeD©a
;

62 
	m¡S”v”InRŞe
 &
	mİ”©Ü
=(cÚ¡ 
¡S”v”InRŞe
& 
rhs
)

64 
uÎS”v”Id
 = 
rhs
.ullServerId;

65 
	musTy³
 = 
rhs
.
usTy³
;

66 
	msB™s
 = 
rhs
.
sB™s
;

67 
	mvDevPrivegeD©a
 = 
rhs
.
vDevPrivegeD©a
;

68  *
	mthis
;

72 
	s¡RŞeD©a


74 
¡CÚfigBa£I‹m
 
	mba£I‹m
;

75 
boŞ
 
	mbAutoCÚÃùM©rixS”v”
;

76 
ušt64_t
 
	muÎDeçuÉV›wProfeId
;

77 
ušt32_t
 
	miPriÜ™yPTZ
;

78 
ušt32_t
 
	miPriÜ™yT®k
;

79 
ušt32_t
 
	miPriÜ™yV›w
;

80 
ušt32_t
 
	miPriÜ™yM©rix
;

82 
ušt64_t
 
	muÎPÏybackTimeLim™
;

83 
	m¡d
::
¡ršg
 
sG’”®I‹mAcûssB™SŒ—m
;

84 
	m¡d
::
veùÜ
<
¡DeçuÉDevAcûssB™SŒ—m
> 
vDeçuÉInfo
;

85 
	m¡d
::
veùÜ
<
¡S”v”InRŞe
> 
vS”v”Info
;

87 
¡RŞeD©a
();

88 
boŞ
 
S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

89 
boŞ
 
Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

93 
	s¡U£rD©a


95 
¡CÚfigBa£I‹m
 
	mba£I‹m
;

96 
boŞ
 
	mbU£rEÇbË
;

97 
	m¡d
::
¡ršg
 
sEnüy±edPw
;

98 
boŞ
 
	mbSameAsU£rGroupD©a
;

99 
ušt64_t
 
	muÎWhichGroup
;

100 
boŞ
 
	mbU£rLogOnScheduËr
;

101 
	m¡d
::
veùÜ
<
¡A‰ribu‹dScheduËI‹m
> 
vScheduËrI‹m
;

102 
ušt64_t
 
	muÎRŞeID
;

104 
¡U£rD©a
();

105 
boŞ
 
S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

106 
boŞ
 
Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

110 şas 
	cCScheduËBa£


112 
	mpublic
:

113 
ex¶ic™
 
	$CScheduËBa£
() {}

114 
vœtu®
 ~
	$CScheduËBa£
(è{
	}
}

115 
vœtu®
 
boŞ
 
	$SaveToXmlFe
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
–em’t
) const = 0;

116 
vœtu®
 
SCHEDULE_TYPE
 
	$G‘Ty³
() const = 0;

117 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

118 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

120 
¡CÚfigBa£I‹m
 
ba£I‹m
;

122 
´iv©e
:

123 
	`CScheduËBa£
(cÚ¡ 
CScheduËBa£
& 
rhs
);

124 
CScheduËBa£
 &
İ”©Ü
=(cÚ¡ CScheduËBa£& 
rhs
);

125 
	}
};

127 şas 
	cCScheduËDay
: 
public
 
CScheduËBa£


129 
public
:

130 
ex¶ic™
 
	$CScheduËDay
()

132 
vDay
.
	`ş—r
();

134 
vœtu®
 ~
	$CScheduËDay
(è{
	}
}

135 
vœtu®
 
boŞ
 
	$SaveToXmlFe
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
–em’t
) const;

136 
vœtu®
 
SCHEDULE_TYPE
 
	$G‘Ty³
() const

138  
SCHEDULE_TYPE_DAILY
;

139 
	}
}

140 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

141 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

143 
¡d
::
veùÜ
<¡d::
¡ršg
> 
vDay
;

145 
´iv©e
:

146 
	`CScheduËDay
(cÚ¡ 
CScheduËDay
& 
rhs
);

147 
CScheduËDay
 &
İ”©Ü
=(cÚ¡ CScheduËDay& 
rhs
);

148 
	}
};

150 şas 
	cCScheduËW“kly
: 
public
 
CScheduËBa£


152 
public
:

153 
ex¶ic™
 
	$CScheduËW“kly
()

155 
i
 = 0; i < 7; i++)

156 
vW“k
[
i
].
	`ş—r
();

158 
vœtu®
 ~
	$CScheduËW“kly
(è{
	}
}

159 
vœtu®
 
boŞ
 
	$SaveToXmlFe
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
–em’t
) const;

160 
vœtu®
 
SCHEDULE_TYPE
 
	$G‘Ty³
() const

162  
SCHEDULE_TYPE_WEEKLY
;

163 
	}
}

164 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

165 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

167 
¡d
::
veùÜ
<¡d::
¡ršg
> 
vW“k
[7];

169 
´iv©e
:

170 
	`CScheduËW“kly
(cÚ¡ 
CScheduËW“kly
& 
rhs
);

171 
CScheduËW“kly
 &
İ”©Ü
=(cÚ¡ CScheduËW“kly& 
rhs
);

172 
	}
};

174 şas 
	cCScheduËMÚthly
: 
public
 
CScheduËBa£


176 
public
:

177 
ex¶ic™
 
	$CScheduËMÚthly
()

179 
i
 = 0; i < 2; i++)

180 
vDayNext
[
i
].
	`ş—r
();

182 
vœtu®
 ~
	$CScheduËMÚthly
(è{
	}
}

183 
vœtu®
 
boŞ
 
	$SaveToXmlFe
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
–em’t
) const;

184 
vœtu®
 
SCHEDULE_TYPE
 
	$G‘Ty³
() const

186  
SCHEDULE_TYPE_MONTHLY
;

187 
	}
}

188 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

189 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

191 
ušt8_t
 
bTy³
;

192 
ušt8_t
 
bWhichDayInMÚth
;

193 
ušt8_t
 
bWhichW“k
;

194 
ušt8_t
 
bWhichDay
;

195 
boŞ
 
bFš®W“k
;

197 
¡d
::
veùÜ
<¡d::
¡ršg
> 
vDayNext
[2];

199 
´iv©e
:

200 
	`CScheduËMÚthly
(cÚ¡ 
CScheduËMÚthly
& 
rhs
);

201 
CScheduËMÚthly
 &
İ”©Ü
=(cÚ¡ CScheduËMÚthly& 
rhs
);

202 
	}
};

204 şas 
	cCScheduËY—¾y
: 
public
 
CScheduËMÚthly


206 
public
:

207 
ex¶ic™
 
	$CScheduËY—¾y
()

209 
i
 = 0; i < 2; i++)

210 
vDayNext
[
i
].
	`ş—r
();

212 
vœtu®
 ~
	$CScheduËY—¾y
(è{
	}
}

213 
vœtu®
 
boŞ
 
	$SaveToXmlFe
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
–em’t
) const;

214 
vœtu®
 
SCHEDULE_TYPE
 
	$G‘Ty³
() const

216  
SCHEDULE_TYPE_YEARLY
;

217 
	}
}

218 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

219 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

221 
ušt8_t
 
bWhichMÚth
;

223 
´iv©e
:

224 
	`CScheduËY—¾y
(cÚ¡ 
CScheduËY—¾y
& 
rhs
);

225 
CScheduËY—¾y
 &
İ”©Ü
=(cÚ¡ CScheduËY—¾y& 
rhs
);

226 
	}
};

228 şas 
	cCScheduËS³cificDays
: 
public
 
CScheduËBa£


230 
public
:

231 
ex¶ic™
 
	$CScheduËS³cificDays
()

233 
vD©eLi¡
.
	`ş—r
();

234 
i
 = 0; i < 2; i++)

235 
vDayNext
[
i
].
	`ş—r
();

237 
vœtu®
 ~
	$CScheduËS³cificDays
(è{
	}
}

238 
vœtu®
 
boŞ
 
	$SaveToXmlFe
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
–em’t
) const;

239 
vœtu®
 
SCHEDULE_TYPE
 
	$G‘Ty³
() const

241  
SCHEDULE_TYPE_SPECIFICDAY
;

242 
	}
}

243 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

244 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

246 
¡d
::
veùÜ
<
št64_t
> 
vD©eLi¡
;

247 
¡d
::
veùÜ
<¡d::
¡ršg
> 
vDayNext
[2];

249 
´iv©e
:

250 
	`CScheduËS³cificDays
(cÚ¡ 
CScheduËS³cificDays
& 
rhs
);

251 
CScheduËS³cificDays
 &
İ”©Ü
=(cÚ¡ CScheduËS³cificDays& 
rhs
);

252 
	}
};

	@../../titanutils/serverConfig/NTPConfig.cpp

1 
	~"../cÚ¡/P©hCÚ¡.h
"

2 
	~<¡dio.h
>

3 
	~"NTPCÚfig.h
"

4 
	~"commÚ/fe.h
"

5 #ià
defšed
(
__lšux
)

6 
	~<uni¡d.h
>

8 
	~<¡ršg.h
>

9 
	~<¡dlib.h
>

11 
usšg
 
	g¡d
::
¡ršg
;

13 cÚ¡ * 
	gDEFAULT_TIME_SERVER
 = "time.nist.gov";

14 cÚ¡ * 
	gDEFAULT_NTP_CONFIG
 = "/mtd/block4/default/NU20/etc/ntp.conf";

15 cÚ¡ * 
	gDEFAULT_NUSERVER_CONFIG
 = "/mtd/block4/default/etc/nuservice.conf";

18 * 
	gCNTPCÚfig
::
	$»adfe
(cÚ¡ *
f•©h
, *
feSize
)

20 ià(
NULL
 =ğ
f•©h
)

21  
NULL
;

23 
FILE
 *
å
 = 
	`fİ’
(
f•©h
, "r");

24 ià(
NULL
 =ğ
å
)

25  
NULL
;

27 
_feSize
 = 0;

28 
	`f£ek
(
å
, 0, 
SEEK_END
);

29 
_feSize
 = 
	`á–l
(
å
);

30 
	`»wšd
(
å
);

31 ià(
_feSize
<1)

33 ià(
NULL
 !ğ
å
)

35 
	`fşo£
(
å
);

37  
NULL
;

39 ià(
feSize
!=
NULL
)

40 *
feSize
 = 
_feSize
;

42 *
buf
 = (*è
	`ÿÎoc
(
_feSize
+1, ());

43 ià(
NULL
 =ğ
buf
)

45 
	`fşo£
(
å
);

46  
NULL
;

48 
	`ä—d
(
buf
, 1, 
_feSize
, 
å
);

49 
buf
[
_feSize
] = '\0';

50 
	`fşo£
(
å
);

52  
buf
;

53 
	}
}

55 
boŞ
 
	gCNTPCÚfig
::
	$IsNTPS”v”EÇbË
(
boŞ
 &
NTPStus
)

57 #ifdeà
WIN32


58  
çl£
;

60 
boŞ
 
bNTP’abË
 = 
çl£
;

61 
¡rNTP
[256] = {0};

64 
FILE
* 
pFe
 = 
	`pİ’
("ps‡ux | grep‚tpd", "r");

65 ià(
NULL
 =ğ
pFe
)

68 
NTPStus
 = 
çl£
;

69  
çl£
;

72 0 =ğ
	`ãof
(
pFe
))

74 
	`¡rıy
(
¡rNTP
, "");

75 
	`fg‘s
(
¡rNTP
, 255, 
pFe
);

77 ià(
	`¡r¡r
(
¡rNTP
, "Ápd -c"è!ğ
NULL
)

79 
bNTP’abË
 = 
Œue
;

83 
	`pşo£
(
pFe
);

85 
NTPStus
 = 
bNTP’abË
;

86  
Œue
;

88 
	}
}

90 
boŞ
 
	gCNTPCÚfig
::
	$Wr™eNTPNuS”v”CÚfig
(
boŞ
 
’abË
)

93 ià(!
SYSUTILS_SPACE
::
	`CheckFeExi¡
(
NUSERVICE_CONF_PATH
))

95 ià(!
SYSUTILS_SPACE
::
	`CİyFe2
(
DEFAULT_NUSERVER_CONFIG
, 
NUSERVICE_CONF_PATH
))

99  
çl£
;

103 
feSize
 = 0;

104 * 
buf
 = 
NULL
;

105 
buf
 = 
	`»adfe
(
NUSERVICE_CONF_PATH
, &
feSize
);

106 
boŞ
 
bR‘
 = 
çl£
;

107 ià(
NULL
 !ğ
buf
 && 
feSize
 > 0)

109 ià((
NULL
 !ğ
	`¡r¡r
(
buf
, "NTP=1"è&& 
’abË
 =ğ
çl£
 ) ||

110 (
NULL
 !ğ
	`¡r¡r
(
buf
, "NTP=0"è&& 
’abË
 =ğ
Œue
 ))

112 * 
p
 = 
	`¡r¡r
(
buf
, "NTP=");

113 ià(
NULL
 !ğ
p
)

115 
p
 +ğ
	`¡¾’
("NTP=");

116 *
p
 = ((
Œue
 =ğ
’abË
)?'1':'0');

117 
FILE
* 
å
 = 
	`fİ’
(
NUSERVICE_CONF_PATH
, "w");

118 ià(
NULL
 !ğ
å
)

120 
	`årštf
(
å
, "%s", 
buf
);

122 
	`fşo£
(
å
);

123 
bR‘
 = 
Œue
;

128 
bR‘
 = 
çl£
;

134 
bR‘
 = 
çl£
;

137 ià(
NULL
 =ğ
	`¡r¡r
(
buf
, "NTP="))

139 
FILE
* 
å
 = 
	`fİ’
(
NUSERVICE_CONF_PATH
, "a");

140 ià(
NULL
 !ğ
å
)

142 
sNTP
[32] = {0};

143 
	`¥rštf
(
sNTP
, " NTP=%d", 
’abË
);

144 
	`årštf
(
å
, "%s", 
sNTP
);

146 
	`fşo£
(
å
);

147 
bR‘
 = 
Œue
;

152 
bR‘
 = 
çl£
;

157 
bR‘
 = 
Œue
;

163 
bR‘
 = 
çl£
;

166 ià(
buf
 !ğ
NULL
)

168 
	`ä“
(
buf
);

170  
bR‘
;

171 
	}
}

173 
boŞ
 
	gCNTPCÚfig
::
	$R—dNTPNuS”v”CÚfig
(
boŞ
 &
’abË
)

175 
feSize
 = 0;

176 * 
buf
 = 
NULL
;

177 
buf
 = 
	`»adfe
(
NUSERVICE_CONF_PATH
, &
feSize
);

178 
boŞ
 
bR‘
 = 
çl£
;

179 ià(
NULL
 !ğ
buf
 && 
feSize
 > 0)

181 * 
p
 = 
	`¡r¡r
(
buf
, "NTP=");

182 ià(
NULL
 !ğ
p
)

184 
p
 +ğ
	`¡¾’
("NTP=");

185 
’abË
 = (('1' =ğ*
p
)? 
Œue
:
çl£
);

187 
bR‘
 = 
Œue
;

192 
bR‘
 = 
çl£
;

198 
bR‘
 = 
çl£
;

201 ià(
buf
 !ğ
NULL
)

203 
	`ä“
(
buf
);

205  
bR‘
;

206 
	}
}

208 
boŞ
 
	gCNTPCÚfig
::
	$R—dNTPTimeS”v”
(
¡ršg
 &
£rv”Addr
)

210 
feSize
 = 0;

211 * 
buf
 = 
NULL
;

212 
buf
 = 
	`»adfe
(
NTP_CONF_PATH
, &
feSize
);

213 
boŞ
 
bR‘
 = 
çl£
;

217 ià(
NULL
 !ğ
buf
 && 
feSize
 > 0)

219 * 
pS¹
 = 
	`¡r¡r
(
buf
, "server ");

220 * 
pEnd
 = 
	`¡r¡r
(
buf
, "…refer");

221 ià(
NULL
 !ğ
pS¹
 && NULL !ğ
pEnd
 )

223 
pS¹
 +ğ
	`¡¾’
("server ");

224 *
pBuff
 = 
NULL
;

225 
pBuff
 = 
Ãw
 [
pEnd
 - 
pS¹
+1];

226 ià(
pBuff
 =ğ
NULL
)

229  
çl£
;

231 
	`¡ºıy
(
pBuff
, 
pS¹
, 
pEnd
-pStart);

232 
pBuff
[
pEnd
 - 
pS¹
] = '\0';

233 
£rv”Addr
 = 
pBuff
;

235 
d–‘e
[] 
pBuff
;

236 
pBuff
 = 
NULL
;

237 
bR‘
 = 
Œue
;

243 
bR‘
 = 
çl£
;

246 ià(
buf
 !ğ
NULL
)

248 
	`ä“
(
buf
);

250  
bR‘
;

251 
	}
}

253 
boŞ
 
	gCNTPCÚfig
::
	$Wr™eNTPTimeS”v”
(cÚ¡ 
¡ršg
 &
£rv”Addr
)

256 ià(!
SYSUTILS_SPACE
::
	`CheckFeExi¡
(
NTP_CONF_PATH
))

258 ià(!
SYSUTILS_SPACE
::
	`CİyFe2
(
DEFAULT_NTP_CONFIG
, 
NTP_CONF_PATH
))

262  
çl£
;

266 
feSize
 = 0;

267 * 
buf
 = 
NULL
;

268 
buf
 = 
	`»adfe
(
NTP_CONF_PATH
, &
feSize
);

269 
sT¬g‘S”v”
[512];

270 
	`¥rštf
(
sT¬g‘S”v”
, "£rv” % ´eãr", 
£rv”Addr
.
	`c_¡r
());

271 
boŞ
 
bR‘
 = 
çl£
;

272 ià(
NULL
 !ğ
buf
 && 
feSize
 > 0)

274 ià(
NULL
 !ğ
	`¡r¡r
(
buf
, "£rv” "è&& NULL =ğ¡r¡r(buf, 
sT¬g‘S”v”
) && NULL != strstr(buf, "…refer") )

276 * 
p
 = 
	`¡r¡r
(
buf
, "…refer");

277 ià(
NULL
 !ğ
p
)

279 
p
 +ğ
	`¡¾’
("…refer");

280 
FILE
* 
å
 = 
	`fİ’
(
NTP_CONF_PATH
, "w");

281 ià(
NULL
 !ğ
å
)

283 
	`årštf
(
å
, "%s%s", 
sT¬g‘S”v”
, 
p
);

286 
	`fşo£
(
å
);

287 
bR‘
 = 
Œue
;

292 
bR‘
 = 
çl£
;

298 
bR‘
 = 
çl£
;

305 
bR‘
 = 
çl£
;

308 ià(
buf
 !ğ
NULL
)

310 
	`ä“
(
buf
);

311 
buf
 = 
NULL
;

313  
bR‘
;

314 
	}
}

316 
boŞ
 
	gCNTPCÚfig
::
	$DoNTPS”v”
(
boŞ
 
bEÇbË
, cÚ¡ *
£rv”Addr
)

318 ià(
£rv”Addr
 =ğ
NULL
)

320  
çl£
;

323 
boŞ
 
bOriS”v”EÇbË
 = 
çl£
;

324 ià(!
	`R—dNTPNuS”v”CÚfig
(
bOriS”v”EÇbË
))

326 ià(
	`Wr™eNTPNuS”v”CÚfig
(
bEÇbË
è=ğ
çl£
)

329 
bOriS”v”EÇbË
 = !
bEÇbË
;

333 
¡d
::
¡ršg
 
sOriS”v”Lšk
 = "";

334 ià(!
	`R—dNTPTimeS”v”
(
sOriS”v”Lšk
))

339 ià(
sOriS”v”Lšk
 =ğ"" && 0 =ğ
	`¡rcmp
(
£rv”Addr
,"") )

341 
£rv”Addr
 = 
DEFAULT_TIME_SERVER
;

345 ià(
bOriS”v”EÇbË
 =ğ
bEÇbË
 && 
sOriS”v”Lšk
 =ğ
£rv”Addr
)

348 
boŞ
 
bNTPEÇbË
 = 
çl£
;

349 ià(
	`IsNTPS”v”EÇbË
(
bNTPEÇbË
) )

351 if(
bNTPEÇbË
 =ğ
Œue
 && 
bEÇbË
 =ğ
çl£
)

353 
	`sy¡em
("/etc/init.d/ntp stop");

355 ià(
bNTPEÇbË
 =ğ
çl£
 && 
bEÇbË
 =ğ
Œue
)

357 
	`sy¡em
("/etc/init.d/ntp start");

360  
çl£
;

363 
boŞ
 
bModify
 = 
çl£
;

364 ià(
bOriS”v”EÇbË
 !ğ
bEÇbË
)

366 ià(
	`Wr™eNTPNuS”v”CÚfig
(
bEÇbË
è=ğ
çl£
)

370 
bModify
 = 
Œue
;

373 ià(
sOriS”v”Lšk
 !ğ
£rv”Addr
 && 0 !ğ
	`¡rcmp
(serverAddr, "") )

375 ià(
	`Wr™eNTPTimeS”v”
(
£rv”Addr
è=ğ
çl£
)

377  
çl£
;

379 
bModify
 = 
Œue
;

386 
boŞ
 
bNTPEÇbË
 = 
çl£
;

387 ià(
	`IsNTPS”v”EÇbË
(
bNTPEÇbË
) )

389 if(
bNTPEÇbË
 =ğ
Œue
 && 
bEÇbË
 =ğ
çl£
)

391 
	`sy¡em
("/etc/init.d/ntp stop");

393 ià(
bNTPEÇbË
 =ğ
çl£
 && 
bEÇbË
 =ğ
Œue
)

395 
	`sy¡em
("/etc/init.d/ntp start");

400  
Œue
;

401 
	}
}

	@../../titanutils/serverConfig/NTPConfig.h

1 #iâdeà
__NTP_CONFIG__


2 
	#__NTP_CONFIG__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~<¡ršg
>

7 şas 
	cCNTPCÚfig


9 
	mpublic
:

10 
boŞ
 
DoNTPS”v”
(boŞ 
bEÇbË
, cÚ¡ *
£rv”Addr
);

11 
boŞ
 
IsNTPS”v”EÇbË
(boŞ &
NTPStus
);

13 
	m´iv©e
:

14 
boŞ
 
Wr™eNTPNuS”v”CÚfig
(boŞ 
’abË
);

15 
boŞ
 
R—dNTPNuS”v”CÚfig
(boŞ &
’abË
);

16 
boŞ
 
R—dNTPTimeS”v”
(
¡d
::
¡ršg
 &
£rv”Addr
);

17 
boŞ
 
Wr™eNTPTimeS”v”
(cÚ¡ 
¡d
::
¡ršg
 &
£rv”Addr
);

18 *
»adfe
(cÚ¡ *
f•©h
, *
feSize
);

	@../../titanutils/serverConfig/NetworkServiceConfig.cpp

1 
	~"N‘wÜkS”viûCÚfig.h
"

3 
	~<¡dio.h
>

4 
	~<¡ršg.h
>

6 
	~"N‘wÜkS‘tšgXmlTagDef.h
"

7 
	~"sûw/xml_Œ“.h
"

8 
	~"commÚ/ut™y.h
"

9 
	~"commÚ/fe.h
"

10 
	~"commÚ/¡ršg.h
"

12 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

14 #iâdeà
_WIN32


15 
	#DEBUG_TRACE
(
fmt
, ...èdØ{ 
	`årštf
(
¡d”r
, "[DEBUG MESSAGE: %s:%d func: %s] "fmt, 
__FILE__
, 
__LINE__
, 
__func__
, ##
__VA_ARGS__
); } 0)

	)

17 
	#DEBUG_TRACE
(
fmt
, ...èdØ{ 
	`årštf
(
¡d”r
, "[DEBUG MESSAGE: %s:%d] "fmt, 
__FILE__
, 
__LINE__
, ##
__VA_ARGS__
); } 0)

	)

22 
	gCS”viûCÚfigD©aBa£
::
	$CS”viûCÚfigD©aBa£
()

23 : 
	`m_bEÇbË
(
Œue
)

24 , 
	$m_bIsRemove
(
çl£
)

27 
	}
}

29 
	gCS”viûCÚfigD©aBa£
::~
	$CS”viûCÚfigD©aBa£
()

32 
	}
}

34 
boŞ
 
CS”viûCÚfigD©aBa£
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

37 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_ENABLE
, 
m_bEÇbË
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

38 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_IS_REMOVE
, 
m_bIsRemove
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

39  
Œue
;

40 
	}
}

42 
boŞ
 
	gCS”viûCÚfigD©aBa£
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

45 
m_bEÇbË
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_ENABLE
);

46 
m_bIsRemove
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_IS_REMOVE
);

47  
Œue
;

48 
	}
}

50 
	gCS”viûCÚfigD©aBa£
::
	$Dump
()

52 
	`´štf
("<’abË>%d</’abË>\n", 
m_bEÇbË
);

53 
	`´štf
("<IsRemove>%d</IsRemove>\n", 
m_bIsRemove
);

54 
	}
}

56 
	gCS”viûCÚfigD©aBa£
::
	$DeçuÉV®ue
()

58 
m_bEÇbË
 = 
Œue
;

60 
	}
}

62 * 
	gCS”viûCÚfigD©aBa£
::
	$S”v”Ty³
()

65 
	}
}

67 
	gCMSS”viûCÚfigD©a
::
	$CMSS”viûCÚfigD©a
()

68 : 
	$m_uCommªdPÜt
(0)

71 
	}
}

73 
CMSS”viûCÚfigD©a
::~
	$CMSS”viûCÚfigD©a
()

76 
	}
}

78 
CMSS”viûCÚfigD©a
::
	$DeçuÉV®ue
()

80 
m_bEÇbË
 = 
Œue
;

81 
m_uCommªdPÜt
 = 5250;

82 
	}
}

84 
boŞ
 
	gCMSS”viûCÚfigD©a
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

86 ià(!
CS”viûCÚfigD©aBa£
::
	`S”Ÿlize
(
roÙ
))

88 
	`DEBUG_TRACE
("serialize failed\n");

91 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_COMMAND_PORT
, 
m_uCommªdPÜt
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

92  
Œue
;

93 
	}
}

95 
boŞ
 
	gCMSS”viûCÚfigD©a
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

97 
CS”viûCÚfigD©aBa£
::
	`Un£rŸlize
(
roÙ
);

98 
m_uCommªdPÜt
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_COMMAND_PORT
);

100  
Œue
;

101 
	}
}

103 
	gCMSS”viûCÚfigD©a
::
	$Dump
()

105 
CS”viûCÚfigD©aBa£
::
	`Dump
();

106 
	`´štf
("<commªdPÜt>%d</commªdPÜt>\n", 
m_uCommªdPÜt
);

107 
	}
}

109 * 
	gCMSS”viûCÚfigD©a
::
	$S”v”Ty³
()

112 
	}
}

114 
	gCSÏveS”viûCÚfigD©a
::
	$CSÏveS”viûCÚfigD©a
()

115 : 
	`m_sMSIPAdd»ss
("")

116 , 
	`m_uMSPÜt
(0)

117 , 
	`m_sMSU£ºame
("")

118 , 
	`m_sMSPasswÜd
("")

119 , 
	`m_sWANIPAdd»ss
("")

120 , 
	$m_uWANPÜt
(0)

122 
ušt32_t
 
i
=0; i<
LAN_PORT_COUNT
; i++)

124 
m_uLªPÜt
[
i
] = 0;

126 
	}
}

128 
	gCSÏveS”viûCÚfigD©a
::~
	$CSÏveS”viûCÚfigD©a
()

131 
	}
}

133 
boŞ
 
CSÏveS”viûCÚfigD©a
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

135 
CS”viûCÚfigD©aBa£
::
	`S”Ÿlize
(
roÙ
);

136 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_MSIPADDRESS
, 
m_sMSIPAdd»ss
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

137 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_COMMAND_PORT
, 
m_uMSPÜt
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

138 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_MSUSERNAME
, 
m_sMSU£ºame
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

139 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_MSPASSWORD
, 
m_sMSPasswÜd
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

140 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_LANPORT1
, 
m_uLªPÜt
[0]), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

142 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_WANADDRESS
, 
m_sWANIPAdd»ss
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

143 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_WANPORT
, 
m_uWANPÜt
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

146  
Œue
;

147 
	}
}

149 
boŞ
 
	gCSÏveS”viûCÚfigD©a
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

151 
CS”viûCÚfigD©aBa£
::
	`Un£rŸlize
(
roÙ
);

152 
m_sMSIPAdd»ss
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_MSIPADDRESS
).
	`G‘CÚ‹Á
();

153 
m_uMSPÜt
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_COMMAND_PORT
);

154 
m_sMSU£ºame
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_MSUSERNAME
).
	`G‘CÚ‹Á
();

155 
m_sMSPasswÜd
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_MSPASSWORD
).
	`G‘CÚ‹Á
();

156 
m_uLªPÜt
[0] = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_LANPORT1
);

158 
m_sWANIPAdd»ss
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_WANADDRESS
).
	`G‘CÚ‹Á
();

159 
m_uWANPÜt
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_WANPORT
);

161  
Œue
;

162 
	}
}

164 
	gCSÏveS”viûCÚfigD©a
::
	$Dump
()

166 
CS”viûCÚfigD©aBa£
::
	`Dump
();

167 
	`´štf
("<MSIPAdd»ss>%s</MSIPAdd»ss>\n", 
m_sMSIPAdd»ss
.
	`c_¡r
());

168 
	`´štf
("<commªdPÜt>%u</commªdPÜt>\n", 
m_uMSPÜt
);

169 
	`´štf
("<MSU£ºame>%s</MSU£ºame>\n", 
m_sMSU£ºame
.
	`c_¡r
());

170 
	`´štf
("<MSPasswÜd>%s</MSPasswÜd>\n", 
m_sMSPasswÜd
.
	`c_¡r
());

171 
	`´štf
("<LANPÜt1>%u</LANPÜt1>\n", 
m_uLªPÜt
[0]);

173 
	`´štf
("<WANIPAdd»ss>%s</WANIPAdd»ss>\n", 
m_sWANIPAdd»ss
.
	`c_¡r
());

174 
	`´štf
("<WANPÜt>%u</WANPÜt>\n", 
m_uWANPÜt
);

175 
	}
}

177 * 
	gCSÏveS”viûCÚfigD©a
::
	$S”v”Ty³
()

180 
	}
}

182 
	gCRSS”viûCÚfigD©a
::
	$CRSS”viûCÚfigD©a
()

185 
	}
}

187 
CRSS”viûCÚfigD©a
::~
	$CRSS”viûCÚfigD©a
()

190 
	}
}

192 
CRSS”viûCÚfigD©a
::
	$DeçuÉV®ue
()

194 
m_bEÇbË
 = 
Œue
;

195 
m_sMSIPAdd»ss
 = "127.0.0.1";

196 
m_sMSPasswÜd
 = "admin";

197 
m_sMSU£ºame
 = "admin";

198 
m_uLªPÜt
[0] = 5251;

199 
m_sWANIPAdd»ss
 = "127.0.0.1";

200 
m_uWANPÜt
 = 5251;

201 
	}
}

203 * 
	gCRSS”viûCÚfigD©a
::
	$S”v”Ty³
()

206 
	}
}

224 
	gCMDSS”viûCÚfigD©a
::
	$CMDSS”viûCÚfigD©a
()

225 : 
	`m_uIVSLªPÜt
(0)

226 , 
	$m_uIVSWªPÜt
(0)

229 
	}
}

231 
	gCMDSS”viûCÚfigD©a
::~
	$CMDSS”viûCÚfigD©a
()

234 
	}
}

236 
CMDSS”viûCÚfigD©a
::
	$DeçuÉV®ue
()

238 
m_bEÇbË
 = 
çl£
;

239 
m_sMSIPAdd»ss
 = "127.0.0.1";

240 
m_sMSPasswÜd
 = "admin";

241 
m_sMSU£ºame
 = "admin";

242 
m_uLªPÜt
[0] = 5252;

243 
m_sWANIPAdd»ss
 = "127.0.0.1";

244 
m_uWANPÜt
 = 5252;

245 
	}
}

247 * 
	gCMDSS”viûCÚfigD©a
::
	$S”v”Ty³
()

250 
	}
}

252 
boŞ
 
	gCMDSS”viûCÚfigD©a
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

255 
CSÏveS”viûCÚfigD©a
::
	`Un£rŸlize
(
roÙ
);

256 
m_uIVSLªPÜt
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_IVSLANPORT
);

257 
m_uIVSWªPÜt
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_IVSWANPORT
);

258  
Œue
;

259 
	}
}

261 
boŞ
 
	gCMDSS”viûCÚfigD©a
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

263 
CSÏveS”viûCÚfigD©a
::
	`S”Ÿlize
(
roÙ
);

264 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_IVSLANPORT
, 
m_uIVSLªPÜt
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

265 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_IVSWANPORT
, 
m_uIVSWªPÜt
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

267  
Œue
;

268 
	}
}

270 
	gCMDSS”viûCÚfigD©a
::
	$Dump
()

272 
CSÏveS”viûCÚfigD©a
::
	`Dump
();

273 
	`´štf
("<IVSLANPÜt>%u</IVSLANPÜt>\n", 
m_uIVSLªPÜt
);

274 
	`´štf
("<IVSWANPÜt>%u</IVSWANPÜt>\n", 
m_uIVSWªPÜt
);

275 
	}
}

277 
	gCN‘wÜkS”viûCÚfig
::
	$CN‘wÜkS”viûCÚfig
()

280 
	}
}

282 
CN‘wÜkS”viûCÚfig
::~
	$CN‘wÜkS”viûCÚfig
()

285 
	}
}

287 
boŞ
 
CN‘wÜkS”viûCÚfig
::
	$G‘N‘wÜkS‘tšg
(cÚ¡ * 
feP©h
, 
CS”viûCÚfigD©aBa£
 *
pS”v”CÚfigD©a
)

289 ià(
feP©h
 =ğ
NULL
 || 0==
	`¡rcmp
(filePath, ""))

291  
çl£
;

293 
SYSUTILS_SPACE
::
XMLT»e
 
Œ“
;

294 
SYSUTILS_SPACE
::
XMLEËm’t
 
–em’t
;

298 ià(!
	`LßdXMLT»e
(
feP©h
, 
Œ“
))

301  
çl£
;

303 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

304  
pS”v”CÚfigD©a
->
	`Un£rŸlize
(
–em’t
);

305 
	}
}

307 
boŞ
 
	gCN‘wÜkS”viûCÚfig
::
	$G‘N‘wÜkS‘tšgFÜUI
(cÚ¡ * 
feP©h
, 
CS”viûCÚfigD©aBa£
 *
pCÚfig
)

309 ià(
	`G‘N‘wÜkS‘tšg
(
feP©h
, 
pCÚfig
))

311 ià(
pCÚfig
->
m_bIsRemove
)

313 
pCÚfig
->
	`DeçuÉV®ue
();

314 
pCÚfig
->
m_bEÇbË
 = 
çl£
;

333 ià(
	`CheckFeExi¡
(
VM_MODE_FILE
è&& 
	`¡rcmp
(
pCÚfig
->
	`S”v”Ty³
(), "MS") == 0 )

335 
pCÚfig
->
m_bEÇbË
 = 
çl£
;

338  
Œue
;

340  
çl£
;

341 
	}
}

343 
boŞ
 
	gCN‘wÜkS”viûCÚfig
::
	$S‘N‘wÜkS‘tšg
(cÚ¡ * 
feP©h
, cÚ¡ 
CS”viûCÚfigD©aBa£
 *
pS”v”CÚfigD©a
)

345 ià(
feP©h
 =ğ
NULL
 || 0==
	`¡rcmp
(filePath, ""))

347  
çl£
;

349 
SYSUTILS_SPACE
::
XMLT»e
 
Œ“
;

350 
SYSUTILS_SPACE
::
XMLEËm’t
 
–em’t
;

352 
–em’t
 = 
Œ“
.
	`S‘RoÙ
("NetworkSettings");

353 
boŞ
 
bR‘
 = 
pS”v”CÚfigD©a
->
	`S”Ÿlize
(
–em’t
);

354 
SYSUTILS_SPACE
::
	`SaveXMLT»e
(
feP©h
, 
Œ“
);

355  
bR‘
;

356 
	}
}

358 
boŞ
 
	gCN‘wÜkS”viûCÚfig
::
	$G‘NewCÚfigFeP©h
(
eS”v”Ty³
 
£rv”Ty³
, 
¡d
::
¡ršg
 &
sFeP©h
)

360 
¡d
::
¡ršg
 
sFeName
 = "";

361 
£rv”Ty³
)

363 
eMS
:

364 
sFeName
 = "MSNetworkSetting.xml";

366 
eRS
:

367 
sFeName
 = "RSNetworkSetting.xml";

369 
eMDS
:

370 
sFeName
 = "MDSNetworkSetting.xml";

372 
eIVS
:

373 
sFeName
 = "IVSServiceSetting.xml";

375 
ePlugš
:

376 
sFeName
 = "manager_profile.xml";

379  
çl£
;

381 
¡d
::
¡ršg
 
sFŞd”P©h
 = std::
	`¡ršg
(
ROOT_FILE_FOLDER
è+ 
OUT_CONFIG_FOLDER
;

382 ià(!
	`CheckDœeùÜyExi¡
(
sFŞd”P©h
))

384 
	`MakeDœeùÜy
(
sFŞd”P©h
);

386 
sFeP©h
 = 
sFŞd”P©h
 + 
sFeName
;

387  
Œue
;

388 
	}
}

390 
	$Dump
(
CS”viûCÚfigD©aBa£
 *
pS”v”CÚfigD©a
)

392 
	`´štf
("<?xml version=\"1.0\"ƒncoding=\"UTF-8\" ?>\n");

393 
	`´štf
("<NetworkSettings>\n");

394 
pS”v”CÚfigD©a
->
	`Dump
();

395 
	`´štf
("</NetworkSettings>\n");

396 
	}
}

398 
	gCPlugšPÏtfÜmCÚfigD©a
::
	$CPlugšPÏtfÜmCÚfigD©a
()

399 : 
	`m_hasProfeID
(
çl£
)

400 , 
	`m_uÎProfeID
(0)

401 , 
	`m_hasProfeName
(
çl£
)

402 , 
	`m_sProfeName
()

403 , 
	`m_hasMDSIPAdd»ss
(
çl£
)

404 , 
	`m_sMDSIPAdd»ss
()

405 , 
	`m_hasMDSPÜt
(
çl£
)

406 , 
	`m_uMDSPÜt
(9527)

407 , 
	`m_hasMgrU£ºame
(
çl£
)

408 , 
	`m_sMgrU£ºame
("admin")

409 , 
	`m_hasMgrPasswÜd
(
çl£
)

410 , 
	`m_sMgrPasswÜd
("admin")

413 
	}
}

415 
	gCPlugšPÏtfÜmCÚfigD©a
::~
	$CPlugšPÏtfÜmCÚfigD©a
()

418 
	}
}

420 
CPlugšPÏtfÜmCÚfigD©a
& CPlugšPÏtfÜmCÚfigD©a::
İ”©Ü
=(cÚ¡ CPlugšPÏtfÜmCÚfigD©a& 
rhs
)

422 ià(&
rhs
 =ğ
this
)

424  *
this
;

427 
	gm_bEÇbË
 = 
rhs
.
m_bEÇbË
;

428 
	gm_bIsRemove
 = 
rhs
.
m_bIsRemove
;

429 ià(
	grhs
.
	gm_hasProfeID
)

431 
	gm_hasProfeID
 = 
Œue
;

432 
	gm_uÎProfeID
 = 
rhs
.
m_uÎProfeID
;

435 ià(
	grhs
.
	gm_hasProfeName
)

437 
	gm_hasProfeName
 = 
Œue
;

438 
	gm_sProfeName
 = 
rhs
.
m_sProfeName
;

441 ià(
	grhs
.
	gm_hasMDSIPAdd»ss
)

443 
	gm_hasMDSIPAdd»ss
 = 
Œue
;

444 
	gm_sMDSIPAdd»ss
 = 
rhs
.
m_sMDSIPAdd»ss
;

447 ià(
	grhs
.
	gm_hasMDSPÜt
)

449 
	gm_hasMDSPÜt
 = 
Œue
;

450 
	gm_uMDSPÜt
 = 
rhs
.
m_uMDSPÜt
;

453 ià(
	grhs
.
	gm_hasMgrU£ºame
)

455 
	gm_hasMgrU£ºame
 = 
Œue
;

456 
	gm_sMgrU£ºame
 = 
rhs
.
m_sMgrU£ºame
;

459 ià(
	grhs
.
	gm_hasMgrPasswÜd
)

461 
	gm_hasMgrPasswÜd
 = 
Œue
;

462 
	gm_sMgrPasswÜd
 = 
rhs
.
m_sMgrPasswÜd
;

465  *
	gthis
;

468 
boŞ
 
	gCPlugšPÏtfÜmCÚfigD©a
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

470 
CS”viûCÚfigD©aBa£
::
	`S”Ÿlize
(
roÙ
);

473 
roÙ
.
	`AddChd
("MDSIPAdd»ss", 
m_sMDSIPAdd»ss
);

474 
roÙ
.
	`AddChd
("commªdPÜt", 
SYSUTILS_SPACE
::
	`u32_to_¡r
(
m_uMDSPÜt
));

475 
roÙ
.
	`AddChd
("MgrU£ºame", 
m_sMgrU£ºame
);

476 
roÙ
.
	`AddChd
("MgrPasswÜd", 
m_sMgrPasswÜd
);

477 
roÙ
.
	`AddChd
("ProfeID", 
SYSUTILS_SPACE
::
	`u64_to_¡r
(
m_uÎProfeID
));

478 
roÙ
.
	`AddChd
("ProfeName", 
m_sProfeName
);

479 
	}
}

481 
boŞ
 
	gCPlugšPÏtfÜmCÚfigD©a
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

483 
CS”viûCÚfigD©aBa£
::
	`Un£rŸlize
(
roÙ
);

486 
m_sMDSIPAdd»ss
 = 
roÙ
.
	`G‘Chd
("MDSIPAdd»ss").
	`G‘CÚ‹Á
();

487 
m_uMDSPÜt
 = 
SYSUTILS_SPACE
::
	`¡r_to_u32
(
roÙ
.
	`G‘Chd
("commªdPÜt").
	`G‘CÚ‹Á
());

488 
m_sMgrU£ºame
 = 
roÙ
.
	`G‘Chd
("MgrU£ºame").
	`G‘CÚ‹Á
();

489 
m_sMgrPasswÜd
 = 
roÙ
.
	`G‘Chd
("MgrPasswÜd").
	`G‘CÚ‹Á
();

490 
m_uÎProfeID
 = 
SYSUTILS_SPACE
::
	`¡r_to_u64
(
roÙ
.
	`G‘Chd
("ProfeID").
	`G‘CÚ‹Á
());

491 
m_sProfeName
 = 
roÙ
.
	`G‘Chd
("ProfeName").
	`G‘CÚ‹Á
();

493 
m_hasProfeID
 = 
Œue
;

494 
m_hasProfeName
 = 
Œue
;

495 
m_hasMgrU£ºame
 = 
Œue
;

496 
m_hasMgrPasswÜd
 = 
Œue
;

497 
m_hasMDSIPAdd»ss
 = 
Œue
;

498 
m_hasMDSPÜt
 = 
Œue
;

499  
Œue
;

500 
	}
}

502 
	gCPlugšPÏtfÜmCÚfigD©a
::
	$Dump
()

504 
	`´štf
("<’abË>%s</’abË>\n", 
SYSUTILS_SPACE
::
	`boŞ_to_¡r
(
m_bEÇbË
).
	`c_¡r
());

505 
	`´štf
("<IsRemove>%s</IsRemove>\n", 
SYSUTILS_SPACE
::
	`boŞ_to_¡r
(
m_bIsRemove
).
	`c_¡r
());

506 
	`´štf
("<MDSIPAdd»ss>%s</MDSIPAdd»ss>\n", 
m_sMDSIPAdd»ss
.
	`c_¡r
());

507 
	`´štf
("<commªdPÜt>%u</commªdPÜt>\n", 
m_uMDSPÜt
);

508 
	`´štf
("<MgrU£ºame>%s</MgrU£ºame>\n", 
m_sMgrU£ºame
.
	`c_¡r
());

509 
	`´štf
("<MgrPasswÜd>%s</MgrPasswÜd>\n", 
m_sMgrPasswÜd
.
	`c_¡r
());

510 
	`´štf
("<ProfeID>%Îu</ProfeID>\n", 
m_uÎProfeID
);

511 
	`´štf
("<ProfeName>%s</ProfeName>\n", 
m_sProfeName
.
	`c_¡r
());

512 
	}
}

514 
	gCPlugšPÏtfÜmCÚfigD©a
::
	$DeçuÉV®ue
()

517 
	}
}

519 * 
CPlugšPÏtfÜmCÚfigD©a
:: 
	$S”v”Ty³
()

522 
	}
}

524 
	gCPlugšPÏtfÜmProfe
::
	$CPlugšPÏtfÜmProfe
()

525 : 
	$m_cÚfig_li¡
()

528 
	}
}

530 
CPlugšPÏtfÜmProfe
::~
	$CPlugšPÏtfÜmProfe
()

532 
¡d
::
m­
<
ušt64_t
, 
CPlugšPÏtfÜmCÚfigD©a
*>::
™”©Ü
 
™e
 = 
m_cÚfig_li¡
.
	`begš
();

533 
™e
 !ğ
m_cÚfig_li¡
.
	`’d
();

534 
™e
 ++)

536 ià(
NULL
 !ğ
™e
->
£cÚd
)

538 
d–‘e
 
™e
->
£cÚd
;

539 
™e
->
£cÚd
 = 
NULL
;

542 
	}
}

544 
boŞ
 
	gCPlugšPÏtfÜmProfe
::
	$LßdProfesFromP©h
(cÚ¡ 
¡d
::
¡ršg
 &
fe_·th
)

546 
SYSUTILS_SPACE
::
XMLT»e
 
Œ“
;

548 ià(
çl£
 =ğ
SYSUTILS_SPACE
::
	`LßdXMLT»e
(
fe_·th
, 
Œ“
))

550  
çl£
;

553 
SYSUTILS_SPACE
::
XMLEËm’t
 
–em’t
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("ManagerProfile");

555 
–em’t
 !ğ
SYSUTILS_SPACE
::
XMLEËm’t
::
em±y_–em’t
)

557 
CPlugšPÏtfÜmCÚfigD©a
 *
cÚfig
 = 
NULL
;

558 
cÚfig
 = 
Ãw
 
	`CPlugšPÏtfÜmCÚfigD©a
();

560 ià(
NULL
 !ğ
cÚfig
)

562 
cÚfig
->
	`Un£rŸlize
(
–em’t
);

563 if(
m_cÚfig_li¡
.
	`’d
(è!ğm_cÚfig_li¡.
	`fšd
(
cÚfig
->
m_uÎProfeID
))

565 
	`´štf
("Findhe Duplicated Manager Profile\n");

566 
d–‘e
 
cÚfig
;

570 
m_cÚfig_li¡
[
cÚfig
->
m_uÎProfeID
] = config;

574 
–em’t
 =ƒËm’t.
	`G‘Next
();

577  
Œue
;

578 
	}
}

580 
boŞ
 
	gCPlugšPÏtfÜmProfe
::
	$StÜeProfesToP©h
(cÚ¡ 
¡d
::
¡ršg
 &
fe_·th
)

582 
boŞ
 
bR‘
 = 
çl£
;

584 
SYSUTILS_SPACE
::
XMLT»e
 
Œ“
;

585 
SYSUTILS_SPACE
::
XMLEËm’t
 
–em’t
;

587 
–em’t
 = 
Œ“
.
	`S‘RoÙ
("Profiles");

589 
¡d
::
m­
<
ušt64_t
, 
CPlugšPÏtfÜmCÚfigD©a
*>::
™”©Ü
 
™e
 = 
m_cÚfig_li¡
.
	`begš
();

590 
™e
 !ğ
m_cÚfig_li¡
.
	`’d
();

591 
™e
 ++)

593 
SYSUTILS_SPACE
::
XMLEËm’t
 
sub–em’t
 = 
–em’t
.
	`AddChd
("ManagerProfile");

594 ià(
NULL
 !ğ
™e
->
£cÚd
)

596 
™e
->
£cÚd
->
	`S”Ÿlize
(
sub–em’t
);

600 
bR‘
 = 
SYSUTILS_SPACE
::
	`SaveXMLT»e
(
fe_·th
, 
Œ“
);

601  
bR‘
;

602 
	}
}

604 
CPlugšPÏtfÜmCÚfigD©a
* 
	gCPlugšPÏtfÜmProfe
::
	$FšdCÚfigD©aByProfeID
(
ušt64_t
 
´ofe_id
)

606 
¡d
::
m­
<
ušt64_t
, 
CPlugšPÏtfÜmCÚfigD©a
*>::
™”©Ü
 
™e
 = 
m_cÚfig_li¡
.
	`fšd
(
´ofe_id
);

607 ià(
™e
 !ğ
m_cÚfig_li¡
.
	`’d
())

609  
™e
->
£cÚd
;

612  
NULL
;

613 
	}
}

615 
	gCPlugšPÏtfÜmProfe
::
	$Dump
()

617 
	`´štf
("<Profiles>\n");

618 
¡d
::
m­
<
ušt64_t
, 
CPlugšPÏtfÜmCÚfigD©a
*>::
™”©Ü
 
™e
 = 
m_cÚfig_li¡
.
	`begš
();

619 
™e
 !ğ
m_cÚfig_li¡
.
	`’d
();

620 
™e
 ++)

622 ià(
NULL
 !ğ
™e
->
£cÚd
)

624 
	`´štf
("<ManagerProfile>\n");

625 
™e
->
£cÚd
->
	`Dump
();

626 
	`´štf
("</ManagerProfile>\n");

629 
	`´štf
("</Profiles>\n");

630 
	}
}

	@../../titanutils/serverConfig/NetworkServiceConfig.h

1 #iâdeà
__N‘wÜk_FILE_BASE__


2 
	#__N‘wÜk_FILE_BASE__


	)

4 
	~<m­
>

5 
	~"commÚ/¡dšt.h
"

6 
	~"sûw/xml_–em’t.h
"

7 
	~"sûw/xml_Œ“.h
"

9 #ifdeà
WIN32


10 
	#ROOT_FILE_FOLDER
 "C:\\mnt\\NU20\\etc\\"

11 
	#OUT_CONFIG_FOLDER
 "ou‰”CÚfig\\"

	)

13 
	#ROOT_FILE_FOLDER
 "/NU20/‘c/"

	)

14 
	#OUT_CONFIG_FOLDER
 "ou‰”CÚfig/"

	)

17 
	#LAN_PORT_COUNT
 1

	)

18 şas 
	cCS”viûCÚfigD©aBa£


20 
	mpublic
:

21 
CS”viûCÚfigD©aBa£
();

22 
	mvœtu®
 ~
CS”viûCÚfigD©aBa£
();

24 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

25 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

26 
vœtu®
 
	`Dump
();

27 
vœtu®
 
	`DeçuÉV®ue
();

28 
vœtu®
 * 
	`S”v”Ty³
();

29 
boŞ
 
m_bEÇbË
;

30 
boŞ
 
m_bIsRemove
;

32 
´iv©e
:

33 
	`CS”viûCÚfigD©aBa£
(cÚ¡ 
CS”viûCÚfigD©aBa£
&);

34 
CS”viûCÚfigD©aBa£
 &
İ”©Ü
=(const CServiceConfigDataBase&);

37 şas 
	cCSÏveS”viûCÚfigD©a
: 
public
 
CS”viûCÚfigD©aBa£


39 
public
:

40 
	`CSÏveS”viûCÚfigD©a
();

41 
vœtu®
 ~
	`CSÏveS”viûCÚfigD©a
();

43 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

44 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

45 
vœtu®
 
	`Dump
();

46 
vœtu®
 * 
	`S”v”Ty³
();

48 
¡d
::
¡ršg
 
m_sMSIPAdd»ss
;

49 
ušt32_t
 
m_uMSPÜt
;

50 
¡d
::
¡ršg
 
m_sMSU£ºame
;

51 
¡d
::
¡ršg
 
m_sMSPasswÜd
;

53 
ušt32_t
 
m_uLªPÜt
[
LAN_PORT_COUNT
];

54 
¡d
::
¡ršg
 
m_sWANIPAdd»ss
;

55 
ušt32_t
 
m_uWANPÜt
;

58 
´iv©e
:

59 
	`CSÏveS”viûCÚfigD©a
(cÚ¡ 
CSÏveS”viûCÚfigD©a
 &);

60 
CSÏveS”viûCÚfigD©a
 &
İ”©Ü
=(const CSlaveServiceConfigData &);

63 şas 
	cCMSS”viûCÚfigD©a
: 
public
 
CS”viûCÚfigD©aBa£


65 
public
:

66 
	`CMSS”viûCÚfigD©a
();

67 
vœtu®
 ~
	`CMSS”viûCÚfigD©a
();

69 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

70 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

71 
vœtu®
 
	`Dump
();

72 
vœtu®
 
	`DeçuÉV®ue
();

73 
vœtu®
 * 
	`S”v”Ty³
();

75 
ušt32_t
 
m_uCommªdPÜt
;

77 
´iv©e
:

78 
	`CMSS”viûCÚfigD©a
(cÚ¡ 
CMSS”viûCÚfigD©a
 &);

79 
CMSS”viûCÚfigD©a
 &
İ”©Ü
=(const CMSServiceConfigData&);

82 şas 
	cCRSS”viûCÚfigD©a
: 
public
 
CSÏveS”viûCÚfigD©a


84 
public
:

85 
	`CRSS”viûCÚfigD©a
();

86 
vœtu®
 ~
	`CRSS”viûCÚfigD©a
();

87 
vœtu®
 
	`DeçuÉV®ue
();

88 
vœtu®
 * 
	`S”v”Ty³
();

94 
´iv©e
:

95 
	`CRSS”viûCÚfigD©a
(cÚ¡ 
CRSS”viûCÚfigD©a
 &);

96 
CRSS”viûCÚfigD©a
 &
İ”©Ü
=(const CRSServiceConfigData &);

100 şas 
	cCMDSS”viûCÚfigD©a
: 
public
 
CSÏveS”viûCÚfigD©a


102 
public
:

103 
	`CMDSS”viûCÚfigD©a
();

104 
vœtu®
 ~
	`CMDSS”viûCÚfigD©a
();

105 
vœtu®
 
	`DeçuÉV®ue
();

106 
vœtu®
 * 
	`S”v”Ty³
();

108 
ušt32_t
 
m_uIVSLªPÜt
;

109 
ušt32_t
 
m_uIVSWªPÜt
;

111 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

112 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

113 
vœtu®
 
	`Dump
();

114 
´iv©e
:

115 
	`CMDSS”viûCÚfigD©a
(cÚ¡ 
CMDSS”viûCÚfigD©a
 &);

116 
CMDSS”viûCÚfigD©a
 &
İ”©Ü
=(const CMDSServiceConfigData &);

119 şas 
	cCN‘wÜkS”viûCÚfig


121 
public
:

122 
	eeS”v”Ty³


124 
eMS
,

125 
eRS
,

126 
eMDS
,

127 
eIVS
,

128 
ePlugš


130 
	`CN‘wÜkS”viûCÚfig
();

131 ~
	`CN‘wÜkS”viûCÚfig
();

132 
boŞ
 
	`G‘N‘wÜkS‘tšg
(cÚ¡ * 
feP©h
, 
CS”viûCÚfigD©aBa£
 *
pS”v”CÚfigD©a
);

133 
boŞ
 
	`G‘N‘wÜkS‘tšgFÜUI
(cÚ¡ *
·th
, 
CS”viûCÚfigD©aBa£
 *
pS”v”CÚfigD©a
);

134 
boŞ
 
	`S‘N‘wÜkS‘tšg
(cÚ¡ * 
feP©h
, cÚ¡ 
CS”viûCÚfigD©aBa£
 *
pS”v”CÚfigD©a
);

136 
boŞ
 
	`G‘NewCÚfigFeP©h
(
eS”v”Ty³
 
£rv”Ty³
, 
¡d
::
¡ršg
 &
sFeP©h
);

137 
	`Dump
(
CS”viûCÚfigD©aBa£
 *
pS”v”CÚfigD©a
);

138 
´Ùeùed
:

140 
´iv©e
:

141 
	`CN‘wÜkS”viûCÚfig
(cÚ¡ 
CN‘wÜkS”viûCÚfig
&);

142 
CN‘wÜkS”viûCÚfig
 &
İ”©Ü
=(const CNetworkServiceConfig&);

144 
	}
};

146 şas 
	cCPlugšPÏtfÜmCÚfigD©a
: 
public
 
CS”viûCÚfigD©aBa£


148 
public
:

149 
CPlugšPÏtfÜmCÚfigD©a
();

150 ~
CPlugšPÏtfÜmCÚfigD©a
();

151 
	mCPlugšPÏtfÜmCÚfigD©a
 &
	mİ”©Ü
=(cÚ¡ 
CPlugšPÏtfÜmCÚfigD©a
&);

152 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

153 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

154 
vœtu®
 
	`Dump
();

155 
vœtu®
 
	`DeçuÉV®ue
();

156 
vœtu®
 * 
	`S”v”Ty³
();

157 
public
:

158 
boŞ
 
m_hasProfeID
;

159 
ušt64_t
 
m_uÎProfeID
;

161 
boŞ
 
m_hasProfeName
;

162 
¡d
::
¡ršg
 
m_sProfeName
;

164 
boŞ
 
m_hasMDSIPAdd»ss
;

165 
¡d
::
¡ršg
 
m_sMDSIPAdd»ss
;

167 
boŞ
 
m_hasMDSPÜt
;

168 
ušt32_t
 
m_uMDSPÜt
;

170 
boŞ
 
m_hasMgrU£ºame
;

171 
¡d
::
¡ršg
 
m_sMgrU£ºame
;

173 
boŞ
 
m_hasMgrPasswÜd
;

174 
¡d
::
¡ršg
 
m_sMgrPasswÜd
;

176 
´iv©e
:

177 
	`CPlugšPÏtfÜmCÚfigD©a
(cÚ¡ 
CPlugšPÏtfÜmCÚfigD©a
&);

180 şas 
	cCPlugšPÏtfÜmProfe


182 
public
:

183 
	`CPlugšPÏtfÜmProfe
();

184 ~
	`CPlugšPÏtfÜmProfe
();

185 
boŞ
 
	`LßdProfesFromP©h
(cÚ¡ 
¡d
::
¡ršg
 &
fe_·th
);

186 
boŞ
 
	`StÜeProfesToP©h
(cÚ¡ 
¡d
::
¡ršg
 &
fe_·th
);

187 
CPlugšPÏtfÜmCÚfigD©a
* 
	`FšdCÚfigD©aByProfeID
(
ušt64_t
 
´ofe_id
);

188 
	`Dump
();

189 
´iv©e
:

190 
	`CPlugšPÏtfÜmProfe
(cÚ¡ 
CPlugšPÏtfÜmProfe
&);

191 
CPlugšPÏtfÜmProfe
 &
İ”©Ü
=(const CPluginPlatformProfile&);

192 
´iv©e
:

193 
¡d
::
m­
<
ušt64_t
, 
CPlugšPÏtfÜmCÚfigD©a
*> 
m_cÚfig_li¡
;

	@../../titanutils/serverConfig/NetworkSettingConfig.cpp

1 
	~"N‘wÜkS‘tšgCÚfig.h
"

3 
	~<¡dio.h
>

4 
	~<¡ršg.h
>

5 
	~<®gÜ™hm
>

7 
	~"N‘wÜkS‘tšgXmlTagDef.h
"

8 
	~"sûw/xml_Œ“.h
"

9 
	~"commÚ/ut™y.h
"

10 
	~"commÚ/fe.h
"

11 
	~"commÚ/dœeùÜy_Œav”£.h
"

12 
	~"commÚ/¡ršg.h
"

14 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

16 #ifdeà
_DEBUG


17 
	#DEBUG_TRACE
(
fmt
, ...èdØ{ 
	`årštf
(
¡d”r
, "[N‘wÜkS‘tšg: %s:%d] "fmt, 
__FILE__
, 
__LINE__
, ##
__VA_ARGS__
); } 0)

	)

19 
	#DEBUG_TRACE
(...)

	)

22 cÚ¡ * 
	gETH_PREFIX
 = "eth";

24 *
	$»adfe
(cÚ¡ *
f•©h
, *
feSize
)

26 ià(
NULL
 =ğ
f•©h
)

27  
NULL
;

29 
FILE
 *
å
 = 
	`fİ’
(
f•©h
, "r");

30 ià(
NULL
 =ğ
å
)

31  
NULL
;

33 
_feSize
 = 0;

34 
	`f£ek
(
å
, 0, 
SEEK_END
);

35 
_feSize
 = 
	`á–l
(
å
);

36 
	`»wšd
(
å
);

37 ià(
_feSize
<1)

39 ià(
NULL
 !ğ
å
)

41 
	`fşo£
(
å
);

43  
NULL
;

45 ià(
feSize
!=
NULL
)

46 *
feSize
 = 
_feSize
;

48 *
buf
 = (*è
	`ÿÎoc
(
_feSize
+1, ());

49 ià(
NULL
 =ğ
buf
)

51 
	`fşo£
(
å
);

52  
NULL
;

54 
	`ä—d
(
buf
, 1, 
_feSize
, 
å
);

55 
buf
[
_feSize
] = '\0';

56 
	`fşo£
(
å
);

58  
buf
;

59 
	}
}

61 
boŞ
 
	$G‘O±iÚAsSŒšgLše_S
(cÚ¡ *
h—d”
, 
h—d”_size
, cÚ¡ *
İt
, 
¡d
::
¡ršg
& 
»t
)

63 cÚ¡ * 
±r
 = 
	`¡r¡r
(
h—d”
, 
İt
);

65 ià(
±r
 =ğ
NULL
)

66  
çl£
;

68 
»t
 = "";

69 
±r
 +ğ
	`¡¾’
(
İt
);

71  *
±r
 == ' ')

72 
±r
++;

74  *
±r
 !ğ'\r' && *±¸!ğ'\n' &&…Œ < 
h—d”
+
h—d”_size
 )

75 
»t
 +ğ*
±r
++;

77  
Œue
;

78 
	}
}

80 
	gCEth”—lInfo
::
	$CEth”—lInfo
()

81 : 
	`m_sIÁ”PrÙocŞ
("")

82 , 
	`m_sIPAddr
("")

83 , 
	`m_sSubMask
("")

84 , 
	`m_sDefG©eIPAddr
("")

85 , 
	`m_sPriDNS
("")

86 , 
	`m_sSecDNS
("")

87 , 
	`m_sMAC
("")

88 , 
	`m_iIndex
(-1)

91 
	}
}

93 
	gCEth”—lInfo
::~
	$CEth”—lInfo
()

96 
	}
}

98 
boŞ
 
CEth”—lInfo
::
İ”©Ü
<(cÚ¡ CEth”—lInfo& 
rhs
) const

100 if(
m_iIndex
 < 
rhs
.m_iIndex)

102  
Œue
;

106  
	gçl£
;

110 
boŞ
 
	gCEth”—lInfo
::
İ”©Ü
==(cÚ¡ 
CEth”—lInfo
& 
rhs
) const

112 if(
m_sIÁ”PrÙocŞ
 =ğ
rhs
.m_sIÁ”PrÙocŞ && 
m_iIndex
 =ğrhs.m_iIndex && 
m_sIPAddr
 ==„hs.m_sIPAddr

113 && 
m_sPriDNS
 =ğ
rhs
.m_sPriDNS && 
m_sSecDNS
 =ğrhs.m_sSecDNS && 
m_sSubMask
 ==„hs.m_sSubMask

114 && 
m_sDefG©eIPAddr
 =ğ
rhs
.m_sDefGateIPAddr

117  
Œue
;

121  
	gçl£
;

125 
	gCEth”—lInfo
& CEth”—lInfo::
İ”©Ü
=(cÚ¡ 
CEth”—lInfo
& 
rhs
)

127 
m_sIÁ”PrÙocŞ
 = 
rhs
.m_sInterProtocol;

128 
	gm_iIndex
 = 
rhs
.
m_iIndex
;

129 
	gm_sIPAddr
 = 
rhs
.
m_sIPAddr
;

130 
	gm_sDefG©eIPAddr
 = 
rhs
.
m_sDefG©eIPAddr
;

131 
	gm_sPriDNS
 = 
rhs
.
m_sPriDNS
;

132 
	gm_sSecDNS
 = 
rhs
.
m_sSecDNS
;

133 
	gm_sSubMask
 = 
rhs
.
m_sSubMask
;

134 
	gm_sMAC
 = 
rhs
.
m_sMAC
;

136  *
	gthis
;

139 
boŞ
 
	gCEth”—lInfo
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

141 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_INTER_PROTOCOL
, 
m_sIÁ”PrÙocŞ
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

142 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_IP_ADDRESS
, 
m_sIPAddr
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

143 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_NETMASK
, 
m_sSubMask
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

144 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_GATEWAY
, 
m_sDefG©eIPAddr
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

145 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_PRIMARY_DNS
, 
m_sPriDNS
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

146 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_SECONDARY_DNS
, 
m_sSecDNS
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

147 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_ETHEREAL_INDEX
, 
m_iIndex
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

148 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_MAC
, 
m_sMAC
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

150  
Œue
;

151 
	}
}

211 
boŞ
 
	gCEth”—lInfo
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

213 
m_sIÁ”PrÙocŞ
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_INTER_PROTOCOL
).
	`G‘CÚ‹Á
();

214 
m_sIPAddr
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_IP_ADDRESS
).
	`G‘CÚ‹Á
();

215 
m_sSubMask
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_NETMASK
).
	`G‘CÚ‹Á
();

216 
m_sDefG©eIPAddr
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_GATEWAY
).
	`G‘CÚ‹Á
();

217 
m_sPriDNS
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_PRIMARY_DNS
).
	`G‘CÚ‹Á
();

218 
m_sSecDNS
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_SECONDARY_DNS
).
	`G‘CÚ‹Á
();

219 
m_sMAC
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_MAC
).
	`G‘CÚ‹Á
();

220 
m_iIndex
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_SECONDARY_DNS
);

222  
Œue
;

223 
	}
}

225 
	gCEth”—lInfo
::
	$Dump
()

227 
XMLT»e
 
Œ“
;

228 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("CEtherealInfo");

229 
this
->
	`S”Ÿlize
(
roÙ
);

230 
¡d
::
¡ršg
 
sOut
;

231 
SYSUTILS_SPACE
::
	`SaveXMLT»eBufãr
(
sOut
, 
Œ“
);

232 
	`DEBUG_TRACE
("%s\n", 
sOut
.
	`c_¡r
());

234 
	}
}

236 
	gCN‘wÜkS‘tšg
::
	$CN‘wÜkS‘tšg
()

237 : 
	`m_sComName
("")

238 , 
	`m_sWANInf
("")

240 
m_EthInfoLi¡
.
	`ş—r
();

241 
	}
}

243 
	gCN‘wÜkS‘tšg
::~
	$CN‘wÜkS‘tšg
()

246 
	}
}

308 
boŞ
 
CN‘wÜkS‘tšg
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

310 
XMLEËm’t
 
‘hNode
, 
‘hLi¡Node
;

311 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_SERVER_NAME
, 
m_sComName
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

312 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_WAN_INF
, 
m_sWANInf
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

313 
	`IF_EQUAL_RETURN_VALUE
(
‘hLi¡Node
 = 
roÙ
.
	`AddChd
(
XML_NETWORK_ELEMENT_ETHEREAL_DEVICE_LIST
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

314 
ušt32_t
 
i
=0; i<
m_EthInfoLi¡
.
	`size
(); i++)

316 
	`IF_EQUAL_RETURN_VALUE
(
‘hNode
 = 
‘hLi¡Node
.
	`AddChd
(
XML_NETWORK_ELEMENT_ETHEREAL_DEVICE
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

317 
m_EthInfoLi¡
[
i
].
	`S”Ÿlize
(
‘hNode
);

320  
Œue
;

321 
	}
}

323 
boŞ
 
	gCN‘wÜkS‘tšg
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

325 
m_sComName
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_SERVER_NAME
).
	`G‘CÚ‹Á
();

326 
m_sWANInf
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_WAN_INF
).
	`G‘CÚ‹Á
();

327 
XMLEËm’t
 
‘hInfoLi¡Node
 = 
roÙ
.
	`G‘Chd
(
XML_NETWORK_ELEMENT_ETHEREAL_DEVICE_LIST
);

328 
	`IF_EQUAL_RETURN_VALUE
(
‘hInfoLi¡Node
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

329 
¡d
::
veùÜ
<
XMLEËm’t
> 
‘hInfoLi¡
 = 
roÙ
.
	`G‘Chd»n
(
XML_NETWORK_ELEMENT_ETHEREAL_DEVICE
);

330 
ušt32_t
 
i
=0;i<
‘hInfoLi¡
.
	`size
(); i++)

332 
CEth”—lInfo
 
‘hInfo
;

333 
‘hInfo
.
	`Un£rŸlize
(
‘hInfoLi¡
[
i
]);

334 
m_EthInfoLi¡
.
	`push_back
(
‘hInfo
);

337  
Œue
;

338 
	}
}

340 
	gCN‘wÜkS‘tšg
::
	$Dump
()

342 
XMLT»e
 
Œ“
;

343 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
(
XML_NETWORK_ELEMENT_NETWORK_SETTING
);

344 
this
->
	`S”Ÿlize
(
roÙ
);

345 
¡d
::
¡ršg
 
sOut
;

346 
SYSUTILS_SPACE
::
	`SaveXMLT»eBufãr
(
sOut
, 
Œ“
);

347 
	`´štf
("%s\n", 
sOut
.
	`c_¡r
());

349 
	}
}

351 
	gCN‘wÜkS‘tšg
& CN‘wÜkS‘tšg::
İ”©Ü
=(cÚ¡ 
CN‘wÜkS‘tšg
& 
rhs
)

353 
m_sComName
 = 
rhs
.m_sComName;

354 
	gm_sWANInf
 = 
rhs
.
m_sWANInf
;

355 
ušt32_t
 
	gi
=0;i<
	grhs
.
	gm_EthInfoLi¡
.
size
();i++)

357 
	gm_EthInfoLi¡
.
push_back
(
rhs
.
m_EthInfoLi¡
[
i
]);

359  *
	gthis
;

362 
	gCN‘wÜkS‘tšgMªag”
::
	$CN‘wÜkS‘tšgMªag”
()

365 
	}
}

367 
CN‘wÜkS‘tšgMªag”
::~
	$CN‘wÜkS‘tšgMªag”
()

370 
	}
}

372 
boŞ
 
CN‘wÜkS‘tšgMªag”
::
	$G‘N‘wÜkS‘tšg
(cÚ¡ * 
sS”v”NamefeP©h
, cÚ¡ * 
sEthFeP©h
,

373 
CN‘wÜkS‘tšg
 *
pS”v”CÚfigD©a
)

375 ià(
sS”v”NamefeP©h
 =ğ
NULL
 || 
sEthFeP©h
 =ğNULL || 0==
	`¡rcmp
(sEthFeP©h, ""è|| 
pS”v”CÚfigD©a
 == NULL)

377  
çl£
;

379 
boŞ
 
bR‘
 = 
	`Qu”yComName
(
sS”v”NamefeP©h
, 
pS”v”CÚfigD©a
->
m_sComName
);

380 
boŞ
 
bR‘1
 = 
	`Œav”£Eth»®CÚfigFŞd”
(
sEthFeP©h
, 
pS”v”CÚfigD©a
->
m_EthInfoLi¡
);

381 
boŞ
 
bR‘2
 = 
	`Qu”yWANInf
(
sEthFeP©h
, 
pS”v”CÚfigD©a
->
m_sWANInf
);

383  (
bR‘
 && 
bR‘1
 && 
bR‘2
);

384 
	}
}

397 
	gCN‘wÜkS‘tšgMªag”
::
	$DumpToBufãr
(
CN‘wÜkS‘tšg
 *
pS”v”CÚfigD©a
, 
¡d
::
¡ršg
 &
sOut
)

399 
XMLT»e
 
Œ“
;

400 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
(
XML_NETWORK_ELEMENT_NETWORK_SETTING
);

401 
pS”v”CÚfigD©a
->
	`S”Ÿlize
(
roÙ
);

402 
SYSUTILS_SPACE
::
	`SaveXMLT»eBufãr
(
sOut
, 
Œ“
);

403 
	}
}

405 
	gCN‘wÜkS‘tšgMªag”
::
	$Dump
(
CN‘wÜkS‘tšg
 *
pS”v”CÚfigD©a
)

407 
XMLT»e
 
Œ“
;

408 
XMLEËm’t
 
roÙ
 = 
Œ“
.
	`S‘RoÙ
(
XML_NETWORK_ELEMENT_NETWORK_SETTING
);

409 
pS”v”CÚfigD©a
->
	`S”Ÿlize
(
roÙ
);

410 
¡d
::
¡ršg
 
sOut
;

411 
SYSUTILS_SPACE
::
	`SaveXMLT»eBufãr
(
sOut
, 
Œ“
);

412 
	`DEBUG_TRACE
("%s\n", 
sOut
.
	`c_¡r
());

413 
	}
}

415 
boŞ
 
	gCN‘wÜkS‘tšgMªag”
::
	$Qu”yComName
(cÚ¡ *
feP©h
, 
¡d
::
¡ršg
 &
sName
)

417 
feSizeComName
 = 0;

418 *
bufComName
 = 
	`»adfe
(
feP©h
, &
feSizeComName
);

419 
¡d
::
¡ršg
 
¡rComName
 = "";

420 
boŞ
 
bR‘
 = 
çl£
;

422 ià(
NULL
 !ğ
bufComName
 && 
feSizeComName
 > 0)

424 
	`G‘O±iÚAsSŒšgLše_S
(
bufComName
, 
	`¡¾’
(bufComName), "HOSTNAME=", 
¡rComName
);

425 
sName
 = 
¡rComName
;

426 
bR‘
 = 
Œue
;

428 ià(
bufComName
 !ğ
NULL
)

430 
	`ä“
(
bufComName
);

431 
bufComName
 = 
NULL
;

433  
bR‘
;

434 
	}
}

436 
boŞ
 
	gCN‘wÜkS‘tšgMªag”
::
	$Qu”yWANInf
(cÚ¡ *
feP©h
, 
¡d
::
¡ršg
 &
sName
)

438 
feSize
 = 0;

439 
¡d
::
¡ršg
 
wªInffuÎP©h
 = std::
	`¡ršg
(
feP©h
) + "/internet";

440 *
buf
 = 
	`»adfe
(
wªInffuÎP©h
.
	`c_¡r
(), &
feSize
);

441 
boŞ
 
bR‘
 = 
çl£
;

443 ià(
NULL
 !ğ
buf
 && 
feSize
 > 0)

445 
¡d
::
¡ršg
 
¡rV®ue
 = "";

446 
	`G‘O±iÚAsSŒšgLše_S
(
buf
, 
	`¡¾’
(buf), "INTERNET=", 
¡rV®ue
);

447 
sName
 = 
¡rV®ue
;

448 
bR‘
 = 
Œue
;

450 ià(
buf
 !ğ
NULL
)

452 
	`ä“
(
buf
);

453 
buf
 = 
NULL
;

456  
bR‘
;

457 
	}
}

459 
boŞ
 
	gCN‘wÜkS‘tšgMªag”
::
	$qu”y_‘h_£tup_fe
(cÚ¡ *
‘hFeP©h
, cÚ¡ *
DHCPFeP©h
, 
CEth”—lInfo
 &
‘hInfoI‹m
)

461 ià(
‘hFeP©h
 =ğ
NULL
 || 
DHCPFeP©h
 == NULL)

463  
çl£
;

466 
feSizeIfcfg0
 = 0, 
feSizeDhı0
 = 0;

467 *
bufIfcfg
 = 
	`»adfe
(
‘hFeP©h
, &
feSizeIfcfg0
);

468 *
bufDHCP
 = 
	`»adfe
(
DHCPFeP©h
, &
feSizeDhı0
);

469 
¡d
::
¡ršg
 
¡rComName
, 
¡rIÁ”PrÙocŞ0
, 
¡rIpAddr0
, 
¡rSubMask0
, 
¡rDefG©eIpAddr0
, 
¡rPriDns0
, 
¡rSecDns0
;

471 ià(
NULL
 !ğ
bufIfcfg
 && 
feSizeIfcfg0
 > 0)

473 
	`G‘O±iÚAsSŒšgLše_S
(
bufIfcfg
, 
	`¡¾’
(bufIfcfg), "BOOTPROTO=", 
¡rIÁ”PrÙocŞ0
);

474 ià(
¡rIÁ”PrÙocŞ0
 == "dhcp")

476 
‘hInfoI‹m
.
m_sIÁ”PrÙocŞ
 = "auto";

480 
‘hInfoI‹m
.
m_sIÁ”PrÙocŞ
 = "manual";

483 ià(
¡rIÁ”PrÙocŞ0
 == "dhcp")

485 ià(
NULL
 !ğ
bufDHCP
 && 
feSizeDhı0
 > 0)

487 
	`G‘O±iÚAsSŒšgLše_S
(
bufDHCP
, 
	`¡¾’
(bufDHCP), "IP=", 
¡rIpAddr0
);

488 
	`G‘O±iÚAsSŒšgLše_S
(
bufDHCP
, 
	`¡¾’
(bufDHCP), "NETMASK=", 
¡rSubMask0
);

489 
	`G‘O±iÚAsSŒšgLše_S
(
bufDHCP
, 
	`¡¾’
(bufDHCP), "GATEWAY=", 
¡rDefG©eIpAddr0
);

490 
	`G‘O±iÚAsSŒšgLše_S
(
bufDHCP
, 
	`¡¾’
(bufDHCP), "DNS1=", 
¡rPriDns0
);

491 
	`G‘O±iÚAsSŒšgLše_S
(
bufDHCP
, 
	`¡¾’
(bufDHCP), "DNS2=", 
¡rSecDns0
);

496 
	`G‘O±iÚAsSŒšgLše_S
(
bufIfcfg
, 
	`¡¾’
(bufIfcfg), "IP=", 
¡rIpAddr0
);

497 
	`G‘O±iÚAsSŒšgLše_S
(
bufIfcfg
, 
	`¡¾’
(bufIfcfg), "NETMASK=", 
¡rSubMask0
);

498 
	`G‘O±iÚAsSŒšgLše_S
(
bufIfcfg
, 
	`¡¾’
(bufIfcfg), "GATEWAY=", 
¡rDefG©eIpAddr0
);

499 
	`G‘O±iÚAsSŒšgLše_S
(
bufIfcfg
, 
	`¡¾’
(bufIfcfg), "DNS1=", 
¡rPriDns0
);

500 
	`G‘O±iÚAsSŒšgLše_S
(
bufIfcfg
, 
	`¡¾’
(bufIfcfg), "DNS2=", 
¡rSecDns0
);

503 
‘hInfoI‹m
.
m_sIPAddr
 = 
¡rIpAddr0
;

504 
‘hInfoI‹m
.
m_sSubMask
 = 
¡rSubMask0
;

505 
‘hInfoI‹m
.
m_sDefG©eIPAddr
 = 
¡rDefG©eIpAddr0
;

506 
‘hInfoI‹m
.
m_sPriDNS
 = 
¡rPriDns0
;

507 
‘hInfoI‹m
.
m_sSecDNS
 = 
¡rSecDns0
;

512 ià(
bufIfcfg
 !ğ
NULL
)

514 
	`ä“
(
bufIfcfg
);

516 ià(
bufDHCP
 !ğ
NULL
)

518 
	`ä“
(
bufDHCP
);

521  
Œue
;

522 
	}
}

524 
boŞ
 
	gCN‘wÜkS‘tšgMªag”
::
Œav”£Eth»®CÚfigFŞd”
(cÚ¡ *
fŞd”P©h
, 
¡d
::
veùÜ
<
CEth”—lInfo
> &
‘hInfoLi¡
)

526 
IF_EQUAL_RETURN_VALUE
(
fŞd”P©h
, 
NULL
, 
çl£
);

527 
	g‘hInfoLi¡
.
ş—r
();

528 
DœeùÜyT¿v”£
 
dt
(
fŞd”P©h
);

529 
	gdt
.
Next
())

531 
	g¡d
::
¡ršg
 
ÃxtFeName
 = 
dt
.
G‘P©hName
();

533 
S¶™P©hD©a
 
	gd©a
;

534 
S¶™P©h
(
ÃxtFeName
, 
d©a
);

535 ià(
	gd©a
.
	gfe_ba£
.
com·»
(0, 
¡¾’
(
ETH_PREFIX
), ETH_PREFIX) == 0)

538 
sMACAdd»ss
[256] = {0};

539 
	g‘hIdx
 = -1;

540 ià(
ssÿnf
(
d©a
.
fe_ba£
.
c_¡r
(), "‘h%d-%255s", &
‘hIdx
, 
sMACAdd»ss
) == 2)

543 ià(
‘hIdx
 >= 0 &&ƒthIdx < 128)

545 
CEth”—lInfo
 
‘hInfo
;

546 
	gDHCPCÚfigFe
[256] = {0};

547 
¥rštf
(
DHCPCÚfigFe
, "/v¬/run/udhı/‘h%d", 
‘hIdx
);

548 
qu”y_‘h_£tup_fe
(
ÃxtFeName
.
c_¡r
(), 
DHCPCÚfigFe
, 
‘hInfo
);

549 
	g‘hInfo
.
	gm_iIndex
 = 
‘hIdx
;

551 
	gfÜm©MAC
[256] = {0};

553 
ušt32_t
 
	gcİyCouÁ
 = 0;

554 
ušt32_t
 
	gi
=0, 
	gj
=0;i< 
¡¾’
(
sMACAdd»ss
); j++)

557 ià(
	gcİyCouÁ
!=0&&
cİyCouÁ
%2==0)

559 
fÜm©MAC
[
j
] = ':';

560 
	gcİyCouÁ
 = 0;

564 
	gfÜm©MAC
[
j
] = 
touµ”
(
sMACAdd»ss
[
i
]);

565 
	gi
++;

566 
	gcİyCouÁ
++;

569 
	g‘hInfo
.
	gm_sMAC
 = 
fÜm©MAC
;

570 
	g‘hInfoLi¡
.
push_back
(
‘hInfo
);

579 
	g¡d
::
sÜt
(
‘hInfoLi¡
.
begš
(),ƒthInfoLi¡.
’d
());

580  
	gŒue
;

583 
boŞ
 
	gCN‘wÜkS‘tšgMªag”
::
G‘Eth»®CÚfigLi¡
(cÚ¡ *
fŞd”P©h
, 
¡d
::
veùÜ
<¡d::
¡ršg
> &
feLi¡
)

585 
IF_EQUAL_RETURN_VALUE
(
fŞd”P©h
, 
NULL
, 
çl£
);

586 
DœeùÜyT¿v”£
 
dt
(
fŞd”P©h
);

587 
	gdt
.
Next
())

589 
	g¡d
::
¡ršg
 
ÃxtFeName
 = 
dt
.
G‘P©hName
();

591 
S¶™P©hD©a
 
	gd©a
;

592 
S¶™P©h
(
ÃxtFeName
, 
d©a
);

593 ià(
	gd©a
.
	gfe_ba£
.
com·»
(0, 
¡¾’
(
ETH_PREFIX
), ETH_PREFIX) == 0)

596 
sMACAdd»ss
[256] = {0};

597 
	g‘hIdx
 = -1;

598 ià(
ssÿnf
(
d©a
.
fe_ba£
.
c_¡r
(), "‘h%d-%255s", &
‘hIdx
, 
sMACAdd»ss
) == 2)

601 ià(
‘hIdx
 >= 0 &&ƒthIdx < 128)

603 
feLi¡
.
push_back
(
ÃxtFeName
.
c_¡r
());

613  
	gŒue
;

	@../../titanutils/serverConfig/NetworkSettingConfig.h

1 #iâdeà
__N‘wÜk_SETTING_CONFIG__


2 
	#__N‘wÜk_SETTING_CONFIG__


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"sûw/xml_–em’t.h
"

6 
	~"sûw/xml_Œ“.h
"

10 şas 
	cCEth”—lInfo


12 
	mpublic
:

13 
CEth”—lInfo
();

14 
	mvœtu®
 ~
CEth”—lInfo
();

15 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

17 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

18 
vœtu®
 
	`Dump
();

20 
¡d
::
¡ršg
 
m_sIÁ”PrÙocŞ
;

21 
¡d
::
¡ršg
 
m_sIPAddr
;

22 
¡d
::
¡ršg
 
m_sSubMask
;

23 
¡d
::
¡ršg
 
m_sDefG©eIPAddr
;

24 
¡d
::
¡ršg
 
m_sPriDNS
;

25 
¡d
::
¡ršg
 
m_sSecDNS
;

26 
¡d
::
¡ršg
 
m_sMAC
;

27 
m_iIndex
;

29 
boŞ
 
İ”©Ü
<(cÚ¡ 
CEth”—lInfo
& 
rhs
) const;

30 
boŞ
 
İ”©Ü
==(cÚ¡ 
CEth”—lInfo
& 
rhs
) const;

31 
CEth”—lInfo
 &
İ”©Ü
=(const CEtherealInfo&);

32 
´iv©e
:

37 şas 
	cCN‘wÜkS‘tšg


39 
public
:

40 
	`CN‘wÜkS‘tšg
();

41 
vœtu®
 ~
	`CN‘wÜkS‘tšg
();

43 
vœtu®
 
boŞ
 
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const;

45 
vœtu®
 
boŞ
 
	`Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
);

46 
vœtu®
 
	`Dump
();

47 
¡d
::
¡ršg
 
m_sComName
;

48 
¡d
::
¡ršg
 
m_sWANInf
;

49 
¡d
::
veùÜ
<
CEth”—lInfo
> 
m_EthInfoLi¡
;

50 
CN‘wÜkS‘tšg
 &
İ”©Ü
=(const CNetworkSetting&);

52 
´iv©e
:

53 
	`CN‘wÜkS‘tšg
(cÚ¡ 
CN‘wÜkS‘tšg
&);

56 şas 
	cCN‘wÜkS‘tšgMªag”


58 
public
:

59 
	`CN‘wÜkS‘tšgMªag”
();

60 ~
	`CN‘wÜkS‘tšgMªag”
();

61 
boŞ
 
	`G‘N‘wÜkS‘tšg
(cÚ¡ * 
sS”v”NamefeP©h
, cÚ¡ * 
sEthFeP©h
,

62 
CN‘wÜkS‘tšg
 *
pS”v”CÚfigD©a
);

66 
	`DumpToBufãr
(
CN‘wÜkS‘tšg
 *
pS”v”CÚfigD©a
, 
¡d
::
¡ršg
 &
out
);

67 
	`Dump
(
CN‘wÜkS‘tšg
 *
pS”v”CÚfigD©a
);

68 
boŞ
 
	`G‘Eth»®CÚfigLi¡
(cÚ¡ *
fŞd”P©h
, 
¡d
::
veùÜ
<¡d::
¡ršg
> &
feLi¡
);

69 
boŞ
 
	`Qu”yWANInf
(cÚ¡ *
‘hFeP©h
, 
¡d
::
¡ršg
 &
sName
);

70 
´Ùeùed
:

72 
´iv©e
:

73 
	`CN‘wÜkS‘tšgMªag”
(cÚ¡ 
CN‘wÜkS‘tšgMªag”
&);

74 
CN‘wÜkS‘tšgMªag”
 &
İ”©Ü
=(const CNetworkSettingManager&);

75 
boŞ
 
	`Œav”£Eth»®CÚfigFŞd”
(cÚ¡ *
fŞd”P©h
, 
¡d
::
veùÜ
<
CEth”—lInfo
> &
‘hInfoLi¡
);

77 
boŞ
 
	`qu”y_‘h_£tup_fe
(cÚ¡ *
‘hFeP©h
, cÚ¡ *
DHCPFeP©h
, 
CEth”—lInfo
 &
‘hInfoI‹m
);

78 
boŞ
 
	`Qu”yComName
(cÚ¡ *
‘hFeP©h
, 
¡d
::
¡ršg
 &
sName
);

	@../../titanutils/serverConfig/NetworkSettingXmlTagDef.h

1 #iâdeà
_NETWORK_SETTING_XML_TAG_DEF_H_


2 
	#_NETWORK_SETTING_XML_TAG_DEF_H_


	)

5 
	#XML_NETWORK_ELEMENT_ENABLE
 "’abË"

	)

6 
	#XML_NETWORK_ELEMENT_COMMAND_PORT
 "commªdPÜt"

	)

7 
	#XML_NETWORK_ELEMENT_MSIPADDRESS
 "MSIPAdd»ss"

	)

8 
	#XML_NETWORK_ELEMENT_MSUSERNAME
 "MSU£ºame"

	)

9 
	#XML_NETWORK_ELEMENT_MSPASSWORD
 "MSPasswÜd"

	)

10 
	#XML_NETWORK_ELEMENT_LANPORT1
 "LANPÜt1"

	)

11 
	#XML_NETWORK_ELEMENT_LANPORT2
 "LANPÜt2"

	)

12 
	#XML_NETWORK_ELEMENT_WANADDRESS
 "WANIPAdd»ss"

	)

13 
	#XML_NETWORK_ELEMENT_WANPORT
 "WANPÜt"

	)

14 
	#XML_NETWORK_ELEMENT_IS_REMOVE
 "IsRemove"

	)

16 
	#XML_NETWORK_ELEMENT_NETWORK_SETTING
 "N‘wÜkS‘tšg"

	)

17 
	#XML_NETWORK_ELEMENT_WAN_INF
 "WªInf"

	)

18 
	#XML_NETWORK_ELEMENT_SERVER_NAME
 "ComName"

	)

19 
	#XML_NETWORK_ELEMENT_ETHEREAL_DEVICE_LIST
 "Eth»®I‹mLi¡"

	)

20 
	#XML_NETWORK_ELEMENT_ETHEREAL_DEVICE
 "Eth»®I‹m"

	)

21 
	#XML_NETWORK_ELEMENT_ETHEREAL_INDEX
 "Index"

	)

22 
	#XML_NETWORK_ELEMENT_INTER_PROTOCOL
 "IÁ”PrÙocŞ"

	)

23 
	#XML_NETWORK_ELEMENT_IP_ADDRESS
 "IPAdd»ss"

	)

24 
	#XML_NETWORK_ELEMENT_NETMASK
 "N‘mask"

	)

25 
	#XML_NETWORK_ELEMENT_GATEWAY
 "G‘eway"

	)

26 
	#XML_NETWORK_ELEMENT_PRIMARY_DNS
 "PriDns"

	)

27 
	#XML_NETWORK_ELEMENT_SECONDARY_DNS
 "SecDns"

	)

28 
	#XML_NETWORK_ELEMENT_MAC
 "MAC"

	)

30 
	#XML_NETWORK_ELEMENT_HNA_CONFIG
 "vmW©chdog"

	)

31 
	#XML_NETWORK_ELEMENT_HNA_ENABLE
 "’abË"

	)

32 
	#XML_NETWORK_ELEMENT_HNA_PERIOD
 "³riod"

	)

34 
	#XML_NETWORK_ELEMENT_IVSLANPORT
 "IVSLANPÜt"

	)

35 
	#XML_NETWORK_ELEMENT_IVSWANPORT
 "IVSWANPÜt"

	)

	@../../titanutils/serverConfig/ServerProtocolDataStruct.cpp

1 
	~"S”v”PrÙocŞD©aSŒuù.h
"

2 
	~"commÚ/ut™y.h
"

3 
	~<¡dio.h
>

5 
usšg
 
Çme¥aû
 
	gSERVER_PROTOCOL_DATA
;

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
	gFTPCÚfig
::
	$FTPCÚfig
()

9 : 
	`
("")

10 , 
	`pÜt
(21)

11 , 
	`Çme
("")

12 , 
	`·sswÜd
("")

13 , 
	`subFŞd”
("")

16 
	}
}

18 
boŞ
 
	gFTPCÚfig
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

22 
XMLEËm’t
 
xml
 = 
roÙ
.
	`AddChd
("FTPConfig");

23 
XMLEËm’t
 
xmlIÁ”çû
 = 
xml
.
	`AddChd
("Interface");

24 
	`IF_EQUAL_RETURN_VALUE
(
xmlIÁ”çû
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

25 
XMLEËm’t
 
xmlIP
 = 
xmlIÁ”çû
.
	`AddChd
("IP", 

);

26 
	`IF_EQUAL_RETURN_VALUE
(
xmlIP
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

27 
xmlIP
.
	`AddA‰ribu‹
("version", "IPv4");

28 
	`IF_EQUAL_RETURN_VALUE
(
xmlIÁ”çû
.
	`AddChd
("PÜt", 
pÜt
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

30 
	`IF_EQUAL_RETURN_VALUE
(
xml
.
	`AddChd
("U£ºame", 
Çme
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

31 
	`IF_EQUAL_RETURN_VALUE
(
xml
.
	`AddChd
("PasswÜd", 
·sswÜd
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

32 
	`IF_EQUAL_RETURN_VALUE
(
xml
.
	`AddChd
("SubFŞd”", 
subFŞd”
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

33  
Œue
;

34 
	}
}

36 
boŞ
 
	gFTPCÚfig
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

40 
XMLEËm’t
 
xml
 = 
roÙ
.
	`G‘Chd
("FTPConfig");

41 
XMLEËm’t
 
xmlIÁ”çû
 = 
xml
.
	`G‘Chd
("Interface");

42 
	`IF_EQUAL_RETURN_VALUE
(
xmlIÁ”çû
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

43 

 = 
xmlIÁ”çû
.
	`G‘Chd
("IP").
	`G‘CÚ‹Á
();

44 
pÜt
 = 
xmlIÁ”çû
.
	`G‘Chd
("Port");

46 
Çme
 = 
xml
.
	`G‘Chd
("U£ºame").
	`G‘CÚ‹Á
();

47 
·sswÜd
 = 
xml
.
	`G‘Chd
("PasswÜd").
	`G‘CÚ‹Á
();

48 
subFŞd”
 = 
xml
.
	`G‘Chd
("SubFŞd”").
	`G‘CÚ‹Á
();

49  
Œue
;

50 
	}
}

52 
	gAutoBackupCÚfig
::
	$AutoBackupCÚfig
()

53 : 
	`’abË
(
çl£
)

54 , 
	`dayBackupTime
(0)

55 , 
	`¡¬tTime
(0)

56 , 
	`’dTime
(0)

57 , 
	`IsFaov”
(
çl£
)

58 , 
	$IsFaov”Exi¡
(
çl£
)

61 
	}
}

63 
boŞ
 
	gAutoBackupCÚfig
::
	$S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
) const

65 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
("EÇbË", 
’abË
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

66 
ápCÚfig
.
	`S”Ÿlize
(
roÙ
);

67 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
("DayBackupTime", 
dayBackupTime
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

68 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
("D©aS¹Time", 
¡¬tTime
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

69 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
("D©aEndTime", 
’dTime
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

71 
XMLEËm’t
 
xmlCam”aLi¡
 = 
roÙ
.
	`AddChd
("CameraList");

72 
	`IF_EQUAL_RETURN_VALUE
(
xmlCam”aLi¡
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

73 
i
=0; i<
ÿm”aLi¡
.
id
.
	`size
();i++)

75 
XMLEËm’t
 
xmlCam”a
 = 
xmlCam”aLi¡
.
	`AddChd
("Camera");

76 
	`IF_EQUAL_RETURN_VALUE
(
xmlCam”a
, 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

77 
xmlCam”a
.
	`AddA‰ribu‹
("id", 
ÿm”aLi¡
.
id
[
i
]);

80 
	`IF_EQUAL_RETURN_VALUE
(
roÙ
.
	`AddChd
("IsFaov”", 
IsFaov”
), 
XMLEËm’t
::
em±y_–em’t
, 
çl£
);

81  
Œue
;

82 
	}
}

84 
boŞ
 
	gAutoBackupCÚfig
::
	$Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
roÙ
)

86 
’abË
 = 
roÙ
.
	`G‘Chd
("Enable");

87 
ápCÚfig
.
	`Un£rŸlize
(
roÙ
);

89 
dayBackupTime
 = 
roÙ
.
	`G‘Chd
("DailyBackupTime");

90 
¡¬tTime
 = 
roÙ
.
	`G‘Chd
("DataStartTime");

91 
’dTime
 = 
roÙ
.
	`G‘Chd
("DataEndTime");

93 
¡d
::
veùÜ
<
XMLEËm’t
> 
xmlCam”aLi¡
 = 
roÙ
.
	`G‘Chd
("Cam”aLi¡").
	`G‘Chd»n
("Camera");

94 
i
=0; i<
xmlCam”aLi¡
.
	`size
();i++)

96 
ušt64_t
 
id
 = 
xmlCam”aLi¡
[
i
].
	`G‘A‰ribu‹
("id");

97 
ÿm”aLi¡
.
id
.
	`push_back
(id);

99 
SYSUTILS_SPACE
::
XMLEËm’t
 
nodeFaov”
 = 
roÙ
.
	`G‘Chd
("IsFailover");

100 ià(
nodeFaov”
 =ğ
XMLEËm’t
::
em±y_–em’t
)

102 
IsFaov”Exi¡
 = 
çl£
;

103 
IsFaov”
 = 
çl£
;

104 
	`´štf
("[autobackup] isFailover‚otƒxist\n");

108 
IsFaov”Exi¡
 = 
Œue
;

109 
IsFaov”
 = 
roÙ
.
	`G‘Chd
("IsFailover");

112  
Œue
;

113 
	}
}

	@../../titanutils/serverConfig/ServerProtocolDataStruct.h

1 #iâdeà
_SERVER_PROTOCOL_DATA_STRCT_H_


2 
	#_SERVER_PROTOCOL_DATA_STRCT_H_


	)

4 
	~"commÚ/¡dšt.h
"

5 
	~"sûw/xml_–em’t.h
"

6 
	~"sûw/xml_Œ“.h
"

8 
Çme¥aû
 
	gSERVER_PROTOCOL_DATA


11 
	sFTPCÚfig


13 
	gpublic
:

14 
¡d
::
¡ršg
 

;

15 
	gpÜt
;

16 
	g¡d
::
¡ršg
 
Çme
;

17 
	g¡d
::
¡ršg
 
·sswÜd
;

18 
	g¡d
::
¡ršg
 
subFŞd”
;

20 
FTPCÚfig
();

21 
boŞ
 
S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
xml
) const;

22 
boŞ
 
Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
xml
);

27 
	sBITS64_IDLi¡


29 
	gpublic
:

30 
¡d
::
veùÜ
<
ušt64_t
>
id
;

33 
	sAutoBackupCÚfig


35 
	gpublic
:

36 
boŞ
 
’abË
;

37 
FTPCÚfig
 
	gápCÚfig
;

38 
	gdayBackupTime
;

39 
	g¡¬tTime
;

40 
	g’dTime
;

41 
BITS64_IDLi¡
 
	gÿm”aLi¡
;

42 
boŞ
 
	gIsFaov”
;

43 
boŞ
 
	gIsFaov”Exi¡
;

45 
AutoBackupCÚfig
();

46 
boŞ
 
S”Ÿlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
xml
) const;

47 
boŞ
 
Un£rŸlize
(
SYSUTILS_SPACE
::
XMLEËm’t
& 
xml
);

	@../../titanutils/serverConfig/TimeInfoHelper.cpp

1 
	~"TimeInfoH–³r.h
"

2 #iâdeà
WIN32


3 
	~<time.h
>

4 
	~<ùime
>

5 
	~<uni¡d.h
>

6 
	~<¡dio.h
>

8 
	g¡d
::
¡ršg
 
	$G‘DayTimeSavšgLšk
()

10 #ifdeà
WIN32


14 
buff
[1024];

15 
size_t
 
Ën
 = ::
	`»adlšk
("/‘c/loÿÉime", 
buff
, (buff)-1);

16 ià(
Ën
 !ğ(
size_t
) -1)

18 
buff
[
Ën
] = '\0';

20  
¡d
::
	`¡ršg
(
buff
);

25 
	`´štf
("ÿÁ„—dlšk %s\n", 
buff
);

26  
¡d
::
	`¡ršg
("");

29 
	}
}

31 
boŞ
 
	gCTimeInfoH–³r
::
	$G‘TimeInfo
(
¡d
::
¡ršg
 &
TimeZÚe
, &
DSOff£t
, &
UTCOff£t
)

33 #ifdeà
WIN32


35  
çl£
;

37 
¡d
::
time_t
 
cu¼’t_time
;

38 
¡d
::
tm
 *
timešfo
;

40 
¡d
::
¡ršg
 
timeZÚeLšk
 = 
	`G‘DayTimeSavšgLšk
();

41 ià(
timeZÚeLšk
 == "")

43  
çl£
;

46 cÚ¡ * 
pTimeZÚe
 = 
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "GMT");

47 ià(
pTimeZÚe
 =ğ
NULL
)

49 
	`´štf
("G‘TimeInfØ·r£imezÚçed: %s\n", 
timeZÚeLšk
.
	`c_¡r
());

50  
çl£
;

53 ià(
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "/usr/share/zoneinfo/GMT"))

55 
TimeZÚe
 = 
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "GMT");

56 
DSOff£t
 = 0;

58 ià(
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "/usr/share/zoneinfo/2+/GMT"))

60 
TimeZÚe
 = 
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "GMT");

61 
DSOff£t
 = 2;

63 ià(
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "/usr/share/zoneinfo/1+/GMT"))

65 
TimeZÚe
 = 
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "GMT");

66 
DSOff£t
 = 1;

68 ià(
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "/usr/share/zoneinfo/1-/GMT"))

70 
TimeZÚe
 = 
	`¡r¡r
(
timeZÚeLšk
.
	`c_¡r
(), "GMT");

71 
DSOff£t
 = -1;

75 
	`´štf
( "Parseime zone settingƒrror!\n");

78 
	`tz£t
();

79 
¡d
::
	`time
(&
cu¼’t_time
);

80 
timešfo
 = 
¡d
::
	`loÿÉime
(&
cu¼’t_time
);

82 ià(
timešfo
)

84 
bufãr
 [80];

85 
	`¡ráime
(
bufãr
, 80, "Now it' %I:%M%p. %Z", 
timešfo
);

87 
UTCOff£t
 = 
timešfo
->
tm_gmtoff
;

91 
	`´štf
("GetTimeInfo():†ocaltime() failed\n");

94 
DSOff£t
 = DSOffset * 60;

95 
UTCOff£t
 = UTCOffset / 60;

97  
Œue
;

99 
	}
}

	@../../titanutils/serverConfig/TimeInfoHelper.h

1 #iâdeà
__TIME_INFO_HELPER_H__


2 
	#__TIME_INFO_HELPER_H__


	)

4 
	~"commÚ/š‰y³s.h
"

5 
	~"commÚ/¡ršg.h
"

7 şas 
	cCTimeInfoH–³r


9 
	mpublic
:

10 
CTimeInfoH–³r
();

11 
	mvœtu®
 ~
CTimeInfoH–³r
();

14 
boŞ
 
G‘TimeInfo
(
¡d
::
¡ršg
 &
TimeZÚe
, &
DSOff£t
, &
UTCOff£t
);

	@../../titanutils/titanminihelper/DiskHelper.cpp

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~<¡dlib.h
>

4 
	~<sys/vfs.h
>

5 
	~<mÁ’t.h
>

6 
	~<sys/¡©.h
>

7 
	~<”ºo.h
>

8 
	~"commÚ/fe.h
"

9 
	~"commÚ/¡ršg.h
"

10 
	~"DiskH–³r.h
"

11 
	~"cÚ¡/P©hCÚ¡.h
"

13 
Çme¥aû
 
	gDiskH–³r
 {

15 
mÁ’t
 *
mouÁpošt
(cÚ¡ *
f’ame
, mÁ’ˆ*
mÁ
, *
buf
, 
size_t
 
buæ’
)

17 
¡©
 
	gs
;

18 
FILE
 * 
	gå
;

19 
dev_t
 
	gdev
;

21 ià(
¡©
(
f’ame
, &
s
) != 0)

23  
NULL
;

26 
	gdev
 = 
s
.
¡_dev
;

28 ià((
	gå
 = 
£tmÁ’t
("/´oc/mouÁs", "r")è=ğ
NULL
)

30  
NULL
;

33 
g‘mÁ’t_r
(
å
, 
mÁ
, 
buf
, 
buæ’
))

35 ià(
¡©
(
mÁ
->
mÁ_dœ
, &
s
) != 0)

40 ià(
	gs
.
	g¡_dev
 =ğ
dev
)

42 
’dmÁ’t
(
å
);

43  
	gmÁ
;

47 
’dmÁ’t
(
å
);

50 
	g”ºo
 = 
EINVAL
;

51  
	gNULL
;

54 
boŞ
 
CheckMouÁFeSy¡em
(cÚ¡ *
f’ame
, cÚ¡ * 
fesy¡em
)

56 
	gbuf
[4096] = {0};

57 
mÁ’t
 
	gmÁ
;

58 
mÁ’t
* 
	gp_mÁ
;

59 
	gp_mÁ
 = 
mouÁpošt
(
f’ame
, &
mÁ
, 
buf
, (buf));

60 ià(
	gp_mÁ
 !ğ
NULL
)

62 ià(
NULL
 !ğ
p_mÁ
->
mÁ_ty³
 && NULL !ğp_mÁ->
mÁ_dœ
)

64 
´štf
 ("CheckMouÁAndFeSy¡em : % mÁ_ty³ : %s, mouÁed oÀ: %s\n", 
f’ame
, 
p_mÁ
->
mÁ_ty³
,…_mÁ->
mÁ_dœ
);

65 ià(
	gNULL
 =ğ
¡r¡r
(
p_mÁ
->
mÁ_ty³
, 
fesy¡em
))

67 
´štf
 ("CheckMouÁAndFeSy¡em : % nÙ cÜ»ù fesy¡em\n", 
f’ame
);

68  
	gçl£
;

73 
´štf
 ("CheckMouÁAndFeSy¡em:: % i nÙ mouÁed \n", 
f’ame
);

74  
	gçl£
;

79 
´štf
 ("CheckMouÁAndFeSy¡em:: % p_mÁ i NULL \n", 
f’ame
);

80  
	gçl£
;

83  
	gŒue
;

86 
	g¡d
::
¡ršg
 
Ex³ùedFeSy¡em
(cÚ¡ * 
fŞd”
)

88 
¡d
::
¡ršg
 
fesys
;

90 ià(0 =ğ
¡rcmp
 (
fŞd”
, "/mnt/"))

92 
	gfesys
 = "ext4";

94 ià(0 =ğ
¡rcmp
 (
fŞd”
, "/nfs/"))

96 
	gfesys
 = "nfs";

98  
	gfesys
;

101 
G‘Cu¼’tAvaabËVŞume
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
vŞume_·ths
)

103 
i
=0; 
	gi
<
	gRL_VIDEODATA_PARENT_FOLDER_COUNT
; i++)

105 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
tmp_vŞume_·ths
 = 
SYSUTILS_SPACE
::
G‘SubDœeùÜy
(
RL_VIDEODATA_PARENT_FOLDER
[
i
]);

106 
	g¡d
::
¡ršg
 
fesy¡em
 = 
Ex³ùedFeSy¡em
(
RL_VIDEODATA_PARENT_FOLDER
[
i
]);

107 ià(
	gfesy¡em
 == "")

110 
	gj
=0; j<()
	gtmp_vŞume_·ths
.
size
(); j++)

112 
´štf
 ("G‘Cu¼’tAvaabËVŞum%s%d %s\n", 
RL_VIDEODATA_PARENT_FOLDER
[
i
], 
j
, 
tmp_vŞume_·ths
[j].
c_¡r
());

113 ià(
	gNULL
 !ğ
¡r¡r
(
tmp_vŞume_·ths
[
j
].
c_¡r
(), 
VOLUME_FOLDER
))

115 
	g¡d
::
¡ršg
 
tmp_·ths
 = 
SYSUTILS_SPACE
::
¡ršg_fÜm©
("%s%s"

116 , 
RL_VIDEODATA_PARENT_FOLDER
[
i
], 
tmp_vŞume_·ths
[
j
].
c_¡r
());

118 ià(
CheckMouÁFeSy¡em
(
tmp_·ths
.
c_¡r
(), 
fesy¡em
.c_str()))

120 ià(
	gSYSUTILS_SPACE
::
CheckFeExi¡
(
tmp_·ths
 + "/uuid"))

122 
vŞume_·ths
.
push_back
(
tmp_·ths
);

123 
´štf
 ("G‘Cu¼’tAvaabËVŞumpush_back % tØvŞume_·th\n", 
tmp_·ths
.
c_¡r
());

127 
´štf
 ("G‘Cu¼’tAvaabËVŞum%s/uuid‚Ùƒxi¡ \n", 
tmp_·ths
.
c_¡r
());

132 
´štf
 ("G‘Cu¼’tAvaabËVŞum% CheckMouÁFeSy¡emƒ¼Ü \n", 
tmp_·ths
.
c_¡r
());

140 
G‘Cu¼’tAvaabËVideoFŞd”
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
video_·ths
)

142 
G‘Cu¼’tAvaabËVŞume
(
video_·ths
);

143 
	gi
=0; i<()
	gvideo_·ths
.
size
(); i++)

145 
	gvideo_·ths
[
i
] = 
SYSUTILS_SPACE
::
¡ršg_fÜm©
("%s/VIDEODATA", 
video_·ths
[i].
c_¡r
());

151 
G‘Cu¼’tAvaabËVideoFŞd”
(*
couÁ
, ***
loÿtiÚ
)

154 iàĞ
	gNULL
 =ğ
couÁ


155 || 
NULL
 =ğ
loÿtiÚ
)

158 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
videod©a_·ths
;

159 
G‘Cu¼’tAvaabËVŞume
(
videod©a_·ths
);

160 
	gvŞume_couÁ
 = ()
videod©a_·ths
.
size
();

161 
´štf
 ("G‘Cu¼’tAvaabËVideoFŞd” vŞume_couÁ=%d\n", 
vŞume_couÁ
);

163 **
	gtmp_loÿtiÚ
 = (**è
m®loc
(
vŞume_couÁ
*(**));

164 ià(
	gNULL
 =ğ
tmp_loÿtiÚ
)

166 
mem£t
(
tmp_loÿtiÚ
, 0, 
vŞume_couÁ
*(*));

168 #ifdeà
_CHECK_VOLUME_RECORDABLE


169 
Sy¡emInfo
 
	gsysšfo
;

170 
	g»Œy_couÁ
 = 0;

171 
	g»Œy_couÁ
 < 3)

173 ià(0 =ğ
G‘Sy¡emInfoR•Üt
(&
sysšfo
))

177 
	g»Œy_couÁ
++;

179 ià(
	g»Œy_couÁ
 >= 3)

181 
ASSERT
(0);

186 
	gtÙ®_vŞume
 = 0;

187 
size_t
 
	gi
=0; i<
	gvideod©a_·ths
.
size
(); i++)

189 
	gvideod©a_·ths
[
i
] = 
SYSUTILS_SPACE
::
¡ršg_fÜm©
("%s/VIDEODATA", 
videod©a_·ths
[i].
c_¡r
());

190 #ifdeà
_CHECK_VOLUME_RECORDABLE


191 ià(
	gi
 >ğ
sysšfo
.
diskInfo
.
size
())

194 ià(
¡¾’
(
sysšfo
.
diskInfo
[
i
].
vŞume_Çme
è> 0 && !
	gsysšfo
.
	gdiskInfo
[i].
	gvŞume_»cÜdabË
)

199 iàĞ
	gSYSUTILS_SPACE
::
ROOTFS_PROTECT
(
videod©a_·ths
[
i
].
c_¡r
()) )

201 
tmp_loÿtiÚ
[ 
tÙ®_vŞume
 ] = 
¡rdup
(
videod©a_·ths
[
i
].
c_¡r
());

202 ++
	gtÙ®_vŞume
;

205 *
	gcouÁ
 = 
tÙ®_vŞume
;

206 *
	gloÿtiÚ
 = 
tmp_loÿtiÚ
;

211 
SaãF»eCu¼’tAvaabËVideoFŞd”
(*
couÁ
, ***
loÿtiÚ
)

213 ià(
	gNULL
 =ğ
loÿtiÚ
 || 
NULL
 =ğ
couÁ
)

218 ** 
	gp
 = *
loÿtiÚ
;

219 
	gnum_loÿtiÚ
 = *
couÁ
;

221 ià(
	gNULL
 !ğ
p
)

223 
i
 = 0; 
	gi
 < 
	gnum_loÿtiÚ
; ++i)

225 ià(
	gNULL
 !ğ
p
[
i
])

227 
ä“
(
p
[
i
]);

228 
	gp
[
i
] = 
NULL
;

232 
ä“
(
p
);

233 
	gp
 = 
NULL
;

236 *
	gcouÁ
 = 0;

237 *
	gloÿtiÚ
 = 
NULL
;

242 
G‘Fœ¡AvaabËVŞume
(
¡d
::
¡ršg
& 
fœ¡_vŞume
)

244 
¡d
::
veùÜ
<¡d::
¡ršg
> 
vŞume_·ths
;

245 
G‘Cu¼’tAvaabËVŞume
(
vŞume_·ths
);

247 ià(
	gvŞume_·ths
.
size
() < 1)

252 
	gfœ¡_vŞume
 = 
vŞume_·ths
[0];

257 
	g¡d
::
¡ršg
 
G‘VŞumeName
(cÚ¡ * 
fuÎ_vŞume_·th
)

259 
¡d
::
¡ršg
 
vŞume_Çme
 = "";

260 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
v_loÿtiÚ_¡r
;

261 
	gv_loÿtiÚ_¡r
 = 
SYSUTILS_SPACE
::
¡ršg_¥l™
(
fuÎ_vŞume_·th
, "/");

263 
	gi
=0; i<()
	gv_loÿtiÚ_¡r
.
size
(); i++)

265 
´štf
 ("DiskH–³r::G‘VŞumeNamv_loÿtiÚ_¡r[%d]=%s\n", 
i
, 
v_loÿtiÚ_¡r
[i].
c_¡r
());

273 ià(
	gv_loÿtiÚ_¡r
.
size
() < 3)

276  
	gvŞume_Çme
;

279 ià(
	gNULL
 !ğ
¡r¡r
(
fuÎ_vŞume_·th
, "nfs"))

281 
	gvŞume_Çme
 = 
SYSUTILS_SPACE
::
¡ršg_fÜm©
("%s_NFS", 
v_loÿtiÚ_¡r
[2].
c_¡r
());

285 
	gvŞume_Çme
 = 
v_loÿtiÚ_¡r
[2];

288  
	gvŞume_Çme
;

291 
boŞ
 
G‘UUID
(cÚ¡ 
¡d
::
¡ršg
& 
vŞumeP©h
, std::¡ršg& 
vŞumeUUID
)

293 
¡d
::
¡ršg
 
uuidF’ame
 = 
SYSUTILS_SPACE
::
ResŞveP©h
(
vŞumeP©h
è+ 
SLASH
 +"uuid";

295 
FILE
* 
	gpFe
 = 
fİ’
(
uuidF’ame
.
c_¡r
(), "r");

296 ià(
	gpFe
 !ğ
NULL
)

298 
ušt32_t
 
vŞumeUUIDSize
 = (ušt32_t)
SYSUTILS_SPACE
::
G‘FeStÜageSize
(
uuidF’ame
);

299 * 
	gbuf
 = (*)
m®loc
(
vŞumeUUIDSize
);

301 ià(
ä—d
(
buf
, 1, 
vŞumeUUIDSize
, 
pFe
) != volumeUUIDSize)

303 
ä“
(
buf
);

304 
fşo£
(
pFe
);

305 
	gpFe
 = 
NULL
;

307  
	gçl£
;

310 
	gvŞumeUUID
 = 
¡d
::
¡ršg
(
buf
, 
vŞumeUUIDSize
);

312 
ä“
(
buf
);

313 
fşo£
(
pFe
);

314 
	gpFe
 = 
NULL
;

316  
	gŒue
;

320 
´štf
("uuid fdÛ¢'ˆexi¡: %s!!\n", 
uuidF’ame
.
c_¡r
());

322  
	gçl£
;

	@../../titanutils/titanminihelper/DiskHelper.h

1 #iâdeà
__DISKHELPER_H__


2 
	#__DISKHELPER_H__


	)

4 #iâdeà
SLASH


5 #ifdeà
WIN32


6 
	#SLASH
 "\\"

	)

8 
	#SLASH
 "/"

	)

12 
Çme¥aû
 
	gDiskH–³r
 {

13 
mÁ’t
 *
mouÁpošt
(cÚ¡ *
f’ame
, mÁ’ˆ*
mÁ
, *
buf
, 
size_t
 
buæ’
);

14 
G‘Cu¼’tAvaabËVŞume
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
vŞume_·ths
);

15 
G‘Cu¼’tAvaabËVideoFŞd”
(*
couÁ
, ***
loÿtiÚ
);

16 
G‘Cu¼’tAvaabËVideoFŞd”
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
video_·ths
);

17 
SaãF»eCu¼’tAvaabËVideoFŞd”
(*
couÁ
, ***
loÿtiÚ
);

18 
	g¡d
::
¡ršg
 
G‘VŞumeName
(cÚ¡ * 
fuÎ_vŞume_·th
);

19 
G‘Fœ¡AvaabËVŞume
(
¡d
::
¡ršg
& 
fœ¡_vŞume
);

20 
boŞ
 
G‘UUID
(cÚ¡ 
¡d
::
¡ršg
& 
vŞumeP©h
, std::¡ršg& 
vŞumeUUID
);

	@../../titanutils/titanminihelper/NuFNVHash.cpp

1 
	~<memÜy.h
>

2 
	~"NuFNVHash.h
"

8 
	#FNV_64_PRIME
 ((
ušt64_t
)0x100000001B3ULL)

	)

9 
	#OFFSET_BASIS
 ((
ušt64_t
)14695981039346656037ULL)

	)

11 
ušt64_t
 
	$NuFNVHash_64_Buf
(
_š_
 cÚ¡ * 
buf
, _š_ cÚ¡ 
Ën
, _š_ cÚ¡ 
ušt64_t
 
š™_hv®
)

16 
ušt64_t
 
hv®
 = 
š™_hv®
;

17 cÚ¡ * 
bp
 = (cÚ¡ *)
buf
;

18 cÚ¡ * 
be
 = 
bp
 + 
Ën
;

20 
bp
 < 
be
)

22 
hv®
 *ğ
FNV_64_PRIME
;

23 
hv®
 ^ğ(
ušt64_t
)*
bp
++;

26  
hv®
;

27 
	}
}

29 
ušt64_t
 
	$NuFNVHash_64a_Buf
(
_š_
 cÚ¡ * 
buf
, _š_ cÚ¡ 
Ën
, _š_ cÚ¡ 
ušt64_t
 
š™_hv®
)

34 
ušt64_t
 
hv®
 = 
š™_hv®
;

35 cÚ¡ * 
bp
 = (cÚ¡ *)
buf
;

36 cÚ¡ * 
be
 = 
bp
 + 
Ën
;

38 
bp
 < 
be
)

40 
hv®
 ^ğ(
ušt64_t
)*
bp
++;

41 
hv®
 *ğ
FNV_64_PRIME
;

44  
hv®
;

45 
	}
}

47 
ušt64_t
 
	$NuFNVHash_64_Buf_XÜFŞd
(
_š_
 cÚ¡ * 
buf
, _š_ cÚ¡ 
Ën
, _š_ cÚ¡ 
ušt64_t
 
š™_hv®
, _š_ cÚ¡ 
nB™s
)

51 cÚ¡ 
ušt64_t
 
mask
 = (((ušt64_t)1 << 
nB™s
) - 1);

52 
ušt64_t
 
hv®
 = 
	`NuFNVHash_64_Buf
(
buf
, 
Ën
, 
š™_hv®
);

53 
hv®
 = (hv® >> 
nB™s
è^ (hv® & 
mask
);

56  
hv®
;

57 
	}
}

59 
ušt64_t
 
	$NuFNVHash_64a_Buf_XÜFŞd
(
_š_
 cÚ¡ * 
buf
, _š_ cÚ¡ 
Ën
, _š_ cÚ¡ 
ušt64_t
 
š™_hv®
, _š_ cÚ¡ 
nB™s
)

63 cÚ¡ 
ušt64_t
 
mask
 = (((ušt64_t)1 << 
nB™s
) - 1);

64 
ušt64_t
 
hv®
 = 
	`NuFNVHash_64a_Buf
(
buf
, 
Ën
, 
š™_hv®
);

65 
hv®
 = (hv® >> 
nB™s
è^ (hv® & 
mask
);

68  
hv®
;

69 
	}
}

71 #ià!
defšed
 (
__RELEASE
)

73 
	#LEN
(
x
è((x)-1)

	)

75 
	#TEST
(
x
è{x, 
	`LEN
(x)}

	)

77 
	#TEST0
(
x
è{x, (x)}

	)

79 
	#R500
(
x
è
	`R100
(x)R100(x)R100(x)R100(x)R100(x)

	)

80 
	#R100
(
x
è
	`R10
(x)R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)

	)

81 
	#R10
(
x
èx x x x x x x x x 
	)
x

83 
ušt64_t
 
	tFnv64_t
;

85 
	s‹¡_veùÜ
 {

86 cÚ¡ *
	mbuf
;

87 
	mËn
;

89 
	sâv1_64_‹¡_veùÜ
 {

90 
‹¡_veùÜ
 *
	m‹¡
;

91 
Fnv64_t
 
	mâv1_64
;

93 
	sâv1a_64_‹¡_veùÜ
 {

94 
‹¡_veùÜ
 *
	m‹¡
;

95 
Fnv64_t
 
	mâv1a_64
;

98 
‹¡_veùÜ
 
	gâv_‹¡_¡r
[] = {

99 
TEST
(""),

100 
TEST
("a"),

101 
TEST
("b"),

102 
TEST
("c"),

103 
TEST
("d"),

104 
TEST
("e"),

105 
TEST
("f"),

106 
TEST
("fo"),

107 
TEST
("foo"),

108 
TEST
("foob"),

109 
TEST
("fooba"),

110 
TEST
("foobar"),

111 
TEST0
(""),

112 
TEST0
("a"),

113 
TEST0
("b"),

114 
TEST0
("c"),

115 
TEST0
("d"),

116 
TEST0
("e"),

117 
TEST0
("f"),

118 
TEST0
("fo"),

119 
TEST0
("foo"),

120 
TEST0
("foob"),

121 
TEST0
("fooba"),

122 
TEST0
("foobar"),

123 
TEST
("ch"),

124 
TEST
("cho"),

125 
TEST
("chon"),

126 
TEST
("chong"),

127 
TEST
("chongo"),

128 
TEST
("chongo "),

129 
TEST
("chongo w"),

130 
TEST
("chongo wa"),

131 
TEST
("chongo was"),

132 
TEST
("chongo was "),

133 
TEST
("chongo was h"),

134 
TEST
("chongo was he"),

135 
TEST
("chongo was her"),

136 
TEST
("chongo was here"),

137 
TEST
("chongo was here!"),

138 
TEST
("chongo was here!\n"),

139 
TEST0
("ch"),

140 
TEST0
("cho"),

141 
TEST0
("chon"),

142 
TEST0
("chong"),

143 
TEST0
("chongo"),

144 
TEST0
("chongo "),

145 
TEST0
("chongo w"),

146 
TEST0
("chongo wa"),

147 
TEST0
("chongo was"),

148 
TEST0
("chongo was "),

149 
TEST0
("chongo was h"),

150 
TEST0
("chongo was he"),

151 
TEST0
("chongo was her"),

152 
TEST0
("chongo was here"),

153 
TEST0
("chongo was here!"),

154 
TEST0
("chongo was here!\n"),

155 
TEST
("cu"),

156 
TEST
("cur"),

157 
TEST
("curd"),

158 
TEST
("curds"),

159 
TEST
("curds "),

160 
TEST
("curds‡"),

161 
TEST
("curds‡n"),

162 
TEST
("curds‡nd"),

163 
TEST
("curds‡nd "),

164 
TEST
("curds‡nd w"),

165 
TEST
("curds‡nd wh"),

166 
TEST
("curds‡nd whe"),

167 
TEST
("curds‡nd whey"),

168 
TEST
("curds‡nd whey\n"),

169 
TEST0
("cu"),

170 
TEST0
("cur"),

171 
TEST0
("curd"),

172 
TEST0
("curds"),

173 
TEST0
("curds "),

174 
TEST0
("curds‡"),

175 
TEST0
("curds‡n"),

176 
TEST0
("curds‡nd"),

177 
TEST0
("curds‡nd "),

178 
TEST0
("curds‡nd w"),

179 
TEST0
("curds‡nd wh"),

180 
TEST0
("curds‡nd whe"),

181 
TEST0
("curds‡nd whey"),

182 
TEST0
("curds‡nd whey\n"),

183 
TEST
("hi"), 
TEST0
("hi"),

184 
TEST
("h–lo"), 
TEST0
("hello"),

185 
TEST
("\xff\x00\x00\x01"), TEST("\x01\x00\x00\xff"),

186 
TEST
("\xff\x00\x00\x02"), TEST("\x02\x00\x00\xff"),

187 
TEST
("\xff\x00\x00\x03"), TEST("\x03\x00\x00\xff"),

188 
TEST
("\xff\x00\x00\x04"), TEST("\x04\x00\x00\xff"),

189 
TEST
("\x40\x51\x4e\x44"), TEST("\x44\x4e\x51\x40"),

190 
TEST
("\x40\x51\x4e\x4a"), TEST("\x4a\x4e\x51\x40"),

191 
TEST
("\x40\x51\x4e\x54"), TEST("\x54\x4e\x51\x40"),

192 
TEST
("127.0.0.1"), 
TEST0
("127.0.0.1"),

193 
TEST
("127.0.0.2"), 
TEST0
("127.0.0.2"),

194 
TEST
("127.0.0.3"), 
TEST0
("127.0.0.3"),

195 
TEST
("64.81.78.68"), 
TEST0
("64.81.78.68"),

196 
TEST
("64.81.78.74"), 
TEST0
("64.81.78.74"),

197 
TEST
("64.81.78.84"), 
TEST0
("64.81.78.84"),

198 
TEST
("ãedçû"), 
TEST0
("feedface"),

199 
TEST
("ãedçûdaffd“d"), 
TEST0
("feedfacedaffdeed"),

200 
TEST
("ãedçûd—db“f"), 
TEST0
("feedfacedeadbeef"),

201 
TEST
("line 1\nline 2\nline 3"),

202 
TEST
("chongo <Landon Curt Noll> /\\../\\"),

203 
TEST0
("chongo <Landon Curt Noll> /\\../\\"),

204 
TEST
("chongo (Landon Curt Noll) /\\../\\"),

205 
TEST0
("chongo (Landon Curt Noll) /\\../\\"),

206 
TEST
("http://antwrp.gsfc.nasa.gov/apod/astropix.html"),

207 
TEST
("http://en.wikipedia.org/wiki/Fowler_Noll_Vo_hash"),

208 
TEST
("http://epod.usra.edu/"),

209 
TEST
("http://exoplanet.eu/"),

210 
TEST
("http://hvo.wr.usgs.gov/cam3/"),

211 
TEST
("http://hvo.wr.usgs.gov/cams/HMcam/"),

212 
TEST
("http://hvo.wr.usgs.gov/kilauea/update/deformation.html"),

213 
TEST
("http://hvo.wr.usgs.gov/kilauea/update/images.html"),

214 
TEST
("http://hvo.wr.usgs.gov/kilauea/update/maps.html"),

215 
TEST
("http://hvo.wr.usgs.gov/volcanowatch/current_issue.html"),

216 
TEST
("http://neo.jpl.nasa.gov/risk/"),

217 
TEST
("http://norvig.com/21-days.html"),

218 
TEST
("http://primes.utm.edu/curios/home.php"),

219 
TEST
("http://slashdot.org/"),

220 
TEST
("http://tux.wr.usgs.gov/Maps/155.25-19.5.html"),

221 
TEST
("http://volcano.wr.usgs.gov/kilaueastatus.php"),

222 
TEST
("http://www.avo.alaska.edu/activity/Redoubt.php"),

223 
TEST
("http://www.dilbert.com/fast/"),

224 
TEST
("http://www.fourmilab.ch/gravitation/orbits/"),

225 
TEST
("http://www.fpoa.net/"),

226 
TEST
("http://www.ioccc.org/index.html"),

227 
TEST
("http://www.isthe.com/cgi-bin/number.cgi"),

228 
TEST
("http://www.isthe.com/chongo/bio.html"),

229 
TEST
("http://www.isthe.com/chongo/index.html"),

230 
TEST
("http://www.isthe.com/chongo/src/calc/lucas-calc"),

231 
TEST
("http://www.isthe.com/chongo/tech/astro/venus2004.html"),

232 
TEST
("http://www.isthe.com/chongo/tech/astro/vita.html"),

233 
TEST
("http://www.isthe.com/chongo/tech/comp/c/expert.html"),

234 
TEST
("http://www.isthe.com/chongo/tech/comp/calc/index.html"),

235 
TEST
("http://www.isthe.com/chongo/tech/comp/fnv/index.html"),

236 
TEST
("http://www.isthe.com/chongo/tech/math/number/howhigh.html"),

237 
TEST
("http://www.isthe.com/chongo/tech/math/number/number.html"),

238 
TEST
("http://www.isthe.com/chongo/tech/math/prime/mersenne.html"),

239 
TEST
("http://www.isthe.com/chongo/tech/math/prime/mersenne.html#largest"),

240 
TEST
("http://www.lavarnd.org/cgi-bin/corpspeak.cgi"),

241 
TEST
("http://www.lavarnd.org/cgi-bin/haiku.cgi"),

242 
TEST
("http://www.lavarnd.org/cgi-bin/rand-none.cgi"),

243 
TEST
("http://www.lavarnd.org/cgi-bin/randdist.cgi"),

244 
TEST
("http://www.lavarnd.org/index.html"),

245 
TEST
("http://www.lavarnd.org/what/nist-test.html"),

246 
TEST
("http://www.macosxhints.com/"),

247 
TEST
("http://www.mellis.com/"),

248 
TEST
("http://www.nature.nps.gov/air/webcams/parks/havoso2alert/havoalert.cfm"),

249 
TEST
("http://www.nature.nps.gov/air/webcams/parks/havoso2alert/timelines_24.cfm"),

250 
TEST
("http://www.paulnoll.com/"),

251 
TEST
("http://www.pepysdiary.com/"),

252 
TEST
("http://www.sciencenews.org/index/home/activity/view"),

253 
TEST
("http://www.skyandtelescope.com/"),

254 
TEST
("http://www.sput.nl/~rob/sirius.html"),

255 
TEST
("http://www.systemexperts.com/"),

256 
TEST
("http://www.tq-international.com/phpBB3/index.php"),

257 
TEST
("http://www.travelquesttours.com/index.htm"),

258 
TEST
("http://www.wunderground.com/global/stations/89606.html"),

259 
TEST
(
R10
("21701")),

260 
TEST
(
R10
("M21701")),

261 
TEST
(
R10
("2^21701-1")),

262 
TEST
(
R10
("\x54\xc5")),

263 
TEST
(
R10
("\xc5\x54")),

264 
TEST
(
R10
("23209")),

265 
TEST
(
R10
("M23209")),

266 
TEST
(
R10
("2^23209-1")),

267 
TEST
(
R10
("\x5a\xa9")),

268 
TEST
(
R10
("\xa9\x5a")),

269 
TEST
(
R10
("391581216093")),

270 
TEST
(
R10
("391581*2^216093-1")),

271 
TEST
(
R10
("\x05\xf9\x9d\x03\x4c\x81")),

272 
TEST
(
R10
("FEDCBA9876543210")),

273 
TEST
(
R10
("\xfe\xdc\xba\x98\x76\x54\x32\x10")),

274 
TEST
(
R10
("EFCDAB8967452301")),

275 
TEST
(
R10
("\xef\xcd\xab\x89\x67\x45\x23\x01")),

276 
TEST
(
R10
("0123456789ABCDEF")),

277 
TEST
(
R10
("\x01\x23\x45\x67\x89\xab\xcd\xef")),

278 
TEST
(
R10
("1032547698BADCFE")),

279 
TEST
(
R10
("\x10\x32\x54\x76\x98\xba\xdc\xfe")),

280 
TEST
(
R500
("\x00")),

281 
TEST
(
R500
("\x07")),

282 
TEST
(
R500
("~")),

283 
TEST
(
R500
("\x7f")),

284 {
NULL
, 0}

287 
âv1_64_‹¡_veùÜ
 
	gâv1_64_veùÜ
[] = {

288 { &
âv_‹¡_¡r
[0], (
Fnv64_t
) 0xcbf29ce484222325ULL },

289 { &
âv_‹¡_¡r
[1], (
Fnv64_t
) 0xaf63bd4c8601b7beULL },

290 { &
âv_‹¡_¡r
[2], (
Fnv64_t
) 0xaf63bd4c8601b7bdULL },

291 { &
âv_‹¡_¡r
[3], (
Fnv64_t
) 0xaf63bd4c8601b7bcULL },

292 { &
âv_‹¡_¡r
[4], (
Fnv64_t
) 0xaf63bd4c8601b7bbULL },

293 { &
âv_‹¡_¡r
[5], (
Fnv64_t
) 0xaf63bd4c8601b7baULL },

294 { &
âv_‹¡_¡r
[6], (
Fnv64_t
) 0xaf63bd4c8601b7b9ULL },

295 { &
âv_‹¡_¡r
[7], (
Fnv64_t
) 0x08326207b4eb2f34ULL },

296 { &
âv_‹¡_¡r
[8], (
Fnv64_t
) 0xd8cbc7186ba13533ULL },

297 { &
âv_‹¡_¡r
[9], (
Fnv64_t
) 0x0378817ee2ed65cbULL },

298 { &
âv_‹¡_¡r
[10], (
Fnv64_t
) 0xd329d59b9963f790ULL },

299 { &
âv_‹¡_¡r
[11], (
Fnv64_t
) 0x340d8765a4dda9c2ULL },

300 { &
âv_‹¡_¡r
[12], (
Fnv64_t
) 0xaf63bd4c8601b7dfULL },

301 { &
âv_‹¡_¡r
[13], (
Fnv64_t
) 0x08326707b4eb37daULL },

302 { &
âv_‹¡_¡r
[14], (
Fnv64_t
) 0x08326607b4eb3627ULL },

303 { &
âv_‹¡_¡r
[15], (
Fnv64_t
) 0x08326507b4eb3474ULL },

304 { &
âv_‹¡_¡r
[16], (
Fnv64_t
) 0x08326407b4eb32c1ULL },

305 { &
âv_‹¡_¡r
[17], (
Fnv64_t
) 0x08326307b4eb310eULL },

306 { &
âv_‹¡_¡r
[18], (
Fnv64_t
) 0x08326207b4eb2f5bULL },

307 { &
âv_‹¡_¡r
[19], (
Fnv64_t
) 0xd8cbc7186ba1355cULL },

308 { &
âv_‹¡_¡r
[20], (
Fnv64_t
) 0x0378817ee2ed65a9ULL },

309 { &
âv_‹¡_¡r
[21], (
Fnv64_t
) 0xd329d59b9963f7f1ULL },

310 { &
âv_‹¡_¡r
[22], (
Fnv64_t
) 0x340d8765a4dda9b0ULL },

311 { &
âv_‹¡_¡r
[23], (
Fnv64_t
) 0x50a6d3b724a774a6ULL },

312 { &
âv_‹¡_¡r
[24], (
Fnv64_t
) 0x08326507b4eb341cULL },

313 { &
âv_‹¡_¡r
[25], (
Fnv64_t
) 0xd8d5c8186ba98bfbULL },

314 { &
âv_‹¡_¡r
[26], (
Fnv64_t
) 0x1ccefc7ef118dbefULL },

315 { &
âv_‹¡_¡r
[27], (
Fnv64_t
) 0x0c92fab3ad3db77aULL },

316 { &
âv_‹¡_¡r
[28], (
Fnv64_t
) 0x9b77794f5fdec421ULL },

317 { &
âv_‹¡_¡r
[29], (
Fnv64_t
) 0x0ac742dfe7874433ULL },

318 { &
âv_‹¡_¡r
[30], (
Fnv64_t
) 0xd7dad5766ad8e2deULL },

319 { &
âv_‹¡_¡r
[31], (
Fnv64_t
) 0xa1bb96378e897f5bULL },

320 { &
âv_‹¡_¡r
[32], (
Fnv64_t
) 0x5b3f9b6733a367d2ULL },

321 { &
âv_‹¡_¡r
[33], (
Fnv64_t
) 0xb07ce25cbea969f6ULL },

322 { &
âv_‹¡_¡r
[34], (
Fnv64_t
) 0x8d9e9997f9df0d6aULL },

323 { &
âv_‹¡_¡r
[35], (
Fnv64_t
) 0x838c673d9603cb7bULL },

324 { &
âv_‹¡_¡r
[36], (
Fnv64_t
) 0x8b5ee8a5e872c273ULL },

325 { &
âv_‹¡_¡r
[37], (
Fnv64_t
) 0x4507c4e9fb00690cULL },

326 { &
âv_‹¡_¡r
[38], (
Fnv64_t
) 0x4c9ca59581b27f45ULL },

327 { &
âv_‹¡_¡r
[39], (
Fnv64_t
) 0xe0aca20b624e4235ULL },

328 { &
âv_‹¡_¡r
[40], (
Fnv64_t
) 0xd8d5c8186ba98b94ULL },

329 { &
âv_‹¡_¡r
[41], (
Fnv64_t
) 0x1ccefc7ef118db81ULL },

330 { &
âv_‹¡_¡r
[42], (
Fnv64_t
) 0x0c92fab3ad3db71dULL },

331 { &
âv_‹¡_¡r
[43], (
Fnv64_t
) 0x9b77794f5fdec44eULL },

332 { &
âv_‹¡_¡r
[44], (
Fnv64_t
) 0x0ac742dfe7874413ULL },

333 { &
âv_‹¡_¡r
[45], (
Fnv64_t
) 0xd7dad5766ad8e2a9ULL },

334 { &
âv_‹¡_¡r
[46], (
Fnv64_t
) 0xa1bb96378e897f3aULL },

335 { &
âv_‹¡_¡r
[47], (
Fnv64_t
) 0x5b3f9b6733a367a1ULL },

336 { &
âv_‹¡_¡r
[48], (
Fnv64_t
) 0xb07ce25cbea969d6ULL },

337 { &
âv_‹¡_¡r
[49], (
Fnv64_t
) 0x8d9e9997f9df0d02ULL },

338 { &
âv_‹¡_¡r
[50], (
Fnv64_t
) 0x838c673d9603cb1eULL },

339 { &
âv_‹¡_¡r
[51], (
Fnv64_t
) 0x8b5ee8a5e872c201ULL },

340 { &
âv_‹¡_¡r
[52], (
Fnv64_t
) 0x4507c4e9fb006969ULL },

341 { &
âv_‹¡_¡r
[53], (
Fnv64_t
) 0x4c9ca59581b27f64ULL },

342 { &
âv_‹¡_¡r
[54], (
Fnv64_t
) 0xe0aca20b624e423fULL },

343 { &
âv_‹¡_¡r
[55], (
Fnv64_t
) 0x13998e580afa800fULL },

344 { &
âv_‹¡_¡r
[56], (
Fnv64_t
) 0x08326507b4eb3401ULL },

345 { &
âv_‹¡_¡r
[57], (
Fnv64_t
) 0xd8d5ad186ba95dc1ULL },

346 { &
âv_‹¡_¡r
[58], (
Fnv64_t
) 0x1c72e17ef0ca4e97ULL },

347 { &
âv_‹¡_¡r
[59], (
Fnv64_t
) 0x2183c1b327c38ae6ULL },

348 { &
âv_‹¡_¡r
[60], (
Fnv64_t
) 0xb66d096c914504f2ULL },

349 { &
âv_‹¡_¡r
[61], (
Fnv64_t
) 0x404bf57ad8476757ULL },

350 { &
âv_‹¡_¡r
[62], (
Fnv64_t
) 0x887976bd815498bbULL },

351 { &
âv_‹¡_¡r
[63], (
Fnv64_t
) 0x3afd7f02c2bf85a5ULL },

352 { &
âv_‹¡_¡r
[64], (
Fnv64_t
) 0xfc4476b0eb70177fULL },

353 { &
âv_‹¡_¡r
[65], (
Fnv64_t
) 0x186d2da00f77ecbaULL },

354 { &
âv_‹¡_¡r
[66], (
Fnv64_t
) 0xf97140fa48c74066ULL },

355 { &
âv_‹¡_¡r
[67], (
Fnv64_t
) 0xa2b1cf49aa926d37ULL },

356 { &
âv_‹¡_¡r
[68], (
Fnv64_t
) 0x0690712cd6cf940cULL },

357 { &
âv_‹¡_¡r
[69], (
Fnv64_t
) 0xf7045b3102b8906eULL },

358 { &
âv_‹¡_¡r
[70], (
Fnv64_t
) 0xd8d5ad186ba95db3ULL },

359 { &
âv_‹¡_¡r
[71], (
Fnv64_t
) 0x1c72e17ef0ca4ef3ULL },

360 { &
âv_‹¡_¡r
[72], (
Fnv64_t
) 0x2183c1b327c38a95ULL },

361 { &
âv_‹¡_¡r
[73], (
Fnv64_t
) 0xb66d096c914504d2ULL },

362 { &
âv_‹¡_¡r
[74], (
Fnv64_t
) 0x404bf57ad8476736ULL },

363 { &
âv_‹¡_¡r
[75], (
Fnv64_t
) 0x887976bd815498d5ULL },

364 { &
âv_‹¡_¡r
[76], (
Fnv64_t
) 0x3afd7f02c2bf85c1ULL },

365 { &
âv_‹¡_¡r
[77], (
Fnv64_t
) 0xfc4476b0eb70175fULL },

366 { &
âv_‹¡_¡r
[78], (
Fnv64_t
) 0x186d2da00f77eccdULL },

367 { &
âv_‹¡_¡r
[79], (
Fnv64_t
) 0xf97140fa48c7400eULL },

368 { &
âv_‹¡_¡r
[80], (
Fnv64_t
) 0xa2b1cf49aa926d52ULL },

369 { &
âv_‹¡_¡r
[81], (
Fnv64_t
) 0x0690712cd6cf9475ULL },

370 { &
âv_‹¡_¡r
[82], (
Fnv64_t
) 0xf7045b3102b89064ULL },

371 { &
âv_‹¡_¡r
[83], (
Fnv64_t
) 0x74f762479f9d6aeaULL },

372 { &
âv_‹¡_¡r
[84], (
Fnv64_t
) 0x08326007b4eb2b9cULL },

373 { &
âv_‹¡_¡r
[85], (
Fnv64_t
) 0xd8c4c9186b9b1a14ULL },

374 { &
âv_‹¡_¡r
[86], (
Fnv64_t
) 0x7b495389bdbdd4c7ULL },

375 { &
âv_‹¡_¡r
[87], (
Fnv64_t
) 0x3b6dba0d69908e25ULL },

376 { &
âv_‹¡_¡r
[88], (
Fnv64_t
) 0xd6b2b17bf4b71261ULL },

377 { &
âv_‹¡_¡r
[89], (
Fnv64_t
) 0x447bfb7f98e615b5ULL },

378 { &
âv_‹¡_¡r
[90], (
Fnv64_t
) 0xd6b2b17bf4b71262ULL },

379 { &
âv_‹¡_¡r
[91], (
Fnv64_t
) 0x3bd2807f93fe1660ULL },

380 { &
âv_‹¡_¡r
[92], (
Fnv64_t
) 0xd6b2b17bf4b71263ULL },

381 { &
âv_‹¡_¡r
[93], (
Fnv64_t
) 0x3329057f8f16170bULL },

382 { &
âv_‹¡_¡r
[94], (
Fnv64_t
) 0xd6b2b17bf4b71264ULL },

383 { &
âv_‹¡_¡r
[95], (
Fnv64_t
) 0x2a7f8a7f8a2e19b6ULL },

384 { &
âv_‹¡_¡r
[96], (
Fnv64_t
) 0x23d3767e64b2f98aULL },

385 { &
âv_‹¡_¡r
[97], (
Fnv64_t
) 0xff768d7e4f9d86a4ULL },

386 { &
âv_‹¡_¡r
[98], (
Fnv64_t
) 0x23d3767e64b2f984ULL },

387 { &
âv_‹¡_¡r
[99], (
Fnv64_t
) 0xccd1837e334e4aa6ULL },

388 { &
âv_‹¡_¡r
[100], (
Fnv64_t
) 0x23d3767e64b2f99aULL },

389 { &
âv_‹¡_¡r
[101], (
Fnv64_t
) 0x7691fd7e028f6754ULL },

390 { &
âv_‹¡_¡r
[102], (
Fnv64_t
) 0x34ad3b1041204318ULL },

391 { &
âv_‹¡_¡r
[103], (
Fnv64_t
) 0xa29e749ea9d201c8ULL },

392 { &
âv_‹¡_¡r
[104], (
Fnv64_t
) 0x34ad3b104120431bULL },

393 { &
âv_‹¡_¡r
[105], (
Fnv64_t
) 0xa29e779ea9d206e1ULL },

394 { &
âv_‹¡_¡r
[106], (
Fnv64_t
) 0x34ad3b104120431aULL },

395 { &
âv_‹¡_¡r
[107], (
Fnv64_t
) 0xa29e769ea9d2052eULL },

396 { &
âv_‹¡_¡r
[108], (
Fnv64_t
) 0x02a17ebca4aa3497ULL },

397 { &
âv_‹¡_¡r
[109], (
Fnv64_t
) 0x229ef18bcd375c95ULL },

398 { &
âv_‹¡_¡r
[110], (
Fnv64_t
) 0x02a17dbca4aa32c8ULL },

399 { &
âv_‹¡_¡r
[111], (
Fnv64_t
) 0x229b6f8bcd3449d8ULL },

400 { &
âv_‹¡_¡r
[112], (
Fnv64_t
) 0x02a184bca4aa3ed5ULL },

401 { &
âv_‹¡_¡r
[113], (
Fnv64_t
) 0x22b3618bcd48c3efULL },

402 { &
âv_‹¡_¡r
[114], (
Fnv64_t
) 0x5c2c346706186f36ULL },

403 { &
âv_‹¡_¡r
[115], (
Fnv64_t
) 0xb78c410f5b84f8c2ULL },

404 { &
âv_‹¡_¡r
[116], (
Fnv64_t
) 0xed9478212b267395ULL },

405 { &
âv_‹¡_¡r
[117], (
Fnv64_t
) 0xd9bbb55c5256662fULL },

406 { &
âv_‹¡_¡r
[118], (
Fnv64_t
) 0x8c54f0203249438aULL },

407 { &
âv_‹¡_¡r
[119], (
Fnv64_t
) 0xbd9790b5727dc37eULL },

408 { &
âv_‹¡_¡r
[120], (
Fnv64_t
) 0xa64e5f36c9e2b0e3ULL },

409 { &
âv_‹¡_¡r
[121], (
Fnv64_t
) 0x8fd0680da3088a04ULL },

410 { &
âv_‹¡_¡r
[122], (
Fnv64_t
) 0x67aad32c078284ccULL },

411 { &
âv_‹¡_¡r
[123], (
Fnv64_t
) 0xb37d55d81c57b331ULL },

412 { &
âv_‹¡_¡r
[124], (
Fnv64_t
) 0x55ac0f3829057c43ULL },

413 { &
âv_‹¡_¡r
[125], (
Fnv64_t
) 0xcb27f4b8e1b6cc20ULL },

414 { &
âv_‹¡_¡r
[126], (
Fnv64_t
) 0x26caf88bcbef2d19ULL },

415 { &
âv_‹¡_¡r
[127], (
Fnv64_t
) 0x8e6e063b97e61b8fULL },

416 { &
âv_‹¡_¡r
[128], (
Fnv64_t
) 0xb42750f7f3b7c37eULL },

417 { &
âv_‹¡_¡r
[129], (
Fnv64_t
) 0xf3c6ba64cf7ca99bULL },

418 { &
âv_‹¡_¡r
[130], (
Fnv64_t
) 0xebfb69b427ea80feULL },

419 { &
âv_‹¡_¡r
[131], (
Fnv64_t
) 0x39b50c3ed970f46cULL },

420 { &
âv_‹¡_¡r
[132], (
Fnv64_t
) 0x5b9b177aa3eb3e8aULL },

421 { &
âv_‹¡_¡r
[133], (
Fnv64_t
) 0x6510063ecf4ec903ULL },

422 { &
âv_‹¡_¡r
[134], (
Fnv64_t
) 0x2b3bbd2c00797c7aULL },

423 { &
âv_‹¡_¡r
[135], (
Fnv64_t
) 0xf1d6204ff5cb4aa7ULL },

424 { &
âv_‹¡_¡r
[136], (
Fnv64_t
) 0x4836e27ccf099f38ULL },

425 { &
âv_‹¡_¡r
[137], (
Fnv64_t
) 0x82efbb0dd073b44dULL },

426 { &
âv_‹¡_¡r
[138], (
Fnv64_t
) 0x4a80c282ffd7d4c6ULL },

427 { &
âv_‹¡_¡r
[139], (
Fnv64_t
) 0x305d1a9c9ee43bdfULL },

428 { &
âv_‹¡_¡r
[140], (
Fnv64_t
) 0x15c366948ffc6997ULL },

429 { &
âv_‹¡_¡r
[141], (
Fnv64_t
) 0x80153ae218916e7bULL },

430 { &
âv_‹¡_¡r
[142], (
Fnv64_t
) 0xfa23e2bdf9e2a9e1ULL },

431 { &
âv_‹¡_¡r
[143], (
Fnv64_t
) 0xd47e8d8a2333c6deULL },

432 { &
âv_‹¡_¡r
[144], (
Fnv64_t
) 0x7e128095f688b056ULL },

433 { &
âv_‹¡_¡r
[145], (
Fnv64_t
) 0x2f5356890efcedabULL },

434 { &
âv_‹¡_¡r
[146], (
Fnv64_t
) 0x95c2b383014f55c5ULL },

435 { &
âv_‹¡_¡r
[147], (
Fnv64_t
) 0x4727a5339ce6070fULL },

436 { &
âv_‹¡_¡r
[148], (
Fnv64_t
) 0xb0555ecd575108e9ULL },

437 { &
âv_‹¡_¡r
[149], (
Fnv64_t
) 0x48d785770bb4af37ULL },

438 { &
âv_‹¡_¡r
[150], (
Fnv64_t
) 0x09d4701c12af02b1ULL },

439 { &
âv_‹¡_¡r
[151], (
Fnv64_t
) 0x79f031e78f3cf62eULL },

440 { &
âv_‹¡_¡r
[152], (
Fnv64_t
) 0x52a1ee85db1b5a94ULL },

441 { &
âv_‹¡_¡r
[153], (
Fnv64_t
) 0x6bd95b2eb37fa6b8ULL },

442 { &
âv_‹¡_¡r
[154], (
Fnv64_t
) 0x74971b7077aef85dULL },

443 { &
âv_‹¡_¡r
[155], (
Fnv64_t
) 0xb4e4fae2ffcc1aadULL },

444 { &
âv_‹¡_¡r
[156], (
Fnv64_t
) 0x2bd48bd898b8f63aULL },

445 { &
âv_‹¡_¡r
[157], (
Fnv64_t
) 0xe9966ac1556257f6ULL },

446 { &
âv_‹¡_¡r
[158], (
Fnv64_t
) 0x92a3d1cd078ba293ULL },

447 { &
âv_‹¡_¡r
[159], (
Fnv64_t
) 0xf81175a482e20ab8ULL },

448 { &
âv_‹¡_¡r
[160], (
Fnv64_t
) 0x5bbb3de722e73048ULL },

449 { &
âv_‹¡_¡r
[161], (
Fnv64_t
) 0x6b4f363492b9f2beULL },

450 { &
âv_‹¡_¡r
[162], (
Fnv64_t
) 0xc2d559df73d59875ULL },

451 { &
âv_‹¡_¡r
[163], (
Fnv64_t
) 0xf75f62284bc7a8c2ULL },

452 { &
âv_‹¡_¡r
[164], (
Fnv64_t
) 0xda8dd8e116a9f1ccULL },

453 { &
âv_‹¡_¡r
[165], (
Fnv64_t
) 0xbdc1e6ab76057885ULL },

454 { &
âv_‹¡_¡r
[166], (
Fnv64_t
) 0xfec6a4238a1224a0ULL },

455 { &
âv_‹¡_¡r
[167], (
Fnv64_t
) 0xc03f40f3223e290eULL },

456 { &
âv_‹¡_¡r
[168], (
Fnv64_t
) 0x1ed21673466ffda9ULL },

457 { &
âv_‹¡_¡r
[169], (
Fnv64_t
) 0xdf70f906bb0dd2afULL },

458 { &
âv_‹¡_¡r
[170], (
Fnv64_t
) 0xf3dcda369f2af666ULL },

459 { &
âv_‹¡_¡r
[171], (
Fnv64_t
) 0x9ebb11573cdcebdeULL },

460 { &
âv_‹¡_¡r
[172], (
Fnv64_t
) 0x81c72d9077fedca0ULL },

461 { &
âv_‹¡_¡r
[173], (
Fnv64_t
) 0x0ec074a31be5fb15ULL },

462 { &
âv_‹¡_¡r
[174], (
Fnv64_t
) 0x2a8b3280b6c48f20ULL },

463 { &
âv_‹¡_¡r
[175], (
Fnv64_t
) 0xfd31777513309344ULL },

464 { &
âv_‹¡_¡r
[176], (
Fnv64_t
) 0x194534a86ad006b6ULL },

465 { &
âv_‹¡_¡r
[177], (
Fnv64_t
) 0x3be6fdf46e0cfe12ULL },

466 { &
âv_‹¡_¡r
[178], (
Fnv64_t
) 0x017cc137a07eb057ULL },

467 { &
âv_‹¡_¡r
[179], (
Fnv64_t
) 0x9428fc6e7d26b54dULL },

468 { &
âv_‹¡_¡r
[180], (
Fnv64_t
) 0x9aaa2e3603ef8ad7ULL },

469 { &
âv_‹¡_¡r
[181], (
Fnv64_t
) 0x82c6d3f3a0ccdf7dULL },

470 { &
âv_‹¡_¡r
[182], (
Fnv64_t
) 0xc86eeea00cf09b65ULL },

471 { &
âv_‹¡_¡r
[183], (
Fnv64_t
) 0x705f8189dbb58299ULL },

472 { &
âv_‹¡_¡r
[184], (
Fnv64_t
) 0x415a7f554391ca69ULL },

473 { &
âv_‹¡_¡r
[185], (
Fnv64_t
) 0xcfe3d49fa2bdc555ULL },

474 { &
âv_‹¡_¡r
[186], (
Fnv64_t
) 0xf0f9c56039b25191ULL },

475 { &
âv_‹¡_¡r
[187], (
Fnv64_t
) 0x7075cb6abd1d32d9ULL },

476 { &
âv_‹¡_¡r
[188], (
Fnv64_t
) 0x43c94e2c8b277509ULL },

477 { &
âv_‹¡_¡r
[189], (
Fnv64_t
) 0x3cbfd4e4ea670359ULL },

478 { &
âv_‹¡_¡r
[190], (
Fnv64_t
) 0xc05887810f4d019dULL },

479 { &
âv_‹¡_¡r
[191], (
Fnv64_t
) 0x14468ff93ac22dc5ULL },

480 { &
âv_‹¡_¡r
[192], (
Fnv64_t
) 0xebed699589d99c05ULL },

481 { &
âv_‹¡_¡r
[193], (
Fnv64_t
) 0x6d99f6df321ca5d5ULL },

482 { &
âv_‹¡_¡r
[194], (
Fnv64_t
) 0x0cd410d08c36d625ULL },

483 { &
âv_‹¡_¡r
[195], (
Fnv64_t
) 0xef1b2a2c86831d35ULL },

484 { &
âv_‹¡_¡r
[196], (
Fnv64_t
) 0x3b349c4d69ee5f05ULL },

485 { &
âv_‹¡_¡r
[197], (
Fnv64_t
) 0x55248ce88f45f035ULL },

486 { &
âv_‹¡_¡r
[198], (
Fnv64_t
) 0xaa69ca6a18a4c885ULL },

487 { &
âv_‹¡_¡r
[199], (
Fnv64_t
) 0x1fe3fce62bd816b5ULL },

488 { &
âv_‹¡_¡r
[200], (
Fnv64_t
) 0x0289a488a8df69d9ULL },

489 { &
âv_‹¡_¡r
[201], (
Fnv64_t
) 0x15e96e1613df98b5ULL },

490 { &
âv_‹¡_¡r
[202], (
Fnv64_t
) 0xe6be57375ad89b99ULL },

491 { 
NULL
, (
Fnv64_t
) 0 }

494 
âv1a_64_‹¡_veùÜ
 
	gâv1a_64_veùÜ
[] = {

495 { &
âv_‹¡_¡r
[0], (
Fnv64_t
) 0xcbf29ce484222325ULL },

496 { &
âv_‹¡_¡r
[1], (
Fnv64_t
) 0xaf63dc4c8601ec8cULL },

497 { &
âv_‹¡_¡r
[2], (
Fnv64_t
) 0xaf63df4c8601f1a5ULL },

498 { &
âv_‹¡_¡r
[3], (
Fnv64_t
) 0xaf63de4c8601eff2ULL },

499 { &
âv_‹¡_¡r
[4], (
Fnv64_t
) 0xaf63d94c8601e773ULL },

500 { &
âv_‹¡_¡r
[5], (
Fnv64_t
) 0xaf63d84c8601e5c0ULL },

501 { &
âv_‹¡_¡r
[6], (
Fnv64_t
) 0xaf63db4c8601ead9ULL },

502 { &
âv_‹¡_¡r
[7], (
Fnv64_t
) 0x08985907b541d342ULL },

503 { &
âv_‹¡_¡r
[8], (
Fnv64_t
) 0xdcb27518fed9d577ULL },

504 { &
âv_‹¡_¡r
[9], (
Fnv64_t
) 0xdd120e790c2512afULL },

505 { &
âv_‹¡_¡r
[10], (
Fnv64_t
) 0xcac165afa2fef40aULL },

506 { &
âv_‹¡_¡r
[11], (
Fnv64_t
) 0x85944171f73967e8ULL },

507 { &
âv_‹¡_¡r
[12], (
Fnv64_t
) 0xaf63bd4c8601b7dfULL },

508 { &
âv_‹¡_¡r
[13], (
Fnv64_t
) 0x089be207b544f1e4ULL },

509 { &
âv_‹¡_¡r
[14], (
Fnv64_t
) 0x08a61407b54d9b5fULL },

510 { &
âv_‹¡_¡r
[15], (
Fnv64_t
) 0x08a2ae07b54ab836ULL },

511 { &
âv_‹¡_¡r
[16], (
Fnv64_t
) 0x0891b007b53c4869ULL },

512 { &
âv_‹¡_¡r
[17], (
Fnv64_t
) 0x088e4a07b5396540ULL },

513 { &
âv_‹¡_¡r
[18], (
Fnv64_t
) 0x08987c07b5420ebbULL },

514 { &
âv_‹¡_¡r
[19], (
Fnv64_t
) 0xdcb28a18fed9f926ULL },

515 { &
âv_‹¡_¡r
[20], (
Fnv64_t
) 0xdd1270790c25b935ULL },

516 { &
âv_‹¡_¡r
[21], (
Fnv64_t
) 0xcac146afa2febf5dULL },

517 { &
âv_‹¡_¡r
[22], (
Fnv64_t
) 0x8593d371f738acfeULL },

518 { &
âv_‹¡_¡r
[23], (
Fnv64_t
) 0x34531ca7168b8f38ULL },

519 { &
âv_‹¡_¡r
[24], (
Fnv64_t
) 0x08a25607b54a22aeULL },

520 { &
âv_‹¡_¡r
[25], (
Fnv64_t
) 0xf5faf0190cf90df3ULL },

521 { &
âv_‹¡_¡r
[26], (
Fnv64_t
) 0xf27397910b3221c7ULL },

522 { &
âv_‹¡_¡r
[27], (
Fnv64_t
) 0x2c8c2b76062f22e0ULL },

523 { &
âv_‹¡_¡r
[28], (
Fnv64_t
) 0xe150688c8217b8fdULL },

524 { &
âv_‹¡_¡r
[29], (
Fnv64_t
) 0xf35a83c10e4f1f87ULL },

525 { &
âv_‹¡_¡r
[30], (
Fnv64_t
) 0xd1edd10b507344d0ULL },

526 { &
âv_‹¡_¡r
[31], (
Fnv64_t
) 0x2a5ee739b3ddb8c3ULL },

527 { &
âv_‹¡_¡r
[32], (
Fnv64_t
) 0xdcfb970ca1c0d310ULL },

528 { &
âv_‹¡_¡r
[33], (
Fnv64_t
) 0x4054da76daa6da90ULL },

529 { &
âv_‹¡_¡r
[34], (
Fnv64_t
) 0xf70a2ff589861368ULL },

530 { &
âv_‹¡_¡r
[35], (
Fnv64_t
) 0x4c628b38aed25f17ULL },

531 { &
âv_‹¡_¡r
[36], (
Fnv64_t
) 0x9dd1f6510f78189fULL },

532 { &
âv_‹¡_¡r
[37], (
Fnv64_t
) 0xa3de85bd491270ceULL },

533 { &
âv_‹¡_¡r
[38], (
Fnv64_t
) 0x858e2fa32a55e61dULL },

534 { &
âv_‹¡_¡r
[39], (
Fnv64_t
) 0x46810940eff5f915ULL },

535 { &
âv_‹¡_¡r
[40], (
Fnv64_t
) 0xf5fadd190cf8edaaULL },

536 { &
âv_‹¡_¡r
[41], (
Fnv64_t
) 0xf273ed910b32b3e9ULL },

537 { &
âv_‹¡_¡r
[42], (
Fnv64_t
) 0x2c8c5276062f6525ULL },

538 { &
âv_‹¡_¡r
[43], (
Fnv64_t
) 0xe150b98c821842a0ULL },

539 { &
âv_‹¡_¡r
[44], (
Fnv64_t
) 0xf35aa3c10e4f55e7ULL },

540 { &
âv_‹¡_¡r
[45], (
Fnv64_t
) 0xd1ed680b50729265ULL },

541 { &
âv_‹¡_¡r
[46], (
Fnv64_t
) 0x2a5f0639b3dded70ULL },

542 { &
âv_‹¡_¡r
[47], (
Fnv64_t
) 0xdcfbaa0ca1c0f359ULL },

543 { &
âv_‹¡_¡r
[48], (
Fnv64_t
) 0x4054ba76daa6a430ULL },

544 { &
âv_‹¡_¡r
[49], (
Fnv64_t
) 0xf709c7f5898562b0ULL },

545 { &
âv_‹¡_¡r
[50], (
Fnv64_t
) 0x4c62e638aed2f9b8ULL },

546 { &
âv_‹¡_¡r
[51], (
Fnv64_t
) 0x9dd1a8510f779415ULL },

547 { &
âv_‹¡_¡r
[52], (
Fnv64_t
) 0xa3de2abd4911d62dULL },

548 { &
âv_‹¡_¡r
[53], (
Fnv64_t
) 0x858e0ea32a55ae0aULL },

549 { &
âv_‹¡_¡r
[54], (
Fnv64_t
) 0x46810f40eff60347ULL },

550 { &
âv_‹¡_¡r
[55], (
Fnv64_t
) 0xc33bce57bef63eafULL },

551 { &
âv_‹¡_¡r
[56], (
Fnv64_t
) 0x08a24307b54a0265ULL },

552 { &
âv_‹¡_¡r
[57], (
Fnv64_t
) 0xf5b9fd190cc18d15ULL },

553 { &
âv_‹¡_¡r
[58], (
Fnv64_t
) 0x4c968290ace35703ULL },

554 { &
âv_‹¡_¡r
[59], (
Fnv64_t
) 0x07174bd5c64d9350ULL },

555 { &
âv_‹¡_¡r
[60], (
Fnv64_t
) 0x5a294c3ff5d18750ULL },

556 { &
âv_‹¡_¡r
[61], (
Fnv64_t
) 0x05b3c1aeb308b843ULL },

557 { &
âv_‹¡_¡r
[62], (
Fnv64_t
) 0xb92a48da37d0f477ULL },

558 { &
âv_‹¡_¡r
[63], (
Fnv64_t
) 0x73cdddccd80ebc49ULL },

559 { &
âv_‹¡_¡r
[64], (
Fnv64_t
) 0xd58c4c13210a266bULL },

560 { &
âv_‹¡_¡r
[65], (
Fnv64_t
) 0xe78b6081243ec194ULL },

561 { &
âv_‹¡_¡r
[66], (
Fnv64_t
) 0xb096f77096a39f34ULL },

562 { &
âv_‹¡_¡r
[67], (
Fnv64_t
) 0xb425c54ff807b6a3ULL },

563 { &
âv_‹¡_¡r
[68], (
Fnv64_t
) 0x23e520e2751bb46eULL },

564 { &
âv_‹¡_¡r
[69], (
Fnv64_t
) 0x1a0b44ccfe1385ecULL },

565 { &
âv_‹¡_¡r
[70], (
Fnv64_t
) 0xf5ba4b190cc2119fULL },

566 { &
âv_‹¡_¡r
[71], (
Fnv64_t
) 0x4c962690ace2baafULL },

567 { &
âv_‹¡_¡r
[72], (
Fnv64_t
) 0x0716ded5c64cda19ULL },

568 { &
âv_‹¡_¡r
[73], (
Fnv64_t
) 0x5a292c3ff5d150f0ULL },

569 { &
âv_‹¡_¡r
[74], (
Fnv64_t
) 0x05b3e0aeb308ecf0ULL },

570 { &
âv_‹¡_¡r
[75], (
Fnv64_t
) 0xb92a5eda37d119d9ULL },

571 { &
âv_‹¡_¡r
[76], (
Fnv64_t
) 0x73ce41ccd80f6635ULL },

572 { &
âv_‹¡_¡r
[77], (
Fnv64_t
) 0xd58c2c132109f00bULL },

573 { &
âv_‹¡_¡r
[78], (
Fnv64_t
) 0xe78baf81243f47d1ULL },

574 { &
âv_‹¡_¡r
[79], (
Fnv64_t
) 0xb0968f7096a2ee7cULL },

575 { &
âv_‹¡_¡r
[80], (
Fnv64_t
) 0xb425a84ff807855cULL },

576 { &
âv_‹¡_¡r
[81], (
Fnv64_t
) 0x23e4e9e2751b56f9ULL },

577 { &
âv_‹¡_¡r
[82], (
Fnv64_t
) 0x1a0b4eccfe1396eaULL },

578 { &
âv_‹¡_¡r
[83], (
Fnv64_t
) 0x54abd453bb2c9004ULL },

579 { &
âv_‹¡_¡r
[84], (
Fnv64_t
) 0x08ba5f07b55ec3daULL },

580 { &
âv_‹¡_¡r
[85], (
Fnv64_t
) 0x337354193006cb6eULL },

581 { &
âv_‹¡_¡r
[86], (
Fnv64_t
) 0xa430d84680aabd0bULL },

582 { &
âv_‹¡_¡r
[87], (
Fnv64_t
) 0xa9bc8acca21f39b1ULL },

583 { &
âv_‹¡_¡r
[88], (
Fnv64_t
) 0x6961196491cc682dULL },

584 { &
âv_‹¡_¡r
[89], (
Fnv64_t
) 0xad2bb1774799dfe9ULL },

585 { &
âv_‹¡_¡r
[90], (
Fnv64_t
) 0x6961166491cc6314ULL },

586 { &
âv_‹¡_¡r
[91], (
Fnv64_t
) 0x8d1bb3904a3b1236ULL },

587 { &
âv_‹¡_¡r
[92], (
Fnv64_t
) 0x6961176491cc64c7ULL },

588 { &
âv_‹¡_¡r
[93], (
Fnv64_t
) 0xed205d87f40434c7ULL },

589 { &
âv_‹¡_¡r
[94], (
Fnv64_t
) 0x6961146491cc5faeULL },

590 { &
âv_‹¡_¡r
[95], (
Fnv64_t
) 0xcd3baf5e44f8ad9cULL },

591 { &
âv_‹¡_¡r
[96], (
Fnv64_t
) 0xe3b36596127cd6d8ULL },

592 { &
âv_‹¡_¡r
[97], (
Fnv64_t
) 0xf77f1072c8e8a646ULL },

593 { &
âv_‹¡_¡r
[98], (
Fnv64_t
) 0xe3b36396127cd372ULL },

594 { &
âv_‹¡_¡r
[99], (
Fnv64_t
) 0x6067dce9932ad458ULL },

595 { &
âv_‹¡_¡r
[100], (
Fnv64_t
) 0xe3b37596127cf208ULL },

596 { &
âv_‹¡_¡r
[101], (
Fnv64_t
) 0x4b7b10fa9fe83936ULL },

597 { &
âv_‹¡_¡r
[102], (
Fnv64_t
) 0xaabafe7104d914beULL },

598 { &
âv_‹¡_¡r
[103], (
Fnv64_t
) 0xf4d3180b3cde3edaULL },

599 { &
âv_‹¡_¡r
[104], (
Fnv64_t
) 0xaabafd7104d9130bULL },

600 { &
âv_‹¡_¡r
[105], (
Fnv64_t
) 0xf4cfb20b3cdb5bb1ULL },

601 { &
âv_‹¡_¡r
[106], (
Fnv64_t
) 0xaabafc7104d91158ULL },

602 { &
âv_‹¡_¡r
[107], (
Fnv64_t
) 0xf4cc4c0b3cd87888ULL },

603 { &
âv_‹¡_¡r
[108], (
Fnv64_t
) 0xe729bac5d2a8d3a7ULL },

604 { &
âv_‹¡_¡r
[109], (
Fnv64_t
) 0x74bc0524f4dfa4c5ULL },

605 { &
âv_‹¡_¡r
[110], (
Fnv64_t
) 0xe72630c5d2a5b352ULL },

606 { &
âv_‹¡_¡r
[111], (
Fnv64_t
) 0x6b983224ef8fb456ULL },

607 { &
âv_‹¡_¡r
[112], (
Fnv64_t
) 0xe73042c5d2ae266dULL },

608 { &
âv_‹¡_¡r
[113], (
Fnv64_t
) 0x8527e324fdeb4b37ULL },

609 { &
âv_‹¡_¡r
[114], (
Fnv64_t
) 0x0a83c86fee952abcULL },

610 { &
âv_‹¡_¡r
[115], (
Fnv64_t
) 0x7318523267779d74ULL },

611 { &
âv_‹¡_¡r
[116], (
Fnv64_t
) 0x3e66d3d56b8caca1ULL },

612 { &
âv_‹¡_¡r
[117], (
Fnv64_t
) 0x956694a5c0095593ULL },

613 { &
âv_‹¡_¡r
[118], (
Fnv64_t
) 0xcac54572bb1a6fc8ULL },

614 { &
âv_‹¡_¡r
[119], (
Fnv64_t
) 0xa7a4c9f3edebf0d8ULL },

615 { &
âv_‹¡_¡r
[120], (
Fnv64_t
) 0x7829851fac17b143ULL },

616 { &
âv_‹¡_¡r
[121], (
Fnv64_t
) 0x2c8f4c9af81bcf06ULL },

617 { &
âv_‹¡_¡r
[122], (
Fnv64_t
) 0xd34e31539740c732ULL },

618 { &
âv_‹¡_¡r
[123], (
Fnv64_t
) 0x3605a2ac253d2db1ULL },

619 { &
âv_‹¡_¡r
[124], (
Fnv64_t
) 0x08c11b8346f4a3c3ULL },

620 { &
âv_‹¡_¡r
[125], (
Fnv64_t
) 0x6be396289ce8a6daULL },

621 { &
âv_‹¡_¡r
[126], (
Fnv64_t
) 0xd9b957fb7fe794c5ULL },

622 { &
âv_‹¡_¡r
[127], (
Fnv64_t
) 0x05be33da04560a93ULL },

623 { &
âv_‹¡_¡r
[128], (
Fnv64_t
) 0x0957f1577ba9747cULL },

624 { &
âv_‹¡_¡r
[129], (
Fnv64_t
) 0xda2cc3acc24fba57ULL },

625 { &
âv_‹¡_¡r
[130], (
Fnv64_t
) 0x74136f185b29e7f0ULL },

626 { &
âv_‹¡_¡r
[131], (
Fnv64_t
) 0xb2f2b4590edb93b2ULL },

627 { &
âv_‹¡_¡r
[132], (
Fnv64_t
) 0xb3608fce8b86ae04ULL },

628 { &
âv_‹¡_¡r
[133], (
Fnv64_t
) 0x4a3a865079359063ULL },

629 { &
âv_‹¡_¡r
[134], (
Fnv64_t
) 0x5b3a7ef496880a50ULL },

630 { &
âv_‹¡_¡r
[135], (
Fnv64_t
) 0x48fae3163854c23bULL },

631 { &
âv_‹¡_¡r
[136], (
Fnv64_t
) 0x07aaa640476e0b9aULL },

632 { &
âv_‹¡_¡r
[137], (
Fnv64_t
) 0x2f653656383a687dULL },

633 { &
âv_‹¡_¡r
[138], (
Fnv64_t
) 0xa1031f8e7599d79cULL },

634 { &
âv_‹¡_¡r
[139], (
Fnv64_t
) 0xa31908178ff92477ULL },

635 { &
âv_‹¡_¡r
[140], (
Fnv64_t
) 0x097edf3c14c3fb83ULL },

636 { &
âv_‹¡_¡r
[141], (
Fnv64_t
) 0xb51ca83feaa0971bULL },

637 { &
âv_‹¡_¡r
[142], (
Fnv64_t
) 0xdd3c0d96d784f2e9ULL },

638 { &
âv_‹¡_¡r
[143], (
Fnv64_t
) 0x86cd26a9ea767d78ULL },

639 { &
âv_‹¡_¡r
[144], (
Fnv64_t
) 0xe6b215ff54a30c18ULL },

640 { &
âv_‹¡_¡r
[145], (
Fnv64_t
) 0xec5b06a1c5531093ULL },

641 { &
âv_‹¡_¡r
[146], (
Fnv64_t
) 0x45665a929f9ec5e5ULL },

642 { &
âv_‹¡_¡r
[147], (
Fnv64_t
) 0x8c7609b4a9f10907ULL },

643 { &
âv_‹¡_¡r
[148], (
Fnv64_t
) 0x89aac3a491f0d729ULL },

644 { &
âv_‹¡_¡r
[149], (
Fnv64_t
) 0x32ce6b26e0f4a403ULL },

645 { &
âv_‹¡_¡r
[150], (
Fnv64_t
) 0x614ab44e02b53e01ULL },

646 { &
âv_‹¡_¡r
[151], (
Fnv64_t
) 0xfa6472eb6eef3290ULL },

647 { &
âv_‹¡_¡r
[152], (
Fnv64_t
) 0x9e5d75eb1948eb6aULL },

648 { &
âv_‹¡_¡r
[153], (
Fnv64_t
) 0xb6d12ad4a8671852ULL },

649 { &
âv_‹¡_¡r
[154], (
Fnv64_t
) 0x88826f56eba07af1ULL },

650 { &
âv_‹¡_¡r
[155], (
Fnv64_t
) 0x44535bf2645bc0fdULL },

651 { &
âv_‹¡_¡r
[156], (
Fnv64_t
) 0x169388ffc21e3728ULL },

652 { &
âv_‹¡_¡r
[157], (
Fnv64_t
) 0xf68aac9e396d8224ULL },

653 { &
âv_‹¡_¡r
[158], (
Fnv64_t
) 0x8e87d7e7472b3883ULL },

654 { &
âv_‹¡_¡r
[159], (
Fnv64_t
) 0x295c26caa8b423deULL },

655 { &
âv_‹¡_¡r
[160], (
Fnv64_t
) 0x322c814292e72176ULL },

656 { &
âv_‹¡_¡r
[161], (
Fnv64_t
) 0x8a06550eb8af7268ULL },

657 { &
âv_‹¡_¡r
[162], (
Fnv64_t
) 0xef86d60e661bcf71ULL },

658 { &
âv_‹¡_¡r
[163], (
Fnv64_t
) 0x9e5426c87f30ee54ULL },

659 { &
âv_‹¡_¡r
[164], (
Fnv64_t
) 0xf1ea8aa826fd047eULL },

660 { &
âv_‹¡_¡r
[165], (
Fnv64_t
) 0x0babaf9a642cb769ULL },

661 { &
âv_‹¡_¡r
[166], (
Fnv64_t
) 0x4b3341d4068d012eULL },

662 { &
âv_‹¡_¡r
[167], (
Fnv64_t
) 0xd15605cbc30a335cULL },

663 { &
âv_‹¡_¡r
[168], (
Fnv64_t
) 0x5b21060aed8412e5ULL },

664 { &
âv_‹¡_¡r
[169], (
Fnv64_t
) 0x45e2cda1ce6f4227ULL },

665 { &
âv_‹¡_¡r
[170], (
Fnv64_t
) 0x50ae3745033ad7d4ULL },

666 { &
âv_‹¡_¡r
[171], (
Fnv64_t
) 0xaa4588ced46bf414ULL },

667 { &
âv_‹¡_¡r
[172], (
Fnv64_t
) 0xc1b0056c4a95467eULL },

668 { &
âv_‹¡_¡r
[173], (
Fnv64_t
) 0x56576a71de8b4089ULL },

669 { &
âv_‹¡_¡r
[174], (
Fnv64_t
) 0xbf20965fa6dc927eULL },

670 { &
âv_‹¡_¡r
[175], (
Fnv64_t
) 0x569f8383c2040882ULL },

671 { &
âv_‹¡_¡r
[176], (
Fnv64_t
) 0xe1e772fba08feca0ULL },

672 { &
âv_‹¡_¡r
[177], (
Fnv64_t
) 0x4ced94af97138ac4ULL },

673 { &
âv_‹¡_¡r
[178], (
Fnv64_t
) 0xc4112ffb337a82fbULL },

674 { &
âv_‹¡_¡r
[179], (
Fnv64_t
) 0xd64a4fd41de38b7dULL },

675 { &
âv_‹¡_¡r
[180], (
Fnv64_t
) 0x4cfc32329edebcbbULL },

676 { &
âv_‹¡_¡r
[181], (
Fnv64_t
) 0x0803564445050395ULL },

677 { &
âv_‹¡_¡r
[182], (
Fnv64_t
) 0xaa1574ecf4642ffdULL },

678 { &
âv_‹¡_¡r
[183], (
Fnv64_t
) 0x694bc4e54cc315f9ULL },

679 { &
âv_‹¡_¡r
[184], (
Fnv64_t
) 0xa3d7cb273b011721ULL },

680 { &
âv_‹¡_¡r
[185], (
Fnv64_t
) 0x577c2f8b6115bfa5ULL },

681 { &
âv_‹¡_¡r
[186], (
Fnv64_t
) 0xb7ec8c1a769fb4c1ULL },

682 { &
âv_‹¡_¡r
[187], (
Fnv64_t
) 0x5d5cfce63359ab19ULL },

683 { &
âv_‹¡_¡r
[188], (
Fnv64_t
) 0x33b96c3cd65b5f71ULL },

684 { &
âv_‹¡_¡r
[189], (
Fnv64_t
) 0xd845097780602bb9ULL },

685 { &
âv_‹¡_¡r
[190], (
Fnv64_t
) 0x84d47645d02da3d5ULL },

686 { &
âv_‹¡_¡r
[191], (
Fnv64_t
) 0x83544f33b58773a5ULL },

687 { &
âv_‹¡_¡r
[192], (
Fnv64_t
) 0x9175cbb2160836c5ULL },

688 { &
âv_‹¡_¡r
[193], (
Fnv64_t
) 0xc71b3bc175e72bc5ULL },

689 { &
âv_‹¡_¡r
[194], (
Fnv64_t
) 0x636806ac222ec985ULL },

690 { &
âv_‹¡_¡r
[195], (
Fnv64_t
) 0xb6ef0e6950f52ed5ULL },

691 { &
âv_‹¡_¡r
[196], (
Fnv64_t
) 0xead3d8a0f3dfdaa5ULL },

692 { &
âv_‹¡_¡r
[197], (
Fnv64_t
) 0x922908fe9a861ba5ULL },

693 { &
âv_‹¡_¡r
[198], (
Fnv64_t
) 0x6d4821de275fd5c5ULL },

694 { &
âv_‹¡_¡r
[199], (
Fnv64_t
) 0x1fe3fce62bd816b5ULL },

695 { &
âv_‹¡_¡r
[200], (
Fnv64_t
) 0xc23e9fccd6f70591ULL },

696 { &
âv_‹¡_¡r
[201], (
Fnv64_t
) 0xc1af12bdfe16b5b5ULL },

697 { &
âv_‹¡_¡r
[202], (
Fnv64_t
) 0x39e9f18f2f85e221ULL },

698 { 
NULL
, (
Fnv64_t
) 0 }

701 
boŞ
 
	$NuFNVHash_V”ify
()

703 cÚ¡ 
‹¡_veùÜ
* 
t
 = 
NULL
;

704 cÚ¡ 
‹¡_veùÜ
* 
s
 = 
NULL
;

705 
n
 = 0;

706 
m
 = 0;

708 
t
 = 
âv_‹¡_¡r
, 
n
 = 0;->
buf
 !ğ
NULL
;++,‚++)

710 
ušt64_t
 
hv®
 = 
OFFSET_BASIS
;

711 
hv®
 = 
	`NuFNVHash_64_Buf
(
t
->
buf
,->
Ën
, hval);

712 ià(
hv®
 !ğ
âv1_64_veùÜ
[
n
].
âv1_64
)

715  
çl£
;

719 
t
 = 
âv_‹¡_¡r
, 
n
 = 0;->
buf
 !ğ
NULL
;++,‚++)

721 
ušt64_t
 
hv®
 = 
OFFSET_BASIS
;

722 
hv®
 = 
	`NuFNVHash_64a_Buf
(
t
->
buf
,->
Ën
, hval);

723 ià(
hv®
 !ğ
âv1a_64_veùÜ
[
n
].
âv1a_64
)

726  
çl£
;

731 
t
 = 
âv_‹¡_¡r
, 
n
 = 0;->
buf
 !ğ
NULL
;++,‚++)

733 
ušt64_t
 
hv®1
 = 
OFFSET_BASIS
;

734 
hv®1
 = 
	`NuFNVHash_64_Buf_XÜFŞd
(
t
->
buf
,->
Ën
, hval1, 44);

736 
s
 = 
âv_‹¡_¡r
, 
m
 = 0; s->
buf
 !ğ
NULL
; s++, m++)

738 
ušt64_t
 
hv®2
 = 
OFFSET_BASIS
;

739 
hv®2
 = 
	`NuFNVHash_64_Buf_XÜFŞd
(
s
->
buf
, s->
Ën
, hval2, 44);

740 ià(
n
 =ğ
m
)

742 ià(
hv®1
 !ğ
hv®2
)

745  
çl£
;

750 ià(
hv®1
 =ğ
hv®2
)

753  
çl£
;

759 
t
 = 
âv_‹¡_¡r
, 
n
 = 0;->
buf
 !ğ
NULL
;++,‚++)

761 
ušt64_t
 
hv®1
 = 
OFFSET_BASIS
;

762 
hv®1
 = 
	`NuFNVHash_64a_Buf_XÜFŞd
(
t
->
buf
,->
Ën
, hval1, 44);

764 
s
 = 
âv_‹¡_¡r
, 
m
 = 0; s->
buf
 !ğ
NULL
; s++, m++)

766 
ušt64_t
 
hv®2
 = 
OFFSET_BASIS
;

767 
hv®2
 = 
	`NuFNVHash_64a_Buf_XÜFŞd
(
s
->
buf
, s->
Ën
, hval2, 44);

768 ià(
n
 =ğ
m
)

770 ià(
hv®1
 !ğ
hv®2
)

773  
çl£
;

778 ià(
hv®1
 =ğ
hv®2
)

781  
çl£
;

787  
Œue
;

788 
	}
}

790 
boŞ
 
	$NuFNVHash_V”ify
()

792  
Œue
;

793 
	}
}

	@../../titanutils/titanminihelper/NuFNVHash.h

1 #iâdeà
_NU_FNV_HASH_H_


2 
	#_NU_FNV_HASH_H_


	)

4 
	~"../../sysuts/commÚ/¡dšt.h
"

6 #iâdeà
_š_


7 
	#_š_


	)

8 
	#_out_


	)

9 
	#_šout_


	)

12 
ušt64_t
 
NuFNVHash_64_Buf
 (
_š_
 cÚ¡ * 
buf
, _š_ cÚ¡ 
Ën
, _š_ cÚ¡ ušt64_ˆ
š™_hv®
);

13 
ušt64_t
 
NuFNVHash_64a_Buf
(
_š_
 cÚ¡ * 
buf
, _š_ cÚ¡ 
Ën
, _š_ cÚ¡ ušt64_ˆ
š™_hv®
);

14 
ušt64_t
 
NuFNVHash_64_Buf_XÜFŞd
 (
_š_
 cÚ¡ * 
buf
, _š_ cÚ¡ 
Ën
, _š_ cÚ¡ ušt64_ˆ
š™_hv®
, _š_ cÚ¡ 
nB™s
);

15 
ušt64_t
 
NuFNVHash_64a_Buf_XÜFŞd
(
_š_
 cÚ¡ * 
buf
, _š_ cÚ¡ 
Ën
, _š_ cÚ¡ ušt64_ˆ
š™_hv®
, _š_ cÚ¡ 
nB™s
);

16 
boŞ
 
NuFNVHash_V”ify
();

	@../../titanutils/titanminihelper/md5.cpp

26 
	~"md5.h
"

28 * 
	tPOINTER
;

29 
	tUINT4
;

31 
	#STREAM_SIZE
 4096

	)

33 
	#S11
 7

	)

34 
	#S12
 12

	)

35 
	#S13
 17

	)

36 
	#S14
 22

	)

37 
	#S21
 5

	)

38 
	#S22
 9

	)

39 
	#S23
 14

	)

40 
	#S24
 20

	)

41 
	#S31
 4

	)

42 
	#S32
 11

	)

43 
	#S33
 16

	)

44 
	#S34
 23

	)

45 
	#S41
 6

	)

46 
	#S42
 10

	)

47 
	#S43
 15

	)

48 
	#S44
 21

	)

52 
	#F
(
x
, 
y
, 
z
è(((xè& (y)è| ((~xè& (z)))

	)

53 
	#G
(
x
, 
y
, 
z
è(((xè& (z)è| ((yè& (~z)))

	)

54 
	#H
(
x
, 
y
, 
z
è((xè^ (yè^ (z))

	)

55 
	#I
(
x
, 
y
, 
z
è((yè^ ((xè| (~z)))

	)

59 
	#ROTATE_LEFT
(
x
, 
n
è(((xè<< (n)è| ((xè>> (32-Ò))))

	)

64 
	#FF
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
è{ \

	)

65 (
	ga
è+ğ
F
 ((
b
), (
c
), (
d
)è+ (
	gx
è+ (
	gUINT4
)(
	gac
); \

66 (
	ga
èğ
ROTATE_LEFT
 ((
a
), (
s
)); \

67 (
	ga
è+ğ(
b
); \

69 
	#GG
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
è{ \

	)

70 (
	ga
è+ğ
G
 ((
b
), (
c
), (
d
)è+ (
	gx
è+ (
	gUINT4
)(
	gac
); \

71 (
	ga
èğ
ROTATE_LEFT
 ((
a
), (
s
)); \

72 (
	ga
è+ğ(
b
); \

74 
	#HH
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
è{ \

	)

75 (
	ga
è+ğ
H
 ((
b
), (
c
), (
d
)è+ (
	gx
è+ (
	gUINT4
)(
	gac
); \

76 (
	ga
èğ
ROTATE_LEFT
 ((
a
), (
s
)); \

77 (
	ga
è+ğ(
b
); \

79 
	#II
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
è{ \

	)

80 (
	ga
è+ğ
I
 ((
b
), (
c
), (
d
)è+ (
	gx
è+ (
	gUINT4
)(
	gac
); \

81 (
	ga
èğ
ROTATE_LEFT
 ((
a
), (
s
)); \

82 (
	ga
è+ğ(
b
); \

86 
MD5T¿nsfÜm
(
UINT4
 [4], const [64]);

87 
Encode
(*, 
UINT4
 *, );

88 
Decode
(
UINT4
 *, const *, );

89 
MD5_memıy
(
POINTER
 
ouut
, POINTER 
šput
, 
Ën
);

90 
MD5_mem£t
(
POINTER
, , );

92 
	gMD5
::
	$MD5In™
 (
MD5_CTX
 *
cÚ‹xt
)

94 
cÚ‹xt
->
couÁ
[0] = context->count[1] = 0;

97 
cÚ‹xt
->
¡©e
[0] = 0x67452301;

98 
cÚ‹xt
->
¡©e
[1] = 0xefcdab89;

99 
cÚ‹xt
->
¡©e
[2] = 0x98badcfe;

100 
cÚ‹xt
->
¡©e
[3] = 0x10325476;

101 
	}
}

107 
	gMD5
::
	$MD5Upd©e
 (
MD5_CTX
 *
cÚ‹xt
,cÚ¡ *
šput
, cÚ¡ 
šputL’
)

109 
i
, 
šdex
, 
·¹L’
;

112 
šdex
 = ()((
cÚ‹xt
->
couÁ
[0] >> 3) & 0x3F);

115 ià((
cÚ‹xt
->
couÁ
[0] +ğ((
UINT4
)
šputL’
 << 3))

117 < ((
UINT4
)
šputL’
 << 3))

118 
cÚ‹xt
->
couÁ
[1]++;

119 
cÚ‹xt
->
couÁ
[1] +ğ((
UINT4
)
šputL’
 >> 29);

121 
·¹L’
 = 64 - 
šdex
;

125 ià(
šputL’
 >ğ
·¹L’
) {

126 
MD5_memıy


127 ((
POINTER
)&
cÚ‹xt
->
bufãr
[
šdex
], (POINTER)
šput
, 
·¹L’
);

128 
	`MD5T¿nsfÜm
 (
cÚ‹xt
->
¡©e
, cÚ‹xt->
bufãr
);

130 
i
 = 
·¹L’
; i + 63 < 
šputL’
; i += 64)

131 
	`MD5T¿nsfÜm
 (
cÚ‹xt
->
¡©e
, &
šput
[
i
]);

133 
šdex
 = 0;

136 
i
 = 0;

139 
MD5_memıy


140 ((
POINTER
)&
cÚ‹xt
->
bufãr
[
šdex
], (POINTER)&
šput
[
i
],

141 
šputL’
-
i
);

142 
	}
}

147 
	gMD5
::
	$MD5Fš®
 (
dige¡
[16],
MD5_CTX
 *
cÚ‹xt
)

151 
ucKey
[16] = {

154 
	`MD5Upd©e
 (
cÚ‹xt
, 
ucKey
, 16);

156 
b™s
[8];

157 
šdex
, 
·dL’
;

159 
PADDING
[64] = {

165 
	`Encode
 (
b™s
, 
cÚ‹xt
->
couÁ
, 8);

169 
šdex
 = ()((
cÚ‹xt
->
couÁ
[0] >> 3) & 0x3f);

170 
·dL’
 = (
šdex
 < 56) ? (56 - index) : (120 - index);

171 
	`MD5Upd©e
 (
cÚ‹xt
, 
PADDING
, 
·dL’
);

174 
	`MD5Upd©e
 (
cÚ‹xt
, 
b™s
, 8);

177 
	`Encode
 (
dige¡
, 
cÚ‹xt
->
¡©e
, 16);

181 
	`MD5_mem£t
 ((
POINTER
)
cÚ‹xt
, 0,  (*context));

184 
dige¡
[0] ^= 0x4e;

185 
dige¡
[1] ^= 0x55;

186 
dige¡
[2] ^= 0x55;

187 
dige¡
[3] ^= 0x4f;

188 
dige¡
[4] ^= 0x55;

189 
dige¡
[5] ^= 0x4e;

190 
dige¡
[6] ^= 0x55;

191 
dige¡
[7] ^= 0x4f;

192 
dige¡
[8] ^= 0x55;

193 
dige¡
[9] ^= 0x55;

194 
dige¡
[10] ^= 0x4e;

195 
dige¡
[11] ^= 0x4f;

196 
dige¡
[12] ^= 0x55;

197 
dige¡
[13] ^= 0x55;

198 
dige¡
[14] ^= 0x4f;

199 
dige¡
[15] ^= 0x4e;

200 
	}
}

205 
	$Encode
 (*
ouut
,
UINT4
 *
šput
,
Ën
)

207 
i
, 
j
;

209 
i
 = 0, 
j
 = 0; j < 
Ën
; i++, j += 4) {

210 
ouut
[
j
] = ()(
šput
[
i
] & 0xff);

211 
ouut
[
j
+1] = ()((
šput
[
i
] >> 8) & 0xff);

212 
ouut
[
j
+2] = ()((
šput
[
i
] >> 16) & 0xff);

213 
ouut
[
j
+3] = ()((
šput
[
i
] >> 24) & 0xff);

215 
	}
}

220 
	$Decode
 (
UINT4
 *
ouut
,cÚ¡ *
šput
,
Ën
)

222 
i
, 
j
;

224 
i
 = 0, 
j
 = 0; j < 
Ën
; i++, j += 4)

225 
ouut
[
i
] = ((
UINT4
)
šput
[
j
]) | (((UINT4)input[j+1]) << 8) |

226 (((
UINT4
)
šput
[
j
+2]) << 16) | (((UINT4)input[j+3]) << 24);

227 
	}
}

232 
	$MD5_memıy
 (
POINTER
 
ouut
,POINTER 
šput
,
Ën
)

234 
i
;

236 
i
 = 0; i < 
Ën
; i++)

238 
ouut
[
i
] = 
šput
[i];

239 
	}
}

243 
	$MD5_mem£t
 (
POINTER
 
ouut
,
v®ue
,
Ën
)

245 
i
;

247 
i
 = 0; i < 
Ën
; i++)

248 ((*)
ouut
)[
i
] = ()
v®ue
;

249 
	}
}

253 
	$MD5T¿nsfÜm
 (
UINT4
 
¡©e
[4],cÚ¡ 
block
[64])

255 
UINT4
 
a
 = 
¡©e
[0], 
b
 = s‹[1], 
c
 = s‹[2], 
d
 = s‹[3], 
x
[16];

257 
	`Decode
 (
x
, 
block
, 64);

260 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S11
, 0xd76aa478);

261 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 1], 
S12
, 0xe8c7b756);

262 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[ 2], 
S13
, 0x242070db);

263 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[ 3], 
S14
, 0xc1bdceee);

264 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 4], 
S11
, 0xf57c0faf);

265 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 5], 
S12
, 0x4787c62a);

266 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[ 6], 
S13
, 0xa8304613);

267 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[ 7], 
S14
, 0xfd469501);

268 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 8], 
S11
, 0x698098d8);

269 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 9], 
S12
, 0x8b44f7af);

270 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[10], 
S13
, 0xffff5bb1);

271 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[11], 
S14
, 0x895cd7be);

272 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[12], 
S11
, 0x6b901122);

273 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[13], 
S12
, 0xfd987193);

274 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[14], 
S13
, 0xa679438e);

275 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[15], 
S14
, 0x49b40821);

278 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 1], 
S21
, 0xf61e2562);

279 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 6], 
S22
, 0xc040b340);

280 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[11], 
S23
, 0x265e5a51);

281 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 0], 
S24
, 0xe9b6c7aa);

282 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 5], 
S21
, 0xd62f105d);

283 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[10], 
S22
, 0x2441453);

284 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[15], 
S23
, 0xd8a1e681);

285 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 4], 
S24
, 0xe7d3fbc8);

286 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 9], 
S21
, 0x21e1cde6);

287 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[14], 
S22
, 0xc33707d6);

288 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[ 3], 
S23
, 0xf4d50d87);

290 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 8], 
S24
, 0x455a14ed);

291 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[13], 
S21
, 0xa9e3e905);

292 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 2], 
S22
, 0xfcefa3f8);

293 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[ 7], 
S23
, 0x676f02d9);

294 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[12], 
S24
, 0x8d2a4c8a);

297 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 5], 
S31
, 0xfffa3942);

298 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 8], 
S32
, 0x8771f681);

299 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[11], 
S33
, 0x6d9d6122);

300 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[14], 
S34
, 0xfde5380c);

301 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 1], 
S31
, 0xa4beea44);

302 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 4], 
S32
, 0x4bdecfa9);

303 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 7], 
S33
, 0xf6bb4b60);

304 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[10], 
S34
, 0xbebfbc70);

305 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[13], 
S31
, 0x289b7ec6);

306 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 0], 
S32
, 0xeaa127fa);

307 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 3], 
S33
, 0xd4ef3085);

308 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[ 6], 
S34
, 0x4881d05);

309 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 9], 
S31
, 0xd9d4d039);

310 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[12], 
S32
, 0xe6db99e5);

311 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[15], 
S33
, 0x1fa27cf8);

312 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[ 2], 
S34
, 0xc4ac5665);

315 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S41
, 0xf4292244);

316 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[ 7], 
S42
, 0x432aff97);

317 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[14], 
S43
, 0xab9423a7);

318 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 5], 
S44
, 0xfc93a039);

319 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[12], 
S41
, 0x655b59c3);

320 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[ 3], 
S42
, 0x8f0ccc92);

321 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[10], 
S43
, 0xffeff47d);

322 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 1], 
S44
, 0x85845dd1);

323 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 8], 
S41
, 0x6fa87e4f);

324 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[15], 
S42
, 0xfe2ce6e0);

325 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[ 6], 
S43
, 0xa3014314);

326 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[13], 
S44
, 0x4e0811a1);

327 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 4], 
S41
, 0xf7537e82);

328 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[11], 
S42
, 0xbd3af235);

329 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[ 2], 
S43
, 0x2ad7d2bb);

330 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 9], 
S44
, 0xeb86d391);

332 
¡©e
[0] +ğ
a
;

333 
¡©e
[1] +ğ
b
;

334 
¡©e
[2] +ğ
c
;

335 
¡©e
[3] +ğ
d
;

339 
	`MD5_mem£t
 ((
POINTER
)
x
, 0,  (x));

340 
	}
}

	@../../titanutils/titanminihelper/md5.h

1 #iâdeà
_NU_MD5_H_


2 
	#_NU_MD5_H_


	)

4 
	~"commÚ/¡dšt.h
"

6 #iâdeà
_š_


7 
	#_š_


	)

8 
	#_out_


	)

9 
	#_šout_


	)

14 
ušt32_t
 
	m¡©e
[4];

15 
ušt32_t
 
	mcouÁ
[2];

16 
	mbufãr
[64];

17 } 
	tMD5_CTX
;

19 şas 
	cMD5


21 
	mpublic
:

22 
MD5In™
 (
_out_
 
MD5_CTX
 *
cÚ‹xt
);

23 
MD5Upd©e
(
_šout_
 
MD5_CTX
 *
cÚ‹xt
, 
_š_
 cÚ¡ *
šput
, _š_ cÚ¡ 
šputL’
);

24 
MD5Fš®
 (
_out_
 
dige¡
[16], 
_š_
 
MD5_CTX
 *
cÚ‹xt
);

	@../../titanutils/titanminihelper/titanutils.cpp

2 
	~<¡dio.h
>

3 
	~<sys/ty³s.h
>

4 
	~<sys/¡©.h
>

5 #ifdeà
__lšux__


6 
	~<uni¡d.h
>

7 
	~<dœ’t.h
>

9 
	~<¡dlib.h
>

10 
	~<fú.h
>

11 
	~<”ºo.h
>

12 
	~<¡ršg.h
>

13 
	~<time.h
>

15 
	~"t™ªuts.h
"

16 
	~"NuFNVHash.h
"

18 
	~"commÚ/h¬dw¬e.h
"

19 
	~"commÚ/sy¡em.h
"

21 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

24 
	$CheckAndRecÜdMyPid
(cÚ¡ * 
sMyPIDLoÿtiÚ
, cÚ¡ * 
sBš¬yName
, 
boŞ
 
CheckProûssIsRuÂšg
)

26 #ià
	`defšed
(
WIN32
)

30 
¡©
 
¡
, 
¡1
;

31 *
tm¶ock
;

32 
sy¢ame
[256];

33 
buf
[8];

34 *
p
;

35 
¡©çed
 = 0;

36 
fd
;

37 
i
, 
e
, 
Ën
;

42 ià(
sMyPIDLoÿtiÚ
 =ğ
NULL
 || 
sBš¬yName
 =ğNULL || 
	`¡¾’
(sMyPIDLocation) + 32 > 128)

51 ià(
	`g‘ho¡Çme
(
sy¢ame
, (sysname)) < 0)

53 ià((
p
 = 
	`¡rchr
(
sy¢ame
, '.')è!ğ
NULL
)

54 *
p
 = 0;

55 ià((
tm¶ock
 = (*)
	`m®loc
(
	`¡¾’
(
sMyPIDLoÿtiÚ
)+32+1)è=ğ
NULL
)

57 
	`¡rıy
(
tm¶ock
, 
sMyPIDLoÿtiÚ
);

58 ià((
p
 = 
	`¡¼chr
(
tm¶ock
, '/')è=ğ
NULL
)

59 
p
 = 
tm¶ock
;

61 
p
++;

62 
	`¥rštf
(
p
, ".lk%05d%x%s", ()
	`g‘pid
(), ()
	`time
(
NULL
è& 15, 
sy¢ame
);

63 
i
 = 
	`umask
(022);

64 
fd
 = 
	`İ’
(
tm¶ock
, 
O_WRONLY
|
O_CREAT
|
O_EXCL
, 0644);

65 
e
 = 
”ºo
;

66 
	`umask
(
i
);

67 ià(
fd
 < 0) {

68 
	`ä“
 (
tm¶ock
);

69 
”ºo
 = 
e
;

73 
	`¥rštf
(
buf
, "%d\n", ()
	`g‘pid
());

74 
p
 = 
buf
;

75 
Ën
 = 
	`¡¾’
(
buf
);

77 
i
 = 
	`wr™e
(
fd
, 
p
, 
Ën
);

78 
e
 = 
”ºo
;

79 ià(
	`şo£
(
fd
) != 0) {

80 
e
 = 
”ºo
;

81 
i
 = -1;

83 ià(
i
 !ğ
Ën
) {

84 
	`uÆšk
(
tm¶ock
);

85 
	`ä“
 (
tm¶ock
);

86 
”ºo
 = 
i
 < 0 ? 
e
 : 
EAGAIN
;

93 
Œ›s
 = 1;

94 
dÚt¦“p
 = 1;

95 
¦“±ime
 = 10000;

96 
i
 = 0; i < 
Œ›s
 &&ries > 0; i++)

98 ià(!
dÚt¦“p
) {

101 
	`u¦“p
(
¦“±ime
);

103 
dÚt¦“p
 = 0;

113 ()
	`lšk
(
tm¶ock
, 
sMyPIDLoÿtiÚ
);

115 ià(
	`l¡©
(
tm¶ock
, &
¡1
) < 0) {

116 
e
 = 
”ºo
;

117 
	`ä“
 (
tm¶ock
);

118 
”ºo
 = 
e
;

122 ià(
	`l¡©
(
sMyPIDLoÿtiÚ
, &
¡
) < 0) {

123 ià(
¡©çed
++ > 5) {

130 
e
 = 
”ºo
;

131 ()
	`uÆšk
(
tm¶ock
);

132 
	`ä“
 (
tm¶ock
);

133 
”ºo
 = 
e
;

137 
Œ›s
++;

140 
¡©çed
 = 0;

145 ià(
¡
.
¡_rdev
 =ğ
¡1
.¡_rdev && st.
¡_šo
 == st1.st_ino)

147 ()
	`uÆšk
(
tm¶ock
);

148 
	`ä“
 (
tm¶ock
);

153 
FILE
 *
å
 = 
	`fİ’
(
sMyPIDLoÿtiÚ
, "r");

154 ià(
NULL
 !ğ
å
)

156 
iP»Pid
 = 0;

157 ià(1 =ğ
	`fsÿnf
(
å
, "%d", &
iP»Pid
))

160 
sBufãr
[64] = "";

161 
	`¢´štf
(
sBufãr
, (sBufãr), "/´oc/%d/cmdlše", 
iP»Pid
);

163 
FILE
* 
å_cmd
 = 
	`fİ’
(
sBufãr
, "r");

164 ià(
NULL
 !ğ
å_cmd
)

166 
bufCmd
[128] = "";

167 ià(1 =ğ
	`fsÿnf
(
å_cmd
, "%s", 
bufCmd
))

170 * 
pSÏsh
 = 
	`¡¼chr
(
bufCmd
, '/');

171 ià(
NULL
 !ğ
pSÏsh
 && 0 =ğ
	`¡rcmp
ÕSÏsh+1, 
sBš¬yName
))

175 
	`fşo£
(
å_cmd
);

176 
	`fşo£
(
å
);

178 ()
	`uÆšk
(
tm¶ock
);

179 
	`ä“
 (
tm¶ock
);

181 if(!
CheckProûssIsRuÂšg
 && (()
	`g‘pid
(è=ğ
iP»Pid
))

188 
	`fşo£
(
å_cmd
);

191 
	`fşo£
(
å
);

195 ()
	`uÆšk
(
sMyPIDLoÿtiÚ
);

196 
dÚt¦“p
 = 1;

197 
Œ›s
++;

201 ()
	`uÆšk
(
tm¶ock
);

202 
	`ä“
 (
tm¶ock
);

203 
”ºo
 = 
EAGAIN
;

206 
	}
}

208 #iâdeà
AGENT_DIR


209 
	#AGENT_DIR
 "/v¬/nuuo"

	)

212 
	$G‘AbsMSCouÁ
()

214 #ià
	`defšed
(
WIN32
)

221 
time¥ec
 
cu¼ts
 = {0};

222 ià(0 =ğ
	`şock_g‘time
(
CLOCK_MONOTONIC
, &
cu¼ts
))

223  (
cu¼ts
.
tv_£c
 * 1000è+ (cu¼ts.
tv_n£c
 / 1000000);

227 
	}
}

229 
	$K“pAliveFÜAg’t
(cÚ¡ * 
sAliveLogLoÿtiÚ
)

231 #ià
	`defšed
(
WIN32
)

236 
DIR
 *
dœ
 = 
	`İ’dœ
(
AGENT_DIR
);

237 ià(
NULL
 =ğ
dœ
)

238 
	`mkdœ
(
AGENT_DIR
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

240 
	`şo£dœ
(
dœ
);

242 
FILE
 *
å
 = 
	`fİ’
(
sAliveLogLoÿtiÚ
, "w");

243 ià(
NULL
 !ğ
å
)

247 
št64_t
 
now
 = 
	`G‘TimeCouÁMS
();

248 
	`årštf
(
å
, "%Îd", 
now
);

249 
	`fşo£
(
å
);

258 
	}
}

260 
	$K“pAliveFÜAg’t1
(cÚ¡ * 
sAliveLogLoÿtiÚ_Şd
, cÚ¡ * 
sAliveLogLoÿtiÚ_Ãw
)

262 #ià
	`defšed
(
WIN32
)

266 ifĞ
	`K“pAliveFÜAg’t
(
sAliveLogLoÿtiÚ_Şd
) )

269  
	`»Çme
(
sAliveLogLoÿtiÚ_Şd
,
sAliveLogLoÿtiÚ_Ãw
);

271 
	}
}

273 
	$V”ifyHashFunùiÚ
()

275  (
	`NuFNVHash_V”ify
() ? 0 : -1);

276 
	}
}

278 
	#HVAL_INIT
 ((
ušt64_t
)14695981039346656037ULL)

	)

280 
ušt64_t
 
	$_C®cBš¬yA¼ayHashV®ue
(cÚ¡ * 
bufãr
, cÚ¡ 
sizeBufãr
, cÚ¡ 
nB™s
)

294 ià(
NULL
 =ğ
bufãr
 || 0 >ğ
sizeBufãr
)

299 ià(
nB™s
 > 64 ||

300 
nB™s
 <= 32 )

305 cÚ¡ 
l_size
 = 128;

306 
l_buf
[
l_size
];

308 * 
buf
 = ((
l_size
 < 
sizeBufãr
è? 
Ãw
 [sizeBufãr] : 
l_buf
);

309 ià(
NULL
 =ğ
buf
)

315 
	`mem£t
(
buf
, 0, 
sizeBufãr
);

316 
	`memıy
(
buf
, 
bufãr
, 
sizeBufãr
);

319 
pos
 = 
sizeBufãr
 - 1;

320 
pos
 >= 0)

322 ià(0 =ğ
buf
[
pos
])

324 
pos
--;

332 ià(0 > 
pos
)

337 ià(
l_size
 < 
sizeBufãr
)

339 
d–‘e
[] 
buf
;

340 
buf
 = 
NULL
;

346 
nZ”os
 = 1;

347 
i
 = 0; i <ğ
pos
; i++)

349 ià(0 =ğ
buf
[
i
])

351 
buf
[
i
] = 
nZ”os
;

352 
nZ”os
++;

357 
ušt64_t
 
hv®
 = 0LL;

358 ià(64 =ğ
nB™s
)

360 
hv®
 = 
	`NuFNVHash_64a_Buf
(
buf
, 
pos
 + 1, 
HVAL_INIT
);

364 
hv®
 = 
	`NuFNVHash_64a_Buf_XÜFŞd
(
buf
, 
pos
 + 1, 
HVAL_INIT
, 
nB™s
);

368 ià(
l_size
 < 
sizeBufãr
)

370 
d–‘e
[] 
buf
;

371 
buf
 = 
NULL
;

373  
hv®
;

374 
	}
}

376 
	$_G’”©eS”v”Info
(* 
bufãr
, cÚ¡ 
bufãr_size
, cÚ¡ * 
£rv”_Çme
)

379 
	`mem£t
(
bufãr
, 0, 
bufãr_size
);

381 * cÚ¡ 
p
 = 
bufãr
;

382 
off£t
 = 0;

385 
ušt32_t
 
¢_ıu
[3] = {0, 0, 0};

386 
	`G‘CPUSN
(
¢_ıu
);

387 
	`memıy
(
p
 + 
off£t
, 
¢_ıu
, (
ušt32_t
) * 3);

388 
off£t
 +ğ(
ušt32_t
) * 3;

391 
off£t
 += 5;

394 
¡d
::
veùÜ
<
N‘wÜkAd­‹rInfo
> 
šfos
;

395 
	`G‘N‘wÜkAd­‹rs
(
šfos
);

398 
size_t
 
ui
 = 0; u˜< 
šfos
.
	`size
(); ui++)

400 ià(
šfos
[
ui
].
Çme
 == "eth0")

402 
	`memıy
(
p
 + 
off£t
, 
šfos
[
ui
].
mac
, (infos[ui].mac));

405 
off£t
 += 6;

408 
size_t
 
ui
 = 0; u˜< 
šfos
.
	`size
(); ui++)

410 ià(
šfos
[
ui
].
Çme
 == "eth1")

412 
	`memıy
(
p
 + 
off£t
, 
šfos
[
ui
].
mac
, (infos[ui].mac));

415 
off£t
 += 6;

418 ià(
NULL
 !ğ
£rv”_Çme
)

420 
off£t
 += 12;

422 
	`memıy
(
p
 + 
off£t
, 
£rv”_Çme
, 
	`¡¾’
(server_name));

423 
off£t
 +ğ
	`¡¾’
(
£rv”_Çme
);

426  
off£t
;

427 
	}
}

429 
	$G‘S”v”Info_Mªagem’tS”v”
(* 
bufãr
, cÚ¡ 
bufãr_size
)

435 ià(
NULL
 =ğ
bufãr
 || 64 !ğ
bufãr_size
)

440 ià(47 !ğ
	`_G’”©eS”v”Info
(
bufãr
, 
bufãr_size
, "Manage"))

446 
	}
}

448 
	$G‘S”v”Info_RecÜdšgS”v”
(* 
bufãr
, cÚ¡ 
bufãr_size
)

455 ià(
NULL
 =ğ
bufãr
 || 64 !ğ
bufãr_size
)

460 ià(29 !ğ
	`_G’”©eS”v”Info
(
bufãr
, 
bufãr_size
, 
NULL
))

466 
	}
}

468 
	$G‘S”v”Info_M‘ad©aS”v”
(* 
bufãr
, cÚ¡ 
bufãr_size
)

474 ià(
NULL
 =ğ
bufãr
 || 64 !ğ
bufãr_size
)

479 ià(47 !ğ
	`_G’”©eS”v”Info
(
bufãr
, 
bufãr_size
, "Mtdata"))

485 
	}
}

487 
	$G‘Mªag”Info_ThœdP¬tyMªag”
(* 
bufãr
, cÚ¡ 
bufãr_size
)

493 ià(
NULL
 =ğ
bufãr
 || 64 !ğ
bufãr_size
)

498 ià(47 !ğ
	`_G’”©eS”v”Info
(
bufãr
, 
bufãr_size
, "3rdMgr"))

504 
	}
}

506 
	$G‘S”viûInfo_IVSS”viû
(* 
bufãr
, cÚ¡ 
bufãr_size
)

512 ià(
NULL
 =ğ
bufãr
 || 64 !ğ
bufãr_size
)

517 ià(47 !ğ
	`_G’”©eS”v”Info
(
bufãr
, 
bufãr_size
, "IVSSer"))

523 
	}
}

525 
ušt64_t
 
	$G‘S”v”ID_Mªagem’tS”v”
()

527 
bufãr
[64] = {0};

529 ià(0 =ğ
	`G‘S”v”Info_Mªagem’tS”v”
(
bufãr
, (buffer)))

531  
	`_C®cBš¬yA¼ayHashV®ue
(
bufãr
, (buffer), 64);

537 
	}
}

539 
ušt64_t
 
	$G‘S”v”ID_RecÜdšgS”v”
()

541 
bufãr
[64] = {0};

543 ià(0 =ğ
	`G‘S”v”Info_RecÜdšgS”v”
(
bufãr
, (buffer)))

545  
	`_C®cBš¬yA¼ayHashV®ue
(
bufãr
, (buffer), 64);

551 
	}
}

553 
ušt64_t
 
	$G‘S”v”ID_M‘ad©aS”v”
()

555 
bufãr
[64] = {0};

557 ià(0 =ğ
	`G‘S”v”Info_M‘ad©aS”v”
(
bufãr
, (buffer)))

559  
	`_C®cBš¬yA¼ayHashV®ue
(
bufãr
, (buffer), 64);

565 
	}
}

567 
ušt64_t
 
	$G‘Mªag”ID_ThœdP¬tyMªag”
()

569 
bufãr
[64] = {0};

571 ià(0 =ğ
	`G‘Mªag”Info_ThœdP¬tyMªag”
(
bufãr
, (buffer)))

573  
	`_C®cBš¬yA¼ayHashV®ue
(
bufãr
, (buffer), 64);

579 
	}
}

581 
ušt64_t
 
	$G‘S”viûID_IVSS”viû
()

583 
bufãr
[64] = {0};

585 ià(0 =ğ
	`G‘S”viûInfo_IVSS”viû
(
bufãr
, (buffer)))

587  
	`_C®cBš¬yA¼ayHashV®ue
(
bufãr
, (buffer), 64);

593 
	}
}

	@../../titanutils/titanminihelper/titanutils.h

1 #iâdeà
_TITANUTILS_H_


2 
	#_TITANUTILS_H_


	)

4 
	~"commÚ/¡dšt.h
"

6 
CheckAndRecÜdMyPid
(cÚ¡ * 
sMyPIDLoÿtiÚ
, cÚ¡ * 
sBš¬yName
, 
boŞ
 
CheckProûssIsRuÂšg
 = 
Œue
);

7 
K“pAliveFÜAg’t
(cÚ¡ * 
sAliveLogLoÿtiÚ
);

8 
K“pAliveFÜAg’t1
(cÚ¡ * 
sAliveLogLoÿtiÚ_Şd
, cÚ¡ * 
sAliveLogLoÿtiÚ_Ãw
);

10 
V”ifyHashFunùiÚ
();

11 
G‘S”v”Info_Mªagem’tS”v”
(* 
bufãr
, cÚ¡ 
bufãr_size
);

12 
G‘S”v”Info_RecÜdšgS”v”
 (* 
bufãr
, cÚ¡ 
bufãr_size
);

13 
G‘S”v”Info_M‘ad©aS”v”
 (* 
bufãr
, cÚ¡ 
bufãr_size
);

14 
G‘Mªag”Info_ThœdP¬tyMªag”
 (* 
bufãr
, cÚ¡ 
bufãr_size
);

15 
ušt64_t
 
G‘S”v”ID_Mªagem’tS”v”
();

16 
ušt64_t
 
G‘S”v”ID_RecÜdšgS”v”
();

17 
ušt64_t
 
G‘S”v”ID_M‘ad©aS”v”
();

18 
ušt64_t
 
G‘Mªag”ID_ThœdP¬tyMªag”
();

19 
ušt64_t
 
G‘S”viûID_IVSS”viû
();

	@../apr/apr_cond.cpp

1 
	~"­r/­r_cÚd.h
"

2 
	~<as£¹.h
>

4 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

6 
DLL_PUBLIC
 
	gA´CÚd
::
	$A´CÚd
(
boŞ
 
fMªu®Re£t
) :

7 
	`m_fSšg®
(
çl£
),

8 
	$m_fMªu®Re£t
(
fMªu®Re£t
)

10 
	`as£¹
(
	`thePoŞ
().
	`guts
());

12 
	`­r_th»ad_mu‹x_ü—‹
(&
m_mu‹x
, 
APR_THREAD_MUTEX_UNNESTED
, 
	`thePoŞ
().
	`guts
());

13 
	`­r_th»ad_cÚd_ü—‹
(&
m_cÚd
, 
	`thePoŞ
().
	`guts
());

14 
	}
}

16 
DLL_PUBLIC
 
	gA´CÚd
::~
	$A´CÚd
()

18 
	`thePoŞ
().
	`ş—r
();

19 
	}
}

21 
DLL_PUBLIC
 
	gA´CÚd
::
	$£t
()

23 
	`­r_th»ad_mu‹x_lock
(
m_mu‹x
);

24 
m_fSšg®
 = 
Œue
;

25 
	`­r_th»ad_cÚd_sigÇl
(
m_cÚd
);

26 
	`­r_th»ad_mu‹x_uÆock
(
m_mu‹x
);

27 
	}
}

29 
DLL_PUBLIC
 
boŞ
 
	gA´CÚd
::
	$wa™
()

31 
	`­r_th»ad_mu‹x_lock
(
m_mu‹x
);

33 !
m_fSšg®
)

35 
	`­r_th»ad_cÚd_wa™
(
m_cÚd
, 
m_mu‹x
);

38 ià(!
m_fMªu®Re£t
)

40 
m_fSšg®
 = !m_fSingal;

43 
	`­r_th»ad_mu‹x_uÆock
(
m_mu‹x
);

45  
Œue
;

46 
	}
}

48 
DLL_PUBLIC
 
boŞ
 
	gA´CÚd
::
	$timedwa™
(
št64_t
 
timeout
)

50 
­r_¡©us_t
 
rv
 = 
APR_SUCCESS
;

51 
	`­r_th»ad_mu‹x_lock
(
m_mu‹x
);

53 !
m_fSšg®
 && 
APR_TIMEUP
 !ğ
rv
)

55 
rv
 = 
	`­r_th»ad_cÚd_timedwa™
(
m_cÚd
, 
m_mu‹x
, (
­r_š‹rv®_time_t
)(
timeout
 * 1000));

58 ià(!
m_fMªu®Re£t
 && 
APR_TIMEUP
 !ğ
rv
)

60 
m_fSšg®
 = !m_fSingal;

63 
	`­r_th»ad_mu‹x_uÆock
(
m_mu‹x
);

65  
APR_TIMEUP
 !ğ
rv
;

66 
	}
}

68 
DLL_PUBLIC
 
	gA´CÚd
::
	$»£t
()

70 
	`­r_th»ad_mu‹x_lock
(
m_mu‹x
);

71 
m_fSšg®
 = 
çl£
;

72 
	`­r_th»ad_mu‹x_uÆock
(
m_mu‹x
);

73 
	}
}

	@../apr/apr_cond.h

1 #iâdeà
__APR_COND_H__


2 
	#__APR_COND_H__


	)

4 
	~"expÜts.h
"

5 
	~"commÚ/¡dšt.h
"

6 
	~"­r-1/­r_th»ad_cÚd.h
"

7 
	~"­r/­r_objeù.h
"

9 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

11 şas 
	cDLL_PUBLIC
 
	gA´CÚd
 : 
public
 
A´Objeù
 {

12 
public
:

13 
A´CÚd
(
boŞ
 
fMªu®Re£t
);

14 
	gvœtu®
 ~
A´CÚd
();

16 
£t
();

17 
boŞ
 
wa™
();

18 
boŞ
 
timedwa™
(
št64_t
 
timeout
);

19 
»£t
();

21 
	g´iv©e
:

22 
­r_th»ad_mu‹x_t
* 
m_mu‹x
;

23 
­r_th»ad_cÚd_t
* 
	gm_cÚd
;

24 
boŞ
 
	gm_fSšg®
;

25 
boŞ
 
	gm_fMªu®Re£t
;

	@../apr/apr_debug.h

1 #iâdeà
__APR_DEBUG_H__


2 
	#__APR_DEBUG_H__


	)

4 
	~<¡dio.h
>

5 
	~"­r-1/­r_”ºo.h
"

7 
	#BUFSIZE
 4096

	)

9 
	#­r_´štf
(
fmt
, ...) do { \

10 
	`´štf
(
fmt
, ##
__VA_ARGS__
); \

11 } 0)

	)

13 
	#­r_dum³¼Ü
(
w
) do { \

14 
buf
[
BUFSIZE
]; \

15 
	`­r_¡»¼Ü
((
w
), 
buf
, (buf)); \

16 
	`årštf
(
¡d”r
, "%s:%d:%s: %s\n", 
__FILE__
, 
__LINE__
, 
__FUNCTION__
, 
buf
); \

17 } 0)

	)

	@../apr/apr_object.cpp

1 
	~"­r_objeù.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
DLL_PUBLIC
 
	gA´Objeù
::
	$A´Objeù
()

6 : 
	$m_poŞ
()

8 
	}
}

10 
DLL_PUBLIC
 
A´Objeù
::~
	$A´Objeù
()

12 
	}
}

14 
DLL_PUBLIC
 
A´PoŞ
& 
A´Objeù
::
	$thePoŞ
()

16  
m_poŞ
;

17 
	}
}

	@../apr/apr_object.h

1 #iâdeà
__APR_OBJECT_H__


2 
	#__APR_OBJECT_H__


	)

4 
	~"expÜts.h
"

5 
	~"­r/­r_poŞ.h
"

7 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

9 şas 
	cDLL_PUBLIC
 
	gA´Objeù
 {

10 
	gpublic
:

11 
A´Objeù
();

12 
	gvœtu®
 ~
A´Objeù
();

13 
	g´Ùeùed
:

14 
A´PoŞ
& 
thePoŞ
();

15 
	g´iv©e
:

16 
A´PoŞ
 
m_poŞ
;

	@../apr/apr_pollset.cpp

1 
	~"­r/­r_pŞl£t.h
"

2 
	~<as£¹.h
>

3 
	~"commÚ/ut™y.h
"

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
DLL_PUBLIC
 
	gA´PŞlS‘
::
	$A´PŞlS‘
(
ušt32_t
 
size
)

8 : 
	$m_pŞl£t
(
NULL
)

10 
	`as£¹
(
	`thePoŞ
().
	`guts
());

11 
­r_¡©us_t
 
¡©us
 = 
	`­r_pŞl£t_ü—‹
(&
m_pŞl£t
, 
size
, 
	`thePoŞ
().
	`guts
(), 
APR_POLLSET_THREADSAFE
);

12 #ià
	`defšed
(
_WIN32
)

13 ià(
¡©us
 =ğ
APR_ENOTIMPL
)

15 
¡©us
 = 
	`­r_pŞl£t_ü—‹
(&
m_pŞl£t
, 
size
, 
	`thePoŞ
().
	`guts
(), 0);

19 ià(
¡©us
 !ğ
APR_SUCCESS
)

21 
	`as£¹
(0);

25 
	`as£¹
(
¡©us
 =ğ
APR_SUCCESS
);

26 
	`as£¹
(
m_pŞl£t
);

27 
	}
}

29 
DLL_PUBLIC
 
	gA´PŞlS‘
::~
	$A´PŞlS‘
()

31 
­r_¡©us_t
 
¡©us
 = 
	`­r_pŞl£t_de¡roy
(
m_pŞl£t
);

32 ià(
¡©us
 !ğ
APR_SUCCESS
)

34 
	`as£¹
(0);

36 
	}
}

38 
DLL_PUBLIC
 
boŞ
 
	gA´PŞlS‘
::
	$add
(cÚ¡ 
­r_pŞlfd_t
 *
desütÜ
)

40 
	`IF_NULL_RETURN_VALUE
(
desütÜ
, 
çl£
);

41 
	`IF_NULL_RETURN_VALUE
(
m_pŞl£t
, 
çl£
);

42 
­r_pŞlfd_t
 
pfd
 = {
	`thePoŞ
().
	`guts
(), 
desütÜ
->
desc_ty³
, desütÜ->
»qev’ts
, desütÜ->
¹Ãv’ts
, desütÜ->
desc
, desütÜ->
ş›Á_d©a
};

43 
­r_¡©us_t
 
¡©us
 = 
	`­r_pŞl£t_add
(
m_pŞl£t
, &
pfd
);

44  (
¡©us
 =ğ
APR_SUCCESS
);

45 
	}
}

47 
DLL_PUBLIC
 
boŞ
 
	gA´PŞlS‘
::
	$»move
(cÚ¡ 
­r_pŞlfd_t
 *
desütÜ
)

49 
	`IF_NULL_RETURN_VALUE
(
desütÜ
, 
çl£
);

50 
	`IF_NULL_RETURN_VALUE
(
m_pŞl£t
, 
çl£
);

51 
­r_pŞlfd_t
 
pfd
 = {
	`thePoŞ
().
	`guts
(), 
desütÜ
->
desc_ty³
, desütÜ->
»qev’ts
, desütÜ->
¹Ãv’ts
, desütÜ->
desc
, desütÜ->
ş›Á_d©a
};

52 
­r_¡©us_t
 
¡©us
 = 
	`­r_pŞl£t_»move
(
m_pŞl£t
, &
pfd
);

53  (
¡©us
 =ğ
APR_SUCCESS
);

54 
	}
}

56 
DLL_PUBLIC
 
boŞ
 
	gA´PŞlS‘
::
	$pŞl
(
št32_t
 *
num
, cÚ¡ 
­r_pŞlfd_t
 **
desütÜs
, iÁ32_ˆ
timeout
 )

58 
	`IF_NULL_RETURN_VALUE
(
m_pŞl£t
, 
çl£
);

59 
št32_t
 
maüo£cÚds
 = (
timeout
 < 0) ? (timeout) : (timeout * 1000);

60 
­r_¡©us_t
 
¡©us
 = 
	`­r_pŞl£t_pŞl
(
m_pŞl£t
, 
maüo£cÚds
, 
num
, 
desütÜs
);

61  (
¡©us
 =ğ
APR_SUCCESS
);

62 
	}
}

	@../apr/apr_pollset.h

1 #iâdeà
__APR_POLLSET_H__


2 
	#__APR_POLLSET_H__


	)

4 
	~"expÜts.h
"

5 
	~"commÚ/¡dšt.h
"

6 
	~"­r-1/­r_pŞl.h
"

7 
	~"­r/­r_objeù.h
"

9 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 şas 
	cDLL_PUBLIC
 
	gA´PŞlS‘
 : 
public
 
A´Objeù
 {

15 
public
:

20 
A´PŞlS‘
(
ušt32_t
 
size
);

25 
	gvœtu®
 ~
A´PŞlS‘
();

32 
boŞ
 
add
(cÚ¡ 
­r_pŞlfd_t
 *
desütÜ
);

39 
boŞ
 
»move
(cÚ¡ 
­r_pŞlfd_t
 *
desütÜ
);

49 
boŞ
 
pŞl
(
št32_t
 *
num
, cÚ¡ 
­r_pŞlfd_t
 **
desütÜs
, iÁ32_ˆ
timeout
=-1);

51 
	g´iv©e
:

52 
A´PŞlS‘
();

53 
A´PŞlS‘
(cÚ¡ A´PŞlS‘ &
rhs
);

54 
	gA´PŞlS‘
 &
	gİ”©Ü
=(cÚ¡ 
A´PŞlS‘
 &
rhs
);

56 
	g´iv©e
:

57 
­r_pŞl£t_t
 *
m_pŞl£t
;

	@../apr/apr_pool.cpp

1 
	~<as£¹.h
>

2 
	~"­r-1/­r_g’”®.h
"

3 
	~"­r/­r_roÙ.h
"

4 
	~"­r/­r_poŞ.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
DLL_PUBLIC
 
	gA´PoŞ
::
	$A´PoŞ
(
­r_ušt32_t
 
maxä“
) :

9 
	`m_poŞ
(
NULL
),

10 
	$m_maxä“
(
maxä“
)

12 
	`­r_poŞ_ü—‹
(&
m_poŞ
, 
A´RoÙ
::
	`š¡ªû
()->
	`g‘RoÙPoŞ
());

13 
	`as£¹
(
m_poŞ
);

14 
	`£tCacheSize
(
maxä“
);

15 
	}
}

17 
DLL_PUBLIC
 
	gA´PoŞ
::~
	$A´PoŞ
()

19 
	`­r_poŞ_de¡roy
(
m_poŞ
);

20 
	}
}

22 
DLL_PUBLIC
 * 
	gA´PoŞ
::
	$®loc
(
­r_size_t
 
š_size
)

24  
	`­r_·Îoc
(
m_poŞ
, 
š_size
);

25 
	}
}

27 
DLL_PUBLIC
 
	gA´PoŞ
::
	$ş—r
()

29 
	`­r_poŞ_ş—r
(
m_poŞ
);

30 
	}
}

32 
DLL_PUBLIC
 
­r_poŞ_t
* 
	gA´PoŞ
::
	$guts
()

34  
m_poŞ
;

35 
	}
}

40 
DLL_PUBLIC
 
	gA´PoŞ
::
	$£tCacheSize
(
­r_size_t
 
size
)

42 
­r_®loÿtÜ_t
* 
·
 = 
	`­r_poŞ_®loÿtÜ_g‘
(
m_poŞ
);

43 ià(
·
)

45 
	`­r_®loÿtÜ_max_ä“_£t
(
·
, 
size
);

47 
	}
}

	@../apr/apr_pool.h

1 #iâdeà
__APR_POOL_H__


2 
	#__APR_POOL_H__


	)

4 
	~"expÜts.h
"

5 
	~"­r-1/­r_poŞs.h
"

7 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

9 şas 
	cDLL_PUBLIC
 
	gA´PoŞ
 {

10 
	gpublic
:

11 
A´PoŞ
(
­r_ušt32_t
 
maxä“
 = (1<<20));

12 
	gvœtu®
 ~
A´PoŞ
();

13 * 
®loc
(
­r_size_t
 
size
);

14 
ş—r
();

15 
­r_poŞ_t
* 
guts
();

16 
£tCacheSize
(
­r_size_t
 
size
);

17 
	g´iv©e
:

18 
­r_poŞ_t
* 
m_poŞ
;

19 
­r_ušt32_t
 
	gm_maxä“
;

	@../apr/apr_root.cpp

1 
	~<as£¹.h
>

2 
	~"­r/­r_debug.h
"

3 
	~"­r/­r_roÙ.h
"

6 
	#APR_POOL_MAX_FREE_SIZE
 32

	)

8 
	~<memÜy
>

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 
DLL_PUBLIC
 
	gA´RoÙ
::
	$A´RoÙ
() :

13 
	$m_roÙPoŞ
(
NULL
)

15 
	`­r_´štf
("APR Application Instance initiating ...\n");

16 
­r_¡©us_t
 
rc
;

17 
rc
 = 
	`­r_š™Ÿlize
();

18 
	`as£¹
(
rc
 =ğ
APR_SUCCESS
);

20 
rc
 = 
	`­r_poŞ_ü—‹
(&
m_roÙPoŞ
, 
NULL
);

21 
	`as£¹
(
rc
 =ğ
APR_SUCCESS
);

23 
­r_®loÿtÜ_t
* 
·
 = 
	`­r_poŞ_®loÿtÜ_g‘
(
m_roÙPoŞ
);

24 ià(
·
 !ğ
NULL
)

26 
	`­r_®loÿtÜ_max_ä“_£t
(
·
, 
APR_POOL_MAX_FREE_SIZE
);

29 
	`­r_´štf
("APR Application Instance init done ...\n");

30 
	}
}

32 
DLL_PUBLIC
 
	gA´RoÙ
::~
	$A´RoÙ
()

34 
	`­r_poŞ_ş—r
(
m_roÙPoŞ
);

35 
	`­r_‹rmš©e
();

36 
	`­r_´štf
("APR Application Instance fini done ...\n");

37 
	}
}

39 
DLL_PUBLIC
 
­r_poŞ_t
* 
	gA´RoÙ
::
	$g‘RoÙPoŞ
()

41  
m_roÙPoŞ
;

42 
	}
}

44 
DLL_PUBLIC
 
A´RoÙ
* 
	gA´RoÙ
::
	$š¡ªû
()

46 
¡d
::
auto_±r
<
A´RoÙ
> 
	`s_š¡ªû
(
Ãw
 AprRoot);

48  
s_š¡ªû
.
	`g‘
();

49 
	}
}

	@../apr/apr_root.h

1 #iâdeà
__APR_ROOT_H__


2 
	#__APR_ROOT_H__


	)

4 
	~"expÜts.h
"

5 
	~"­r-1/­r_poŞs.h
"

7 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

9 şas 
	cDLL_PUBLIC
 
	gA´RoÙ
 {

10 
	g´iv©e
:

11 
A´RoÙ
();

12 
	gpublic
:

13 
vœtu®
 ~
A´RoÙ
();

14 
­r_poŞ_t
* 
g‘RoÙPoŞ
();

15 
A´RoÙ
* 
š¡ªû
();

16 
	g´iv©e
:

17 
­r_poŞ_t
* 
m_roÙPoŞ
;

	@../apr/apr_socket.cpp

1 
	~<as£¹.h
>

2 
	~<sys/sock‘.h
>

3 
	~"­r-1/­r_”ºo.h
"

4 
	~"­r/­r_sock‘.h
"

5 
	~"­r_debug.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 
DLL_PUBLIC
 
	gA´Sock‘
::
	$A´Sock‘
(
çmy
, 
ty³
, 
´Ùo
) :

11 
	`m_sock‘
(
NULL
),

12 
	$m_bšdAddr
(
NULL
)

14 
­r_¡©us_t
 
rc
;

15 
rc
 = 
	`­r_sock‘_ü—‹
(&
m_sock‘
, 
çmy
, 
ty³
, 
´Ùo
, 
	`thePoŞ
().
	`guts
());

16 ià(
rc
 !ğ
APR_SUCCESS
)

18 
	`as£¹
(0);

20 
	}
}

22 
DLL_PUBLIC
 
	gA´Sock‘
::
	$A´Sock‘
(
­r_sock‘_t
 *
guts
, 
­r_sockaddr_t
* 
addr
) :

23 
	`m_sock‘
(
guts
),

24 
	$m_bšdAddr
(
addr
)

26 
	}
}

28 
DLL_PUBLIC
 
	gA´Sock‘
::~
	$A´Sock‘
()

30 
	`­r_sock‘_shutdown
(
m_sock‘
, 
APR_SHUTDOWN_READWRITE
);

31 
	`­r_sock‘_şo£
(
m_sock‘
);

32 
m_sock‘
 = 
NULL
;

33 
	}
}

35 
DLL_PUBLIC
 
boŞ
 
	gA´Sock‘
::
	$bšd
(cÚ¡ *
ho¡Çme
, 
ušt16_t
 
pÜt
)

37 
­r_¡©us_t
 
rc
 = 
	`­r_sockaddr_šfo_g‘
(

38 &
m_bšdAddr
,

39 
ho¡Çme
,

40 
APR_INET
, 
pÜt
,

42 
	`thePoŞ
().
	`guts
()

45 ià(
rc
 !ğ
APR_SUCCESS
)

47 
”rÜ
;

50 
rc
 = 
	`­r_sock‘_İt_£t
(
m_sock‘
, 
APR_SO_REUSEADDR
, 1);

52 ià(
rc
 !ğ
APR_SUCCESS
)

54 
”rÜ
;

57 
rc
 = 
	`­r_sock‘_bšd
(
m_sock‘
, 
m_bšdAddr
);

58 ià(
rc
 !ğ
APR_SUCCESS
)

60 
”rÜ
;

62  
Œue
;

64 
”rÜ
:

66  
çl£
;

67 
	}
}

69 
DLL_PUBLIC
 
št32_t
 
	gA´Sock‘
::
	$g‘O±iÚ
(
št32_t
 
İt
)

71 
št32_t
 
Ú
;

72 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_İt_g‘
(
m_sock‘
, 
İt
, &
Ú
);

73 ià(
rc
 !ğ
APR_SUCCESS
)

75 
	`as£¹
(0);

78  (
št32_t
)
Ú
;

79 
	}
}

81 
DLL_PUBLIC
 
boŞ
 
	gA´Sock‘
::
	$£tO±iÚ
(
št32_t
 
İt
, iÁ32_ˆ
v®ue
)

83 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_İt_£t
(
m_sock‘
, 
İt
, 
v®ue
);

84 ià(
rc
 !ğ
APR_SUCCESS
)

87  
çl£
;

89  
Œue
;

90 
	}
}

92 
DLL_PUBLIC
 
boŞ
 
	gA´Sock‘
::
	$£tTimeOut
(
št64_t
 
t
)

94 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_timeout_£t
(
m_sock‘
, 
t
 * 1000);

95 ià(
rc
 !ğ
APR_SUCCESS
)

98  
çl£
;

100  
Œue
;

101 
	}
}

103 
DLL_PUBLIC
 
št64_t
 
	gA´Sock‘
::
	$g‘TimeOut
()

105 
­r_š‹rv®_time_t
 
t
;

106 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_timeout_g‘
(
m_sock‘
, &
t
);

107 ià(
rc
 !ğ
APR_SUCCESS
)

109 
	`as£¹
(0);

112 ià(
t
 < 0)

114  (
št64_t
)-1;

118  (
št64_t
)(
t
 / 1000);

120 
	}
}

122 
DLL_PUBLIC
 
št32_t
 
	gA´Sock‘
::
	$g‘PrÙo
()

124 
št32_t
 
´Ùo
;

125 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_´ÙocŞ_g‘
(
m_sock‘
, &
´Ùo
);

126 ià(
rc
 !ğ
APR_SUCCESS
)

128 
	`as£¹
(0);

131  
´Ùo
;

132 
	}
}

134 
DLL_PUBLIC
 
­r_sock‘_t
* 
	gA´Sock‘
::
	$guts
()

136  
m_sock‘
;

137 
	}
}

139 
DLL_PUBLIC
 
­r_sockaddr_t
* 
	gA´Sock‘
::
	$bšdAddr
()

141  
m_bšdAddr
;

142 
	}
}

144 
DLL_PUBLIC
 
boŞ
 
	gA´Sock‘
::
	$ü—‹SockAddrInfo
(

145 
­r_sockaddr_t
** 
§
,

146 cÚ¡ * 
ho¡Çme
,

147 
­r_pÜt_t
 
pÜt
,

148 
­r_poŞ_t
* 
p


151 
­r_¡©us_t
 
rc
 = 
	`­r_sockaddr_šfo_g‘
(
§
, 
ho¡Çme
, 
APR_INET
, 
pÜt
, 0, 
p
);

152 ià(
rc
 !ğ
APR_SUCCESS
)

155  
çl£
;

157  
Œue
;

158 
	}
}

160 
DLL_PUBLIC
 
boŞ
 
	gA´Sock‘
::
	$g‘SockAddrIP
(
­r_sockaddr_t
* 
§ddr
, * 
buf
, 
­r_size_t
 
Ën
)

162 
­r_¡©us_t
 
rc
 = 
	`­r_sockaddr__g‘buf
(
buf
, 
Ën
, 
§ddr
);

163 ià(
rc
 !ğ
APR_SUCCESS
)

166  
çl£
;

168  
Œue
;

169 
	}
}

171 
DLL_PUBLIC
 
boŞ
 
	gA´Sock‘
::
	$g‘RemÙeSockAddr
(
­r_sockaddr_t
*& 
§ddr
)

173 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_addr_g‘
(&
§ddr
, 
APR_REMOTE
, 
	`guts
());

174 ià(
rc
 !ğ
APR_SUCCESS
)

177  
çl£
;

179  
Œue
;

180 
	}
}

182 
DLL_PUBLIC
 
boŞ
 
	gA´Sock‘
::
	$g‘LoÿlSockAddr
(
­r_sockaddr_t
*& 
§ddr
)

184 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_addr_g‘
(&
§ddr
, 
APR_LOCAL
, 
	`guts
());

185 ià(
rc
 !ğ
APR_SUCCESS
)

188  
çl£
;

190  
Œue
;

191 
	}
}

194 
DLL_PUBLIC
 
	gA´TıSock‘
::
	$A´TıSock‘
() :

195 
	`A´Sock‘
(
APR_INET
, 
SOCK_STREAM
, 
APR_PROTO_TCP
),

196 
	`m_cÚÃùAddr
(
NULL
),

197 
	$m_cÚÃùPÜt
(0)

199 
	}
}

201 
DLL_PUBLIC
 
	gA´TıSock‘
::
	$A´TıSock‘
(
­r_sock‘_t
* 
guts
, 
­r_sockaddr_t
* 
addr
) :

202 
	$A´Sock‘
(
guts
, 
addr
)

204 
	}
}

206 
DLL_PUBLIC
 
	gA´TıSock‘
::
	$A´TıSock‘
(
­r_os_sock_t
 
os_sock‘
) :

207 
	$A´Sock‘
(
NULL
, NULL)

209 
­r_os_sock_šfo_t
 
sock‘_šfo
;

210 
­r_¡©us_t
 
¡©us
;

212 
sock‘_šfo
.
os_sock
 = &
os_sock‘
;

213 
sock‘_šfo
.
loÿl
 = 
NULL
;

214 
sock‘_šfo
.
»mÙe
 = 
NULL
;

215 
sock‘_šfo
.
çmy
 = 
APR_INET
;

216 
sock‘_šfo
.
ty³
 = 
SOCK_STREAM
;

217 
sock‘_šfo
.
´ÙocŞ
 = 
APR_PROTO_TCP
;

218 
¡©us
 = 
	`­r_os_sock_make
(&
m_sock‘
, &
sock‘_šfo
, 
	`thePoŞ
().
	`guts
());

220 ià(
¡©us
 !ğ
APR_SUCCESS
)

222 
	`as£¹
(0);

224 
	}
}

226 
DLL_PUBLIC
 
	gA´TıSock‘
::~
	$A´TıSock‘
()

228 
	}
}

230 
DLL_PUBLIC
 
A´TıSock‘
* A´TıSock‘::
	$acû±
()

232 
­r_sock‘_t
* 
ş›Á
;

233 
A´TıSock‘
* 
sock‘
 = 
Ãw
 
	`A´TıSock‘
(
NULL
, NULL);

234 
	`as£¹
(
sock‘
 !ğ
NULL
);

236 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_acû±
(

237 &
ş›Á
,

238 
m_sock‘
, 
sock‘
->
	`thePoŞ
().
	`guts
()

241 
sock‘
->
	`masqu”ade
(
ş›Á
);

243 ià(
rc
 !ğ
APR_SUCCESS
)

246  
NULL
;

249  
sock‘
;

250 
	}
}

252 
DLL_PUBLIC
 
boŞ
 
	gA´TıSock‘
::
	$li¡’
(
backLog
)

254 
­r_¡©us_t
 
rc
 = 
	`­r_sock‘_li¡’
(
m_sock‘
, 
backLog
);

255  
rc
 !ğ
APR_SUCCESS
 ? 
çl£
 : 
Œue
;

256 
	}
}

258 
DLL_PUBLIC
 
­r_¡©us_t
 
	gA´TıSock‘
::
	$cÚÃù
(cÚ¡ * 
ho¡Çme
, 
ušt16_t
 
pÜt
)

260 ià(
	`¡¾’
(
ho¡Çme
) == 0 ||

261 
pÜt
 == 0)

263  
	`­r_¡©us_t
(-1);

266 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

268 ià(
m_cÚÃùHo¡Name
 !ğ
ho¡Çme
)

270 ià(
m_cÚÃùAddr
)

272 
m_cÚÃùAddr
 = 
NULL
;

275 
rc
 = 
	`­r_sockaddr_šfo_g‘
(

276 &
m_cÚÃùAddr
,

277 
ho¡Çme
,

278 
APR_INET
,

279 
pÜt
, 0,

280 
	`thePoŞ
().
	`guts
()

283 ià(
rc
 !ğ
APR_SUCCESS
)

285 
”rÜ
;

288 
m_cÚÃùHo¡Name
 = 
ho¡Çme
;

289 
m_cÚÃùPÜt
 = 
pÜt
;

292 
rc
 = 
	`­r_sock‘_cÚÃù
(
m_sock‘
, 
m_cÚÃùAddr
);

294 ià(
rc
 !ğ
APR_SUCCESS
 && !
	`APR_STATUS_IS_EINPROGRESS
(rc))

296 
”rÜ
;

299  
rc
;

301 
”rÜ
:

303  
rc
;

304 
	}
}

306 
DLL_PUBLIC
 
­r_¡©us_t
 
	gA´TıSock‘
::
	$»cv
(* 
buf
, 
­r_size_t
* 
size
)

308  
	`­r_sock‘_»cv
(
m_sock‘
, 
buf
, 
size
);

309 
	}
}

311 
DLL_PUBLIC
 
­r_¡©us_t
 
	gA´TıSock‘
::
	$»cv_³ek
(* 
buf
, 
­r_size_t
* 
size
)

313 
­r_ssize_t
 
rv
;

314 
sock‘
;

316 
	`­r_os_sock_g‘
(&
sock‘
, 
m_sock‘
);

317 
rv
 = ::
	`»cv
(
sock‘
, 
buf
, (*
size
), 
MSG_PEEK
);

319 ià(
rv
 == -1)

321  
”ºo
;

324 ià(
rv
 == 0)

326  
APR_EOF
;

329  
APR_SUCCESS
;

330 
	}
}

332 
DLL_PUBLIC
 
	gA´TıSock‘
::
	$g‘_­r_fd
(&
fd
)

334 
	`­r_os_sock_g‘
(&
fd
, 
m_sock‘
);

335 
	}
}

337 
DLL_PUBLIC
 
­r_¡©us_t
 
	gA´TıSock‘
::
	$£nd
(cÚ¡ * 
buf
, 
­r_size_t
* 
size
)

339  
	`­r_sock‘_£nd
(
m_sock‘
, 
buf
, 
size
);

340 
	}
}

342 
DLL_PUBLIC
 
šlše
 
	gA´TıSock‘
::
	$masqu”ade
(
­r_sock‘_t
* 
guts
)

344 
m_sock‘
 = 
guts
;

345 
	}
}

348 
DLL_PUBLIC
 
	gA´UdpSock‘
::
	$A´UdpSock‘
() :

349 
	$A´Sock‘
(
APR_INET
, 
SOCK_DGRAM
, 
APR_PROTO_UDP
)

351 
	}
}

353 
DLL_PUBLIC
 
	gA´UdpSock‘
::
	$A´UdpSock‘
(
­r_sock‘_t
 *
guts
, 
­r_sockaddr_t
* 
addr
) :

354 
	$A´Sock‘
(
guts
, 
addr
)

356 
	}
}

358 
DLL_PUBLIC
 
	gA´UdpSock‘
::
	$A´UdpSock‘
(
­r_os_sock_t
 
os_sock‘
) :

359 
	$A´Sock‘
(
NULL
, NULL)

361 
­r_os_sock_šfo_t
 
sock‘_šfo
;

362 
­r_¡©us_t
 
¡©us
;

364 
sock‘_šfo
.
os_sock
 = &
os_sock‘
;

365 
sock‘_šfo
.
loÿl
 = 
NULL
;

366 
sock‘_šfo
.
»mÙe
 = 
NULL
;

367 
sock‘_šfo
.
çmy
 = 
APR_INET
;

368 
sock‘_šfo
.
ty³
 = 
SOCK_DGRAM
;

369 
sock‘_šfo
.
´ÙocŞ
 = 
APR_PROTO_UDP
;

370 
¡©us
 = 
	`­r_os_sock_make
(&
m_sock‘
, &
sock‘_šfo
, 
	`thePoŞ
().
	`guts
());

372 ià(
¡©us
 !ğ
APR_SUCCESS
)

374 
	`as£¹
(0);

376 
	}
}

378 
DLL_PUBLIC
 
	gA´UdpSock‘
::~
	$A´UdpSock‘
()

380 
	}
}

382 
DLL_PUBLIC
 
­r_¡©us_t
 
A´UdpSock‘
::
	$cÚÃù
(cÚ¡ * 
ho¡Çme
, 
ušt16_t
 
pÜt
)

384 ià(
	`¡¾’
(
ho¡Çme
) == 0 ||

385 
pÜt
 == 0)

387  
	`­r_¡©us_t
(-1);

390 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

392 ià(
m_cÚÃùHo¡Name
 !ğ
ho¡Çme
)

394 ià(
m_cÚÃùAddr
)

396 
m_cÚÃùAddr
 = 
NULL
;

399 
rc
 = 
	`­r_sockaddr_šfo_g‘
(

400 &
m_cÚÃùAddr
,

401 
ho¡Çme
,

402 
APR_INET
,

403 
pÜt
, 0,

404 
	`thePoŞ
().
	`guts
()

407 ià(
rc
 !ğ
APR_SUCCESS
)

409 
”rÜ
;

412 
m_cÚÃùHo¡Name
 = 
ho¡Çme
;

413 
m_cÚÃùPÜt
 = 
pÜt
;

416 
rc
 = 
	`­r_sock‘_cÚÃù
(
m_sock‘
, 
m_cÚÃùAddr
);

418 ià(
rc
 !ğ
APR_SUCCESS
 && !
	`APR_STATUS_IS_EINPROGRESS
(rc))

420 
”rÜ
;

423  
rc
;

425 
”rÜ
:

427  
rc
;

428 
	}
}

430 
DLL_PUBLIC
 
­r_¡©us_t
 
	gA´UdpSock‘
::
	$£nd
(

431 cÚ¡ *
buf
,

432 
­r_size_t
* 
size


435  
	`­r_sock‘_£nd
(
m_sock‘
, 
buf
, 
size
);

436 
	}
}

439 
DLL_PUBLIC
 
­r_¡©us_t
 
	gA´UdpSock‘
::
	$£ndto
(

440 cÚ¡ *
buf
,

441 
­r_size_t
* 
size
,

442 
­r_sockaddr_t
* 
addr


445  
	`­r_sock‘_£ndto
(
m_sock‘
, 
addr
, 0, 
buf
, 
size
);

446 
	}
}

448 
DLL_PUBLIC
 
­r_¡©us_t
 
	gA´UdpSock‘
::
	$»cv
(

449 * 
buf
,

450 
­r_size_t
* 
size


453  
	`­r_sock‘_»cv
(
m_sock‘
, 
buf
, 
size
);

454 
	}
}

456 
DLL_PUBLIC
 
­r_¡©us_t
 
	gA´UdpSock‘
::
	$»cväom
(

457 * 
buf
,

458 
­r_size_t
* 
size
,

459 
­r_sockaddr_t
* 
addr


462  
	`­r_sock‘_»cväom
(
addr
, 
m_sock‘
, 0, 
buf
, 
size
);

463 
	}
}

466 
DLL_PUBLIC
 
	gA´MCa¡Sock‘
::
	$A´MCa¡Sock‘
() :

467 
	`m_još
(
NULL
),

468 
	`m_içû
(
NULL
),

469 
	$m_¤c
(
NULL
)

471 
	}
}

473 
DLL_PUBLIC
 
	gA´MCa¡Sock‘
::~
	$A´MCa¡Sock‘
()

475 
	}
}

477 
DLL_PUBLIC
 
boŞ
 
A´MCa¡Sock‘
::
	$još
(

478 cÚ¡ * 
još
,

479 cÚ¡ * 
içû
,

480 cÚ¡ * 
¤c


483 ià(
m_još
 || 
m_içû
 || 
m_¤c
)

485 
m_šùx
.
	`ş—r
();

488 
­r_¡©us_t
 
rc
 = 
	`­r_sockaddr_šfo_g‘
(

489 &
m_još
,

490 
još
,

491 
APR_INET
,

493 
m_šùx
.
	`guts
()

496 ià(
rc
 !ğ
APR_SUCCESS
)

499 
”rÜ
;

502 ià(
içû
)

504 
rc
 = 
	`­r_sockaddr_šfo_g‘
(

505 &
m_içû
,

506 
içû
,

507 
APR_INET
,

509 
m_šùx
.
	`guts
()

512 ià(
rc
 !ğ
APR_SUCCESS
)

515 
”rÜ
;

519 ià(
¤c
)

521 
rc
 = 
	`­r_sockaddr_šfo_g‘
(

522 &
m_¤c
,

523 
¤c
,

524 
APR_INET
,

526 
m_šùx
.
	`guts
()

529 ià(
rc
 !ğ
APR_SUCCESS
)

532 
”rÜ
;

536 
rc
 = 
	`­r_mÿ¡_još
(
m_sock‘
, 
m_još
, 
m_içû
, 
m_¤c
);

537 ià(
rc
 !ğ
APR_SUCCESS
)

540 
”rÜ
;

543 
”rÜ
:

544 
m_šùx
.
	`ş—r
();

545 
m_još
 = 
NULL
;

546 
m_içû
 = 
NULL
;

547 
m_¤c
 = 
NULL
;

548  
çl£
;

549 
	}
}

551 
DLL_PUBLIC
 
boŞ
 
	gA´MCa¡Sock‘
::
	$Ëave
()

553 
­r_¡©us_t
 
rc
 = 
	`­r_mÿ¡_Ëave
(
m_sock‘
, 
m_još
, 
m_içû
, 
m_¤c
);

555 ià(
rc
 !ğ
APR_SUCCESS
)

558  
çl£
;

560  
Œue
;

561 
	}
}

563 
DLL_PUBLIC
 
boŞ
 
	gA´MCa¡Sock‘
::
	$hİs
(
­r_by‹_t
 
‰l
)

565 
­r_¡©us_t
 
rc
 = 
	`­r_mÿ¡_hİs
(
m_sock‘
, 
‰l
);

567 ià(
rc
 !ğ
APR_SUCCESS
)

570  
çl£
;

572  
Œue
;

573 
	}
}

575 
DLL_PUBLIC
 
boŞ
 
	gA´MCa¡Sock‘
::
	$£tLoİback
(
­r_by‹_t
 
İt
)

577 
­r_¡©us_t
 
rc
 = 
	`­r_mÿ¡_loİback
(
m_sock‘
, 
İt
);

579 ià(
rc
 !ğ
APR_SUCCESS
)

582  
çl£
;

584  
Œue
;

585 
	}
}

587 
DLL_PUBLIC
 
boŞ
 
	gA´MCa¡Sock‘
::
	$£tIÁ”çû
(cÚ¡ * 
içû
)

589 ià(
içû
)

591 ià(!
A´Sock‘
::
	`ü—‹SockAddrInfo
(

592 &
m_içû
, 
içû
, 0, 
m_šùx
.
	`guts
())

595  
çl£
;

600 
m_içû
 = 
NULL
;

603 
­r_¡©us_t
 
rc
 = 
	`­r_mÿ¡_š‹rçû
(
m_sock‘
, 
m_içû
);

605 ià(
rc
 !ğ
APR_SUCCESS
)

608  
çl£
;

611  
Œue
;

612 
	}
}

	@../apr/apr_socket.h

1 #iâdeà
__APR_SOCKET_H__


2 
	#__APR_SOCKET_H__


	)

4 #ià
defšed
(
_WIN32
)

5 #iâdeà
WIN32_LEAN_AND_MEAN


6 
	#WIN32_LEAN_AND_MEAN


8 
	~<Wšdows.h
>

	)

9 
	~<WšSock2.h
>

12 
	~"expÜts.h
"

13 
	~"commÚ/¡dšt.h
"

14 
	~"­r/­r_objeù.h
"

15 
	~"­r-1/­r_ÃtwÜk_io.h
"

16 
	~"­r-1/­r_pÜbË.h
"

17 
	~<¡ršg
>

19 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

37 şas 
	cDLL_PUBLIC
 
	gA´Sock‘
 : 
public
 
A´Objeù
 {

38 
public
:

45 
A´Sock‘
(
çmy
, 
ty³
, 
´Ùo
);

52 
A´Sock‘
(
­r_sock‘_t
* 
guts
, 
­r_sockaddr_t
* 
addr
);

53 
	gvœtu®
 ~
A´Sock‘
();

62 
boŞ
 
bšd
(cÚ¡ * 
ho¡Çme
, 
­r_pÜt_t
 
pÜt
);

84 
št32_t
 
g‘O±iÚ
(št32_ˆ
İt
);

111 
boŞ
 
£tO±iÚ
(
št32_t
 
İt
, iÁ32_ˆ
v®ue
);

123 
boŞ
 
£tTimeOut
(
št64_t
 
t
);

128 
št64_t
 
g‘TimeOut
();

133 
št32_t
 
g‘PrÙo
();

138 
­r_sock‘_t
* 
guts
();

143 
­r_sockaddr_t
* 
bšdAddr
();

150 
boŞ
 
g‘RemÙeSockAddr
(
­r_sockaddr_t
*& 
§ddr
);

157 
boŞ
 
g‘LoÿlSockAddr
(
­r_sockaddr_t
*& 
§ddr
);

168 
boŞ
 
ü—‹SockAddrInfo
(

169 
­r_sockaddr_t
** 
§
,

170 cÚ¡ * 
ho¡Çme
,

171 
­r_pÜt_t
 
pÜt
,

172 
­r_poŞ_t
* 
p


180 
boŞ
 
g‘SockAddrIP
(
­r_sockaddr_t
* 
§ddr
, * 
buf
, 
­r_size_t
 
Ën
);

181 
	g´Ùeùed
:

182 
­r_sock‘_t
* 
m_sock‘
;

183 
­r_sockaddr_t
* 
	gm_bšdAddr
;

184 
	g´iv©e
:

185 
A´Sock‘
();

192 şas 
	cDLL_PUBLIC
 
	gA´TıSock‘
 : 
public
 
A´Sock‘
 {

193 
public
:

197 
A´TıSock‘
();

203 
A´TıSock‘
(
­r_os_sock_t
 
os_sock‘
);

205 
	gvœtu®
 ~
A´TıSock‘
();

214 
boŞ
 
li¡’
(
backLog
 = 
SOMAXCONN
);

221 
A´TıSock‘
* 
acû±
();

232 
­r_¡©us_t
 
cÚÃù
(cÚ¡ * 
ho¡Çme
, 
­r_pÜt_t
 
pÜt
);

253 
­r_¡©us_t
 
»cv
(* 
buf
, 
­r_size_t
* 
size
);

254 
­r_¡©us_t
 
»cv_³ek
(* 
buf
, 
­r_size_t
* 
size
);

271 
­r_¡©us_t
 
£nd
(cÚ¡ * 
buf
, 
­r_size_t
* 
size
);

273 
g‘_­r_fd
(&
fd
);

274 
	g´iv©e
:

280 
A´TıSock‘
(
­r_sock‘_t
* 
guts
, 
­r_sockaddr_t
* 
addr
);

283 
­r_sockaddr_t
* 
	gm_cÚÃùAddr
;

284 
	g¡d
::
¡ršg
 
m_cÚÃùHo¡Name
;

285 
ušt16_t
 
	gm_cÚÃùPÜt
;

287 
masqu”ade
(
­r_sock‘_t
* 
guts
);

294 şas 
	cDLL_PUBLIC
 
	gA´UdpSock‘
 : 
public
 
A´Sock‘
 {

295 
public
:

299 
A´UdpSock‘
();

305 
A´UdpSock‘
(
­r_os_sock_t
 
os_sock‘
);

307 
	gvœtu®
 ~
A´UdpSock‘
();

313 
­r_¡©us_t
 
£ndto
(cÚ¡ *
buf
, 
­r_size_t
* 
size
, 
­r_sockaddr_t
* 
addr
);

331 
­r_¡©us_t
 
£nd
(cÚ¡ *
buf
, 
­r_size_t
* 
size
);

343 
­r_¡©us_t
 
»cväom
(* 
buf
, 
­r_size_t
* 
size
, 
­r_sockaddr_t
* 
addr
);

365 
­r_¡©us_t
 
»cv
(* 
buf
, 
­r_size_t
* 
size
);

367 
­r_¡©us_t
 
cÚÃù
(cÚ¡ * 
ho¡Çme
, 
­r_pÜt_t
 
pÜt
);

368 
	g´iv©e
:

374 
A´UdpSock‘
(
­r_sock‘_t
* 
guts
, 
­r_sockaddr_t
* 
addr
);

377 
­r_sockaddr_t
* 
	gm_cÚÃùAddr
;

378 
	g¡d
::
¡ršg
 
m_cÚÃùHo¡Name
;

379 
ušt16_t
 
	gm_cÚÃùPÜt
;

386 şas 
	cDLL_PUBLIC
 
	gA´MCa¡Sock‘
 : 
public
 
A´UdpSock‘
 {

387 
public
:

391 
A´MCa¡Sock‘
();

392 
	gvœtu®
 ~
A´MCa¡Sock‘
();

402 
boŞ
 
još
(cÚ¡ * još, cÚ¡ * 
içû
, cÚ¡ * 
¤c
);

408 
boŞ
 
Ëave
();

416 
boŞ
 
hİs
(
­r_by‹_t
 
‰l
);

422 
boŞ
 
£tLoİback
(
­r_by‹_t
 
İt
);

427 
boŞ
 
£tIÁ”çû
(cÚ¡ * 
içû
);

428 
	g´iv©e
:

429 
­r_sockaddr_t
* 
m_još
, *
	gm_içû
, *
	gm_¤c
;

430 
A´PoŞ
 
	gm_šùx
;

	@../apr/apr_thread.cpp

1 
	~"­r/­r_th»ad.h
"

2 
	~<as£¹.h
>

4 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

6 
DLL_PUBLIC
 
	gA´Th»ad
::
	$A´Th»ad
(
PŞicy
 
pŞicy
, 
´iÜ™y_t
 
´iÜ™y
) :

7 
	`m_pŞicy
(
pŞicy
),

8 
	`m_´iÜ™y
(
´iÜ™y
),

9 
	`m_th»ad
(
NULL
),

10 
	`m_©Œibu‹
(
NULL
),

11 
	`m_isRuÂšg
(
çl£
),

12 
	$m_isFšished
(
çl£
)

14 
	`as£¹
(
	`thePoŞ
().
	`guts
());

15 
	}
}

17 
DLL_PUBLIC
 
	gA´Th»ad
::~
	$A´Th»ad
()

19 
	`wa™
();

20 
	`­r_poŞ_ş—r
(
	`thePoŞ
().
	`guts
());

21 
	}
}

23 
DLL_PUBLIC
 
boŞ
 
	gA´Th»ad
::
	$¡¬t
(
PŞicy
 
pŞicy
, 
´iÜ™y_t
 
´iÜ™y
)

25 
Cr™iÿlSeùiÚLock
 
	`lock”
(&
m_th»adCr™iÿlSeùiÚ
);

27 ià(
m_isRuÂšg
)

29  
çl£
;

32 
m_isRuÂšg
 = 
Œue
;

33 
m_isFšished
 = 
çl£
;

35 
­r_¡©us_t
 
rc
;

37 
m_pŞicy
 = 
pŞicy
;

38 
m_´iÜ™y
 = 
´iÜ™y
;

40 
	`­r_th»ad©Œ_ü—‹
(&
m_©Œibu‹
, 
	`thePoŞ
().
	`guts
());

42 
	`­r_th»ad©Œ_d‘ach_£t
(
m_©Œibu‹
, 0);

43 
	`­r_th»ad©Œ_¡acksize_£t
(
m_©Œibu‹
, (2 * 1024 * 1024));

44 
rc
 = 
	`­r_th»ad_ü—‹
(

45 &
m_th»ad
, 
m_©Œibu‹
,

46 
A´Th»ad
::
th»adS¹
,

47 
this
,

48 
	`thePoŞ
().
	`guts
()

50 ià(
rc
 !ğ
APR_SUCCESS
)

52 
	`årštf
(
¡d”r
, "C»©th»ad(%pèçed\n", 
this
);

53 
m_isRuÂšg
 = 
çl£
;

54 
m_isFšished
 = 
çl£
;

55  
çl£
;

57  
Œue
;

58 
	}
}

60 
DLL_PUBLIC
 
boŞ
 
	gA´Th»ad
::
	$isRuÂšg
()

62  
m_isRuÂšg
;

63 
	}
}

65 
DLL_PUBLIC
 
boŞ
 
	gA´Th»ad
::
	$isFšished
()

67  
m_isFšished
;

68 
	}
}

70 
DLL_PUBLIC
 
boŞ
 
	gA´Th»ad
::
	$£tPŞicyPriÜ™y
(
PŞicy
 
pŞicy
, 
´iÜ™y_t
 
´iÜ™y
)

72 #iâdeà
_WIN32


73 
±h»ad_©Œ_t
 
©Œ
;

74 
	`±h»ad_©Œ_š™
(&
©Œ
);

75 ià(
pŞicy
 =ğ-1 || 
´iÜ™y
 == -1)

77 
	`±h»ad_©Œ_£tšh”™sched
(&
©Œ
, 
PTHREAD_INHERIT_SCHED
);

78  
Œue
;

80 
sched_·¿m
 
·¿m
;

81 
mš
 = 
	`sched_g‘_´iÜ™y_mš
(
pŞicy
);

82 
max
 = 
	`sched_g‘_´iÜ™y_max
(
pŞicy
);

83 ià(
mš
 =ğ-1 || 
max
 == -1)

87 
	`årštf
(
¡d”r
, "Cannot determine scheduler…riority„ange");

88  
çl£
;

90 
·¿m
.
sched_´iÜ™y
 = 
mš
 + (
max
 - mšè* 
´iÜ™y
 / 100;

91 
”r
 = 
	`±h»ad_£tsched·¿m
(
	`±h»ad_£lf
(), 
pŞicy
, &
·¿m
);

92 ià(!
”r
)

94 
	`årštf
(
¡dout
, "Thread has been seto…olicy: %d…riority: %d\n",

95 
pŞicy
, 
´iÜ™y
);

99 
	`årštf
(
¡dout
, "Thread setPolicyPriority Failure\n");

100  
çl£
;

103 
	`UNREFERENCED_PARAMETER
(
pŞicy
);

104 
	`UNREFERENCED_PARAMETER
(
´iÜ™y
);

106  
Œue
;

107 
	}
}

109 
DLL_PUBLIC
 * 
APR_THREAD_FUNC
 
	gA´Th»ad
::
	$th»adS¹
(
­r_th»ad_t
* 
th»ad
, * 
ùx
)

111 
A´Th»ad
* 
_this
 = (A´Th»ad*)
ùx
;

112 
_this
->
	`£tPŞicyPriÜ™y
(_this->
m_pŞicy
, _this->
m_´iÜ™y
);

114 
_this
->
	`run
();

116 
_this
->
m_isRuÂšg
 = 
çl£
;

117 
_this
->
m_isFšished
 = 
Œue
;

118 
_this
->
m_´iÜ™y
 = 
PRIO_INHERIT
;

119 
_this
->
m_pŞicy
 = 
A´Th»ad
::
POLI_INHERIT
;

121 
	`­r_th»ad_ex™
(
th»ad
, 
APR_SUCCESS
);

123  
NULL
;

124 
	}
}

126 
DLL_PUBLIC
 
boŞ
 
	gA´Th»ad
::
	$wa™
()

128 
Cr™iÿlSeùiÚLock
 
	`lock”
(&
m_th»adCr™iÿlSeùiÚ
);

130 ià(
m_th»ad
 !ğ
NULL
)

132 
­r_¡©us_t
 
Œc
;

133 
­r_¡©us_t
 
rc
 = 
	`­r_th»ad_još
(&
Œc
, 
m_th»ad
);

135 ià(
rc
 !ğ
APR_SUCCESS
)

137  
çl£
;

140 
	`thePoŞ
().
	`ş—r
();

141 
m_th»ad
 = 
NULL
;

144  
Œue
;

145 
	}
}

	@../apr/apr_thread.h

1 #iâdeà
__APR_THREAD_H__


2 
	#__APR_THREAD_H__


	)

4 
	~"expÜts.h
"

5 
	~"­r-1/­r_th»ad_´oc.h
"

6 
	~"­r/­r_objeù.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

9 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

11 şas 
	cDLL_PUBLIC
 
	gA´Th»ad
 : 
public
 
A´Objeù
 {

12 
public
:

14 cÚ¡ 
PRIO_INHERIT
 = -1;

15 
­r_št32_t
 
	t´iÜ™y_t
;

16 
	ePŞicy


18 
	gPOLI_INHERIT
 = -1,

19 
	gPOLI_OTHER
 = 0,

20 
	gPOLI_FIFO
,

21 
	gPOLI_RR


23 
A´Th»ad
(
PŞicy
 
pŞicy
 = 
POLI_INHERIT
, 
´iÜ™y_t
 
´iÜ™y
 = 
PRIO_INHERIT
);

24 
	gvœtu®
 ~
A´Th»ad
();

25 
boŞ
 
¡¬t
(
PŞicy
 
pŞicy
 = 
POLI_INHERIT
, 
´iÜ™y_t
 
´iÜ™y
 = 
PRIO_INHERIT
);

26 
boŞ
 
isFšished
();

27 
boŞ
 
isRuÂšg
();

28 
boŞ
 
wa™
();

29 
	g´Ùeùed
:

30 
vœtu®
 
run
() = 0;

31 
	g´iv©e
:

32 
PŞicy
 
m_pŞicy
;

33 
´iÜ™y_t
 
	gm_´iÜ™y
;

34 
Cr™iÿlSeùiÚ
 
	gm_th»adCr™iÿlSeùiÚ
;

35 
­r_th»ad_t
* 
	gm_th»ad
;

36 
­r_th»ad©Œ_t
* 
	gm_©Œibu‹
;

37 * 
APR_THREAD_FUNC
 
th»adS¹
(
­r_th»ad_t
* 
th»ad
, * 
ùx
);

38 
boŞ
 
	gm_isRuÂšg
, 
	gm_isFšished
;

39 
boŞ
 
£tPŞicyPriÜ™y
(
PŞicy
 
pŞicy
, 
´iÜ™y_t
 
´iÜ™y
);

	@../apr/apr_thread_operator.cpp

1 
	~"­r_th»ad_İ”©Ü.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
DLL_PUBLIC
 
	gA´Th»adO³¿tÜ
::
	$A´Th»adO³¿tÜ
()

7 
	}
}

9 
DLL_PUBLIC
 
A´Th»adO³¿tÜ
::~
	$A´Th»adO³¿tÜ
()

11 
	`Clo£Th»ad
();

12 
	}
}

14 
DLL_PUBLIC
 
boŞ
 
	gA´Th»adO³¿tÜ
::
	$C»©eTh»ad
()

16 
	`P»·»C»©e
();

17  
	`¡¬t
();

18 
	}
}

20 
DLL_PUBLIC
 
boŞ
 
	gA´Th»adO³¿tÜ
::
	$Clo£Th»ad
()

22 
	`P»·»Clo£
();

23  
	`wa™
();

24 
	}
}

26 
DLL_PUBLIC
 
	gA´Th»adO³¿tÜ
::
	$P»·»C»©e
()

28 
	}
}

30 
DLL_PUBLIC
 
A´Th»adO³¿tÜ
::
	$P»·»Clo£
()

32 
	}
}

34 
DLL_PUBLIC
 
boŞ
 
A´Th»adO³¿tÜ
::
	$Th»adExi¡s
()

36  
	`isRuÂšg
();

37 
	}
}

39 
DLL_PUBLIC
 
	gA´Th»adO³¿tÜ
::
	$S¹Up
()

41 
	}
}

43 
DLL_PUBLIC
 
A´Th»adO³¿tÜ
::
	$T—rDown
()

45 
	}
}

47 
DLL_PUBLIC
 
A´Th»adO³¿tÜ
::
	$run
()

49 
	`S¹Up
();

50 
	`CÚtšue
())

52 
	`WÜk
();

54 
	`T—rDown
();

55 
	}
}

	@../apr/apr_thread_operator.h

1 #iâdeà
__APR_THREAD_OPERATOR_H__


2 
	#__APR_THREAD_OPERATOR_H__


	)

4 
	~"expÜts.h
"

5 
	~"­r/­r_th»ad.h
"

7 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 şas 
	cDLL_PUBLIC
 
	gA´Th»adO³¿tÜ
 : 
´iv©e
 
A´Th»ad
 {

15 
public
:

16 
A´Th»adO³¿tÜ
();

17 
	gvœtu®
 ~
A´Th»adO³¿tÜ
();

22 
	gpublic
:

23 
boŞ
 
C»©eTh»ad
();

24 
boŞ
 
Clo£Th»ad
();

25 
boŞ
 
Th»adExi¡s
();

27 
	g´Ùeùed
:

28 
vœtu®
 
P»·»C»©e
();

29 
vœtu®
 
P»·»Clo£
();

34 
	g´Ùeùed
:

35 
vœtu®
 
S¹Up
();

36 
vœtu®
 
T—rDown
();

38 
vœtu®
 
boŞ
 
CÚtšue
() = 0;

39 
vœtu®
 
WÜk
() = 0;

41 
	g´iv©e
:

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
A´Th»adO³¿tÜ
(A´Th»adO³¿tÜ &
rhs
);

46 
	gA´Th»adO³¿tÜ
 &
	gİ”©Ü
=(
A´Th»adO³¿tÜ
& 
rhs
);

	@../apr/apr_thread_worker.cpp

1 
	~"­r/­r_th»ad_wÜk”.h
"

2 
	~<as£¹.h
>

3 
	~"commÚ/ut™y.h
"

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
DLL_PUBLIC
 
	gA´Th»adWÜk”
::
	$A´Th»adWÜk”
()

8 : 
	`m_csC®lWÜk”
()

9 , 
	`m_cdReque¡
(
çl£
)

10 , 
	`m_uReque¡P¬am
(0)

11 , 
	`m_cdR•ly
(
çl£
)

12 , 
	$m_uR•lyP¬am
(0)

14 
	}
}

16 
DLL_PUBLIC
 
	gA´Th»adWÜk”
::~
	$A´Th»adWÜk”
()

18 
	`Clo£Th»ad
();

19 
	}
}

21 
DLL_PUBLIC
 
boŞ
 
	gA´Th»adWÜk”
::
	$C»©eTh»ad
()

23  
	`¡¬t
();

24 
	}
}

26 
DLL_PUBLIC
 
boŞ
 
	gA´Th»adWÜk”
::
	$Clo£Th»ad
()

28  
	`wa™
();

29 
	}
}

31 
DLL_PUBLIC
 
boŞ
 
	gA´Th»adWÜk”
::
	$Th»adExi¡s
()

33  
	`isRuÂšg
();

34 
	}
}

36 
DLL_PUBLIC
 
boŞ
 
	gA´Th»adWÜk”
::
	$C®lWÜk”
(
ušt32_t
 
·¿m
, ušt32_ˆ*
pResuÉ
 )

38 
	`IF_FALSE_RETURN_VALUE
(
	`Th»adExi¡s
(), 
çl£
);

40 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
m_csC®lWÜk”
);

43 
	`S‘Reque¡
(
·¿m
);

45 
ušt32_t
 
»¶y
 = 
	`G‘R•ly
();

47 ià(
pResuÉ
 !ğ
NULL
)

49 *
pResuÉ
 = 
»¶y
;

51  
Œue
;

52 
	}
}

54 
DLL_PUBLIC
 
	gA´Th»adWÜk”
::
	$R•ly
(
ušt32_t
 
·¿m
)

56 
	`S‘R•ly
(
·¿m
);

57 
	}
}

59 
DLL_PUBLIC
 
	gA´Th»adWÜk”
::
	$run
()

61 
	`Th»adProc
();

62 
	}
}

64 
DLL_PUBLIC
 
boŞ
 
	gA´Th»adWÜk”
::
	$CheckReque¡
(
ušt32_t
 *
pP¬am
)

66 
	`IF_NULL_RETURN_VALUE
(
pP¬am
, 
çl£
);

67 ià(
m_cdReque¡
.
	`timedwa™
(0))

69 *
pP¬am
 = 
m_uReque¡P¬am
;

70  
Œue
;

72  
çl£
;

73 
	}
}

75 
DLL_PUBLIC
 
	gA´Th»adWÜk”
::
	$S‘Reque¡
(
ušt32_t
 
·¿m
)

77 
m_uReque¡P¬am
 = 
·¿m
;

78 
m_cdReque¡
.
	`£t
();

79 
	}
}

81 
DLL_PUBLIC
 
ušt32_t
 
	gA´Th»adWÜk”
::
	$G‘Reque¡
()

83 
m_cdReque¡
.
	`wa™
();

84  
m_uReque¡P¬am
;

85 
	}
}

87 
DLL_PUBLIC
 
	gA´Th»adWÜk”
::
	$S‘R•ly
(
ušt32_t
 
·¿m
)

89 
m_uR•lyP¬am
 = 
·¿m
;

90 
m_cdR•ly
.
	`£t
();

91 
	}
}

93 
DLL_PUBLIC
 
ušt32_t
 
	gA´Th»adWÜk”
::
	$G‘R•ly
()

95 
m_cdR•ly
.
	`wa™
();

96  
m_uR•lyP¬am
;

97 
	}
}

	@../apr/apr_thread_worker.h

1 #iâdeà
__APR_THREAD_WORKER_H__


2 
	#__APR_THREAD_WORKER_H__


	)

4 
	~"expÜts.h
"

5 
	~"­r/­r_th»ad.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

8 
	~"­r/­r_cÚd.h
"

10 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

17 şas 
	cDLL_PUBLIC
 
	gA´Th»adWÜk”
 : 
´iv©e
 
A´Th»ad
 {

18 
public
:

19 
A´Th»adWÜk”
();

20 
	gvœtu®
 ~
A´Th»adWÜk”
();

25 
	gpublic
:

26 
boŞ
 
C»©eTh»ad
();

27 
boŞ
 
Clo£Th»ad
();

28 
boŞ
 
Th»adExi¡s
();

29 
boŞ
 
C®lWÜk”
(
ušt32_t
 
·¿m
, ušt32_ˆ*
pResuÉ
=
NULL
);

34 
	g´Ùeùed
:

38 
boŞ
 
CheckReque¡
(
ušt32_t
 *
pP¬am
);

39 
ušt32_t
 
G‘Reque¡
();

40 
R•ly
(
ušt32_t
 
·¿m
);

44 
vœtu®
 
Th»adProc
() = 0;

46 
	g´iv©e
:

47 
vœtu®
 
run
();

48 
S‘Reque¡
(
ušt32_t
 
·¿m
);

49 
S‘R•ly
(
ušt32_t
 
·¿m
);

50 
ušt32_t
 
G‘R•ly
();

52 
	g´iv©e
:

53 
A´Th»adWÜk”
(A´Th»adWÜk” &
rhs
);

54 
	gA´Th»adWÜk”
 &
	gİ”©Ü
=(
A´Th»adWÜk”
& 
rhs
);

56 
	g´iv©e
:

57 
Cr™iÿlSeùiÚ
 
m_csC®lWÜk”
;

59 
A´CÚd
 
	gm_cdReque¡
;

60 
ušt32_t
 
	gm_uReque¡P¬am
;

62 
A´CÚd
 
	gm_cdR•ly
;

63 
ušt32_t
 
	gm_uR•lyP¬am
;

	@../apr/apr_utility.cpp

1 
	~"­r/­r_ut™y.h
"

3 
	~"commÚ/ut™y.h
"

4 
	~"commÚ/sy¡em.h
"

5 
	~"­r/­r_pŞl£t.h
"

7 
	~<¡dlib.h
>

8 
	~<¡ršg.h
>

11 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

13 
DLL_PUBLIC
 
­r_št16_t
 
	gSYSUTILS_SPACE
::
	$CheckSock‘Ev’ts
(
A´Sock‘
 *
sock‘
, 
­r_št16_t
 
ev’ts
, 
št32_t
 
timeout
)

15 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 0x000);

17 
A´PŞlS‘
 
	`pŞl£t
(1);

18 
­r_pŞlfd_t
 
pfd
 = {
NULL
, 
APR_POLL_SOCKET
, 
ev’ts
, 0, {NULL}, NULL};

19 
pfd
.
desc
.
s
 = 
sock‘
->
	`guts
();

20 
pŞl£t
.
	`add
(&
pfd
);

22 
št32_t
 
num
 = 0;

23 cÚ¡ 
­r_pŞlfd_t
 *
»t_pfd
 = 
NULL
;

24 
pŞl£t
.
	`pŞl
(&
num
, &
»t_pfd
, 
timeout
);

26  (
num
 =ğ0 || 
»t_pfd
 =ğ
NULL
è? (0x000è: (»t_pfd[0].
¹Ãv’ts
);

27 
	}
}

29 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$Wr™eSock‘
(
A´TıSock‘
 *
sock‘
, cÚ¡ *
bufãr
, 
ušt32_t
 
Ën
, ušt32_ˆ*
Ën_£nd
 )

31 ià(
Ën_£nd
 !ğ
NULL
)

33 *
Ën_£nd
 = 0;

36 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

38 
­r_size_t
 
Ën_rg‘
 = (­r_size_t)
Ën
;

40 
­r_¡©us_t
 
rc
 = 
sock‘
->
	`£nd
(
bufãr
, &
Ën_rg‘
);

42 ià(
Ën_£nd
 !ğ
NULL
)

44 *
Ën_£nd
 = 
Ën_rg‘
;

47  
rc
 =ğ
APR_SUCCESS
;

48 
	}
}

50 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$Wr™eSock‘
(
A´TıSock‘
 *
sock‘
, cÚ¡ 
¡d
::
¡ršg
 &
¡r
, 
ušt32_t
 *
Ën_£nd
 )

52  
	`Wr™eSock‘
(
sock‘
, 
¡r
.
	`c_¡r
(), sŒ.
	`Ëngth
(), 
Ën_£nd
);

53 
	}
}

55 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$Wr™eSock‘UÁTimeout
(
A´TıSock‘
 *
sock‘
, cÚ¡ *
bufãr
, 
ušt32_t
 
Ën
, 
št64_t
 
timeout
, ušt32_ˆ*
Ën_£nd
 )

57 ià(
Ën_£nd
 !ğ
NULL
)

59 *
Ën_£nd
 = 0;

62 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

64 
št64_t
 
timeout_Üigš®
 = 
sock‘
->
	`g‘TimeOut
();

65 
št32_t
 
nÚblock_Üigš®
 = 
sock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

67 
št32_t
 
nÚblock
 = (
timeout
 == 0) ? 0 : 1;

69 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

71 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

74 ià(
timeout
 !ğ
timeout_Üigš®
)

76 
sock‘
->
	`£tTimeOut
(
timeout
);

79 
­r_size_t
 
Ën_rg‘
 = (­r_size_t)
Ën
;

80 
­r_¡©us_t
 
rc
 = 
sock‘
->
	`£nd
(
bufãr
, &
Ën_rg‘
);

82 ià(
Ën_£nd
 !ğ
NULL
)

84 *
Ën_£nd
 = 
Ën_rg‘
;

87 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

89 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

92 ià(
timeout
 !ğ
timeout_Üigš®
)

94 
sock‘
->
	`£tTimeOut
(
timeout_Üigš®
);

97 ià(
rc
 =ğ
APR_SUCCESS
)

99  
Œue
;

101 ià(
nÚblock
 != 0 &&

102 
	`APR_STATUS_IS_EAGAIN
(
rc
))

104  
Œue
;

107  
çl£
;

108 
	}
}

110 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$Wr™eSock‘UÁTimeout
(
A´TıSock‘
 *
sock‘
, cÚ¡ 
¡d
::
¡ršg
 &
¡r
, 
št64_t
 
timeout
)

112 
ušt32_t
 
£ndSize
 = 
	`UINT32_C
(0), 
tÙ®Size
 = 
¡r
.
	`Ëngth
();

114 
£ndSize
 < 
tÙ®Size
)

116 
ušt32_t
 
Ën_£nd
 = 
	`UINT32_C
(0);

117 ià(!
	`Wr™eSock‘UÁTimeout
(
sock‘
, 
¡r
.
	`c_¡r
(è+ 
£ndSize
, sŒ.
	`Ëngth
(è- s’dSize, 
timeout
, &
Ën_£nd
))

119  
çl£
;

122 
£ndSize
 +ğ
Ën_£nd
;

125  
Œue
;

126 
	}
}

128 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$R—dSock‘
(
A´TıSock‘
 *
sock‘
, *
bufãr
, 
ušt32_t
 
Ën
, ušt32_ˆ*
Ën_»cv
 )

130 ià(
Ën_»cv
 !ğ
NULL
)

132 *
Ën_»cv
 = 0;

135 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

137 
­r_size_t
 
Ën_rg‘
 = (­r_size_t)
Ën
;

139 
­r_¡©us_t
 
rc
 = 
sock‘
->
	`»cv
(
bufãr
, &
Ën_rg‘
);

141 ià(
Ën_»cv
 !ğ
NULL
)

143 *
Ën_»cv
 = (
ušt32_t
)
Ën_rg‘
;

146  
rc
 =ğ
APR_SUCCESS
;

147 
	}
}

149 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$R—dSock‘
(
A´TıSock‘
 *
sock‘
, 
ušt32_t
 
Ën
, 
¡d
::
¡ršg
 &
¡r
, ušt32_ˆ*
Ën_»cv
 )

151 ià(
Ën_»cv
 !ğ
NULL
)

153 *
Ën_»cv
 = 0;

156 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

157 
	`IF_TRUE_RETURN_VALUE
(
Ën
 =ğ0, 
Œue
);

159 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

162 
­r_size_t
 
Ën_rg‘
 = (­r_size_t)
Ën
;

163 *
s
 = (*)
	`ÿÎoc
(
Ën_rg‘
, ());

164 
	`IF_NULL_RETURN_VALUE
(
s
, 
çl£
);

166 
rc
 = 
sock‘
->
	`»cv
(
s
, &
Ën_rg‘
);

167 
¡r
.
	`assign
(
s
, 
Ën_rg‘
);

168 
	`ä“
(
s
);

169 
s
 = 
NULL
;

171 
­r_size_t
 
Ën_rg‘
 = 0;

172 
¡r
.
	`Ëngth
(è< 
Ën
)

175 
­r_size_t
 
size
 = 1;

176 
c
 = '\0';

177 
rc
 = 
sock‘
->
	`»cv
(&
c
, &
size
);

180 ià(
rc
 =ğ
APR_SUCCESS
)

182 
¡r
.
	`push_back
(
c
);

183 
Ën_rg‘
++;

185 ià(
	`APR_STATUS_IS_TIMEUP
(
rc
))

189 ià(
	`APR_STATUS_IS_EAGAIN
(
rc
))

193 ià(
	`APR_STATUS_IS_EOF
(
rc
è|| 
size
 == 0)

204 ià(
Ën_»cv
 !ğ
NULL
)

206 *
Ën_»cv
 = (
ušt32_t
)
Ën_rg‘
;

209  
rc
 =ğ
APR_SUCCESS
;

210 
	}
}

212 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$R—dSock‘UÁTimeout
(
A´TıSock‘
 *
sock‘
, *
bufãr
, 
ušt32_t
 
Ën
, 
št64_t
 
timeout
, ušt32_ˆ*
Ën_»cv
 )

214 ià(
Ën_»cv
 !ğ
NULL
)

216 *
Ën_»cv
 = 0;

219 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

221 
št64_t
 
timeout_Üigš®
 = 
sock‘
->
	`g‘TimeOut
();

222 
št32_t
 
nÚblock_Üigš®
 = 
sock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

224 
št32_t
 
nÚblock
 = (
timeout
 == 0) ? 0 : 1;

226 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

228 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

231 ià(
timeout
 !ğ
timeout_Üigš®
)

233 
sock‘
->
	`£tTimeOut
(
timeout
);

236 
­r_size_t
 
Ën_rg‘
 = (­r_size_t)
Ën
;

238 
­r_¡©us_t
 
rc
 = 
sock‘
->
	`»cv
(
bufãr
, &
Ën_rg‘
);

240 ià(
Ën_»cv
 !ğ
NULL
)

242 *
Ën_»cv
 = (
ušt32_t
)
Ën_rg‘
;

245 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

247 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

250 ià(
timeout
 !ğ
timeout_Üigš®
)

252 
sock‘
->
	`£tTimeOut
(
timeout_Üigš®
);

255  
rc
 =ğ
APR_SUCCESS
;

256 
	}
}

258 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$R—dSock‘UÁTimeout
(
A´TıSock‘
 *
sock‘
, 
ušt32_t
 
Ën
, 
št64_t
 
timeout
, 
¡d
::
¡ršg
 &
¡r
, ušt32_ˆ*
Ën_»cv
 )

260 ià(
Ën_»cv
 !ğ
NULL
)

262 *
Ën_»cv
 = 0;

265 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

266 
	`IF_TRUE_RETURN_VALUE
(
Ën
 =ğ0, 
Œue
);

268 
št64_t
 
timeout_Üigš®
 = 
sock‘
->
	`g‘TimeOut
();

269 
št32_t
 
nÚblock_Üigš®
 = 
sock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

271 
št32_t
 
nÚblock
 = (
timeout
 == 0) ? 0 : 1;

273 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

275 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

278 ià(
timeout
 !ğ
timeout_Üigš®
)

280 
sock‘
->
	`£tTimeOut
(
timeout
);

283 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

286 
­r_size_t
 
Ën_rg‘
 = (­r_size_t)
Ën
;

287 *
s
 = (*)
	`ÿÎoc
(
Ën_rg‘
, ());

288 
	`IF_NULL_RETURN_VALUE
(
s
, 
çl£
);

290 
rc
 = 
sock‘
->
	`»cv
(
s
, &
Ën_rg‘
);

291 
¡r
.
	`assign
(
s
, 
Ën_rg‘
);

292 
	`ä“
(
s
);

293 
s
 = 
NULL
;

295 
­r_size_t
 
Ën_rg‘
 = 0;

296 
št64_t
 
timeout_»maš
 = 
timeout
;

297 
št64_t
 
time_u£d_³r_¡•
 = 0;

298 
¡r
.
	`Ëngth
(è< 
Ën
)

301 ià(
timeout_»maš
 > 0)

303 
timeout_»maš
 -ğ
time_u£d_³r_¡•
;

304 ià(
timeout_»maš
 <= 0)

306 
rc
 = 
APR_TIMEUP
;

309 
sock‘
->
	`£tTimeOut
(
timeout_»maš
);

313 
­r_size_t
 
size
 = 1;

314 
c
 = '\0';

315 
št64_t
 
cu¼’t_time
 = 
	`G‘TimeCouÁMS
();

316 
rc
 = 
sock‘
->
	`»cv
(&
c
, &
size
);

317 
time_u£d_³r_¡•
 = 
	`G‘TimeCouÁMS
(è- 
cu¼’t_time
;

320 ià(
rc
 =ğ
APR_SUCCESS
)

322 
¡r
.
	`push_back
(
c
);

323 
Ën_rg‘
++;

325 ià(
	`APR_STATUS_IS_TIMEUP
(
rc
))

329 ià(
nÚblock
 != 0 &&

330 
	`APR_STATUS_IS_EAGAIN
(
rc
))

334 ià(
	`APR_STATUS_IS_EOF
(
rc
) ||

335 
size
 == 0)

346 ià(
Ën_»cv
 !ğ
NULL
)

348 *
Ën_»cv
 = (
ušt32_t
)
Ën_rg‘
;

351 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

353 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

356 ià(
timeout
 !ğ
timeout_Üigš®
)

358 
sock‘
->
	`£tTimeOut
(
timeout_Üigš®
);

361  
rc
 =ğ
APR_SUCCESS
;

362 
	}
}

364 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$R—dSock‘UÁEOS
(
A´TıSock‘
 *
sock‘
, *
bufãr
, 
ušt32_t
 
Ën
, *
eos
, 
št64_t
 
timeout
 , ušt32_ˆ*
Ën_»cv
 )

366 ià(
Ën_»cv
 !ğ
NULL
)

368 *
Ën_»cv
 = 0;

371 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

372 
ušt32_t
 
Ën_eos
 = 
	`¡¾’
(
eos
);

373 
	`IF_TRUE_RETURN_VALUE
(
Ën_eos
 =ğ0, 
çl£
);

375 
št64_t
 
timeout_Üigš®
 = 
sock‘
->
	`g‘TimeOut
();

376 
št32_t
 
nÚblock_Üigš®
 = 
sock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

378 
št32_t
 
nÚblock
 = (
timeout
 == 0) ? 0 : 1;

380 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

382 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

385 ià(
timeout
 !ğ
timeout_Üigš®
)

387 
sock‘
->
	`£tTimeOut
(
timeout
);

390 
št64_t
 
timeout_»maš
 = 
timeout
;

391 
št64_t
 
time_u£d_³r_¡•
 = 0;

392 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

393 
­r_size_t
 
Ën_rg‘
 = 0;

394 
Ën_rg‘
 < 
Ën_eos
 || 
	`¡rcmp
(
bufãr
 +†’_rg‘ -†’_eos, 
eos
) != 0)

397 ià(
timeout_»maš
 > 0)

399 
timeout_»maš
 -ğ
time_u£d_³r_¡•
;

400 ià(
timeout_»maš
 <= 0)

402 
rc
 = 
APR_TIMEUP
;

405 
sock‘
->
	`£tTimeOut
(
timeout_»maš
);

409 
­r_size_t
 
size
 = 1;

410 
c
 = '\0';

411 
št64_t
 
cu¼’t_time
 = 
	`G‘TimeCouÁMS
();

412 
rc
 = 
sock‘
->
	`»cv
(&
c
, &
size
);

413 
time_u£d_³r_¡•
 = 
	`G‘TimeCouÁMS
(è- 
cu¼’t_time
;

416 ià(
rc
 =ğ
APR_SUCCESS
)

418 
bufãr
[
Ën_rg‘
++] = 
c
;

420 ià(
	`APR_STATUS_IS_TIMEUP
(
rc
))

424 ià(
nÚblock
 != 0 &&

425 
	`APR_STATUS_IS_EAGAIN
(
rc
))

429 ià(
	`APR_STATUS_IS_EOF
(
rc
) ||

430 
size
 == 0)

440 ià(
Ën_»cv
 !ğ
NULL
)

442 *
Ën_»cv
 = (
ušt32_t
)
Ën_rg‘
;

445 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

447 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

450 ià(
timeout
 !ğ
timeout_Üigš®
)

452 
sock‘
->
	`£tTimeOut
(
timeout_Üigš®
);

455  
rc
 =ğ
APR_SUCCESS
;

456 
	}
}

458 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$R—dSock‘UÁEOS
(
A´TıSock‘
 *
sock‘
, 
¡d
::
¡ršg
 &
¡r
, cÚ¡ std::¡ršg &
eos
, 
št64_t
 
timeout
 , 
ušt32_t
 *
Ën_»cv
 )

460 ià(
Ën_»cv
 !ğ
NULL
)

462 *
Ën_»cv
 = 0;

465 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

466 
	`IF_TRUE_RETURN_VALUE
(
eos
.
	`Ëngth
(è=ğ0, 
çl£
);

468 
št64_t
 
timeout_Üigš®
 = 
sock‘
->
	`g‘TimeOut
();

469 
št32_t
 
nÚblock_Üigš®
 = 
sock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

471 
št32_t
 
nÚblock
 = (
timeout
 == 0) ? 0 : 1;

473 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

475 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

478 ià(
timeout
 !ğ
timeout_Üigš®
)

480 
sock‘
->
	`£tTimeOut
(
timeout
);

483 
št64_t
 
timeout_»maš
 = 
timeout
;

484 
št64_t
 
time_u£d_³r_¡•
 = 0;

485 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

486 
­r_size_t
 
Ën_rg‘
 = 0;

487 
¡r
.
	`Ëngth
(è< 
eos
.Ëngth(è|| 
	`¡rcmp
(¡r.
	`c_¡r
() + str.length() -ƒos.length(),ƒos.c_str()) != 0)

490 ià(
timeout_»maš
 > 0)

492 
timeout_»maš
 -ğ
time_u£d_³r_¡•
;

493 ià(
timeout_»maš
 <= 0)

495 
rc
 = 
APR_TIMEUP
;

498 
sock‘
->
	`£tTimeOut
(
timeout_»maš
);

502 
­r_size_t
 
size
 = 1;

503 
c
 = '\0';

504 
št64_t
 
cu¼’t_time
 = 
	`G‘TimeCouÁMS
();

505 
rc
 = 
sock‘
->
	`»cv
(&
c
, &
size
);

506 
time_u£d_³r_¡•
 = 
	`G‘TimeCouÁMS
(è- 
cu¼’t_time
;

509 ià(
rc
 =ğ
APR_SUCCESS
)

511 
¡r
.
	`push_back
(
c
);

512 
Ën_rg‘
++;

514 ià(
	`APR_STATUS_IS_TIMEUP
(
rc
))

518 ià(
nÚblock
 != 0 &&

519 
	`APR_STATUS_IS_EAGAIN
(
rc
))

523 ià(
	`APR_STATUS_IS_EOF
(
rc
) ||

524 
size
 == 0)

533 ià(
Ën_»cv
 !ğ
NULL
)

535 *
Ën_»cv
 = (
ušt32_t
)
Ën_rg‘
;

538 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

540 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

543 ià(
timeout
 !ğ
timeout_Üigš®
)

545 
sock‘
->
	`£tTimeOut
(
timeout_Üigš®
);

548  
rc
 =ğ
APR_SUCCESS
;

549 
	}
}

551 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$R—dSock‘UÁEOS
(
A´TıSock‘
 *
sock‘
, 
¡d
::
¡ršg
 &
¡r
, cÚ¡ std::¡ršg &
eos
, 
ušt32_t
& 
”rÜCode
, 
št64_t
 
timeout
 , ušt32_ˆ*
Ën_»cv
 )

553 ià(
Ën_»cv
 !ğ
NULL
)

555 *
Ën_»cv
 = 0;

558 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

559 
	`IF_TRUE_RETURN_VALUE
(
eos
.
	`Ëngth
(è=ğ0, 
çl£
);

561 
št64_t
 
timeout_Üigš®
 = 
sock‘
->
	`g‘TimeOut
();

562 
št32_t
 
nÚblock_Üigš®
 = 
sock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

564 
št32_t
 
nÚblock
 = (
timeout
 == 0) ? 0 : 1;

566 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

568 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

571 ià(
timeout
 !ğ
timeout_Üigš®
)

573 
sock‘
->
	`£tTimeOut
(
timeout
);

576 
št64_t
 
timeout_»maš
 = 
timeout
;

577 
št64_t
 
time_u£d_³r_¡•
 = 0;

578 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

579 
­r_size_t
 
Ën_rg‘
 = 0;

580 
¡r
.
	`Ëngth
(è< 
eos
.Ëngth(è|| 
	`¡rcmp
(¡r.
	`c_¡r
() + str.length() -ƒos.length(),ƒos.c_str()) != 0)

583 ià(
timeout_»maš
 > 0)

585 
timeout_»maš
 -ğ
time_u£d_³r_¡•
;

586 ià(
timeout_»maš
 <= 0)

588 
rc
 = 
APR_TIMEUP
;

589 
”rÜCode
 = 
ERROR_CODE_TIME_OUT
;

592 
sock‘
->
	`£tTimeOut
(
timeout_»maš
);

596 
­r_size_t
 
size
 = 1;

597 
c
 = '\0';

598 
št64_t
 
cu¼’t_time
 = 
	`G‘TimeCouÁMS
();

599 
rc
 = 
sock‘
->
	`»cv
(&
c
, &
size
);

600 
time_u£d_³r_¡•
 = 
	`G‘TimeCouÁMS
(è- 
cu¼’t_time
;

603 ià(
rc
 =ğ
APR_SUCCESS
)

605 
¡r
.
	`push_back
(
c
);

606 
Ën_rg‘
++;

607 
”rÜCode
 = 
ERROR_CODE_NO_ERROR
;

609 ià(
	`APR_STATUS_IS_TIMEUP
(
rc
))

611 
”rÜCode
 = 
ERROR_CODE_TIME_OUT
;

614 ià(
nÚblock
 != 0 &&

615 
	`APR_STATUS_IS_EAGAIN
(
rc
))

617 
”rÜCode
 = 
ERROR_CODE_EAGAIN
;

620 ià(
	`APR_STATUS_IS_EOF
(
rc
) ||

621 
size
 == 0)

623 
”rÜCode
 = 
ERROR_CODE_EOF
;

628 
”rÜCode
 = 
ERROR_CODE_UNKNOWN_ERROR
;

632 ià(
Ën_»cv
 !ğ
NULL
)

634 *
Ën_»cv
 = (
ušt32_t
)
Ën_rg‘
;

637 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

639 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

642 ià(
timeout
 !ğ
timeout_Üigš®
)

644 
sock‘
->
	`£tTimeOut
(
timeout_Üigš®
);

647  
rc
 =ğ
APR_SUCCESS
;

648 
	}
}

650 
DLL_PUBLIC
 
­r_¡©us_t
 
	gSYSUTILS_SPACE
::
	$R—dSock‘UÁTimeout
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, 
¡d
::
¡ršg
 &
¡r
, cÚ¡ std::¡ršg &
eos
, 
št64_t
 
timeout
 , 
ušt32_t
 *
Ën_»cv
 )

652 ià(
Ën_»cv
 !ğ
NULL
)

654 *
Ën_»cv
 = 0;

657 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

658 
	`IF_TRUE_RETURN_VALUE
(
eos
.
	`Ëngth
(è=ğ0, 
çl£
);

660 
št64_t
 
timeout_Üigš®
 = 
sock‘
->
	`g‘TimeOut
();

661 
št32_t
 
nÚblock_Üigš®
 = 
sock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

663 
št32_t
 
nÚblock
 = (
timeout
 == 0) ? 0 : 1;

665 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

667 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

670 ià(
timeout
 !ğ
timeout_Üigš®
)

672 
sock‘
->
	`£tTimeOut
(
timeout
);

675 
št64_t
 
timeout_»maš
 = 
timeout
;

676 
št64_t
 
time_u£d_³r_¡•
 = 0;

677 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

678 
­r_size_t
 
Ën_rg‘
 = 0;

679 
¡r
.
	`Ëngth
(è< 
eos
.Ëngth(è|| 
	`¡rcmp
(¡r.
	`c_¡r
() + str.length() -ƒos.length(),ƒos.c_str()) != 0)

682 ià(
timeout_»maš
 > 0)

684 
timeout_»maš
 -ğ
time_u£d_³r_¡•
;

685 ià(
timeout_»maš
 <= 0)

687 
rc
 = 
APR_TIMEUP
;

690 
sock‘
->
	`£tTimeOut
(
timeout_»maš
);

694 
­r_size_t
 
size
 = 1;

695 
c
 = '\0';

696 
št64_t
 
cu¼’t_time
 = 
SYSUTILS_SPACE
::
	`G‘TimeCouÁMS
();

697 
rc
 = 
sock‘
->
	`»cv
(&
c
, &
size
);

698 
time_u£d_³r_¡•
 = 
SYSUTILS_SPACE
::
	`G‘TimeCouÁMS
(è- 
cu¼’t_time
;

701 ià(
rc
 =ğ
APR_SUCCESS
)

703 
¡r
.
	`push_back
(
c
);

704 
Ën_rg‘
++;

706 ià(
	`APR_STATUS_IS_TIMEUP
(
rc
))

710 ià(
nÚblock
 != 0 &&

711 
	`APR_STATUS_IS_EAGAIN
(
rc
))

715 ià(
	`APR_STATUS_IS_EOF
(
rc
) ||

716 
size
 == 0)

726 ià(
Ën_»cv
 !ğ
NULL
)

728 *
Ën_»cv
 = (
ušt32_t
)
Ën_rg‘
;

731 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

733 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

736 ià(
timeout
 !ğ
timeout_Üigš®
)

738 
sock‘
->
	`£tTimeOut
(
timeout_Üigš®
);

741  
rc
;

742 
	}
}

744 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$R—dSock‘P“k
(
A´TıSock‘
 *
sock‘
, 
¡d
::
¡ršg
 &
¡r
, 
ušt32_t
& 
”rÜCode
,

745 
št64_t
 
timeout
)

747 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 
çl£
);

749 
št64_t
 
timeout_Üigš®
 = 
sock‘
->
	`g‘TimeOut
();

750 
št32_t
 
nÚblock_Üigš®
 = 
sock‘
->
	`g‘O±iÚ
(
APR_SO_NONBLOCK
);

752 
št32_t
 
nÚblock
 = (
timeout
 == 0) ? 0 : 1;

754 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

756 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock
);

759 ià(
timeout
 !ğ
timeout_Üigš®
)

761 
sock‘
->
	`£tTimeOut
(
timeout
);

764 
­r_¡©us_t
 
rc
 = 
APR_SUCCESS
;

765 
­r_size_t
 
size
 = 
PEEK_SIZE
;

766 
buf
[
PEEK_SIZE
];

767 
buf
[
PEEK_SIZE
 -1] = '\0';

768 
rc
 = 
sock‘
->
	`»cv_³ek
(
buf
, &
size
);

770 ià(
rc
 =ğ
APR_SUCCESS
)

772 
¡r
 = 
buf
;

773 
”rÜCode
 = 
ERROR_CODE_NO_ERROR
;

775 ià(
	`APR_STATUS_IS_TIMEUP
(
rc
))

777 
”rÜCode
 = 
ERROR_CODE_TIME_OUT
;

779  
çl£
;

783 
”rÜCode
 = 
ERROR_CODE_UNKNOWN_ERROR
;

784  
çl£
;

787 ià(
nÚblock
 !ğ
nÚblock_Üigš®
)

789 
sock‘
->
	`£tO±iÚ
(
APR_SO_NONBLOCK
, 
nÚblock_Üigš®
);

792 ià(
timeout
 !ğ
timeout_Üigš®
)

794 
sock‘
->
	`£tTimeOut
(
timeout_Üigš®
);

797  
rc
 =ğ
APR_SUCCESS
;

798 
	}
}

800 #ià
defšed
(
_WIN32
)

802 #–ià
defšed
(
__lšux__
)

803 
	~<sys/ty³s.h
>

804 
	~<sys/sock‘.h
>

805 
	~"­r/­r_roÙ.h
"

806 
	~"­r-1/­r_pÜbË.h
"

811 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$C»©eTıSock‘Paœ
(
A´TıSock‘
 *
sock‘s
[2])

813 
	`IF_NULL_RETURN_VALUE
(
sock‘s
, 
çl£
);

814 
sock‘s
[0] = 
NULL
;

815 
sock‘s
[1] = 
NULL
;

817 #ià
	`defšed
(
_WIN32
)

818 
A´TıSock‘
 
li¡’”
;

819 
	`IF_FALSE_RETURN_VALUE
(
li¡’”
.
	`bšd
(
NULL
, 0), 
çl£
);

820 
­r_sockaddr_t
 *
add»ss
 = 
NULL
;

821 
	`IF_FALSE_RETURN_VALUE
(
li¡’”
.
	`g‘LoÿlSockAddr
(
add»ss
), 
çl£
);

822 
	`IF_NULL_RETURN_VALUE
(
add»ss
, 
NULL
);

823 
	`IF_FALSE_RETURN_VALUE
(
li¡’”
.
	`li¡’
(), 
çl£
);

825 
A´TıSock‘
 *
ş›Á
 = 
Ãw
 
	`A´TıSock‘
();

826 
­r_¡©us_t
 
rc
 = 
ş›Á
->
	`cÚÃù
("127.0.0.1", (
ušt16_t
)
add»ss
->
pÜt
);

827 ià(
rc
 !ğ
APR_SUCCESS
)

829 
d–‘e
 
ş›Á
;

830  
çl£
;

833 
A´TıSock‘
 *
£rv”
 = 
li¡’”
.
	`acû±
();

834 ià(
rc
 !ğ
APR_SUCCESS
 || 
£rv”
 =ğ
NULL
)

836 
d–‘e
 
ş›Á
;

837  
çl£
;

840 
sock‘s
[0] = 
ş›Á
;

841 
sock‘s
[1] = 
£rv”
;

842 #–ià
	`defšed
(
__lšux__
)

843 
socks
[2] = {0};

844 
»t
 = 
	`sock‘·œ
(
AF_LOCAL
, 
SOCK_STREAM
, 0, 
socks
);

845 
	`IF_NOT_EQUAL_RETURN_VALUE
(
»t
, 0, 
çl£
);

847 
sock‘s
[0] = 
Ãw
 
	`A´TıSock‘
(
socks
[0]);

848 
sock‘s
[1] = 
Ãw
 
	`A´TıSock‘
(
socks
[1]);

851  
çl£
;

854  
Œue
;

855 
	}
}

857 #ià
defšed
(
__lšux__
)

858 
	~<sys/sock‘.h
>

859 
	~<Ãtš‘/š.h
>

860 
	~<¬·/š‘.h
>

865 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$G‘Add»ssSŒšg
(cÚ¡ 
­r_sockaddr_t
 *
add»ss
)

867 
	`IF_NULL_RETURN_VALUE
(
add»ss
, "0.0.0.0");

869  
	`š‘_Áß
(
add»ss
->
§
.
sš
.
sš_addr
);

870 
	}
}

	@../apr/apr_utility.h

1 #iâdeà
__APR_UTILITY_H__


2 
	#__APR_UTILITY_H__


	)

4 
	~"expÜts.h
"

5 
	~"­r/­r_sock‘.h
"

6 
	~"­r-1/­r_pŞl.h
"

7 
	~<¡ršg
>

9 
	#ERROR_CODE_NO_ERROR
 0

	)

10 
	#ERROR_CODE_UNKNOWN_ERROR
 1

	)

11 
	#ERROR_CODE_TIME_OUT
 2

	)

12 
	#ERROR_CODE_EAGAIN
 3

	)

13 
	#ERROR_CODE_EOF
 4

	)

15 
	#PEEK_SIZE
 1024

	)

17 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

26 
DLL_PUBLIC
 
­r_št16_t
 
CheckSock‘Ev’ts
(
A´Sock‘
 *
sock‘
,‡´_št16_ˆ
ev’ts
, 
št32_t
 
timeout
);

36 
DLL_PUBLIC
 
boŞ
 
Wr™eSock‘
(
A´TıSock‘
 *
sock‘
, cÚ¡ *
bufãr
, 
ušt32_t
 
Ën
, ušt32_ˆ*
Ën_£nd
=
NULL
);

45 
DLL_PUBLIC
 
boŞ
 
Wr™eSock‘
(
A´TıSock‘
 *
sock‘
, cÚ¡ 
¡d
::
¡ršg
 &
¡r
, 
ušt32_t
 *
Ën_£nd
=
NULL
);

56 
DLL_PUBLIC
 
boŞ
 
Wr™eSock‘UÁTimeout
(
A´TıSock‘
 *
sock‘
, cÚ¡ *
bufãr
, 
ušt32_t
 
Ën
, 
št64_t
 
timeout
, ušt32_ˆ*
Ën_£nd
=
NULL
);

66 
DLL_PUBLIC
 
boŞ
 
Wr™eSock‘UÁTimeout
(
A´TıSock‘
 *
sock‘
, cÚ¡ 
¡d
::
¡ršg
 &
¡r
, 
št64_t
 
timeout
);

76 
DLL_PUBLIC
 
boŞ
 
R—dSock‘
(
A´TıSock‘
 *
sock‘
, *
bufãr
, 
ušt32_t
 
Ën
, ušt32_ˆ*
Ën_»cv
=
NULL
);

86 
DLL_PUBLIC
 
boŞ
 
R—dSock‘
(
A´TıSock‘
 *
sock‘
, 
ušt32_t
 
Ën
, 
¡d
::
¡ršg
 &
¡r
, ušt32_ˆ*
Ën_»cv
=
NULL
);

97 
DLL_PUBLIC
 
boŞ
 
R—dSock‘UÁTimeout
(
A´TıSock‘
 *
sock‘
, *
bufãr
, 
ušt32_t
 
Ën
, 
št64_t
 
timeout
, ušt32_ˆ*
Ën_»cv
=
NULL
);

108 
DLL_PUBLIC
 
boŞ
 
R—dSock‘UÁTimeout
(
A´TıSock‘
 *
sock‘
, 
ušt32_t
 
Ën
, 
št64_t
 
timeout
, 
¡d
::
¡ršg
 &
¡r
, ušt32_ˆ*
Ën_»cv
=
NULL
);

120 
DLL_PUBLIC
 
boŞ
 
R—dSock‘UÁEOS
(
A´TıSock‘
 *
sock‘
, *
bufãr
, 
ušt32_t
 
Ën
, *
eos
, 
št64_t
 
timeout
=-1, ušt32_ˆ*
Ën_»cv
=
NULL
);

131 
DLL_PUBLIC
 
boŞ
 
R—dSock‘UÁEOS
(
A´TıSock‘
 *
sock‘
, 
¡d
::
¡ršg
 &
¡r
, cÚ¡ std::¡ršg &
eos
, 
št64_t
 
timeout
=-1, 
ušt32_t
 *
Ën_»cv
=
NULL
);

143 
DLL_PUBLIC
 
boŞ
 
R—dSock‘UÁEOS
(
A´TıSock‘
 *
sock‘
, 
¡d
::
¡ršg
 &
¡r
, cÚ¡ std::¡ršg &
eos
, 
ušt32_t
& 
”rÜCode
, 
št64_t
 
timeout
=-1, ušt32_ˆ*
Ën_»cv
=
NULL
);

154 
DLL_PUBLIC
 
­r_¡©us_t
 
R—dSock‘UÁTimeout
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
, 
¡d
::
¡ršg
 &
¡r
, cÚ¡ std::¡ršg &
eos
, 
št64_t
 
timeout
=-1, 
ušt32_t
 *
Ën_»cv
=
NULL
);

156 
DLL_PUBLIC
 
boŞ
 
R—dSock‘P“k
(
A´TıSock‘
 *
sock‘
, 
¡d
::
¡ršg
 &
¡r
, 
ušt32_t
& 
”rÜCode
, 
št64_t
 
timeout
);

166 
DLL_PUBLIC
 
boŞ
 
C»©eTıSock‘Paœ
(
A´TıSock‘
 *
sock‘s
[2]);

173 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
G‘Add»ssSŒšg
(cÚ¡ 
­r_sockaddr_t
 *
add»ss
);

	@../apr/unittest/apr_resource_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"­r/­r_pŞl£t.h
"

3 
	~"­r/­r_sock‘.h
"

4 
	~"­r/­r_ut™y.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
	$TEST
(
A´ResourûTe¡
, 
A´Sock‘Te¡
)

10 
i
 = 0; i < 100000; i++)

12 
A´Sock‘
 
	`sock‘
(
APR_INET
, 
SOCK_STREAM
, 
APR_PROTO_TCP
);

14 
	}
}

16 
	$TEST
(
A´ResourûTe¡
, 
A´TıSock‘Te¡
)

18 
i
 = 0; i < 100000; i++)

20 
A´TıSock‘
 
sock‘
;

22 
	}
}

24 
	$TEST
(
A´ResourûTe¡
, 
A´TıSock‘PaœTe¡
)

26 
i
 = 0; i < 100000; i++)

28 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

29 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

30 
	`EXPECT_NE
((
A´TıSock‘
*)
NULL
, 
sock‘s
[0]);

31 
	`EXPECT_NE
((
A´TıSock‘
*)
NULL
, 
sock‘s
[1]);

32 
d–‘e
 
sock‘s
[0];

33 
d–‘e
 
sock‘s
[1];

35 
	}
}

37 
	$TEST
(
A´ResourûTe¡
, 
A´PŞlS‘Te¡
)

39 
i
 = 0; i < 100000; i++)

41 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

42 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

43 
	`EXPECT_NE
((
A´TıSock‘
*)
NULL
, 
sock‘s
[0]);

44 
	`EXPECT_NE
((
A´TıSock‘
*)
NULL
, 
sock‘s
[1]);

45 ià(
sock‘s
[0] !ğ
NULL
)

47 
	`EXPECT_EQ
((
­r_št16_t
)
APR_POLLOUT
, 
	`CheckSock‘Ev’ts
(
sock‘s
[0], 
APR_POLLIN
 | APR_POLLOUT, 1));

49 ià(
sock‘s
[1] !ğ
NULL
)

51 
	`EXPECT_EQ
((
­r_št16_t
)
APR_POLLOUT
, 
	`CheckSock‘Ev’ts
(
sock‘s
[1], 
APR_POLLIN
 | APR_POLLOUT, 1));

53 
d–‘e
 
sock‘s
[0];

54 
d–‘e
 
sock‘s
[1];

56 
	}
}

58 
	$TEST
(
A´ResourûTe¡
, 
CheckSock‘Ev’tTe¡
)

60 
A´TıSock‘
 
£rv”_sock‘
;

61 
	`EXPECT_TRUE
(
£rv”_sock‘
.
	`bšd
(
NULL
, (
­r_pÜt_t
)1234));

62 
	`EXPECT_TRUE
(
£rv”_sock‘
.
	`li¡’
(500));

63 
i
 = 0; i < 100000; i++)

65 
A´TıSock‘
 
ş›Á_sock‘
;

66 
	`EXPECT_EQ
(
APR_SUCCESS
, 
ş›Á_sock‘
.
	`cÚÃù
("127.0.0.1", (
­r_pÜt_t
)1234));

67 
	`EXPECT_EQ
((
­r_št16_t
)
APR_POLLIN
, 
	`CheckSock‘Ev’ts
(&
£rv”_sock‘
, APR_POLLIN, 100));

68 
A´TıSock‘
 *
acû±ed_sock‘
 = 
£rv”_sock‘
.
	`acû±
();

69 
	`EXPECT_NE
((
A´TıSock‘
*)
NULL
, 
acû±ed_sock‘
);

70 
d–‘e
 
acû±ed_sock‘
;

72 
	}
}

	@../apr/unittest/apr_root_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"­r/­r_roÙ.h
"

4 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

6 
	$TEST
(
A´RoÙTe¡
, 
A´RoÙIn¡ªûTe¡
)

8 
	`EXPECT_EQ
(
A´RoÙ
::
	`š¡ªû
(), AprRoot::instance());

9 
	}
}

	@../apr/unittest/apr_server_client_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"­r/­r_sock‘.h
"

4 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

6 
	gs_pÜt
 = 12345;

8 
	$TEST
(
A´S”v”Cl›ÁTe¡
, 
CommuniÿtiÚTe¡
)

10 
A´TıSock‘
 *
pLi¡’”
 = 
Ãw
 
	`A´TıSock‘
();

11 
	`EXPECT_NE
((
A´TıSock‘
 *)
NULL
, 
pLi¡’”
);

12 
	`EXPECT_EQ
(
Œue
, 
pLi¡’”
->
	`bšd
(
NULL
, 
s_pÜt
));

13 
	`EXPECT_EQ
(
Œue
, 
pLi¡’”
->
	`li¡’
());

15 
A´TıSock‘
 *
pCl›Á
 = 
Ãw
 
	`A´TıSock‘
();

16 
	`EXPECT_NE
((
A´TıSock‘
 *)
NULL
, 
pCl›Á
);

17 
	`EXPECT_EQ
(
APR_SUCCESS
, 
pCl›Á
->
	`cÚÃù
("127.0.0.1", 
s_pÜt
));

19 
A´TıSock‘
 *
pS”v”
 = 
pLi¡’”
->
	`acû±
();

20 
	`EXPECT_NE
((
A´TıSock‘
 *)
NULL
, 
pS”v”
);

22 
d–‘e
 
pS”v”
;

23 
d–‘e
 
pCl›Á
;

24 
d–‘e
 
pLi¡’”
;

25 
	}
}

	@../apr/unittest/apr_socket_pair_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"­r/­r_sock‘.h
"

3 
	~"­r/­r_ut™y.h
"

4 
	~"¡ršg.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
	#MAX_BUFFER_SIZE
 512

	)

10 
	$TEST
(
A´Sock‘PaœTe¡
, 
CommuniÿtiÚTe¡
)

12 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

13 
	`EXPECT_EQ
(
Œue
, 
	`C»©eTıSock‘Paœ
(
sock‘s
));

14 
	`EXPECT_NE
((
A´TıSock‘
 *)
NULL
, 
sock‘s
[0]);

15 
	`EXPECT_NE
((
A´TıSock‘
 *)
NULL
, 
sock‘s
[1]);

17 
dummy_¡ršg_size
 = 0;

18 
bufãr
[
MAX_BUFFER_SIZE
] = {0};

19 
bufãr_size
 = 
MAX_BUFFER_SIZE
;

21 
dummy_¡ršg_01
[] = "dummy string 1";

22 
dummy_¡ršg_size
 = (è* 
	`¡¾’
(
dummy_¡ršg_01
);

23 
	`EXPECT_EQ
(
APR_SUCCESS
, 
sock‘s
[0]->
	`£nd
(
dummy_¡ršg_01
, (
­r_size_t
 *)&
dummy_¡ršg_size
));

24 
	`EXPECT_EQ
((è* 
	`¡¾’
(
dummy_¡ršg_01
), 
dummy_¡ršg_size
);

25 
bufãr_size
 = 
MAX_BUFFER_SIZE
;

26 
	`EXPECT_EQ
(
APR_POLLOUT
, 
	`CheckSock‘Ev’ts
(
sock‘s
[0], APR_POLLOUT, 0));

27 
	`EXPECT_EQ
(
APR_POLLIN
, 
	`CheckSock‘Ev’ts
(
sock‘s
[1], APR_POLLIN, 0));

28 
	`EXPECT_EQ
(
APR_SUCCESS
, 
sock‘s
[1]->
	`»cv
(
bufãr
, (
­r_size_t
 *)&
bufãr_size
));

29 
	`EXPECT_EQ
(
dummy_¡ršg_size
, 
bufãr_size
);

30 
	`EXPECT_STREQ
(
dummy_¡ršg_01
, 
bufãr
);

32 
dummy_¡ršg_02
[] = "dummy string 22";

33 
dummy_¡ršg_size
 = (è* 
	`¡¾’
(
dummy_¡ršg_02
);

34 
	`EXPECT_EQ
(
APR_SUCCESS
, 
sock‘s
[1]->
	`£nd
(
dummy_¡ršg_02
, (
­r_size_t
 *)&
dummy_¡ršg_size
));

35 
	`EXPECT_EQ
((è* 
	`¡¾’
(
dummy_¡ršg_02
), 
dummy_¡ršg_size
);

36 
bufãr_size
 = 
MAX_BUFFER_SIZE
;

37 
	`EXPECT_EQ
(
APR_POLLIN
, 
	`CheckSock‘Ev’ts
(
sock‘s
[0], APR_POLLIN, 0));

38 
	`EXPECT_EQ
(
APR_POLLOUT
, 
	`CheckSock‘Ev’ts
(
sock‘s
[1], APR_POLLOUT, 0));

39 
	`EXPECT_EQ
(
APR_SUCCESS
, 
sock‘s
[0]->
	`»cv
(
bufãr
, (
­r_size_t
 *)&
bufãr_size
));

40 
	`EXPECT_EQ
(
dummy_¡ršg_size
, 
bufãr_size
);

41 
	`EXPECT_STREQ
(
dummy_¡ršg_02
, 
bufãr
);

43 
d–‘e
 
sock‘s
[0];

44 
d–‘e
 
sock‘s
[1];

45 
	}
}

	@../apr/unittest/apr_thread_worker_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"­r_th»ad_wÜk”_‹¡.h
"

4 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

6 
	gC®cuÏtÜ
::
	$C®cuÏtÜ
()

8 
	}
}

10 
C®cuÏtÜ
::~
	$C®cuÏtÜ
()

12 
	}
}

14 
C®cuÏtÜ
::
	$Th»adProc
()

18 
Mes§geSŒuù
* 
pMes§ge
 = 
NULL
;

19 ià(!
	`CheckReque¡
((
ušt32_t
 *)&
pMes§ge
))

27 
pMes§ge
 = (
Mes§geSŒuù
 *)
	`G‘Reque¡
();

30 ià(
pMes§ge
 =ğ
NULL
)

32 
	`R•ly
(
RETURN_CODE_FAIL
);

36 
pMes§ge
->
»que¡
.
uTaskCode
)

38 
TASK_CODE_EXIT
:

39 
pMes§ge
->
»¶y
.
uR‘uºCode
 = 
RETURN_CODE_SUCCESS
;

40 
	`R•ly
(
RETURN_CODE_SUCCESS
);

42 
TASK_CODE_ADD
:

43 
pMes§ge
->
»¶y
.
uR‘uºCode
 = 
RETURN_CODE_SUCCESS
;

44 
pMes§ge
->
»¶y
.
iResuÉ
 =…Mes§ge->
»que¡
.
iP¬am1
 +…Mes§ge->»que¡.
iP¬am2
;

46 
TASK_CODE_SUB
:

47 
pMes§ge
->
»¶y
.
uR‘uºCode
 = 
RETURN_CODE_SUCCESS
;

48 
pMes§ge
->
»¶y
.
iResuÉ
 =…Mes§ge->
»que¡
.
iP¬am1
 -…Mes§ge->»que¡.
iP¬am2
;

50 
TASK_CODE_MUL
:

51 
pMes§ge
->
»¶y
.
uR‘uºCode
 = 
RETURN_CODE_SUCCESS
;

52 
pMes§ge
->
»¶y
.
iResuÉ
 =…Mes§ge->
»que¡
.
iP¬am1
 *…Mes§ge->»que¡.
iP¬am2
;

54 
TASK_CODE_DIV
:

55 ià(
pMes§ge
->
»que¡
.
iP¬am2
 == 0)

57 
pMes§ge
->
»¶y
.
uR‘uºCode
 = 
RETURN_CODE_FAIL
;

58 
pMes§ge
->
»¶y
.
iResuÉ
 = 0;

62 
pMes§ge
->
»¶y
.
uR‘uºCode
 = 
RETURN_CODE_SUCCESS
;

63 
pMes§ge
->
»¶y
.
iResuÉ
 =…Mes§ge->
»que¡
.
iP¬am1
 /…Mes§ge->»que¡.
iP¬am2
;

67 
pMes§ge
->
»¶y
.
uR‘uºCode
 = 
RETURN_CODE_FAIL
;

68 
pMes§ge
->
»¶y
.
iResuÉ
 = 0;

71 
	`R•ly
((
ušt32_t
)
pMes§ge
->
»¶y
.
uR‘uºCode
);

74 
	}
}

76 
	$TEST
(
A´Th»adWÜk”Te¡
, 
C®cuÏtÜAddTe¡
)

78 
C®cuÏtÜ
 
ÿlcuÏtÜ
;

79 
Mes§geSŒuù
 
mes§ge
 = {{0, 0, 0}, {0, 0}};

81 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

82 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

84 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C»©eTh»ad
());

85 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

87 
ušt32_t
 
uResuÉ
 = 0;

88 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)
NULL
, &
uResuÉ
));

89 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

91 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_ADD
;

92 
mes§ge
.
»que¡
.
iP¬am1
 = 1;

93 
mes§ge
.
»que¡
.
iP¬am2
 = 2;

94 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

95 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

96 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

97 
	`EXPECT_EQ
(3, 
mes§ge
.
»¶y
.
iResuÉ
);

99 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_OTHER
;

100 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

101 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

102 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

103 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

104 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

106 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_EXIT
;

107 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

108 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

109 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

110 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

111 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

113 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Clo£Th»ad
());

114 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

115 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

116 
	}
}

118 
	$TEST
(
A´Th»adWÜk”Te¡
, 
C®cuÏtÜSubTe¡
)

120 
C®cuÏtÜ
 
ÿlcuÏtÜ
;

121 
Mes§geSŒuù
 
mes§ge
 = {{0, 0, 0}, {0, 0}};

123 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

124 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

126 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C»©eTh»ad
());

127 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

129 
ušt32_t
 
uResuÉ
 = 0;

130 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)
NULL
, &
uResuÉ
));

131 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

133 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_SUB
;

134 
mes§ge
.
»que¡
.
iP¬am1
 = 3;

135 
mes§ge
.
»que¡
.
iP¬am2
 = 4;

136 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

137 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

138 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

139 
	`EXPECT_EQ
(-1, 
mes§ge
.
»¶y
.
iResuÉ
);

141 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_OTHER
;

142 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

143 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

144 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

145 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

146 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

148 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_EXIT
;

149 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

150 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

151 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

152 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

153 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

155 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Clo£Th»ad
());

156 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

157 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

158 
	}
}

160 
	$TEST
(
A´Th»adWÜk”Te¡
, 
C®cuÏtÜMulTe¡
)

162 
C®cuÏtÜ
 
ÿlcuÏtÜ
;

163 
Mes§geSŒuù
 
mes§ge
 = {{0, 0, 0}, {0, 0}};

165 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

166 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

168 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C»©eTh»ad
());

169 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

171 
ušt32_t
 
uResuÉ
 = 0;

172 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)
NULL
, &
uResuÉ
));

173 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

175 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_MUL
;

176 
mes§ge
.
»que¡
.
iP¬am1
 = 5;

177 
mes§ge
.
»que¡
.
iP¬am2
 = 6;

178 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

179 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

180 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

181 
	`EXPECT_EQ
(30, 
mes§ge
.
»¶y
.
iResuÉ
);

183 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_OTHER
;

184 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

185 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

186 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

187 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

188 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

190 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_EXIT
;

191 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

192 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

193 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

194 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

195 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

197 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Clo£Th»ad
());

198 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

199 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

200 
	}
}

202 
	$TEST
(
A´Th»adWÜk”Te¡
, 
C®cuÏtÜDivTe¡
)

204 
C®cuÏtÜ
 
ÿlcuÏtÜ
;

205 
Mes§geSŒuù
 
mes§ge
 = {{0, 0, 0}, {0, 0}};

207 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

208 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

210 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C»©eTh»ad
());

211 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

213 
ušt32_t
 
uResuÉ
 = 0;

214 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)
NULL
, &
uResuÉ
));

215 
	`EXPECT_EQ
(
RETURN_CODE_FAIL
, 
uResuÉ
);

217 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_DIV
;

218 
mes§ge
.
»que¡
.
iP¬am1
 = 7;

219 
mes§ge
.
»que¡
.
iP¬am2
 = 8;

220 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

221 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

222 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

223 
	`EXPECT_EQ
(0, 
mes§ge
.
»¶y
.
iResuÉ
);

225 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_DIV
;

226 
mes§ge
.
»que¡
.
iP¬am1
 = 9;

227 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

228 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

229 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

230 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

232 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_OTHER
;

233 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

234 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

235 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

236 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

237 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

239 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_EXIT
;

240 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

241 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

242 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

243 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

244 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

246 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Clo£Th»ad
());

247 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

248 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

249 
	}
}

251 
	$TEST
(
A´Th»adWÜk”Te¡
, 
C®cuÏtÜComboTe¡
)

253 
C®cuÏtÜ
 
ÿlcuÏtÜ
;

254 
Mes§geSŒuù
 
mes§ge
 = {{0, 0, 0}, {0, 0}};

256 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

257 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

259 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C»©eTh»ad
());

260 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

262 
ušt32_t
 
uResuÉ
 = 0;

263 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)
NULL
, &
uResuÉ
));

264 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

266 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_ADD
;

267 
mes§ge
.
»que¡
.
iP¬am1
 = 11;

268 
mes§ge
.
»que¡
.
iP¬am2
 = 22;

269 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

270 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

271 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

272 
	`EXPECT_EQ
(33, 
mes§ge
.
»¶y
.
iResuÉ
);

274 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_SUB
;

275 
mes§ge
.
»que¡
.
iP¬am1
 = 33;

276 
mes§ge
.
»que¡
.
iP¬am2
 = 44;

277 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

278 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

279 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

280 
	`EXPECT_EQ
(-11, 
mes§ge
.
»¶y
.
iResuÉ
);

282 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_MUL
;

283 
mes§ge
.
»que¡
.
iP¬am1
 = 55;

284 
mes§ge
.
»que¡
.
iP¬am2
 = 66;

285 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

286 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

287 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

288 
	`EXPECT_EQ
(3630, 
mes§ge
.
»¶y
.
iResuÉ
);

290 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_DIV
;

291 
mes§ge
.
»que¡
.
iP¬am1
 = 77;

292 
mes§ge
.
»que¡
.
iP¬am2
 = 88;

293 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

294 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

295 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

296 
	`EXPECT_EQ
(0, 
mes§ge
.
»¶y
.
iResuÉ
);

298 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_DIV
;

299 
mes§ge
.
»que¡
.
iP¬am1
 = 99;

300 
mes§ge
.
»que¡
.
iP¬am2
 = 00;

301 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

302 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

303 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

305 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_OTHER
;

306 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

307 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

308 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

309 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
uResuÉ
);

310 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_FAIL
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

312 
mes§ge
.
»que¡
.
uTaskCode
 = 
TASK_CODE_EXIT
;

313 
mes§ge
.
»que¡
.
iP¬am1
 = 0;

314 
mes§ge
.
»que¡
.
iP¬am2
 = 0;

315 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
, &
uResuÉ
));

316 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
uResuÉ
);

317 
	`EXPECT_EQ
((
ušt32_t
)
RETURN_CODE_SUCCESS
, 
mes§ge
.
»¶y
.
uR‘uºCode
);

319 
	`EXPECT_EQ
(
Œue
, 
ÿlcuÏtÜ
.
	`Clo£Th»ad
());

320 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`Th»adExi¡s
());

321 
	`EXPECT_EQ
(
çl£
, 
ÿlcuÏtÜ
.
	`C®lWÜk”
((
ušt32_t
)&
mes§ge
));

322 
	}
}

	@../apr/unittest/apr_thread_worker_test.h

1 #iâdeà
__APR_THREAD_PAIR_TEST_H__


2 
	#__APR_THREAD_PAIR_TEST_H__


	)

4 
	~"­r/­r_th»ad_wÜk”.h
"

7 
	#TASK_CODE_EXIT
 0x00000001

	)

8 
	#TASK_CODE_ADD
 0x00000002

	)

9 
	#TASK_CODE_SUB
 0x00000003

	)

10 
	#TASK_CODE_MUL
 0x00000004

	)

11 
	#TASK_CODE_DIV
 0x00000005

	)

12 
	#TASK_CODE_OTHER
 0x00000006

	)

15 
	#RETURN_CODE_SUCCESS
 0x00000000

	)

16 
	#RETURN_CODE_FAIL
 0xFFFFFFFF

	)

18 
	sReque¡SŒuù


20 
ušt32_t
 
	muTaskCode
;

21 
št32_t
 
	miP¬am1
;

22 
št32_t
 
	miP¬am2
;

25 
	sR•lySŒuù


27 
ušt32_t
 
	muR‘uºCode
;

28 
št32_t
 
	miResuÉ
;

31 
	sMes§geSŒuù


33 
Reque¡SŒuù
 
	m»que¡
;

34 
R•lySŒuù
 
	m»¶y
;

37 şas 
	cC®cuÏtÜ
: 
public
 
SYSUTILS_SPACE
::
A´Th»adWÜk”


39 
public
:

40 
C®cuÏtÜ
();

41 
	mvœtu®
 ~
C®cuÏtÜ
();

42 
	m´Ùeùed
:

43 
Th»adProc
();

	@../apr/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../common/critical_section.cpp

1 
	~"ü™iÿl_£ùiÚ.h
"

3 
	~<as£¹.h
>

4 
	~<¡dio.h
>

5 
	~<”ºo.h
>

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
è|| defšed(
__CYGWIN32__
)

11 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
::
	$Cr™iÿlSeùiÚ
()

13 
	`In™ŸlizeCr™iÿlSeùiÚ
(&
m_ü™iÿl_£ùiÚ
);

14 
	}
}

16 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
::~
	$Cr™iÿlSeùiÚ
()

18 
	`D–‘eCr™iÿlSeùiÚ
(&
m_ü™iÿl_£ùiÚ
);

19 
	}
}

21 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
::
	$Lock
()

23 
	`EÁ”Cr™iÿlSeùiÚ
(&
m_ü™iÿl_£ùiÚ
);

24 
	}
}

26 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
::
	$UÆock
()

28 
	`L—veCr™iÿlSeùiÚ
(&
m_ü™iÿl_£ùiÚ
);

29 
	}
}

31 
DLL_PUBLIC
 
boŞ
 
	gCr™iÿlSeùiÚ
::
	$TryLock
()

33  
	`TryEÁ”Cr™iÿlSeùiÚ
(&
m_ü™iÿl_£ùiÚ
) != 0;

34 
	}
}

36 #–ià
defšed
(
__lšux__
)

38 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
::
	$Cr™iÿlSeùiÚ
()

40 
»t
 = 0;

42 
±h»ad_mu‹x©Œ_t
 
©Œ
;

43 
»t
 = 
	`±h»ad_mu‹x©Œ_š™
(&
©Œ
);

44 
	`as£¹
(
»t
 == 0);

45 ià(
»t
 != 0)

47 
	`³¼Ü
("pthread_mutexattr_init()");

50 
»t
 = 
	`±h»ad_mu‹x©Œ_£‰y³
(&
©Œ
, 
PTHREAD_MUTEX_RECURSIVE
);

51 
	`as£¹
(
»t
 == 0);

52 ià(
»t
 != 0)

54 
	`³¼Ü
("pthread_mutexattr_settype()");

57 
»t
 = 
	`±h»ad_mu‹x_š™
(&
m_ü™iÿl_£ùiÚ
, &
©Œ
);

58 
	`as£¹
(
»t
 == 0);

59 ià(
»t
 != 0)

61 
	`³¼Ü
("pthread_mutex_init()");

64 
»t
 = 
	`±h»ad_mu‹x©Œ_de¡roy
(&
©Œ
);

65 
	`as£¹
(
»t
 == 0);

66 ià(
»t
 != 0)

68 
	`³¼Ü
("pthread_mutexattr_destroy()");

70 
	}
}

72 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
::~
	$Cr™iÿlSeùiÚ
()

74 
»t
 = 
	`±h»ad_mu‹x_de¡roy
(&
m_ü™iÿl_£ùiÚ
);

75 
	`as£¹
(
»t
 == 0);

76 ià(
»t
 != 0)

78 
	`³¼Ü
("pthread_mutex_destroy()");

80 
	}
}

82 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
::
	$Lock
()

84 
»t
 = 
	`±h»ad_mu‹x_lock
(&
m_ü™iÿl_£ùiÚ
);

85 
	`as£¹
(
»t
 == 0);

86 ià(
»t
 != 0)

88 
	`³¼Ü
("pthread_mutex_lock()");

90 
	}
}

92 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚ
::
	$UÆock
()

94 
»t
 = 
	`±h»ad_mu‹x_uÆock
(&
m_ü™iÿl_£ùiÚ
);

95 
	`as£¹
(
»t
 == 0);

96 ià(
»t
 != 0)

98 
	`³¼Ü
("pthread_mutex_unlock()");

100 
	}
}

102 
DLL_PUBLIC
 
boŞ
 
	gCr™iÿlSeùiÚ
::
	$TryLock
()

104 
»t
 = 
	`±h»ad_mu‹x_Œylock
(&
m_ü™iÿl_£ùiÚ
);

105 ià(
»t
 == 0)

107  
Œue
;

109 ià(
»t
 =ğ
EBUSY
)

111  
çl£
;

115 
	`³¼Ü
("pthread_mutex_trylock()");

116  
çl£
;

118 
	}
}

121 #”rÜ 
Unknown
 
¶©fÜm
.

124 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚLock
::
	$Cr™iÿlSeùiÚLock
(
Cr™iÿlSeùiÚ
 *
ü™iÿl_£ùiÚ
)

125 : 
	$m_ü™iÿl_£ùiÚ
(
ü™iÿl_£ùiÚ
)

127 ià(
m_ü™iÿl_£ùiÚ
 !ğ
NULL
)

129 
m_ü™iÿl_£ùiÚ
->
	`Lock
();

131 
	}
}

133 
DLL_PUBLIC
 
	gCr™iÿlSeùiÚLock
::~
	$Cr™iÿlSeùiÚLock
()

135 ià(
m_ü™iÿl_£ùiÚ
 !ğ
NULL
)

137 
m_ü™iÿl_£ùiÚ
->
	`UÆock
();

139 
	}
}

141 
DLL_PUBLIC
 
boŞ
 
	gCr™iÿlSeùiÚLock
::
	$TryLock
()

143 ià(
m_ü™iÿl_£ùiÚ
 !ğ
NULL
)

145  
m_ü™iÿl_£ùiÚ
->
	`TryLock
();

148  
çl£
;

149 
	}
}

	@../common/critical_section.h

1 #iâdeà
__SYSUTILS_CRITICAL_SECTION_H__


2 
	#__SYSUTILS_CRITICAL_SECTION_H__


	)

4 
	~"expÜts.h
"

6 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
è|| defšed(
__CYGWIN32__
)

7 #iâdeà
WIN32_LEAN_AND_MEAN


8 
	#WIN32_LEAN_AND_MEAN


13 #iâdeà
_WIN32_WINNT


	)

14 
	#_WIN32_WINNT
 0x0400

	)

16 
	~<wšdows.h
>

17 
CRITICAL_SECTION
 
	tCr™iÿlSeùiÚTy³
;

18 #–ià
defšed
(
__lšux__
)

19 
	~<±h»ad.h
>

20 
±h»ad_mu‹x_t
 
	tCr™iÿlSeùiÚTy³
;

22 #”rÜ 
Unknown
 
¶©fÜm
.

25 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

27 şas 
	cDLL_PUBLIC
 
	gCr™iÿlSeùiÚ


29 
	gpublic
:

30 
Cr™iÿlSeùiÚ
();

31 ~
Cr™iÿlSeùiÚ
();

32 
Lock
();

33 
UÆock
();

34 
boŞ
 
TryLock
();

36 
	g´iv©e
:

37 
Cr™iÿlSeùiÚTy³
 
m_ü™iÿl_£ùiÚ
;

39 
	g´iv©e
:

40 
Cr™iÿlSeùiÚ
(cÚ¡ Cr™iÿlSeùiÚ &
rhs
);

41 cÚ¡ 
	gCr™iÿlSeùiÚ
 &
	gİ”©Ü
=(cÚ¡ 
Cr™iÿlSeùiÚ
 &
rhs
);

44 şas 
	cDLL_PUBLIC
 
	gCr™iÿlSeùiÚLock


46 
	gpublic
:

47 
ex¶ic™
 
Cr™iÿlSeùiÚLock
(
Cr™iÿlSeùiÚ
 *
ü™iÿl_£ùiÚ
);

48 ~
Cr™iÿlSeùiÚLock
();

49 
boŞ
 
TryLock
();

51 
	g´iv©e
:

52 
Cr™iÿlSeùiÚ
 *
m_ü™iÿl_£ùiÚ
;

54 
	g´iv©e
:

55 
Cr™iÿlSeùiÚLock
();

56 
Cr™iÿlSeùiÚLock
(cÚ¡ Cr™iÿlSeùiÚLock &
rhs
);

57 cÚ¡ 
	gCr™iÿlSeùiÚLock
 &
	gİ”©Ü
=(cÚ¡ 
Cr™iÿlSeùiÚLock
 &
rhs
);

	@../common/directory_traverse.cpp

1 
	~"dœeùÜy_Œav”£.h
"

3 
	~"commÚ/fe.h
"

5 
	~<¡ršg.h
>

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
DLL_PUBLIC
 cÚ¡ 
ušt32_t
 
	gDœeùÜyT¿v”£
::
FLAG_FILE
;

10 
DLL_PUBLIC
 cÚ¡ 
ušt32_t
 
	gDœeùÜyT¿v”£
::
FLAG_DIRECTORY
;

11 
DLL_PUBLIC
 cÚ¡ 
ušt32_t
 
	gDœeùÜyT¿v”£
::
FLAG_SYMBOLIC
;

13 #ià
defšed
(
_WIN32
)

15 
	gDœeùÜyT¿v”£
::
DœeùÜy
::
	$DœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

16 : 
	`m_·thÇme
(
·thÇme
)

17 , 
	$m_hªdË
(
NULL
)

19 
	`mem£t
((*)&
m_d©a
, 0, (m_data));

20 
	}
}

22 
	gDœeùÜyT¿v”£
::
DœeùÜy
::
	$DœeùÜy
(cÚ¡ 
DœeùÜy
 &
rhs
)

23 : 
	`m_·thÇme
(
rhs
.
m_·thÇme
)

24 , 
	$m_hªdË
(
rhs
.
m_hªdË
)

26 
	`memıy
((*)&
m_d©a
, (cÚ¡ *)&
rhs
.m_data, (m_data));

27 
	}
}

29 
	gDœeùÜyT¿v”£
::
DœeùÜy
 &
DœeùÜyT¿v”£
::DœeùÜy::
İ”©Ü
=(cÚ¡ DœeùÜy &
rhs
)

31 ià(
this
 !ğ&
rhs
)

33 
m_·thÇme
 = 
rhs
.m_pathname;

34 
	gm_hªdË
 = 
rhs
.
m_hªdË
;

35 
memıy
((*)&
m_d©a
, (cÚ¡ *)&
rhs
.m_data, (m_data));

37  *
	gthis
;

40 
	gDœeùÜyT¿v”£
::
DœeùÜy
::~
	$DœeùÜy
()

42 
	}
}

44 
DLL_PUBLIC
 
DœeùÜyT¿v”£
::
	$DœeùÜyT¿v”£
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
, cÚ¡ 
boŞ
 
»cursive
 )

45 : 
	`m_·thÇme
(
	`ResŞveP©h
(
·thÇme
))

46 , 
	$m_»cursive
(
»cursive
)

48 
	`Re£t
();

49 
	}
}

51 
DLL_PUBLIC
 
	gDœeùÜyT¿v”£
::~
	$DœeùÜyT¿v”£
()

53 
	`Clo£
();

54 
	}
}

56 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyT¿v”£
::
	$Re£t
()

58 
boŞ
 
»t
 = 
	`Clo£
();

60 
DœeùÜy
 
	`dœeùÜy
(
m_·thÇme
);

61 
m_dœeùÜ›s
.
	`push_back
(
dœeùÜy
);

63  
»t
;

64 
	}
}

66 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyT¿v”£
::
	$Clo£
()

68 
boŞ
 
»t
 = 
Œue
;

70 
¡d
::
li¡
<
DœeùÜy
>::
™”©Ü
 
™
 = 
m_dœeùÜ›s
.
	`begš
(); iˆ!ğm_dœeùÜ›s.
	`’d
(); it++)

72 ià(
™
->
m_hªdË
 !ğ
NULL
 && it->m_hªdË !ğ
INVALID_HANDLE_VALUE
)

74 
	`FšdClo£
(
™
->
m_hªdË
);

77 
m_dœeùÜ›s
.
	`ş—r
();

79  
»t
;

80 
	}
}

82 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyT¿v”£
::
	$NextSiblšg
(
DœeùÜy
 &
dœeùÜy
)

84 ià(
dœeùÜy
.
m_hªdË
 =ğ
NULL
)

86 
¡d
::
¡ršg
 
·thÇme
 = 
	`ResŞveP©h
(
dœeùÜy
.
m_·thÇme
 + "\\*");

87 
dœeùÜy
.
m_hªdË
 = 
	`FšdFœ¡FeA
(
·thÇme
.
	`c_¡r
(), &dœeùÜy.
m_d©a
);

89 ià(
dœeùÜy
.
m_hªdË
 !ğ
INVALID_HANDLE_VALUE
)

91 ià(
	`FšdNextFeA
(
dœeùÜy
.
m_hªdË
, &dœeùÜy.
m_d©a
) == 0)

93  
çl£
;

97 ià(
dœeùÜy
.
m_hªdË
 =ğ
INVALID_HANDLE_VALUE
)

99  
çl£
;

103 
BOOL
 
bNext
 = 
TRUE
;

104 
bNext
 !ğ0 && (
	`¡rcmp
(".", 
dœeùÜy
.
m_d©a
.
cFeName
) == 0 || strcmp("..", directory.m_data.cFileName) == 0))

106 
bNext
 = 
	`FšdNextFeA
(
dœeùÜy
.
m_hªdË
, &dœeùÜy.
m_d©a
);

110 ià(
bNext
 == 0)

112 
	`FšdClo£
(
dœeùÜy
.
m_hªdË
);

113  
çl£
;

117 
ušt32_t
 
æags
 = 
	`G‘FÏgs
(
dœeùÜy
);

118 ià(
m_»cursive
 && ((
æags
 & 
FLAG_DIRECTORY
è!ğ0è&& ((æag & 
FLAG_SYMBOLIC
) == 0))

120 
DœeùÜy
 
	`sub_dœeùÜy
(
	`G‘P©hName
(
dœeùÜy
));

121 
m_dœeùÜ›s
.
	`push_back
(
sub_dœeùÜy
);

123  
Œue
;

124 
	}
}

126 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyT¿v”£
::
	$Next
()

128 !
m_dœeùÜ›s
.
	`em±y
())

130 
DœeùÜy
 &
dœeùÜy
 = 
m_dœeùÜ›s
.
	`back
();

131 ià(
	`NextSiblšg
(
dœeùÜy
))

133  
Œue
;

135 
m_dœeùÜ›s
.
	`pİ_back
();

137  
çl£
;

138 
	}
}

140 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
DœeùÜyT¿v”£
::
	$G‘P©hName
()

142 ià(
m_dœeùÜ›s
.
	`em±y
())

146  
	`G‘P©hName
(
m_dœeùÜ›s
.
	`back
());

147 
	}
}

149 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
DœeùÜyT¿v”£
::
	$G‘P©hName
(
DœeùÜy
 &
dœeùÜy
)

151 ià(
dœeùÜy
.
m_hªdË
 =ğ
NULL
 || dœeùÜy.m_hªdË =ğ
INVALID_HANDLE_VALUE
)

153  
dœeùÜy
.
m_·thÇme
;

156  
	`ResŞveP©h
(
dœeùÜy
.
m_·thÇme
 + "\\" + dœeùÜy.
m_d©a
.
cFeName
);

157 
	}
}

159 
DLL_PUBLIC
 
ušt32_t
 
	gDœeùÜyT¿v”£
::
	$G‘FÏgs
()

161 ià(
m_dœeùÜ›s
.
	`em±y
())

165  
	`G‘FÏgs
(
m_dœeùÜ›s
.
	`back
());

166 
	}
}

168 
DLL_PUBLIC
 
ušt32_t
 
	gDœeùÜyT¿v”£
::
	$G‘FÏgs
(
DœeùÜy
 &
dœeùÜy
)

170 ià(
dœeùÜy
.
m_hªdË
 =ğ
NULL
 || dœeùÜy.m_hªdË =ğ
INVALID_HANDLE_VALUE
)

175 
ušt32_t
 
æags
 = 0;

177 if((
dœeùÜy
.
m_d©a
.
dwFeA‰ribu‹s
 & 
FILE_ATTRIBUTE_DIRECTORY
) == 0)

179 
æags
 |ğ
FLAG_FILE
;

183 
æags
 |ğ
FLAG_DIRECTORY
;

185 ià((
dœeùÜy
.
m_d©a
.
dwFeA‰ribu‹s
 & 
FILE_ATTRIBUTE_REPARSE_POINT
) != 0)

187 
æags
 |ğ
FLAG_SYMBOLIC
;

190  
æags
;

191 
	}
}

193 #–ià
defšed
(
__lšux__
)

195 
	gDœeùÜyT¿v”£
::
DœeùÜy
::
	$DœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

196 : 
	`m_·thÇme
(
·thÇme
)

197 , 
	`m_dœ
(
NULL
)

198 , 
	$m_’f
(
NULL
)

200 
	`mem£t
((*)&
m_’Œy
, 0, (m_entry));

201 
	}
}

203 
	gDœeùÜyT¿v”£
::
DœeùÜy
::
	$DœeùÜy
(cÚ¡ 
DœeùÜy
 &
rhs
)

204 : 
	`m_·thÇme
(
rhs
.
m_·thÇme
)

205 , 
	`m_dœ
(
rhs
.
m_dœ
)

206 , 
	$m_’f
(
rhs
.
m_’f
)

208 
	`memıy
((*)&
m_’Œy
, (cÚ¡ *)&
rhs
.m_entry, (m_entry));

209 
	}
}

211 
	gDœeùÜyT¿v”£
::
DœeùÜy
 &
DœeùÜyT¿v”£
::DœeùÜy::
İ”©Ü
=(cÚ¡ DœeùÜy &
rhs
)

213 ià(
this
 !ğ&
rhs
)

215 
m_·thÇme
 = 
rhs
.m_pathname;

216 
	gm_dœ
 = 
rhs
.
m_dœ
;

217 
	gm_’f
 = 
rhs
.
m_’f
;

218 
memıy
((*)&
m_’Œy
, (cÚ¡ *)&
rhs
.m_entry, (m_entry));

220  *
	gthis
;

223 
	gDœeùÜyT¿v”£
::
DœeùÜy
::~
	$DœeùÜy
()

225 
	}
}

227 
DLL_PUBLIC
 
DœeùÜyT¿v”£
::
	$DœeùÜyT¿v”£
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
, cÚ¡ 
boŞ
 
»cursive
 )

228 : 
	`m_·thÇme
(
	`ResŞveP©h
(
·thÇme
))

229 , 
	$m_»cursive
(
»cursive
)

231 
	`Re£t
();

232 
	}
}

234 
DLL_PUBLIC
 
	gDœeùÜyT¿v”£
::~
	$DœeùÜyT¿v”£
()

236 
	`Clo£
();

237 
	}
}

239 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyT¿v”£
::
	$Re£t
()

241 
boŞ
 
»t
 = 
	`Clo£
();

243 
DœeùÜy
 
	`dœeùÜy
(
m_·thÇme
);

244 
m_dœeùÜ›s
.
	`push_back
(
dœeùÜy
);

246  
»t
;

247 
	}
}

249 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyT¿v”£
::
	$Clo£
()

251 
boŞ
 
»t
 = 
Œue
;

253 
¡d
::
li¡
<
DœeùÜy
>::
™”©Ü
 
™
 = 
m_dœeùÜ›s
.
	`begš
(); iˆ!ğm_dœeùÜ›s.
	`’d
(); it++)

255 ià(
™
->
m_dœ
 !ğ
NULL
)

257 
»t
 =„‘ & (
	`şo£dœ
(
™
->
m_dœ
) == 0);

260 
m_dœeùÜ›s
.
	`ş—r
();

262  
»t
;

263 
	}
}

265 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyT¿v”£
::
	$NextSiblšg
(
DœeùÜy
 &
dœeùÜy
)

268 ià(
dœeùÜy
.
m_dœ
 =ğ
NULL
)

270 
dœeùÜy
.
m_’f
 = 
NULL
;

271  
çl£
;

275 
rc
 = 0;

276 
rc
 = 
	`»addœ_r
(
dœeùÜy
.
m_dœ
, &dœeùÜy.
m_’Œy
, &dœeùÜy.
m_’f
);

277 
rc
 =ğ0 && 
dœeùÜy
.
m_’f
 !ğ
NULL
 && (
	`¡rcmp
(".", dœeùÜy.m_’f->
d_Çme
) == 0 || strcmp("..", directory.m_enf->d_name) == 0))

279 
rc
 = 
	`»addœ_r
(
dœeùÜy
.
m_dœ
, &dœeùÜy.
m_’Œy
, &dœeùÜy.
m_’f
);

283 ià(
rc
 != 0)

285 
dœeùÜy
.
m_’f
 = 
NULL
;

286  
çl£
;

290 ià(
dœeùÜy
.
m_’f
 =ğ
NULL
)

292  
çl£
;

296 
ušt32_t
 
æags
 = 
	`G‘FÏgs
(
dœeùÜy
);

297 ià(
m_»cursive
 && ((
æags
 & 
FLAG_DIRECTORY
è!ğ0è&& ((æag & 
FLAG_SYMBOLIC
) == 0))

299 
DœeùÜy
 
	`sub_dœeùÜy
(
	`G‘P©hName
(
dœeùÜy
));

300 
m_dœeùÜ›s
.
	`push_back
(
sub_dœeùÜy
);

302  
Œue
;

303 
	}
}

305 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyT¿v”£
::
	$Next
()

307 !
m_dœeùÜ›s
.
	`em±y
())

309 
DœeùÜy
 &
dœeùÜy
 = 
m_dœeùÜ›s
.
	`back
();

310 ià(
dœeùÜy
.
m_dœ
 =ğ
NULL
)

312 
dœeùÜy
.
m_dœ
 = 
	`İ’dœ
(dœeùÜy.
m_·thÇme
.
	`c_¡r
());

314 ià(
dœeùÜy
.
m_dœ
 !ğ
NULL
)

316 ià(
	`NextSiblšg
(
dœeùÜy
))

318  
Œue
;

322 
	`şo£dœ
(
dœeùÜy
.
m_dœ
);

325 
m_dœeùÜ›s
.
	`pİ_back
();

327  
çl£
;

328 
	}
}

330 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
DœeùÜyT¿v”£
::
	$G‘P©hName
()

332 ià(
m_dœeùÜ›s
.
	`em±y
())

336  
	`G‘P©hName
(
m_dœeùÜ›s
.
	`back
());

337 
	}
}

339 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
DœeùÜyT¿v”£
::
	$G‘P©hName
(
DœeùÜy
 &
dœeùÜy
)

341 ià(
dœeùÜy
.
m_’f
 =ğ
NULL
)

343  
dœeùÜy
.
m_·thÇme
;

346  
dœeùÜy
.
m_·thÇme
 + "/" + dœeùÜy.
m_’f
->
d_Çme
;

347 
	}
}

349 
DLL_PUBLIC
 
ušt32_t
 
	gDœeùÜyT¿v”£
::
	$G‘FÏgs
()

351 ià(
m_dœeùÜ›s
.
	`em±y
())

355  
	`G‘FÏgs
(
m_dœeùÜ›s
.
	`back
());

356 
	}
}

358 
DLL_PUBLIC
 
ušt32_t
 
	gDœeùÜyT¿v”£
::
	$G‘FÏgs
(
DœeùÜy
 &
dœeùÜy
)

360 
¡d
::
¡ršg
 
fuÎ·th
 = 
	`G‘P©hName
(
dœeùÜy
);

362 
¡©
 
buf
;

363 ià(
	`l¡©
(
fuÎ·th
.
	`c_¡r
(), &
buf
) != 0)

368 
ušt32_t
 
æags
 = 0;

370 if(
	`S_ISREG
(
buf
.
¡_mode
))

372 
æags
 |ğ
FLAG_FILE
;

374 if(
	`S_ISDIR
(
buf
.
¡_mode
))

376 
æags
 |ğ
FLAG_DIRECTORY
;

378 ià(
	`S_ISLNK
(
buf
.
¡_mode
))

380 
æags
 |ğ
FLAG_SYMBOLIC
;

383  
æags
;

384 
	}
}

	@../common/directory_traverse.h

1 #iâdeà
__SYSUTILS_DIRECTORY_TRAVERSE_H__


2 
	#__SYSUTILS_DIRECTORY_TRAVERSE_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~<li¡
>

9 
	~<¡ršg
>

11 #ià
defšed
(
_WIN32
)

12 #iâdeà
WIN32_LEAN_AND_MEAN


13 
	#WIN32_LEAN_AND_MEAN


15 
	~<Wšdows.h
>

	)

17 #´agm¨
w¬nšg
(
di§bË
: 4251)

18 #–ià
defšed
(
__lšux__
)

19 
	~<sys/¡©.h
>

20 
	~<dœ’t.h
>

25 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

27 şas 
	cDLL_PUBLIC
 
	gDœeùÜyT¿v”£


29 
	g´iv©e
:

30 şas 
	cDœeùÜy


32 
ä›nd
 
şass
 
DœeùÜyT¿v”£
;

34 
	gpublic
:

35 
DœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

36 ~
DœeùÜy
();

38 
DœeùÜy
(cÚ¡ DœeùÜy &
rhs
);

39 
	gDœeùÜy
 &
	gİ”©Ü
=(cÚ¡ 
DœeùÜy
 &
rhs
);

41 
	g´iv©e
:

42 
DœeùÜy
();

44 
	g´iv©e
:

45 
¡d
::
¡ršg
 
m_·thÇme
;

46 #ià
defšed
(
_WIN32
)

47 
HANDLE
 
	gm_hªdË
;

48 
WIN32_FIND_DATAA
 
	gm_d©a
;

49 #–ià
defšed
(
__lšux__
)

50 
DIR
 *
	gm_dœ
;

51 
dœ’t
 
	gm_’Œy
;

52 
dœ’t
 *
	gm_’f
;

58 
	gpublic
:

60 cÚ¡ 
ušt32_t
 
FLAG_FILE
 = 0x00000001;

61 cÚ¡ 
ušt32_t
 
	gFLAG_DIRECTORY
 = 0x00000002;

62 cÚ¡ 
ušt32_t
 
	gFLAG_SYMBOLIC
 = 0x00000004;

64 
	gpublic
:

65 
DœeùÜyT¿v”£
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
, cÚ¡ 
boŞ
 
»cursive
=
çl£
);

66 ~
DœeùÜyT¿v”£
();

68 
boŞ
 
Re£t
();

69 
boŞ
 
Clo£
();

70 
boŞ
 
Next
();

71 
	g¡d
::
¡ršg
 
G‘P©hName
();

72 
ušt32_t
 
G‘FÏgs
();

74 
	g´iv©e
:

75 
DœeùÜyT¿v”£
();

76 
DœeùÜyT¿v”£
(cÚ¡ DœeùÜyT¿v”£ &
rhs
);

77 
	gDœeùÜyT¿v”£
 &
	gİ”©Ü
=(cÚ¡ 
DœeùÜyT¿v”£
 &
rhs
);

79 
boŞ
 
NextSiblšg
(
DœeùÜy
 &
dœeùÜy
);

80 
	g¡d
::
¡ršg
 
G‘P©hName
(
DœeùÜy
 &
dœeùÜy
);

81 
ušt32_t
 
G‘FÏgs
(
DœeùÜy
 &
dœeùÜy
);

83 
	g´iv©e
:

84 
¡d
::
¡ršg
 
m_·thÇme
;

85 
boŞ
 
	gm_»cursive
;

86 
	g¡d
::
li¡
<
DœeùÜy
> 
m_dœeùÜ›s
;

	@../common/file.cpp

1 
	~"fe.h
"

3 
	~<¡ršg.h
>

5 
	~"commÚ/¡ršg.h
"

7 #ià
defšed
(
_WIN32
)

8 
	~<Wšdows.h
>

9 
	~<¡dlib.h
>

10 
	~<dœeù.h
>

11 
	~<Shlobj.h
>

12 
	~<Sh–lAPI.h
>

13 #–ià
defšed
(
__lšux__
)

14 
	~<sys/¡©.h
>

15 
	~<sys/vfs.h
>

16 
	~<sys/ty³s.h
>

17 
	~<sys/wa™.h
>

18 
	~<uni¡d.h
>

19 
	~<lim™s.h
>

20 
	~<¡dlib.h
>

21 
	~<dœ’t.h
>

22 
	~<¡dio.h
>

27 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

29 #ifdeà
__lšux__


31 
boŞ
 
	$LšuxSy¡emC®l
(cÚ¡ 
¡d
::
¡ršg
& 
commªd
)

33 
pid_t
 
¡©us
 = 
	`sy¡em
(
commªd
.
	`c_¡r
());

35 ià(-1 =ğ
¡©us
)

37  
çl£
;

41 ià(
	`WIFEXITED
(
¡©us
))

43 ià(0 =ğ
	`WEXITSTATUS
(
¡©us
))

45  
Œue
;

49  
çl£
;

54  
çl£
;

57 
	}
}

60 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$CheckFeExi¡
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

62 #ià
	`defšed
(
_WIN32
)

63 
DWORD
 
»s
 = 
	`G‘FeA‰ribu‹sA
(
·thÇme
.
	`c_¡r
());

64 ià(
»s
 =ğ
INVALID_FILE_ATTRIBUTES
 || (» & 
FILE_ATTRIBUTE_DIRECTORY
) != 0)

66  
çl£
;

68  
Œue
;

69 #–ià
	`defšed
(
__lšux__
)

70 
¡©
 
buf
;

71 
»s
 = 
	`¡©
(
·thÇme
.
	`c_¡r
(), &
buf
);

72 ià(
»s
 !ğ0 || 
	`S_ISDIR
(
buf
.
¡_mode
))

74  
çl£
;

76  
Œue
;

80 
	}
}

82 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$CheckBlockDeviû
(cÚ¡ 
¡d
::
¡ršg
& 
·thÇme
)

84 #ià
	`defšed
(
__lšux__
)

85 
¡©
 
buf
;

87 
»s
 = 
	`¡©
(
·thÇme
.
	`c_¡r
(), &
buf
);

88 ià(
»s
 != 0)

90  
çl£
;

92  
	`S_ISBLK
(
buf
.
¡_mode
);

94  
Œue
;

96 
	}
}

98 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$ROOTFS_PROTECT
(cÚ¡ *
·thÇme
)

100 #ià
	`defšed
(
__lšux__
)

102 
¡©fs64
 
fs_roÙ
;

103 
¡©fs64
 
fs_Ùh”
;

105 ià(0 !ğ
	`¡©fs64
("/", &
fs_roÙ
))

107  
çl£
;

110 ià(0 !ğ
	`¡©fs64
(
·thÇme
, &
fs_Ùh”
))

112  
çl£
;

115  (0 !ğ
	`memcmp
(&
fs_roÙ
, &
fs_Ùh”
, (fs_root)));

117  
çl£
;

119 
	}
}

121 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$CheckDœeùÜyExi¡
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

123 #ià
	`defšed
(
_WIN32
)

124 
DWORD
 
»s
 = 
	`G‘FeA‰ribu‹sA
(
·thÇme
.
	`c_¡r
());

125 ià(
»s
 =ğ
INVALID_FILE_ATTRIBUTES
 || (» & 
FILE_ATTRIBUTE_DIRECTORY
) == 0)

127  
çl£
;

129  
Œue
;

130 #–ià
	`defšed
(
__lšux__
)

131 
¡©
 
buf
;

132 
»s
 = 
	`¡©
(
·thÇme
.
	`c_¡r
(), &
buf
);

133 ià(
»s
 !ğ0 || !
	`S_ISDIR
(
buf
.
¡_mode
))

135  
çl£
;

137  
Œue
;

141 
	}
}

143 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$MakeDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

145 #ià
	`defšed
(
_WIN32
)

146 
¡d
::
¡ršg
 
»sŞved_·thÇme
 = 
	`ResŞveP©h
(
·thÇme
);

147 
boŞ
 
»s
 = 
çl£
;

148 
Ëngth
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
»sŞved_·thÇme
.
	`c_¡r
(), -1, 
NULL
, 0);

149 
wch¬_t
 *
wbufãr
 = (wch¬_ˆ*)
	`ÿÎoc
(
Ëngth
, (wchar_t));

150 ià(
wbufãr
 =ğ
NULL
)

152  
çl£
;

154 
Ëngth
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
»sŞved_·thÇme
.
	`c_¡r
(), -1, 
wbufãr
,†ength);

155 ià(
Ëngth
 != 0)

157 
»s
 = 
	`SHC»©eDœeùÜy
(
NULL
, 
wbufãr
è=ğ
ERROR_SUCCESS
;

159 
	`ä“
((*)
wbufãr
);

160  
»s
;

161 #–ià
	`defšed
(
__lšux__
)

164 
size_t
 
Ën
 = 
·thÇme
.
	`Ëngth
() + 1;

165 * 
tmp
 = (*)
	`m®loc
(
Ën
 * ());

166 
	`¢´štf
(
tmp
, 
Ën
, "%s", 
·thÇme
.
	`c_¡r
());

168 ià(
tmp
[
Ën
 - 1] == '/')

170 
tmp
[
Ën
 - 1] = '\0';

173 * 
p
 = 
tmp
 + 1; *p;…++)

175 ià(*
p
 == '/')

177 *
p
 = '\0';

178 ià(!
	`CheckDœeùÜyExi¡
(
tmp
))

180 ià(
	`mkdœ
(
tmp
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IXUSR
 | 
S_IRGRP
 | 
S_IXGRP
 | 
S_IROTH
 | 
S_IXOTH
) != 0)

182 
	`ä“
(
tmp
);

183  
çl£
;

186 *
p
 = '/';

190 ià(!
	`CheckDœeùÜyExi¡
(
tmp
))

192 ià(
	`mkdœ
(
tmp
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IXUSR
 | 
S_IRGRP
 | 
S_IXGRP
 | 
S_IROTH
 | 
S_IXOTH
) != 0)

194 
	`ä“
(
tmp
);

195  
çl£
;

199 
	`ä“
(
tmp
);

200  
Œue
;

206 
	}
};

208 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$RemoveFe
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

210 #ià
	`defšed
(
_WIN32
)

211 
boŞ
 
»s
 = 
çl£
;

212 
Ëngth
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
·thÇme
.
	`c_¡r
(), -1, 
NULL
, 0);

213 
wch¬_t
 *
wbufãr
 = (wch¬_ˆ*)
	`ÿÎoc
(
Ëngth
, (wchar_t));

214 ià(
wbufãr
 =ğ
NULL
)

216  
çl£
;

218 
Ëngth
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
·thÇme
.
	`c_¡r
(), -1, 
wbufãr
,†ength);

219 ià(
Ëngth
 != 0)

221 
»s
 = 
	`D–‘eFeW
(
wbufãr
) != 0;

223 
	`ä“
((*)
wbufãr
);

224  
»s
;

225 #–ià
	`defšed
(
__lšux__
)

226  
	`uÆšk
(
·thÇme
.
	`c_¡r
()) == 0;

230 
	}
};

232 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$D–‘eDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

234 #ià
	`defšed
(
_WIN32
)

235 
iR‘
 = -1;

236 
Ëngth
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thÇme
.
	`c_¡r
(), -1, 
NULL
, 0);

237 
wch¬_t
 *
wbufãr
 = (wch¬_ˆ*)
	`ÿÎoc
(
Ëngth
 + 1, (wchar_t));

238 ià(
wbufãr
 =ğ
NULL
)

240  
çl£
;

242 
Ëngth
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thÇme
.
	`c_¡r
(), -1, 
wbufãr
,†ength);

243 ià(
Ëngth
 != 0)

245 
wbufãr
[
	`wc¦’
(wbuffer) + 1] = 0;

246 
SHFILEOPSTRUCTW
 
fo
;

247 
	`Z”oMemÜy
(&
fo
, (
SHFILEOPSTRUCT
));

249 
fo
.
wFunc
 = 
FO_DELETE
;

250 
fo
.
pFrom
 = 
wbufãr
;

251 
fo
.
fFÏgs
 = 
FOF_SILENT
 | 
FOF_NOERRORUI
 | 
FOF_NOCONFIRMATION
 | 
FOF_NOCONFIRMMKDIR
;

253 
iR‘
 = 
	`SHFeO³¿tiÚW
(&
fo
);

255 
	`ä“
((*)
wbufãr
);

257  (
iR‘
 =ğ0è? 
Œue
 : 
çl£
;

258 #–ià
	`defšed
(
__lšux__
)

259 
¡d
::
¡ršg
 
cmd
 = "rm -rà" + 
·thÇme
;

260  
	`LšuxSy¡emC®l
(
cmd
);

264 
	}
}

266 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$ChªgeDœeùÜyName
(cÚ¡ 
¡d
::
¡ršg
& 
ŞdName
, cÚ¡ std::¡ršg& 
ÃwName
)

268 #ià
	`defšed
(
_WIN32
)

269  
çl£
;

270 #–ià
	`defšed
(
__lšux__
)

271 
¡d
::
¡ršg
 
cmd
 = "mv " + 
ŞdName
 + " " + 
ÃwName
;

272  
	`LšuxSy¡emC®l
(
cmd
);

276 
	}
}

279 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$CİyFe2
(cÚ¡ 
¡d
::
¡ršg
 &
·thFrom
, cÚ¡ std::¡ršg &
·thTo
)

281 #ià
	`defšed
(
_WIN32
)

282 
iR‘
 = -1;

283 
ËngthFrom
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thFrom
.
	`c_¡r
(), -1, 
NULL
, 0);

284 
wch¬_t
 *
wbufãrFrom
 = (wch¬_ˆ*)
	`ÿÎoc
(
ËngthFrom
 + 1, (wchar_t));

285 ià(
wbufãrFrom
 =ğ
NULL
)

287  
çl£
;

289 
ËngthFrom
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thFrom
.
	`c_¡r
(), -1, 
wbufãrFrom
,†engthFrom);

291 
ËngthTo
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thTo
.
	`c_¡r
(), -1, 
NULL
, 0);

292 
wch¬_t
 *
wbufãrTo
 = (wch¬_ˆ*)
	`ÿÎoc
(
ËngthTo
 + 1, (wchar_t));

293 ià(
wbufãrTo
 =ğ
NULL
)

295  
çl£
;

297 
ËngthTo
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thTo
.
	`c_¡r
(), -1, 
wbufãrTo
,†engthTo);

299 ià(
ËngthFrom
 !ğ0 && 
ËngthTo
 != 0)

301 
wbufãrFrom
[
	`wc¦’
(wbufferFrom) + 1] = 0;

302 
wbufãrTo
[
	`wc¦’
(wbufferTo) + 1] = 0;

304 
SHFILEOPSTRUCTW
 
fo
;

305 
	`Z”oMemÜy
(&
fo
, (
SHFILEOPSTRUCT
));

307 
fo
.
wFunc
 = 
FO_COPY
;;

308 
fo
.
pFrom
 = 
wbufãrFrom
;

309 
fo
.
pTo
 = 
wbufãrTo
;

310 
fo
.
fFÏgs
 = 
FOF_SILENT
 | 
FOF_NOERRORUI
 | 
FOF_NOCONFIRMATION
 | 
FOF_NOCONFIRMMKDIR
;

312 
iR‘
 = 
	`SHFeO³¿tiÚW
(&
fo
);

314 
	`ä“
((*)
wbufãrFrom
);

315 
	`ä“
((*)
wbufãrTo
);

317  (
iR‘
 =ğ0è? 
Œue
 : 
çl£
;

318 #–ià
	`defšed
(
__lšux__
)

319 
¡d
::
¡ršg
 
cmd
 = "ı -rà" + 
·thFrom
 + " " + 
·thTo
;

320  
	`LšuxSy¡emC®l
(
cmd
);

324 
	}
}

326 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$CİyDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thFrom
, cÚ¡ std::¡ršg &
·thTo
)

328 #ià
	`defšed
(
_WIN32
)

329 
iR‘
 = -1;

330 
ËngthFrom
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thFrom
.
	`c_¡r
(), -1, 
NULL
, 0);

331 
wch¬_t
 *
wbufãrFrom
 = (wch¬_ˆ*)
	`ÿÎoc
(
ËngthFrom
 + 1, (wchar_t));

332 ià(
wbufãrFrom
 =ğ
NULL
)

334  
çl£
;

336 
ËngthFrom
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thFrom
.
	`c_¡r
(), -1, 
wbufãrFrom
,†engthFrom);

338 
ËngthTo
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thTo
.
	`c_¡r
(), -1, 
NULL
, 0);

339 
wch¬_t
 *
wbufãrTo
 = (wch¬_ˆ*)
	`ÿÎoc
(
ËngthTo
 + 1, (wchar_t));

340 ià(
wbufãrTo
 =ğ
NULL
)

342  
çl£
;

344 
ËngthTo
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
·thTo
.
	`c_¡r
(), -1, 
wbufãrTo
,†engthTo);

346 ià(
ËngthFrom
 !ğ0 && 
ËngthTo
 != 0)

348 
wbufãrFrom
[
	`wc¦’
(wbufferFrom) + 1] = 0;

349 
wbufãrTo
[
	`wc¦’
(wbufferTo) + 1] = 0;

351 
SHFILEOPSTRUCTW
 
fo
;

352 
	`Z”oMemÜy
(&
fo
, (
SHFILEOPSTRUCT
));

354 
fo
.
wFunc
 = 
FO_COPY
;;

355 
fo
.
pFrom
 = 
wbufãrFrom
;

356 
fo
.
pTo
 = 
wbufãrTo
;

357 
fo
.
fFÏgs
 = 
FOF_SILENT
 | 
FOF_NOERRORUI
 | 
FOF_NOCONFIRMATION
 | 
FOF_NOCONFIRMMKDIR
;

359 
iR‘
 = 
	`SHFeO³¿tiÚW
(&
fo
);

361 
	`ä“
((*)
wbufãrFrom
);

362 
	`ä“
((*)
wbufãrTo
);

364  (
iR‘
 =ğ0è? 
Œue
 : 
çl£
;

365 #–ià
	`defšed
(
__lšux__
)

366 
¡d
::
¡ršg
 
cmd
 = "ı -rà" + 
·thFrom
 + " " + 
·thTo
;

367  
	`LšuxSy¡emC®l
(
cmd
);

371 
	}
}

373 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$ResŞveP©h
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

375 
¡d
::
¡ršg
 
»sŞved·th
;

376 #ià
	`defšed
(
_WIN32
)

377 *
bufãr
 = (*)
	`m®loc
(
MAX_PATH
 * ());

378 ià(
bufãr
 !ğ
NULL
)

380 
DWORD
 
Ëngth
 = 
	`G‘FuÎP©hNameA
(
·thÇme
.
	`c_¡r
(), 
MAX_PATH
, 
bufãr
, 
NULL
);

381 ià(
Ëngth
 > 
MAX_PATH
)

383 
bufãr
 = (*)
	`»®loc
(bufãr, 
Ëngth
 * ());

384 ià(
bufãr
 !ğ
NULL
)

386 
Ëngth
 = 
	`G‘FuÎP©hNameA
(
·thÇme
.
	`c_¡r
(),†’gth, 
bufãr
, 
NULL
);

390 
Ëngth
 = 0;

393 ià(
Ëngth
 != 0)

395 
»sŞved·th
 = 
bufãr
;

397 
	`ä“
(
bufãr
);

399 #–ià
	`defšed
(
__lšux__
)

400 *
bufãr
 = 
	`»®·th
(
·thÇme
.
	`c_¡r
(), 
NULL
);

401 ià(
bufãr
 !ğ
NULL
)

403 
»sŞved·th
 = 
bufãr
;

405 ià(
·thÇme
.
	`Ëngth
() > 0)

407 
¡d
::
veùÜ
<¡d::
¡ršg
> 
sub·ths
;

408 ià(
·thÇme
[0] == '/')

410 
sub·ths
 = 
	`¡ršg_¥l™
(
·thÇme
, "/");

414 
bufãr
 = 
	`»®·th
(".", 
NULL
);

415 ià(
bufãr
 !ğ
NULL
)

417 
¡d
::
¡ršg
 
cu¼’©h
 = 
bufãr
;

418 
sub·ths
 = 
	`¡ršg_¥l™
(
cu¼’©h
, "/");

419 
¡d
::
veùÜ
<¡d::
¡ršg
> 
sub·ths_‹mp
 = 
	`¡ršg_¥l™
(
·thÇme
, "/");

420 
sub·ths
.
	`š£¹
(sub·ths.
	`’d
(), 
sub·ths_‹mp
.
	`begš
(), subpaths_temp.end());

423 
size_t
 
i
 = 
sub·ths
.
	`size
() - 1; i > 0; i--)

425 ià(
sub·ths
[
i
] == "" || subpaths[i] == ".")

427 
sub·ths
.
	`”a£
(sub·ths.
	`begš
(è+ 
i
);

430 
size_t
 
i
 = 1; i < 
sub·ths
.
	`size
(); i++)

432 ià(
sub·ths
[
i
] == "..")

434 ià(
i
 == 1)

436 
sub·ths
.
	`”a£
(sub·ths.
	`begš
(è+ 
i
);

437 
i
 -= 1;

441 
sub·ths
.
	`”a£
(sub·ths.
	`begš
(è+ (
i
 - 1), subpaths.begin() + (i - 1) + 2);

442 
i
 -= 2;

446 
»sŞved·th
 = 
	`¡ršg_m”ge
(
sub·ths
, "/");

448 
	`ä“
(
bufãr
);

452  
»sŞved·th
;

453 
	}
}

455 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$S¶™P©h
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
, 
S¶™P©hD©a
 &
d©a
)

457 
¡d
::
¡ršg
 
»sŞved·th
 = 
	`ResŞveP©h
(
·thÇme
);

458 #ià
	`defšed
(
_WIN32
)

459 
d©a
.
·»Á_·th
 = 
	`ResŞveP©h
(
»sŞved·th
 + "\\..");

461 
d©a
.
·»Á_·th
 = 
	`ResŞveP©h
(
»sŞved·th
 + "/..");

464 
size_t
 
£·¿tÜ_pos™iÚ
 = 
¡d
::
¡ršg
::
Åos
;

466 
£·¿tÜ_pos™iÚ
 = 
»sŞved·th
.
	`fšd_Ï¡_of
("/\\");

467 ià(
£·¿tÜ_pos™iÚ
 !ğ
¡d
::
¡ršg
::
Åos
)

469 
d©a
.
fe_Çme
 = 
»sŞved·th
.
	`sub¡r
(
£·¿tÜ_pos™iÚ
 + 1);

473 
d©a
.
fe_Çme
 = "";

476 
£·¿tÜ_pos™iÚ
 = 
d©a
.
fe_Çme
.
	`fšd_Ï¡_of
(".");

477 ià(
£·¿tÜ_pos™iÚ
 !ğ
¡d
::
¡ršg
::
Åos
)

479 
d©a
.
fe_ba£
 = d©a.
fe_Çme
.
	`sub¡r
(0, 
£·¿tÜ_pos™iÚ
);

480 
d©a
.
fe_ex‹nsiÚ
 = d©a.
fe_Çme
.
	`sub¡r
(
£·¿tÜ_pos™iÚ
 + 1);

484 
d©a
.
fe_ba£
 = d©a.
fe_Çme
;

485 
d©a
.
fe_ex‹nsiÚ
 = "";

488  
Œue
;

489 
	}
}

491 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$G‘FeStÜageSize
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

493 #ià
	`defšed
(
_WIN32
)

494 
DWORD
 
dwFeSizeLow
 = 0;

495 
DWORD
 
dwFeSizeHigh
 = 0;

496 
dwFeSizeLow
 = 
	`G‘Com´es£dFeSizeA
(
·thÇme
.
	`c_¡r
(), &
dwFeSizeHigh
);

497 ià(
dwFeSizeLow
 =ğ
INVALID_FILE_SIZE
 && 
	`G‘La¡E¼Ü
(è!ğ
NO_ERROR
)

501 
LARGE_INTEGER
 
li
;

502 
li
.
LowP¬t
 = 
dwFeSizeLow
;

503 
li
.
HighP¬t
 = 
dwFeSizeHigh
;

504  
li
.
QuadP¬t
;

505 #–ià
	`defšed
(
__lšux__
)

506 
¡©
 
buf
;

507 
»s
 = 
	`¡©
(
·thÇme
.
	`c_¡r
(), &
buf
);

508 ià(
»s
 != 0)

512  (
ušt64_t
)
buf
.
¡_size
;

516 
	}
}

518 
ušt64_t
 
	$s_G‘DœeùÜyStÜageSize
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

520 
ušt64_t
 
tÙ®_size
 = 
	`UINT64_C
(0);

521 #ià
	`defšed
(
_WIN32
)

522 
WIN32_FIND_DATAA
 
FšdFeD©a
;

523 
HANDLE
 
hªdË
 = 
	`FšdFœ¡FeA
(
·thÇme
.
	`c_¡r
(), &
FšdFeD©a
);

524 
BOOL
 
bNext
 = 
hªdË
 !ğ
INVALID_HANDLE_VALUE
 ? 
TRUE
 : 
FALSE
;

525 
bNext
 != 0)

527 ià((
FšdFeD©a
.
dwFeA‰ribu‹s
 & 
FILE_ATTRIBUTE_DIRECTORY
) != 0)

529 ià(
	`¡rcmp
(
FšdFeD©a
.
cFeName
, ".") != 0 && strcmp(FindFileData.cFileName, "..") != 0)

531 
tÙ®_size
 +ğ
	`s_G‘DœeùÜyStÜageSize
(
·thÇme
 + "\\" + 
FšdFeD©a
.
cFeName
);

536 
LARGE_INTEGER
 
li
;

537 
li
.
LowP¬t
 = 
FšdFeD©a
.
nFeSizeLow
;

538 
li
.
HighP¬t
 = 
FšdFeD©a
.
nFeSizeHigh
;

539 
tÙ®_size
 +ğ
li
.
QuadP¬t
;

541 
bNext
 = 
	`FšdNextFeA
(
hªdË
, &
FšdFeD©a
);

543 ià(
hªdË
 !ğ
INVALID_HANDLE_VALUE
)

545 
	`FšdClo£
(
hªdË
);

547 #–ià
	`defšed
(
__lšux__
)

548 
DIR
 *
dœ
 = 
	`İ’dœ
(
·thÇme
.
	`c_¡r
());

549 
dœ’t
 
’Œy
;

550 
dœ’t
* 
pResuÉ
 = 
NULL
;

551 ià(
dœ
 !ğ
NULL
)

553 (
	`»addœ_r
(
dœ
, &
’Œy
, &
pResuÉ
) == 0))

555 ià(
pResuÉ
 =ğ
NULL
)

560 ià(
	`¡rcmp
(
’Œy
.
d_Çme
, ".") == 0 || strcmp(entry.d_name, "..") == 0)

565 
¡d
::
¡ršg
 
fuÎ·th
 = 
·thÇme
 + "/" + 
’Œy
.
d_Çme
;

567 
¡©
 
buf
;

568 ià(
	`l¡©
(
fuÎ·th
.
	`c_¡r
(), &
buf
) != 0)

573 if(
	`S_ISDIR
(
buf
.
¡_mode
è&& !
	`S_ISLNK
(buf.st_mode))

575 
tÙ®_size
 +ğ
	`s_G‘DœeùÜyStÜageSize
(
fuÎ·th
);

577 if(
	`S_ISREG
(
buf
.
¡_mode
))

579 
tÙ®_size
 +ğ
buf
.
¡_size
;

582 
	`şo£dœ
(
dœ
);

587  
tÙ®_size
;

588 
	}
}

590 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$G‘DœeùÜyStÜageSize
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

592 ià(!
	`CheckDœeùÜyExi¡
(
·thÇme
))

594  
	`UINT64_C
(0);

596  
	`s_G‘DœeùÜyStÜageSize
(
	`ResŞveP©h
(
·thÇme
));

597 
	}
}

599 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$G‘Cu¼’tWÜkšgDœeùÜy
()

601 
¡d
::
¡ršg
 
¡r_cwd
;

602 #ià
	`defšed
(
_WIN32
)

603 *
cwd
 = 
	`_g‘cwd
(
NULL
, 0);

604 ià(
cwd
 !ğ
NULL
)

606 
¡r_cwd
 = 
cwd
;

607 
	`ä“
(
cwd
);

608 
cwd
 = 
NULL
;

610 #–ià
	`defšed
(
__lšux__
)

611 *
cwd
 = 
	`g‘cwd
(
NULL
, 0);

612 ià(
cwd
 !ğ
NULL
)

614 
¡r_cwd
 = 
cwd
;

615 
	`ä“
(
cwd
);

616 
cwd
 = 
NULL
;

621  
¡r_cwd
;

622 
	}
}

624 
boŞ
 
	$s_CheckDœeùÜyEm±y
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

626 
boŞ
 
bIsEm±y
 = 
Œue
;

628 #ià
	`defšed
(
_WIN32
)

629 
WIN32_FIND_DATAA
 
FšdFeD©a
;

630 
HANDLE
 
hªdË
 = 
	`FšdFœ¡FeA
(
·thÇme
.
	`c_¡r
(), &
FšdFeD©a
);

631 
BOOL
 
bNext
 = 
hªdË
 !ğ
INVALID_HANDLE_VALUE
 ? 
TRUE
 : 
FALSE
;

632 
bNext
 != 0)

634 ià(
	`¡rcmp
(
FšdFeD©a
.
cFeName
, ".") != 0 && strcmp(FindFileData.cFileName, "..") != 0)

636 
bIsEm±y
 = 
çl£
;

640 
bNext
 = 
	`FšdNextFeA
(
hªdË
, &
FšdFeD©a
);

642 ià(
hªdË
 !ğ
INVALID_HANDLE_VALUE
)

644 
	`FšdClo£
(
hªdË
);

646 #–ià
	`defšed
(
__lšux__
)

647 
DIR
 *
dœ
 = 
	`İ’dœ
(
·thÇme
.
	`c_¡r
());

648 
dœ’t
 
’Œy
;

649 
dœ’t
* 
pResuÉ
 = 
NULL
;

650 ià(
dœ
 !ğ
NULL
)

652 (
	`»addœ_r
(
dœ
, &
’Œy
, &
pResuÉ
) == 0))

654 ià(
pResuÉ
 =ğ
NULL
)

659 ià(
	`¡rcmp
(
’Œy
.
d_Çme
, ".") == 0 || strcmp(entry.d_name, "..") == 0)

665 
bIsEm±y
 = 
çl£
;

669 
	`şo£dœ
(
dœ
);

674  
bIsEm±y
;

675 
	}
}

677 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$CheckDœeùÜyEm±y
(cÚ¡ 
¡d
::
¡ršg
& 
¡rFŞd”
)

679 #ifdeà
WIN32


680 
¡d
::
¡ršg
 
¡rNewP©h
 = 
¡rFŞd”
 + "*.*";

681 #–ià
	`defšed
(
__lšux__
)

682 
¡d
::
¡ršg
 
¡rNewP©h
 = 
¡rFŞd”
;

685  
	`s_CheckDœeùÜyEm±y
(
	`ResŞveP©h
(
¡rNewP©h
));

686 
	}
}

688 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
	$s_G‘SubDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

690 
¡d
::
veùÜ
<¡d::
¡ršg
> 
vFe
;

692 #ià
	`defšed
(
_WIN32
)

693 
WIN32_FIND_DATAA
 
FšdFeD©a
;

694 
HANDLE
 
hªdË
 = 
	`FšdFœ¡FeA
(
·thÇme
.
	`c_¡r
(), &
FšdFeD©a
);

695 
BOOL
 
bNext
 = 
hªdË
 !ğ
INVALID_HANDLE_VALUE
 ? 
TRUE
 : 
FALSE
;

696 
bNext
 != 0)

698 ià((
FšdFeD©a
.
dwFeA‰ribu‹s
 & 
FILE_ATTRIBUTE_DIRECTORY
) != 0)

700 ià(
	`¡rcmp
(
FšdFeD©a
.
cFeName
, ".") != 0 && strcmp(FindFileData.cFileName, "..") != 0)

702 
vFe
.
	`push_back
(
FšdFeD©a
.
cFeName
);

706 
bNext
 = 
	`FšdNextFeA
(
hªdË
, &
FšdFeD©a
);

708 ià(
hªdË
 !ğ
INVALID_HANDLE_VALUE
)

710 
	`FšdClo£
(
hªdË
);

712 #–ià
	`defšed
(
__lšux__
)

713 
DIR
 *
dœ
 = 
	`İ’dœ
(
·thÇme
.
	`c_¡r
());

714 
dœ’t
 
’Œy
;

715 
dœ’t
* 
pResuÉ
 = 
NULL
;

716 ià(
dœ
 !ğ
NULL
)

718 (
	`»addœ_r
(
dœ
, &
’Œy
, &
pResuÉ
) == 0))

720 ià(
pResuÉ
 =ğ
NULL
)

725 ià(
	`¡rcmp
(
’Œy
.
d_Çme
, ".") == 0 || strcmp(entry.d_name, "..") == 0)

730 
¡d
::
¡ršg
 
fuÎ·th
 = 
·thÇme
 + "/" + 
’Œy
.
d_Çme
;

732 
¡©
 
buf
;

733 ià(
	`l¡©
(
fuÎ·th
.
	`c_¡r
(), &
buf
) != 0)

738 if(
	`S_ISDIR
(
buf
.
¡_mode
è&& !
	`S_ISLNK
(buf.st_mode))

740 
vFe
.
	`push_back
(
’Œy
.
d_Çme
);

743 
	`şo£dœ
(
dœ
);

748  
vFe
;

749 
	}
}

751 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
SYSUTILS_SPACE
::
	$G‘SubDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
& 
¡rFŞd”
)

753 #ifdeà
WIN32


754 
¡d
::
¡ršg
 
¡rNewP©h
 = 
¡rFŞd”
 + "*.*";

755 #–ià
	`defšed
(
__lšux__
)

756 
¡d
::
¡ršg
 
¡rNewP©h
 = 
¡rFŞd”
;

759  
	`s_G‘SubDœeùÜy
(
	`ResŞveP©h
(
¡rNewP©h
));

760 
	}
}

762 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$ChªgeWÜkšgDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
¡rP©h
)

764 ià(
¡rP©h
.
	`em±y
())

766  
çl£
;

769 #ià
	`defšed
(
_WIN32
)

770 if(0 !ğ
	`_chdœ
(
¡rP©h
.
	`c_¡r
()))

772  
çl£
;

774 #–ià
	`defšed
(
__lšux__
)

775 if(0 !ğ
	`chdœ
(
¡rP©h
.
	`c_¡r
()))

777  
çl£
;

781  
çl£
;

784  
Œue
;

785 
	}
}

	@../common/file.h

1 #iâdeà
__SYSUTILS_FILE_H__


2 
	#__SYSUTILS_FILE_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~<¡ršg
>

9 
	~<veùÜ
>

11 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

13 
DLL_PUBLIC
 
boŞ
 
CheckFeExi¡
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

15 
DLL_PUBLIC
 
boŞ
 
CheckBlockDeviû
(cÚ¡ 
¡d
::
¡ršg
& 
·thÇme
);

17 
DLL_PUBLIC
 
boŞ
 
ROOTFS_PROTECT
(cÚ¡ *
·thÇme
);

19 
DLL_PUBLIC
 
boŞ
 
CheckDœeùÜyExi¡
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

21 
DLL_PUBLIC
 
boŞ
 
MakeDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

23 
DLL_PUBLIC
 
boŞ
 
CİyFe2
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
, cÚ¡ std::¡ršg &
·thTo
);

25 
DLL_PUBLIC
 
boŞ
 
RemoveFe
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

27 
DLL_PUBLIC
 
boŞ
 
D–‘eDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

29 
DLL_PUBLIC
 
boŞ
 
ChªgeDœeùÜyName
(cÚ¡ 
¡d
::
¡ršg
& 
ŞdName
, cÚ¡ std::¡ršg& 
ÃwName
);

31 
DLL_PUBLIC
 
boŞ
 
CİyDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
·thFrom
, cÚ¡ std::¡ršg &
·thTo
);

33 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
ResŞveP©h
(cÚ¡ 
¡d
::¡ršg &
·thÇme
);

35 
DLL_PUBLIC
 
	gS¶™P©hD©a


37 
	g¡d
::
¡ršg
 
·»Á_·th
;

38 
	g¡d
::
¡ršg
 
fe_Çme
;

39 
	g¡d
::
¡ršg
 
fe_ba£
;

40 
	g¡d
::
¡ršg
 
fe_ex‹nsiÚ
;

43 
DLL_PUBLIC
 
boŞ
 
S¶™P©h
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
, 
S¶™P©hD©a
 &
d©a
);

45 
DLL_PUBLIC
 
ušt64_t
 
G‘FeStÜageSize
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

47 
DLL_PUBLIC
 
ušt64_t
 
G‘DœeùÜyStÜageSize
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
);

49 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
G‘Cu¼’tWÜkšgDœeùÜy
();

51 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
G‘SubDœeùÜy
(cÚ¡ std::¡ršg& 
¡rP©h
);

53 
DLL_PUBLIC
 
boŞ
 
CheckDœeùÜyEm±y
(cÚ¡ 
¡d
::
¡ršg
& 
¡rP©h
);

55 
DLL_PUBLIC
 
boŞ
 
ChªgeWÜkšgDœeùÜy
(cÚ¡ 
¡d
::
¡ršg
 &
¡rP©h
);

	@../common/fsusage.cpp

20 
	~"fsu§ge.h
"

22 
	~"commÚ/¡ršg.h
"

24 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

26 #ià
defšed
 (
__lšux__
)

32 
	~<š‰y³s.h
>

35 
	~<¡dšt.h
>

37 
	~<uni¡d.h
>

38 #iâdeà
UINTMAX_MAX


39 
	#UINTMAX_MAX
 ((
uštmax_t
è-1)

	)

42 
	~<sys/ty³s.h
>

43 
	~<sys/¡©.h
>

45 
	~<š‰y³s.h
>

46 
	~<¡dboŞ.h
>

48 
	~<lim™s.h
>

51 
	~<sys/·¿m.h
>

55 
	~<sys/mouÁ.h
>

59 
	~<sys/vfs.h
>

70 
	~<fú.h
>

73 
	~<sys/¡©fs.h
>

81 
	~<sys/¡©vfs.h
>

84 
	~<¡dio.h
>

85 
	~<¡ršg.h
>

100 
	#PROPAGATE_ALL_ONES
(
x
è(x)

	)

103 
	#EXTRACT_TOP_BIT
(
x
) ((x) \

104 & ((
uštmax_t
è1 << ( (
x
è* 
CHAR_BIT
 - 1)))

	)

113 
	#PROPAGATE_TOP_BIT
(
x
è((xè| ~ (
	`EXTRACT_TOP_BIT
 (xè- 1))

	)

123 
	$g‘_fs_u§ge
 (cÚ¡ *
fe
, 
fs_u§ge
 *
f¥
)

125 #ià
	`defšed
(
_WIN32
)

127 #–ià
	`defšed
(
__lšux__
)

128 
¡©fs
 
fsd
;

130 ià(
	`¡©fs
 (
fe
, &
fsd
) < 0)

139 
f¥
->
fsu_blocksize
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_bsize
);

144 
f¥
->
fsu_blocks
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_blocks
);

145 
f¥
->
fsu_bä“
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_bä“
);

146 
f¥
->
fsu_bava
 = 
	`PROPAGATE_TOP_BIT
 (
fsd
.
f_bava
);

147 
f¥
->
fsu_bava_tİ_b™_£t
 = 
	`EXTRACT_TOP_BIT
 (
fsd
.
f_bava
) != 0;

148 
f¥
->
fsu_fes
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_fes
);

149 
f¥
->
fsu_fä“
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_fä“
);

157 
	}
}

159 
DLL_PUBLIC
 
ušt32_t
 
	gSYSUTILS_SPACE
::
	$G‘F»eDiskS·û
(cÚ¡ 
¡d
::
¡ršg
& 
dœ
)

161 
fs_u§ge
 
fsu
;

163 ià(
	`g‘_fs_u§ge
(
dœ
.
	`c_¡r
(), &
fsu
) == 0)

165 ià(
fsu
.
fsu_blocksize
 >ğ1024 && fsu.
fsu_bava
 >= 1024)

167  (
fsu
.
fsu_bava
 / ()1024è* (fsu.
fsu_blocksize
/()1024);

169 ià(
fsu
.
fsu_blocksize
 >= 1024)

171  (
fsu
.
fsu_bava
 * (fsu.
fsu_blocksize
/()1024)) / ()1024;

173 ià(
fsu
.
fsu_bava
 >= 1024)

175  ((
fsu
.
fsu_bava
 / ()1024è* fsu.
fsu_blocksize
) / ()1024;

179  (
fsu
.
fsu_bava
 * fsu.
fsu_blocksize
) / ()1048576;

193 
	}
}

195 
DLL_PUBLIC
 
ušt32_t
 
	gSYSUTILS_SPACE
::
	$G‘FuÎDiskS·û
(cÚ¡ 
¡d
::
¡ršg
& 
dœ
)

197 
fs_u§ge
 
fsu
;

199 ià(
	`g‘_fs_u§ge
(
dœ
.
	`c_¡r
(), &
fsu
) == 0)

201 ià(
fsu
.
fsu_blocksize
 >ğ1024 && fsu.
fsu_blocks
 >= 1024)

203  (
fsu
.
fsu_blocks
 / ()1024è* (fsu.
fsu_blocksize
 / ()1024);

205 ià(
fsu
.
fsu_blocksize
 >= 1024)

207  (
fsu
.
fsu_blocks
 * (fsu.
fsu_blocksize
 / ()1024)) / ()1024;

209 ià(
fsu
.
fsu_blocks
 >= 1024)

211  ((
fsu
.
fsu_blocks
 / ()1024è* fsu.
fsu_blocksize
) / ()1024;

215  (
fsu
.
fsu_blocks
 * fsu.
fsu_blocksize
) / ()1048576;

229 
	}
}

231 
DLL_PUBLIC
 
ušt32_t
 
	gSYSUTILS_SPACE
::
	$G‘DiskS·ûStus
(cÚ¡ 
¡d
::
¡ršg
& 
dœ
, 
ušt32_t
* 
ä“
, ušt32_t* 
tÙ®
)

233 
fs_u§ge
 
fsu
;

234 
ä“S·û
;

235 
tÙ®S·û
;

237 ià(
dœ
.
	`em±y
(è|| 
NULL
 =ğ
ä“
 || NULL =ğ
tÙ®
)

242 ià(
	`g‘_fs_u§ge
(
dœ
.
	`c_¡r
(), &
fsu
) == 0)

244 
ä“S·û
 = 0;

245 
tÙ®S·û
 = 0;

247 ià(
fsu
.
fsu_blocksize
 >ğ1024 && fsu.
fsu_blocks
 >= 1024)

249 
tÙ®S·û
 = (
fsu
.
fsu_blocks
 / ()1024è* (fsu.
fsu_blocksize
 / ()1024);

251 ià(
fsu
.
fsu_blocksize
 >= 1024)

253 
tÙ®S·û
 = (
fsu
.
fsu_blocks
 * (fsu.
fsu_blocksize
 / ()1024)) / ()1024;

255 ià(
fsu
.
fsu_blocks
 >= 1024)

257 
tÙ®S·û
 = ((
fsu
.
fsu_blocks
 / ()1024è* fsu.
fsu_blocksize
) / ()1024;

261 
tÙ®S·û
 = (
fsu
.
fsu_blocks
 * fsu.
fsu_blocksize
) / ()1048576;

264 ià(
fsu
.
fsu_blocksize
 >ğ1024 && fsu.
fsu_bava
 >=1024)

266 
ä“S·û
 = (
fsu
.
fsu_bava
 / ()1024è* (fsu.
fsu_blocksize
/()1024);

268 ià(
fsu
.
fsu_blocksize
 >= 1024)

270 
ä“S·û
 = (
fsu
.
fsu_bava
 * (fsu.
fsu_blocksize
/()1024)) / ()1024;

272 ià(
fsu
.
fsu_bava
 >= 1024)

274 
ä“S·û
 = ((
fsu
.
fsu_bava
 / ()1024è* fsu.
fsu_blocksize
) / ()1024;

278 
ä“S·û
 = (
fsu
.
fsu_bava
 * fsu.
fsu_blocksize
) / ()1048576;

297 *
ä“
 = 
ä“S·û
;

298 *
tÙ®
 = 
tÙ®S·û
;

303 
	}
}

	@../common/fsusage.h

22 #iâdeà
__SYSUTILS_FSUSAGE_H__


23 
	#__SYSUTILS_FSUSAGE_H__


	)

25 
	~"expÜts.h
"

27 
	~"commÚ/¡dšt.h
"

29 
	~<¡ršg
>

31 
	sfs_u§ge


33 
ušt32_t
 
	mfsu_blocksize
;

34 
ušt32_t
 
	mfsu_blocks
;

35 
ušt32_t
 
	mfsu_bä“
;

36 
ušt32_t
 
	mfsu_bava
;

37 
boŞ
 
	mfsu_bava_tİ_b™_£t
;

38 
ušt32_t
 
	mfsu_fes
;

39 
ušt32_t
 
	mfsu_fä“
;

42 
g‘_fs_u§ge
 (cÚ¡ *
fe
, 
fs_u§ge
 *
f¥
);

44 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

48 
DLL_PUBLIC
 
ušt32_t
 
G‘F»eDiskS·û
(cÚ¡ 
¡d
::
¡ršg
& 
fe
);

50 
DLL_PUBLIC
 
ušt32_t
 
G‘FuÎDiskS·û
(cÚ¡ 
¡d
::
¡ršg
& 
fe
);

52 
DLL_PUBLIC
 
ušt32_t
 
G‘DiskS·ûStus
(cÚ¡ 
¡d
::
¡ršg
& 
fe
, ušt32_t* 
ä“
, ušt32_t* 
tÙ®
);

	@../common/fsusage64.cpp

20 
	~"fsu§ge64.h
"

22 
	~"commÚ/¡ršg.h
"

24 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

26 #ià
defšed
 (
__lšux__
)

32 
	~<š‰y³s.h
>

35 
	~<¡dšt.h
>

37 
	~<uni¡d.h
>

38 #iâdeà
UINTMAX_MAX


39 
	#UINTMAX_MAX
 ((
uštmax_t
è-1)

	)

42 
	~<sys/ty³s.h
>

43 
	~<sys/¡©.h
>

45 
	~<š‰y³s.h
>

46 
	~<¡dboŞ.h
>

48 
	~<lim™s.h
>

51 
	~<sys/·¿m.h
>

55 
	~<sys/mouÁ.h
>

59 
	~<sys/vfs.h
>

70 
	~<fú.h
>

73 
	~<sys/¡©fs.h
>

81 
	~<sys/¡©vfs.h
>

84 
	~<¡dio.h
>

85 
	~<¡ršg.h
>

100 
	#PROPAGATE_ALL_ONES
(
x
è(x)

	)

103 
	#EXTRACT_TOP_BIT
(
x
) ((x) \

104 & ((
uštmax_t
è1 << ( (
x
è* 
CHAR_BIT
 - 1)))

	)

113 
	#PROPAGATE_TOP_BIT
(
x
è((xè| ~ (
	`EXTRACT_TOP_BIT
 (xè- 1))

	)

123 
	$g‘_fs_u§ge64
 (cÚ¡ *
fe
, 
fs_u§ge64
 *
f¥
)

125 #ià
	`defšed
(
_WIN32
)

127 #–ià
	`defšed
(
__lšux__
)

128 
¡©fs64
 
fsd
;

130 ià(
	`¡©fs64
 (
fe
, &
fsd
) < 0)

139 
f¥
->
fsu_blocksize
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_bsize
);

144 
f¥
->
fsu_blocks
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_blocks
);

145 
f¥
->
fsu_bä“
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_bä“
);

146 
f¥
->
fsu_bava
 = 
	`PROPAGATE_TOP_BIT
 (
fsd
.
f_bava
);

147 
f¥
->
fsu_bava_tİ_b™_£t
 = 
	`EXTRACT_TOP_BIT
 (
fsd
.
f_bava
) != 0;

148 
f¥
->
fsu_fes
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_fes
);

149 
f¥
->
fsu_fä“
 = 
	`PROPAGATE_ALL_ONES
 (
fsd
.
f_fä“
);

157 
	}
}

159 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$G‘F»eDiskS·û64
(cÚ¡ 
¡d
::
¡ršg
& 
dœ
)

161 
fs_u§ge64
 
fsu
;

163 ià(
	`g‘_fs_u§ge64
(
dœ
.
	`c_¡r
(), &
fsu
) == 0)

165 ià(
fsu
.
fsu_blocksize
 >ğ1024 && fsu.
fsu_bava
 >= 1024)

167  (
fsu
.
fsu_bava
 / (
ušt64_t
)1024è* (fsu.
fsu_blocksize
/(uint64_t)1024);

169 ià(
fsu
.
fsu_blocksize
 >= 1024)

171  (
fsu
.
fsu_bava
 * (fsu.
fsu_blocksize
/(
ušt64_t
)1024)) / (uint64_t)1024;

173 ià(
fsu
.
fsu_bava
 >= 1024)

175  ((
fsu
.
fsu_bava
 / (
ušt64_t
)1024è* fsu.
fsu_blocksize
) / (uint64_t)1024;

179  (
fsu
.
fsu_bava
 * fsu.
fsu_blocksize
è/ (
ušt64_t
)1048576;

193 
	}
}

195 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$G‘FuÎDiskS·û64
(cÚ¡ 
¡d
::
¡ršg
& 
dœ
)

197 
fs_u§ge64
 
fsu
;

199 ià(
	`g‘_fs_u§ge64
(
dœ
.
	`c_¡r
(), &
fsu
) == 0)

201 ià(
fsu
.
fsu_blocksize
 >ğ1024 && fsu.
fsu_blocks
 >= 1024)

203  (
fsu
.
fsu_blocks
 / (
ušt64_t
)1024è* (fsu.
fsu_blocksize
 / (uint64_t)1024);

205 ià(
fsu
.
fsu_blocksize
 >= 1024)

207  (
fsu
.
fsu_blocks
 * (fsu.
fsu_blocksize
 / (
ušt64_t
)1024)) / (uint64_t)1024;

209 ià(
fsu
.
fsu_blocks
 >= 1024)

211  ((
fsu
.
fsu_blocks
 / (
ušt64_t
)1024è* fsu.
fsu_blocksize
) / (uint64_t)1024;

215  (
fsu
.
fsu_blocks
 * fsu.
fsu_blocksize
è/ (
ušt64_t
)1048576;

229 
	}
}

231 
DLL_PUBLIC
 
ušt32_t
 
	gSYSUTILS_SPACE
::
	$G‘DiskS·ûStus64
(cÚ¡ 
¡d
::
¡ršg
& 
dœ
, 
ušt64_t
* 
ä“
, ušt64_t* 
tÙ®
)

233 
fs_u§ge64
 
fsu
;

234 
ušt64_t
 
ä“S·û
;

235 
ušt64_t
 
tÙ®S·û
;

237 ià(
dœ
.
	`em±y
(è|| 
NULL
 =ğ
ä“
 || NULL =ğ
tÙ®
)

242 ià(
	`g‘_fs_u§ge64
(
dœ
.
	`c_¡r
(), &
fsu
) == 0)

244 
ä“S·û
 = 0;

245 
tÙ®S·û
 = 0;

247 ià(
fsu
.
fsu_blocksize
 >ğ1024 && fsu.
fsu_blocks
 >= 1024)

249 
tÙ®S·û
 = (
fsu
.
fsu_blocks
 / (
ušt64_t
)1024è* (fsu.
fsu_blocksize
 / (uint64_t)1024);

251 ià(
fsu
.
fsu_blocksize
 >= 1024)

253 
tÙ®S·û
 = (
fsu
.
fsu_blocks
 * (fsu.
fsu_blocksize
 / (
ušt64_t
)1024)) / (uint64_t)1024;

255 ià(
fsu
.
fsu_blocks
 >= 1024)

257 
tÙ®S·û
 = ((
fsu
.
fsu_blocks
 / (
ušt64_t
)1024è* fsu.
fsu_blocksize
) / (uint64_t)1024;

261 
tÙ®S·û
 = (
fsu
.
fsu_blocks
 * fsu.
fsu_blocksize
è/ (
ušt64_t
)1048576;

264 ià(
fsu
.
fsu_blocksize
 >ğ1024 && fsu.
fsu_bava
 >=1024)

266 
ä“S·û
 = (
fsu
.
fsu_bava
 / (
ušt64_t
)1024è* (fsu.
fsu_blocksize
/(uint64_t)1024);

268 ià(
fsu
.
fsu_blocksize
 >= 1024)

270 
ä“S·û
 = (
fsu
.
fsu_bava
 * (fsu.
fsu_blocksize
/(
ušt64_t
)1024)) / (uint64_t)1024;

272 ià(
fsu
.
fsu_bava
 >= 1024)

274 
ä“S·û
 = ((
fsu
.
fsu_bava
 / (
ušt64_t
)1024è* fsu.
fsu_blocksize
) / (uint64_t)1024;

278 
ä“S·û
 = (
fsu
.
fsu_bava
 * fsu.
fsu_blocksize
è/ (
ušt64_t
)1048576;

297 *
ä“
 = 
ä“S·û
;

298 *
tÙ®
 = 
tÙ®S·û
;

303 
	}
}

	@../common/fsusage64.h

22 #iâdeà
__SYSUTILS_FSUSAGE64_H__


23 
	#__SYSUTILS_FSUSAGE64_H__


	)

25 
	~"expÜts.h
"

27 
	~"commÚ/¡dšt.h
"

29 
	~<¡ršg
>

31 
	sfs_u§ge64


33 
ušt64_t
 
	mfsu_blocksize
;

34 
ušt64_t
 
	mfsu_blocks
;

35 
ušt64_t
 
	mfsu_bä“
;

36 
ušt64_t
 
	mfsu_bava
;

37 
boŞ
 
	mfsu_bava_tİ_b™_£t
;

38 
ušt64_t
 
	mfsu_fes
;

39 
ušt64_t
 
	mfsu_fä“
;

42 
g‘_fs_u§ge64
 (cÚ¡ *
fe
, 
fs_u§ge64
 *
f¥
);

44 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

48 
DLL_PUBLIC
 
ušt64_t
 
G‘F»eDiskS·û64
(cÚ¡ 
¡d
::
¡ršg
& 
fe
);

50 
DLL_PUBLIC
 
ušt64_t
 
G‘FuÎDiskS·û64
(cÚ¡ 
¡d
::
¡ršg
& 
fe
);

52 
DLL_PUBLIC
 
ušt32_t
 
G‘DiskS·ûStus64
(cÚ¡ 
¡d
::
¡ršg
& 
fe
, 
ušt64_t
* 
ä“
, ušt64_t* 
tÙ®
);

	@../common/hardware.cpp

1 
	~"h¬dw¬e.h
"

2 
	~"sy¡em.h
"

3 
	~"¡ršg.h
"

4 
	~<memÜy.h
>

6 #ià
defšed
(
__lšux
)

7 
	~<¡dio.h
>

8 
	~<¡dlib.h
>

9 
	~<uni¡d.h
>

21 #ià
defšed
(
__i386__
è|| defšed(
_M_IX86
)

23 #ià
defšed
(
_MSC_VER
)

25 #ià
_MSC_VER
 < 1400

26 
	#ıuid
(
func
,
a
,
b
,
c
,
d
)\

29 
__asm
 {\

30 
__asm
 
mov
 
—x
, 
func
\

31 
__asm
 
ıuid
\

32 
__asm
 
mov
 
a
, 
—x
\

33 
__asm
 
mov
 
b
, 
ebx
\

34 
__asm
 
mov
 
c
, 
ecx
\

35 
__asm
 
mov
 
d
, 
edx
\

37 } 0)

	)

39 
	~<šŒš.h
>

40 
	#ıuid
(
func
,
a
,
b
,
c
,
d
)\

43 
CPUInfo
[4] = {0, 0, 0, 0};\

44 
	`__ıuid
(
CPUInfo
, 
func
);\

45 
a
 = 
CPUInfo
[0];\

46 
b
 = 
CPUInfo
[1];\

47 
c
 = 
CPUInfo
[2];\

48 
d
 = 
CPUInfo
[3];\

49 } 0)

	)

52 #–ià
defšed
(
__GNUC__
)

54 #ià
defšed
(
__PIC__
)

55 
	#ıuid
(
func
,
ax
,
bx
,
cx
,
dx
)\

58 
__asm__
 
	`__vŞ©e__
 (\

63 : "÷" (
ax
), "ô" (
bx
), "=c" (
cx
), "=d" (
dx
) \

64 : "a" (
func
) \

66 } 0)

	)

68 
	#ıuid
(
func
,
ax
,
bx
,
cx
,
dx
)\

71 
__asm__
 
	`__vŞ©e__
 ( \

73 : "÷" (
ax
), "=b" (
bx
), "=c" (
cx
), "=d" (
dx
) \

74 : "a" (
func
) \

76 } 0)

	)

81 #”rÜ 
UnsuµÜ‹d
 
comp”


86 #”rÜ 
UnsuµÜ‹d
 
¬ch™eùu»


90 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

93 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$G‘CPUSN
(
ušt32_t
 
¢
[3])

95 
¢
[0] = sn[1] = sn[2] = 0;

96 #ià
	`defšed
(
__i386__
è|| defšed(
_M_IX86
)

97 
ušt32_t
 
a
, 
b
, 
c
, 
d
;

98 
	`ıuid
(0, 
a
, 
b
, 
c
, 
d
);

99 
ušt32_t
 
max_ÿÎ_v®ue
 = 
a
;

100 ià(
max_ÿÎ_v®ue
 >= 1)

102 
	`ıuid
(1, 
a
, 
b
, 
c
, 
d
);

103 
ušt32_t
 
¡ªd¬d_ã©u»_æag
 = 
d
;

104 
¢
[0] = 
a
;

105 ià(
max_ÿÎ_v®ue
 >ğ3 && (
¡ªd¬d_ã©u»_æag
 & 0x00040000) != 0)

107 
	`ıuid
(3, 
a
, 
b
, 
c
, 
d
);

108 
¢
[1] = 
c
;

109 
¢
[2] = 
d
;

115  
Œue
;

116 
	}
}

126 #ià
defšed
(
_WIN32
)

128 #iâdeà
WIN32_LEAN_AND_MEAN


129 
	#WIN32_LEAN_AND_MEAN


131 
	~<Wšdows.h
>

	)

132 
	~<IphÍ­i.h
>

134 #–ià
defšed
(
__lšux__
)

136 
	~<sys/sock‘.h
>

137 
	~<sys/ioùl.h
>

138 
	~<Ãt/if.h
>

139 
	~<Ãtdb.h
>

140 
	~<içddrs.h
>

142 
	~<m­
>

149 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
G‘N‘wÜkAd­‹rs
(
¡d
::
veùÜ
<
N‘wÜkAd­‹rInfo
>& 
šfos
)

151 
šfos
.
ş—r
();

153 #ià
defšed
(
_WIN32
)

155 
	gulOutBufL’
 = (
IP_ADAPTER_INFO
);

156 
PIP_ADAPTER_INFO
 
	gpAd­‹rInfo
 = (
IP_ADAPTER_INFO
 *)
m®loc
(
ulOutBufL’
);

157 ià(
	gpAd­‹rInfo
 =ğ
NULL
è{  
çl£
; };

158 ià(
G‘Ad­‹rsInfo
(
pAd­‹rInfo
, &
ulOutBufL’
è=ğ
ERROR_BUFFER_OVERFLOW
)

160 
ä“
(
pAd­‹rInfo
);

161 
	gpAd­‹rInfo
 = (
IP_ADAPTER_INFO
 *)
m®loc
(
ulOutBufL’
);

162 ià(
	gpAd­‹rInfo
 =ğ
NULL
è{  
çl£
; };

164 ià(
G‘Ad­‹rsInfo
(
pAd­‹rInfo
, &
ulOutBufL’
è=ğ
NO_ERROR
)

166 
pAd­‹rInfo
 !ğ
NULL
)

168 
N‘wÜkAd­‹rInfo
 
šfo
;

169 
	gšfo
.
	gÇme
 = 
pAd­‹rInfo
->
Ad­‹rName
;

170 
memıy
(
šfo
.
mac
, 
pAd­‹rInfo
->
Add»ss
, 6);

171 
	gšfo
.
	g_v4
 = 
pAd­‹rInfo
->
IpAdd»ssLi¡
.
IpAdd»ss
.
SŒšg
;

172 
	gšfos
.
push_back
(
šfo
);

173 
	gpAd­‹rInfo
 = 
pAd­‹rInfo
->
Next
;

176 
ä“
(
pAd­‹rInfo
);

180 #–ià
defšed
(
__lšux__
)

182 
içddrs
 *
	giçddr
, *
	giç
;

183 
	gho¡
[
NI_MAXHOST
];

185 
	gsock
 = 
sock‘
(
PF_INET
, 
SOCK_DGRAM
, 
IPPROTO_IP
);

186 ià(
	gsock
 =ğ-1è{  
çl£
; };

188 ià(
g‘içddrs
(&
içddr
è=ğ-1è{ 
şo£
(
sock
);  
	gçl£
; };

190 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gN‘wÜkAd­‹rInfo
> 
	gad­‹rs
;

194 
	giç
 = 
içddr
; iç !ğ
NULL
; iç = 
iç
->
iç_Ãxt
)

196 ià(
iç
->
iç_addr
 =ğ
NULL
) { ; };

199 ià((
	giç
->
	giç_æags
 & 
	gIFF_LOOPBACK
) != 0) { ; };

201 ià((
	giç
->
	giç_æags
 & 
	gIFF_MASTER
) != 0) { ; };

203 ià((
	giç
->
	giç_æags
 & 
	gIFF_SLAVE
) != 0) { ; };

205 
iäeq
 
	giä
;

206 
mem£t
((*)&
iä
, 0, (ifr));

207 
¡ºıy
(
iä
.
iä_Çme
, 
iç
->
iç_Çme
, 
IFNAMSIZ
 - 1);

210 ià(
ioùl
(
sock
, 
SIOCGIFFLAGS
, &
iä
) < 0) { ; };

211 ià(
ioùl
(
sock
, 
SIOCGIFHWADDR
, &
iä
) < 0) { ; };

213 
	g¡d
::
¡ršg
 
Çme
 = 
iä
.
iä_Çme
;

214 
	gN‘wÜkAd­‹rInfo
 &
	gšfo
 = 
ad­‹rs
[
Çme
];

215 
	gšfo
.
	gÇme
 = 
Çme
;

216 
memıy
(
šfo
.
mac
, 
iä
.
iä_hwaddr
.
§_d©a
, 6);

218 ià(
	giç
->
	giç_addr
->
	g§_çmy
 =ğ
AF_INET


219 && 
g‘Çmešfo
(
iç
->
iç_addr
, (
sockaddr_š
), 
ho¡
, 
NI_MAXHOST
, 
NULL
, 0, 
NI_NUMERICHOST
) == 0)

221 
šfo
.
_v4
 = 
ho¡
;

224 ià(
	giç
->
	giç_addr
->
	g§_çmy
 =ğ
AF_INET6


225 && 
g‘Çmešfo
(
iç
->
iç_addr
, (
sockaddr_š6
), 
ho¡
, 
NI_MAXHOST
, 
NULL
, 0, 
NI_NUMERICHOST
) == 0)

227 
šfo
.
_v6
 = 
ho¡
;

231 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gN‘wÜkAd­‹rInfo
>::
™”©Ü
 
™
 = 
ad­‹rs
.
begš
(); 
	g™
 !ğad­‹rs.
’d
(); it++)

233 
	gšfos
.
push_back
(
™
->
£cÚd
);

236 
ä“içddrs
(
içddr
);

237 
şo£
(
sock
);

243  
	gŒue
;

246 #ià
defšed
(
_WIN32
)

248 #iâdeà
WIN32_LEAN_AND_MEAN


249 
	#WIN32_LEAN_AND_MEAN


251 
	~<Wšdows.h
>

	)

253 #–ià
defšed
(
__lšux
)

255 
	~<sys/¡©vfs.h
>

261 
	~"commÚ/fe.h
"

263 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$G‘DiskS·û
(cÚ¡ 
¡d
::
¡ršg
& 
·th
, 
ušt64_t
* 
avaabË
, ušt64_t* 
ä“
,

264 
ušt64_t
* 
tÙ®
)

266 ià(
avaabË
 !ğ
NULL
)

268 *
avaabË
 = 
	`UINT64_C
(0);

271 ià(
ä“
 !ğ
NULL
)

273 *
ä“
 = 
	`UINT64_C
(0);

276 ià(
tÙ®
 !ğ
NULL
)

278 *
tÙ®
 = 
	`UINT64_C
(0);

281 #ià
	`defšed
(
_WIN32
)

283 
ULARGE_INTEGER
 
F»eBy‹sAvaabË
;

284 
ULARGE_INTEGER
 
TÙ®Numb”OfBy‹s
;

285 
ULARGE_INTEGER
 
TÙ®Numb”OfF»eBy‹s
;

287 
BOOL
 
»s
 = 0;

288 ià(
	`CheckDœeùÜyExi¡
(
·th
))

290 
»s
 = 
	`G‘DiskF»eS·ûExA
(
·th
.
	`c_¡r
(), &
F»eBy‹sAvaabË
, &
TÙ®Numb”OfBy‹s
, &
TÙ®Numb”OfF»eBy‹s
);

294 
S¶™P©hD©a
 
d©a
;

295 ià(
	`S¶™P©h
(
·th
, 
d©a
))

297 
»s
 = 
	`G‘DiskF»eS·ûExA
(
d©a
.
·»Á_·th
.
	`c_¡r
(), &
F»eBy‹sAvaabË
, &
TÙ®Numb”OfBy‹s
,

298 &
TÙ®Numb”OfF»eBy‹s
);

302  
çl£
;

306 ià(
»s
 == 0)

308  
çl£
;

311 ià(
avaabË
 !ğ
NULL
)

313 *
avaabË
 = (
ušt64_t
)
F»eBy‹sAvaabË
.
QuadP¬t
;

316 ià(
ä“
 !ğ
NULL
)

318 *
ä“
 = (
ušt64_t
)
TÙ®Numb”OfF»eBy‹s
.
QuadP¬t
;

321 ià(
tÙ®
 !ğ
NULL
)

323 *
tÙ®
 = (
ušt64_t
)
TÙ®Numb”OfBy‹s
.
QuadP¬t
;

326 #–ià
	`defšed
(
__lšux
)

328 
¡©vfs
 
buf
;

330 
»s
 = 
	`¡©vfs
(
·th
.
	`c_¡r
(), &
buf
);

332 ià(
»s
 !ğ0 || 
buf
.
f_bsize
 =ğ0 || buf.
f_äsize
 == 0)

334  
çl£
;

337 ià(
avaabË
 !ğ
NULL
)

339 *
avaabË
 = (
ušt64_t
)
buf
.
f_bava
 * (ušt64_t)buf.
f_bsize
;

342 ià(
ä“
 !ğ
NULL
)

344 *
ä“
 = (
ušt64_t
)
buf
.
f_bä“
 * (ušt64_t)buf.
f_bsize
;

347 ià(
tÙ®
 !ğ
NULL
)

349 *
tÙ®
 = (
ušt64_t
)
buf
.
f_blocks
 * (ušt64_t)buf.
f_äsize
;

356 ià(
avaabË
 !ğ
NULL
)

358 *
avaabË
 /= 1048576;

360 ià(
ä“
 !ğ
NULL
)

362 *
ä“
 /= 1048576;

364 ià(
tÙ®
 !ğ
NULL
)

366 *
tÙ®
 /= 1048576;

369  
Œue
;

370 
	}
}

372 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$G‘N‘wÜkB™R©e
(cÚ¡ 
¡d
::
¡ršg
& 
·th
, cÚ¡ std::¡ršg& 
Çme
,

373 
ušt32_t
& 
u¶ßdB™R©e
, ušt32_t& 
dowÆßdB™R©e
)

375 
u¶ßdB™R©e
 = 
	`UINT32_C
(0);

376 
dowÆßdB™R©e
 = 
	`UINT32_C
(0);

378 #ià
	`defšed
(
__lšux
)

379 
FILE
* 
å
 = 
	`fİ’
(
·th
.
	`c_¡r
(), "rb");

380 ià(
NULL
 !ğ
å
)

382 
buf
[4096] = {0};

383 ià(
	`ä—d
(
buf
, 1, 4096, 
å
) > 0)

385 
ušt64_t
 
rBy‹s
 = 
	`UINT64_C
(0), 
rPack‘s
 = UINT64_C(0), 
rE¼s
 = UINT64_C(0), 
rDrİ
 = UINT64_C(0),

386 
rFifo
 = 
	`UINT64_C
(0), 
rF¿me
 = UINT64_C(0), 
rCom´es£d
 = UINT64_C(0), 
rMuÉiÿ¡
 = UINT64_C(0),

387 
tBy‹s
 = 
	`UINT64_C
(0);

389 * 
p
 = 
	`¡r¡r
(
buf
, 
Çme
.
	`c_¡r
());

390 
fÜm©
[] = "%llu %llu %llu %llu %llu %llu %llu %llu %llu";

391 
SÿnFÜm©
[64];

392 
	`¥rštf
(
SÿnFÜm©
, "%s%s", 
Çme
.
	`c_¡r
(), 
fÜm©
);

394 ià(
NULL
 !ğ
p
 && 9 =ğ
	`ssÿnf
Õ, 
SÿnFÜm©
, &
rBy‹s
, &
rPack‘s
,

395 &
rE¼s
, &
rDrİ
, &
rFifo
, &
rF¿me
, &
rCom´es£d
, &
rMuÉiÿ¡
, &
tBy‹s
))

397 
u¶ßdB™R©e
 = (
ušt32_t
)(
tBy‹s
/1024);

398 
dowÆßdB™R©e
 = (
ušt32_t
)(
rBy‹s
/1024);

399 
	`fşo£
(
å
);

400  
Œue
;

403 
	`fşo£
(
å
);

406  
çl£
;

408  
çl£
;

410 
	}
}

412 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$G‘Tem³¿tu»
(cÚ¡ * 
·th
, & 
‹m³¿tu»
)

414 
‹m³¿tu»
 = 0.0f;

416 #ià
	`defšed
(
__lšux
)

418 ià(
NULL
 !ğ
·th
 && 
	`CheckFeExi¡
(path))

420 
FILE
* 
å
 = 
	`fİ’
(
·th
, "r");

421 ià(
NULL
 !ğ
å
)

423 
št32_t
 
iTemp
 = 0;

424 ià(0 !ğ
	`fsÿnf
(
å
, "%d", &
iTemp
))

426 
‹m³¿tu»
 = ()
iTemp
/1000.0f;

427 
	`fşo£
(
å
);

428  
Œue
;

430 
	`fşo£
(
å
);

434  
çl£
;

436  
çl£
;

438 
	}
}

440 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$G‘FªS³ed
(cÚ¡ * 
·th
, 
ušt32_t
& 
çnS³ed
)

442 
çnS³ed
 = 
	`UINT32_C
(0);

444 #ià
	`defšed
(
__lšux
)

445 ià(
NULL
 !ğ
·th
 && 
	`CheckFeExi¡
(path))

447 
FILE
* 
å
 = 
	`fİ’
(
·th
, "r");

448 ià(
NULL
 !ğ
å
)

450 ià(0 !ğ
	`fsÿnf
(
å
, "%d", &
çnS³ed
))

452 
	`fşo£
(
å
);

453  
Œue
;

455 
	`fşo£
(
å
);

459  
çl£
;

461  
çl£
;

463 
	}
}

465 
DLL_PUBLIC
 
	gSYSUTILS_SPACE
::
G¿bCPUInfo
(
ušt64_t
 (&
ıuInfo
)[10])

467 
mem£t
(
ıuInfo
, 0, 10);

469 
	gbufãr
[128 + 1];

470 
FILE
* 
	g¡©
 = 
fİ’
("/proc/stat", "r");

471 ià(
	g¡©
 !ğ
NULL
)

473 
fg‘s
(
bufãr
, 128, 
¡©
))

475 ià(
¡r¡r
(
bufãr
, "cpu "))

477 
ssÿnf
(
bufãr
, "cpu %llu %llu %llu %llu %llu %llu %llu %llu %llu %llu",

478 &
ıuInfo
[0], &cpuInfo[1], &cpuInfo[2], &cpuInfo[3], &cpuInfo[4],

479 &
ıuInfo
[5], &cpuInfo[6], &cpuInfo[7], &cpuInfo[8], &cpuInfo[9]);

485 
fşo£
(
¡©
);

491 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$G‘CPULßdšg
(& 
ıuLßdšg
)

493 
ıuLßdšg
 = 0.0f;

495 #ià
	`defšed
(
__lšux
)

496 
ušt64_t
 
ıuInfo1
[10], 
ıuInfo2
[10];

498 
	`G¿bCPUInfo
(
ıuInfo1
);

499 
	`SË•MS
(500);

500 
	`G¿bCPUInfo
(
ıuInfo2
);

502 
ušt64_t
 
tÙ®Ov”P”iod
 = 0, 
wÜkOv”P”iod
 = 0;

503 
ušt32_t
 
i
 = 0; i < 10; i++)

505 ià(
i
 < 3)

507 
wÜkOv”P”iod
 +ğ(
ıuInfo2
[
i
] - 
ıuInfo1
[i]);

510 
tÙ®Ov”P”iod
 +ğ(
ıuInfo2
[
i
] - 
ıuInfo1
[i]);

513 ià(
wÜkOv”P”iod
 < 
tÙ®Ov”P”iod
)

515 
ıuLßdšg
 = ()
wÜkOv”P”iod
 / ()
tÙ®Ov”P”iod
 * 100;

519 
ıuLßdšg
 = 100;

522  
Œue
;

524  
çl£
;

526 
	}
}

	@../common/hardware.h

1 #iâdeà
__SYSUTILS_HARDWARE_H__


2 
	#__SYSUTILS_HARDWARE_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~<¡ršg
>

9 
	~<veùÜ
>

11 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 
DLL_PUBLIC
 
boŞ
 
G‘CPUSN
(
ušt32_t
 
¢
[3]);

18 
	g¡d
::
¡ršg
 
Çme
;

19 
ušt8_t
 
	gmac
[6];

20 
	g¡d
::
¡ršg
 
_v4
;

21 
	g¡d
::
¡ršg
 
_v6
;

22 } 
	tN‘wÜkAd­‹rInfo
;

25 
DLL_PUBLIC
 
boŞ
 
G‘N‘wÜkAd­‹rs
(
¡d
::
veùÜ
<
N‘wÜkAd­‹rInfo
>& 
šfos
);

28 
DLL_PUBLIC
 
boŞ
 
G‘DiskS·û
(cÚ¡ 
¡d
::
¡ršg
& 
·th
, 
ušt64_t
* 
avaabË
, ušt64_t* 
ä“
, ušt64_t* 
tÙ®
);

31 
DLL_PUBLIC
 
boŞ
 
G‘N‘wÜkB™R©e
(cÚ¡ 
¡d
::
¡ršg
& 
·th
, cÚ¡ std::¡ršg& 
Çme
, 
ušt32_t
& 
u¶ßdB™R©e
,

32 
ušt32_t
& 
dowÆßdB™R©e
);

35 
DLL_PUBLIC
 
boŞ
 
G‘Tem³¿tu»
(cÚ¡ * 
·th
, & 
‹m³¿tu»
);

38 
DLL_PUBLIC
 
boŞ
 
G‘FªS³ed
(cÚ¡ * 
·th
, 
ušt32_t
& 
çnS³ed
);

41 
DLL_PUBLIC
 
G¿bCPUInfo
(
ušt64_t
 (&
ıuInfo
)[10]);

42 
DLL_PUBLIC
 
boŞ
 
G‘CPULßdšg
(& 
ıuLßdšg
);

	@../common/inttypes.h

1 #iâdeà
__SYSUTILS_INTTYPES_H__


2 
	#__SYSUTILS_INTTYPES_H__


	)

4 #iâdeà
__STDC_FORMAT_MACROS


5 
	#__STDC_FORMAT_MACROS


	)

8 #ià
defšed
(
__GNUC__
)

9 
	~<š‰y³s.h
>

10 #–ià
defšed
(
_MSC_VER
)

11 
	~"msš‰y³s/š‰y³s.h
"

14 #”rÜ 
UnsuµÜ‹d
 
comp”


	@../common/mutex.cpp

1 
	~"mu‹x.h
"

3 
	~<as£¹.h
>

4 
	~<¡dio.h
>

5 
	~<”ºo.h
>

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
è|| defšed(
__CYGWIN32__
)

11 
DLL_PUBLIC
 
	gMu‹x
::
	$Mu‹x
()

13 
m_mu‹x
 = 
	`C»©eMu‹x
(
NULL
, 
FALSE
, NULL);

14 
	`as£¹
(
m_mu‹x
 !ğ
NULL
);

15 ià(
m_mu‹x
 =ğ
NULL
)

17 
	`³¼Ü
("CreateMutex()");

19 
	}
}

21 
DLL_PUBLIC
 
	gMu‹x
::~
	$Mu‹x
()

23 
BOOL
 
»t
 = 
	`Clo£HªdË
(
m_mu‹x
);

24 
	`as£¹
(
»t
 != 0);

25 ià(
»t
 == 0)

27 
	`³¼Ü
("CloseHandle");

29 
	}
}

31 
DLL_PUBLIC
 
	gMu‹x
::
	$Lock
()

33 
DWORD
 
»t
 = 
	`Wa™FÜSšgËObjeù
(
m_mu‹x
, 
INFINITE
);

34 
	`as£¹
(
»t
 =ğ
WAIT_OBJECT_0
);

35 ià(
»t
 !ğ
WAIT_OBJECT_0
)

37 
	`³¼Ü
("WaitForSingleObject()");

39 
	}
}

41 
DLL_PUBLIC
 
	gMu‹x
::
	$UÆock
()

43 
BOOL
 
»t
 = 
	`R–—£Mu‹x
(
m_mu‹x
);

44 
	`as£¹
(
»t
 != 0);

45 ià(
»t
 == 0)

47 
	`³¼Ü
("ReleaseMutex()");

49 
	}
}

51 
DLL_PUBLIC
 
boŞ
 
	gMu‹x
::
	$TryLock
()

53 
DWORD
 
»t
 = 
	`Wa™FÜSšgËObjeù
(
m_mu‹x
, 0);

54 
	`as£¹
(
»t
 =ğ
WAIT_OBJECT_0
 ||„‘ =ğ
WAIT_TIMEOUT
);

55 ià(
»t
 =ğ
WAIT_TIMEOUT
)

57  
çl£
;

59 ià(
»t
 !ğ
WAIT_OBJECT_0
)

61 
	`³¼Ü
("WaitForSingleObject()");

62  
çl£
;

64  
Œue
;

65 
	}
}

67 #–ià
defšed
(
__lšux__
)

69 
DLL_PUBLIC
 
	gMu‹x
::
	$Mu‹x
()

71 
»t
 = 0;

73 
±h»ad_mu‹x©Œ_t
 
©Œ
;

74 
»t
 = 
	`±h»ad_mu‹x©Œ_š™
(&
©Œ
);

75 
	`as£¹
(
»t
 == 0);

76 ià(
»t
 != 0)

78 
	`³¼Ü
("pthread_mutexattr_init()");

81 
»t
 = 
	`±h»ad_mu‹x©Œ_£‰y³
(&
©Œ
, 
PTHREAD_MUTEX_RECURSIVE
);

82 
	`as£¹
(
»t
 == 0);

83 ià(
»t
 != 0)

85 
	`³¼Ü
("pthread_mutexattr_settype()");

88 
»t
 = 
	`±h»ad_mu‹x_š™
(&
m_mu‹x
, &
©Œ
);

89 
	`as£¹
(
»t
 == 0);

90 ià(
»t
 != 0)

92 
	`³¼Ü
("pthread_mutex_init()");

95 
»t
 = 
	`±h»ad_mu‹x©Œ_de¡roy
(&
©Œ
);

96 
	`as£¹
(
»t
 == 0);

97 ià(
»t
 != 0)

99 
	`³¼Ü
("pthread_mutexattr_destroy()");

101 
	}
}

103 
DLL_PUBLIC
 
	gMu‹x
::~
	$Mu‹x
()

105 
»t
 = 
	`±h»ad_mu‹x_de¡roy
(&
m_mu‹x
);

106 
	`as£¹
(
»t
 == 0);

107 ià(
»t
 != 0)

109 
	`³¼Ü
("pthread_mutex_destroy()");

111 
	}
}

113 
DLL_PUBLIC
 
	gMu‹x
::
	$Lock
()

115 
»t
 = 
	`±h»ad_mu‹x_lock
(&
m_mu‹x
);

116 
	`as£¹
(
»t
 == 0);

117 ià(
»t
 != 0)

119 
	`³¼Ü
("pthread_mutex_lock()");

121 
	}
}

123 
DLL_PUBLIC
 
	gMu‹x
::
	$UÆock
()

125 
»t
 = 
	`±h»ad_mu‹x_uÆock
(&
m_mu‹x
);

126 
	`as£¹
(
»t
 == 0);

127 ià(
»t
 != 0)

129 
	`³¼Ü
("pthread_mutex_unlock()");

131 
	}
}

133 
DLL_PUBLIC
 
boŞ
 
	gMu‹x
::
	$TryLock
()

135 
»t
 = 
	`±h»ad_mu‹x_Œylock
(&
m_mu‹x
);

136 ià(
»t
 == 0)

138  
Œue
;

140 ià(
»t
 =ğ
EBUSY
)

142  
çl£
;

146 
	`³¼Ü
("pthread_mutex_trylock()");

147  
çl£
;

149 
	}
}

152 #”rÜ 
Unknown
 
¶©fÜm
.

155 
DLL_PUBLIC
 
	gMu‹xLock
::
	$Mu‹xLock
(
Mu‹x
 *
mu‹x
)

156 : 
	$m_mu‹x
(
mu‹x
)

158 ià(
m_mu‹x
 !ğ
NULL
)

160 
m_mu‹x
->
	`Lock
();

162 
	}
}

164 
DLL_PUBLIC
 
	gMu‹xLock
::~
	$Mu‹xLock
()

166 ià(
m_mu‹x
 !ğ
NULL
)

168 
m_mu‹x
->
	`UÆock
();

170 
	}
}

	@../common/mutex.h

1 #iâdeà
__SYSUTILS_MUTEX_H__


2 
	#__SYSUTILS_MUTEX_H__


	)

4 
	~"expÜts.h
"

6 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
è|| defšed(
__CYGWIN32__
)

7 #iâdeà
WIN32_LEAN_AND_MEAN


8 
	#WIN32_LEAN_AND_MEAN


13 #iâdeà
_WIN32_WINNT


	)

14 
	#_WIN32_WINNT
 0x0400

	)

16 
	~<wšdows.h
>

17 
HANDLE
 
	tMu‹xTy³
;

18 #–ià
defšed
(
__lšux__
)

19 
	~<±h»ad.h
>

20 
±h»ad_mu‹x_t
 
	tMu‹xTy³
;

22 #”rÜ 
Unknown
 
¶©fÜm
.

25 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

27 şas 
	cDLL_PUBLIC
 
	gMu‹x


29 
	gpublic
:

30 
Mu‹x
();

31 ~
Mu‹x
();

32 
Lock
();

33 
UÆock
();

34 
boŞ
 
TryLock
();

36 
	g´iv©e
:

37 
Mu‹xTy³
 
m_mu‹x
;

39 
	g´iv©e
:

40 
Mu‹x
(cÚ¡ Mu‹x &
rhs
);

41 cÚ¡ 
	gMu‹x
 &
	gİ”©Ü
=(cÚ¡ 
Mu‹x
 &
rhs
);

44 şas 
	cDLL_PUBLIC
 
	gMu‹xLock


46 
	gpublic
:

47 
ex¶ic™
 
Mu‹xLock
(
Mu‹x
 *
mu‹x
);

48 ~
Mu‹xLock
();

50 
	g´iv©e
:

51 
Mu‹x
 *
m_mu‹x
;

53 
	g´iv©e
:

54 
Mu‹xLock
(cÚ¡ Mu‹xLock &
rhs
);

55 cÚ¡ 
	gMu‹xLock
 &
	gİ”©Ü
=(cÚ¡ 
Mu‹xLock
 &
rhs
);

	@../common/nusyslog.cpp

1 
	~"nusy¦og.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
DLL_PUBLIC
 
	gSYSUTILS_SPACE
::
	$Wr™eHWLog
(
iFac™y
, 
iPri
, cÚ¡ * 
Ïb–
, cÚ¡ *
fmt
, ...)

7 #ifdeà
__lšux__


8 
va_li¡
 
¬gs
;

10 
	`va_¡¬t
(
¬gs
, 
fmt
);

11 
	`İ’log
(
Ïb–
, 0, 
iFac™y
);

12 
	`vsy¦og
(
iPri
, 
fmt
, 
¬gs
);

13 
	`va_’d
(
¬gs
);

14 
	`şo£log
();

16 
	}
}

	@../common/nusyslog.h

1 #iâdeà
__NU_SYSLOG_H__


2 
	#__NU_SYSLOG_H__


	)

4 
	~"expÜts.h
"

6 
	~<¡d¬g.h
>

7 
	~<sy¦og.h
>

9 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

11 
DLL_PUBLIC
 
Wr™eHWLog
(
iFac™y
, 
iPri
, cÚ¡ * 
Ïb–
, cÚ¡ *
fmt
, ...);

	@../common/observer.cpp

1 
	~"ob£rv”.h
"

3 
	~<as£¹.h
>

5 
	~"commÚ/ut™y.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
DLL_PUBLIC
 
	gOb£rv”
::
	$Ob£rv”
()

11 
	}
}

13 
DLL_PUBLIC
 
Ob£rv”
::~
	$Ob£rv”
()

15 
	}
}

17 
Subjeù
::
F‹r
::
	$F‹r
()

18 : 
	`ob£rv”
(
NULL
)

19 , 
	$f‹r
(0xFFFFFFFF)

21 
	}
}

23 
	gSubjeù
::
F‹r
::
	$F‹r
(
Ob£rv”
 *
o
, 
ušt32_t
 
f
)

24 : 
	`ob£rv”
(
o
)

25 , 
	$f‹r
(
f
)

27 
	}
}

29 
	gSubjeù
::
F‹r
::
	$F‹r
(cÚ¡ 
Subjeù
::
F‹r
 &
rhs
)

30 : 
	`ob£rv”
(
rhs
.
ob£rv”
)

31 , 
	$f‹r
(
rhs
.
f‹r
)

33 
	}
}

35 
	gSubjeù
::
F‹r
 &
Subjeù
::F‹r::
İ”©Ü
=(cÚ¡ Subjeù::F‹¸&
rhs
)

37 ià(
this
 !ğ&
rhs
)

39 
ob£rv”
 = 
rhs
.observer;

40 
	gf‹r
 = 
rhs
.
f‹r
;

42  *
	gthis
;

45 
DLL_PUBLIC
 
	gSubjeù
::
	$Subjeù
()

46 : 
	`m_cs_f‹rs
()

47 , 
	$m_f‹rs
()

49 
	}
}

51 
DLL_PUBLIC
 
	gSubjeù
::~
	$Subjeù
()

53 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_f‹rs
);

54 
m_f‹rs
.
	`ş—r
();

55 
	}
}

57 
DLL_PUBLIC
 
boŞ
 
	gSubjeù
::
	$A‰achOb£rv”
(
Ob£rv”
 *
ob£rv”
, 
ušt32_t
 
f‹r
 )

59 
	`IF_NULL_RETURN_VALUE
(
ob£rv”
, 
çl£
);

61 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_f‹rs
);

62 
F‹r
 
	`nÙifiÿtiÚ_f‹r
(
ob£rv”
, 
f‹r
);

63 
m_f‹rs
.
	`push_back
(
nÙifiÿtiÚ_f‹r
);

65  
Œue
;

66 
	}
}

68 
DLL_PUBLIC
 
boŞ
 
	gSubjeù
::
	$D‘achOb£rv”
(
Ob£rv”
 *
ob£rv”
)

70 
	`IF_NULL_RETURN_VALUE
(
ob£rv”
, 
çl£
);

72 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_f‹rs
);

73 
¡d
::
li¡
<
F‹r
>::
™”©Ü
 
™
 = 
m_f‹rs
.
	`begš
();

74 
™
 !ğ
m_f‹rs
.
	`’d
())

76 ià((*
™
).
ob£rv”
 == observer)

78 
m_f‹rs
.
	`”a£
(
™
++);

82 
™
++;

86  
Œue
;

87 
	}
}

89 
DLL_PUBLIC
 
	gSubjeù
::
	$NÙifyOb£rv”
(
ušt32_t
 
nÙify
, *
·¿m
, ušt32_ˆ
f‹r
 )

91 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_f‹rs
);

92 
¡d
::
li¡
<
F‹r
>::
™”©Ü
 
™
 = 
m_f‹rs
.
	`begš
(); iˆ!ğm_f‹rs.
	`’d
(); it++)

94 ià(((*
™
).
f‹r
 & filter) != 0)

96 
	`as£¹
((*
™
).
ob£rv”
 !ğ
NULL
);

97 (*
™
).
ob£rv”
->
	`Upd©e
(
nÙify
, 
·¿m
, 
f‹r
);

100 
	}
}

	@../common/observer.h

1 #iâdeà
__SYSUTILS_OBSERVER_H__


2 
	#__SYSUTILS_OBSERVER_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

9 
	~<li¡
>

11 #ià
defšed
(
_WIN32
)

13 #´agm¨
w¬nšg
(
di§bË
: 4251)

16 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

18 şas 
	cDLL_PUBLIC
 
	gOb£rv”


20 
	gpublic
:

21 
Ob£rv”
();

22 
	gvœtu®
 ~
Ob£rv”
() = 0;

24 
vœtu®
 
Upd©e
(
ušt32_t
 
nÙify
, *
·¿m
, ušt32_ˆ
f‹r
) = 0;

26 
	g´iv©e
:

27 
Ob£rv”
(cÚ¡ Ob£rv” &
rhs
);

28 cÚ¡ 
	gOb£rv”
 &
	gİ”©Ü
=(cÚ¡ 
Ob£rv”
 &
rhs
);

31 şas 
	cDLL_PUBLIC
 
	gSubjeù


33 
	gpublic
:

34 
Subjeù
();

35 
	gvœtu®
 ~
Subjeù
();

37 
boŞ
 
A‰achOb£rv”
(
Ob£rv”
 *
ob£rv”
, 
ušt32_t
 
f‹r
=0xFFFFFFFF);

38 
boŞ
 
D‘achOb£rv”
(
Ob£rv”
 *
ob£rv”
);

39 
NÙifyOb£rv”
(
ušt32_t
 
nÙify
, *
·¿m
, ušt32_ˆ
f‹r
=0xFFFFFFFF);

41 
	g´iv©e
:

42 
Subjeù
(cÚ¡ Subjeù &
rhs
);

43 cÚ¡ 
	gSubjeù
 &
	gİ”©Ü
=(cÚ¡ 
Subjeù
 &
rhs
);

45 
	g´iv©e
:

46 
	sF‹r


48 
Ob£rv”
 *
ob£rv”
;

49 
ušt32_t
 
	gf‹r
;

51 
F‹r
();

52 
F‹r
(
Ob£rv”
 *
o
, 
ušt32_t
 
f
);

53 
F‹r
(cÚ¡ F‹¸&
rhs
);

54 
	gF‹r
 &
	gİ”©Ü
=(cÚ¡ 
F‹r
 &
rhs
);

57 
	g´iv©e
:

58 
Cr™iÿlSeùiÚ
 
m_cs_f‹rs
;

59 
	g¡d
::
li¡
<
F‹r
> 
m_f‹rs
;

	@../common/read_write_lock.cpp

1 
	~"»ad_wr™e_lock.h
"

3 
	~<as£¹.h
>

4 
	~<¡dio.h
>

5 
	~<”ºo.h
>

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
è|| defšed(
__CYGWIN32__
)

14 
	$VOID
 (
	tWINAPI
 *
	tAcquœeSRWLockExşusivePŒ
)(
	tPSRWLOCK
 
	tSRWLock
);

15 
	$VOID
 (
	tWINAPI
 *
	tAcquœeSRWLockSh¬edPŒ
)(
	tPSRWLOCK
 
	tSRWLock
);

16 
	$VOID
 (
	tWINAPI
 *
	tIn™ŸlizeSRWLockPŒ
)(
	tPSRWLOCK
 
	tSRWLock
);

17 
	$VOID
 (
	tWINAPI
 *
	tR–—£SRWLockExşusivePŒ
)(
	tPSRWLOCK
 
	tSRWLock
);

18 
	$VOID
 (
	tWINAPI
 *
	tR–—£SRWLockSh¬edPŒ
)(
	tPSRWLOCK
 
	tSRWLock
);

19 
	$BOOLEAN
 (
	tWINAPI
 *
	tTryAcquœeSRWLockExşusivePŒ
)(
	tPSRWLOCK
 
	tSRWLock
);

20 
	$BOOLEAN
 (
	tWINAPI
 *
	tTryAcquœeSRWLockSh¬edPŒ
)(
	tPSRWLOCK
 
	tSRWLock
);

22 
Çme¥aû
 {

23 şas 
	cDÎLßd”


25 
public
:

26 
	`DÎLßd”
(cÚ¡ *
dÎ_Çme
è{ 
m_moduË
 = 
	`LßdLib¿ryA
(dll_name); };

27 ~
	`DÎLßd”
(è{ ià(
m_moduË
 !ğ
NULL
è
	`F»eLib¿ry
(m_module); };

28 
FARPROC
 
	`G‘FunùiÚPoš‹r
(cÚ¡ *
funùiÚ_Çme
è{  
m_moduË
 !ğ
NULL
 ? 
	`G‘ProcAdd»ss
(m_module, function_name) : NULL; };

29 
´iv©e
:

30 
	`DÎLßd”
();

31 
	`DÎLßd”
(cÚ¡ 
DÎLßd”
 &
rhs
);

32 
DÎLßd”
 &
İ”©Ü
=(cÚ¡ DÎLßd” &
rhs
);

33 
´iv©e
:

34 
HMODULE
 
m_moduË
;

35 
	}
};

38 
DÎLßd”
 
s_k”Ãl32
("kernel32.dll");

39 
AcquœeSRWLockExşusivePŒ
 
	gpAcquœeSRWLockExşusive
 = (AcquœeSRWLockExşusivePŒ)
s_k”Ãl32
.
G‘FunùiÚPoš‹r
("AcquireSRWLockExclusive");

40 
AcquœeSRWLockSh¬edPŒ
 
	gpAcquœeSRWLockSh¬ed
 = (AcquœeSRWLockSh¬edPŒ)
s_k”Ãl32
.
G‘FunùiÚPoš‹r
("AcquireSRWLockShared");

41 
In™ŸlizeSRWLockPŒ
 
	gpIn™ŸlizeSRWLock
 = (In™ŸlizeSRWLockPŒ)
s_k”Ãl32
.
G‘FunùiÚPoš‹r
("InitializeSRWLock");

42 
R–—£SRWLockExşusivePŒ
 
	gpR–—£SRWLockExşusive
 = (R–—£SRWLockExşusivePŒ)
s_k”Ãl32
.
G‘FunùiÚPoš‹r
("ReleaseSRWLockExclusive");

43 
R–—£SRWLockSh¬edPŒ
 
	gpR–—£SRWLockSh¬ed
 = (R–—£SRWLockSh¬edPŒ)
s_k”Ãl32
.
G‘FunùiÚPoš‹r
("ReleaseSRWLockShared");

44 
TryAcquœeSRWLockExşusivePŒ
 
	gpTryAcquœeSRWLockExşusive
 = (TryAcquœeSRWLockExşusivePŒ)
s_k”Ãl32
.
G‘FunùiÚPoš‹r
("TryAcquireSRWLockExclusive");

45 
TryAcquœeSRWLockSh¬edPŒ
 
	gpTryAcquœeSRWLockSh¬ed
 = (TryAcquœeSRWLockSh¬edPŒ)
s_k”Ãl32
.
G‘FunùiÚPoš‹r
("TryAcquireSRWLockShared");

46 
boŞ
 
	$HasSRWLock
()

48 
boŞ
 
s_has_¤wlock
 =

49 (
pAcquœeSRWLockExşusive
 !ğ
NULL
) &&

50 (
pAcquœeSRWLockSh¬ed
 !ğ
NULL
) &&

51 (
pIn™ŸlizeSRWLock
 !ğ
NULL
) &&

52 (
pR–—£SRWLockExşusive
 !ğ
NULL
) &&

53 (
pR–—£SRWLockSh¬ed
 !ğ
NULL
) &&

54 (
pTryAcquœeSRWLockExşusive
 !ğ
NULL
) &&

55 (
pTryAcquœeSRWLockSh¬ed
 !ğ
NULL
);

56  
s_has_¤wlock
;

57 
	}
}

62 
	$rwlock_š™
(
PRW_LOCK
 
rwlock
)

64 
rwlock
->
»ad”CouÁ
 = 0;

66 
	`In™ŸlizeCr™iÿlSeùiÚ
(&
rwlock
->
»ad”CouÁLock
);

67 
	`In™ŸlizeCr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
);

75 
rwlock
->
noR—d”s
 = 
	`C»©eEv’t
(
NULL
, 
TRUE
, TRUE, NULL);

76 
	}
}

78 
	$rwlock_de¡roy
(
PRW_LOCK
 
rwlock
)

80 
	`Wa™FÜSšgËObjeù
(
rwlock
->
noR—d”s
, 
INFINITE
);

81 
	`Clo£HªdË
(
rwlock
->
noR—d”s
);

82 
	`D–‘eCr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
);

83 
	`D–‘eCr™iÿlSeùiÚ
(&
rwlock
->
»ad”CouÁLock
);

84 
	}
}

86 
	$rwlock_rdlock
(
PRW_LOCK
 
rwlock
)

93 
	`EÁ”Cr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
);

94 
	`EÁ”Cr™iÿlSeùiÚ
(&
rwlock
->
»ad”CouÁLock
);

95 ià(++
rwlock
->
»ad”CouÁ
 == 1) {

96 
	`Re£tEv’t
(
rwlock
->
noR—d”s
);

98 
	`L—veCr™iÿlSeùiÚ
(&
rwlock
->
»ad”CouÁLock
);

99 
	`L—veCr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
);

100 
	}
}

102 
	$rwlock_rduÆock
(
PRW_LOCK
 
rwlock
)

104 
	`EÁ”Cr™iÿlSeùiÚ
(&
rwlock
->
»ad”CouÁLock
);

105 ià(--
rwlock
->
»ad”CouÁ
 == 0) {

106 
	`S‘Ev’t
(
rwlock
->
noR—d”s
);

108 
	`L—veCr™iÿlSeùiÚ
(&
rwlock
->
»ad”CouÁLock
);

109 
	}
}

111 
boŞ
 
	$rwlock_Œyrdlock
(
PRW_LOCK
 
rwlock
)

113 ià(
	`TryEÁ”Cr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
) == 0)

115  
çl£
;

118 
	`EÁ”Cr™iÿlSeùiÚ
(&
rwlock
->
»ad”CouÁLock
);

119 ià(++
rwlock
->
»ad”CouÁ
 == 1) {

120 
	`Re£tEv’t
(
rwlock
->
noR—d”s
);

122 
	`L—veCr™iÿlSeùiÚ
(&
rwlock
->
»ad”CouÁLock
);

123 
	`L—veCr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
);

125  
Œue
;

126 
	}
}

128 
	$rwlock_w¾ock
(
PRW_LOCK
 
rwlock
)

130 
	`EÁ”Cr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
);

131 
	`Wa™FÜSšgËObjeù
(
rwlock
->
noR—d”s
, 
INFINITE
);

134 
	}
}

136 
	$rwlock_wruÆock
(
PRW_LOCK
 
rwlock
)

138 
	`L—veCr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
);

139 
	}
}

141 
boŞ
 
	$rwlock_Œyw¾ock
(
PRW_LOCK
 
rwlock
)

143 ià(
	`TryEÁ”Cr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
) == 0)

145  
çl£
;

148 ià(
	`Wa™FÜSšgËObjeù
(
rwlock
->
noR—d”s
, 0è!ğ
WAIT_OBJECT_0
)

150 
	`L—veCr™iÿlSeùiÚ
(&
rwlock
->
wr™”Lock
);

151  
çl£
;

154  
Œue
;

155 
	}
}

157 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$R—dWr™eLock
()

159 ià(
	`HasSRWLock
())

161 
	`pIn™ŸlizeSRWLock
(&
m_¦im_»ad_wr™e_lock
);

165 
	`rwlock_š™
(&
m_»ad_wr™e_lock
);

167 
	}
}

169 
DLL_PUBLIC
 
	gR—dWr™eLock
::~
	$R—dWr™eLock
()

171 ià(
	`HasSRWLock
())

176 
	`rwlock_de¡roy
(&
m_»ad_wr™e_lock
);

178 
	}
}

180 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$LockR—d
()

182 ià(
	`HasSRWLock
())

184 
	`pAcquœeSRWLockSh¬ed
(&
m_¦im_»ad_wr™e_lock
);

188 
	`rwlock_rdlock
(&
m_»ad_wr™e_lock
);

190 
	}
}

192 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$UÆockR—d
()

194 ià(
	`HasSRWLock
())

196 
	`pR–—£SRWLockSh¬ed
(&
m_¦im_»ad_wr™e_lock
);

200 
	`rwlock_rduÆock
(&
m_»ad_wr™e_lock
);

202 
	}
}

204 
DLL_PUBLIC
 
boŞ
 
	gR—dWr™eLock
::
	$TryLockR—d
()

206 ià(
	`HasSRWLock
())

208  
	`pTryAcquœeSRWLockSh¬ed
(&
m_¦im_»ad_wr™e_lock
) != 0;

212  
	`rwlock_Œyrdlock
(&
m_»ad_wr™e_lock
);

214 
	}
}

216 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$LockWr™e
()

218 ià(
	`HasSRWLock
())

220 
	`pAcquœeSRWLockExşusive
(&
m_¦im_»ad_wr™e_lock
);

224 
	`rwlock_w¾ock
(&
m_»ad_wr™e_lock
);

226 
	}
}

228 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$UÆockWr™e
()

230 ià(
	`HasSRWLock
())

232 
	`pR–—£SRWLockExşusive
(&
m_¦im_»ad_wr™e_lock
);

236 
	`rwlock_wruÆock
(&
m_»ad_wr™e_lock
);

238 
	}
}

240 
DLL_PUBLIC
 
boŞ
 
	gR—dWr™eLock
::
	$TryLockWr™e
()

242 ià(
	`HasSRWLock
())

244  
	`pTryAcquœeSRWLockExşusive
(&
m_¦im_»ad_wr™e_lock
) != 0;

248  
	`rwlock_Œyw¾ock
(&
m_»ad_wr™e_lock
);

250 
	}
}

252 #–ià
defšed
(
__lšux__
)

254 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$R—dWr™eLock
()

256 
»t
 = 0;

258 
±h»ad_rwlock©Œ_t
 
©Œ
;

259 
»t
 = 
	`±h»ad_rwlock©Œ_š™
(&
©Œ
);

260 
	`as£¹
(
»t
 == 0);

261 ià(
»t
 != 0)

263 
	`³¼Ü
("pthread_rwlockattr_init()");

266 
»t
 = 
	`±h»ad_rwlock©Œ_£sh¬ed
(&
©Œ
, 
PTHREAD_PROCESS_PRIVATE
);

267 
	`as£¹
(
»t
 == 0);

268 ià(
»t
 != 0)

270 
	`³¼Ü
("pthread_rwlockattr_setpshared()");

273 
»t
 = 
	`±h»ad_rwlock_š™
(&
m_»ad_wr™e_lock
, &
©Œ
);

274 
	`as£¹
(
»t
 == 0);

275 ià(
»t
 != 0)

277 
	`³¼Ü
("pthread_rwlock_init()");

280 
»t
 = 
	`±h»ad_rwlock©Œ_de¡roy
(&
©Œ
);

281 
	`as£¹
(
»t
 == 0);

282 ià(
»t
 != 0)

284 
	`³¼Ü
("pthread_rwlockattr_destroy()");

286 
	}
}

288 
DLL_PUBLIC
 
	gR—dWr™eLock
::~
	$R—dWr™eLock
()

290 
»t
 = 
	`±h»ad_rwlock_de¡roy
(&
m_»ad_wr™e_lock
);

291 
	`as£¹
(
»t
 == 0);

292 ià(
»t
 != 0)

294 
	`³¼Ü
("pthread_rwlock_destroy()");

296 
	}
}

298 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$LockR—d
()

300 
»t
 = 
	`±h»ad_rwlock_rdlock
(&
m_»ad_wr™e_lock
);

301 
	`as£¹
(
»t
 == 0);

302 ià(
»t
 != 0)

304 
	`³¼Ü
("pthread_rwlock_rdlock()");

306 
	}
}

308 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$UÆockR—d
()

310 
»t
 = 
	`±h»ad_rwlock_uÆock
(&
m_»ad_wr™e_lock
);

311 
	`as£¹
(
»t
 == 0);

312 ià(
»t
 != 0)

314 
	`³¼Ü
("pthread_rwlock_unlock()");

316 
	}
}

318 
DLL_PUBLIC
 
boŞ
 
	gR—dWr™eLock
::
	$TryLockR—d
()

320 
»t
 = 
	`±h»ad_rwlock_Œyrdlock
(&
m_»ad_wr™e_lock
);

321 ià(
»t
 == 0)

323  
Œue
;

325 ià(
»t
 =ğ
EBUSY
)

327  
çl£
;

331 
	`³¼Ü
("pthread_rwlock_tryrdlock()");

332  
çl£
;

334 
	}
}

336 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$LockWr™e
()

338 
»t
 = 
	`±h»ad_rwlock_w¾ock
(&
m_»ad_wr™e_lock
);

339 
	`as£¹
(
»t
 == 0);

340 ià(
»t
 != 0)

342 
	`³¼Ü
("pthread_rwlock_wrlock()");

344 
	}
}

346 
DLL_PUBLIC
 
	gR—dWr™eLock
::
	$UÆockWr™e
()

348 
»t
 = 
	`±h»ad_rwlock_uÆock
(&
m_»ad_wr™e_lock
);

349 
	`as£¹
(
»t
 == 0);

350 ià(
»t
 != 0)

352 
	`³¼Ü
("pthread_rwlock_unlock()");

354 
	}
}

356 
DLL_PUBLIC
 
boŞ
 
	gR—dWr™eLock
::
	$TryLockWr™e
()

358 
»t
 = 
	`±h»ad_rwlock_Œyw¾ock
(&
m_»ad_wr™e_lock
);

359 ià(
»t
 == 0)

361  
Œue
;

363 ià(
»t
 =ğ
EBUSY
)

365  
çl£
;

369 
	`³¼Ü
("pthread_rwlock_trywrlock()");

370  
çl£
;

372 
	}
}

375 #”rÜ 
Unknown
 
¶©fÜm
.

378 
DLL_PUBLIC
 
	gR—d”Lock
::
	$R—d”Lock
(
R—dWr™eLock
 *
»ad_wr™e_lock
)

379 : 
	$m_»ad_wr™e_lock
(
»ad_wr™e_lock
)

381 ià(
m_»ad_wr™e_lock
 !ğ
NULL
)

383 
m_»ad_wr™e_lock
->
	`LockR—d
();

385 
	}
}

387 
DLL_PUBLIC
 
	gR—d”Lock
::~
	$R—d”Lock
()

389 ià(
m_»ad_wr™e_lock
 !ğ
NULL
)

391 
m_»ad_wr™e_lock
->
	`UÆockR—d
();

393 
	}
}

395 
DLL_PUBLIC
 
	gWr™”Lock
::
	$Wr™”Lock
(
R—dWr™eLock
 *
»ad_wr™e_lock
)

396 : 
	$m_»ad_wr™e_lock
(
»ad_wr™e_lock
)

398 ià(
m_»ad_wr™e_lock
 !ğ
NULL
)

400 
m_»ad_wr™e_lock
->
	`LockWr™e
();

402 
	}
}

404 
DLL_PUBLIC
 
	gWr™”Lock
::~
	$Wr™”Lock
()

406 ià(
m_»ad_wr™e_lock
 !ğ
NULL
)

408 
m_»ad_wr™e_lock
->
	`UÆockWr™e
();

410 
	}
}

	@../common/read_write_lock.h

1 #iâdeà
__SYSUTILS_READ_WRITE_LOCK_H__


2 
	#__SYSUTILS_READ_WRITE_LOCK_H__


	)

5 
	~"expÜts.h
"

7 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
è|| defšed(
__CYGWIN32__
)

8 #iâdeà
WIN32_LEAN_AND_MEAN


9 
	#WIN32_LEAN_AND_MEAN


14 #iâdeà
_WIN32_WINNT


	)

15 
	#_WIN32_WINNT
 0x0400

	)

17 
	~<wšdows.h
>

19 
SRWLOCK
 
	tSlimR—dWr™eLockTy³
;

25 
	s_RW_LOCK
 {

26 
CRITICAL_SECTION
 
	m»ad”CouÁLock
;

27 
CRITICAL_SECTION
 
	mwr™”Lock
;

28 
HANDLE
 
	mnoR—d”s
;

29 
	m»ad”CouÁ
;

30 } 
	tRW_LOCK
, *
	tPRW_LOCK
;

31 
RW_LOCK
 
	tR—dWr™eLockTy³
;

32 #–ià
defšed
(
__lšux__
)

33 
	~<±h»ad.h
>

34 
±h»ad_rwlock_t
 
	tR—dWr™eLockTy³
;

36 #”rÜ 
Unknown
 
¶©fÜm
.

39 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

41 şas 
	cDLL_PUBLIC
 
	gR—dWr™eLock


43 
	gpublic
:

44 
R—dWr™eLock
();

45 ~
R—dWr™eLock
();

46 
LockR—d
();

47 
UÆockR—d
();

48 
boŞ
 
TryLockR—d
();

49 
LockWr™e
();

50 
UÆockWr™e
();

51 
boŞ
 
TryLockWr™e
();

53 
	g´iv©e
:

54 #ià
defšed
(
_WIN32
)

55 
SlimR—dWr™eLockTy³
 
m_¦im_»ad_wr™e_lock
;

57 
R—dWr™eLockTy³
 
	gm_»ad_wr™e_lock
;

59 
	g´iv©e
:

60 
R—dWr™eLock
(cÚ¡ R—dWr™eLock &
rhs
);

61 cÚ¡ 
	gR—dWr™eLock
 &
	gİ”©Ü
=(cÚ¡ 
R—dWr™eLock
 &
rhs
);

64 şas 
	cDLL_PUBLIC
 
	gR—d”Lock


66 
	gpublic
:

67 
ex¶ic™
 
R—d”Lock
(
R—dWr™eLock
 *
»ad_wr™e_lock
);

68 ~
R—d”Lock
();

70 
	g´iv©e
:

71 
R—dWr™eLock
 *
m_»ad_wr™e_lock
;

73 
	g´iv©e
:

74 
R—d”Lock
(cÚ¡ R—d”Lock &
rhs
);

75 cÚ¡ 
	gR—d”Lock
 &
	gİ”©Ü
=(cÚ¡ 
R—d”Lock
 &
rhs
);

78 şas 
	cDLL_PUBLIC
 
	gWr™”Lock


80 
	gpublic
:

81 
ex¶ic™
 
Wr™”Lock
(
R—dWr™eLock
 *
»ad_wr™e_lock
);

82 ~
Wr™”Lock
();

84 
	g´iv©e
:

85 
R—dWr™eLock
 *
m_»ad_wr™e_lock
;

87 
	g´iv©e
:

88 
Wr™”Lock
(cÚ¡ Wr™”Lock &
rhs
);

89 cÚ¡ 
	gWr™”Lock
 &
	gİ”©Ü
=(cÚ¡ 
Wr™”Lock
 &
rhs
);

	@../common/semaphore.cpp

1 
	~"£m­hÜe.h
"

3 
	~<as£¹.h
>

4 
	~<¡dio.h
>

5 
	~<”ºo.h
>

6 
	~<time.h
>

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
è|| defšed(
__CYGWIN32__
)

12 
	#DEFAULT_NATIVE_MAX_SEMAPHORE_COUNT
 50

	)

13 
DLL_PUBLIC
 
	gSem­hÜe
::
	$Sem­hÜe
(
št32_t
 
v®ue
 )

15 
m_£m­hÜe
 = 
	`C»©eSem­hÜe
(

16 
NULL
,

17 
v®ue
,

18 
DEFAULT_NATIVE_MAX_SEMAPHORE_COUNT
,

19 
NULL
);

20 
	`as£¹
(
m_£m­hÜe
 !ğ
NULL
);

21 ià(
m_£m­hÜe
 =ğ
NULL
)

23 
	`³¼Ü
("CreateSemaphore()");

25 
	}
}

27 
DLL_PUBLIC
 
	gSem­hÜe
::~
	$Sem­hÜe
()

29 
BOOL
 
»t
 = 
	`Clo£HªdË
(
m_£m­hÜe
);

30 
	`as£¹
(
»t
 != 0);

31 ià(
»t
 == 0)

33 
	`³¼Ü
("CloseHandle()");

35 
	}
}

37 
DLL_PUBLIC
 
boŞ
 
	gSem­hÜe
::
	$Po¡
()

39 
BOOL
 
»t
 = 
	`R–—£Sem­hÜe
(
m_£m­hÜe
, 1, 
NULL
);

40 
	`as£¹
(
»t
 != 0);

41 ià(
»t
 == 0)

43 
	`³¼Ü
("ReleaseSemaphore()");

44  
çl£
;

46  
Œue
;

47 
	}
}

49 
DLL_PUBLIC
 
boŞ
 
	gSem­hÜe
::
	$Wa™
(
št32_t
 
ms
 )

51 ià(
ms
 < 0)

53 
DWORD
 
»t
 = 
	`Wa™FÜSšgËObjeù
(
m_£m­hÜe
, 
INFINITE
);

54 
	`as£¹
(
»t
 =ğ
WAIT_OBJECT_0
);

55 ià(
»t
 !ğ
WAIT_OBJECT_0
)

57 
	`³¼Ü
("WaitForSingleObject()");

58  
çl£
;

63 
DWORD
 
»t
 = 
	`Wa™FÜSšgËObjeù
(
m_£m­hÜe
, 
ms
);

64 
	`as£¹
(
»t
 =ğ
WAIT_OBJECT_0
 ||„‘ =ğ
WAIT_TIMEOUT
);

65 ià(
»t
 =ğ
WAIT_TIMEOUT
)

67  
çl£
;

69 ià(
»t
 !ğ
WAIT_OBJECT_0
)

71 
	`³¼Ü
("WaitForSingleObject()");

72  
çl£
;

75  
Œue
;

76 
	}
}

83 
	tNTSTATUS
;

89 
	#NT_SUCCESS
(
Stus
è((
NTSTATUS
)(Stusè>ğ0)

	)

94 
	s_SEMAINFO
 {

95 
UINT
 
	mCouÁ
;

96 
UINT
 
	mLim™
;

97 } 
	tSEMAINFO
, *
	tPSEMAINFO
;

102 
	#SEMAQUERYINFOCLASS
 0

	)

107 
	$NTSTATUS
 (
	tWINAPI
 *
	tNtQu”ySem­hÜePŒ
)(

108 
	tHANDLE
 
	tHªdË
,

109 
	tUINT
 
	tInfoCÏss
,

110 
	tPSEMAINFO
 
	tSemaInfo
,

111 
	tUINT
 
	tInfoSize
,

112 
	tPUINT
 
	tR‘L’
);

114 
Çme¥aû
 {

115 şas 
	cDÎLßd”


117 
public
:

118 
	`DÎLßd”
(cÚ¡ *
dÎ_Çme
è{ 
m_moduË
 = 
	`LßdLib¿ryA
(dll_name); };

119 ~
	`DÎLßd”
(è{ ià(
m_moduË
 !ğ
NULL
è
	`F»eLib¿ry
(m_module); };

120 
FARPROC
 
	`G‘FunùiÚPoš‹r
(cÚ¡ *
funùiÚ_Çme
è{  
m_moduË
 !ğ
NULL
 ? 
	`G‘ProcAdd»ss
(m_module, function_name) : NULL; };

121 
´iv©e
:

122 
	`DÎLßd”
();

123 
	`DÎLßd”
(cÚ¡ 
DÎLßd”
 &
rhs
);

124 
DÎLßd”
 &
İ”©Ü
=(cÚ¡ DÎLßd” &
rhs
);

125 
´iv©e
:

126 
HMODULE
 
m_moduË
;

127 
	}
};

130 
DÎLßd”
 
s_ÁdÎ
("ntdll.dll");

131 
NtQu”ySem­hÜePŒ
 
	gNtQu”ySem­hÜe
 = (NtQu”ySem­hÜePŒ)
s_ÁdÎ
.
G‘FunùiÚPoš‹r
("NtQuerySemaphore");

133 
DLL_PUBLIC
 
boŞ
 
	gSem­hÜe
::
	$G‘V®ue
(
št32_t
* 
pV®ue
)

135 
SEMAINFO
 
SemInfo
;

136 
UINT
 
R‘L’
;

137 
NTSTATUS
 
Stus
;

139 ià(
NtQu”ySem­hÜe
 =ğ
NULL
)

141  
çl£
;

144 
Stus
 = 
	`NtQu”ySem­hÜe
(

145 
m_£m­hÜe
,

146 
SEMAQUERYINFOCLASS
,

147 &
SemInfo
,

148  
SemInfo
,

149 &
R‘L’
);

151 
	`as£¹
(
Stus
 >= 0);

152 ià(!
	`NT_SUCCESS
(
Stus
))

154 
	`³¼Ü
("NtQuerySemaphore()");

155  
çl£
;

158 *
pV®ue
 = 
SemInfo
.
CouÁ
;

160  
Œue
;

161 
	}
}

163 #–ià
defšed
(
__lšux__
)

165 
DLL_PUBLIC
 
	gSem­hÜe
::
	$Sem­hÜe
(
št32_t
 
v®ue
 )

167 
»t
 = 
	`£m_š™
(&
m_£m­hÜe
, 0, 
v®ue
);

168 
	`as£¹
(
»t
 == 0);

169 ià(
»t
 != 0)

171 
	`³¼Ü
("sem_init()");

173 
	}
}

175 
DLL_PUBLIC
 
	gSem­hÜe
::~
	$Sem­hÜe
()

177 
»t
 = 
	`£m_de¡roy
(&
m_£m­hÜe
);

178 
	`as£¹
(
»t
 == 0);

179 ià(
»t
 != 0)

181 
	`³¼Ü
("sem_destroy()");

183 
	}
}

185 
DLL_PUBLIC
 
boŞ
 
	gSem­hÜe
::
	$Po¡
()

187 
»t
 = 
	`£m_po¡
(&
m_£m­hÜe
);

188 
	`as£¹
(
»t
 == 0);

189 ià(
»t
 != 0)

191 
	`³¼Ü
("sem_post()");

192  
çl£
;

194  
Œue
;

195 
	}
}

197 
DLL_PUBLIC
 
boŞ
 
	gSem­hÜe
::
	$Wa™
(
št32_t
 
ms
 )

199 ià(
ms
 < 0)

201 
»t
 = 
	`£m_wa™
(&
m_£m­hÜe
);

202 
	`as£¹
(
»t
 == 0);

203 ià(
»t
 != 0)

205 
	`³¼Ü
("sem_wait()");

206  
çl£
;

209 ià(
ms
 == 0)

211 
»t
 = 
	`£m_Œywa™
(&
m_£m­hÜe
);

212 
	`as£¹
(
»t
 =ğ0 || (»ˆ=ğ-1 && 
”ºo
 =ğ
EAGAIN
));

213 ià(
»t
 != 0)

215 ià(
”ºo
 =ğ
EAGAIN
)

217  
çl£
;

219 
	`³¼Ü
("sem_trywait()");

220  
çl£
;

225 
time_t
 
t
 = 
	`time
(
NULL
);

226 
	`as£¹
(
t
 !ğ(
time_t
)-1);

227 ià(
t
 =ğ(
time_t
)-1)

229 
	`³¼Ü
("time");

230  
çl£
;

232 
time¥ec
 
ts
 = {
t
 + (
ms
 / 1000), (ms % 1000) * 1000};

233 
»t
 = 
	`£m_timedwa™
(&
m_£m­hÜe
, &
ts
);

234 
	`as£¹
(
»t
 =ğ0 || (»ˆ=ğ-1 && 
”ºo
 =ğ
ETIMEDOUT
));

235 ià(
»t
 != 0)

237 ià(
”ºo
 =ğ
ETIMEDOUT
)

239  
çl£
;

241 
	`³¼Ü
("sem_timedwait()");

242  
çl£
;

245  
Œue
;

246 
	}
}

248 
DLL_PUBLIC
 
boŞ
 
	gSem­hÜe
::
	$G‘V®ue
(
št32_t
* 
pV®ue
)

250 
»t
 = 
	`£m_g‘v®ue
(&
m_£m­hÜe
, (*)
pV®ue
);

251 
	`as£¹
(
»t
 == 0);

252 ià(
»t
 != 0)

254 
	`³¼Ü
("sem_getvalue()");

255  
çl£
;

257  
Œue
;

258 
	}
}

261 #”rÜ 
Unknown
 
¶©fÜm
.

	@../common/semaphore.h

1 #iâdeà
__SYSUTILS_SEMAPHORE_H__


2 
	#__SYSUTILS_SEMAPHORE_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
è|| defšed(
__CYGWIN32__
)

9 #iâdeà
WIN32_LEAN_AND_MEAN


10 
	#WIN32_LEAN_AND_MEAN


15 #iâdeà
_WIN32_WINNT


	)

16 
	#_WIN32_WINNT
 0x0400

	)

18 
	~<wšdows.h
>

19 
HANDLE
 
	tSem­hÜeTy³
;

20 #–ià
defšed
(
__lšux__
)

21 
	~<£m­hÜe.h
>

22 
£m_t
 
	tSem­hÜeTy³
;

24 #”rÜ 
Unknown
 
¶©fÜm
.

27 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

29 şas 
	cDLL_PUBLIC
 
	gSem­hÜe


31 
	gpublic
:

36 
Sem­hÜe
(
št32_t
 
v®ue
=0);

41 ~
Sem­hÜe
();

47 
boŞ
 
Po¡
();

57 
boŞ
 
Wa™
(
št32_t
 
ms
=-1);

64 
boŞ
 
G‘V®ue
(
št32_t
 *
pV®ue
);

66 
	g´iv©e
:

67 
Sem­hÜe
(cÚ¡ Sem­hÜ&
rhs
);

68 
	gSem­hÜe
 &
	gİ”©Ü
=(cÚ¡ 
Sem­hÜe
 &
rhs
);

70 
	g´iv©e
:

71 
Sem­hÜeTy³
 
m_£m­hÜe
;

	@../common/smart_pointer.h

1 #iâdeà
__SYSUTILS_SMART_POINTER_H__


2 
	#__SYSUTILS_SMART_POINTER_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

10 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

12 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

13 şas 
	csm¬t_±r


15 
	g´iv©e
:

16 
‹m¶©e
 <
ty³Çme
 
U
>

17 şas 
	csm¬t_couÁ”


19 
ä›nd
 
şass
 
sm¬t_±r
;

20 
	gpublic
:

21 
sm¬t_couÁ”
(
U
 *
p
)

22 : 
m_cs
()

23 , 
m_p
(
p
)

24 , 
m_couÁ
(0)

28 ~
sm¬t_couÁ”
()

30 
d–‘e
 
	gm_p
;

33 
add_»f
()

35 
Cr™iÿlSeùiÚLock
 
_l
(&
m_cs
);

36 
	gm_couÁ
++;

37  
	gm_couÁ
;

40 
»Ëa£
()

42 
Cr™iÿlSeùiÚLock
 
_l
(&
m_cs
);

43 
	gm_couÁ
--;

44 ià(
	gm_couÁ
 <= 0)

46 
d–‘e
 
m_p
;

47 
	gm_p
 = 
NULL
;

49  
	gm_couÁ
;

52 
couÁ
() const

54  
	gm_couÁ
;

57 
	g´iv©e
:

58 
sm¬t_couÁ”
();

59 
sm¬t_couÁ”
(cÚ¡ sm¬t_couÁ” &
rhs
);

60 
	gsm¬t_couÁ”
 &
	gİ”©Ü
=(cÚ¡ 
sm¬t_couÁ”
 &
rhs
);

62 
	g´iv©e
:

63 
Cr™iÿlSeùiÚ
 
m_cs
;

64 
U
 *
	gm_p
;

65 
	gm_couÁ
;

68 
	gpublic
:

69 
sm¬t_±r
(
T
 *
p
=
NULL
)

70 : 
m_couÁ”
(
NULL
)

72 ià(
p
 !ğ
NULL
)

74 
assign
(
Ãw
 
sm¬t_couÁ”
<
T
>(
p
));

78 
sm¬t_±r
(cÚ¡ sm¬t_±r<
T
> &
rhs
)

79 : 
m_couÁ”
(
NULL
)

81 
assign
(
rhs
.
m_couÁ”
);

84 ~
sm¬t_±r
()

86 
assign
(
NULL
);

89 
	gsm¬t_±r
 &
	gİ”©Ü
=(
T
 *
p
)

91 ià(*
this
 !ğ
p
)

93 ià(
p
 !ğ
NULL
)

95 
assign
(
Ãw
 
sm¬t_couÁ”
<
T
>(
p
));

99 
assign
(
NULL
);

102  *
	gthis
;

105 
	gsm¬t_±r
 &
	gİ”©Ü
=(cÚ¡ 
sm¬t_±r
<
T
> &
rhs
)

107 ià(*
this
 !ğ
rhs
)

109 
assign
(
rhs
.
m_couÁ”
);

111  *
	gthis
;

114 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
T
 *
p
)

116 ià(
m_couÁ”
 !ğ
NULL
)

118  
m_couÁ”
.
m_p
 =ğ
p
;

122  
	gp
 =ğ
NULL
;

126 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
sm¬t_±r
<
T
> &
rhs
)

128  
m_couÁ”
 =ğ
rhs
.m_counter;

131 
	gT
 &
	gİ”©Ü
*() const

133  *(
g‘
());

136 
T
 *
	gİ”©Ü
->() const

138  
g‘
();

141 
İ”©Ü
 
	gT
*() const

143  
g‘
();

146 
T
 *
g‘
() const

148  
	gm_couÁ”
 !ğ
NULL
 ? 
m_couÁ”
->
m_p
 : NULL;

151 
u£_couÁ
() const

153  
	gm_couÁ”
 =ğ
NULL
 ? 0 : 
m_couÁ”
->
couÁ
();

156 
	g´iv©e
:

157 
assign
(
sm¬t_couÁ”
<
T
> *
couÁ”
)

159 ià(
couÁ”
 !ğ
NULL
)

161 
couÁ”
->
add_»f
();

164 ià(
	gm_couÁ”
 !ğ
NULL
 && 
m_couÁ”
->
»Ëa£
() <= 0)

166 
d–‘e
 
m_couÁ”
;

169 
	gm_couÁ”
 = 
couÁ”
;

172 
	g´iv©e
:

173 
sm¬t_couÁ”
<
T
> *
m_couÁ”
;

	@../common/stdint.h

1 #iâdeà
__SYSUTILS_STDINT_H__


2 
	#__SYSUTILS_STDINT_H__


	)

4 #iâdeà
__STDC_LIMIT_MACROS


5 
	#__STDC_LIMIT_MACROS


	)

8 #iâdeà
__STDC_CONSTANT_MACROS


9 
	#__STDC_CONSTANT_MACROS


	)

12 #ià
defšed
(
__GNUC__
)

13 
	~<¡dšt.h
>

14 #–ià
defšed
(
_MSC_VER
)

15 
	~"msš‰y³s/¡dšt.h
"

18 #”rÜ 
UnsuµÜ‹d
 
comp”


	@../common/string.cpp

1 
	~"¡ršg.h
"

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

5 
	~<¡d¬g.h
>

7 
	~"commÚ/š‰y³s.h
"

8 #ifdeà
WIN32


9 
	~<Wšdows.h
>

11 
	~<”ºo.h
>

12 
	~<icÚv.h
>

15 
	gÇme¥aû


17 şas 
	cAutoF»ePoš‹r


19 
	gpublic
:

20 
AutoF»ePoš‹r
(*
p
): 
m_p
(p) {}

21 ~
AutoF»ePoš‹r
(è{
ä“
(
m_p
);}

22 
	g´iv©e
:

23 
AutoF»ePoš‹r
(cÚ¡ AutoF»ePoš‹¸&
rhs
);

24 cÚ¡ 
	gAutoF»ePoš‹r
 &
	gİ”©Ü
=(cÚ¡ 
AutoF»ePoš‹r
 &
rhs
);

25 
	g´iv©e
:

26 *
m_p
;

30 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

35 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$¡ršg_fÜm©
(cÚ¡ *
fmt
, ...)

37 *
pbufãr
 = 
NULL
;

38 
size
 = 0;

39 
Ëngth
 = 0;

41 
va_li¡
 
­
;

42 
	`va_¡¬t
(
­
, 
fmt
);

43 #ià
	`defšed
(
_MSC_VER
)

44 
size
 = 
	`_vsırštf
(
fmt
, 
­
) + 1;

45 
pbufãr
 = (*)
	`m®loc
(
size
 * ());

46 
Ëngth
 = 
	`v¢´štf_s
(
pbufãr
, 
size
, 
_TRUNCATE
, 
fmt
, 
­
);

48 
Ëngth
 = 
	`va¥rštf
(&
pbufãr
, 
fmt
, 
­
);

49 
size
 = 
Ëngth
 + 1;

51 
	`va_’d
(
­
);

52 
AutoF»ePoš‹r
 
	`aå
((*)
pbufãr
);

53  (
Ëngth
 > 0 && 
pbufãr
 !ğ
NULL
) ?…buffer : "";

54 
	}
}

56 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
SYSUTILS_SPACE
::
	$¡ršg_¥l™
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
, cÚ¡ 
d–im™”
)

58  
	`¡ršg_¥l™
(
¡r
, 
¡d
::
	`¡ršg
(1, 
d–im™”
));

59 
	}
}

61 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
SYSUTILS_SPACE
::
	$¡ršg_¥l™
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
, cÚ¡ std::¡ršg &
d–im™”
)

63 
¡d
::
veùÜ
<¡d::
¡ršg
> 
»suÉ
;

64 ià(
d–im™”
.
	`Ëngth
() > 0)

66 
size_t
 
pos_¡¬t
 = 0;

67 
size_t
 
pos_’d
 = 0;

68 (
pos_’d
 = 
¡r
.
	`fšd
(
d–im™”
, 
pos_¡¬t
)è!ğ
¡d
::
¡ršg
::
Åos
)

70 
»suÉ
.
	`push_back
(
¡r
.
	`sub¡r
(
pos_¡¬t
, 
pos_’d
 -…os_start));

71 
pos_¡¬t
 = 
pos_’d
 + 
d–im™”
.
	`Ëngth
();

73 
»suÉ
.
	`push_back
(
¡r
.
	`sub¡r
(
pos_¡¬t
));

77 
»suÉ
.
	`push_back
(
¡r
);

79  
»suÉ
;

80 
	}
}

82 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
¡ršg_m”ge
(cÚ¡ 
¡d
::
veùÜ
<¡d::¡ršg> &
¡rs
, cÚ¡ 
d–im™”
)

84  
¡ršg_m”ge
(
¡rs
, 
¡d
::
¡ršg
(1, 
d–im™”
));

87 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
¡ršg_m”ge
(cÚ¡ 
¡d
::
veùÜ
<¡d::¡ršg> &
¡rs
, cÚ¡ std::¡ršg &
d–im™”
)

89 
¡d
::
¡ršg
 
¡r
;

91 
size_t
 
	gi
 = 0; i < 
	g¡rs
.
size
(); i++)

93 ià(
	gi
 > 0)

95 
	g¡r
 +ğ
d–im™”
;

97 
	g¡r
 +ğ
¡rs
[
i
];

100  
	g¡r
;

103 
DLL_PUBLIC
 
št8_t
 
	gSYSUTILS_SPACE
::
	$¡r_to_i8
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

105 
št64_t
 
»s
 = 
	`¡r_to_i64
(
¡r
);

106 ià(
»s
 < 
INT8_MIN
)

108  
INT8_MIN
;

110 ià(
»s
 > 
INT8_MAX
)

112  
INT8_MAX
;

116  (
št8_t
)
»s
;

118 
	}
}

120 
DLL_PUBLIC
 
ušt8_t
 
	gSYSUTILS_SPACE
::
	$¡r_to_u8
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

122 
št64_t
 
»s
 = 
	`¡r_to_i64
(
¡r
);

123 ià(
»s
 < 0)

127 ià(
»s
 > 
UINT8_MAX
)

129  
UINT8_MAX
;

133  (
ušt8_t
)
»s
;

135 
	}
}

137 
DLL_PUBLIC
 
št16_t
 
	gSYSUTILS_SPACE
::
	$¡r_to_i16
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

139 
št64_t
 
»s
 = 
	`¡r_to_i64
(
¡r
);

140 ià(
»s
 < 
INT16_MIN
)

142  
INT16_MIN
;

144 ià(
»s
 > 
INT16_MAX
)

146  
INT16_MAX
;

150  (
št16_t
)
»s
;

152 
	}
}

154 
DLL_PUBLIC
 
ušt16_t
 
	gSYSUTILS_SPACE
::
	$¡r_to_u16
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

156 
št64_t
 
»s
 = 
	`¡r_to_i64
(
¡r
);

157 ià(
»s
 < 0)

161 ià(
»s
 > 
UINT16_MAX
)

163  
UINT16_MAX
;

167  (
ušt16_t
)
»s
;

169 
	}
}

171 
DLL_PUBLIC
 
št32_t
 
	gSYSUTILS_SPACE
::
	$¡r_to_i32
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

173 
št64_t
 
»s
 = 
	`¡r_to_i64
(
¡r
);

174 ià(
»s
 < 
INT32_MIN
)

176  
INT32_MIN
;

178 ià(
»s
 > 
INT32_MAX
)

180  
INT32_MAX
;

184  (
št32_t
)
»s
;

186 
	}
}

188 
DLL_PUBLIC
 
ušt32_t
 
	gSYSUTILS_SPACE
::
	$¡r_to_u32
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

190 
št64_t
 
»s
 = 
	`¡r_to_i64
(
¡r
);

191 ià(
»s
 < 0)

195 ià(
»s
 > 
UINT32_MAX
)

197  
UINT32_MAX
;

201  (
ušt32_t
)
»s
;

203 
	}
}

205 
DLL_PUBLIC
 
št64_t
 
	gSYSUTILS_SPACE
::
	$¡r_to_i64
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

207 
št64_t
 
»s
 = 
	`INT64_C
(0);

208 ià(
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%" 
SCNi64
, &
»s
) != 1)

210  
	`INT64_C
(0);

212  
»s
;

213 
	}
}

215 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$¡r_to_u64
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

217 
ušt64_t
 
»s
 = 
	`UINT64_C
(0);

218 
size_t
 
¡¬t_pos
 = 
¡r
.
	`fšd_fœ¡_nÙ_of
(" \t\v\r\n");

219 ià(
¡¬t_pos
 =ğ
¡d
::
¡ršg
::
Åos
)

221  
	`UINT64_C
(0);

223 ià(
¡r
.
	`fšd
("0x", 
¡¬t_pos
) == start_pos || str.find("0X", start_pos) == start_pos)

225 ià(
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%" 
SCNx64
, &
»s
) != 1)

227  
	`UINT64_C
(0);

230 ià(
¡¬t_pos
 + 1 < 
¡r
.
	`Ëngth
() && str[start_pos] == '0' && str[start_pos + 1] >= '0' && str[start_pos + 1] <= '9')

232 ià(
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%" 
SCNo64
, &
»s
) != 1)

234  
	`UINT64_C
(0);

237 ià(
¡¬t_pos
 < 
¡r
.
	`Ëngth
() && str[start_pos] == '-')

239  
	`UINT64_C
(0);

243 ià(
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%" 
SCNu64
, &
»s
) != 1)

245  
	`UINT64_C
(0);

248  
»s
;

249 
	}
}

251 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$¡r_to_boŞ
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

253 
size_t
 
¡¬t_pos
 = 
¡r
.
	`fšd_fœ¡_nÙ_of
(" \t\v\r\n");

254 ià(
¡¬t_pos
 =ğ
¡d
::
¡ršg
::
Åos
)

256  
çl£
;

258 ià((
¡¬t_pos
 < 
¡r
.
	`Ëngth
()) &&

259 ((
¡r
[
¡¬t_pos
] == 'T' || str[start_pos] == 't') ||

260 (
¡r
[
¡¬t_pos
] == 'Y' || str[start_pos] == 'y')))

262  
Œue
;

264 ià((
¡¬t_pos
 < 
¡r
.
	`Ëngth
()) &&

265 ((
¡r
[
¡¬t_pos
] == 'F' || str[start_pos] == 'f') ||

266 (
¡r
[
¡¬t_pos
] == 'N' || str[start_pos] == 'n')))

268  
çl£
;

270 ià(
	`¡r_to_i64
(
¡r
) != 0)

272  
Œue
;

276  
çl£
;

278 
	}
}

280 
DLL_PUBLIC
 
	gSYSUTILS_SPACE
::
	$¡r_to_ch¬
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

282 
size_t
 
¡¬t_pos
 = 
¡r
.
	`fšd_fœ¡_nÙ_of
(" \t\v\r\n");

283 ià(
¡¬t_pos
 =ğ
¡d
::
¡ršg
::
Åos
)

287 ià(
¡¬t_pos
 < 
¡r
.
	`Ëngth
())

289  
¡r
[
¡¬t_pos
];

295 
	}
}

297 
DLL_PUBLIC
 
	gSYSUTILS_SPACE
::
	$¡r_to_æßt
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

299 
»s
 = 0.0f;

300 ià(
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%f", &
»s
) != 1)

304  
»s
;

305 
	}
}

307 
DLL_PUBLIC
 
	gSYSUTILS_SPACE
::
	$¡r_to_doubË
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

309 
»s
 = 0.0;

310 ià(
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%lf", &
»s
) != 1)

314  
»s
;

315 
	}
}

317 
DLL_PUBLIC
 
	gSYSUTILS_SPACE
::
	$¡r_to_lÚg_doubË
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

319 
»s
 = 0.0L;

320 ià(
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%Lf", &
»s
) != 1)

324  
»s
;

325 
	}
}

327 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$i8_to_¡r
(cÚ¡ 
št8_t
 
d©a
)

329  
	`¡ršg_fÜm©
("%" 
PRId8
, 
d©a
);

330 
	}
}

332 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$u8_to_¡r
(cÚ¡ 
ušt8_t
 
d©a
)

334  
	`¡ršg_fÜm©
("%" 
PRIu8
, 
d©a
);

335 
	}
}

337 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$i16_to_¡r
(cÚ¡ 
št16_t
 
d©a
)

339  
	`¡ršg_fÜm©
("%" 
PRId16
, 
d©a
);

340 
	}
}

342 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$u16_to_¡r
(cÚ¡ 
ušt16_t
 
d©a
)

344  
	`¡ršg_fÜm©
("%" 
PRIu16
, 
d©a
);

345 
	}
}

347 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$i32_to_¡r
(cÚ¡ 
št32_t
 
d©a
)

349  
	`¡ršg_fÜm©
("%" 
PRId32
, 
d©a
);

350 
	}
}

352 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$u32_to_¡r
(cÚ¡ 
ušt32_t
 
d©a
)

354  
	`¡ršg_fÜm©
("%" 
PRIu32
, 
d©a
);

355 
	}
}

357 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$i64_to_¡r
(cÚ¡ 
št64_t
 
d©a
)

359  
	`¡ršg_fÜm©
("%" 
PRId64
, 
d©a
);

360 
	}
}

362 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$u64_to_¡r
(cÚ¡ 
ušt64_t
 
d©a
)

364  
	`¡ršg_fÜm©
("%" 
PRIu64
, 
d©a
);

365 
	}
}

367 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$boŞ_to_¡r
(cÚ¡ 
boŞ
 
d©a
)

369  
	`¡ršg_fÜm©
("%s", 
d©a
 ? "true" : "false");

370 
	}
}

372 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$ch¬_to_¡r
(cÚ¡ 
d©a
)

374  
	`¡ršg_fÜm©
("%c", 
d©a
);

375 
	}
}

377 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$æßt_to_¡r
(cÚ¡ 
d©a
)

379  
	`¡ršg_fÜm©
("%f", 
d©a
);

380 
	}
}

382 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$doubË_to_¡r
(cÚ¡ 
d©a
)

384  
	`¡ršg_fÜm©
("%f", 
d©a
);

385 
	}
}

387 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
SYSUTILS_SPACE
::
	$lÚg_doubË_to_¡r
(cÚ¡ 
d©a
)

389  
	`¡ršg_fÜm©
("%Lf", 
d©a
);

390 
	}
}

392 
boŞ
 
	gSYSUTILS_SPACE
::
	$UTF8toUnicode
(cÚ¡ 
¡d
::
¡ršg
& 
¡rUTF8
, std::
w¡ršg
& 
w¡rUnicode
)

394 #ifdeà
WIN32


395 
iL’Wide
 = 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
, 
¡rUTF8
.
	`c_¡r
(), - 1, 
NULL
, 0);

396 ià(
iL’Wide
 <= 0)

398  
çl£
;

401 
wch¬_t
* 
pWideCh¬
 = 
Ãw
 wch¬_t[
iL’Wide
 + 1];

402 
pWideCh¬
[
iL’Wide
] = '\0';

403 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
¡rUTF8
.
	`c_¡r
(), -1, 
pWideCh¬
, 
iL’Wide
);

404 
w¡rUnicode
 = 
pWideCh¬
;

406 
d–‘e
 [] 
pWideCh¬
;

407 
pWideCh¬
 = 
NULL
;

409  
Œue
;

410 
	}
}

412 
boŞ
 
	gSYSUTILS_SPACE
::
	$Unicod‘oUTF8
(cÚ¡ 
¡d
::
w¡ršg
& 
w¡rUnicode
, std::
¡ršg
& 
¡rUTF8
)

414 #ifdeà
WIN32


415 
iL’UTF8
 = 
	`WideCh¬ToMuÉiBy‹
(
CP_UTF8
, 0, 
w¡rUnicode
.
	`c_¡r
(), -1, 
NULL
, 0, NULL, NULL);

416 ià(
iL’UTF8
 <= 0)

418  
çl£
;

421 * 
pUTF8
 = 
Ãw
 [
iL’UTF8
 + 1];

422 
pUTF8
[
iL’UTF8
] = '\0';

423 
	`WideCh¬ToMuÉiBy‹
(
CP_UTF8
, 0, 
w¡rUnicode
.
	`c_¡r
(), -1, 
pUTF8
, 
iL’UTF8
, 
NULL
, NULL);

424 
¡rUTF8
 = 
pUTF8
;

426 
d–‘e
 [] 
pUTF8
;

427 
pUTF8
 = 
NULL
;

429  
Œue
;

430 
	}
}

432 
boŞ
 
	gSYSUTILS_SPACE
::
	$MuÉiBy‹toUnicode
(cÚ¡ 
¡d
::
¡ršg
& 
¡rMB
, std::
w¡ršg
& 
w¡rUnicode
, 
uiCodePageFrom
)

434 #ifdeà
WIN32


435 
WCHAR
* 
pWideCh¬
 = 
NULL
;

437 
iL’Wide
 = 
	`MuÉiBy‹ToWideCh¬
(
uiCodePageFrom
, 
MB_ERR_INVALID_CHARS
, 
¡rMB
.
	`c_¡r
(), -1, 
pWideCh¬
, 0);

438 ià(
iL’Wide
 <= 0)

440  
çl£
;

443 
pWideCh¬
 = 
Ãw
 
WCHAR
[
iL’Wide
 + 1];

444 
pWideCh¬
[
iL’Wide
] = '\0';

445 
	`MuÉiBy‹ToWideCh¬
(
uiCodePageFrom
, 
MB_ERR_INVALID_CHARS
, 
¡rMB
.
	`c_¡r
(), -1, 
pWideCh¬
, 
iL’Wide
);

446 
w¡rUnicode
 = 
pWideCh¬
;

448 
d–‘e
 [] 
pWideCh¬
;

449 
pWideCh¬
 = 
NULL
;

451  
Œue
;

452 
	}
}

454 
boŞ
 
	gSYSUTILS_SPACE
::
	$MuÉiBy‹toUTF8
(cÚ¡ 
¡d
::
¡ršg
& 
¡rMB
, std::¡ršg& 
¡rUTF8
, 
uiCodePageFrom
)

456 #ifdeà
WIN32


457 
¡d
::
w¡ršg
 
w¡rUnicode
;

458 ià(
	`MuÉiBy‹toUnicode
(
¡rMB
, 
w¡rUnicode
, 
uiCodePageFrom
è!ğ
Œue
)

460  
çl£
;

463  
	`Unicod‘oUTF8
(
w¡rUnicode
, 
¡rUTF8
);

465  
Œue
;

467 
	}
}

469 
boŞ
 
	gSYSUTILS_SPACE
::
	$MuÉiBy‹toUTF8
(cÚ¡ 
¡d
::
¡ršg
& 
¡rMB
, std::¡ršg& 
¡rUTF8
, std::¡ršg 
¡rCodecFrom
)

471 #ifdeà 
__lšux__


472 
icÚv_t
 
cd
;

473 ià((
cd
 = 
	`icÚv_İ’
("utf-8", 
¡rCodecFrom
.
	`c_¡r
())è=ğ(
icÚv_t
) -1)

475 
	`´štf
("icÚv_İ’ f®£: [%s] ==> [UTF8]\n", 
¡rCodecFrom
.
	`c_¡r
());

476  
çl£
;

479 
size_t
 
uiL’
 = 
¡rMB
.
	`Ëngth
();

480 * 
pIÅutSŒšg
 = 
Ãw
 [
uiL’
 + 1];

481 
	`mem£t
(
pIÅutSŒšg
, 0, 
uiL’
 + 1);

482 
	`¡ºıy
(
pIÅutSŒšg
, 
¡rMB
.
	`c_¡r
(), 
uiL’
 + 1);

483 
pIÅutSŒšg
[
uiL’
] = '\0';

484 * 
pIS¹
 = 
pIÅutSŒšg
;

486 
size_t
 
uiOuutL’
 = 
uiL’
 * 3;

487 
size_t
 
uiTmpL’
 = 
uiOuutL’
;

488 * 
pOuutSŒšg
 = 
Ãw
 [
uiOuutL’
 + 1];

489 
	`mem£t
(
pOuutSŒšg
, 0, 
uiOuutL’
 + 1);

490 
pOuutSŒšg
[
uiOuutL’
] = '\0';

491 * 
pOS¹
 = 
pOuutSŒšg
;

493 
boŞ
 
bR‘
 = 
Œue
;

495 
uiL’
 != 0)

497 ià((
size_t
)(-1è=ğ
	`icÚv
(
cd
, (**è&
pIS¹
, &
uiL’
, &
pOS¹
, &
uiOuutL’
))

499 
	`´štf
("FaØcÚv”ˆch¬aù” [%s]ØÃw cod£t.[%s] [%u] [%u]\n", 
¡rCodecFrom
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
), 
uiL’
, 
uiOuutL’
);

500 
	`memıy
(
pOS¹
++, 
pIS¹
++, ());

501 
uiL’
--;

502 
uiOuutL’
--;

503 
bR‘
 = 
çl£
;

504 ià(
uiOuutL’
 > 
uiTmpL’
)

512 
¡d
::
¡ršg
 
	`¡rTemp
((cÚ¡ *è
pOuutSŒšg
, 
	`¡¾’
(pOutputString));

514 
¡rUTF8
 = 
¡rTemp
;

516 
d–‘e
 [] 
pIÅutSŒšg
;

517 
d–‘e
 [] 
pOuutSŒšg
;

518 
	`icÚv_şo£
(
cd
);

520  
bR‘
;

522  
Œue
;

524 
	}
}

526 
boŞ
 
	gSYSUTILS_SPACE
::
	$Aµ’dSÏsh
(cÚ¡ 
¡d
::
¡ršg
& 
¡rSourû
, std::¡ršg& 
¡rResuÉ
)

528 
uiL’
 = 
¡rSourû
.
	`Ëngth
();

529 
size_t
 
ui
 = 0; u˜< 
uiL’
; ui++)

531 
¡rSourû
[
ui
])

534 
¡rResuÉ
 += "\\\\";

537 
¡rResuÉ
 +ğ
¡rSourû
[
ui
];

542  
Œue
;

543 
	}
}

545 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
SYSUTILS_SPACE
::
	$G‘CÚ‹ÁW™houtTrim
(cÚ¡ 
¡d
::
¡ršg
 &
¡rBody
, cÚ¡ * 
¡¬tTag
, cÚ¡ * 
’dTag
)

547 
¡d
::
veùÜ
<¡d::
¡ršg
> 
cÚ‹ÁLi¡
;

548 
cÚ‹ÁLi¡
.
	`ş—r
();

550 
¡d
::
¡ršg
::
size_ty³
 
¡¬tPos
;

551 
¡d
::
¡ršg
::
size_ty³
 
’dPos
;

552 
ušt32_t
 
size
 = 
¡rBody
.
	`size
();

553 
ušt32_t
 
idx
 = 0;

554 
idx
 < 
size
)

556 
¡¬tPos
 = 
¡rBody
.
	`fšd
(
¡¬tTag
, 
idx
);

557 
’dPos
 = 
¡rBody
.
	`fšd
(
’dTag
, 
idx
);

558 
¡d
::
¡ršg
::
size_ty³
 
Ëngth
 = 
’dPos
 - 
¡¬tPos
 - 
	`¡¾’
(
’dTag
) + 1;

559 ià(
¡¬tPos
 =ğ
¡d
::
¡ršg
::
Åos
)

563 ià(
¡¬tPos
 < 
size
)

565 
¡d
::
¡ršg
 
¡rCÚ‹Á
 = 
¡rBody
.
	`sub¡r
(
¡¬tPos
 + 
	`¡¾’
(
¡¬tTag
), 
Ëngth
);

566 
cÚ‹ÁLi¡
.
	`push_back
(
¡rCÚ‹Á
);

567 
idx
 = 
’dPos
 + 
	`¡¾’
(
’dTag
) - 1;

570  
cÚ‹ÁLi¡
;

571 
	}
}

	@../common/string.h

1 #iâdeà
__SYSUTILS_STRING_H__


2 
	#__SYSUTILS_STRING_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~<¡ršg
>

9 
	~<veùÜ
>

10 
	~<c¡ršg
>

12 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
¡ršg_fÜm©
(cÚ¡ *
fmt
, ...);

16 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
¡ršg_¥l™
(cÚ¡ std::¡ršg &
¡r
, cÚ¡ 
d–im™”
);

17 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
¡ršg_¥l™
(cÚ¡ std::¡ršg &
¡r
, cÚ¡ std::¡ršg &
d–im™”
);

18 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
¡ršg_m”ge
(cÚ¡ 
¡d
::
veùÜ
<¡d::¡ršg> &
¡rs
, cÚ¡ 
d–im™”
);

19 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
¡ršg_m”ge
(cÚ¡ 
¡d
::
veùÜ
<¡d::¡ršg> &
¡rs
, cÚ¡ std::¡ršg &
d–im™”
);

21 
DLL_PUBLIC
 
št8_t
 
¡r_to_i8
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

22 
DLL_PUBLIC
 
ušt8_t
 
¡r_to_u8
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

23 
DLL_PUBLIC
 
št16_t
 
¡r_to_i16
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

24 
DLL_PUBLIC
 
ušt16_t
 
¡r_to_u16
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

25 
DLL_PUBLIC
 
št32_t
 
¡r_to_i32
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

26 
DLL_PUBLIC
 
ušt32_t
 
¡r_to_u32
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

27 
DLL_PUBLIC
 
št64_t
 
¡r_to_i64
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

28 
DLL_PUBLIC
 
ušt64_t
 
¡r_to_u64
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

30 
DLL_PUBLIC
 
boŞ
 
¡r_to_boŞ
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

31 
DLL_PUBLIC
 
¡r_to_ch¬
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

32 
DLL_PUBLIC
 
¡r_to_æßt
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

33 
DLL_PUBLIC
 
¡r_to_doubË
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

34 
DLL_PUBLIC
 
¡r_to_lÚg_doubË
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

36 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
i8_to_¡r
(cÚ¡ 
št8_t
 
d©a
);

37 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
u8_to_¡r
(cÚ¡ 
ušt8_t
 
d©a
);

38 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
i16_to_¡r
(cÚ¡ 
št16_t
 
d©a
);

39 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
u16_to_¡r
(cÚ¡ 
ušt16_t
 
d©a
);

40 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
i32_to_¡r
(cÚ¡ 
št32_t
 
d©a
);

41 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
u32_to_¡r
(cÚ¡ 
ušt32_t
 
d©a
);

42 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
i64_to_¡r
(cÚ¡ 
št64_t
 
d©a
);

43 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
u64_to_¡r
(cÚ¡ 
ušt64_t
 
d©a
);

45 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
boŞ_to_¡r
(cÚ¡ 
boŞ
 
d©a
);

46 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
ch¬_to_¡r
(cÚ¡ 
d©a
);

47 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
æßt_to_¡r
(cÚ¡ 
d©a
);

48 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
doubË_to_¡r
(cÚ¡ 
d©a
);

49 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
lÚg_doubË_to_¡r
(cÚ¡ 
d©a
);

51 
DLL_PUBLIC
 
boŞ
 
UTF8toUnicode
(cÚ¡ 
¡d
::
¡ršg
& 
¡rUTF8
, std::
w¡ršg
& 
w¡rUnicode
);

52 
DLL_PUBLIC
 
boŞ
 
Unicod‘oUTF8
(cÚ¡ 
¡d
::
w¡ršg
& 
w¡rUnicode
, std::
¡ršg
& 
¡rUTF8
);

53 
DLL_PUBLIC
 
boŞ
 
MuÉiBy‹toUnicode
(cÚ¡ 
¡d
::
¡ršg
& 
¡rMB
, std::
w¡ršg
& 
w¡rUnicode
, 
uiCodePageFrom
);

54 
DLL_PUBLIC
 
boŞ
 
MuÉiBy‹toUTF8
(cÚ¡ 
¡d
::
¡ršg
& 
¡rMB
, std::¡ršg& 
¡rUTF8
, 
uiCodePageFrom
);

55 
DLL_PUBLIC
 
boŞ
 
MuÉiBy‹toUTF8
(cÚ¡ 
¡d
::
¡ršg
& 
¡rMB
, std::¡ršg& 
¡rUTF8
, std::¡ršg 
¡rCodecFrom
);

56 
DLL_PUBLIC
 
boŞ
 
Aµ’dSÏsh
(cÚ¡ 
¡d
::
¡ršg
& 
¡rSourû
, std::¡ršg& 
¡rResuÉ
);

58 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
G‘CÚ‹ÁW™houtTrim
(cÚ¡ std::¡ršg &
¡rBody
, cÚ¡ * 
¡¬tTag
, cÚ¡ * 
’dTag
);

	@../common/system.cpp

1 
	~"sy¡em.h
"

3 #ià
defšed
(
_WIN32
)

4 #iâdeà
WIN32_LEAN_AND_MEAN


5 
	#WIN32_LEAN_AND_MEAN


7 
	~<Wšdows.h
>

	)

8 #–ià
defšed
(
__lšux
)

9 
	~<uni¡d.h
>

14 
	~"commÚ/time.h
"

16 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

18 
DLL_PUBLIC
 
	gSYSUTILS_SPACE
::
	$SË•MS
(
ušt32_t
 
ms
)

20 #ià
	`defšed
(
_WIN32
)

21 
	`SË•
(
ms
);

22 #–ià
	`defšed
(
__lšux
)

23 
	`u¦“p
(
ms
 * 1000);

27 
	}
};

29 
DLL_PUBLIC
 
št64_t
 
	gSYSUTILS_SPACE
::
	$G‘TimeCouÁMS
()

31 
time¥ec
 
ts
 = 
UTCTime
::
	`G‘Cu¼’tTimeCouÁ
();

33  (
ts
.
tv_£c
 * (
št64_t
)1000è+ (ts.
tv_n£c
 / 1000000);

34 
	}
}

36 
DLL_PUBLIC
 
št64_t
 
	gSYSUTILS_SPACE
::
	$G‘TimeMS
()

38 
time¥ec
 
ts
 = 
UTCTime
::
	`G‘Cu¼’tTimeS³c
();

40  (
ts
.
tv_£c
 * (
št64_t
)1000è+ (ts.
tv_n£c
 / 1000000);

41 
	}
};

43 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$AddEPOCHTimeMS
(
ušt64_t
 
ms
)

45 
ms
 +ğ(
EPOCH_DIFFERENCE
 * 1000);

47  
ms
;

48 
	}
};

50 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$D–‘eEPOCHTimeMS
(
ušt64_t
 
ms
)

52 
ms
 -ğ(
EPOCH_DIFFERENCE
 * 1000);

54  
ms
;

55 
	}
};

	@../common/system.h

1 #iâdeà
__SYSUTILS_SYSTEM_H__


2 
	#__SYSUTILS_SYSTEM_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

10 
DLL_PUBLIC
 
SË•MS
(
ušt32_t
 
ms
);

12 
DLL_PUBLIC
 
št64_t
 
G‘TimeMS
();

15 
DLL_PUBLIC
 
št64_t
 
G‘TimeCouÁMS
();

18 
DLL_PUBLIC
 
ušt64_t
 
AddEPOCHTimeMS
(ušt64_ˆ
ms
);

21 
DLL_PUBLIC
 
ušt64_t
 
D–‘eEPOCHTimeMS
(ušt64_ˆ
ms
);

	@../common/time.cpp

1 
	~"time.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
DLL_PUBLIC
 
	gUTCTimeS·n
::
	$UTCTimeS·n
()

6 : 
	$m_£cÚd
(0)

8 
	}
}

10 
DLL_PUBLIC
 
UTCTimeS·n
::~
	$UTCTimeS·n
()

12 
	}
}

14 
DLL_PUBLIC
 
UTCTimeS·n
::
	$UTCTimeS·n
(cÚ¡ 
UTCTimeS·n
 &
rhs
)

15 : 
	$m_£cÚd
(
rhs
.
m_£cÚd
)

17 
	}
}

19 
DLL_PUBLIC
 
UTCTimeS·n
::
	$UTCTimeS·n
(cÚ¡ 
št32_t
 
£cÚd
)

20 : 
	$m_£cÚd
(
£cÚd
)

22 
	}
}

24 
DLL_PUBLIC
 
UTCTimeS·n
::
	$UTCTimeS·n
(cÚ¡ 
št32_t
 
mšu‹
, cÚ¡ iÁ32_ˆ
£cÚd
)

25 : 
	`m_£cÚd
(
mšu‹
 * 60 + 
£cÚd
)

27 
	}
}

29 
DLL_PUBLIC
 
UTCTimeS·n
::
	$UTCTimeS·n
(cÚ¡ 
št32_t
 
hour
, cÚ¡ iÁ32_ˆ
mšu‹
, cÚ¡ iÁ32_ˆ
£cÚd
)

30 : 
	`m_£cÚd
(
hour
 * 60 * 60 + 
mšu‹
 * 60 + 
£cÚd
)

32 
	}
}

34 
DLL_PUBLIC
 
UTCTimeS·n
::
	$UTCTimeS·n
(cÚ¡ 
št32_t
 
day
, iÁ32_ˆ
hour
, cÚ¡ iÁ32_ˆ
mšu‹
, cÚ¡ iÁ32_ˆ
£cÚd
)

35 : 
	`m_£cÚd
(
day
 * 24 * 60 * 60 + 
hour
 * 60 * 60 + 
mšu‹
 * 60 + 
£cÚd
)

37 
	}
}

39 
DLL_PUBLIC
 
UTCTimeS·n
 &UTCTimeS·n::
İ”©Ü
=(cÚ¡ UTCTimeS·À&
rhs
)

41 ià(&
rhs
 !ğ
this
)

43 
m_£cÚd
 = 
rhs
.m_second;

45  *
	gthis
;

48 
DLL_PUBLIC
 
	gUTCTimeS·n
 &UTCTimeS·n::
İ”©Ü
+=(cÚ¡ 
UTCTimeS·n
 &
rhs
)

50 
m_£cÚd
 +ğ
rhs
.m_second;

51  *
	gthis
;

54 
DLL_PUBLIC
 
	gUTCTimeS·n
 &UTCTimeS·n::
İ”©Ü
-=(cÚ¡ 
UTCTimeS·n
 &
rhs
)

56 
m_£cÚd
 -ğ
rhs
.m_second;

57  *
	gthis
;

60 
DLL_PUBLIC
 
št32_t
 
	gUTCTimeS·n
::
	$G‘SecÚd
() const

62  
m_£cÚd
;

63 
	}
}

65 
DLL_PUBLIC
 
št32_t
 
	gUTCTimeS·n
::
	$G‘Residu®SecÚd
() const

67  
	`G‘SecÚd
() % 60;

68 
	}
}

70 
DLL_PUBLIC
 
št32_t
 
	gUTCTimeS·n
::
	$G‘Mšu‹
() const

72  
m_£cÚd
 / 60;

73 
	}
}

75 
DLL_PUBLIC
 
št32_t
 
	gUTCTimeS·n
::
	$G‘Residu®Mšu‹
() const

77  
	`G‘Mšu‹
() % 60;

78 
	}
}

80 
DLL_PUBLIC
 
št32_t
 
	gUTCTimeS·n
::
	$G‘Hour
() const

82  
m_£cÚd
 / 60 / 60;

83 
	}
}

85 
DLL_PUBLIC
 
št32_t
 
	gUTCTimeS·n
::
	$G‘Residu®Hour
() const

87  
	`G‘Hour
() % 24;

88 
	}
}

90 
DLL_PUBLIC
 
št32_t
 
	gUTCTimeS·n
::
	$G‘Day
() const

92  
m_£cÚd
 / 60 / 60 / 24;

93 
	}
}

95 
DLL_PUBLIC
 
	gUTCTimeS·n
::
	$S‘SecÚd
(cÚ¡ 
št32_t
 
£cÚd
)

97 
m_£cÚd
 = 
£cÚd
;

98 
	}
}

100 
DLL_PUBLIC
 
	gUTCTimeS·n
::
	$S‘Mšu‹
(cÚ¡ 
št32_t
 
mšu‹
, cÚ¡ iÁ32_ˆ
£cÚd
 )

102 
m_£cÚd
 = 
mšu‹
 * 60 + 
£cÚd
;

103 
	}
}

105 
DLL_PUBLIC
 
	gUTCTimeS·n
::
	$S‘Hour
(cÚ¡ 
št32_t
 
hour
, cÚ¡ iÁ32_ˆ
mšu‹
 , cÚ¡ iÁ32_ˆ
£cÚd
 )

107 
m_£cÚd
 = 
hour
 * 60 * 60 + 
mšu‹
 * 60 + 
£cÚd
;

108 
	}
}

110 
DLL_PUBLIC
 
	gUTCTimeS·n
::
	$S‘Day
(cÚ¡ 
št32_t
 
day
, cÚ¡ iÁ32_ˆ
hour
 , cÚ¡ iÁ32_ˆ
mšu‹
 , cÚ¡ iÁ32_ˆ
£cÚd
 )

112 
m_£cÚd
 = 
day
 * 24 * 60 * 60 + 
hour
 * 60 * 60 + 
mšu‹
 * 60 + 
£cÚd
;

113 
	}
}

115 
DLL_PUBLIC
 
boŞ
 
	gUTCTimeS·n
::
İ”©Ü
==(cÚ¡ 
UTCTimeS·n
 &
rhs
) const

117  
m_£cÚd
 =ğ
rhs
.m_second;

120 
DLL_PUBLIC
 
boŞ
 
	gUTCTimeS·n
::
İ”©Ü
!=(cÚ¡ 
UTCTimeS·n
 &
rhs
) const

122  !(*
this
 =ğ
rhs
);

125 
DLL_PUBLIC
 
boŞ
 
	gUTCTimeS·n
::
İ”©Ü
>(cÚ¡ 
UTCTimeS·n
 &
rhs
) const

127  
m_£cÚd
 > 
rhs
.m_second;

130 
DLL_PUBLIC
 
boŞ
 
	gUTCTimeS·n
::
İ”©Ü
<(cÚ¡ 
UTCTimeS·n
 &
rhs
) const

132  
m_£cÚd
 < 
rhs
.m_second;

135 
DLL_PUBLIC
 
boŞ
 
	gUTCTimeS·n
::
İ”©Ü
>=(cÚ¡ 
UTCTimeS·n
 &
rhs
) const

137  !(*
this
 < 
rhs
);

140 
DLL_PUBLIC
 
boŞ
 
	gUTCTimeS·n
::
İ”©Ü
<=(cÚ¡ 
UTCTimeS·n
 &
rhs
) const

142  !(*
this
 > 
rhs
);

145 
DLL_PUBLIC
 
UTCTimeS·n
 
	gUTCTimeS·n
::
İ”©Ü
+(cÚ¡ UTCTimeS·À&
rhs
) const

147  
UTCTimeS·n
(
m_£cÚd
 + 
rhs
.
G‘SecÚd
());

150 
DLL_PUBLIC
 
UTCTimeS·n
 
	gUTCTimeS·n
::
İ”©Ü
-(cÚ¡ UTCTimeS·À&
rhs
) const

152  
UTCTimeS·n
(
m_£cÚd
 - 
rhs
.
G‘SecÚd
());

155 
DLL_PUBLIC
 
	gUTCTime
::
	$UTCTime
()

157 
m_ts
.
tv_£c
 = 0;

158 
m_ts
.
tv_n£c
 = 0;

159 
	}
}

161 
DLL_PUBLIC
 
	gUTCTime
::~
	$UTCTime
()

163 
	}
}

168 
DLL_PUBLIC
 
UTCTime
::
	$UTCTime
(cÚ¡ 
UTCTime
 &
rhs
)

170 
m_ts
.
tv_£c
 = 
rhs
.m_ts.tv_sec;

171 
m_ts
.
tv_n£c
 = 
rhs
.m_ts.tv_nsec;

172 
	}
}

174 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
İ”©Ü
=(cÚ¡ 
UTCTime
 &
rhs
)

176 ià(&
rhs
 !ğ
this
)

178 
m_ts
.
tv_£c
 = 
rhs
.m_ts.tv_sec;

179 
	gm_ts
.
	gtv_n£c
 = 
rhs
.
m_ts
.
tv_n£c
;

181  *
	gthis
;

187 
DLL_PUBLIC
 
	gUTCTime
::
	$UTCTime
(cÚ¡ 
time_t
 &
t
)

189 *
this
 = 
t
;

190 
	}
}

192 
DLL_PUBLIC
 
	gUTCTime
::
İ”©Ü
 
	$time_t
() const

194  
m_ts
.
tv_£c
;

195 
	}
}

197 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
İ”©Ü
=(cÚ¡ 
time_t
 &
t
)

199 
m_ts
.
tv_£c
 = 
t
;

200 
	gm_ts
.
	gtv_n£c
 = 0;

202  *
	gthis
;

208 
DLL_PUBLIC
 
	gUTCTime
::
	$UTCTime
(cÚ¡ 
tm
 &
t_tm
)

210 *
this
 = 
t_tm
;

211 
	}
}

213 
DLL_PUBLIC
 
	gUTCTime
::
İ”©Ü
 
	$tm
() const

215 #ià
	`defšed
(
_WIN32
)

216  *
	`gmtime
(&
m_ts
.
tv_£c
);

217 #–ià
	`defšed
(
__lšux__
)

218 
tm
 
t_tm
;

219  *
	`gmtime_r
(&
m_ts
.
tv_£c
, &
t_tm
);

223 
	}
}

225 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
İ”©Ü
=(cÚ¡ 
tm
 &
t_tm
)

227 
tm
 
t_tm_cİy
 = 
t_tm
;

228 
	gm_ts
.
	gtv_£c
 = 
mktime
(&
t_tm_cİy
è- 
G‘LoÿlTimeBŸs
();

229 
	gm_ts
.
	gtv_n£c
 = 0;

231  *
	gthis
;

237 
DLL_PUBLIC
 
	gUTCTime
::
	$UTCTime
(cÚ¡ 
time¥ec
 &
ts
)

239 *
this
 = 
ts
;

240 
	}
}

242 
DLL_PUBLIC
 
	gUTCTime
::
İ”©Ü
 
	$time¥ec
() const

244  
m_ts
;

245 
	}
}

247 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
İ”©Ü
=(cÚ¡ 
time¥ec
 &
ts
)

249 
m_ts
.
tv_£c
 = 
ts
.tv_sec;

250 
	gm_ts
.
	gtv_n£c
 = 
ts
.
tv_n£c
;

252  *
	gthis
;

258 
DLL_PUBLIC
 
	gUTCTime
::
	$UTCTime
(cÚ¡ 
SYSTEMTIME
 &
¡
)

260 *
this
 = 
¡
;

261 
	}
}

263 
DLL_PUBLIC
 
	gUTCTime
::
İ”©Ü
 
	$SYSTEMTIME
() const

265 #ià
	`defšed
(
_WIN32
)

266 
tm
 
t_tm
 = *
	`gmtime
(&
m_ts
.
tv_£c
);

267 #–ià
	`defšed
(
__lšux__
)

268 
tm
 
t_tm
;

269 
	`gmtime_r
(&
m_ts
.
tv_£c
, &
t_tm
);

273 
SYSTEMTIME
 
¡
;

274 
¡
.
wY—r
 = 
t_tm
.
tm_y—r
 + 1900;

275 
¡
.
wMÚth
 = 
t_tm
.
tm_mÚ
 + 1;

276 
¡
.
wDayOfW“k
 = 
t_tm
.
tm_wday
;

277 
¡
.
wDay
 = 
t_tm
.
tm_mday
;

278 
¡
.
wHour
 = 
t_tm
.
tm_hour
;

279 
¡
.
wMšu‹
 = 
t_tm
.
tm_mš
;

280 
¡
.
wSecÚd
 = 
t_tm
.
tm_£c
;

281 
¡
.
wMli£cÚds
 = (
ušt16_t
)(
m_ts
.
tv_n£c
 / 1000000);

283  
¡
;

284 
	}
}

286 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
İ”©Ü
=(cÚ¡ 
SYSTEMTIME
 &
¡
)

288 
tm
 
t_tm
;

289 
	gt_tm
.
	gtm_£c
 = 
¡
.
wSecÚd
;

290 
	gt_tm
.
	gtm_mš
 = 
¡
.
wMšu‹
;

291 
	gt_tm
.
	gtm_hour
 = 
¡
.
wHour
;

292 
	gt_tm
.
	gtm_mday
 = 
¡
.
wDay
;

293 
	gt_tm
.
	gtm_mÚ
 = 
¡
.
wMÚth
 - 1;

294 
	gt_tm
.
	gtm_y—r
 = 
¡
.
wY—r
 - 1900;

295 
	gt_tm
.
	gtm_wday
 = 
¡
.
wDayOfW“k
;

296 
	gt_tm
.
	gtm_yday
 = 0;

297 
	gt_tm
.
	gtm_isd¡
 = 0;

299 
	gm_ts
.
	gtv_£c
 = 
mktime
(&
t_tm
è- 
G‘LoÿlTimeBŸs
();

300 
	gm_ts
.
	gtv_n£c
 = 
¡
.
wMli£cÚds
 * 1000000;

302  *
	gthis
;

308 
DLL_PUBLIC
 
	gUTCTime
::
	$UTCTime
(cÚ¡ 
FILETIME
 &
á
)

310 *
this
 = 
á
;

311 
	}
}

313 
DLL_PUBLIC
 
	gUTCTime
::
İ”©Ü
 
	$FILETIME
() const

315 
ULARGE_INTEGER
 
uli
;

316 
uli
.
QuadP¬t
 = ((
m_ts
.
tv_£c
 + 
EPOCH_DIFFERENCE
è* (
ušt64_t
)10000000è+ (m_ts.
tv_n£c
 / 100);

318 
FILETIME
 
á
;

319 
á
.
dwLowD©eTime
 = 
uli
.
LowP¬t
;

320 
á
.
dwHighD©eTime
 = 
uli
.
HighP¬t
;

322  
á
;

323 
	}
}

325 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
İ”©Ü
=(cÚ¡ 
FILETIME
 &
á
)

327 
ULARGE_INTEGER
 
uli
;

328 
	guli
.
	gLowP¬t
 = 
á
.
dwLowD©eTime
;

329 
	guli
.
	gHighP¬t
 = 
á
.
dwHighD©eTime
;

331 
	gm_ts
.
	gtv_£c
 = (
uli
.
QuadP¬t
 / 10000000è- 
EPOCH_DIFFERENCE
;

332 
	gm_ts
.
	gtv_n£c
 = ()((
uli
.
QuadP¬t
 % 10000000) * 100);

334  *
	gthis
;

337 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
	$S‘TmTime
(

338 cÚ¡ 
tm_y—r
,

339 cÚ¡ 
tm_mÚ
,

340 cÚ¡ 
tm_mday
,

341 cÚ¡ 
tm_hour
 ,

342 cÚ¡ 
tm_mš
 ,

343 cÚ¡ 
tm_£c
 ,

344 cÚ¡ 
tm_mli_£c
 ,

345 cÚ¡ 
tm_miüo_£c
 ,

346 cÚ¡ 
tm_Çno_£c
 )

348 
tm
 
t_tm
;

350 
t_tm
.
tm_£c
 =m_sec;

351 
t_tm
.
tm_mš
 =m_min;

352 
t_tm
.
tm_hour
 =m_hour;

353 
t_tm
.
tm_mday
 =m_mday;

354 
t_tm
.
tm_mÚ
 =m_mon;

355 
t_tm
.
tm_y—r
 =m_year;

356 
t_tm
.
tm_wday
 = 0;

357 
t_tm
.
tm_yday
 = 0;

358 
t_tm
.
tm_isd¡
 = 0;

360 *
this
 = 
t_tm
;

362 
m_ts
.
tv_n£c
 +ğ
tm_mli_£c
 * 1000000 + 
tm_miüo_£c
 * 1000 + 
tm_Çno_£c
;

364  *
this
;

365 
	}
}

367 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
	$S‘Sy¡emTime
(

368 cÚ¡ 
ušt16_t
 
wY—r
,

369 cÚ¡ 
ušt16_t
 
wMÚth
,

370 cÚ¡ 
ušt16_t
 
wDay
,

371 cÚ¡ 
ušt16_t
 
wHour
 ,

372 cÚ¡ 
ušt16_t
 
wMšu‹
 ,

373 cÚ¡ 
ušt16_t
 
wSecÚd
 ,

374 cÚ¡ 
ušt16_t
 
wMli£cÚds
 ,

375 cÚ¡ 
ušt16_t
 
wMiüo£cÚds
 ,

376 cÚ¡ 
ušt16_t
 
wNªo£cÚds
 )

378 
SYSTEMTIME
 
¡
;

380 
¡
.
wY—r
 = wYear;

381 
¡
.
wMÚth
 = wMonth;

382 
¡
.
wDayOfW“k
 = 0;

383 
¡
.
wDay
 = wDay;

384 
¡
.
wHour
 = wHour;

385 
¡
.
wMšu‹
 = wMinute;

386 
¡
.
wSecÚd
 = wSecond;

387 
¡
.
wMli£cÚds
 = wMilliseconds;

389 *
this
 = 
¡
;

391 
m_ts
.
tv_n£c
 +ğ
wMiüo£cÚds
 * 1000 + 
wNªo£cÚds
;

393  *
this
;

394 
	}
}

401 
DLL_PUBLIC
 
time_t
 
	gUTCTime
::
	$G‘LoÿlTimeBŸs
()

403 
tm
 
t_tm
;

404 
t_tm
.
tm_£c
 = 0;

405 
t_tm
.
tm_mš
 = 0;

406 
t_tm
.
tm_hour
 = 0;

407 
t_tm
.
tm_mday
 = 2;

408 
t_tm
.
tm_mÚ
 = 0;

409 
t_tm
.
tm_y—r
 = 70;

410 
t_tm
.
tm_wday
 = 0;

411 
t_tm
.
tm_yday
 = 0;

412 
t_tm
.
tm_isd¡
 = 0;

414  
	`mktime
(&
t_tm
) - 86400;

415 
	}
}

417 
DLL_PUBLIC
 
UTCTime
 
	gUTCTime
::
	$G‘Cu¼’tTime
()

419  
	`UTCTime
(
UTCTime
::
	`G‘Cu¼’tTimeS³c
());

420 
	}
}

422 
DLL_PUBLIC
 
time_t
 
	gUTCTime
::
	$G‘Cu¼’tTimeT
()

424  
	`time
(
NULL
);

425 
	}
}

427 
DLL_PUBLIC
 
tm
 
	gUTCTime
::
	$G‘Cu¼’tTM
()

429 
time_t
 
t
 = 
	`time
(
NULL
);

430 #ià
	`defšed
(
_WIN32
)

431  *
	`gmtime
(&
t
);

432 #–ià
	`defšed
(
__lšux__
)

433 
tm
 
t_tm
;

434  *
	`gmtime_r
(&
t
, &
t_tm
);

438 
	}
}

440 
DLL_PUBLIC
 
time¥ec
 
	gUTCTime
::
	$G‘Cu¼’tTimeCouÁ
()

442 
time¥ec
 
ts
;

443 #ià
	`defšed
(
_WIN32
)

444 
time_t
 
t
 = ::
	`G‘TickCouÁ
();

446 
ts
.
tv_£c
 = 
t
 / 1000;

447 
ts
.
tv_n£c
 = (
t
 % 1000) * 1000000;

448 #–ià
	`defšed
(
__lšux
)

449 
	`şock_g‘time
(
CLOCK_MONOTONIC
, &
ts
);

453  
ts
;

454 
	}
}

456 
DLL_PUBLIC
 
time¥ec
 
	gUTCTime
::
	$G‘Cu¼’tTimeS³c
()

458 
time¥ec
 
ts
;

459 #ià
	`defšed
(
_WIN32
)

460 
FILETIME
 
fs
;

461 
	`G‘Sy¡emTimeAsFeTime
(&
fs
);

463 
ULARGE_INTEGER
 
uli
;

464 
uli
.
LowP¬t
 = 
fs
.
dwLowD©eTime
;

465 
uli
.
HighP¬t
 = 
fs
.
dwHighD©eTime
;

467 
ts
.
tv_£c
 = (
uli
.
QuadP¬t
 / 10000000è- 
EPOCH_DIFFERENCE
;

468 
ts
.
tv_n£c
 = ()((
uli
.
QuadP¬t
 % 10000000) * 100);

469 #–ià
	`defšed
(
__lšux
)

470 
	`şock_g‘time
(
CLOCK_REALTIME
, &
ts
);

474  
ts
;

475 
	}
}

477 
DLL_PUBLIC
 
SYSTEMTIME
 
	gUTCTime
::
	$G‘Cu¼’tSy¡emTime
()

479 
SYSTEMTIME
 
¡
;

480 #ià
	`defšed
(
_WIN32
)

481 
	`G‘Sy¡emTime
(&
¡
);

482 #–ià
	`defšed
(
__lšux
)

483 
time¥ec
 
ts
;

484 
	`şock_g‘time
(
CLOCK_REALTIME
, &
ts
);

486 
tm
 
t_tm
;

487 
	`gmtime_r
(&
ts
.
tv_£c
, &
t_tm
);

488 
¡
.
wY—r
 = 
t_tm
.
tm_y—r
 + 1900;

489 
¡
.
wMÚth
 = 
t_tm
.
tm_mÚ
 + 1;

490 
¡
.
wDayOfW“k
 = 
t_tm
.
tm_wday
;

491 
¡
.
wDay
 = 
t_tm
.
tm_mday
;

492 
¡
.
wHour
 = 
t_tm
.
tm_hour
;

493 
¡
.
wMšu‹
 = 
t_tm
.
tm_mš
;

494 
¡
.
wSecÚd
 = 
t_tm
.
tm_£c
;

495 
¡
.
wMli£cÚds
 = 
ts
.
tv_n£c
 / 1000000;

499  
¡
;

500 
	}
}

502 
DLL_PUBLIC
 
FILETIME
 
	gUTCTime
::
	$G‘Cu¼’tFeTime
()

504 
FILETIME
 
á
;

505 #ià
	`defšed
(
_WIN32
)

506 
	`G‘Sy¡emTimeAsFeTime
(&
á
);

507 #–ià
	`defšed
(
__lšux
)

508 
time¥ec
 
ts
;

509 
	`şock_g‘time
(
CLOCK_REALTIME
, &
ts
);

511 
ULARGE_INTEGER
 
uli
;

512 
uli
.
QuadP¬t
 = ((
ts
.
tv_£c
 + 
EPOCH_DIFFERENCE
è* 10000000è+ (ts.
tv_n£c
 / 100);

514 
á
.
dwLowD©eTime
 = 
uli
.
LowP¬t
;

515 
á
.
dwHighD©eTime
 = 
uli
.
HighP¬t
;

519  
á
;

520 
	}
}

522 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
İ”©Ü
+=(cÚ¡ 
UTCTimeS·n
 &
rhs
)

524 
m_ts
.
tv_£c
 +ğ
rhs
.
G‘SecÚd
();

525  *
	gthis
;

528 
DLL_PUBLIC
 
	gUTCTime
 &UTCTime::
İ”©Ü
-=(cÚ¡ 
UTCTimeS·n
 &
rhs
)

530 
m_ts
.
tv_£c
 -ğ
rhs
.
G‘SecÚd
();

531  *
	gthis
;

534 
DLL_PUBLIC
 
boŞ
 
	gUTCTime
::
İ”©Ü
==(cÚ¡ 
UTCTime
 &
rhs
) const

536  (
m_ts
.
tv_£c
 =ğ
rhs
.m_ts.tv_£cè&& (m_ts.
tv_n£c
 ==„hs.m_ts.tv_nsec);

539 
DLL_PUBLIC
 
boŞ
 
	gUTCTime
::
İ”©Ü
!=(cÚ¡ 
UTCTime
 &
rhs
) const

541  !(*
this
 =ğ
rhs
);

544 
DLL_PUBLIC
 
boŞ
 
	gUTCTime
::
İ”©Ü
>(cÚ¡ 
UTCTime
 &
rhs
) const

546  (
m_ts
.
tv_£c
 > 
rhs
.m_ts.tv_£cè|| ((m_ts.tv_£ø=ğrhs.m_ts.tv_£cè&& (m_ts.
tv_n£c
 >„hs.m_ts.tv_nsec));

549 
DLL_PUBLIC
 
boŞ
 
	gUTCTime
::
İ”©Ü
<(cÚ¡ 
UTCTime
 &
rhs
) const

551  (
m_ts
.
tv_£c
 < 
rhs
.m_ts.tv_£cè|| ((m_ts.tv_£ø=ğrhs.m_ts.tv_£cè&& (m_ts.
tv_n£c
 <„hs.m_ts.tv_nsec));

554 
DLL_PUBLIC
 
boŞ
 
	gUTCTime
::
İ”©Ü
>=(cÚ¡ 
UTCTime
 &
rhs
) const

556  !(*
this
 < 
rhs
);

559 
DLL_PUBLIC
 
boŞ
 
	gUTCTime
::
İ”©Ü
<=(cÚ¡ 
UTCTime
 &
rhs
) const

561  !(*
this
 > 
rhs
);

564 
DLL_PUBLIC
 
UTCTime
 
	gUTCTime
::
İ”©Ü
+(cÚ¡ 
UTCTimeS·n
 &
rhs
) const

566 
time¥ec
 
ts
 = 
m_ts
;

567 
	gts
.
	gtv_£c
 +ğ
rhs
.
G‘SecÚd
();

568  
UTCTime
(
ts
);

571 
DLL_PUBLIC
 
UTCTime
 
	gUTCTime
::
İ”©Ü
-(cÚ¡ 
UTCTimeS·n
 &
rhs
) const

573 
time¥ec
 
ts
 = 
m_ts
;

574 
	gts
.
	gtv_£c
 -ğ
rhs
.
G‘SecÚd
();

575  
UTCTime
(
ts
);

578 
DLL_PUBLIC
 
tm
 
	gSYSUTILS_SPACE
::
	$UTCTimeToLoÿlTime
(cÚ¡ 
tm
 &
t_tm
)

580 
UTCTime
 
	`utc_utc
(
t_tm
);

581 
time_t
 
t
 = 
utc_utc
;

582 #ià
	`defšed
(
_WIN32
)

583  *
	`loÿÉime
(&
t
);

584 #–ià
	`defšed
(
__lšux__
)

585 
tm
 
t_tm_loÿl
;

586  *
	`loÿÉime_r
(&
t
, &
t_tm_loÿl
);

590 
	}
}

592 
DLL_PUBLIC
 
tm
 
	gSYSUTILS_SPACE
::
	$LoÿlTimeToUTCTime
(cÚ¡ 
tm
 &
t_tm
)

594 
tm
 
t_tm_loÿl
 = 
t_tm
;

595 
time_t
 
t
 = 
	`mktime
(&
t_tm_loÿl
);

596 #ià
	`defšed
(
_WIN32
)

597  *
	`gmtime
(&
t
);

598 #–ià
	`defšed
(
__lšux__
)

599 
tm
 
t_tm_utc
;

600  *
	`gmtime_r
(&
t
, &
t_tm_utc
);

604 
	}
}

606 
DLL_PUBLIC
 
SYSTEMTIME
 
	gSYSUTILS_SPACE
::
	$UTCTimeToLoÿlTime
(cÚ¡ 
SYSTEMTIME
 &
¡
)

608 #ià
	`defšed
(
_WIN32
)

609 
SYSTEMTIME
 
¡_loÿl
;

610 
	`Sy¡emTimeToTzS³cificLoÿlTime
(
NULL
, (
LPSYSTEMTIME
è&
¡
, &
¡_loÿl
);

611  
¡_loÿl
;

613 
UTCTime
 
	`utc_utc
(
¡
);

614 
tm
 
t_tm_loÿl
 = 
	`UTCTimeToLoÿlTime
((tm)
utc_utc
);

615 
UTCTime
 
	`utc_loÿl
(
t_tm_loÿl
);

616 
SYSTEMTIME
 
¡_loÿl
 = 
utc_loÿl
;

617 
¡_loÿl
.
wMli£cÚds
 = 
¡
.wMilliseconds;

618  
¡_loÿl
;

620 
	}
}

622 
DLL_PUBLIC
 
SYSTEMTIME
 
	gSYSUTILS_SPACE
::
	$LoÿlTimeToUTCTime
(cÚ¡ 
SYSTEMTIME
 &
¡
)

624 #ià
	`defšed
(
_WIN32
)

625 
SYSTEMTIME
 
¡_utc
;

626 
	`TzS³cificLoÿlTimeToSy¡emTime
(
NULL
, (
LPSYSTEMTIME
è&
¡
, &
¡_utc
);

627  
¡_utc
;

629 
UTCTime
 
	`utc_loÿl
(
¡
);

630 
tm
 
t_tm_utc
 = 
	`LoÿlTimeToUTCTime
((tm)
utc_loÿl
);

631 
UTCTime
 
	`utc_utc
(
t_tm_utc
);

632 
SYSTEMTIME
 
¡_utc
 = 
utc_utc
;

633 
¡_utc
.
wMli£cÚds
 = 
¡
.wMilliseconds;

634  
¡_utc
;

636 
	}
}

638 
DLL_PUBLIC
 
tm
 
	gSYSUTILS_SPACE
::
	$UTCTimeToLoÿlTime
(cÚ¡ 
tm
 &
t_tm
, cÚ¡ 
št32_t
 
tz_£c
, cÚ¡ iÁ32_ˆ
d¡_£c
)

640 
UTCTime
 
	`utc_utc
(
t_tm
);

641 
time_t
 
t
 = (Ñime_t)
utc_utc
è+ 
tz_£c
 + 
d¡_£c
;

642 #ià
	`defšed
(
_WIN32
)

643  *
	`gmtime
(&
t
);

644 #–ià
	`defšed
(
__lšux__
)

645 
tm
 
t_tm_loÿl
;

646  *
	`gmtime_r
(&
t
, &
t_tm_loÿl
);

650 
	}
}

652 
DLL_PUBLIC
 
tm
 
	gSYSUTILS_SPACE
::
	$LoÿlTimeToUTCTime
(cÚ¡ 
tm
 &
t_tm
, cÚ¡ 
št32_t
 
tz_£c
, cÚ¡ iÁ32_ˆ
d¡_£c
)

654 
UTCTime
 
utc_loÿl
 = 
t_tm
;

655 
time_t
 
t
 = (Ñime_t)
utc_loÿl
è- 
tz_£c
 - 
d¡_£c
;

656 #ià
	`defšed
(
_WIN32
)

657  *
	`gmtime
(&
t
);

658 #–ià
	`defšed
(
__lšux__
)

659 
tm
 
t_tm_utc
;

660  *
	`gmtime_r
(&
t
, &
t_tm_utc
);

664 
	}
}

666 
DLL_PUBLIC
 
SYSTEMTIME
 
	gSYSUTILS_SPACE
::
	$UTCTimeToLoÿlTime
(cÚ¡ 
SYSTEMTIME
 &
¡
, cÚ¡ 
št32_t
 
tz_£c
, cÚ¡ iÁ32_ˆ
d¡_£c
)

668 
UTCTime
 
	`utc_utc
(
¡
);

669 
tm
 
t_tm_loÿl
 = 
	`UTCTimeToLoÿlTime
((tm)
utc_utc
, 
tz_£c
, 
d¡_£c
);

670 
UTCTime
 
	`utc_loÿl
(
t_tm_loÿl
);

671 
SYSTEMTIME
 
¡_loÿl
 = 
utc_loÿl
;

672 
¡_loÿl
.
wMli£cÚds
 = 
¡
.wMilliseconds;

673  
¡_loÿl
;

674 
	}
}

676 
DLL_PUBLIC
 
SYSTEMTIME
 
	gSYSUTILS_SPACE
::
	$LoÿlTimeToUTCTime
(cÚ¡ 
SYSTEMTIME
 &
¡
, cÚ¡ 
št32_t
 
tz_£c
, cÚ¡ iÁ32_ˆ
d¡_£c
)

678 
UTCTime
 
	`utc_loÿl
(
¡
);

679 
tm
 
t_tm_utc
 = 
	`LoÿlTimeToUTCTime
((tm)
utc_loÿl
, 
tz_£c
, 
d¡_£c
);

680 
UTCTime
 
	`utc_utc
(
t_tm_utc
);

681 
SYSTEMTIME
 
¡_utc
 = 
utc_utc
;

682 
¡_utc
.
wMli£cÚds
 = 
¡
.wMilliseconds;

683  
¡_utc
;

684 
	}
}

686 
DLL_PUBLIC
 
ULARGE_INTEGER
 
	gSYSUTILS_SPACE
::
	$á_to_uli
(cÚ¡ 
FILETIME
 &
á
)

688 
ULARGE_INTEGER
 
uli
 = {{0, 0}};

689 
uli
.
LowP¬t
 = 
á
.
dwLowD©eTime
;

690 
uli
.
HighP¬t
 = 
á
.
dwHighD©eTime
;

691  
uli
;

692 
	}
}

694 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$á_to_u64
(cÚ¡ 
FILETIME
 &
á
)

696 
ULARGE_INTEGER
 
uli
 = {{0, 0}};

697 
uli
.
LowP¬t
 = 
á
.
dwLowD©eTime
;

698 
uli
.
HighP¬t
 = 
á
.
dwHighD©eTime
;

699  
uli
.
QuadP¬t
;

700 
	}
}

702 
DLL_PUBLIC
 
FILETIME
 
	gSYSUTILS_SPACE
::
	$uli_to_á
(cÚ¡ 
ULARGE_INTEGER
 &
uli
)

704 
FILETIME
 
á
 = {0, 0};

705 
á
.
dwLowD©eTime
 = 
uli
.
LowP¬t
;

706 
á
.
dwHighD©eTime
 = 
uli
.
HighP¬t
;

707  
á
;

708 
	}
}

710 
DLL_PUBLIC
 
ušt64_t
 
	gSYSUTILS_SPACE
::
	$uli_to_u64
(cÚ¡ 
ULARGE_INTEGER
 &
uli
)

712  
uli
.
QuadP¬t
;

713 
	}
}

715 
DLL_PUBLIC
 
FILETIME
 
	gSYSUTILS_SPACE
::
	$u64_to_á
(cÚ¡ 
ušt64_t
 &
u64
)

717 
ULARGE_INTEGER
 
uli
 = {{0, 0}};

718 
uli
.
QuadP¬t
 = 
u64
;

719 
FILETIME
 
á
 = {0, 0};

720 
á
.
dwLowD©eTime
 = 
uli
.
LowP¬t
;

721 
á
.
dwHighD©eTime
 = 
uli
.
HighP¬t
;

722  
á
;

723 
	}
}

725 
DLL_PUBLIC
 
ULARGE_INTEGER
 
	gSYSUTILS_SPACE
::
	$u64_to_uli
(cÚ¡ 
ušt64_t
 &
u64
)

727 
ULARGE_INTEGER
 
uli
 = {{0, 0}};

728 
uli
.
QuadP¬t
 = 
u64
;

729  
uli
;

730 
	}
}

	@../common/time.h

1 #iâdeà
__SYSUTILS_TIME_H__


2 
	#__SYSUTILS_TIME_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~<time.h
>

13 
	#EPOCH_DIFFERENCE
 
	`INT64_C
(11644473600è

	)

15 #ià
defšed
(
_WIN32
)

17 #iâdeà
WIN32_LEAN_AND_MEAN


18 
	#WIN32_LEAN_AND_MEAN


20 
	~<Wšdows.h
>

	)

23 
	stime¥ec
 {

24 
time_t
 
	mtv_£c
;

25 
	mtv_n£c
;

28 #–ià
defšed
(
__lšux
)

31 
	s_SYSTEMTIME


33 
ušt16_t
 
	mwY—r
;

34 
ušt16_t
 
	mwMÚth
;

35 
ušt16_t
 
	mwDayOfW“k
;

36 
ušt16_t
 
	mwDay
;

37 
ušt16_t
 
	mwHour
;

38 
ušt16_t
 
	mwMšu‹
;

39 
ušt16_t
 
	mwSecÚd
;

40 
ušt16_t
 
	mwMli£cÚds
;

41 } 
	tSYSTEMTIME
, *
	tPSYSTEMTIME
;

44 
	s_FILETIME


46 
ušt32_t
 
	mdwLowD©eTime
;

47 
ušt32_t
 
	mdwHighD©eTime
;

48 } 
	tFILETIME
, *
	tPFILETIME
;

51 
	u_ULARGE_INTEGER


55 
ušt32_t
 
	mLowP¬t
;

56 
ušt32_t
 
	mHighP¬t
;

60 
ušt32_t
 
	mLowP¬t
;

61 
ušt32_t
 
	mHighP¬t
;

62 } 
	mu
;

63 
ušt64_t
 
	mQuadP¬t
;

64 } 
	tULARGE_INTEGER
, *
	tPULARGE_INTEGER
;

70 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

72 şas 
	cDLL_PUBLIC
 
	gUTCTimeS·n


74 
	gpublic
:

75 
UTCTimeS·n
();

76 ~
UTCTimeS·n
();

78 
UTCTimeS·n
(cÚ¡ UTCTimeS·À&
rhs
);

79 
UTCTimeS·n
(cÚ¡ 
št32_t
 
£cÚd
);

80 
UTCTimeS·n
(cÚ¡ 
št32_t
 
mšu‹
, cÚ¡ iÁ32_ˆ
£cÚd
);

81 
UTCTimeS·n
(cÚ¡ 
št32_t
 
hour
, cÚ¡ iÁ32_ˆ
mšu‹
, cÚ¡ iÁ32_ˆ
£cÚd
);

82 
UTCTimeS·n
(cÚ¡ 
št32_t
 
day
, iÁ32_ˆ
hour
, cÚ¡ iÁ32_ˆ
mšu‹
, cÚ¡ iÁ32_ˆ
£cÚd
);

84 
	gUTCTimeS·n
 &
	gİ”©Ü
=(cÚ¡ 
UTCTimeS·n
 &
rhs
);

85 
	gUTCTimeS·n
 &
	gİ”©Ü
+=(cÚ¡ 
UTCTimeS·n
 &
rhs
);

86 
	gUTCTimeS·n
 &
	gİ”©Ü
-=(cÚ¡ 
UTCTimeS·n
 &
rhs
);

88 
št32_t
 
G‘SecÚd
() const;

89 
št32_t
 
G‘Residu®SecÚd
() const;

90 
št32_t
 
G‘Mšu‹
() const;

91 
št32_t
 
G‘Residu®Mšu‹
() const;

92 
št32_t
 
G‘Hour
() const;

93 
št32_t
 
G‘Residu®Hour
() const;

94 
št32_t
 
G‘Day
() const;

96 
S‘SecÚd
(cÚ¡ 
št32_t
 
£cÚd
);

97 
S‘Mšu‹
(cÚ¡ 
št32_t
 
mšu‹
, cÚ¡ iÁ32_ˆ
£cÚd
=0);

98 
S‘Hour
(cÚ¡ 
št32_t
 
hour
, cÚ¡ iÁ32_ˆ
mšu‹
=0, cÚ¡ iÁ32_ˆ
£cÚd
=0);

99 
S‘Day
(cÚ¡ 
št32_t
 
day
, cÚ¡ iÁ32_ˆ
hour
=0, cÚ¡ iÁ32_ˆ
mšu‹
=0, cÚ¡ iÁ32_ˆ
£cÚd
=0);

101 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
UTCTimeS·n
 &
rhs
) const;

102 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
UTCTimeS·n
 &
rhs
) const;

103 
boŞ
 
	gİ”©Ü
>(cÚ¡ 
	gUTCTimeS·n
 &
	grhs
) const;

104 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gUTCTimeS·n
 &
	grhs
) const;

105 
boŞ
 
	gİ”©Ü
>=(cÚ¡ 
UTCTimeS·n
 &
rhs
) const;

106 
boŞ
 
	gİ”©Ü
<=(cÚ¡ 
UTCTimeS·n
 &
rhs
) const;

108 
UTCTimeS·n
 
	gİ”©Ü
+(cÚ¡ 
	gUTCTimeS·n
 &
	grhs
) const;

109 
UTCTimeS·n
 
	gİ”©Ü
-(cÚ¡ 
	gUTCTimeS·n
 &
	grhs
) const;

111 
	g´iv©e
:

112 
št32_t
 
m_£cÚd
;

115 şas 
	cDLL_PUBLIC
 
	gUTCTime


117 
	gpublic
:

118 
UTCTime
();

119 ~
UTCTime
();

121 
UTCTime
(cÚ¡ UTCTim&
rhs
);

122 
UTCTime
(cÚ¡ 
time_t
 &
t
);

123 
UTCTime
(cÚ¡ 
tm
 &
t_tm
);

124 
UTCTime
(cÚ¡ 
time¥ec
 &
ts
);

125 
UTCTime
(cÚ¡ 
SYSTEMTIME
 &
¡
);

126 
UTCTime
(cÚ¡ 
FILETIME
 &
á
);

128 
	gUTCTime
 &
	gİ”©Ü
=(cÚ¡ 
UTCTime
 &
rhs
);

129 
	gUTCTime
 &
	gİ”©Ü
=(cÚ¡ 
time_t
 &
t
);

130 
	gUTCTime
 &
	gİ”©Ü
=(cÚ¡ 
tm
 &
t_tm
);

131 
	gUTCTime
 &
	gİ”©Ü
=(cÚ¡ 
time¥ec
 &
ts
);

132 
	gUTCTime
 &
	gİ”©Ü
=(cÚ¡ 
SYSTEMTIME
 &
¡
);

133 
	gUTCTime
 &
	gİ”©Ü
=(cÚ¡ 
FILETIME
 &
á
);

135 
İ”©Ü
 
time_t
() const;

136 
İ”©Ü
 
tm
() const;

137 
İ”©Ü
 
time¥ec
() const;

138 
İ”©Ü
 
SYSTEMTIME
() const;

139 
İ”©Ü
 
FILETIME
() const;

141 
	gUTCTime
 &
S‘TmTime
(

142 cÚ¡ 
tm_y—r
,

143 cÚ¡ 
tm_mÚ
,

144 cÚ¡ 
tm_mday
,

145 cÚ¡ 
tm_hour
=0,

146 cÚ¡ 
tm_mš
=0,

147 cÚ¡ 
tm_£c
=0,

148 cÚ¡ 
tm_mli_£c
=0,

149 cÚ¡ 
tm_miüo_£c
=0,

150 cÚ¡ 
tm_Çno_£c
=0);

152 
	gUTCTime
 &
S‘Sy¡emTime
(

153 cÚ¡ 
ušt16_t
 
wY—r
,

154 cÚ¡ 
ušt16_t
 
wMÚth
,

155 cÚ¡ 
ušt16_t
 
wDay
,

156 cÚ¡ 
ušt16_t
 
wHour
=0,

157 cÚ¡ 
ušt16_t
 
wMšu‹
=0,

158 cÚ¡ 
ušt16_t
 
wSecÚd
=0,

159 cÚ¡ 
ušt16_t
 
wMli£cÚds
=0,

160 cÚ¡ 
ušt16_t
 
wMiüo£cÚds
=0,

161 cÚ¡ 
ušt16_t
 
wNªo£cÚds
=0);

163 
UTCTime
 
G‘Cu¼’tTime
();

164 
time_t
 
G‘Cu¼’tTimeT
();

165 
tm
 
G‘Cu¼’tTM
();

166 
time¥ec
 
G‘Cu¼’tTimeS³c
();

167 
time¥ec
 
G‘Cu¼’tTimeCouÁ
();

168 
SYSTEMTIME
 
G‘Cu¼’tSy¡emTime
();

169 
FILETIME
 
G‘Cu¼’tFeTime
();

171 
	gUTCTime
 &
	gİ”©Ü
+=(cÚ¡ 
UTCTimeS·n
 &
rhs
);

172 
	gUTCTime
 &
	gİ”©Ü
-=(cÚ¡ 
UTCTimeS·n
 &
rhs
);

174 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
UTCTime
 &
rhs
) const;

175 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
UTCTime
 &
rhs
) const;

176 
boŞ
 
	gİ”©Ü
>(cÚ¡ 
	gUTCTime
 &
	grhs
) const;

177 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gUTCTime
 &
	grhs
) const;

178 
boŞ
 
	gİ”©Ü
>=(cÚ¡ 
UTCTime
 &
rhs
) const;

179 
boŞ
 
	gİ”©Ü
<=(cÚ¡ 
UTCTime
 &
rhs
) const;

181 
UTCTime
 
	gİ”©Ü
+(cÚ¡ 
	gUTCTimeS·n
 &
	grhs
) const;

182 
UTCTime
 
	gİ”©Ü
-(cÚ¡ 
	gUTCTimeS·n
 &
	grhs
) const;

184 
	g´iv©e
:

185 
time_t
 
G‘LoÿlTimeBŸs
();

187 
	g´iv©e
:

188 
time¥ec
 
m_ts
;

191 
DLL_PUBLIC
 
tm
 
UTCTimeToLoÿlTime
(cÚ¡ tm &
t_tm
);

192 
DLL_PUBLIC
 
tm
 
LoÿlTimeToUTCTime
(cÚ¡ tm &
t_tm
);

193 
DLL_PUBLIC
 
SYSTEMTIME
 
UTCTimeToLoÿlTime
(cÚ¡ SYSTEMTIME &
¡
);

194 
DLL_PUBLIC
 
SYSTEMTIME
 
LoÿlTimeToUTCTime
(cÚ¡ SYSTEMTIME &
¡
);

196 
DLL_PUBLIC
 
tm
 
UTCTimeToLoÿlTime
(cÚ¡ tm &
t_tm
, cÚ¡ 
št32_t
 
tz_£c
, cÚ¡ iÁ32_ˆ
d¡_£c
);

197 
DLL_PUBLIC
 
tm
 
LoÿlTimeToUTCTime
(cÚ¡ tm &
t_tm
, cÚ¡ 
št32_t
 
tz_£c
, cÚ¡ iÁ32_ˆ
d¡_£c
);

198 
DLL_PUBLIC
 
SYSTEMTIME
 
UTCTimeToLoÿlTime
(cÚ¡ SYSTEMTIME &
¡
, cÚ¡ 
št32_t
 
tz_£c
, cÚ¡ iÁ32_ˆ
d¡_£c
);

199 
DLL_PUBLIC
 
SYSTEMTIME
 
LoÿlTimeToUTCTime
(cÚ¡ SYSTEMTIME &
¡
, cÚ¡ 
št32_t
 
tz_£c
, cÚ¡ iÁ32_ˆ
d¡_£c
);

201 
DLL_PUBLIC
 
ULARGE_INTEGER
 
á_to_uli
(cÚ¡ 
FILETIME
 &
á
);

202 
DLL_PUBLIC
 
ušt64_t
 
á_to_u64
(cÚ¡ 
FILETIME
 &
á
);

203 
DLL_PUBLIC
 
FILETIME
 
uli_to_á
(cÚ¡ 
ULARGE_INTEGER
 &
uli
);

204 
DLL_PUBLIC
 
ušt64_t
 
uli_to_u64
(cÚ¡ 
ULARGE_INTEGER
 &
uli
);

205 
DLL_PUBLIC
 
FILETIME
 
u64_to_á
(cÚ¡ 
ušt64_t
 &
u64
);

206 
DLL_PUBLIC
 
ULARGE_INTEGER
 
u64_to_uli
(cÚ¡ 
ušt64_t
 &
u64
);

	@../common/unittest/directory_traverse_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"commÚ/dœeùÜy_Œav”£.h
"

4 
	~<¡ršg
>

5 
	~<li¡
>

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
	$TEST
(
DœeùÜyT¿v”£
, 
T¿v”£Te¡
)

12 
DœeùÜyT¿v”£
 
	`dt_pwd_nÚ_»cursive
(".", 
çl£
);

13 
dt_pwd_nÚ_»cursive
.
	`Next
())

18 
DœeùÜyT¿v”£
 
	`dt_pwd_»cursive
(".", 
Œue
);

19 
dt_pwd_»cursive
.
	`Next
())

24 
DœeùÜyT¿v”£
 
	`dt_·»Á_nÚ_»cursive
("..", 
çl£
);

25 
dt_·»Á_nÚ_»cursive
.
	`Next
())

30 
DœeùÜyT¿v”£
 
	`dt_·»Á_»cursive
("..", 
Œue
);

31 
dt_·»Á_»cursive
.
	`Next
())

36 
DœeùÜyT¿v”£
 
	`dt_g¿nd_·»Á_nÚ_»cursive
("../..", 
çl£
);

37 
dt_g¿nd_·»Á_nÚ_»cursive
.
	`Next
())

42 
DœeùÜyT¿v”£
 
	`dt_g¿nd_·»Á_»cursive
("../..", 
Œue
);

43 
dt_g¿nd_·»Á_»cursive
.
	`Next
())

47 
	}
}

49 
	g¡d
::
li¡
<
¡d
::
¡ršg
> 
	$T¿v”£SubFŞd”
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
)

51 
¡d
::
li¡
<¡d::
¡ršg
> 
·ths
;

52 
DœeùÜyT¿v”£
 
	`dt
(
·thÇme
, 
çl£
);

53 
dt
.
	`Next
())

55 
¡d
::
¡ršg
 
sub·th
 = 
dt
.
	`G‘P©hName
();

56 
·ths
.
	`push_back
(
sub·th
);

57 ià((
dt
.
	`G‘FÏgs
(è& 
DœeùÜyT¿v”£
::
FLAG_DIRECTORY
) != 0)

59 
¡d
::
li¡
<¡d::
¡ršg
> 
sub·ths
 = 
	`T¿v”£SubFŞd”
(
sub·th
);

60 
·ths
.
	`š£¹
Õ©hs.
	`’d
(), 
sub·ths
.
	`begš
(), subpaths.end());

63  
·ths
;

64 
	}
}

66 
	$TEST
(
DœeùÜyT¿v”£
, 
RecursiveTe¡
)

68 
¡d
::
¡ršg
 
	`roÙ·th
("../..");

69 
¡d
::
li¡
<¡d::
¡ršg
> 
·ths
 = 
	`T¿v”£SubFŞd”
(
roÙ·th
);

70 
DœeùÜyT¿v”£
 
	`dt
(
roÙ·th
, 
Œue
);

71 
¡d
::
li¡
<¡d::
¡ršg
>::
™”©Ü
 
™
 = 
·ths
.
	`begš
(); iˆ!ğ·ths.
	`’d
(); it++)

73 
	`EXPECT_TRUE
(
dt
.
	`Next
());

74 
	`EXPECT_STREQ
((*
™
).
	`c_¡r
(), 
dt
.
	`G‘P©hName
().c_str());

76 
	`EXPECT_FALSE
(
dt
.
	`Next
());

77 
	}
}

	@../common/unittest/file_test.cpp

1 
	~"commÚ/¡dšt.h
"

3 
	~"g‹¡/g‹¡.h
"

4 
	~"commÚ/fe.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
	$TEST
(
Fe
, 
ResŞveP©hTe¡
)

10 
	`EXPECT_STREQ
("", 
	`ResŞveP©h
("").
	`c_¡r
());

11 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/").
	`c_¡r
());

12 
	`EXPECT_STREQ
("/abc", 
	`ResŞveP©h
("/abc").
	`c_¡r
());

13 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/.").
	`c_¡r
());

14 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/./").
	`c_¡r
());

15 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/..").
	`c_¡r
());

16 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/../").
	`c_¡r
());

17 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/./.").
	`c_¡r
());

18 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/././").
	`c_¡r
());

19 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/../..").
	`c_¡r
());

20 
	`EXPECT_STREQ
("/", 
	`ResŞveP©h
("/../../").
	`c_¡r
());

21 
	}
}

23 
	$TEST
(
Fe
, 
FeSizeTe¡
)

25 
	`EXPECT_EQ
(
	`UINT64_C
(0), 
	`G‘FeStÜageSize
("not_existed_file"));

26 
	`EXPECT_NE
(
	`UINT64_C
(0), 
	`G‘FeStÜageSize
("test.bin"));

27 
	`EXPECT_EQ
(
	`UINT64_C
(0), 
	`G‘DœeùÜyStÜageSize
("not_existed_directory"));

28 
	`EXPECT_NE
(
	`UINT64_C
(0), 
	`G‘DœeùÜyStÜageSize
("."));

29 
	`EXPECT_NE
(
	`UINT64_C
(0), 
	`G‘DœeùÜyStÜageSize
(".."));

30 
	}
}

32 
	$TEST
(
Fe
, 
S¶™P©hTe¡
)

34 
S¶™P©hD©a
 
d©a
;

36 
¡d
::
¡ršg
 
cwd
 = 
	`G‘Cu¼’tWÜkšgDœeùÜy
();

37 
	`EXPECT_STRNE
("", 
cwd
.
	`c_¡r
());

39 
	`EXPECT_TRUE
(
	`S¶™P©h
("/u¤/bš/mª", 
d©a
));

40 
	`EXPECT_STREQ
("/u¤/bš", 
d©a
.
·»Á_·th
.
	`c_¡r
());

41 
	`EXPECT_STREQ
("mª", 
d©a
.
fe_Çme
.
	`c_¡r
());

42 
	`EXPECT_STREQ
("mª", 
d©a
.
fe_ba£
.
	`c_¡r
());

43 
	`EXPECT_STREQ
("", 
d©a
.
fe_ex‹nsiÚ
.
	`c_¡r
());

52 
	`EXPECT_TRUE
(
	`S¶™P©h
("/¯a/bbb/ccc.ddd.“e", 
d©a
));

53 
	`EXPECT_STREQ
("/¯a/bbb", 
d©a
.
·»Á_·th
.
	`c_¡r
());

54 
	`EXPECT_STREQ
("ccc.ddd.“e", 
d©a
.
fe_Çme
.
	`c_¡r
());

55 
	`EXPECT_STREQ
("ccc.ddd", 
d©a
.
fe_ba£
.
	`c_¡r
());

56 
	`EXPECT_STREQ
("“e", 
d©a
.
fe_ex‹nsiÚ
.
	`c_¡r
());

58 
	`EXPECT_TRUE
(
	`S¶™P©h
("/¯a/bbb/ccc/", 
d©a
));

59 
	`EXPECT_STREQ
("/¯a/bbb", 
d©a
.
·»Á_·th
.
	`c_¡r
());

60 
	`EXPECT_STREQ
("ccc", 
d©a
.
fe_Çme
.
	`c_¡r
());

61 
	`EXPECT_STREQ
("ccc", 
d©a
.
fe_ba£
.
	`c_¡r
());

62 
	`EXPECT_STREQ
("", 
d©a
.
fe_ex‹nsiÚ
.
	`c_¡r
());

64 
	`EXPECT_TRUE
(
	`S¶™P©h
("/¯a.bbb.ccc", 
d©a
));

65 
	`EXPECT_STREQ
("", 
d©a
.
·»Á_·th
.
	`c_¡r
());

66 
	`EXPECT_STREQ
("¯a.bbb.ccc", 
d©a
.
fe_Çme
.
	`c_¡r
());

67 
	`EXPECT_STREQ
("¯a.bbb", 
d©a
.
fe_ba£
.
	`c_¡r
());

68 
	`EXPECT_STREQ
("ccc", 
d©a
.
fe_ex‹nsiÚ
.
	`c_¡r
());

70 
	`EXPECT_TRUE
(
	`S¶™P©h
("¯a.bbb.ccc", 
d©a
));

71 
	`EXPECT_STREQ
(
cwd
.
	`c_¡r
(), 
d©a
.
·»Á_·th
.c_str());

72 
	`EXPECT_STREQ
("¯a.bbb.ccc", 
d©a
.
fe_Çme
.
	`c_¡r
());

73 
	`EXPECT_STREQ
("¯a.bbb", 
d©a
.
fe_ba£
.
	`c_¡r
());

74 
	`EXPECT_STREQ
("ccc", 
d©a
.
fe_ex‹nsiÚ
.
	`c_¡r
());

75 
	}
}

	@../common/unittest/hardware_test.cpp

1 
	~"commÚ/¡dšt.h
"

3 
	~"g‹¡/g‹¡.h
"

4 
	~"commÚ/h¬dw¬e.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
	$TEST
(
H¬dw¬e
, 
G‘DiskS·ûTe¡
)

10 cÚ¡ 
·th
[] = "/";

11 
ušt64_t
 
avaabË
;

12 
ušt64_t
 
ä“
;

13 
ušt64_t
 
tÙ®
;

14 
	`EXPECT_TRUE
(
	`G‘DiskS·û
(
·th
, &
avaabË
, &
ä“
, &
tÙ®
));

15 
	`EXPECT_NE
(
	`UINT64_C
(0), 
avaabË
);

16 
	`EXPECT_NE
(
	`UINT64_C
(0), 
ä“
);

17 
	`EXPECT_NE
(
	`UINT64_C
(0), 
tÙ®
);

18 
	`EXPECT_LE
(
avaabË
, 
ä“
);

19 
	`EXPECT_LE
(
ä“
, 
tÙ®
);

20 
	}
}

22 
	$TEST
(
H¬dw¬e
, 
G‘N‘wÜkAd­‹rsTe¡
)

24 
¡d
::
veùÜ
<
N‘wÜkAd­‹rInfo
> 
šfos
;

25 
	`EXPECT_TRUE
(
	`G‘N‘wÜkAd­‹rs
(
šfos
));

26 
	}
}

	@../common/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../common/unittest/observer_test.cpp

1 
	~"commÚ/ob£rv”.h
"

3 
	~"g‹¡/g‹¡.h
"

5 
	~<veùÜ
>

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 şas 
	cReûiv”
: 
public
 
Ob£rv”


11 
public
:

12 
	$Reûiv”
(
ušt32_t
 
ba£_numb”
): 
	$m_ba£_numb”
(
ba£_numb”
)

14 ~
	$Reûiv”
()

15 {
	}
}

16 
	$Upd©e
(
ušt32_t
 
nÙify
, *
·¿m
, ušt32_ˆ
f‹r
)

18 
s_nÙify_numb”s
.
	`push_back
((
ušt32_t
)
nÙify
);

19 
s_·¿m_numb”s
.
	`push_back
(
m_ba£_numb”
 + (
ušt32_t
)
·¿m
);

20 
	}
}

22 
	gpublic
:

23 
¡d
::
veùÜ
<
ušt32_t
> 
s_nÙify_numb”s
;

24 
	g¡d
::
veùÜ
<
ušt32_t
> 
s_·¿m_numb”s
;

26 
	g´iv©e
:

27 
ušt32_t
 
m_ba£_numb”
;

30 
	g¡d
::
veùÜ
<
ušt32_t
> 
Reûiv”
::
s_nÙify_numb”s
;

31 
	g¡d
::
veùÜ
<
ušt32_t
> 
Reûiv”
::
s_·¿m_numb”s
;

33 
	$TEST
(
Ob£rv”Te¡
, 
NÙifyTe¡
)

35 
Subjeù
 
brßdÿ¡”
;

36 
¡d
::
veùÜ
<
Reûiv”
 *> 
»ûiv”s
;

38 
i
 = 0; i < 10000; i += 100)

40 
Reûiv”
 *
»ûiv”
 = 
Ãw
 
	`Reûiv”
((
ušt32_t
)
i
);

41 
	`EXPECT_NE
((
Reûiv”
 *)
NULL
, 
»ûiv”
);

42 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`A‰achOb£rv”
(
»ûiv”
));

43 
»ûiv”s
.
	`push_back
(
»ûiv”
);

46 
i
 = 0; i < 100; i++)

48 
brßdÿ¡”
.
	`NÙifyOb£rv”
((
ušt32_t
)
i
, (*)i);

51 
	`EXPECT_EQ
((
size_t
)10000, 
Reûiv”
::
s_nÙify_numb”s
.
	`size
());

52 
	`EXPECT_EQ
((
size_t
)10000, 
Reûiv”
::
s_·¿m_numb”s
.
	`size
());

54 
size_t
 
i
 = 0; i < 
Reûiv”
::
s_nÙify_numb”s
.
	`size
(); i++)

56 
	`EXPECT_EQ
(
i
 / 100, 
Reûiv”
::
s_nÙify_numb”s
[i]);

59 
size_t
 
i
 = 0; i < 
Reûiv”
::
s_·¿m_numb”s
.
	`size
(); i++)

61 
	`EXPECT_EQ
((
i
 % 100è* 100 + (˜/ 100), 
Reûiv”
::
s_·¿m_numb”s
[i]);

64 
i
 = 0; i < 100; i++)

66 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`D‘achOb£rv”
(
»ûiv”s
[
i
]));

67 
d–‘e
 
»ûiv”s
[
i
];

69 
»ûiv”s
.
	`ş—r
();

70 
	}
}

72 şas 
	cF‹rReûiv”
: 
public
 
Ob£rv”


74 
public
:

75 
	$F‹rReûiv”
()

77 ~
	$F‹rReûiv”
()

78 {
	}
}

79 
	$Upd©e
(
ušt32_t
 
nÙify
, *
·¿m
, ušt32_ˆ
f‹r
)

81 ià(
nÙify
 =ğ
s_nÙify_no_f‹r
)

83 
s_no_f‹r_couÁ
++;

85 ià(
nÙify
 =ğ
s_nÙify_®l_f‹r
)

87 
s_®l_f‹r_couÁ
++;

89 ià(
nÙify
 =ğ
s_nÙify_ev’_f‹r
)

91 
s_ev’_f‹r_couÁ
++;

93 ià(
nÙify
 =ğ
s_nÙify_odd_f‹r
)

95 
s_odd_f‹r_couÁ
++;

97 
	}
}

98 cÚ¡ 
ušt32_t
 
	gs_nÙify_no_f‹r
;

99 cÚ¡ 
ušt32_t
 
	gs_nÙify_®l_f‹r
;

100 cÚ¡ 
ušt32_t
 
	gs_nÙify_ev’_f‹r
;

101 cÚ¡ 
ušt32_t
 
	gs_nÙify_odd_f‹r
;

102 
ušt32_t
 
	gs_no_f‹r_couÁ
;

103 
ušt32_t
 
	gs_®l_f‹r_couÁ
;

104 
ušt32_t
 
	gs_ev’_f‹r_couÁ
;

105 
ušt32_t
 
	gs_odd_f‹r_couÁ
;

108 cÚ¡ 
ušt32_t
 
	gF‹rReûiv”
::
s_nÙify_no_f‹r
 = 0;

109 cÚ¡ 
ušt32_t
 
	gF‹rReûiv”
::
s_nÙify_®l_f‹r
 = 1;

110 cÚ¡ 
ušt32_t
 
	gF‹rReûiv”
::
s_nÙify_ev’_f‹r
 = 2;

111 cÚ¡ 
ušt32_t
 
	gF‹rReûiv”
::
s_nÙify_odd_f‹r
 = 3;

112 
ušt32_t
 
	gF‹rReûiv”
::
s_no_f‹r_couÁ
 = 0;

113 
ušt32_t
 
	gF‹rReûiv”
::
s_®l_f‹r_couÁ
 = 0;

114 
ušt32_t
 
	gF‹rReûiv”
::
s_ev’_f‹r_couÁ
 = 0;

115 
ušt32_t
 
	gF‹rReûiv”
::
s_odd_f‹r_couÁ
 = 0;

117 
	$TEST
(
Ob£rv”Te¡
, 
F‹rTe¡
)

119 
Subjeù
 
brßdÿ¡”
;

120 
F‹rReûiv”
 
»ûiv”
;

122 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`A‰achOb£rv”
(&
»ûiv”
, 0x00000000));

123 
i
 = 0; i < 100; i++)

125 
brßdÿ¡”
.
	`NÙifyOb£rv”
(
F‹rReûiv”
::
s_nÙify_no_f‹r
, 
NULL
);

127 
	`EXPECT_EQ
((
ušt32_t
)0, 
F‹rReûiv”
::
s_no_f‹r_couÁ
);

128 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`D‘achOb£rv”
(&
»ûiv”
));

130 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`A‰achOb£rv”
(&
»ûiv”
, 0xFFFFFFFF));

131 
i
 = 0; i < 100; i++)

133 
brßdÿ¡”
.
	`NÙifyOb£rv”
(
F‹rReûiv”
::
s_nÙify_®l_f‹r
, 
NULL
);

135 
	`EXPECT_EQ
((
ušt32_t
)100, 
F‹rReûiv”
::
s_®l_f‹r_couÁ
);

136 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`D‘achOb£rv”
(&
»ûiv”
));

138 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`A‰achOb£rv”
(&
»ûiv”
, 0x55555555));

139 
i
 = 0; i < 100; i++)

141 
brßdÿ¡”
.
	`NÙifyOb£rv”
(
F‹rReûiv”
::
s_nÙify_ev’_f‹r
, 
NULL
, 0xAAAAAAAA);

143 
	`EXPECT_EQ
((
ušt32_t
)0, 
F‹rReûiv”
::
s_ev’_f‹r_couÁ
);

144 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`D‘achOb£rv”
(&
»ûiv”
));

146 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`A‰achOb£rv”
(&
»ûiv”
, 0xAAAAAAAA));

147 
i
 = 0; i < 100; i++)

149 
brßdÿ¡”
.
	`NÙifyOb£rv”
(
F‹rReûiv”
::
s_nÙify_ev’_f‹r
, 
NULL
, 0xAAAAAAAA);

151 
	`EXPECT_EQ
((
ušt32_t
)100, 
F‹rReûiv”
::
s_ev’_f‹r_couÁ
);

152 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`D‘achOb£rv”
(&
»ûiv”
));

154 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`A‰achOb£rv”
(&
»ûiv”
, 0xAAAAAAAA));

155 
i
 = 0; i < 100; i++)

157 
brßdÿ¡”
.
	`NÙifyOb£rv”
(
F‹rReûiv”
::
s_nÙify_odd_f‹r
, 
NULL
, 0x55555555);

159 
	`EXPECT_EQ
((
ušt32_t
)0, 
F‹rReûiv”
::
s_odd_f‹r_couÁ
);

160 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`D‘achOb£rv”
(&
»ûiv”
));

162 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`A‰achOb£rv”
(&
»ûiv”
, 0x55555555));

163 
i
 = 0; i < 100; i++)

165 
brßdÿ¡”
.
	`NÙifyOb£rv”
(
F‹rReûiv”
::
s_nÙify_odd_f‹r
, 
NULL
, 0x55555555);

167 
	`EXPECT_EQ
((
ušt32_t
)100, 
F‹rReûiv”
::
s_odd_f‹r_couÁ
);

168 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`D‘achOb£rv”
(&
»ûiv”
));

169 
	}
}

	@../common/unittest/semaphore_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"commÚ/£m­hÜe.h
"

4 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

6 
	$TEST
(
Sem­hÜeTe¡
, 
Z”oV®ueTe¡
)

8 
Sem­hÜe
 
£m
;

9 
št32_t
 
v®ue
 = 0;

10 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

11 
	`EXPECT_EQ
(0, 
v®ue
);

12 
	`EXPECT_EQ
(
çl£
, 
£m
.
	`Wa™
(0));

13 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`Po¡
());

14 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

15 
	`EXPECT_EQ
(1, 
v®ue
);

16 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`Wa™
());

17 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

18 
	`EXPECT_EQ
(0, 
v®ue
);

19 
	`EXPECT_EQ
(
çl£
, 
£m
.
	`Wa™
(100));

20 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

21 
	`EXPECT_EQ
(0, 
v®ue
);

22 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`Po¡
());

23 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

24 
	`EXPECT_EQ
(1, 
v®ue
);

25 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`Wa™
(-1));

26 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

27 
	`EXPECT_EQ
(0, 
v®ue
);

28 
	}
}

30 
	$TEST
(
Sem­hÜeTe¡
, 
Inü—£Te¡
)

32 
Sem­hÜe
 
	`£m
(0);

33 
št32_t
 
v®ue
 = 0;

34 
i
 = 0; i < 100; i++)

36 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

37 
	`EXPECT_EQ
(
i
, 
v®ue
);

38 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`Po¡
());

39 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

40 
	`EXPECT_EQ
(
i
 + 1, 
v®ue
);

42 
i
 = 0; i <100; i++)

44 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

45 
	`EXPECT_EQ
(100 - 
i
, 
v®ue
);

46 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`Wa™
());

47 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

48 
	`EXPECT_EQ
(99 - 
i
, 
v®ue
);

50 
	}
}

52 
	$TEST
(
Sem­hÜeTe¡
, 
Deü—£Te¡
)

54 
Sem­hÜe
 
	`£m
(100);

55 
št32_t
 
v®ue
 = 0;

56 
i
 = 0; i <100; i++)

58 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

59 
	`EXPECT_EQ
(100 - 
i
, 
v®ue
);

60 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`Wa™
());

61 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

62 
	`EXPECT_EQ
(99 - 
i
, 
v®ue
);

64 
i
 = 0; i < 100; i++)

66 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

67 
	`EXPECT_EQ
(
i
, 
v®ue
);

68 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`Po¡
());

69 
	`EXPECT_EQ
(
Œue
, 
£m
.
	`G‘V®ue
(&
v®ue
));

70 
	`EXPECT_EQ
(
i
 + 1, 
v®ue
);

72 
	}
}

	@../common/unittest/smart_pointer_test.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	~"commÚ/sm¬t_poš‹r.h
"

5 
	~<veùÜ
>

6 
	~<m­
>

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 
	gÇme¥aû
 {

11 
	sIDSŒuù


13 
	gm_id
;

15 
IDSŒuù
(
id
)

17 
	gm_id
 = 
id
;

22 
	$TEST
(
Sm¬tPoš‹rTe¡
, 
AÎoÿtiÚTe¡
)

24 
sm¬t_±r
<
IDSŒuù
> 
¥_id
, 
¥_id_2
;

25 
	`EXPECT_EQ
(0, 
¥_id
.
	`u£_couÁ
());

26 
¥_id
 = 
Ãw
 
	`IDSŒuù
(0);

27 
	`EXPECT_EQ
(1, 
¥_id
.
	`u£_couÁ
());

28 
¥_id
 = 
NULL
;

29 
	`EXPECT_EQ
(0, 
¥_id
.
	`u£_couÁ
());

30 
¥_id
 = 
Ãw
 
	`IDSŒuù
(1);

31 
	`EXPECT_EQ
(1, 
¥_id
.
	`u£_couÁ
());

32 
	`EXPECT_EQ
(0, 
¥_id_2
.
	`u£_couÁ
());

33 
¥_id_2
 = 
¥_id
;

34 
	`EXPECT_EQ
(2, 
¥_id
.
	`u£_couÁ
());

35 
	`EXPECT_EQ
(2, 
¥_id_2
.
	`u£_couÁ
());

36 
¥_id_2
 = 
NULL
;

37 
	`EXPECT_EQ
(1, 
¥_id
.
	`u£_couÁ
());

38 
¥_id
 = 
NULL
;

39 
	`EXPECT_EQ
(0, 
¥_id
.
	`u£_couÁ
());

40 
	}
}

42 
	$TEST
(
Sm¬tPoš‹rTe¡
, 
SšgËTh»adTe¡
)

44 cÚ¡ 
max_couÁ
 = 10;

45 
¡d
::
veùÜ
< 
sm¬t_±r
<
IDSŒuù
> > 
v¥
;

46 
i
 = 0; i < 
max_couÁ
; i++)

48 
v¥
.
	`push_back
(
Ãw
 
	`IDSŒuù
(
i
));

50 
i
 = 0; i < 
max_couÁ
; i++)

52 
	`EXPECT_EQ
(
i
, 
v¥
[i]->
m_id
);

53 
	`EXPECT_EQ
(1, 
v¥
[
i
].
	`u£_couÁ
());

55 
i
 = 0; i < 
max_couÁ
; i++)

57 
v¥
[
i
] = 
NULL
;

59 
¡d
::
m­
< , 
sm¬t_±r
<
IDSŒuù
> > 
m¥
;

60 
i
 = 0; i < 
max_couÁ
; i++)

62 
m¥
[
i
] = 
Ãw
 
	`IDSŒuù
(i);

64 
i
 = 0; i < 
max_couÁ
; i++)

66 
	`EXPECT_TRUE
(
m¥
.
	`fšd
(
i
è!ğm¥.
	`’d
());

67 
	`EXPECT_EQ
(
i
, 
m¥
[i]->
m_id
);

68 
	`EXPECT_EQ
(1, 
m¥
[
i
].
	`u£_couÁ
());

70 
¡d
::
m­
< , 
sm¬t_±r
<
IDSŒuù
> >::
™”©Ü
 
™
;

71 
™
 = 
m¥
.
	`begš
();

72 
™
 !ğ
m¥
.
	`’d
();

73 
™
++)

75 
	`EXPECT_EQ
(1, 
™
->
£cÚd
.
	`u£_couÁ
());

76 
sm¬t_±r
<
IDSŒuù
> 
p
 = 
™
->
£cÚd
;

77 
	`EXPECT_EQ
(2, 
p
.
	`u£_couÁ
());

79 
™
 = 
m¥
.
	`begš
();

80 
™
 !ğ
m¥
.
	`’d
())

82 
m¥
.
	`”a£
(
™
++);

84 
	}
}

	@../common/unittest/string_test.cpp

1 
	~"commÚ/¡ršg.h
"

3 
	~"g‹¡/g‹¡.h
"

5 
	~<¡ršg
>

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
	$TEST
(
SŒšgTe¡
, 
AÎoÿtiÚTe¡
)

11 
¡d
::
¡ršg
 
¡r
;

12 
¡r
 = 
	`¡ršg_fÜm©
("%s", "");

13 
	`EXPECT_STREQ
("", 
¡r
.
	`c_¡r
());

14 
¡r
 = 
	`¡ršg_fÜm©
("%s", "S");

15 
	`EXPECT_STREQ
("S", 
¡r
.
	`c_¡r
());

16 
¡r
 = 
	`¡ršg_fÜm©
("%s", "St");

17 
	`EXPECT_STREQ
("St", 
¡r
.
	`c_¡r
());

18 
¡r
 = 
	`¡ršg_fÜm©
("%s", "Str");

19 
	`EXPECT_STREQ
("SŒ", 
¡r
.
	`c_¡r
());

20 
¡r
 = 
	`¡ršg_fÜm©
("%s", "Stri");

21 
	`EXPECT_STREQ
("SŒi", 
¡r
.
	`c_¡r
());

22 
¡r
 = 
	`¡ršg_fÜm©
("%s", "Strin");

23 
	`EXPECT_STREQ
("SŒš", 
¡r
.
	`c_¡r
());

24 
¡r
 = 
	`¡ršg_fÜm©
("%s", "String");

25 
	`EXPECT_STREQ
("SŒšg", 
¡r
.
	`c_¡r
());

26 
¡r
 = 
	`¡ršg_fÜm©
("%s", "StringT");

27 
	`EXPECT_STREQ
("SŒšgT", 
¡r
.
	`c_¡r
());

28 
¡r
 = 
	`¡ršg_fÜm©
("%s", "StringTe");

29 
	`EXPECT_STREQ
("SŒšgTe", 
¡r
.
	`c_¡r
());

30 
¡r
 = 
	`¡ršg_fÜm©
("%s", "StringTes");

31 
	`EXPECT_STREQ
("SŒšgTes", 
¡r
.
	`c_¡r
());

32 
¡r
 = 
	`¡ršg_fÜm©
("%s", "StringTest");

33 
	`EXPECT_STREQ
("SŒšgTe¡", 
¡r
.
	`c_¡r
());

34 
¡r
 = 
	`¡ršg_fÜm©
("%s", "StringTest!");

35 
	`EXPECT_STREQ
("SŒšgTe¡!", 
¡r
.
	`c_¡r
());

36 
	}
}

38 
	$TEST
(
SŒšgTe¡
, 
S¶™Te¡
)

40 cÚ¡ *
¡ršg_01
 = "";

41 cÚ¡ *
¡ršg_02
 = " ";

42 cÚ¡ *
¡ršg_03
 = " ";

43 cÚ¡ *
¡ršg_04
 = "abc def ghi";

44 cÚ¡ *
¡ršg_05
 = "‡bc def ghi ";

46 
¡d
::
veùÜ
<¡d::
¡ršg
> 
vec
;

48 
vec
 = 
	`¡ršg_¥l™
(
¡ršg_01
, " ");

49 
	`EXPECT_EQ
((
size_t
)1, 
vec
.
	`size
());

50 
	`EXPECT_STREQ
("", 
vec
[0].
	`c_¡r
());

52 
vec
 = 
	`¡ršg_¥l™
(
¡ršg_02
, " ");

53 
	`EXPECT_EQ
((
size_t
)2, 
vec
.
	`size
());

54 
	`EXPECT_STREQ
("", 
vec
[0].
	`c_¡r
());

55 
	`EXPECT_STREQ
("", 
vec
[1].
	`c_¡r
());

57 
vec
 = 
	`¡ršg_¥l™
(
¡ršg_03
, " ");

58 
	`EXPECT_EQ
((
size_t
)3, 
vec
.
	`size
());

59 
	`EXPECT_STREQ
("", 
vec
[0].
	`c_¡r
());

60 
	`EXPECT_STREQ
("", 
vec
[1].
	`c_¡r
());

61 
	`EXPECT_STREQ
("", 
vec
[2].
	`c_¡r
());

63 
vec
 = 
	`¡ršg_¥l™
(
¡ršg_03
, " ");

64 
	`EXPECT_EQ
((
size_t
)2, 
vec
.
	`size
());

65 
	`EXPECT_STREQ
("", 
vec
[0].
	`c_¡r
());

66 
	`EXPECT_STREQ
("", 
vec
[1].
	`c_¡r
());

68 
vec
 = 
	`¡ršg_¥l™
(
¡ršg_04
, " ");

69 
	`EXPECT_EQ
((
size_t
)3, 
vec
.
	`size
());

70 
	`EXPECT_STREQ
("abc", 
vec
[0].
	`c_¡r
());

71 
	`EXPECT_STREQ
("def", 
vec
[1].
	`c_¡r
());

72 
	`EXPECT_STREQ
("ghi", 
vec
[2].
	`c_¡r
());

74 
vec
 = 
	`¡ršg_¥l™
(
¡ršg_05
, " ");

75 
	`EXPECT_EQ
((
size_t
)9, 
vec
.
	`size
());

76 
	`EXPECT_STREQ
("", 
vec
[0].
	`c_¡r
());

77 
	`EXPECT_STREQ
("", 
vec
[1].
	`c_¡r
());

78 
	`EXPECT_STREQ
("abc", 
vec
[2].
	`c_¡r
());

79 
	`EXPECT_STREQ
("", 
vec
[3].
	`c_¡r
());

80 
	`EXPECT_STREQ
("def", 
vec
[4].
	`c_¡r
());

81 
	`EXPECT_STREQ
("", 
vec
[5].
	`c_¡r
());

82 
	`EXPECT_STREQ
("ghi", 
vec
[6].
	`c_¡r
());

83 
	`EXPECT_STREQ
("", 
vec
[7].
	`c_¡r
());

84 
	`EXPECT_STREQ
("", 
vec
[8].
	`c_¡r
());

86 
vec
 = 
	`¡ršg_¥l™
(
¡ršg_05
, " ");

87 
	`EXPECT_EQ
((
size_t
)5, 
vec
.
	`size
());

88 
	`EXPECT_STREQ
("", 
vec
[0].
	`c_¡r
());

89 
	`EXPECT_STREQ
("abc", 
vec
[1].
	`c_¡r
());

90 
	`EXPECT_STREQ
("def", 
vec
[2].
	`c_¡r
());

91 
	`EXPECT_STREQ
("ghi", 
vec
[3].
	`c_¡r
());

92 
	`EXPECT_STREQ
("", 
vec
[4].
	`c_¡r
());

93 
	}
}

95 cÚ¡ *
	gem±y_01
 = "";

96 cÚ¡ *
	gem±y_02
 = " ";

97 cÚ¡ *
	gg¬bage_01
 = "abcdefg";

98 cÚ¡ *
	gg¬bage_02
 = "‡bcdefg ";

99 cÚ¡ *
	gz”o_01
 = "0000000";

100 cÚ¡ *
	gz”o_02
 = " 00000000abc ";

101 cÚ¡ *
	gz”o_03
 = "0000000.00000";

102 cÚ¡ *
	gz”o_04
 = " 000000000.00000000abc ";

103 cÚ¡ *
	goù®_01
 = "0123";

104 cÚ¡ *
	goù®_02
 = " 0123abc ";

106 
	$TEST
(
SŒšgTe¡
, 
I8Te¡
)

108 cÚ¡ *
lim™_01
 = "-129";

109 cÚ¡ *
lim™_02
 = "-128";

110 cÚ¡ *
lim™_03
 = "-127";

111 cÚ¡ *
lim™_04
 = "+126";

112 cÚ¡ *
lim™_05
 = "+127";

113 cÚ¡ *
lim™_06
 = "+128";

114 cÚ¡ *
lim™_07
 = "0Xff";

115 cÚ¡ *
lim™_08
 = "0xFFFF";

117 
	`EXPECT_EQ
((
št8_t
)0, 
	`¡r_to_i8
(
em±y_01
));

118 
	`EXPECT_EQ
((
št8_t
)0, 
	`¡r_to_i8
(
em±y_02
));

119 
	`EXPECT_EQ
((
št8_t
)0, 
	`¡r_to_i8
(
g¬bage_01
));

120 
	`EXPECT_EQ
((
št8_t
)0, 
	`¡r_to_i8
(
g¬bage_02
));

121 
	`EXPECT_EQ
((
št8_t
)0, 
	`¡r_to_i8
(
z”o_01
));

122 
	`EXPECT_EQ
((
št8_t
)0, 
	`¡r_to_i8
(
z”o_02
));

123 
	`EXPECT_EQ
((
št8_t
)0, 
	`¡r_to_i8
(
z”o_03
));

124 
	`EXPECT_EQ
((
št8_t
)0, 
	`¡r_to_i8
(
z”o_04
));

125 
	`EXPECT_EQ
((
št8_t
)
INT8_MIN
, 
	`¡r_to_i8
(
lim™_01
));

126 
	`EXPECT_EQ
((
št8_t
)-128, 
	`¡r_to_i8
(
lim™_02
));

127 
	`EXPECT_EQ
((
št8_t
)-127, 
	`¡r_to_i8
(
lim™_03
));

128 
	`EXPECT_EQ
((
št8_t
)126, 
	`¡r_to_i8
(
lim™_04
));

129 
	`EXPECT_EQ
((
št8_t
)127, 
	`¡r_to_i8
(
lim™_05
));

130 
	`EXPECT_EQ
((
št8_t
)
INT8_MAX
, 
	`¡r_to_i8
(
lim™_06
));

131 
	`EXPECT_EQ
((
št8_t
)
INT8_MAX
, 
	`¡r_to_i8
(
lim™_07
));

132 
	`EXPECT_EQ
((
št8_t
)
INT8_MAX
, 
	`¡r_to_i8
(
lim™_08
));

133 
	`EXPECT_EQ
((
št8_t
)0x53, 
	`¡r_to_i8
(
où®_01
));

134 
	`EXPECT_EQ
((
št8_t
)0x53, 
	`¡r_to_i8
(
où®_02
));

135 
	}
}

137 
	$TEST
(
SŒšgTe¡
, 
U8Te¡
)

139 cÚ¡ *
lim™_01
 = "-2";

140 cÚ¡ *
lim™_02
 = "-1";

141 cÚ¡ *
lim™_03
 = "0";

142 cÚ¡ *
lim™_04
 = "+254";

143 cÚ¡ *
lim™_05
 = "+255";

144 cÚ¡ *
lim™_06
 = "+256";

145 cÚ¡ *
lim™_07
 = "0Xff";

146 cÚ¡ *
lim™_08
 = "0xFFFF";

148 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
em±y_01
));

149 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
em±y_02
));

150 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
g¬bage_01
));

151 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
g¬bage_02
));

152 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
z”o_01
));

153 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
z”o_02
));

154 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
z”o_03
));

155 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
z”o_04
));

156 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
lim™_01
));

157 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
lim™_02
));

158 
	`EXPECT_EQ
((
ušt8_t
)0, 
	`¡r_to_u8
(
lim™_03
));

159 
	`EXPECT_EQ
((
ušt8_t
)254, 
	`¡r_to_u8
(
lim™_04
));

160 
	`EXPECT_EQ
((
ušt8_t
)255, 
	`¡r_to_u8
(
lim™_05
));

161 
	`EXPECT_EQ
((
ušt8_t
)
UINT8_MAX
, 
	`¡r_to_u8
(
lim™_06
));

162 
	`EXPECT_EQ
((
ušt8_t
)
UINT8_MAX
, 
	`¡r_to_u8
(
lim™_07
));

163 
	`EXPECT_EQ
((
ušt8_t
)
UINT8_MAX
, 
	`¡r_to_u8
(
lim™_08
));

164 
	`EXPECT_EQ
((
ušt8_t
)0x53, 
	`¡r_to_u8
(
où®_01
));

165 
	`EXPECT_EQ
((
ušt8_t
)0x53, 
	`¡r_to_u8
(
où®_02
));

166 
	}
}

168 
	$TEST
(
SŒšgTe¡
, 
I16Te¡
)

170 cÚ¡ *
lim™_01
 = "-32769";

171 cÚ¡ *
lim™_02
 = "-32768";

172 cÚ¡ *
lim™_03
 = "-32767";

173 cÚ¡ *
lim™_04
 = "+32766";

174 cÚ¡ *
lim™_05
 = "+32767";

175 cÚ¡ *
lim™_06
 = "+32768";

176 cÚ¡ *
lim™_07
 = "0Xffff";

177 cÚ¡ *
lim™_08
 = "0xFFFFFF";

179 
	`EXPECT_EQ
((
št16_t
)0, 
	`¡r_to_i16
(
em±y_01
));

180 
	`EXPECT_EQ
((
št16_t
)0, 
	`¡r_to_i16
(
em±y_02
));

181 
	`EXPECT_EQ
((
št16_t
)0, 
	`¡r_to_i16
(
g¬bage_01
));

182 
	`EXPECT_EQ
((
št16_t
)0, 
	`¡r_to_i16
(
g¬bage_02
));

183 
	`EXPECT_EQ
((
št16_t
)0, 
	`¡r_to_i16
(
z”o_01
));

184 
	`EXPECT_EQ
((
št16_t
)0, 
	`¡r_to_i16
(
z”o_02
));

185 
	`EXPECT_EQ
((
št16_t
)0, 
	`¡r_to_i16
(
z”o_03
));

186 
	`EXPECT_EQ
((
št16_t
)0, 
	`¡r_to_i16
(
z”o_04
));

187 
	`EXPECT_EQ
((
št16_t
)
INT16_MIN
, 
	`¡r_to_i16
(
lim™_01
));

188 
	`EXPECT_EQ
((
št16_t
)-32768, 
	`¡r_to_i16
(
lim™_02
));

189 
	`EXPECT_EQ
((
št16_t
)-32767, 
	`¡r_to_i16
(
lim™_03
));

190 
	`EXPECT_EQ
((
št16_t
)32766, 
	`¡r_to_i16
(
lim™_04
));

191 
	`EXPECT_EQ
((
št16_t
)32767, 
	`¡r_to_i16
(
lim™_05
));

192 
	`EXPECT_EQ
((
št16_t
)
INT16_MAX
, 
	`¡r_to_i16
(
lim™_06
));

193 
	`EXPECT_EQ
((
št16_t
)
INT16_MAX
, 
	`¡r_to_i16
(
lim™_07
));

194 
	`EXPECT_EQ
((
št16_t
)
INT16_MAX
, 
	`¡r_to_i16
(
lim™_08
));

195 
	`EXPECT_EQ
((
št16_t
)0x53, 
	`¡r_to_i16
(
où®_01
));

196 
	`EXPECT_EQ
((
št16_t
)0x53, 
	`¡r_to_i16
(
où®_02
));

197 
	}
}

199 
	$TEST
(
SŒšgTe¡
, 
U16Te¡
)

201 cÚ¡ *
lim™_01
 = "-2";

202 cÚ¡ *
lim™_02
 = "-1";

203 cÚ¡ *
lim™_03
 = "0";

204 cÚ¡ *
lim™_04
 = "+65534";

205 cÚ¡ *
lim™_05
 = "+65535";

206 cÚ¡ *
lim™_06
 = "+65536";

207 cÚ¡ *
lim™_07
 = "0Xffff";

208 cÚ¡ *
lim™_08
 = "0xFFFFFF";

210 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
em±y_01
));

211 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
em±y_02
));

212 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
g¬bage_01
));

213 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
g¬bage_02
));

214 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
z”o_01
));

215 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
z”o_02
));

216 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
z”o_03
));

217 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
z”o_04
));

218 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
lim™_01
));

219 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
lim™_02
));

220 
	`EXPECT_EQ
((
ušt16_t
)0, 
	`¡r_to_u16
(
lim™_03
));

221 
	`EXPECT_EQ
((
ušt16_t
)65534, 
	`¡r_to_u16
(
lim™_04
));

222 
	`EXPECT_EQ
((
ušt16_t
)65535, 
	`¡r_to_u16
(
lim™_05
));

223 
	`EXPECT_EQ
((
ušt16_t
)
UINT32_MAX
, 
	`¡r_to_u16
(
lim™_06
));

224 
	`EXPECT_EQ
((
ušt16_t
)
UINT32_MAX
, 
	`¡r_to_u16
(
lim™_07
));

225 
	`EXPECT_EQ
((
ušt16_t
)
UINT32_MAX
, 
	`¡r_to_u16
(
lim™_08
));

226 
	`EXPECT_EQ
((
ušt16_t
)0x53, 
	`¡r_to_u16
(
où®_01
));

227 
	`EXPECT_EQ
((
ušt16_t
)0x53, 
	`¡r_to_u16
(
où®_02
));

228 
	}
}

230 
	$TEST
(
SŒšgTe¡
, 
I32Te¡
)

232 cÚ¡ *
lim™_01
 = "-2147483649";

233 cÚ¡ *
lim™_02
 = "-2147483648";

234 cÚ¡ *
lim™_03
 = "-2147483647";

235 cÚ¡ *
lim™_04
 = "+2147483646";

236 cÚ¡ *
lim™_05
 = "+2147483647";

237 cÚ¡ *
lim™_06
 = "+2147483648";

238 cÚ¡ *
lim™_07
 = "0Xffffffff";

239 cÚ¡ *
lim™_08
 = "0xFFFFFFFFFF";

241 
	`EXPECT_EQ
((
št32_t
)0, 
	`¡r_to_i32
(
em±y_01
));

242 
	`EXPECT_EQ
((
št32_t
)0, 
	`¡r_to_i32
(
em±y_02
));

243 
	`EXPECT_EQ
((
št32_t
)0, 
	`¡r_to_i32
(
g¬bage_01
));

244 
	`EXPECT_EQ
((
št32_t
)0, 
	`¡r_to_i32
(
g¬bage_02
));

245 
	`EXPECT_EQ
((
št32_t
)0, 
	`¡r_to_i32
(
z”o_01
));

246 
	`EXPECT_EQ
((
št32_t
)0, 
	`¡r_to_i32
(
z”o_02
));

247 
	`EXPECT_EQ
((
št32_t
)0, 
	`¡r_to_i32
(
z”o_03
));

248 
	`EXPECT_EQ
((
št32_t
)0, 
	`¡r_to_i32
(
z”o_04
));

249 
	`EXPECT_EQ
((
št32_t
)
INT32_MIN
, 
	`¡r_to_i32
(
lim™_01
));

250 
	`EXPECT_EQ
((
št32_t
)-2147483647-1, 
	`¡r_to_i32
(
lim™_02
));

251 
	`EXPECT_EQ
((
št32_t
)-2147483647, 
	`¡r_to_i32
(
lim™_03
));

252 
	`EXPECT_EQ
((
št32_t
)2147483646, 
	`¡r_to_i32
(
lim™_04
));

253 
	`EXPECT_EQ
((
št32_t
)2147483647, 
	`¡r_to_i32
(
lim™_05
));

254 
	`EXPECT_EQ
((
št32_t
)
INT32_MAX
, 
	`¡r_to_i32
(
lim™_06
));

255 
	`EXPECT_EQ
((
št32_t
)
INT32_MAX
, 
	`¡r_to_i32
(
lim™_07
));

256 
	`EXPECT_EQ
((
št32_t
)
INT32_MAX
, 
	`¡r_to_i32
(
lim™_08
));

257 
	`EXPECT_EQ
((
št32_t
)0x53, 
	`¡r_to_i32
(
où®_01
));

258 
	`EXPECT_EQ
((
št32_t
)0x53, 
	`¡r_to_i32
(
où®_02
));

259 
	}
}

261 
	$TEST
(
SŒšgTe¡
, 
U32Te¡
)

263 cÚ¡ *
lim™_01
 = "-2";

264 cÚ¡ *
lim™_02
 = "-1";

265 cÚ¡ *
lim™_03
 = "0";

266 cÚ¡ *
lim™_04
 = "+4294967294";

267 cÚ¡ *
lim™_05
 = "+4294967295";

268 cÚ¡ *
lim™_06
 = "+4294967296";

269 cÚ¡ *
lim™_07
 = "0Xffffffff";

270 cÚ¡ *
lim™_08
 = "0xFFFFFFFFFF";

272 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
em±y_01
));

273 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
em±y_02
));

274 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
g¬bage_01
));

275 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
g¬bage_02
));

276 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
z”o_01
));

277 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
z”o_02
));

278 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
z”o_03
));

279 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
z”o_04
));

280 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
lim™_01
));

281 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
lim™_02
));

282 
	`EXPECT_EQ
((
ušt32_t
)0, 
	`¡r_to_u32
(
lim™_03
));

283 
	`EXPECT_EQ
((
ušt32_t
)4294967295U-1, 
	`¡r_to_u32
(
lim™_04
));

284 
	`EXPECT_EQ
((
ušt32_t
)4294967295U, 
	`¡r_to_u32
(
lim™_05
));

285 
	`EXPECT_EQ
((
ušt32_t
)
UINT32_MAX
, 
	`¡r_to_u32
(
lim™_06
));

286 
	`EXPECT_EQ
((
ušt32_t
)
UINT32_MAX
, 
	`¡r_to_u32
(
lim™_07
));

287 
	`EXPECT_EQ
((
ušt32_t
)
UINT32_MAX
, 
	`¡r_to_u32
(
lim™_08
));

288 
	`EXPECT_EQ
((
ušt32_t
)0x53, 
	`¡r_to_u32
(
où®_01
));

289 
	`EXPECT_EQ
((
ušt32_t
)0x53, 
	`¡r_to_u32
(
où®_02
));

290 
	}
}

292 
	$TEST
(
SŒšgTe¡
, 
I64Te¡
)

294 cÚ¡ *
lim™_01
 = "-9223372036854775809";

295 cÚ¡ *
lim™_02
 = "-9223372036854775808";

296 cÚ¡ *
lim™_03
 = "-9223372036854775807";

297 cÚ¡ *
lim™_04
 = "+9223372036854775806";

298 cÚ¡ *
lim™_05
 = "+9223372036854775807";

299 cÚ¡ *
lim™_06
 = "+9223372036854775808";

300 cÚ¡ *
lim™_07
 = "0Xffffffffffffffff";

301 cÚ¡ *
lim™_08
 = "0xFFFFFFFFFFFFFFFFFF";

303 
	`EXPECT_EQ
((
št64_t
)0, 
	`¡r_to_i64
(
em±y_01
));

304 
	`EXPECT_EQ
((
št64_t
)0, 
	`¡r_to_i64
(
em±y_02
));

305 
	`EXPECT_EQ
((
št64_t
)0, 
	`¡r_to_i64
(
g¬bage_01
));

306 
	`EXPECT_EQ
((
št64_t
)0, 
	`¡r_to_i64
(
g¬bage_02
));

307 
	`EXPECT_EQ
((
št64_t
)0, 
	`¡r_to_i64
(
z”o_01
));

308 
	`EXPECT_EQ
((
št64_t
)0, 
	`¡r_to_i64
(
z”o_02
));

309 
	`EXPECT_EQ
((
št64_t
)0, 
	`¡r_to_i64
(
z”o_03
));

310 
	`EXPECT_EQ
((
št64_t
)0, 
	`¡r_to_i64
(
z”o_04
));

311 
	`EXPECT_EQ
((
št64_t
)
INT64_MIN
, 
	`¡r_to_i64
(
lim™_01
));

312 
	`EXPECT_EQ
((
št64_t
)-
	`INT64_C
(9223372036854775807)-1, 
	`¡r_to_i64
(
lim™_02
));

313 
	`EXPECT_EQ
((
št64_t
)-
	`INT64_C
(9223372036854775807), 
	`¡r_to_i64
(
lim™_03
));

314 
	`EXPECT_EQ
((
št64_t
)
	`INT64_C
(9223372036854775807)-1, 
	`¡r_to_i64
(
lim™_04
));

315 
	`EXPECT_EQ
((
št64_t
)
	`INT64_C
(9223372036854775807), 
	`¡r_to_i64
(
lim™_05
));

316 
	`EXPECT_EQ
((
št64_t
)
INT64_MAX
, 
	`¡r_to_i64
(
lim™_06
));

317 
	`EXPECT_EQ
((
št64_t
)
INT64_MAX
, 
	`¡r_to_i64
(
lim™_07
));

318 
	`EXPECT_EQ
((
št64_t
)
INT64_MAX
, 
	`¡r_to_i64
(
lim™_08
));

319 
	`EXPECT_EQ
((
št64_t
)0x53, 
	`¡r_to_i64
(
où®_01
));

320 
	`EXPECT_EQ
((
št64_t
)0x53, 
	`¡r_to_i64
(
où®_02
));

321 
	}
}

323 
	$TEST
(
SŒšgTe¡
, 
U64Te¡
)

325 cÚ¡ *
lim™_01
 = "-2";

326 cÚ¡ *
lim™_02
 = "-1";

327 cÚ¡ *
lim™_03
 = "0";

328 cÚ¡ *
lim™_04
 = "+18446744073709551614";

329 cÚ¡ *
lim™_05
 = "+18446744073709551615";

330 cÚ¡ *
lim™_06
 = "+18446744073709551616";

331 cÚ¡ *
lim™_07
 = "0Xffffffffffffffff";

332 cÚ¡ *
lim™_08
 = "0xFFFFFFFFFFFFFFFFFF";

334 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
em±y_01
));

335 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
em±y_02
));

336 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
g¬bage_01
));

337 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
g¬bage_02
));

338 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
z”o_01
));

339 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
z”o_02
));

340 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
z”o_03
));

341 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
z”o_04
));

342 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
lim™_01
));

343 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
lim™_02
));

344 
	`EXPECT_EQ
((
ušt64_t
)0, 
	`¡r_to_u64
(
lim™_03
));

345 
	`EXPECT_EQ
((
ušt64_t
)
	`UINT64_C
(18446744073709551615)-1, 
	`¡r_to_u64
(
lim™_04
));

346 
	`EXPECT_EQ
((
ušt64_t
)
	`UINT64_C
(18446744073709551615), 
	`¡r_to_u64
(
lim™_05
));

347 
	`EXPECT_EQ
((
ušt64_t
)
UINT64_MAX
, 
	`¡r_to_u64
(
lim™_06
));

348 
	`EXPECT_EQ
((
ušt64_t
)
UINT64_MAX
, 
	`¡r_to_u64
(
lim™_07
));

349 
	`EXPECT_EQ
((
ušt64_t
)
UINT64_MAX
, 
	`¡r_to_u64
(
lim™_08
));

350 
	`EXPECT_EQ
((
ušt64_t
)0x53, 
	`¡r_to_u64
(
où®_01
));

351 
	`EXPECT_EQ
((
ušt64_t
)0x53, 
	`¡r_to_u64
(
où®_02
));

352 
	}
}

354 
	$TEST
(
SŒšgTe¡
, 
BoŞTe¡
)

356 cÚ¡ *
Œue_01
 = "true";

357 cÚ¡ *
Œue_02
 = "TRUE";

358 cÚ¡ *
Œue_03
 = "yes";

359 cÚ¡ *
Œue_04
 = "YES";

360 cÚ¡ *
Œue_05
 = "rue ";

361 cÚ¡ *
Œue_06
 = " TRUE ";

362 cÚ¡ *
Œue_07
 = " yes ";

363 cÚ¡ *
Œue_08
 = " YES ";

364 cÚ¡ *
Œue_09
 = "1";

365 cÚ¡ *
Œue_10
 = " 1 ";

367 cÚ¡ *
çl£_01
 = "false";

368 cÚ¡ *
çl£_02
 = "FALSE";

369 cÚ¡ *
çl£_03
 = "no";

370 cÚ¡ *
çl£_04
 = "NO";

371 cÚ¡ *
çl£_05
 = " false ";

372 cÚ¡ *
çl£_06
 = " FALSE ";

373 cÚ¡ *
çl£_07
 = "‚o ";

374 cÚ¡ *
çl£_08
 = " NO ";

375 cÚ¡ *
çl£_09
 = "0";

376 cÚ¡ *
çl£_10
 = " 0 ";

378 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
em±y_01
));

379 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
em±y_02
));

380 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
z”o_01
));

381 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
z”o_02
));

382 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
z”o_03
));

383 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
z”o_04
));

384 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_01
));

385 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_02
));

386 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_03
));

387 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_04
));

388 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_05
));

389 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_06
));

390 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_07
));

391 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_08
));

392 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_09
));

393 
	`EXPECT_TRUE
(
	`¡r_to_boŞ
(
Œue_10
));

394 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_01
));

395 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_02
));

396 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_03
));

397 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_04
));

398 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_05
));

399 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_06
));

400 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_07
));

401 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_08
));

402 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_09
));

403 
	`EXPECT_FALSE
(
	`¡r_to_boŞ
(
çl£_10
));

404 
	}
}

406 
	$TEST
(
SŒšgTe¡
, 
Ch¬Te¡
)

408 cÚ¡ *
ch¬_01
 = "abcde";

409 cÚ¡ *
ch¬_02
 = "‡bcde ";

411 
	`EXPECT_EQ
(()'\0', 
	`¡r_to_ch¬
(
em±y_01
));

412 
	`EXPECT_EQ
(()'\0', 
	`¡r_to_ch¬
(
em±y_02
));

413 
	`EXPECT_EQ
(()'a', 
	`¡r_to_ch¬
(
ch¬_01
));

414 
	`EXPECT_EQ
(()'a', 
	`¡r_to_ch¬
(
ch¬_02
));

415 
	}
}

417 
	$TEST
(
SŒšgTe¡
, 
FlßtTe¡
)

419 cÚ¡ *
æßt_01
 = "12345.67890";

420 cÚ¡ *
æßt_02
 = " 12345.67890abc ";

422 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
em±y_01
));

423 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
em±y_02
));

424 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
g¬bage_01
));

425 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
z”o_01
));

426 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
z”o_02
));

427 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
z”o_03
));

428 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
z”o_04
));

429 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
z”o_03
));

430 
	`EXPECT_FLOAT_EQ
(()0, 
	`¡r_to_æßt
(
z”o_04
));

431 
	`EXPECT_FLOAT_EQ
(()12345.67890f, 
	`¡r_to_æßt
(
æßt_01
));

432 
	`EXPECT_FLOAT_EQ
(()12345.67890f, 
	`¡r_to_æßt
(
æßt_02
));

433 
	}
}

435 
	$TEST
(
SŒšgTe¡
, 
DoubËTe¡
)

437 cÚ¡ *
doubË_01
 = "12345.67890";

438 cÚ¡ *
doubË_02
 = " 12345.67890abc ";

440 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
em±y_01
));

441 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
em±y_02
));

442 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
g¬bage_01
));

443 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
z”o_01
));

444 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
z”o_02
));

445 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
z”o_03
));

446 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
z”o_04
));

447 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
z”o_03
));

448 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_doubË
(
z”o_04
));

449 
	`EXPECT_DOUBLE_EQ
(()12345.67890, 
	`¡r_to_doubË
(
doubË_01
));

450 
	`EXPECT_DOUBLE_EQ
(()12345.67890, 
	`¡r_to_doubË
(
doubË_02
));

451 
	}
}

453 
	$TEST
(
SŒšgTe¡
, 
LÚgDoubËTe¡
)

455 cÚ¡ *
lÚg_doubË_01
 = "12345.67890";

456 cÚ¡ *
lÚg_doubË_02
 = " 12345.67890abc ";

459 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
em±y_01
));

460 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
em±y_02
));

461 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
g¬bage_01
));

462 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
z”o_01
));

463 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
z”o_02
));

464 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
z”o_03
));

465 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
z”o_04
));

466 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
z”o_03
));

467 
	`EXPECT_DOUBLE_EQ
(()0, 
	`¡r_to_lÚg_doubË
(
z”o_04
));

468 
	`EXPECT_DOUBLE_EQ
(()12345.67890L, 
	`¡r_to_lÚg_doubË
(
lÚg_doubË_01
));

469 
	`EXPECT_DOUBLE_EQ
(()12345.67890L, 
	`¡r_to_lÚg_doubË
(
lÚg_doubË_02
));

470 
	}
}

	@../common/unittest/time_test.cpp

1 
	~"commÚ/time.h
"

3 
	~"g‹¡/g‹¡.h
"

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
	$TEST
(
UTCTimeTe¡
, 
Z”oV®ueTe¡
)

9 
UTCTime
 
dt
;

11 
time_t
 
t
 = 
dt
;

12 
	`EXPECT_EQ
(0, 
t
);

14 
tm
 
t_tm
 = 
dt
;

15 
	`EXPECT_EQ
(0, 
t_tm
.
tm_£c
);

16 
	`EXPECT_EQ
(0, 
t_tm
.
tm_mš
);

17 
	`EXPECT_EQ
(0, 
t_tm
.
tm_hour
);

18 
	`EXPECT_EQ
(1, 
t_tm
.
tm_mday
);

19 
	`EXPECT_EQ
(0, 
t_tm
.
tm_mÚ
);

20 
	`EXPECT_EQ
(70, 
t_tm
.
tm_y—r
);

21 
	`EXPECT_EQ
(4, 
t_tm
.
tm_wday
);

22 
	`EXPECT_EQ
(0, 
t_tm
.
tm_yday
);

23 
	`EXPECT_EQ
(0, 
t_tm
.
tm_isd¡
);

25 
time¥ec
 
ts
 = 
dt
;

26 
	`EXPECT_EQ
(0, 
ts
.
tv_£c
);

27 
	`EXPECT_EQ
(0, 
ts
.
tv_n£c
);

29 
SYSTEMTIME
 
¡
 = 
dt
;

30 
	`EXPECT_EQ
(1970, 
¡
.
wY—r
);

31 
	`EXPECT_EQ
(1, 
¡
.
wMÚth
);

32 
	`EXPECT_EQ
(4, 
¡
.
wDayOfW“k
);

33 
	`EXPECT_EQ
(1, 
¡
.
wDay
);

34 
	`EXPECT_EQ
(0, 
¡
.
wHour
);

35 
	`EXPECT_EQ
(0, 
¡
.
wMšu‹
);

36 
	`EXPECT_EQ
(0, 
¡
.
wSecÚd
);

37 
	`EXPECT_EQ
(0, 
¡
.
wMli£cÚds
);

39 
FILETIME
 
á
 = 
dt
;

40 
ULARGE_INTEGER
 
uli
;

41 
uli
.
LowP¬t
 = 
á
.
dwLowD©eTime
;

42 
uli
.
HighP¬t
 = 
á
.
dwHighD©eTime
;

43 
	`EXPECT_EQ
(
EPOCH_DIFFERENCE
 * (
ušt64_t
)10000000, 
uli
.
QuadP¬t
);

44 
	}
}

46 
	$TEST
(
UTCTimeTe¡
, 
DoomsdayTe¡
)

48 
time_t
 
t_doomsday
 = 1356048000;

49 
t_doomsday
 += 13 * 60 * 60 + 13 * 60 + 13;

50 
SYSTEMTIME
 
¡_doomsday
;

51 
¡_doomsday
.
wY—r
 = 2012;

52 
¡_doomsday
.
wMÚth
 = 12;

53 
¡_doomsday
.
wDayOfW“k
 = 0;

54 
¡_doomsday
.
wDay
 = 21;

55 
¡_doomsday
.
wHour
 = 13;

56 
¡_doomsday
.
wMšu‹
 = 13;

57 
¡_doomsday
.
wSecÚd
 = 13;

58 
¡_doomsday
.
wMli£cÚds
 = 13;

60 
UTCTime
 
	`dt
(
¡_doomsday
);

62 
time_t
 
t
 = 
dt
;

63 
	`EXPECT_EQ
(
t_doomsday
, 
t
);

65 
tm
 
t_tm
 = 
dt
;

66 
	`EXPECT_EQ
(13, 
t_tm
.
tm_£c
);

67 
	`EXPECT_EQ
(13, 
t_tm
.
tm_mš
);

68 
	`EXPECT_EQ
(13, 
t_tm
.
tm_hour
);

69 
	`EXPECT_EQ
(21, 
t_tm
.
tm_mday
);

70 
	`EXPECT_EQ
(11, 
t_tm
.
tm_mÚ
);

71 
	`EXPECT_EQ
(112, 
t_tm
.
tm_y—r
);

72 
	`EXPECT_EQ
(5, 
t_tm
.
tm_wday
);

73 
	`EXPECT_EQ
(355, 
t_tm
.
tm_yday
);

74 
	`EXPECT_EQ
(0, 
t_tm
.
tm_isd¡
);

76 
time¥ec
 
ts
 = 
dt
;

77 
	`EXPECT_EQ
(
t_doomsday
, 
ts
.
tv_£c
);

78 
	`EXPECT_EQ
(13 * 1000000, 
ts
.
tv_n£c
);

80 
SYSTEMTIME
 
¡
 = 
dt
;

81 
	`EXPECT_EQ
(2012, 
¡
.
wY—r
);

82 
	`EXPECT_EQ
(12, 
¡
.
wMÚth
);

83 
	`EXPECT_EQ
(5, 
¡
.
wDayOfW“k
);

84 
	`EXPECT_EQ
(21, 
¡
.
wDay
);

85 
	`EXPECT_EQ
(13, 
¡
.
wHour
);

86 
	`EXPECT_EQ
(13, 
¡
.
wMšu‹
);

87 
	`EXPECT_EQ
(13, 
¡
.
wSecÚd
);

88 
	`EXPECT_EQ
(13, 
¡
.
wMli£cÚds
);

90 
FILETIME
 
á
 = 
dt
;

91 
ULARGE_INTEGER
 
uli
;

92 
uli
.
LowP¬t
 = 
á
.
dwLowD©eTime
;

93 
uli
.
HighP¬t
 = 
á
.
dwHighD©eTime
;

94 
	`EXPECT_EQ
((
t_doomsday
 + 
EPOCH_DIFFERENCE
è* (
ušt64_t
)10000000 + 13 * 10000, 
uli
.
QuadP¬t
);

95 
	}
}

97 
	$TEST
(
UTCTimeTe¡
, 
TodayTimeTe¡
)

99 
time_t
 
t_today
 = 
	`time
(
NULL
);

100 
tm
 
t_tm_today
 = *
	`gmtime
(&
t_today
);

102 
UTCTime
 
	`dt
(
t_tm_today
);

104 
time_t
 
t
 = 
dt
;

105 
	`EXPECT_EQ
(
t_today
, 
t
);

107 
tm
 
t_tm
 = 
dt
;

108 
	`EXPECT_EQ
(
t_tm_today
.
tm_£c
, 
t_tm
.tm_sec);

109 
	`EXPECT_EQ
(
t_tm_today
.
tm_mš
, 
t_tm
.tm_min);

110 
	`EXPECT_EQ
(
t_tm_today
.
tm_hour
, 
t_tm
.tm_hour);

111 
	`EXPECT_EQ
(
t_tm_today
.
tm_mday
, 
t_tm
.tm_mday);

112 
	`EXPECT_EQ
(
t_tm_today
.
tm_mÚ
, 
t_tm
.tm_mon);

113 
	`EXPECT_EQ
(
t_tm_today
.
tm_y—r
, 
t_tm
.tm_year);

114 
	`EXPECT_EQ
(
t_tm_today
.
tm_wday
, 
t_tm
.tm_wday);

115 
	`EXPECT_EQ
(
t_tm_today
.
tm_yday
, 
t_tm
.tm_yday);

116 
	`EXPECT_EQ
(
t_tm_today
.
tm_isd¡
, 
t_tm
.tm_isdst);

118 
time¥ec
 
ts
 = 
dt
;

119 
	`EXPECT_EQ
(
t_today
, 
ts
.
tv_£c
);

120 
	`EXPECT_EQ
(0, 
ts
.
tv_n£c
);

122 
SYSTEMTIME
 
¡
 = 
dt
;

123 
	`EXPECT_EQ
(
t_tm_today
.
tm_y—r
 + 1900, 
¡
.
wY—r
);

124 
	`EXPECT_EQ
(
t_tm_today
.
tm_mÚ
 + 1, 
¡
.
wMÚth
);

125 
	`EXPECT_EQ
(
t_tm_today
.
tm_wday
, 
¡
.
wDayOfW“k
);

126 
	`EXPECT_EQ
(
t_tm_today
.
tm_mday
, 
¡
.
wDay
);

127 
	`EXPECT_EQ
(
t_tm_today
.
tm_hour
, 
¡
.
wHour
);

128 
	`EXPECT_EQ
(
t_tm_today
.
tm_mš
, 
¡
.
wMšu‹
);

129 
	`EXPECT_EQ
(
t_tm_today
.
tm_£c
, 
¡
.
wSecÚd
);

130 
	`EXPECT_EQ
(0, 
¡
.
wMli£cÚds
);

132 
FILETIME
 
á
 = 
dt
;

133 
ULARGE_INTEGER
 
uli
;

134 
uli
.
LowP¬t
 = 
á
.
dwLowD©eTime
;

135 
uli
.
HighP¬t
 = 
á
.
dwHighD©eTime
;

136 
	`EXPECT_EQ
((
t_today
 + 
EPOCH_DIFFERENCE
è* (
ušt64_t
)10000000, 
uli
.
QuadP¬t
);

137 
	}
}

139 
	$TEST
(
UTCTimeTe¡
, 
Cu¼’tTimeTe¡
)

141 cÚ¡ 
time_t
 
š‹rv®
 = 10;

142 
time_t
 
t_today_¡d
 = 
	`time
(
NULL
);

143 
UTCTime
 
dt_today
 = UTCTime::
	`G‘Cu¼’tTime
();

145 
UTCTime
 
	`dt
(
dt_today
);

146 
time_t
 
t
 = 
dt
;

147 
	`EXPECT_LE
(
t_today_¡d
, 
t
);

148 
	`EXPECT_GE
(
t_today_¡d
 + 
š‹rv®
, 
t
);

149 
	}
}

151 
	$TEST
(
UTCTimeTe¡
, 
Cu¼’tTimeTTe¡
)

153 cÚ¡ 
time_t
 
š‹rv®
 = 10;

154 
time_t
 
t_today_¡d
 = 
	`time
(
NULL
);

155 
time_t
 
t_today
 = 
UTCTime
::
	`G‘Cu¼’tTimeT
();

157 
UTCTime
 
	`dt
(
t_today
);

158 
time_t
 
t
 = 
dt
;

159 
	`EXPECT_LE
(
t_today_¡d
, 
t
);

160 
	`EXPECT_GE
(
t_today_¡d
 + 
š‹rv®
, 
t
);

161 
	}
}

163 
	$TEST
(
UTCTimeTe¡
, 
Cu¼’tTMTe¡
)

165 cÚ¡ 
time_t
 
š‹rv®
 = 10;

166 
time_t
 
t_today_¡d
 = 
	`time
(
NULL
);

167 
tm
 
t_tm_today
 = 
UTCTime
::
	`G‘Cu¼’tTM
();

169 
UTCTime
 
	`dt
(
t_tm_today
);

170 
time_t
 
t
 = 
dt
;

171 
	`EXPECT_LE
(
t_today_¡d
, 
t
);

172 
	`EXPECT_GE
(
t_today_¡d
 + 
š‹rv®
, 
t
);

173 
	}
}

175 
	$TEST
(
UTCTimeTe¡
, 
Cu¼’tTimeS³cTe¡
)

177 cÚ¡ 
time_t
 
š‹rv®
 = 10;

178 
time_t
 
t_today_¡d
 = 
	`time
(
NULL
);

179 
time¥ec
 
ts_today
 = 
UTCTime
::
	`G‘Cu¼’tTimeS³c
();

181 
UTCTime
 
	`dt
(
ts_today
);

182 
time_t
 
t
 = 
dt
;

183 
	`EXPECT_LE
(
t_today_¡d
, 
t
);

184 
	`EXPECT_GE
(
t_today_¡d
 + 
š‹rv®
, 
t
);

186 
SYSTEMTIME
 
¡
 = 
dt
;

187 
	`EXPECT_EQ
(
ts_today
.
tv_n£c
 / 1000000, 
¡
.
wMli£cÚds
);

188 
	}
}

190 
	$TEST
(
UTCTimeTe¡
, 
Cu¼’tSy¡emTimeTe¡
)

192 cÚ¡ 
time_t
 
š‹rv®
 = 10;

193 
time_t
 
t_today_¡d
 = 
	`time
(
NULL
);

194 
SYSTEMTIME
 
¡_today
 = 
UTCTime
::
	`G‘Cu¼’tSy¡emTime
();

196 
UTCTime
 
	`dt
(
¡_today
);

197 
time_t
 
t
 = 
dt
;

198 
	`EXPECT_LE
(
t_today_¡d
, 
t
);

199 
	`EXPECT_GE
(
t_today_¡d
 + 
š‹rv®
, 
t
);

201 
time¥ec
 
ts
 = 
dt
;

202 
	`EXPECT_EQ
(
¡_today
.
wMli£cÚds
 * 1000000, 
ts
.
tv_n£c
);

203 
	}
}

205 
	$TEST
(
UTCTimeTe¡
, 
Cu¼’tFeTimeTe¡
)

207 cÚ¡ 
time_t
 
š‹rv®
 = 10;

208 
time_t
 
t_today_¡d
 = 
	`time
(
NULL
);

209 
FILETIME
 
á_today
 = 
UTCTime
::
	`G‘Cu¼’tFeTime
();

211 
UTCTime
 
	`dt
(
á_today
);

212 
time_t
 
t
 = 
dt
;

213 
	`EXPECT_LE
(
t_today_¡d
, 
t
);

214 
	`EXPECT_GE
(
t_today_¡d
 + 
š‹rv®
, 
t
);

216 
time¥ec
 
ts
 = 
dt
;

217 
ULARGE_INTEGER
 
uli
;

218 
uli
.
LowP¬t
 = 
á_today
.
dwLowD©eTime
;

219 
uli
.
HighP¬t
 = 
á_today
.
dwHighD©eTime
;

220 
	`EXPECT_EQ
(()(
uli
.
QuadP¬t
 % 10000000), 
ts
.
tv_n£c
 / 100);

221 
	}
}

223 
	$TEST
(
UTCTimeTe¡
, 
Com·risÚTe¡
)

225 
tm
 
t_tm_doomsday
;

226 
t_tm_doomsday
.
tm_£c
 = 0;

227 
t_tm_doomsday
.
tm_mš
 = 0;

228 
t_tm_doomsday
.
tm_hour
 = 0;

229 
t_tm_doomsday
.
tm_mday
 = 21;

230 
t_tm_doomsday
.
tm_mÚ
 = 11;

231 
t_tm_doomsday
.
tm_y—r
 = 112;

232 
t_tm_doomsday
.
tm_wday
 = 5;

233 
t_tm_doomsday
.
tm_yday
 = 355;

234 
t_tm_doomsday
.
tm_isd¡
 = 0;

236 
tm
 
t_tm_Ãwday
;

237 
t_tm_Ãwday
.
tm_£c
 = 0;

238 
t_tm_Ãwday
.
tm_mš
 = 0;

239 
t_tm_Ãwday
.
tm_hour
 = 0;

240 
t_tm_Ãwday
.
tm_mday
 = 22;

241 
t_tm_Ãwday
.
tm_mÚ
 = 11;

242 
t_tm_Ãwday
.
tm_y—r
 = 112;

243 
t_tm_Ãwday
.
tm_wday
 = 5;

244 
t_tm_Ãwday
.
tm_yday
 = 355;

245 
t_tm_Ãwday
.
tm_isd¡
 = 0;

247 
UTCTime
 
	`dt_doomsday
(
t_tm_doomsday
);

248 
UTCTime
 
	`dt_Ãwday
(
t_tm_Ãwday
);

249 
UTCTime
 
	`dt_§m’ewday
(
t_tm_Ãwday
);

251 
	`EXPECT_FALSE
(
dt_doomsday
 =ğ
dt_Ãwday
);

252 
	`EXPECT_TRUE
(
dt_doomsday
 !ğ
dt_Ãwday
);

253 
	`EXPECT_FALSE
(
dt_doomsday
 > 
dt_Ãwday
);

254 
	`EXPECT_TRUE
(
dt_doomsday
 < 
dt_Ãwday
);

255 
	`EXPECT_FALSE
(
dt_doomsday
 >ğ
dt_Ãwday
);

256 
	`EXPECT_TRUE
(
dt_doomsday
 <ğ
dt_Ãwday
);

258 
	`EXPECT_FALSE
(
dt_Ãwday
 =ğ
dt_doomsday
);

259 
	`EXPECT_TRUE
(
dt_Ãwday
 !ğ
dt_doomsday
);

260 
	`EXPECT_TRUE
(
dt_Ãwday
 > 
dt_doomsday
);

261 
	`EXPECT_FALSE
(
dt_Ãwday
 < 
dt_doomsday
);

262 
	`EXPECT_TRUE
(
dt_Ãwday
 >ğ
dt_doomsday
);

263 
	`EXPECT_FALSE
(
dt_Ãwday
 <ğ
dt_doomsday
);

265 
	`EXPECT_TRUE
(
dt_Ãwday
 =ğ
dt_§m’ewday
);

266 
	`EXPECT_FALSE
(
dt_Ãwday
 !ğ
dt_§m’ewday
);

267 
	`EXPECT_FALSE
(
dt_Ãwday
 > 
dt_§m’ewday
);

268 
	`EXPECT_FALSE
(
dt_Ãwday
 < 
dt_§m’ewday
);

269 
	`EXPECT_TRUE
(
dt_Ãwday
 >ğ
dt_§m’ewday
);

270 
	`EXPECT_TRUE
(
dt_Ãwday
 <ğ
dt_§m’ewday
);

271 
	}
}

273 
	$TEST
(
UTCTimeTe¡
, 
O³¿tÜTe¡
)

275 
time_t
 
t
 = 1356048000;

277 
tm
 
t_tm
;

278 
t_tm
.
tm_£c
 = 0;

279 
t_tm
.
tm_mš
 = 0;

280 
t_tm
.
tm_hour
 = 0;

281 
t_tm
.
tm_mday
 = 21;

282 
t_tm
.
tm_mÚ
 = 11;

283 
t_tm
.
tm_y—r
 = 112;

284 
t_tm
.
tm_wday
 = 5;

285 
t_tm
.
tm_yday
 = 355;

286 
t_tm
.
tm_isd¡
 = 0;

288 
tm
 
t_tm_befÜe
;

289 
t_tm_befÜe
.
tm_£c
 = 56;

290 
t_tm_befÜe
.
tm_mš
 = 56;

291 
t_tm_befÜe
.
tm_hour
 = 21;

292 
t_tm_befÜe
.
tm_mday
 = 19;

293 
t_tm_befÜe
.
tm_mÚ
 = 11;

294 
t_tm_befÜe
.
tm_y—r
 = 112;

295 
t_tm_befÜe
.
tm_wday
 = 0;

296 
t_tm_befÜe
.
tm_yday
 = 0;

297 
t_tm_befÜe
.
tm_isd¡
 = 0;

299 
tm
 
t_tm_aá”
;

300 
t_tm_aá”
.
tm_£c
 = 4;

301 
t_tm_aá”
.
tm_mš
 = 3;

302 
t_tm_aá”
.
tm_hour
 = 2;

303 
t_tm_aá”
.
tm_mday
 = 22;

304 
t_tm_aá”
.
tm_mÚ
 = 11;

305 
t_tm_aá”
.
tm_y—r
 = 112;

306 
t_tm_aá”
.
tm_wday
 = 0;

307 
t_tm_aá”
.
tm_yday
 = 0;

308 
t_tm_aá”
.
tm_isd¡
 = 0;

310 
UTCTimeS·n
 
	`¥ª
(1, 2, 3, 4);

311 
UTCTime
 
	`dt
(
t_tm
);

312 
UTCTime
 
	`dt_befÜe
(
t_tm_befÜe
);

313 
UTCTime
 
	`dt_aá”
(
t_tm_aá”
);

315 
time_t
 
t_dt
 = 
dt
;

316 
	`EXPECT_EQ
(
t
, 
t_dt
);

317 
	`EXPECT_TRUE
(
dt
 - 
¥ª
 =ğ
dt_befÜe
);

318 
	`EXPECT_TRUE
(
dt_befÜe
 =ğ
dt
 - 
¥ª
);

319 
	`EXPECT_TRUE
(
dt
 + 
¥ª
 =ğ
dt_aá”
);

320 
	`EXPECT_TRUE
(
dt_aá”
 =ğ
dt
 + 
¥ª
);

321 
	}
}

323 
	$TEST
(
UTCTimeTe¡
, 
Difã»nûTe¡
)

325 
UTCTime
 
dt_befÜe
 = UTCTime::
	`G‘Cu¼’tTime
();

326 
UTCTime
 
dt_aá”
 = UTCTime::
	`G‘Cu¼’tTime
();

328 
	`EXPECT_FALSE
(
dt_befÜe
 =ğ
dt_aá”
);

329 
	`EXPECT_TRUE
(
dt_befÜe
 !ğ
dt_aá”
);

330 
	`EXPECT_FALSE
(
dt_befÜe
 > 
dt_aá”
);

331 
	`EXPECT_TRUE
(
dt_befÜe
 < 
dt_aá”
);

332 
	`EXPECT_FALSE
(
dt_befÜe
 >ğ
dt_aá”
);

333 
	`EXPECT_TRUE
(
dt_befÜe
 <ğ
dt_aá”
);

335 
	`EXPECT_FALSE
(
dt_aá”
 =ğ
dt_befÜe
);

336 
	`EXPECT_TRUE
(
dt_aá”
 !ğ
dt_befÜe
);

337 
	`EXPECT_TRUE
(
dt_aá”
 > 
dt_befÜe
);

338 
	`EXPECT_FALSE
(
dt_aá”
 < 
dt_befÜe
);

339 
	`EXPECT_TRUE
(
dt_aá”
 >ğ
dt_befÜe
);

340 
	`EXPECT_FALSE
(
dt_aá”
 <ğ
dt_befÜe
);

341 
	}
}

343 
	$TEST
(
UTCTimeTe¡
, 
IÁeg”CÚv”tTe¡
)

345 
FILETIME
 
á
 = 
UTCTime
::
	`G‘Cu¼’tFeTime
();

346 
FILETIME
 
á_uli_cÚv”t
 = 
	`uli_to_á
(
	`á_to_uli
(
á
));

347 
FILETIME
 
á_u64_cÚv”t
 = 
	`u64_to_á
(
	`á_to_u64
(
á
));

348 
FILETIME
 
á_uli_u64_cÚv”t
 = 
	`u64_to_á
(
	`uli_to_u64
(
	`á_to_uli
(
á
)));

349 
FILETIME
 
á_u64_uli_cÚv”t
 = 
	`uli_to_á
(
	`u64_to_uli
(
	`á_to_u64
(
á
)));

351 
	`EXPECT_EQ
(
á
.
dwLowD©eTime
, 
á_uli_cÚv”t
.dwLowDateTime);

352 
	`EXPECT_EQ
(
á
.
dwHighD©eTime
, 
á_uli_cÚv”t
.dwHighDateTime);

353 
	`EXPECT_EQ
(
á
.
dwLowD©eTime
, 
á_u64_cÚv”t
.dwLowDateTime);

354 
	`EXPECT_EQ
(
á
.
dwHighD©eTime
, 
á_u64_cÚv”t
.dwHighDateTime);

355 
	`EXPECT_EQ
(
á
.
dwLowD©eTime
, 
á_uli_u64_cÚv”t
.dwLowDateTime);

356 
	`EXPECT_EQ
(
á
.
dwHighD©eTime
, 
á_uli_u64_cÚv”t
.dwHighDateTime);

357 
	`EXPECT_EQ
(
á
.
dwLowD©eTime
, 
á_u64_uli_cÚv”t
.dwLowDateTime);

358 
	`EXPECT_EQ
(
á
.
dwHighD©eTime
, 
á_u64_uli_cÚv”t
.dwHighDateTime);

360 
ULARGE_INTEGER
 
uli
 = 
	`á_to_uli
(
UTCTime
::
	`G‘Cu¼’tFeTime
());

361 
ULARGE_INTEGER
 
uli_á_cÚv”t
 = 
	`á_to_uli
(
	`uli_to_á
(
uli
));

362 
ULARGE_INTEGER
 
uli_u64_cÚv”t
 = 
	`u64_to_uli
(
	`uli_to_u64
(
uli
));

363 
ULARGE_INTEGER
 
uli_á_u64_cÚv”t
 = 
	`u64_to_uli
(
	`á_to_u64
(
	`uli_to_á
(
uli
)));

364 
ULARGE_INTEGER
 
uli_u64_á_cÚv”t
 = 
	`á_to_uli
(
	`u64_to_á
(
	`uli_to_u64
(
uli
)));

366 
	`EXPECT_EQ
(
uli
.
LowP¬t
, 
uli_á_cÚv”t
.LowPart);

367 
	`EXPECT_EQ
(
uli
.
HighP¬t
, 
uli_á_cÚv”t
.HighPart);

368 
	`EXPECT_EQ
(
uli
.
u
.
LowP¬t
, 
uli_á_cÚv”t
.u.LowPart);

369 
	`EXPECT_EQ
(
uli
.
u
.
HighP¬t
, 
uli_á_cÚv”t
.u.HighPart);

370 
	`EXPECT_EQ
(
uli
.
QuadP¬t
, 
uli_á_cÚv”t
.QuadPart);

371 
	`EXPECT_EQ
(
uli
.
LowP¬t
, 
uli_u64_cÚv”t
.LowPart);

372 
	`EXPECT_EQ
(
uli
.
HighP¬t
, 
uli_u64_cÚv”t
.HighPart);

373 
	`EXPECT_EQ
(
uli
.
u
.
LowP¬t
, 
uli_u64_cÚv”t
.u.LowPart);

374 
	`EXPECT_EQ
(
uli
.
u
.
HighP¬t
, 
uli_u64_cÚv”t
.u.HighPart);

375 
	`EXPECT_EQ
(
uli
.
QuadP¬t
, 
uli_u64_cÚv”t
.QuadPart);

376 
	`EXPECT_EQ
(
uli
.
LowP¬t
, 
uli_á_u64_cÚv”t
.LowPart);

377 
	`EXPECT_EQ
(
uli
.
HighP¬t
, 
uli_á_u64_cÚv”t
.HighPart);

378 
	`EXPECT_EQ
(
uli
.
u
.
LowP¬t
, 
uli_á_u64_cÚv”t
.u.LowPart);

379 
	`EXPECT_EQ
(
uli
.
u
.
HighP¬t
, 
uli_á_u64_cÚv”t
.u.HighPart);

380 
	`EXPECT_EQ
(
uli
.
QuadP¬t
, 
uli_á_u64_cÚv”t
.QuadPart);

381 
	`EXPECT_EQ
(
uli
.
LowP¬t
, 
uli_u64_á_cÚv”t
.LowPart);

382 
	`EXPECT_EQ
(
uli
.
HighP¬t
, 
uli_u64_á_cÚv”t
.HighPart);

383 
	`EXPECT_EQ
(
uli
.
u
.
LowP¬t
, 
uli_u64_á_cÚv”t
.u.LowPart);

384 
	`EXPECT_EQ
(
uli
.
u
.
HighP¬t
, 
uli_u64_á_cÚv”t
.u.HighPart);

385 
	`EXPECT_EQ
(
uli
.
QuadP¬t
, 
uli_u64_á_cÚv”t
.QuadPart);

387 
ušt64_t
 
u64
 = 
	`á_to_u64
(
UTCTime
::
	`G‘Cu¼’tFeTime
());

388 
ušt64_t
 
u64_á_cÚv”t
 = 
	`á_to_u64
(
	`u64_to_á
(
u64
));

389 
ušt64_t
 
u64_uli_cÚv”t
 = 
	`uli_to_u64
(
	`u64_to_uli
(
u64
));

390 
ušt64_t
 
u64_á_uli_cÚv”t
 = 
	`uli_to_u64
(
	`á_to_uli
(
	`u64_to_á
(
u64
)));

391 
ušt64_t
 
u64_uli_á_cÚv”t
 = 
	`á_to_u64
(
	`uli_to_á
(
	`u64_to_uli
(
u64
)));

393 
	`EXPECT_EQ
(
u64
, 
u64_á_cÚv”t
);

394 
	`EXPECT_EQ
(
u64
, 
u64_uli_cÚv”t
);

395 
	`EXPECT_EQ
(
u64
, 
u64_á_uli_cÚv”t
);

396 
	`EXPECT_EQ
(
u64
, 
u64_uli_á_cÚv”t
);

397 
	}
}

	@../common/unittest/timespan_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"commÚ/time.h
"

4 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

6 
	$TEST
(
UTCTimeS·nTe¡
, 
CÚ¡ruùÜTe¡
)

8 
UTCTimeS·n
 
¥ª
;

9 
UTCTimeS·n
 
	`¥ª_s
(1);

10 
UTCTimeS·n
 
	`¥ª_m
(2, 1);

11 
UTCTimeS·n
 
	`¥ª_h
(3, 2, 1);

12 
UTCTimeS·n
 
	`¥ª_d
(4, 3, 2, 1);

14 
	`EXPECT_EQ
(0, 
¥ª
.
	`G‘SecÚd
());

15 
	`EXPECT_EQ
(0, 
¥ª
.
	`G‘Residu®SecÚd
());

16 
	`EXPECT_EQ
(0, 
¥ª
.
	`G‘Mšu‹
());

17 
	`EXPECT_EQ
(0, 
¥ª
.
	`G‘Residu®Mšu‹
());

18 
	`EXPECT_EQ
(0, 
¥ª
.
	`G‘Hour
());

19 
	`EXPECT_EQ
(0, 
¥ª
.
	`G‘Residu®Hour
());

20 
	`EXPECT_EQ
(0, 
¥ª
.
	`G‘Day
());

22 
	`EXPECT_EQ
(1, 
¥ª_s
.
	`G‘SecÚd
());

23 
	`EXPECT_EQ
(1, 
¥ª_s
.
	`G‘Residu®SecÚd
());

24 
	`EXPECT_EQ
(0, 
¥ª_s
.
	`G‘Mšu‹
());

25 
	`EXPECT_EQ
(0, 
¥ª_s
.
	`G‘Residu®Mšu‹
());

26 
	`EXPECT_EQ
(0, 
¥ª_s
.
	`G‘Hour
());

27 
	`EXPECT_EQ
(0, 
¥ª_s
.
	`G‘Residu®Hour
());

28 
	`EXPECT_EQ
(0, 
¥ª_s
.
	`G‘Day
());

30 
	`EXPECT_EQ
(2 * 60 + 1, 
¥ª_m
.
	`G‘SecÚd
());

31 
	`EXPECT_EQ
(1, 
¥ª_m
.
	`G‘Residu®SecÚd
());

32 
	`EXPECT_EQ
(2, 
¥ª_m
.
	`G‘Mšu‹
());

33 
	`EXPECT_EQ
(2, 
¥ª_m
.
	`G‘Residu®Mšu‹
());

34 
	`EXPECT_EQ
(0, 
¥ª_m
.
	`G‘Hour
());

35 
	`EXPECT_EQ
(0, 
¥ª_m
.
	`G‘Residu®Hour
());

36 
	`EXPECT_EQ
(0, 
¥ª_m
.
	`G‘Day
());

38 
	`EXPECT_EQ
(3 * 60 * 60 + 2 * 60 + 1, 
¥ª_h
.
	`G‘SecÚd
());

39 
	`EXPECT_EQ
(1, 
¥ª_h
.
	`G‘Residu®SecÚd
());

40 
	`EXPECT_EQ
(3 * 60 + 2, 
¥ª_h
.
	`G‘Mšu‹
());

41 
	`EXPECT_EQ
(2, 
¥ª_h
.
	`G‘Residu®Mšu‹
());

42 
	`EXPECT_EQ
(3, 
¥ª_h
.
	`G‘Hour
());

43 
	`EXPECT_EQ
(3, 
¥ª_h
.
	`G‘Residu®Hour
());

44 
	`EXPECT_EQ
(0, 
¥ª_h
.
	`G‘Day
());

46 
	`EXPECT_EQ
(4 * 60 * 60 * 24 + 3 * 60 * 60 + 2 * 60 + 1, 
¥ª_d
.
	`G‘SecÚd
());

47 
	`EXPECT_EQ
(1, 
¥ª_d
.
	`G‘Residu®SecÚd
());

48 
	`EXPECT_EQ
(4 * 60 * 24 + 3 * 60 + 2, 
¥ª_d
.
	`G‘Mšu‹
());

49 
	`EXPECT_EQ
(2, 
¥ª_d
.
	`G‘Residu®Mšu‹
());

50 
	`EXPECT_EQ
(4 * 24 + 3, 
¥ª_d
.
	`G‘Hour
());

51 
	`EXPECT_EQ
(3, 
¥ª_d
.
	`G‘Residu®Hour
());

52 
	`EXPECT_EQ
(4, 
¥ª_d
.
	`G‘Day
());

53 
	}
}

55 
	$TEST
(
UTCTimeS·nTe¡
, 
AssignTe¡
)

57 
UTCTimeS·n
 
¥ª
;

58 
UTCTimeS·n
 
	`¥ª_1
(5, 6, 7, 8);

59 
UTCTimeS·n
 
	`¥ª_2
(9, 10, 11, 12);

61 
¥ª
 = 
¥ª_1
;

62 
	`EXPECT_EQ
(5 * 24 * 60 * 60 + 6 * 60 * 60 + 7 * 60 + 8, 
¥ª_1
.
	`G‘SecÚd
());

63 
	`EXPECT_EQ
(
¥ª_1
.
	`G‘SecÚd
(), 
¥ª
.GetSecond());

65 
¥ª
 = 
¥ª_2
;

66 
	`EXPECT_EQ
(9 * 24 * 60 * 60 + 10 * 60 * 60 + 11 * 60 + 12, 
¥ª_2
.
	`G‘SecÚd
());

67 
	`EXPECT_EQ
(
¥ª_2
.
	`G‘SecÚd
(), 
¥ª
.GetSecond());

68 
	}
}

70 
	$TEST
(
UTCTimeS·nTe¡
, 
Com·risÚTe¡
)

72 
UTCTimeS·n
 
	`¥ª_1
(13, 14, 15, 16);

73 
UTCTimeS·n
 
	`¥ª_2
(17, 18, 19, 20);

74 
UTCTimeS·n
 
	`¥ª_3
(17, 18, 19, 20);

76 
	`EXPECT_EQ
(13 * 24 * 60 * 60 + 14 * 60 * 60 + 15 * 60 + 16, 
¥ª_1
.
	`G‘SecÚd
());

77 
	`EXPECT_EQ
(17 * 24 * 60 * 60 + 18 * 60 * 60 + 19 * 60 + 20, 
¥ª_2
.
	`G‘SecÚd
());

78 
	`EXPECT_EQ
(17 * 24 * 60 * 60 + 18 * 60 * 60 + 19 * 60 + 20, 
¥ª_3
.
	`G‘SecÚd
());

80 
	`EXPECT_FALSE
(
¥ª_1
 =ğ
¥ª_2
);

81 
	`EXPECT_TRUE
(
¥ª_1
 !ğ
¥ª_2
);

82 
	`EXPECT_FALSE
(
¥ª_1
 > 
¥ª_2
);

83 
	`EXPECT_TRUE
(
¥ª_1
 < 
¥ª_2
);

84 
	`EXPECT_FALSE
(
¥ª_1
 >ğ
¥ª_2
);

85 
	`EXPECT_TRUE
(
¥ª_1
 <ğ
¥ª_2
);

87 
	`EXPECT_FALSE
(
¥ª_2
 =ğ
¥ª_1
);

88 
	`EXPECT_TRUE
(
¥ª_2
 !ğ
¥ª_1
);

89 
	`EXPECT_TRUE
(
¥ª_2
 > 
¥ª_1
);

90 
	`EXPECT_FALSE
(
¥ª_2
 < 
¥ª_1
);

91 
	`EXPECT_TRUE
(
¥ª_2
 >ğ
¥ª_1
);

92 
	`EXPECT_FALSE
(
¥ª_2
 <ğ
¥ª_1
);

94 
	`EXPECT_TRUE
(
¥ª_2
 =ğ
¥ª_3
);

95 
	`EXPECT_FALSE
(
¥ª_2
 !ğ
¥ª_3
);

96 
	`EXPECT_FALSE
(
¥ª_2
 > 
¥ª_3
);

97 
	`EXPECT_FALSE
(
¥ª_2
 < 
¥ª_3
);

98 
	`EXPECT_TRUE
(
¥ª_2
 >ğ
¥ª_3
);

99 
	`EXPECT_TRUE
(
¥ª_2
 <ğ
¥ª_3
);

100 
	}
}

102 
	$TEST
(
UTCTimeS·nTe¡
, 
O³¿tÜTe¡
)

104 
UTCTimeS·n
 
	`¥ª_1
(21, 22, 23, 24);

105 
UTCTimeS·n
 
	`¥ª_2
(25, 26, 27, 28);

107 
	`EXPECT_EQ
(21 * 24 * 60 * 60 + 22 * 60 * 60 + 23 * 60 + 24, 
¥ª_1
.
	`G‘SecÚd
());

108 
	`EXPECT_EQ
(25 * 24 * 60 * 60 + 26 * 60 * 60 + 27 * 60 + 28, 
¥ª_2
.
	`G‘SecÚd
());

110 
	`EXPECT_EQ
((21 + 25è* 24 * 60 * 60 + (22 + 26è* 60 * 60 + (23 + 27è* 60 + (24 + 28), (
¥ª_1
 + 
¥ª_2
).
	`G‘SecÚd
());

111 
	`EXPECT_EQ
((25 + 21è* 24 * 60 * 60 + (26 + 22è* 60 * 60 + (27 + 23è* 60 + (28 + 24), (
¥ª_2
 + 
¥ª_1
).
	`G‘SecÚd
());

112 
	`EXPECT_EQ
((21 - 25è* 24 * 60 * 60 + (22 - 26è* 60 * 60 + (23 - 27è* 60 + (24 - 28), (
¥ª_1
 - 
¥ª_2
).
	`G‘SecÚd
());

113 
	`EXPECT_EQ
((25 - 21è* 24 * 60 * 60 + (26 - 22è* 60 * 60 + (27 - 23è* 60 + (28 - 24), (
¥ª_2
 - 
¥ª_1
).
	`G‘SecÚd
());

114 
	}
}

	@../common/utility.h

1 #iâdeà
__SYSUTILS_UTILITY_H__


2 
	#__SYSUTILS_UTILITY_H__


	)

4 #ià
defšed
(
__GNUC__
)

5 
	#__FUNCTION_SIGNATURE__
 
__PRETTY_FUNCTION__


	)

6 #–ià
defšed
(
_MSC_VER
)

7 
	#__FUNCTION_SIGNATURE__
 
__FUNCSIG__


	)

9 
	#__FUNCTION_SIGNATURE__
 
__FUNCTION__


	)

12 
	#IF_TRUE_RETURN
(
s
) \

15 ià((
s
)) \

19 } 0)

	)

21 
	#IF_TRUE_RETURN_VALUE
(
s
, 
v
) \

24 ià((
s
)) \

26  (
v
); \

28 } 0)

	)

30 
	#IF_FALSE_RETURN
(
s
) \

33 ià(!(
s
)) \

37 } 0)

	)

39 
	#IF_FALSE_RETURN_VALUE
(
s
, 
v
) \

42 ià(!(
s
)) \

44  (
v
); \

46 } 0)

	)

48 
	#IF_EQUAL_RETURN
(
a
, 
b
) \

49 
	`IF_TRUE_RETURN
((
a
è=ğ(
b
))

	)

51 
	#IF_EQUAL_RETURN_VALUE
(
a
, 
b
, 
v
) \

52 
	`IF_TRUE_RETURN_VALUE
((
a
è=ğ(
b
), 
v
)

	)

54 
	#IF_NOT_EQUAL_RETURN
(
a
, 
b
) \

55 
	`IF_TRUE_RETURN
((
a
è!ğ(
b
))

	)

57 
	#IF_NOT_EQUAL_RETURN_VALUE
(
a
, 
b
, 
v
) \

58 
	`IF_TRUE_RETURN_VALUE
((
a
è!ğ(
b
), 
v
)

	)

60 
	#IF_NULL_RETURN
(
p
) \

61 
	`IF_EQUAL_RETURN
(
p
, 
NULL
)

	)

63 
	#IF_NULL_RETURN_VALUE
(
p
, 
v
) \

64 
	`IF_EQUAL_RETURN_VALUE
(
p
, 
NULL
, 
v
)

	)

66 
	#IF_NOT_NULL_RETURN
(
p
) \

67 
	`IF_NOT_EQUAL_RETURN
(
p
, 
NULL
)

	)

69 
	#IF_NOT_NULL_RETURN_VALUE
(
p
, 
v
) \

70 
	`IF_NOT_EQUAL_RETURN_VALUE
(
p
, 
NULL
, 
v
)

	)

72 
	#SAFE_DELETE
(
p
) \

75 
	`d–‘e
 (
p
); \

76 (
p
èğ
NULL
; \

77 } 0)

	)

79 
	#SAFE_DELETE_ARRAY
(
p
) \

82 
d–‘e
 [] (
p
); \

83 (
p
èğ
NULL
; \

84 } 0)

	)

	@../curl/FtpClient.cpp

1 
	~"FCl›Á.h
"

3 
	~"debugMsg/Debug.h
"

5 
	~<¡ršg.h
>

7 #iâdeà
WIN32


8 
	~<”ºo.h
>

9 
	~<¬·/š‘.h
>

12 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

14 
DLL_PUBLIC
 
	gCFCl›Á
::
	$CFCl›Á
(cÚ¡ 
¡d
::
¡ršg
& 
£rv”Ip
, cÚ¡ std::¡ršg& 
u£ºame
,

15 cÚ¡ 
¡d
::
¡ršg
& 
·sswÜd
, cÚ¡ 
ušt64_t
 
£rv”PÜt
, cÚ¡ std::¡ršg& 
»mÙeP©h
,

16 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
, cÚ¡ std::¡ršg& 
loÿlP©h
, 
ušt32_t
 
timeout
)

17 : 
	`CN‘Cl›Á
(
£rv”Ip
, 
u£ºame
, 
·sswÜd
, 
£rv”PÜt
)

18 , 
	`m_RemÙeP©h
(
»mÙeP©h
)

19 , 
	`m_F’ame
(
f’ame
)

20 , 
	`m_LoÿlP©h
(
loÿlP©h
)

21 , 
	`m_uiTimeout
(
timeout
)

22 , 
	$m_eE¼Code
(
FTP_CLIENT_SUCCESS
)

24 
	}
}

26 
DLL_PUBLIC
 
	gCFCl›Á
::~
	$CFCl›Á
()

28 
	}
}

30 
DLL_PUBLIC
 
boŞ
 
CFCl›Á
::
	$P¬am‘”Check
()

33 ià(
m_S”v”Ip
.
	`em±y
())

35 
	`TRACE
("Server Ip isƒmpty!!\n");

36  
çl£
;

38 #iâdeà
WIN32


41 
sockaddr_š
 
§
;

42 
boŞ
 
bR‘
 = 
	`š‘_±Ú
(
AF_INET
, 
m_S”v”Ip
.
	`c_¡r
(), &(
§
.
sš_addr
));

43 ià(
bR‘
 == -1)

45 
	`TRACE
("IP i šv®id: %d\n", 
”ºo
);

46  
çl£
;

52 ià(
m_S”v”PÜt
 < 1 || m_ServerPort > 65535)

54 
	`TRACE
("PÜˆouˆoà¿nge: %Îu\n", 
m_S”v”PÜt
);

55  
çl£
;

59 ià(
m_U£ºame
.
	`em±y
())

61 
m_U£ºame
 = "anonymous";

62 
m_PasswÜd
 = "anonymous@titan.nuuo.com";

66 ià(
m_RemÙeP©h
.
	`em±y
(è|| m_RemÙeP©h.
	`com·»
(0, 1, "/") != 0)

68 
m_RemÙeP©h
 = "/" + m_RemotePath;

72 ià(
m_LoÿlP©h
.
	`em±y
())

74 
m_LoÿlP©h
 = "./";

77  
Œue
;

78 
	}
}

80 
DLL_PUBLIC
 
ušt32_t
 
	gCFCl›Á
::
	$CÚv”E¼ÜCode
(
CURLcode
 
CURLECode
)

82 
ušt32_t
 
uFE¼Code
 = 
FTP_CLIENT_SUCCESS
;

84 ià(
CURLECode
 =ğ
CURLE_COULDNT_RESOLVE_HOST
)

86 
uFE¼Code
 = 
FTP_CLIENT_FAIL_PARAM
;

88 ià(
CURLECode
 =ğ
CURLE_REMOTE_ACCESS_DENIED
 || CURLECod=ğ
CURLE_FTP_ACCEPT_FAILED


89 || 
CURLECode
 =ğ
CURLE_FTP_ACCEPT_TIMEOUT
 || CURLECod=ğ
CURLE_OPERATION_TIMEDOUT
)

91 
uFE¼Code
 = 
FTP_CLIENT_FAIL_ACCESS
;

93 ià(
CURLECode
 =ğ
CURLE_COULDNT_CONNECT
 || CURLECod=ğ
CURLE_SSL_CONNECT_ERROR
)

95 
uFE¼Code
 = 
FTP_CLIENT_FAIL_CONNECT
;

97 ià(
CURLECode
 =ğ
CURLE_LOGIN_DENIED
)

99 
uFE¼Code
 = 
FTP_CLIENT_FAIL_ACCOUNT
;

103 
uFE¼Code
 = 
FTP_CLIENT_FAIL_UNKNOWN
;

105 
	`´štf
("ápcode: %u,ƒ¼Ü occurs: [%s], code: %d\n", 
uFE¼Code
, 
	`cu¾_—sy_¡»¼Ü
(
CURLECode
), CURLECode);

106  
uFE¼Code
;

107 
	}
}

109 
DLL_PUBLIC
 
boŞ
 
	gCFCl›Á
::
	$S‘BasicO±iÚ
(
¡d
::
¡ršg
 
FuÎU¾P©h
, * 
E¼ÜBuf
)

111 
m_Cu¾
 = 
	`cu¾_—sy_š™
();

112 ià(
m_Cu¾
 =ğ
NULL
)

114 
	`TRACE
("curl_easy_init()ƒrror.\n");

115  
çl£
;

118 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_USERNAME
, 
m_U£ºame
.
	`c_¡r
());

119 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_PASSWORD
, 
m_PasswÜd
.
	`c_¡r
());

121 
	`TRACE
("FuÎU¾P©h = %s\n", 
FuÎU¾P©h
.
	`c_¡r
());

122 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_URL
, 
FuÎU¾P©h
.
	`c_¡r
());

124 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_PORT
, 
m_S”v”PÜt
);

126 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_TIMEOUT
, 
m_uiTimeout
);

127 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_FTP_CREATE_MISSING_DIRS
, 1L);

128 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_FTP_USE_EPSV
, 0L);

129 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_ERRORBUFFER
, 
E¼ÜBuf
);

130 #ifdeà
_DEBUG


131 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_VERBOSE
, 1L);

134  
Œue
;

135 
	}
}

137 
DLL_PUBLIC
 
boŞ
 
	gCFCl›Á
::
	$RemoveFe
()

139 
cu¾_¦i¡
 *
cmdLi¡
 = 
NULL
;

140 
”rÜ
[1024] = {0};

141 
CURLcode
 
»suÉ
 = 
CURLE_OK
;

143 
¡d
::
¡ršg
 
fuÎU¾P©h
 = "áp://" + 
m_S”v”Ip
;

145 ià(!
	`S‘BasicO±iÚ
(
fuÎU¾P©h
, 
”rÜ
))

147 
	`TRACE
("SetBasicOption failed\n");

148  
çl£
;

152 
¡d
::
¡ršg
 
cmd
 = "CWD " + 
m_RemÙeP©h
;

153 
cmdLi¡
 = 
	`cu¾_¦i¡_­³nd
(cmdLi¡, 
cmd
.
	`c_¡r
());

154 
cmd
 = "DELE " + 
m_F’ame
;

155 
cmdLi¡
 = 
	`cu¾_¦i¡_­³nd
(cmdLi¡, 
cmd
.
	`c_¡r
());

156 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_QUOTE
, 
cmdLi¡
);

158 
»suÉ
 = 
	`cu¾_—sy_³rfÜm
(
m_Cu¾
);

159 
	`cu¾_¦i¡_ä“_®l
(
cmdLi¡
);

161 
	`cu¾_—sy_ş—nup
(
m_Cu¾
);

162 
m_Cu¾
 = 
NULL
;

164 
boŞ
 
bR‘
 = 
çl£
;

165 ià(
»suÉ
 !ğ
CURLE_OK
)

167 
	`TRACE
("RemoveF»suÉ i %d\n", 
»suÉ
);

168 
m_eE¼Code
 = 
	`CÚv”E¼ÜCode
(
»suÉ
);

169 ià(!
	`¡rcmp
(
”rÜ
, "QUOT command failed with 550"))

171 
	`TRACE
("% dÛ¢'ˆexi¡, cª'ˆd–‘e.\n", 
m_F’ame
.
	`c_¡r
());

172 
m_eE¼Code
 = 
FTP_CLIENT_SUCCESS
;

177 
m_eE¼Code
 = 
FTP_CLIENT_SUCCESS
;

180 ià(
m_eE¼Code
 =ğ
FTP_CLIENT_SUCCESS
)

182 
bR‘
 = 
Œue
;

184  
bR‘
;

185 
	}
}

187 
DLL_PUBLIC
 
boŞ
 
	gCFCl›Á
::
	$U¶ßdFe
()

189 
FILE
 *
u¶ßdFe
 = 
NULL
;

190 
¡©
 
u¶ßdFeInfo
;

191 
cu¾_off_t
 
feSize
 = 0;

192 
”rÜ
[1024] = {0};

193 
CURLcode
 
»suÉ
 = 
CURLE_OK
;

195 
¡d
::
¡ršg
 
fuÎU¾P©h
 = "áp://" + 
m_S”v”Ip
 + 
m_RemÙeP©h
 + "/" + 
m_F’ame
;

197 ià(!
	`S‘BasicO±iÚ
(
fuÎU¾P©h
, 
”rÜ
))

199  
çl£
;

203 
¡d
::
¡ršg
 
loÿlFeAbsŞu‹P©h
 = 
m_LoÿlP©h
 + "/" + 
m_F’ame
;

204 
	`TRACE
("LoÿÈFP©h = %s\n", 
loÿlFeAbsŞu‹P©h
.
	`c_¡r
());

205 ià(
	`¡©
(
loÿlFeAbsŞu‹P©h
.
	`c_¡r
(), &
u¶ßdFeInfo
))

207 
	`TRACE
("Couldn'ˆİ’ %s\n", 
m_F’ame
.
	`c_¡r
());

208  
çl£
;

210 
feSize
 = (
cu¾_off_t
)
u¶ßdFeInfo
.
¡_size
;

212 
u¶ßdFe
 = 
	`fİ’
(
loÿlFeAbsŞu‹P©h
.
	`c_¡r
(), "rb");

213 ià(
u¶ßdFe
 =ğ
NULL
)

215 
	`TRACE
("Couldn'ˆİ’ %s\n", 
loÿlFeAbsŞu‹P©h
.
	`c_¡r
());

216  
çl£
;

219 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_UPLOAD
, 1L);

220 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_READDATA
, 
u¶ßdFe
);

221 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_INFILESIZE
, 
feSize
);

223 
»suÉ
 = 
	`cu¾_—sy_³rfÜm
(
m_Cu¾
);

224 
	`TRACE
("U¶ßdF»suÉ i %d\n", 
»suÉ
);

225 
	`cu¾_—sy_ş—nup
(
m_Cu¾
);

226 
m_Cu¾
 = 
NULL
;

228 ià(
u¶ßdFe
 !ğ
NULL
)

230 
	`fşo£
(
u¶ßdFe
);

233 ià(
»suÉ
 !ğ
CURLE_OK
)

235 
m_eE¼Code
 = 
	`CÚv”E¼ÜCode
(
»suÉ
);

236  
çl£
;

238 
m_eE¼Code
 = 
FTP_CLIENT_SUCCESS
;

239  
Œue
;

240 
	}
}

242 
DLL_PUBLIC
 
boŞ
 
	gCFCl›Á
::
	$FTe¡
(
ušt32_t
 &
”rCode
)

244 ià(!
	`P¬am‘”Check
())

246 
	`TRACE
("Parameter Check Fail!!\n");

247 
”rCode
 = 
FTP_CLIENT_FAIL_PARAM
;

248  
çl£
;

251 ià(
	`RemoveFe
())

253 ià(
	`U¶ßdFe
())

255  
Œue
;

259 
	`TRACE
("Upload File Fail!!\n");

260 
”rCode
 = 
m_eE¼Code
;

261  
çl£
;

266 
	`TRACE
("Remove File Fail!!\n");

267 
”rCode
 = 
m_eE¼Code
;

268  
çl£
;

270 
	}
}

272 
DLL_PUBLIC
 
boŞ
 
	gCFCl›Á
::
	$P”fÜm
()

274 ià(!
	`P¬am‘”Check
())

276 
	`TRACE
("Parameter Check Fail!!\n");

277  
çl£
;

280 ià(
	`U¶ßdFe
())

282  
Œue
;

286 
	`TRACE
("Upload File Fail!!\n");

287  
çl£
;

289 
	}
}

	@../curl/FtpClient.h

1 #iâdeà
_FTP_CLIENT_H_


2 
	#_FTP_CLIENT_H_


	)

4 #ifdeà
WIN32


5 
	~<io.h
>

7 
	~<uni¡d.h
>

9 
	~<sys/¡©.h
>

11 
	~"expÜts.h
"

12 
	~"N‘Cl›Á.h
"

14 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

16 şas 
	cDLL_PUBLIC
 
	gCFCl›Á
: 
public
 
CN‘Cl›Á


18 
public
:

19 
	eFTPCl›ÁE¼ÜCode


22 
FTP_CLIENT_SUCCESS
 = 0x00000000,

24 
	gFTP_CLIENT_FAIL_CONNECT
 = 0x80000001,

25 
	gFTP_CLIENT_FAIL_ACCOUNT
 = 0x80000002,

26 
	gFTP_CLIENT_FAIL_TIMEOUT
 = 0x80000003,

27 
	gFTP_CLIENT_FAIL_ACCESS
 = 0x80000004,

28 
	gFTP_CLIENT_FAIL_PARAM
 = 0x80000005,

29 
	gFTP_CLIENT_FAIL_UNKNOWN
 = 0xFFFFFFFF,

32 
CFCl›Á
(cÚ¡ 
¡d
::
¡ršg
& 
£rv”Ip
, cÚ¡ std::¡ršg& 
u£ºame
, cÚ¡ std::¡ršg& 
·sswÜd
,

33 cÚ¡ 
ušt64_t
 
£rv”PÜt
, cÚ¡ 
¡d
::
¡ršg
& 
»mÙeP©h
, cÚ¡ std::¡ršg& 
f’ame
,

34 cÚ¡ 
¡d
::
¡ršg
& 
loÿlP©h
, 
ušt32_t
 
timeouÁ
);

35 ~
CFCl›Á
();

37 
boŞ
 
FTe¡
(
ušt32_t
 &
”rCode
);

38 
boŞ
 
P”fÜm
();

40 
	g´iv©e
:

41 
CFCl›Á
(cÚ¡ CFCl›Á& 
rhs
);

42 
	gCFCl›Á
& 
	gİ”©Ü
=(cÚ¡ 
CFCl›Á
& 
rhs
);

44 
	g´iv©e
:

45 
boŞ
 
P¬am‘”Check
();

46 
ušt32_t
 
CÚv”E¼ÜCode
(
CURLcode
 
CURLECode
);

48 
boŞ
 
S‘BasicO±iÚ
(
¡d
::
¡ršg
 
FuÎU¾P©h
, * 
E¼ÜBuf
);

49 
boŞ
 
RemoveFe
();

50 
boŞ
 
U¶ßdFe
();

52 
	g¡d
::
¡ršg
 
m_RemÙeP©h
;

53 
	g¡d
::
¡ršg
 
m_F’ame
;

54 
	g¡d
::
¡ršg
 
m_LoÿlP©h
;

55 
ušt32_t
 
	gm_uiTimeout
;

56 
ušt32_t
 
	gm_eE¼Code
;

	@../curl/NetClient.cpp

1 
	~"N‘Cl›Á.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
DLL_PUBLIC
 
	gCN‘Cl›Á
::
	$CN‘Cl›Á
(cÚ¡ 
¡d
::
¡ršg
& 
£rv”Ip
, cÚ¡ std::¡ršg& 
u£ºame
, cÚ¡ std::¡ršg& 
·sswÜd
,

6 cÚ¡ 
ušt64_t
 
£rv”PÜt
)

7 : 
	`m_Cu¾
(
NULL
)

8 , 
	`m_S”v”Ip
(
£rv”Ip
)

9 , 
	`m_S”v”PÜt
(
£rv”PÜt
)

10 , 
	`m_U£ºame
(
u£ºame
)

11 , 
	$m_PasswÜd
(
·sswÜd
)

14 
	`cu¾_glob®_š™
(
CURL_GLOBAL_ALL
);

15 
	}
}

17 
DLL_PUBLIC
 
	gCN‘Cl›Á
::~
	$CN‘Cl›Á
()

19 ià(
m_Cu¾
 !ğ
NULL
)

21 
	`cu¾_—sy_ş—nup
(
m_Cu¾
);

24 
	`cu¾_glob®_ş—nup
();

25 
	}
}

	@../curl/NetClient.h

1 #iâdeà
_NET_CLIENT_H_


2 
	#_NET_CLIENT_H_


	)

4 
	~<¡ršg
>

5 
	~<cu¾/cu¾.h
>

7 
	~"expÜts.h
"

8 
	~"commÚ/¡dšt.h
"

10 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

12 şas 
	cDLL_PUBLIC
 
	gCN‘Cl›Á


14 
	gpublic
:

15 
CN‘Cl›Á
(cÚ¡ 
¡d
::
¡ršg
& 
£rv”Ip
, cÚ¡ std::¡ršg& 
u£ºame
, cÚ¡ std::¡ršg& 
·sswÜd
,

16 cÚ¡ 
ušt64_t
 
£rv”PÜt
);

17 
	gvœtu®
 ~
CN‘Cl›Á
();

19 
	eeS”v”PÜt


21 
	gFTP_PORT
 = 21,

22 
	gSMTP_PORT
 = 25,

23 
	gSMTP_SSL_PORT
 = 465,

24 
	gSMTP_TLS_PORT
 = 587,

27 
vœtu®
 
boŞ
 
P”fÜm
() = 0;

29 
	g´iv©e
:

30 
CN‘Cl›Á
(cÚ¡ CN‘Cl›Á& 
rhs
);

31 
	gCN‘Cl›Á
& 
	gİ”©Ü
=(cÚ¡ 
CN‘Cl›Á
& 
rhs
);

33 
	g´Ùeùed
:

34 
vœtu®
 
boŞ
 
P¬am‘”Check
() = 0;

36 
CURL
* 
	gm_Cu¾
;

38 
	g¡d
::
¡ršg
 
m_S”v”Ip
;

39 
ušt64_t
 
	gm_S”v”PÜt
;

40 
	g¡d
::
¡ršg
 
m_U£ºame
;

41 
	g¡d
::
¡ršg
 
m_PasswÜd
;

	@../curl/SmtpClient.cpp

1 
	~"SmCl›Á.h
"

2 
	~"commÚ/time.h
"

4 
	~<sys/timeb.h
>

5 
	~"debugMsg/Debug.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

16 
DLL_PUBLIC
 
	gCSmCl›Á
::
CSmCl›Á
(cÚ¡ 
¡d
::
¡ršg
& 
£rv”Ip
, cÚ¡ std::¡ršg& 
u£ºame
,

17 cÚ¡ 
¡d
::
¡ršg
& 
·sswÜd
, cÚ¡ 
ušt64_t
 
£rv”PÜt
, cÚ¡ std::¡ršg& 
£nd”
,

18 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
»ûiv”s
, cÚ¡ std::¡ršg& 
subjeù
,

19 cÚ¡ 
¡d
::
¡ršg
& 
body
, 
boŞ
 
ÃedAuth
, boŞ 
u£TLS
, boŞ 
u£SSL
,

20 cÚ¡ 
¡d
::
veùÜ
<
A‰achInfo
>& 
©chedFes
)

21 : 
CN‘Cl›Á
(
£rv”Ip
, 
u£ºame
, 
·sswÜd
, 
£rv”PÜt
)

22 , 
m_S’d”
(
£nd”
)

23 , 
m_Subjeù
(
subjeù
)

24 , 
m_Body
(
body
)

25 , 
m_N“dAuth
(
ÃedAuth
)

26 , 
m_U£TLS
(
u£TLS
)

27 , 
m_U£SSL
(
u£SSL
)

28 , 
	$m_A‰achedFes
(
©chedFes
)

30 
size_t
 
i
 = 0; i < 
»ûiv”s
.
	`size
(); i++)

32 
m_Reûiv”s
.
	`push_back
(
»ûiv”s
[
i
]);

34 
	}
}

36 
DLL_PUBLIC
 
	gCSmCl›Á
::~
	$CSmCl›Á
()

38 
	}
}

40 
DLL_PUBLIC
 
boŞ
 
CSmCl›Á
::
	$P¬am‘”Check
()

43 ià(
m_S”v”Ip
.
	`em±y
())

45 
	`ASSERT2
(0, "Server Ip isƒmpty!!\n");

47  
çl£
;

51 ià(
m_S”v”PÜt
 < 1 || m_ServerPort > 35535)

53 
	`ASSERT2
(0, "PÜˆouˆoà¿nge: %Îu\n", 
m_S”v”PÜt
);

55  
çl£
;

59 ià(
m_S’d”
.
	`em±y
())

61 
	`ASSERT2
(0, "Sender isƒmpty!!\n");

63  
çl£
;

67 ià(
m_Reûiv”s
.
	`em±y
())

69 
	`ASSERT2
(0, "Receiver isƒmpty!!\n");

71  
çl£
;

75 ià(
m_Subjeù
.
	`em±y
())

77 
m_Subjeù
 = "This is‡est mail.";

81 ià(
m_Body
.
	`em±y
())

83 
m_Body
 = "This is‡est mail from Titan.\n";

87 ià(!
m_N“dAuth
)

89 
	`TRACE
("m_NeedAuth is false, don't‚eed username /…assword?\n");

92 
m_U£ºame
.
	`ş—r
();

93 
m_PasswÜd
.
	`ş—r
();

97 ià(
m_U£TLS
 && 
m_U£SSL
)

99 ià(
m_S”v”PÜt
 =ğ
SMTP_PORT
 || m_S”v”PÜˆ=ğ
SMTP_TLS_PORT
)

102 
m_U£SSL
 = 
çl£
;

104 ià(
m_S”v”PÜt
 =ğ
SMTP_SSL_PORT
)

107 
m_U£TLS
 = 
çl£
;

112 
m_U£SSL
 = 
çl£
;

114 
	`TRACE
("TLS & SSL bÙh‡»rue. AccÜdšgØS”v”PÜˆ(%Îu), S‘ TLS = %s, SSL = %s\n", 
m_S”v”PÜt
,

115 
m_U£TLS
 ? "true" : "false",

116 
m_U£SSL
 ? "true" : "false");

119  
Œue
;

120 
	}
}

122 
DLL_PUBLIC
 
size_t
 
	gCSmCl›Á
::
	$CİyMes§geToBuf
(*
cu¾IÁ”ÇlPŒ
, 
size_t
 
size
, size_ˆ
nby‹s
, *
u£rD©a
)

124 
¡Cu¾FunU§ge
* 
mes§ge
 = (¡Cu¾FunU§ge*)
u£rD©a
;

126 ià((
size
 =ğ0è|| (
nby‹s
 == 0) || ((size *‚bytes) < 1))

131 ià(
mes§ge
->
£ndšgCÁ
 == 1)

133 
	`TRACE
("S’dCouÁ = %d, Max = %d, Mes§gBody = %d\n", 
mes§ge
->
£ndšgCÁ
, (
size
 * 
nby‹s
), mes§ge->
mes§geBody
.
	`Ëngth
());

134 
size_t
 
Ën
 = 
mes§ge
->
mes§geBody
.
	`Ëngth
();

135 
	`memıy
(
cu¾IÁ”ÇlPŒ
, 
mes§ge
->
mes§geBody
.
	`c_¡r
(), 
Ën
);

136 
mes§ge
->
£ndšgCÁ
 = 0;

138  
Ën
;

142 
	`TRACE
("S’dCouÁ = %d, R‘uº 0Ø’d msg s’dšg\n", 
mes§ge
->
£ndšgCÁ
);

146 
	}
}

148 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
CSmCl›Á
::
	$MakeMes§ge
()

150 
ušt64_t
 
á
 = 
	`á_to_u64
(
UTCTime
::
	`G‘Cu¼’tFeTime
());

151 
¡d
::
¡ršg
 
time
 = 
	`u64_to_¡r
(
á
);

153 
¡d
::
¡ršg
 
bound¬y
 = "THISISJUSTABOUNDARYNOTHINGMORE";

155 cÚ¡ 
h—d
[] =

156 "CÚ‹Á-Ty³: muÉ¬t/mixed; bound¬y=\"%s\"" 
CRLF


157 "To: %s" 
CRLF


158 "From: % (%s)" 
CRLF


160 "Subjeù: %s" 
CRLF


161 "MIME-VERSION: 1.0" 
CRLF


162 "Mes§ge-ID: <%s@T™ª.NUUO>" 
CRLF


163 
CRLF


166 
¡d
::
¡ršg
 
ccLi¡
;

167 ià(
m_Reûiv”s
.
	`size
() != 0)

169 
size_t
 
i
 = 1; i < 
m_Reûiv”s
.
	`size
(); i++)

171 cÚ¡ 
cc
[] = "Cc: % (%s)" 
CRLF
;

172 
ccLi¡
 +ğ
	`¡ršg_fÜm©
(
cc
, 
m_Reûiv”s
[
i
].
	`c_¡r
(), m_Receivers[i].c_str());

177 
ccLi¡
.
	`ş—r
();

180 
¡d
::
¡ršg
 
h—dInfo
 = 
	`¡ršg_fÜm©
(
h—d
, 
bound¬y
.
	`c_¡r
(), 
m_Reûiv”s
[0].c_¡r(), 
m_S’d”
.c_str(),

181 
m_S’d”
.
	`c_¡r
(), 
ccLi¡
.c_¡r(), 
m_Subjeù
.c_¡r(), 
time
.c_str());

183 cÚ¡ 
body
[] =

184 "--%s" 
CRLF


185 "CÚ‹Á-Ty³:ext/html; ch¬£t=utf-8" 
CRLF


186 
CRLF


187 "%s" 
CRLF
;

188 
¡d
::
¡ršg
 
bodyInfo
 = 
	`¡ršg_fÜm©
(
body
, 
bound¬y
.
	`c_¡r
(), 
m_Body
.c_str());

190 
¡d
::
¡ršg
 
©chInfo
;

191 ià(!
m_A‰achedFes
.
	`em±y
())

193 
¡d
::
veùÜ
<
A‰achInfo
>::
™”©Ü
 
™
 = 
m_A‰achedFes
.
	`begš
(); iˆ!ğm_A‰achedFes.
	`’d
(); it++)

195 cÚ¡ 
©ch
[] =

196 "--%s" 
CRLF


197 "CÚ‹Á-Ty³:‡µliÿtiÚ/X-Ùh”-1;‚ame=\"%s\"" 
CRLF


198 "CÚ‹Á-Di¥os™iÚ:‡‰achm’t; f’ame=%s" 
CRLF


199 "CÚ‹Á-T¿nsãr-Encodšg: ba£64" 
CRLF


200 
CRLF


201 "%s" 
CRLF
;

202 
©chInfo


203 +ğ
	`¡ršg_fÜm©
(
©ch
, 
bound¬y
.
	`c_¡r
(), 
™
->
Çme
.c_¡r(), it->Çme.c_¡r(), it->
cÚ‹Á
.c_str());

207 
¡d
::
¡ršg
 
’dInfo
 = "--" + 
bound¬y
 + "--" + 
CRLF
 + CRLF;

209  (
h—dInfo
 + 
bodyInfo
 + 
©chInfo
 + 
’dInfo
);

210 
	}
}

212 
DLL_PUBLIC
 
boŞ
 
	gCSmCl›Á
::
	$S‘BasicO±iÚ
(* 
E¼ÜBuf
)

214 
m_Cu¾
 = 
	`cu¾_—sy_š™
();

215 ià(
m_Cu¾
 =ğ
NULL
)

217 
	`ASSERT2
(0, "curl_easy_init()ƒrror.\n");

219  
çl£
;

222 ià(
m_N“dAuth
)

224 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_USERNAME
, 
m_U£ºame
.
	`c_¡r
());

225 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_PASSWORD
, 
m_PasswÜd
.
	`c_¡r
());

228 
¡d
::
¡ršg
 
fuÎU¾P©h
;

229 ià(
m_U£TLS
)

231 
fuÎU¾P©h
 = "sm://" + 
m_S”v”Ip
;

233 ià(
m_U£SSL
)

235 
fuÎU¾P©h
 = "sms://" + 
m_S”v”Ip
;

239 
fuÎU¾P©h
 = "sm://" + 
m_S”v”Ip
;

241 
	`TRACE
("FuÎU¾P©h = %s\n", 
fuÎU¾P©h
.
	`c_¡r
());

242 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_URL
, 
fuÎU¾P©h
.
	`c_¡r
());

244 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_PORT
, 
m_S”v”PÜt
);

245 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_TIMEOUT
, 30L);

246 ià(
m_U£TLS
 || 
m_U£SSL
)

248 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_USE_SSL
, ()
CURLUSESSL_ALL
);

250 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

251 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_ERRORBUFFER
, 
E¼ÜBuf
);

252 #ifdeà
_DEBUG


253 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_VERBOSE
, 1L);

255 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_NOSIGNAL
, 1L);

257  
Œue
;

258 
	}
}

260 
DLL_PUBLIC
 
boŞ
 
	gCSmCl›Á
::
	$P”fÜm
()

262 
cu¾_¦i¡
 *
»c›Ás
 = 
NULL
;

263 
CURLcode
 
»suÉ
 = 
CURLE_OK
;

264 
”rÜ
[1024] = {0};

265 
¡Cu¾FunU§ge
 
mes§ge
 = {1, ""};

267 ià(!
	`P¬am‘”Check
())

269 
	`ASSERT2
(0, "ParameterCheck check fail\n");

271  
çl£
;

274 ià(!
	`S‘BasicO±iÚ
(
”rÜ
))

276 
	`ASSERT2
(0, "SetBasicOption check fail\n");

278  
çl£
;

281 
¡d
::
¡ršg
 
tmp
 = "<" + 
m_S’d”
 + ">";

282 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_MAIL_FROM
, 
tmp
.
	`c_¡r
());

284 
size_t
 
i
 = 0; i < 
m_Reûiv”s
.
	`size
(); i++)

286 
tmp
 = "<" + 
m_Reûiv”s
[
i
] + ">";

287 
»c›Ás
 = 
	`cu¾_¦i¡_­³nd
Ôec›Ás, 
tmp
.
	`c_¡r
());

289 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_MAIL_RCPT
, 
»c›Ás
);

291 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_READFUNCTION
, 
CİyMes§geToBuf
);

292 
mes§ge
.
mes§geBody
 = 
	`MakeMes§ge
();

293 
	`cu¾_—sy_£tİt
(
m_Cu¾
, 
CURLOPT_READDATA
, &
mes§ge
);

295 
»suÉ
 = 
	`cu¾_—sy_³rfÜm
(
m_Cu¾
);

296 
	`cu¾_¦i¡_ä“_®l
(
»c›Ás
);

298 ià(
»suÉ
 !ğ
CURLE_OK
)

300 
	`ASSERT2
(0, "S’dšgƒma fa dutØ%s\À[%s]\n", 
	`cu¾_—sy_¡»¼Ü
(
»suÉ
), 
m_Body
.
	`c_¡r
());

301 
	`ASSERT2
(0, "E¼Ü mes§gi %s\n", 
”rÜ
);

303 
	`cu¾_—sy_ş—nup
(
m_Cu¾
);

304 
m_Cu¾
 = 
NULL
;

306  
çl£
;

309 
	`cu¾_—sy_ş—nup
(
m_Cu¾
);

310 
m_Cu¾
 = 
NULL
;

312  
Œue
;

313 
	}
}

	@../curl/SmtpClient.h

1 #iâdeà
_SMTP_CLIENT_H_


2 
	#_SMTP_CLIENT_H_


	)

4 
	~<veùÜ
>

6 
	~"expÜts.h
"

7 
	~"N‘Cl›Á.h
"

8 
	~"commÚ/¡ršg.h
"

10 
	#CRLF
 "\r\n"

	)

12 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 #ià
defšed
(
_WIN32
)

16 #´agm¨
w¬nšg
(
di§bË
: 4251)

19 şas 
	cDLL_PUBLIC
 
	gCSmCl›Á
: 
public
 
CN‘Cl›Á


21 
public
:

22 
	sA‰achInfo


24 
¡d
::
¡ršg
 
Çme
;

25 
	g¡d
::
¡ršg
 
cÚ‹Á
;

28 
	gpublic
:

29 
CSmCl›Á
(cÚ¡ 
¡d
::
¡ršg
& 
£rv”Ip
, cÚ¡ std::¡ršg& 
u£ºame
, cÚ¡ std::¡ršg& 
·sswÜd
,

30 cÚ¡ 
ušt64_t
 
£rv”PÜt
, cÚ¡ 
¡d
::
¡ršg
& 
£nd”
, cÚ¡ std::
veùÜ
<¡d::¡ršg>& 
»ûiv”s
,

31 cÚ¡ 
¡d
::
¡ršg
& 
subjeù
, cÚ¡ std::¡ršg& 
body
, 
boŞ
 
ÃedAuth
, boŞ 
u£TLS
, boŞ 
u£SSL
,

32 cÚ¡ 
¡d
::
veùÜ
<
A‰achInfo
>& 
©chedFes
 = std::vector<AttachInfo>());

33 ~
CSmCl›Á
();

35 
boŞ
 
P”fÜm
();

37 
	g´iv©e
:

38 
CSmCl›Á
(cÚ¡ CSmCl›Á& 
rhs
);

39 
	gCSmCl›Á
& 
	gİ”©Ü
=(cÚ¡ 
CSmCl›Á
& 
rhs
);

41 
	g´iv©e
:

42 
size_t
 
CİyMes§geToBuf
(*
cu¾IÁ”ÇlPŒ
, size_ˆ
size
, size_ˆ
nby‹s
, *
u£rD©a
);

44 
boŞ
 
P¬am‘”Check
();

45 
boŞ
 
S‘BasicO±iÚ
(* 
E¼ÜBuf
);

46 
	g¡d
::
¡ršg
 
MakeMes§ge
();

48 
	s¡Cu¾FunU§ge


50 
	g£ndšgCÁ
;

51 
	g¡d
::
¡ršg
 
mes§geBody
;

54 
	g¡d
::
¡ršg
 
m_S’d”
;

55 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
m_Reûiv”s
;

56 
	g¡d
::
¡ršg
 
m_Subjeù
;

57 
	g¡d
::
¡ršg
 
m_Body
;

58 
boŞ
 
	gm_N“dAuth
;

59 
boŞ
 
	gm_U£TLS
;

60 
boŞ
 
	gm_U£SSL
;

61 
	g¡d
::
veùÜ
<
A‰achInfo
> 
m_A‰achedFes
;

	@../curl/unittest/curl_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"cu¾/FCl›Á.h
"

3 
	~"cu¾/SmCl›Á.h
"

4 
	~"debug/Debug.h
"

6 
	~<¡ršg
>

7 
	~<veùÜ
>

9 
	$TEST
(
Cu¾Te¡
, 
FTe¡
)

11 
CFCl›Á
 
	`ápCl›Á
("192.168.1.113", "", "", 21L, "/TitanNVR_Titan_test/TitanNVR", "NUUO.jpg", "./");

12 
	`TRACE
("%s\n", 
ápCl›Á
.
	`FTe¡
()? "Test OK":"Test Fail");

13 
	}
}

15 
	$TEST
(
Cu¾Te¡
, 
Fu¶ßdTe¡
)

17 
CFCl›Á
 
	`ápCl›Á2
("192.168.1.113", "TitanUser", "nuuotesting", 21L, "/TitanNVR_Titan_test/TitanNVR", "logo_nuuo.gif", "/root/titan/rootfs1.3/NUUO/web/imgt/");

18 
	`TRACE
("%s\n", 
ápCl›Á2
.
	`P”fÜm
()? "Test OK":"Test Fail");

19 
	}
}

21 
	$TEST
(
Cu¾Te¡
, 
SmTe¡
)

23 
¡d
::
veùÜ
<¡d::
¡ršg
> 
»ûiv”s
;

24 
»ûiv”s
.
	`push_back
("jenshing@gmail.com");

25 
»ûiv”s
.
	`push_back
("jason_huang@nuuo.com");

26 
»ûiv”s
.
	`push_back
("jenshing@gmail.com");

27 
»ûiv”s
.
	`push_back
("jenshing@gmail.com");

29 
CSmCl›Á
 
	`smCl›Á
("smtp.gmail.com", "jason_huang@nuuo.com", "nuuotesting", 465L, "jason_huang@nuuo.com",

30 
»ûiv”s
, "This is‡estingƒmail from Jason'sitan machine!!",

31 "Iàyou gÙhi mes§ge, you should†—voffiû‡ soÚ‡ possibË!!" 
CRLF


32 "O¸you mighˆg‘ hu¹!!" 
CRLF
 "Hu¼y!!!" CRLF, 
Œue
, 
çl£
,rue);

33 
	`TRACE
("%s\n", 
smCl›Á
.
	`P”fÜm
()? "Test OK":"Test Fail");

34 
	}
}

	@../curl/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../exports.h

1 #iâdeà
__EXPORTS_H__


2 
	#__EXPORTS_H__


	)

4 
	~"visib™y.h
"

6 
	#SYSUTILS_SPACE
 
SysUts


	)

	@../http/http_header_define.h

1 #iâdeà
__HTTP_HEADER_DEFINE_H__


2 
	#__HTTP_HEADER_DEFINE_H__


	)

6 
	#CR
 '\r'

	)

7 
	#LF
 '\n'

	)

8 
	#SP
 ' '

	)

9 
	#HT
 '\t'

	)

10 
	#CRLF
 "\r\n"

	)

14 
	#HTTP_VERSION_PREFIX
 "HTTP"

	)

19 
	#HTTP_METHOD_OPTIONS
 "OPTIONS"

	)

20 
	#HTTP_METHOD_GET
 "GET"

	)

21 
	#HTTP_METHOD_HEAD
 "HEAD"

	)

22 
	#HTTP_METHOD_POST
 "POST"

	)

23 
	#HTTP_METHOD_PUT
 "PUT"

	)

24 
	#HTTP_METHOD_DELETE
 "DELETE"

	)

25 
	#HTTP_METHOD_TRACE
 "TRACE"

	)

26 
	#HTTP_METHOD_CONNECT
 "CONNECT"

	)

33 
	#HTTP_HEADER_FIELD_CACHE_CONTROL
 "Cache-CÚŒŞ"

	)

34 
	#HTTP_HEADER_FIELD_CONNECTION
 "CÚÃùiÚ"

	)

35 
	#HTTP_HEADER_FIELD_DATE
 "D©e"

	)

36 
	#HTTP_HEADER_FIELD_PRAGMA
 "P¿gma"

	)

37 
	#HTTP_HEADER_FIELD_TRAILER
 "T¿”"

	)

38 
	#HTTP_HEADER_FIELD_TRANSFER_ENCODING
 "T¿nsãr-Encodšg"

	)

39 
	#HTTP_HEADER_FIELD_UPGRADE
 "Upg¿de"

	)

40 
	#HTTP_HEADER_FIELD_VIA
 "VŸ"

	)

41 
	#HTTP_HEADER_FIELD_WARNING
 "W¬nšg"

	)

45 
	#HTTP_HEADER_FIELD_ACCEPT
 "Acû±"

	)

46 
	#HTTP_HEADER_FIELD_ACCEPT_CHARSET
 "Acû±-Ch¬£t"

	)

47 
	#HTTP_HEADER_FIELD_ACCEPT_ENCODING
 "Acû±-Encodšg"

	)

48 
	#HTTP_HEADER_FIELD_ACCEPT_LANGUAGE
 "Acû±-Lªguage"

	)

49 
	#HTTP_HEADER_FIELD_AUTHORIZATION
 "AuthÜiz©iÚ"

	)

50 
	#HTTP_HEADER_FIELD_EXPECT
 "Ex³ù"

	)

51 
	#HTTP_HEADER_FIELD_FROM
 "From"

	)

52 
	#HTTP_HEADER_FIELD_HOST
 "Ho¡"

	)

53 
	#HTTP_HEADER_FIELD_IF_MATCH
 "If-M©ch"

	)

54 
	#HTTP_HEADER_FIELD_IF_MODIFIED_SINCE
 "If-Modif›d-Sšû"

	)

55 
	#HTTP_HEADER_FIELD_IF_NONE_MATCH
 "If-NÚe-M©ch"

	)

56 
	#HTTP_HEADER_FIELD_IF_RANGE
 "If-Rªge"

	)

57 
	#HTTP_HEADER_FIELD_IF_UNMODIFIED_SINCE
 "If-Unmodif›d-Sšû"

	)

58 
	#HTTP_HEADER_FIELD_MAX_FORWARDS
 "Max-FÜw¬ds"

	)

59 
	#HTTP_HEADER_FIELD_PROXY_AUTHORIZATION
 "Proxy-AuthÜiz©iÚ"

	)

60 
	#HTTP_HEADER_FIELD_RANGE
 "Rªge"

	)

61 
	#HTTP_HEADER_FIELD_REFERER
 "Reã»r"

	)

62 
	#HTTP_HEADER_FIELD_TE
 "TE"

	)

63 
	#HTTP_HEADER_FIELD_USER_AGENT
 "U£r-Ag’t"

	)

67 
	#HTTP_HEADER_FIELD_ACCEPT_RANGES
 "Acû±-Rªges"

	)

68 
	#HTTP_HEADER_FIELD_AGE
 "Age"

	)

69 
	#HTTP_HEADER_FIELD_ETAG
 "ETag"

	)

70 
	#HTTP_HEADER_FIELD_LOCATION
 "LoÿtiÚ"

	)

71 
	#HTTP_HEADER_FIELD_PROXY_AUTHENTICATE
 "Proxy-Auth’tiÿ‹"

	)

72 
	#HTTP_HEADER_FIELD_RETRY_AFTER
 "R‘ry-Aá”"

	)

73 
	#HTTP_HEADER_FIELD_SERVER
 "S”v”"

	)

74 
	#HTTP_HEADER_FIELD_VARY
 "V¬y"

	)

75 
	#HTTP_HEADER_FIELD_WWW_AUTHENTICATE
 "WWW-Auth’tiÿ‹"

	)

79 
	#HTTP_HEADER_FIELD_ALLOW
 "AÎow"

	)

80 
	#HTTP_HEADER_FIELD_CONTENT_ENCODING
 "CÚ‹Á-Encodšg"

	)

81 
	#HTTP_HEADER_FIELD_CONTENT_LANGUAGE
 "CÚ‹Á-Lªguage"

	)

82 
	#HTTP_HEADER_FIELD_CONTENT_LENGTH
 "CÚ‹Á-L’gth"

	)

83 
	#HTTP_HEADER_FIELD_CONTENT_LOCATION
 "CÚ‹Á-LoÿtiÚ"

	)

84 
	#HTTP_HEADER_FIELD_CONTENT_MD5
 "CÚ‹Á-MD5"

	)

85 
	#HTTP_HEADER_FIELD_CONTENT_RANGE
 "CÚ‹Á-Rªge"

	)

86 
	#HTTP_HEADER_FIELD_CONTENT_TYPE
 "CÚ‹Á-Ty³"

	)

87 
	#HTTP_HEADER_FIELD_EXPIRES
 "Expœes"

	)

88 
	#HTTP_HEADER_FIELD_LAST_MODIFIED
 "La¡-Modif›d"

	)

91 
	#HTTP_HEADER_FIELD_ACCEPT_DATETIME
 "Acû±-D©‘ime"

	)

92 
	#HTTP_HEADER_FIELD_COOKIE
 "Cook›"

	)

93 
	#HTTP_HEADER_FIELD_CONTENT_DISPOSITION
 "CÚ‹Á-Di¥os™iÚ"

	)

94 
	#HTTP_HEADER_FIELD_LINK
 "Lšk"

	)

95 
	#HTTP_HEADER_FIELD_P3P
 "P3P"

	)

96 
	#HTTP_HEADER_FIELD_REFRESH
 "Reäesh"

	)

97 
	#HTTP_HEADER_FIELD_SET_COOKIE
 "S‘-Cook›"

	)

98 
	#HTTP_HEADER_FIELD_STRICT_TRANSPORT_SECURITY
 "SŒiù-T¿n¥Üt-Secur™y"

	)

	@../http/http_parser.cpp

1 
	~"h‰p_·r£r.h
"

3 
	~"h‰p/h‰p_h—d”_defše.h
"

5 
	~<as£¹.h
>

6 
	~<¡ršg.h
>

7 
	~<¡dlib.h
>

8 
	~<ùy³.h
>

13 
	#MAX_BOUNDARY_LENGTH
 70

	)

15 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

17 
DLL_PUBLIC
 
	gH‰pP¬£r
::
S‹
::
	$S‹
()

18 : 
	`»ad_¡©us
(
READING_START_LINE
)

19 , 
	`cÚ‹Á_Ëngth
(0)

20 , 
	`chunked_Œªsãr_’codšg
(
çl£
)

21 , 
	`muÉ¬t
(
çl£
)

22 , 
	$muÉ¬t_bound¬y
()

24 
	}
}

26 
DLL_PUBLIC
 
	gH‰pP¬£r
::
S‹
::~
	$S‹
()

28 
	}
}

30 
DLL_PUBLIC
 
H‰pP¬£r
::
S‹
::
	$Re£t
()

32 
»ad_¡©us
 = 
READING_START_LINE
;

33 
cÚ‹Á_Ëngth
 = 0;

34 
chunked_Œªsãr_’codšg
 = 
çl£
;

35 
muÉ¬t
 = 
çl£
;

36 
muÉ¬t_bound¬y
.
	`ş—r
();

37 
	}
}

39 cÚ¡ 
	g¡d
::
¡ršg
 
H‰pP¬£r
::
D©a
::
s_em±y_¡ršg
;

41 
DLL_PUBLIC
 
	gH‰pP¬£r
::
D©a
::
	$D©a
()

42 : 
	`m_¡¬t_lše
()

43 , 
	`m_h—d”_f›lds
()

44 , 
	`m_body
()

45 , 
	$m_¿w_d©a
()

47 
	}
}

49 
DLL_PUBLIC
 
	gH‰pP¬£r
::
D©a
::~
	$D©a
()

51 
	}
}

53 
DLL_PUBLIC
 cÚ¡ 
¡d
::
¡ršg
 &
H‰pP¬£r
::
D©a
::
	$G‘S¹Lše
() const

55  
m_¡¬t_lše
;

56 
	}
}

58 
boŞ
 
	gH‰pP¬£r
::
D©a
::
Ca£In£ns™iveCom·»
::
	$İ”©Ü
()(cÚ¡ 
¡d
::
¡ršg
 &
a
, cÚ¡ std::¡ršg &
b
) const

60 #ià
	`defšed
(
_WIN32
)

61  
	`_¡ricmp
(
a
.
	`c_¡r
(), 
b
.c_str()) < 0;

62 #–ià
	`defšed
(
__lšux__
)

63  
	`¡rÿ£cmp
(
a
.
	`c_¡r
(), 
b
.c_str()) < 0;

66  
çl£
;

68 
	}
}

70 
DLL_PUBLIC
 
boŞ
 
	gH‰pP¬£r
::
D©a
::
	$HasH—d”F›ld
(cÚ¡ 
¡d
::
¡ršg
 &
f›ld
) const

72  
m_h—d”_f›lds
.
	`fšd
(
f›ld
è!ğm_h—d”_f›lds.
	`’d
();

73 
	}
}

75 
DLL_PUBLIC
 cÚ¡ 
	g¡d
::
¡ršg
 &
H‰pP¬£r
::
D©a
::
	$G‘H—d”V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
f›ld
) const

77 
¡d
::
m­
<¡d::
¡ršg
, std::¡ršg, 
Ca£In£ns™iveCom·»
>::
cÚ¡_™”©Ü
 
™
 = 
m_h—d”_f›lds
.
	`fšd
(
f›ld
);

78 ià(
™
 !ğ
m_h—d”_f›lds
.
	`’d
())

80  
™
->
£cÚd
;

84  
s_em±y_¡ršg
;

86 
	}
}

88 
DLL_PUBLIC
 cÚ¡ 
	g¡d
::
¡ršg
 &
H‰pP¬£r
::
D©a
::
	$G‘Body
() const

90  
m_body
;

91 
	}
}

93 
DLL_PUBLIC
 cÚ¡ 
	g¡d
::
¡ršg
 &
H‰pP¬£r
::
D©a
::
	$G‘RawD©a
() const

95  
m_¿w_d©a
;

96 
	}
}

98 
DLL_PUBLIC
 
	gH‰pP¬£r
::
D©a
::
	$Re£t
()

100 
m_¡¬t_lše
.
	`ş—r
();

101 
m_h—d”_f›lds
.
	`ş—r
();

102 
m_body
.
	`ş—r
();

103 
m_¿w_d©a
.
	`ş—r
();

104 
	}
}

106 
DLL_PUBLIC
 
	gH‰pP¬£r
::
	$H‰pP¬£r
()

107 : 
	`m_¡©e
()

108 , 
	`m_d©a
()

109 , 
	`m_cb
(
NULL
)

110 , 
	`m_¬g1
(
NULL
)

111 , 
	`m_¬g2
(
NULL
)

112 , 
	`m_ÿche_¿w_d©a
(
çl£
)

113 , 
	$m_ÿche_body
(
Œue
)

115 
	}
}

117 
DLL_PUBLIC
 
	gH‰pP¬£r
::~
	$H‰pP¬£r
()

119 
	}
}

121 
DLL_PUBLIC
 
ušt32_t
 
H‰pP¬£r
::
	$CÚsumeBufãr
(
Ev’tBufãr
 &
bufãr
)

123 
Ev’tBufãrLock
 
	`_l
(&
bufãr
);

125 
ušt32_t
 
cÚsume_Ëngth
 = 0;

126 
m_¡©e
.
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_DONE
)

128 
ušt32_t
 
Ëngth
 = 0;

129 
S‹
::
R—dStus
 
»ad_¡©us
 = 
m_¡©e
.read_status;

130 
»ad_¡©us
)

132 
H‰pP¬£r
::
S‹
::
READING_START_LINE
:

134 
Ëngth
 = 
	`CÚsumeS¹Lše
(
bufãr
);

137 
H‰pP¬£r
::
S‹
::
READING_HEADER
:

139 
Ëngth
 = 
	`CÚsumeH—d”
(
bufãr
);

142 
H‰pP¬£r
::
S‹
::
READING_BODY
:

144 
Ëngth
 = 
	`CÚsumeBody
(
bufãr
);

147 
H‰pP¬£r
::
S‹
::
READING_DONE
:

154 
cÚsume_Ëngth
 +ğ
Ëngth
;

157 ià(
Ëngth
 =ğ0 && 
»ad_¡©us
 =ğ
m_¡©e
.read_status)

162  
cÚsume_Ëngth
;

163 
	}
}

165 
DLL_PUBLIC
 cÚ¡ 
	gH‰pP¬£r
::
S‹
 &
H‰pP¬£r
::
	$G‘S‹
() const

167  
m_¡©e
;

168 
	}
}

170 
DLL_PUBLIC
 cÚ¡ 
	gH‰pP¬£r
::
D©a
 &
H‰pP¬£r
::
	$G‘D©a
() const

172  
m_d©a
;

173 
	}
}

175 
DLL_PUBLIC
 
	gH‰pP¬£r
::
	$S‘C®lback
(
C®lback
 
cb
, *
¬g1
, *
¬g2
)

177 
m_cb
 = 
cb
;

178 
m_¬g1
 = 
¬g1
;

179 
m_¬g2
 = 
¬g2
;

180 
	}
}

182 
DLL_PUBLIC
 
	gH‰pP¬£r
::
	$Re£t
()

184 
m_¡©e
.
	`Re£t
();

185 
m_d©a
.
	`Re£t
();

186 
m_ÿche_¿w_d©a
 = 
çl£
;

187 
m_ÿche_body
 = 
Œue
;

188 
	}
}

190 
DLL_PUBLIC
 
	gH‰pP¬£r
::
	$S‘R—dStus
(
S‹
::
R—dStus
 
¡©us
)

192 
m_¡©e
.
»ad_¡©us
 = 
¡©us
;

193 
	}
}

195 
DLL_PUBLIC
 
	gH‰pP¬£r
::
	$EÇbËCacheRawD©a
(
boŞ
 
’abË
)

197 
m_ÿche_¿w_d©a
 = 
’abË
;

198 
	}
}

200 
DLL_PUBLIC
 
	gH‰pP¬£r
::
	$EÇbËCacheBody
(
boŞ
 
’abË
)

202 
m_ÿche_body
 = 
’abË
;

203 
	}
}

205 
ušt32_t
 
	gH‰pP¬£r
::
	$CÚsumeS¹Lše
(
Ev’tBufãr
 &
bufãr
)

207 ià(
m_¡©e
.
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_START_LINE
)

212 
št32_t
 
pos
 = 
bufãr
.
	`Fšd
(
CRLF
, 2);

213 ià(
pos
 < 0)

218 
ušt32_t
 
Ëngth
 = (ušt32_t)(
pos
 + 2);

219 
Ev’tBufãr
 
š‹º®_bufãr
;

220 
št32_t
 
š‹º®_Ëngth
 = 
bufãr
.
	`RemoveBufãr
(&
š‹º®_bufãr
, 
Ëngth
);

221 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
Ëngth
);

222 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
š‹º®_bufãr
.
	`G‘L’gth
());

224 *
mes§ge
 = (*)
š‹º®_bufãr
.
	`PuÎup
();

225 
	`as£¹
(
mes§ge
 !ğ
NULL
);

226 ià(
mes§ge
 =ğ
NULL
 || 
š‹º®_Ëngth
 < 0)

228  
Ëngth
;

230 ià(
m_ÿche_¿w_d©a
)

232 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
mes§ge
, 
š‹º®_Ëngth
);

234 
m_d©a
.
m_¡¬t_lše
.
	`assign
(
mes§ge
, 
pos
);

236 
m_¡©e
.
»ad_¡©us
 = 
H‰pP¬£r
::
S‹
::
READING_HEADER
;

238 ià(
m_cb
 !ğ
NULL
)

240 
	`m_cb
(
CB_START_LINE
, 
m_d©a
.
m_¡¬t_lše
.
	`c_¡r
(), m_d©a.m_¡¬t_lše.
	`Ëngth
(), 
m_¡©e
, m_d©a, 
m_¬g1
, 
m_¬g2
);

243  
Ëngth
;

244 
	}
}

254 
ušt32_t
 
	gH‰pP¬£r
::
	$CÚsumeH—d”
(
Ev’tBufãr
 &
bufãr
)

256 ià(
m_¡©e
.
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_HEADER
)

261 
št32_t
 
pos
 = 
bufãr
.
	`Fšd
(
CRLF
, 2);

262 ià(
pos
 < 0)

267 
ušt32_t
 
Ëngth
 = 0;

269 ià(
pos
 == 0)

271 
Ëngth
 = 2;

273 
boŞ
 
d¿š
 = 
bufãr
.
	`D¿š
(2);

274 ià(
d¿š
 != 0)

276 
	`as£¹
(0);

279 ià(
m_ÿche_¿w_d©a
)

281 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
CRLF
, 2);

286 
pos
 = 
bufãr
.
	`Fšd
(
CRLF
 CRLF, 4);

287 ià(
pos
 < 0)

292 
Ëngth
 = (
ušt32_t
)(
pos
 + 4);

294 
Ev’tBufãr
 
š‹º®_bufãr
;

295 
št32_t
 
š‹º®_Ëngth
 = 
bufãr
.
	`RemoveBufãr
(&
š‹º®_bufãr
, 
Ëngth
);

296 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
Ëngth
);

297 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
š‹º®_bufãr
.
	`G‘L’gth
());

299 *
mes§ge
 = (*)
š‹º®_bufãr
.
	`PuÎup
();

300 
	`as£¹
(
mes§ge
 !ğ
NULL
);

301 ià(
mes§ge
 =ğ
NULL
 || 
š‹º®_Ëngth
 < 0)

303  
Ëngth
;

305 ià(
m_ÿche_¿w_d©a
)

307 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
mes§ge
, 
š‹º®_Ëngth
);

309 *(
mes§ge
 + 
pos
) = '\0';

311 *
f›ld
 = 
mes§ge
;

312 
Œue
)

314 *
v®ue
 = 
	`¡rchr
(
f›ld
, ':');

317 ià(
v®ue
 =ğ
NULL
)

321 *
v®ue
++ = '\0';

324 *
v®ue
 =ğ
SP
 || *v®u=ğ
HT
)

326 
v®ue
++;

330 *
’d
 = 
	`¡r¡r
(
v®ue
, 
CRLF
);

331 
’d
 !ğ
NULL
)

333 ià(*(
’d
 + 2è=ğ
SP
 || *Ónd + 2è=ğ
HT
)

335 
’d
 = 
	`¡r¡r
Ónd + 2, 
CRLF
);

342 ià(
’d
 !ğ
NULL
)

344 *
’d
 = '\0';

348 
¡d
::
m­
<¡d::
¡ršg
, std::¡ršg, 
D©a
::
Ca£In£ns™iveCom·»
>::
™”©Ü
 
™
 = 
m_d©a
.
m_h—d”_f›lds
.
	`fšd
(
f›ld
);

349 ià(
™
 =ğ
m_d©a
.
m_h—d”_f›lds
.
	`’d
())

351 
m_d©a
.
m_h—d”_f›lds
[
f›ld
] = 
v®ue
;

355 
™
->
£cÚd
 += ",";

356 
™
->
£cÚd
 +ğ
v®ue
;

360 ià(
’d
 !ğ
NULL
)

362 
f›ld
 = 
’d
 + 2;

371 
¡d
::
m­
<¡d::
¡ršg
, std::¡ršg, 
D©a
::
Ca£In£ns™iveCom·»
>::
™”©Ü
 
™
;

372 
™
 = 
m_d©a
.
m_h—d”_f›lds
.
	`fšd
(
HTTP_HEADER_FIELD_CONTENT_LENGTH
);

373 ià(
™
 !ğ
m_d©a
.
m_h—d”_f›lds
.
	`’d
())

375 
m_¡©e
.
cÚ‹Á_Ëngth
 = (
ušt32_t
)
	`©oi
(
™
->
£cÚd
.
	`c_¡r
());

379 
™
 = 
m_d©a
.
m_h—d”_f›lds
.
	`fšd
(
HTTP_HEADER_FIELD_TRANSFER_ENCODING
);

380 ià(
™
 !ğ
m_d©a
.
m_h—d”_f›lds
.
	`’d
())

382 
m_¡©e
.
chunked_Œªsãr_’codšg
 = (
	`¡r¡r
(
™
->
£cÚd
.
	`c_¡r
(), "chunked"è!ğ
NULL
);

386 
™
 = 
m_d©a
.
m_h—d”_f›lds
.
	`fšd
(
HTTP_HEADER_FIELD_CONTENT_TYPE
);

387 ià(
™
 !ğ
m_d©a
.
m_h—d”_f›lds
.
	`’d
())

389 
m_¡©e
.
muÉ¬t
 = (
	`¡r¡r
(
™
->
£cÚd
.
	`c_¡r
(), "muÉ¬t/"è!ğ
NULL
);

390 cÚ¡ *
bound¬y
 = 
	`¡r¡r
(
™
->
£cÚd
.
	`c_¡r
(), "boundary=");

391 ià(
bound¬y
 !ğ
NULL
)

394 
bound¬y
 += 9;

395 ià(*
bound¬y
 == '\"')

397 
bound¬y
++;

399 
bound¬y_wÜd
[1 + 
MAX_BOUNDARY_LENGTH
 + 1 + 1] = {0};

400 
	`ssÿnf
(
bound¬y
, "%72s", 
bound¬y_wÜd
);

401 
bound¬y_wÜd_Ëngth
 = 
	`¡¾’
(
bound¬y_wÜd
);

402 
wÜd_Ëngth
 = 0;

403 
wÜd_Ëngth
 = 0;

404 
wÜd_Ëngth
 < 
bound¬y_wÜd_Ëngth
 &&

405 (
	`i§Êum
(
bound¬y_wÜd
[
wÜd_Ëngth
]) != 0 ||

406 
bound¬y_wÜd
[
wÜd_Ëngth
] == '\'' ||

407 
bound¬y_wÜd
[
wÜd_Ëngth
] == '(' ||

408 
bound¬y_wÜd
[
wÜd_Ëngth
] == ')' ||

409 
bound¬y_wÜd
[
wÜd_Ëngth
] == '+' ||

410 
bound¬y_wÜd
[
wÜd_Ëngth
] == '_' ||

411 
bound¬y_wÜd
[
wÜd_Ëngth
] == ',' ||

412 
bound¬y_wÜd
[
wÜd_Ëngth
] == '-' ||

413 
bound¬y_wÜd
[
wÜd_Ëngth
] == '.' ||

414 
bound¬y_wÜd
[
wÜd_Ëngth
] == '/' ||

415 
bound¬y_wÜd
[
wÜd_Ëngth
] == ':' ||

416 
bound¬y_wÜd
[
wÜd_Ëngth
] == '=' ||

417 
bound¬y_wÜd
[
wÜd_Ëngth
] == '?');

418 
wÜd_Ëngth
++)

420 ià(
wÜd_Ëngth
 < 
bound¬y_wÜd_Ëngth
)

422 
bound¬y_wÜd
[
wÜd_Ëngth
] = '\0';

424 
m_¡©e
.
muÉ¬t_bound¬y
 = 
bound¬y_wÜd
;

429 
m_¡©e
.
»ad_¡©us
 = 
H‰pP¬£r
::
S‹
::
READING_BODY
;

431 ià(
m_cb
 !ğ
NULL
)

433 
	`m_cb
(
CB_HEADER
, 
NULL
, 0, 
m_¡©e
, 
m_d©a
, 
m_¬g1
, 
m_¬g2
);

436  
Ëngth
;

437 
	}
}

439 
ušt32_t
 
	gH‰pP¬£r
::
	$CÚsumeBody
(
Ev’tBufãr
 &
bufãr
)

441 ià(
m_¡©e
.
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_BODY
)

446 ià(
m_¡©e
.
chunked_Œªsãr_’codšg
)

448  
	`CÚsumeBodyChunk
(
bufãr
);

450 ià(
m_¡©e
.
muÉ¬t
 && m_¡©e.
muÉ¬t_bound¬y
.
	`Ëngth
() > 0)

452  
	`CÚsumeBodyMuÉ¬t
(
bufãr
);

454 ià(
m_¡©e
.
cÚ‹Á_Ëngth
 <ğ
bufãr
.
	`G‘L’gth
())

456  
	`CÚsumeBodyRaw
(
bufãr
);

460 
	}
}

462 
ušt32_t
 
	gH‰pP¬£r
::
	$CÚsumeBodyChunk
(
Ev’tBufãr
 &
bufãr
)

464 ià(
m_¡©e
.
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_BODY
)

469 ià(!
m_¡©e
.
chunked_Œªsãr_’codšg
)

477 
št32_t
 
pos
 = 
bufãr
.
	`Fšd
(
CRLF
, 2);

478 ià(
pos
 < 0)

482 *
mes§ge
 = (*)
bufãr
.
	`PuÎup
(
pos
);

483 
	`as£¹
(
mes§ge
 !ğ
NULL
);

484 ià(
mes§ge
 =ğ
NULL
)

489 
ušt32_t
 
chunk_size
 = 0;

490 
¡d
::
¡ršg
 
	`chunk_size_¡ršg
(
mes§ge
, 
pos
);

491 
	`ssÿnf
(
chunk_size_¡ršg
.
	`c_¡r
(), "%x", &
chunk_size
);

493 ià(
chunk_size
 == 0)

495 
pos
 = 
bufãr
.
	`Fšd
(
CRLF
 CRLF, 4);

496 ià(
pos
 < 0)

501 
ušt32_t
 
Ëngth
 = (ušt32_t)(
pos
 + 4);

502 ià(
m_ÿche_¿w_d©a
)

504 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
mes§ge
, 
Ëngth
);

506 
boŞ
 
d¿š
 = 
bufãr
.
	`D¿š
(
Ëngth
);

507 ià(
d¿š
 != 0)

509 
	`as£¹
(0);

512 
m_¡©e
.
»ad_¡©us
 = 
H‰pP¬£r
::
S‹
::
READING_DONE
;

514 ià(
m_cb
 !ğ
NULL
)

516 
	`m_cb
(
CB_DONE
, 
NULL
, 0, 
m_¡©e
, 
m_d©a
, 
m_¬g1
, 
m_¬g2
);

519  
Ëngth
;

523 
ušt32_t
 
chunk_Ëngth
 = 
pos
 + 2 + 
chunk_size
 + 2;

524 ià(
chunk_Ëngth
 > 
bufãr
.
	`G‘L’gth
())

528 
ušt32_t
 
Ëngth
 = 
chunk_Ëngth
;

529 
Ev’tBufãr
 
š‹º®_bufãr
;

530 
št32_t
 
š‹º®_Ëngth
 = 
bufãr
.
	`RemoveBufãr
(&
š‹º®_bufãr
, 
Ëngth
);

531 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
Ëngth
);

532 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
š‹º®_bufãr
.
	`G‘L’gth
());

533 ià(
š‹º®_Ëngth
 < 0)

538 *
mes§ge
 = (*)
š‹º®_bufãr
.
	`PuÎup
();

539 
	`as£¹
(
mes§ge
 !ğ
NULL
);

540 ià(
mes§ge
 =ğ
NULL
)

542  
š‹º®_Ëngth
;

544 ià(
m_ÿche_¿w_d©a
)

546 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
mes§ge
, 
š‹º®_Ëngth
);

548 *(
mes§ge
 + 
pos
 + 2 + 
chunk_size
) = '\0';

550 ià(
m_ÿche_body
)

552 
m_d©a
.
m_body
.
	`­³nd
(
mes§ge
 + 
pos
 + 2, 
chunk_size
);

555 ià(
m_cb
 !ğ
NULL
)

557 
	`m_cb
(
CB_ONE_CHUNK
, 
mes§ge
 + 
pos
 + 2, 
chunk_size
, 
m_¡©e
, 
m_d©a
, 
m_¬g1
, 
m_¬g2
);

560  
Ëngth
;

562 
	}
}

564 
ušt32_t
 
	gH‰pP¬£r
::
	$CÚsumeBodyMuÉ¬t
(
Ev’tBufãr
 &
bufãr
)

566 ià(
m_¡©e
.
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_BODY
)

571 ià(!
m_¡©e
.
muÉ¬t
 || m_¡©e.
muÉ¬t_bound¬y
.
	`Ëngth
() == 0)

580 *
begš_d–im™”
 = 
NULL
;

581 
ušt32_t
 
begš_d–im™”_Ëngth
 = 0;

583 
şo£_d–im™”
[2 + 2 + 
MAX_BOUNDARY_LENGTH
 + 2 + 1] = {0};

584 
	`¥rštf
(
şo£_d–im™”
, 
CRLF
 "--%.*s--", 
MAX_BOUNDARY_LENGTH
, 
m_¡©e
.
muÉ¬t_bound¬y
.
	`c_¡r
());

585 
ušt32_t
 
şo£_d–im™”_Ëngth
 = 
	`¡¾’
(
şo£_d–im™”
);

586 
begš_d–im™”
 = 
şo£_d–im™”
 + 2;

587 
begš_d–im™”_Ëngth
 = 
şo£_d–im™”_Ëngth
 - 2;

589 ià(
begš_d–im™”_Ëngth
 > 
bufãr
.
	`G‘L’gth
())

595 *
mes§ge
 = (*)
bufãr
.
	`PuÎup
(
begš_d–im™”_Ëngth
);

596 
	`as£¹
(
mes§ge
 !ğ
NULL
);

597 ià(
mes§ge
 =ğ
NULL
)

601 ià(
	`¡ºcmp
(
mes§ge
, 
begš_d–im™”
, 
begš_d–im™”_Ëngth
) == 0)

603 
boŞ
 
»s
 = 
bufãr
.
	`D¿š
(
begš_d–im™”_Ëngth
);

604 ià(
»s
 =ğ
çl£
)

606 
	`as£¹
(0);

609 ià(
m_ÿche_¿w_d©a
)

611 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
begš_d–im™”
, 
begš_d–im™”_Ëngth
);

613 ià(
m_ÿche_body
)

615 
m_d©a
.
m_body
.
	`­³nd
(
begš_d–im™”
, 
begš_d–im™”_Ëngth
);

618 
m_¡©e
.
»ad_¡©us
 = 
H‰pP¬£r
::
S‹
::
READING_DONE
;

620 ià(
m_cb
 !ğ
NULL
)

622 
	`m_cb
(
CB_DONE
, 
NULL
, 0, 
m_¡©e
, 
m_d©a
, 
m_¬g1
, 
m_¬g2
);

625  
begš_d–im™”_Ëngth
;

628 
d–im™”
[2 + 2 + 
MAX_BOUNDARY_LENGTH
 + 2 + 1] = {0};

629 
	`¥rštf
(
d–im™”
, 
CRLF
 "--%.*s" CRLF, 
MAX_BOUNDARY_LENGTH
, 
m_¡©e
.
muÉ¬t_bound¬y
.
	`c_¡r
());

630 
ušt32_t
 
d–im™”_Ëngth
 = 
	`¡¾’
(
d–im™”
);

631 
begš_d–im™”
 = 
d–im™”
 + 2;

632 
begš_d–im™”_Ëngth
 = 
d–im™”_Ëngth
 - 2;

634 
ušt32_t
 
Ëngth
 = 0;

637 
št32_t
 
pos
 = 
bufãr
.
	`Fšd
(
begš_d–im™”
, 
begš_d–im™”_Ëngth
);

638 ià(
pos
 < 0)

642 ià(
pos
 > 0)

644 
Ëngth
 = 
pos
;

646 *
mes§ge
 = (*)
bufãr
.
	`PuÎup
(
Ëngth
);

647 
	`as£¹
(
mes§ge
 !ğ
NULL
);

648 ià(
mes§ge
 =ğ
NULL
)

652 ià(
m_ÿche_¿w_d©a
)

654 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
mes§ge
, 
Ëngth
);

656 ià(
m_ÿche_body
)

658 
m_d©a
.
m_body
.
	`­³nd
(
mes§ge
, 
Ëngth
);

661 
boŞ
 
»s
 = 
bufãr
.
	`D¿š
(
Ëngth
);

662 ià(
»s
 =ğ
çl£
)

664 
	`as£¹
(0);

668 
pos
 = 
bufãr
.
	`Fšd
(
d–im™”
, 
d–im™”_Ëngth
, delimiter_length);

669 ià(
pos
 < 0)

671 
pos
 = 
bufãr
.
	`Fšd
(
şo£_d–im™”
, 
d–im™”_Ëngth
, 
şo£_d–im™”_Ëngth
);

673 ià(
pos
 < 0)

675  
Ëngth
;

677 
	`as£¹
((
ušt32_t
)
pos
 >ğ
d–im™”_Ëngth
);

679 
Ev’tBufãr
 
š‹º®_bufãr
;

680 
št32_t
 
š‹º®_Ëngth
 = 
bufãr
.
	`RemoveBufãr
(&
š‹º®_bufãr
, (
ušt32_t
)
pos
 + 2);

681 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
pos
 + 2);

682 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
š‹º®_bufãr
.
	`G‘L’gth
());

683 ià(
š‹º®_Ëngth
 < 0)

685  
Ëngth
;

687 
Ëngth
 +ğ(
ušt32_t
)
š‹º®_Ëngth
;

689 
mes§ge
 = (*)
š‹º®_bufãr
.
	`PuÎup
();

690 
	`as£¹
(
mes§ge
 !ğ
NULL
);

691 ià(
mes§ge
 =ğ
NULL
)

693  
Ëngth
;

695 ià(
m_ÿche_¿w_d©a
)

697 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
mes§ge
, 
š‹º®_Ëngth
);

699 ià(
m_ÿche_body
)

701 
m_d©a
.
m_body
.
	`­³nd
(
mes§ge
, 
š‹º®_Ëngth
);

703 *(
mes§ge
 + 
pos
) = '\0';

705 ià(
m_cb
 !ğ
NULL
)

707 
	`m_cb
(
CB_ONE_PART
, 
mes§ge
 + 
begš_d–im™”_Ëngth
, 
pos
 - begš_d–im™”_Ëngth, 
m_¡©e
, 
m_d©a
, 
m_¬g1
, 
m_¬g2
);

710  
Ëngth
;

711 
	}
}

713 
ušt32_t
 
	gH‰pP¬£r
::
	$CÚsumeBodyRaw
(
Ev’tBufãr
 &
bufãr
)

715 ià(
m_¡©e
.
»ad_¡©us
 !ğ
H‰pP¬£r
::
S‹
::
READING_BODY
)

720 ià(
m_¡©e
.
cÚ‹Á_Ëngth
 > 
bufãr
.
	`G‘L’gth
())

725 
Ev’tBufãr
 
š‹º®_bufãr
;

726 
ušt32_t
 
Ëngth
 = 
m_¡©e
.
cÚ‹Á_Ëngth
;

727 
št32_t
 
š‹º®_Ëngth
 = 
bufãr
.
	`RemoveBufãr
(&
š‹º®_bufãr
, 
Ëngth
);

728 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
Ëngth
);

729 
	`as£¹
(
š‹º®_Ëngth
 =ğ(
št32_t
)
š‹º®_bufãr
.
	`G‘L’gth
());

730 ià(
š‹º®_Ëngth
 < 0)

735 
em±y_mes§ge
[] = "";

736 *
mes§ge
 = 
Ëngth
 > 0 ? (*)
š‹º®_bufãr
.
	`PuÎup
(è: 
em±y_mes§ge
;

737 
	`as£¹
(
mes§ge
 !ğ
NULL
);

738 ià(
mes§ge
 =ğ
NULL
)

740  
š‹º®_Ëngth
;

742 ià(
m_ÿche_¿w_d©a
)

744 
m_d©a
.
m_¿w_d©a
.
	`­³nd
(
mes§ge
, 
š‹º®_Ëngth
);

746 ià(
m_ÿche_body
)

748 
m_d©a
.
m_body
.
	`assign
(
mes§ge
, 
š‹º®_Ëngth
);

751 
m_¡©e
.
»ad_¡©us
 = 
H‰pP¬£r
::
S‹
::
READING_DONE
;

753 ià(
m_cb
 !ğ
NULL
)

755 ià(
m_ÿche_body
)

757 
	`m_cb
(
CB_BODY
, 
m_d©a
.
m_body
.
	`c_¡r
(), m_d©a.m_body.
	`Ëngth
(), 
m_¡©e
, m_d©a, 
m_¬g1
, 
m_¬g2
);

761 
¡d
::
¡ršg
 
	`body
(
mes§ge
, 
š‹º®_Ëngth
);

762 
	`m_cb
(
CB_BODY
, 
body
.
	`c_¡r
(), body.
	`Ëngth
(), 
m_¡©e
, 
m_d©a
, 
m_¬g1
, 
m_¬g2
);

764 
	`m_cb
(
CB_DONE
, 
NULL
, 0, 
m_¡©e
, 
m_d©a
, 
m_¬g1
, 
m_¬g2
);

767  
Ëngth
;

768 
	}
}

	@../http/http_parser.h

1 #iâdeà
__HTTP_PARSER_H__


2 
	#__HTTP_PARSER_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~"libev’t/ev’t_bufãr.h
"

10 
	~<¡ršg
>

11 
	~<m­
>

13 #ià
defšed
(
_WIN32
)

15 #´agm¨
w¬nšg
(
di§bË
: 4251)

18 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

20 şas 
	cDLL_PUBLIC
 
	gH‰pP¬£r


22 
	gpublic
:

26 
DLL_PUBLIC
 
S‹


30 
READING_START_LINE
,

31 
	gREADING_HEADER
,

32 
	gREADING_BODY
,

33 
	gREADING_DONE
,

34 } 
	tR—dStus
;

36 
R—dStus
 
	g»ad_¡©us
;

37 
ušt32_t
 
	gcÚ‹Á_Ëngth
;

38 
boŞ
 
	gchunked_Œªsãr_’codšg
;

39 
boŞ
 
	gmuÉ¬t
;

40 
	g¡d
::
¡ršg
 
muÉ¬t_bound¬y
;

42 
S‹
();

43 ~
S‹
();

45 
Re£t
();

51 şas 
	cDLL_PUBLIC
 
	gD©a


53 
ä›nd
 
şass
 
	gH‰pP¬£r
;

55 
	gpublic
:

56 
D©a
();

57 ~
D©a
();

59 cÚ¡ 
	g¡d
::
¡ršg
 &
G‘S¹Lše
() const;

60 
boŞ
 
HasH—d”F›ld
(cÚ¡ 
¡d
::
¡ršg
 &
f›ld
) const;

61 cÚ¡ 
	g¡d
::
¡ršg
 &
G‘H—d”V®ue
(cÚ¡ 
¡d
::¡ršg &
f›ld
) const;

62 cÚ¡ 
	g¡d
::
¡ršg
 &
G‘Body
() const;

63 cÚ¡ 
	g¡d
::
¡ršg
 &
G‘RawD©a
() const;

65 
Re£t
();

67 
	g´iv©e
:

68 
D©a
(cÚ¡ D©¨&
rhs
);

69 
	gD©a
 &
	gİ”©Ü
=(cÚ¡ 
D©a
 &
rhs
);

71 
	g´iv©e
:

72 şas 
	cCa£In£ns™iveCom·»


74 
public
:

75 
boŞ
 
İ”©Ü
()(cÚ¡ 
¡d
::
¡ršg
 &
a
, cÚ¡ 
	g¡d
::¡ršg &
b
) const;

78 
	g´iv©e
:

79 cÚ¡ 
¡d
::
¡ršg
 
s_em±y_¡ršg
;

80 
	g¡d
::
¡ršg
 
m_¡¬t_lše
;

81 
	g¡d
::
m­
<
¡d
::
¡ršg
, std::¡ršg, 
	gCa£In£ns™iveCom·»
> 
	gm_h—d”_f›lds
;

82 
	g¡d
::
¡ršg
 
m_body
;

83 
	g¡d
::
¡ršg
 
m_¿w_d©a
;

91 
	gCB_START_LINE
,

92 
	gCB_HEADER
,

93 
	gCB_BODY
,

94 
	gCB_ONE_CHUNK
,

95 
	gCB_ONE_PART
,

96 
	gCB_DONE
,

97 } 
	tC®lbackStus
;

102 (*
	gC®lback
)(
	tC®lbackStus
 
	t¡©us
, cÚ¡ *
	tmes§ge
, 
	tušt32_t
 
	tËngth
, 
	tS‹
 &
	t¡©e
, 
	tD©a
 &
	td©a
, *
	t¬g1
, *
	t¬g2
);

107 
H‰pP¬£r
();

112 ~
H‰pP¬£r
();

119 
ušt32_t
 
CÚsumeBufãr
(
Ev’tBufãr
 &
bufãr
);

125 cÚ¡ 
	gS‹
 &
G‘S‹
() const;

131 cÚ¡ 
	gD©a
 &
G‘D©a
() const;

139 
S‘C®lback
(
C®lback
 
cb
, *
¬g1
, *
¬g2
);

145 
Re£t
();

153 
S‘R—dStus
(
S‹
::
R—dStus
 
¡©us
);

160 
EÇbËCacheRawD©a
(
boŞ
 
’abË
);

167 
EÇbËCacheBody
(
boŞ
 
’abË
);

169 
	g´iv©e
:

170 
H‰pP¬£r
(cÚ¡ H‰pP¬£¸&
rhs
);

171 
	gH‰pP¬£r
 &
	gİ”©Ü
=(cÚ¡ 
H‰pP¬£r
 &
rhs
);

173 
ušt32_t
 
CÚsumeS¹Lše
(
Ev’tBufãr
 &
bufãr
);

174 
ušt32_t
 
CÚsumeH—d”
(
Ev’tBufãr
 &
bufãr
);

175 
ušt32_t
 
CÚsumeBody
(
Ev’tBufãr
 &
bufãr
);

176 
ušt32_t
 
CÚsumeBodyChunk
(
Ev’tBufãr
 &
bufãr
);

177 
ušt32_t
 
CÚsumeBodyMuÉ¬t
(
Ev’tBufãr
 &
bufãr
);

178 
ušt32_t
 
CÚsumeBodyRaw
(
Ev’tBufãr
 &
bufãr
);

180 
	g´iv©e
:

181 
S‹
 
m_¡©e
;

182 
D©a
 
	gm_d©a
;

183 
C®lback
 
	gm_cb
;

184 *
	gm_¬g1
;

185 *
	gm_¬g2
;

186 
boŞ
 
	gm_ÿche_¿w_d©a
;

187 
boŞ
 
	gm_ÿche_body
;

	@../http/http_status_define.h

1 #iâdeà
__HTTP_STATUS_DEFINE_H__


2 
	#__HTTP_STATUS_DEFINE_H__


	)

9 
	#HTTP_STATUS_DESCRIPTION_100
 "CÚtšue"

	)

10 
	#HTTP_STATUS_DESCRIPTION_101
 "Sw™chšg PrÙocŞs"

	)

11 
	#HTTP_STATUS_DESCRIPTION_102
 "Proûssšg"

	)

14 
	#HTTP_STATUS_DESCRIPTION_200
 "OK"

	)

15 
	#HTTP_STATUS_DESCRIPTION_201
 "C»©ed"

	)

16 
	#HTTP_STATUS_DESCRIPTION_202
 "Acû±ed"

	)

17 
	#HTTP_STATUS_DESCRIPTION_203
 "NÚ-AuthÜ™©ivInfÜm©iÚ"

	)

18 
	#HTTP_STATUS_DESCRIPTION_204
 "NØCÚ‹Á"

	)

19 
	#HTTP_STATUS_DESCRIPTION_205
 "Re£ˆCÚ‹Á"

	)

20 
	#HTTP_STATUS_DESCRIPTION_206
 "P¬tŸÈCÚ‹Á"

	)

21 
	#HTTP_STATUS_DESCRIPTION_207
 "MuÉi-Stus"

	)

22 
	#HTTP_STATUS_DESCRIPTION_208
 "AÌ—dy R•Ü‹d"

	)

23 
	#HTTP_STATUS_DESCRIPTION_226
 "IM U£d"

	)

26 
	#HTTP_STATUS_DESCRIPTION_300
 "MuÉË Choiûs"

	)

27 
	#HTTP_STATUS_DESCRIPTION_301
 "Moved P”mª’y"

	)

28 
	#HTTP_STATUS_DESCRIPTION_302
 "Found"

	)

29 
	#HTTP_STATUS_DESCRIPTION_303
 "S“ Oth”"

	)

30 
	#HTTP_STATUS_DESCRIPTION_304
 "NÙ Modif›d"

	)

31 
	#HTTP_STATUS_DESCRIPTION_305
 "U£ Proxy"

	)

32 
	#HTTP_STATUS_DESCRIPTION_306
 "Sw™ch Proxy"

	)

33 
	#HTTP_STATUS_DESCRIPTION_307
 "TempÜ¬y Redœeù"

	)

36 
	#HTTP_STATUS_DESCRIPTION_400
 "Bad Reque¡"

	)

37 
	#HTTP_STATUS_DESCRIPTION_401
 "UÇuthÜized"

	)

38 
	#HTTP_STATUS_DESCRIPTION_402
 "Paym’ˆRequœed"

	)

39 
	#HTTP_STATUS_DESCRIPTION_403
 "FÜbidd’"

	)

40 
	#HTTP_STATUS_DESCRIPTION_404
 "NÙ Found"

	)

41 
	#HTTP_STATUS_DESCRIPTION_405
 "M‘hod NÙ AÎowed"

	)

42 
	#HTTP_STATUS_DESCRIPTION_406
 "NÙ Acû±abË"

	)

43 
	#HTTP_STATUS_DESCRIPTION_407
 "Proxy Auth’tiÿtiÚ Requœed"

	)

44 
	#HTTP_STATUS_DESCRIPTION_408
 "Reque¡ Timeout"

	)

45 
	#HTTP_STATUS_DESCRIPTION_409
 "CÚæiù"

	)

46 
	#HTTP_STATUS_DESCRIPTION_410
 "GÚe"

	)

47 
	#HTTP_STATUS_DESCRIPTION_411
 "L’gth Requœed"

	)

48 
	#HTTP_STATUS_DESCRIPTION_412
 "P»cÚd™iÚ Faed"

	)

49 
	#HTTP_STATUS_DESCRIPTION_413
 "Reque¡ EÁ™y ToØL¬ge"

	)

50 
	#HTTP_STATUS_DESCRIPTION_414
 "Reque¡-URI ToØLÚg"

	)

51 
	#HTTP_STATUS_DESCRIPTION_415
 "UnsuµÜ‹d MedŸ Ty³"

	)

52 
	#HTTP_STATUS_DESCRIPTION_416
 "Reque¡ed RªgNÙ S©isfŸbË"

	)

53 
	#HTTP_STATUS_DESCRIPTION_417
 "Ex³ù©iÚ Faed"

	)

54 
	#HTTP_STATUS_DESCRIPTION_422
 "UÅroûs§bË EÁ™y"

	)

55 
	#HTTP_STATUS_DESCRIPTION_423
 "Locked"

	)

56 
	#HTTP_STATUS_DESCRIPTION_424
 "Faed D•’d’cy"

	)

57 
	#HTTP_STATUS_DESCRIPTION_425
 "UnÜd”ed CŞËùiÚ"

	)

58 
	#HTTP_STATUS_DESCRIPTION_426
 "Upg¿dRequœed"

	)

59 
	#HTTP_STATUS_DESCRIPTION_428
 "P»cÚd™iÚ Requœed"

	)

60 
	#HTTP_STATUS_DESCRIPTION_429
 "ToØMªy Reque¡s"

	)

61 
	#HTTP_STATUS_DESCRIPTION_431
 "Reque¡ H—d” F›ld ToØL¬ge"

	)

64 
	#HTTP_STATUS_DESCRIPTION_500
 "IÁ”ÇÈS”v” E¼Ü"

	)

65 
	#HTTP_STATUS_DESCRIPTION_501
 "NÙ Im¶em’‹d"

	)

66 
	#HTTP_STATUS_DESCRIPTION_502
 "Bad G©eway"

	)

67 
	#HTTP_STATUS_DESCRIPTION_503
 "S”viû UÇvaabË"

	)

68 
	#HTTP_STATUS_DESCRIPTION_504
 "G©eway Timeout"

	)

69 
	#HTTP_STATUS_DESCRIPTION_505
 "HTTP V”siÚ NÙ SuµÜ‹d"

	)

70 
	#HTTP_STATUS_DESCRIPTION_506
 "V¬ŸÁ AlsØNegÙŸ‹s"

	)

71 
	#HTTP_STATUS_DESCRIPTION_507
 "Insuffic›Á StÜage"

	)

72 
	#HTTP_STATUS_DESCRIPTION_508
 "Loİ D‘eùed"

	)

73 
	#HTTP_STATUS_DESCRIPTION_510
 "NÙ Ex‹nded"

	)

74 
	#HTTP_STATUS_DESCRIPTION_511
 "N‘wÜk Auth’tiÿtiÚ Requœed"

	)

76 
	#HTTP_STATUS_DESCRIPTION_RESERVED
 "Re£rved"

	)

77 
	#HTTP_STATUS_DESCRIPTION_UNDEFINED
 "Undefšed"

	)

78 
	#HTTP_STATUS_DESCRIPTION_UNASSIGNED
 "UÇssigÃd"

	)

79 
	#HTTP_STATUS_DESCRIPTION_UNKNOWN
 "Unknown"

	)

81 
	~"expÜts.h
"

82 
	~"commÚ/¡dšt.h
"

84 
	~<¡ršg
>

86 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

88 
šlše
 cÚ¡ *
g‘_h‰p_¡©us_desütiÚ
(
ušt32_t
 
¡©us
)

90 ià(
	g¡©us
 <ğ99 || 
¡©us
 >= 600)

92  
HTTP_STATUS_DESCRIPTION_UNDEFINED
;

95 ià((
	g¡©us
 >ğ103 && 
¡©us
 <= 199) ||

96 (
¡©us
 >= 209 && status <= 225) ||

97 (
¡©us
 >= 227 && status <= 299) ||

98 (
¡©us
 >= 308 && status <= 399) ||

99 (
¡©us
 >= 418 && status <= 421) ||

100 (
¡©us
 == 427) ||

101 (
¡©us
 == 430) ||

102 (
¡©us
 >= 432 && status <= 499) ||

103 (
¡©us
 == 509) ||

104 (
¡©us
 >= 512 && status <= 599))

106  
HTTP_STATUS_DESCRIPTION_UNASSIGNED
;

109 
	g¡©us
)

111 100:  
HTTP_STATUS_DESCRIPTION_100
;

112 101:  
HTTP_STATUS_DESCRIPTION_101
;

113 102:  
HTTP_STATUS_DESCRIPTION_102
;

114 200:  
HTTP_STATUS_DESCRIPTION_200
;

115 201:  
HTTP_STATUS_DESCRIPTION_201
;

116 202:  
HTTP_STATUS_DESCRIPTION_202
;

117 203:  
HTTP_STATUS_DESCRIPTION_203
;

118 204:  
HTTP_STATUS_DESCRIPTION_204
;

119 205:  
HTTP_STATUS_DESCRIPTION_205
;

120 206:  
HTTP_STATUS_DESCRIPTION_206
;

121 207:  
HTTP_STATUS_DESCRIPTION_207
;

122 208:  
HTTP_STATUS_DESCRIPTION_208
;

123 226:  
HTTP_STATUS_DESCRIPTION_226
;

124 300:  
HTTP_STATUS_DESCRIPTION_300
;

125 301:  
HTTP_STATUS_DESCRIPTION_301
;

126 302:  
HTTP_STATUS_DESCRIPTION_302
;

127 303:  
HTTP_STATUS_DESCRIPTION_303
;

128 304:  
HTTP_STATUS_DESCRIPTION_304
;

129 305:  
HTTP_STATUS_DESCRIPTION_305
;

130 306:  
HTTP_STATUS_DESCRIPTION_306
;

131 307:  
HTTP_STATUS_DESCRIPTION_307
;

132 400:  
HTTP_STATUS_DESCRIPTION_400
;

133 401:  
HTTP_STATUS_DESCRIPTION_401
;

134 402:  
HTTP_STATUS_DESCRIPTION_402
;

135 403:  
HTTP_STATUS_DESCRIPTION_403
;

136 404:  
HTTP_STATUS_DESCRIPTION_404
;

137 405:  
HTTP_STATUS_DESCRIPTION_405
;

138 406:  
HTTP_STATUS_DESCRIPTION_406
;

139 407:  
HTTP_STATUS_DESCRIPTION_407
;

140 408:  
HTTP_STATUS_DESCRIPTION_408
;

141 409:  
HTTP_STATUS_DESCRIPTION_409
;

142 410:  
HTTP_STATUS_DESCRIPTION_410
;

143 411:  
HTTP_STATUS_DESCRIPTION_411
;

144 412:  
HTTP_STATUS_DESCRIPTION_412
;

145 413:  
HTTP_STATUS_DESCRIPTION_413
;

146 414:  
HTTP_STATUS_DESCRIPTION_414
;

147 415:  
HTTP_STATUS_DESCRIPTION_415
;

148 416:  
HTTP_STATUS_DESCRIPTION_416
;

149 417:  
HTTP_STATUS_DESCRIPTION_417
;

150 422:  
HTTP_STATUS_DESCRIPTION_422
;

151 423:  
HTTP_STATUS_DESCRIPTION_423
;

152 424:  
HTTP_STATUS_DESCRIPTION_424
;

153 425:  
HTTP_STATUS_DESCRIPTION_425
;

154 426:  
HTTP_STATUS_DESCRIPTION_426
;

155 428:  
HTTP_STATUS_DESCRIPTION_428
;

156 429:  
HTTP_STATUS_DESCRIPTION_429
;

157 431:  
HTTP_STATUS_DESCRIPTION_431
;

158 500:  
HTTP_STATUS_DESCRIPTION_500
;

159 501:  
HTTP_STATUS_DESCRIPTION_501
;

160 502:  
HTTP_STATUS_DESCRIPTION_502
;

161 503:  
HTTP_STATUS_DESCRIPTION_503
;

162 504:  
HTTP_STATUS_DESCRIPTION_504
;

163 505:  
HTTP_STATUS_DESCRIPTION_505
;

164 506:  
HTTP_STATUS_DESCRIPTION_506
;

165 507:  
HTTP_STATUS_DESCRIPTION_507
;

166 508:  
HTTP_STATUS_DESCRIPTION_508
;

167 510:  
HTTP_STATUS_DESCRIPTION_510
;

168 511:  
HTTP_STATUS_DESCRIPTION_511
;

169 :  
HTTP_STATUS_DESCRIPTION_UNKNOWN
;

173 
šlše
 
	g¡d
::
¡ršg
 
G‘H‰pStusDesütiÚ
(
ušt32_t
 
¡©us
)

175  
g‘_h‰p_¡©us_desütiÚ
(
¡©us
);

	@../http/unittest/http_parser_test.cpp

1 
	~"h‰p/h‰p_·r£r.h
"

3 
	~"­r/­r_ut™y.h
"

5 
	~"commÚ/¡ršg.h
"

7 
	~"g‹¡/g‹¡.h
"

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
	g¡d
::
¡ršg
 
£nd_mes§ge_¿w_em±y
 =

15 
	g¡d
::
¡ršg
 
£nd_mes§ge_¿w_em±y_¡¬t_lše
 =

17 
	g¡d
::
¡ršg
 
£nd_mes§ge_¿w_em±y_body
 =

20 
	$TEST
(
H‰pP¬£rTe¡
, 
Em±yBodyRawTe¡
)

22 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

24 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

26 
¡d
::
¡ršg
 
£nd_mes§ge
 = 
£nd_mes§ge_¿w_em±y
;

27 
¡d
::
¡ršg
 
£nd_body
 = 
£nd_mes§ge_¿w_em±y_body
;

28 
size_t
 
tÙ®_Ëngth
 = 
£nd_mes§ge_¿w_em±y
.
	`Ëngth
();

30 
Ev’tBufãr
 
£nd_bufãr
;

31 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(), s’d_mes§ge.
	`Ëngth
()));

32 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

33 
	`EXPECT_EQ
((
št32_t
)
tÙ®_Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

35 
Ev’tBufãr
 
»cv_bufãr
;

36 
	`EXPECT_EQ
((
št32_t
)
tÙ®_Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

37 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
»cv_bufãr
.
	`G‘L’gth
());

39 
H‰pP¬£r
 
·r£r
;

40 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
));

41 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

42 
	`EXPECT_STREQ
(
£nd_mes§ge_¿w_em±y_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

43 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

44 
	`EXPECT_STREQ
("0", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

45 
	`EXPECT_STREQ
(
£nd_body
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

47 
d–‘e
 
sock‘s
[0];

48 
d–‘e
 
sock‘s
[1];

49 
	}
}

51 *
	gÿÎback_¬g1
 = (*)0x00000001;

52 *
	gÿÎback_¬g2
 = (*)0x00000002;

54 
	g¡d
::
¡ršg
 
£nd_mes§ge_¿w
 =

65 
	g¡d
::
¡ršg
 
£nd_mes§ge_¿w_¡¬t_lše
 =

67 
	g¡d
::
¡ršg
 
£nd_mes§ge_¿w_body
 =

73 
	gÇme¥aû


75 şas 
	cC®lbackMes§geRaw


77 
	gpublic
:

78 
C®lback
(
H‰pP¬£r
::
C®lbackStus
 
¡©us
, cÚ¡ *
mes§ge
, 
ušt32_t
 
Ëngth
, H‰pP¬£r::
S‹
 &
¡©e
, H‰pP¬£r::
D©a
 &
d©a
, *
¬g1
, *
¬g2
)

80 
	gÿÎback_couÁ”
 = 0;

81 
	gÿÎback_couÁ”
)

84 
EXPECT_EQ
(
H‰pP¬£r
::
CB_START_LINE
, 
¡©us
);

85 
EXPECT_STREQ
(
£nd_mes§ge_¿w_¡¬t_lše
.
c_¡r
(), 
mes§ge
);

86 
EXPECT_EQ
(
£nd_mes§ge_¿w_¡¬t_lše
.
Ëngth
(),†ength);

87 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_HEADER
, 
¡©e
.
»ad_¡©us
);

88 
EXPECT_STREQ
(
£nd_mes§ge_¿w_¡¬t_lše
.
c_¡r
(), 
d©a
.
G‘S¹Lše
().c_str());

89 ià(
	g¬g1
 !ğ
NULL
)

91 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

93 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

94 
	gÿÎback_couÁ”
++;

97 
EXPECT_EQ
(
H‰pP¬£r
::
CB_HEADER
, 
¡©us
);

98 
EXPECT_EQ
(
NULL
, 
mes§ge
);

99 
EXPECT_EQ
((
ušt32_t
)0, 
Ëngth
);

100 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

101 
EXPECT_TRUE
(
d©a
.
HasH—d”F›ld
("content-type"));

102 
EXPECT_STREQ
("­¶iÿtiÚ/xml; ch¬£t=utf-8", 
d©a
.
G‘H—d”V®ue
("cÚ‹Á-ty³").
c_¡r
());

103 
EXPECT_TRUE
(
d©a
.
HasH—d”F›ld
("CONTENT-LENGTH"));

104 
EXPECT_STREQ
("177", 
d©a
.
G‘H—d”V®ue
("CONTENT-LENGTH").
c_¡r
());

105 
EXPECT_FALSE
(
d©a
.
HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

106 
EXPECT_STREQ
("", 
d©a
.
G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
c_¡r
());

107 
EXPECT_TRUE
(
d©a
.
HasH—d”F›ld
("NUUO-SessionID"));

108 
EXPECT_STREQ
("0", 
d©a
.
G‘H—d”V®ue
("NUUO-SessiÚID").
c_¡r
());

109 ià(
	g¬g1
 !ğ
NULL
)

111 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

113 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

114 
	gÿÎback_couÁ”
++;

117 
EXPECT_EQ
(
H‰pP¬£r
::
CB_BODY
, 
¡©us
);

118 
EXPECT_STREQ
(
£nd_mes§ge_¿w_body
.
c_¡r
(), 
mes§ge
);

119 
EXPECT_EQ
(
£nd_mes§ge_¿w_body
.
Ëngth
(),†ength);

120 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
¡©e
.
»ad_¡©us
);

121 ià(
	g¬g1
 !ğ
NULL
)

123 
EXPECT_STREQ
(
£nd_mes§ge_¿w_body
.
c_¡r
(), 
d©a
.
G‘Body
().c_str());

124 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

126 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

127 
	gÿÎback_couÁ”
++;

130 
EXPECT_EQ
(
H‰pP¬£r
::
CB_DONE
, 
¡©us
);

131 
EXPECT_EQ
(
NULL
, 
mes§ge
);

132 
EXPECT_EQ
((
ušt32_t
)0, 
Ëngth
);

133 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
¡©e
.
»ad_¡©us
);

134 ià(
	g¬g1
 !ğ
NULL
)

136 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

138 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

139 
	gÿÎback_couÁ”
 = 0;

142 
ASSERT_TRUE
(
çl£
);

148 
	g¡d
::
¡ršg
 
£nd_mes§ge_chunk
 =

167 
	g¡d
::
¡ršg
 
£nd_mes§ge_chunk_¡¬t_lše
 =

169 
	g¡d
::
¡ršg
 
£nd_mes§ge_chunk_¿w
 =

173 
	g¡d
::
¡ršg
 
£nd_mes§ge_chunk_¿w_01
 =

175 
	g¡d
::
¡ršg
 
£nd_mes§ge_chunk_¿w_02
 =

177 
	g¡d
::
¡ršg
 
£nd_mes§ge_chunk_¿w_03
 =

179 
	g¡d
::
¡ršg
 
£nd_mes§ge_chunk_¿w_04
 =

181 
	gÇme¥aû


183 şas 
	cC®lbackMes§geChunk


185 
	gpublic
:

186 
C®lback
(
H‰pP¬£r
::
C®lbackStus
 
¡©us
, cÚ¡ *
mes§ge
, 
ušt32_t
 
Ëngth
, H‰pP¬£r::
S‹
 &
¡©e
, H‰pP¬£r::
D©a
 &
d©a
, *
¬g1
, *
¬g2
)

188 
	gÿÎback_couÁ”
 = 0;

189 
	gÿÎback_couÁ”
)

192 
EXPECT_EQ
(
H‰pP¬£r
::
CB_START_LINE
, 
¡©us
);

193 
EXPECT_STREQ
(
£nd_mes§ge_chunk_¡¬t_lše
.
c_¡r
(), 
mes§ge
);

194 
EXPECT_EQ
(
£nd_mes§ge_chunk_¡¬t_lše
.
Ëngth
(),†ength);

195 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_HEADER
, 
¡©e
.
»ad_¡©us
);

196 
EXPECT_STREQ
(
£nd_mes§ge_chunk_¡¬t_lše
.
c_¡r
(), 
d©a
.
G‘S¹Lše
().c_str());

197 ià(
	g¬g1
 !ğ
NULL
)

199 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

201 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

202 
	gÿÎback_couÁ”
++;

205 
EXPECT_EQ
(
H‰pP¬£r
::
CB_HEADER
, 
¡©us
);

206 
EXPECT_EQ
(
NULL
, 
mes§ge
);

207 
EXPECT_EQ
((
ušt32_t
)0, 
Ëngth
);

208 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

209 
EXPECT_TRUE
(
d©a
.
HasH—d”F›ld
("content-type"));

210 
EXPECT_STREQ
("‹xt/¶aš", 
d©a
.
G‘H—d”V®ue
("cÚ‹Á-ty³").
c_¡r
());

211 
EXPECT_FALSE
(
d©a
.
HasH—d”F›ld
("CONTENT-LENGTH"));

212 
EXPECT_STREQ
("", 
d©a
.
G‘H—d”V®ue
("CONTENT-LENGTH").
c_¡r
());

213 
EXPECT_TRUE
(
d©a
.
HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

214 
EXPECT_STREQ
("chunked", 
d©a
.
G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
c_¡r
());

215 ià(
	g¬g1
 !ğ
NULL
)

217 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

219 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

220 
	gÿÎback_couÁ”
++;

223 
EXPECT_EQ
(
H‰pP¬£r
::
CB_ONE_CHUNK
, 
¡©us
);

224 
EXPECT_STREQ
(
£nd_mes§ge_chunk_¿w_01
.
c_¡r
(), 
mes§ge
);

225 
EXPECT_EQ
(
£nd_mes§ge_chunk_¿w_01
.
Ëngth
(),†ength);

226 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

227 ià(
	g¬g1
 !ğ
NULL
)

229 
EXPECT_NE
(
¡d
::
¡ršg
::
Åos
, 
d©a
.
G‘Body
().
rfšd
(
£nd_mes§ge_chunk_¿w_01
));

230 
EXPECT_EQ
(
d©a
.
G‘Body
().
Ëngth
(è- 
£nd_mes§ge_chunk_¿w_01
.Ëngth(), d©a.G‘Body().
rfšd
(send_message_chunk_raw_01));

231 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

233 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

234 
	gÿÎback_couÁ”
++;

237 
EXPECT_EQ
(
H‰pP¬£r
::
CB_ONE_CHUNK
, 
¡©us
);

238 
EXPECT_STREQ
(
£nd_mes§ge_chunk_¿w_02
.
c_¡r
(), 
mes§ge
);

239 
EXPECT_EQ
(
£nd_mes§ge_chunk_¿w_02
.
Ëngth
(),†ength);

240 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

241 ià(
	g¬g1
 !ğ
NULL
)

243 
EXPECT_NE
(
¡d
::
¡ršg
::
Åos
, 
d©a
.
G‘Body
().
rfšd
(
£nd_mes§ge_chunk_¿w_02
));

244 
EXPECT_EQ
(
d©a
.
G‘Body
().
Ëngth
(è- 
£nd_mes§ge_chunk_¿w_02
.Ëngth(), d©a.G‘Body().
rfšd
(send_message_chunk_raw_02));

245 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

247 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

248 
	gÿÎback_couÁ”
++;

251 
EXPECT_EQ
(
H‰pP¬£r
::
CB_ONE_CHUNK
, 
¡©us
);

252 
EXPECT_STREQ
(
£nd_mes§ge_chunk_¿w_03
.
c_¡r
(), 
mes§ge
);

253 
EXPECT_EQ
(
£nd_mes§ge_chunk_¿w_03
.
Ëngth
(),†ength);

254 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

255 ià(
	g¬g1
 !ğ
NULL
)

257 
EXPECT_NE
(
¡d
::
¡ršg
::
Åos
, 
d©a
.
G‘Body
().
rfšd
(
£nd_mes§ge_chunk_¿w_03
));

258 
EXPECT_EQ
(
d©a
.
G‘Body
().
Ëngth
(è- 
£nd_mes§ge_chunk_¿w_03
.Ëngth(), d©a.G‘Body().
rfšd
(send_message_chunk_raw_03));

259 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

261 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

262 
	gÿÎback_couÁ”
++;

265 
EXPECT_EQ
(
H‰pP¬£r
::
CB_ONE_CHUNK
, 
¡©us
);

266 
EXPECT_STREQ
(
£nd_mes§ge_chunk_¿w_04
.
c_¡r
(), 
mes§ge
);

267 
EXPECT_EQ
(
£nd_mes§ge_chunk_¿w_04
.
Ëngth
(),†ength);

268 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

269 ià(
	g¬g1
 !ğ
NULL
)

271 
EXPECT_NE
(
¡d
::
¡ršg
::
Åos
, 
d©a
.
G‘Body
().
rfšd
(
£nd_mes§ge_chunk_¿w_04
));

272 
EXPECT_EQ
(
d©a
.
G‘Body
().
Ëngth
(è- 
£nd_mes§ge_chunk_¿w_04
.Ëngth(), d©a.G‘Body().
rfšd
(send_message_chunk_raw_04));

273 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

275 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

276 
	gÿÎback_couÁ”
++;

279 
EXPECT_EQ
(
H‰pP¬£r
::
CB_DONE
, 
¡©us
);

280 
EXPECT_EQ
(
NULL
, 
mes§ge
);

281 
EXPECT_EQ
((
ušt32_t
)0, 
Ëngth
);

282 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
¡©e
.
»ad_¡©us
);

283 ià(
	g¬g1
 !ğ
NULL
)

285 
EXPECT_STREQ
(
£nd_mes§ge_chunk_¿w
.
c_¡r
(), 
d©a
.
G‘Body
().c_str());

286 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

288 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

289 
	gÿÎback_couÁ”
 = 0;

292 
ASSERT_TRUE
(
çl£
);

298 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t
 =

338 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t_¡¬t_lše
 =

340 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t_body
 =

377 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t_01
 =

387 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t_01_body
 =

394 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t_02
 =

409 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t_02_body
 =

421 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t_03
 =

427 
	g¡d
::
¡ršg
 
£nd_mes§ge_muÉ¬t_03_body
 =

430 
	gÇme¥aû


432 şas 
	cC®lbackMes§geMuÉ¬t


434 
	gpublic
:

435 
C®lback
(
H‰pP¬£r
::
C®lbackStus
 
¡©us
, cÚ¡ *
mes§ge
, 
ušt32_t
 
Ëngth
, H‰pP¬£r::
S‹
 &
¡©e
, H‰pP¬£r::
D©a
 &
d©a
, *
¬g1
, *
¬g2
)

437 
	gÿÎback_couÁ”
 = 0;

438 
Ev’tBufãr
 
	gbufãr
;

439 
H‰pP¬£r
 
	g·r£r
;

440 
	gÿÎback_couÁ”
)

443 
EXPECT_EQ
(
H‰pP¬£r
::
CB_START_LINE
, 
¡©us
);

444 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_¡¬t_lše
.
c_¡r
(), 
mes§ge
);

445 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_¡¬t_lše
.
Ëngth
(),†ength);

446 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_HEADER
, 
¡©e
.
»ad_¡©us
);

447 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_¡¬t_lše
.
c_¡r
(), 
d©a
.
G‘S¹Lše
().c_str());

448 ià(
	g¬g1
 !ğ
NULL
)

450 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

452 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

453 
	gÿÎback_couÁ”
++;

456 
EXPECT_EQ
(
H‰pP¬£r
::
CB_HEADER
, 
¡©us
);

457 
EXPECT_EQ
(
NULL
, 
mes§ge
);

458 
EXPECT_EQ
((
ušt32_t
)0, 
Ëngth
);

459 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

460 
EXPECT_TRUE
(
d©a
.
HasH—d”F›ld
("content-type"));

461 
EXPECT_STREQ
("muÉ¬t/x-mixed-»¶aû;bound¬y=mybound¬y;ty³=\"‹xt/xml\"", 
d©a
.
G‘H—d”V®ue
("cÚ‹Á-ty³").
c_¡r
());

462 
EXPECT_FALSE
(
d©a
.
HasH—d”F›ld
("CONTENT-LENGTH"));

463 
EXPECT_STREQ
("", 
d©a
.
G‘H—d”V®ue
("CONTENT-LENGTH").
c_¡r
());

464 
EXPECT_FALSE
(
d©a
.
HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

465 
EXPECT_STREQ
("", 
d©a
.
G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
c_¡r
());

466 ià(
	g¬g1
 !ğ
NULL
)

468 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

470 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

471 
	gÿÎback_couÁ”
++;

474 
EXPECT_EQ
(
H‰pP¬£r
::
CB_ONE_PART
, 
¡©us
);

475 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_01
.
c_¡r
(), 
mes§ge
);

476 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_01
.
Ëngth
(),†ength);

477 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

478 ià(
	g¬g1
 !ğ
NULL
)

480 
EXPECT_NE
(
¡d
::
¡ršg
::
Åos
, 
d©a
.
G‘Body
().
rfšd
(
£nd_mes§ge_muÉ¬t_01
));

481 
EXPECT_EQ
(
d©a
.
G‘Body
().
Ëngth
(è- 
£nd_mes§ge_muÉ¬t_01
.Ëngth(è- 2, d©a.G‘Body().
rfšd
(send_message_multipart_01));

482 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

486 
EXPECT_STREQ
("", 
d©a
.
G‘Body
().
c_¡r
());

488 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

489 
	gÿÎback_couÁ”
++;

491 
	g·r£r
.
S‘R—dStus
(
H‰pP¬£r
::
S‹
::
READING_HEADER
);

492 
EXPECT_TRUE
(
bufãr
.
Aµ’d
(
£nd_mes§ge_muÉ¬t_01
.
c_¡r
(), s’d_mes§ge_muÉ¬t_01.
Ëngth
()));

493 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_01
.
Ëngth
(), 
bufãr
.
G‘L’gth
());

494 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_01
.
Ëngth
(), 
·r£r
.
CÚsumeBufãr
(
bufãr
));

495 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
G‘S‹
().
»ad_¡©us
);

496 
EXPECT_STREQ
("", 
·r£r
.
G‘D©a
().
G‘S¹Lše
().
c_¡r
());

497 
EXPECT_TRUE
(
·r£r
.
G‘D©a
().
HasH—d”F›ld
("Content-Type"));

498 
EXPECT_STREQ
("‹xt/xml", 
·r£r
.
G‘D©a
().
G‘H—d”V®ue
("CÚ‹Á-Ty³").
c_¡r
());

499 
EXPECT_TRUE
(
·r£r
.
G‘D©a
().
HasH—d”F›ld
("Content-Length"));

500 
EXPECT_STREQ
("172", 
·r£r
.
G‘D©a
().
G‘H—d”V®ue
("CÚ‹Á-L’gth").
c_¡r
());

501 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_01_body
.
c_¡r
(), 
·r£r
.
G‘D©a
().
G‘Body
().c_str());

502 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_01_body
.
Ëngth
(), 
·r£r
.
G‘D©a
().
G‘Body
().length());

505 
EXPECT_EQ
(
H‰pP¬£r
::
CB_ONE_PART
, 
¡©us
);

506 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_02
.
c_¡r
(), 
mes§ge
);

507 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_02
.
Ëngth
(),†ength);

508 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

509 ià(
	g¬g1
 !ğ
NULL
)

511 
EXPECT_NE
(
¡d
::
¡ršg
::
Åos
, 
d©a
.
G‘Body
().
rfšd
(
£nd_mes§ge_muÉ¬t_02
));

512 
EXPECT_EQ
(
d©a
.
G‘Body
().
Ëngth
(è- 
£nd_mes§ge_muÉ¬t_02
.Ëngth(è- 2, d©a.G‘Body().
rfšd
(send_message_multipart_02));

513 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

517 
EXPECT_STREQ
("", 
d©a
.
G‘Body
().
c_¡r
());

519 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

520 
	gÿÎback_couÁ”
++;

522 
	g·r£r
.
S‘R—dStus
(
H‰pP¬£r
::
S‹
::
READING_HEADER
);

523 
EXPECT_TRUE
(
bufãr
.
Aµ’d
(
£nd_mes§ge_muÉ¬t_02
.
c_¡r
(), s’d_mes§ge_muÉ¬t_02.
Ëngth
()));

524 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_02
.
Ëngth
(), 
bufãr
.
G‘L’gth
());

525 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_02
.
Ëngth
(), 
·r£r
.
CÚsumeBufãr
(
bufãr
));

526 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
G‘S‹
().
»ad_¡©us
);

527 
EXPECT_STREQ
("", 
·r£r
.
G‘D©a
().
G‘S¹Lše
().
c_¡r
());

528 
EXPECT_TRUE
(
·r£r
.
G‘D©a
().
HasH—d”F›ld
("Content-Type"));

529 
EXPECT_STREQ
("‹xt/xml", 
·r£r
.
G‘D©a
().
G‘H—d”V®ue
("CÚ‹Á-Ty³").
c_¡r
());

530 
EXPECT_TRUE
(
·r£r
.
G‘D©a
().
HasH—d”F›ld
("Content-Length"));

531 
EXPECT_STREQ
("296", 
·r£r
.
G‘D©a
().
G‘H—d”V®ue
("CÚ‹Á-L’gth").
c_¡r
());

532 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_02_body
.
c_¡r
(), 
·r£r
.
G‘D©a
().
G‘Body
().c_str());

533 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_02_body
.
Ëngth
(), 
·r£r
.
G‘D©a
().
G‘Body
().length());

536 
EXPECT_EQ
(
H‰pP¬£r
::
CB_ONE_PART
, 
¡©us
);

537 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_03
.
c_¡r
(), 
mes§ge
);

538 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_03
.
Ëngth
(),†ength);

539 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
¡©e
.
»ad_¡©us
);

540 ià(
	g¬g1
 !ğ
NULL
)

542 
EXPECT_NE
(
¡d
::
¡ršg
::
Åos
, 
d©a
.
G‘Body
().
rfšd
(
£nd_mes§ge_muÉ¬t_03
));

543 
EXPECT_EQ
(
d©a
.
G‘Body
().
Ëngth
(è- 
£nd_mes§ge_muÉ¬t_03
.Ëngth(è- 2, d©a.G‘Body().
rfšd
(send_message_multipart_03));

544 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

548 
EXPECT_STREQ
("", 
d©a
.
G‘Body
().
c_¡r
());

550 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

551 
	gÿÎback_couÁ”
++;

553 
	g·r£r
.
S‘R—dStus
(
H‰pP¬£r
::
S‹
::
READING_HEADER
);

554 
EXPECT_TRUE
(
bufãr
.
Aµ’d
(
£nd_mes§ge_muÉ¬t_03
.
c_¡r
(), s’d_mes§ge_muÉ¬t_03.
Ëngth
()));

555 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_03
.
Ëngth
(), 
bufãr
.
G‘L’gth
());

556 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_03
.
Ëngth
(), 
·r£r
.
CÚsumeBufãr
(
bufãr
));

557 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
G‘S‹
().
»ad_¡©us
);

558 
EXPECT_STREQ
("", 
·r£r
.
G‘D©a
().
G‘S¹Lše
().
c_¡r
());

559 
EXPECT_TRUE
(
·r£r
.
G‘D©a
().
HasH—d”F›ld
("Content-Type"));

560 
EXPECT_STREQ
("‹xt/xml", 
·r£r
.
G‘D©a
().
G‘H—d”V®ue
("CÚ‹Á-Ty³").
c_¡r
());

561 
EXPECT_TRUE
(
·r£r
.
G‘D©a
().
HasH—d”F›ld
("Content-Length"));

562 
EXPECT_STREQ
("67", 
·r£r
.
G‘D©a
().
G‘H—d”V®ue
("CÚ‹Á-L’gth").
c_¡r
());

563 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_03_body
.
c_¡r
(), 
·r£r
.
G‘D©a
().
G‘Body
().c_str());

564 
EXPECT_EQ
(
£nd_mes§ge_muÉ¬t_03_body
.
Ëngth
(), 
·r£r
.
G‘D©a
().
G‘Body
().length());

568 
EXPECT_EQ
(
H‰pP¬£r
::
CB_DONE
, 
¡©us
);

569 
EXPECT_EQ
(
NULL
, 
mes§ge
);

570 
EXPECT_EQ
((
ušt32_t
)0, 
Ëngth
);

571 
EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
¡©e
.
»ad_¡©us
);

572 ià(
	g¬g1
 !ğ
NULL
)

574 
EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_body
.
c_¡r
(), 
d©a
.
G‘Body
().c_str());

575 
EXPECT_EQ
(
ÿÎback_¬g1
, 
¬g1
);

577 
EXPECT_EQ
(
ÿÎback_¬g2
, 
¬g2
);

578 
	gÿÎback_couÁ”
 = 0;

581 
ASSERT_TRUE
(
çl£
);

587 
	$TEST
(
H‰pP¬£rTe¡
, 
BodyRawTe¡
)

589 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

591 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

593 
¡d
::
¡ršg
 
£nd_mes§ge
 = 
£nd_mes§ge_¿w
;

594 
¡d
::
¡ršg
 
£nd_body
 = 
£nd_mes§ge_¿w_body
;

595 
size_t
 
tÙ®_Ëngth
 = 
£nd_mes§ge_¿w
.
	`Ëngth
();

597 
Ev’tBufãr
 
£nd_bufãr
;

598 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(), s’d_mes§ge.
	`Ëngth
()));

599 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

600 
	`EXPECT_EQ
((
št32_t
)
tÙ®_Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

602 
Ev’tBufãr
 
»cv_bufãr
;

603 
	`EXPECT_EQ
((
št32_t
)
tÙ®_Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

604 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
»cv_bufãr
.
	`G‘L’gth
());

606 
H‰pP¬£r
 
·r£r
;

607 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
));

608 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

609 
	`EXPECT_STREQ
(
£nd_mes§ge_¿w_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

610 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

611 
	`EXPECT_STREQ
("­¶iÿtiÚ/xml; ch¬£t=utf-8", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

612 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

613 
	`EXPECT_STREQ
("177", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

614 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

615 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

616 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("NUUO-SessionID"));

617 
	`EXPECT_STREQ
("0", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-SessiÚID").
	`c_¡r
());

618 
	`EXPECT_STREQ
(
£nd_body
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

620 
d–‘e
 
sock‘s
[0];

621 
d–‘e
 
sock‘s
[1];

622 
	}
}

624 
	$TEST
(
H‰pP¬£rTe¡
, 
S•¬©eBodyRawTe¡
)

626 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

628 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

630 
¡d
::
¡ršg
 
£nd_mes§ge
 = 
£nd_mes§ge_¿w
;

631 
¡d
::
¡ršg
 
£nd_body
 = 
£nd_mes§ge_¿w_body
;

632 
size_t
 
tÙ®_Ëngth
 = 
£nd_mes§ge_¿w
.
	`Ëngth
();

633 
size_t
 
off£t
 = 0;

634 
size_t
 
Ëngth
 = 0;

635 
size_t
 
cÚsume_Ëngth
 = 0;

637 
Ev’tBufãr
 
£nd_bufãr
;

638 
Ev’tBufãr
 
»cv_bufãr
;

639 
H‰pP¬£r
 
·r£r
;

641 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_START_LINE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

643 
off£t
 = 0;

644 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
() / 4;

645 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

646 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

647 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

648 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

649 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

650 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_HEADER
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

652 
off£t
 +ğ
Ëngth
;

653 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
() / 4;

654 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

655 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

656 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

657 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

658 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

659 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

661 
off£t
 +ğ
Ëngth
;

662 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
() / 4;

663 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

664 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

665 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

666 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

667 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

668 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

670 
off£t
 +ğ
Ëngth
;

671 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
(è- 
off£t
;

672 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

673 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

674 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

675 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

676 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

677 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

679 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

680 
	`EXPECT_STREQ
(
£nd_mes§ge_¿w_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

681 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

682 
	`EXPECT_STREQ
("­¶iÿtiÚ/xml; ch¬£t=utf-8", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

683 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

684 
	`EXPECT_STREQ
("177", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

685 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

686 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

687 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("NUUO-SessionID"));

688 
	`EXPECT_STREQ
("0", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-SessiÚID").
	`c_¡r
());

689 
	`EXPECT_STREQ
(
£nd_body
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

691 
d–‘e
 
sock‘s
[0];

692 
d–‘e
 
sock‘s
[1];

693 
	}
}

695 
	$TEST
(
H‰pP¬£rTe¡
, 
BodyChunkTe¡
)

697 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

699 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

701 
¡d
::
¡ršg
 
£nd_mes§ge
 = 
£nd_mes§ge_chunk
;

702 
¡d
::
¡ršg
 
mes§ge
 = 
£nd_mes§ge_chunk_¿w
;

703 
size_t
 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

705 
Ev’tBufãr
 
£nd_bufãr
;

706 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(), s’d_mes§ge.
	`Ëngth
()));

707 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

708 
	`EXPECT_EQ
((
št32_t
)
tÙ®_Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

710 
Ev’tBufãr
 
»cv_bufãr
;

711 
	`EXPECT_EQ
((
št32_t
)
tÙ®_Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

712 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
»cv_bufãr
.
	`G‘L’gth
());

714 
H‰pP¬£r
 
·r£r
;

715 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
));

716 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

717 
	`EXPECT_STREQ
(
£nd_mes§ge_chunk_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

718 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

719 
	`EXPECT_STREQ
("‹xt/¶aš", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

720 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

721 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

722 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

723 
	`EXPECT_STREQ
("chunked", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

724 
	`EXPECT_STREQ
(
mes§ge
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

726 
d–‘e
 
sock‘s
[0];

727 
d–‘e
 
sock‘s
[1];

728 
	}
}

730 
	$TEST
(
H‰pP¬£rTe¡
, 
S•¬©eBodyChunkTe¡
)

732 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

734 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

736 
¡d
::
¡ršg
 
£nd_mes§ge
 = 
£nd_mes§ge_chunk
;

737 
¡d
::
¡ršg
 
mes§ge
 = 
£nd_mes§ge_chunk_¿w
;

738 
size_t
 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

739 
size_t
 
off£t
 = 0;

740 
size_t
 
Ëngth
 = 0;

741 
size_t
 
cÚsume_Ëngth
 = 0;

743 
Ev’tBufãr
 
£nd_bufãr
;

744 
Ev’tBufãr
 
»cv_bufãr
;

745 
H‰pP¬£r
 
·r£r
;

747 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_START_LINE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

749 
off£t
 = 0;

750 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
() / 2;

751 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

752 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

753 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

754 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

755 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

756 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

758 
off£t
 +ğ
Ëngth
;

759 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
(è- 
off£t
;

760 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

761 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

762 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

763 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

764 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

765 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

767 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

768 
	`EXPECT_STREQ
(
£nd_mes§ge_chunk_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

769 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

770 
	`EXPECT_STREQ
("‹xt/¶aš", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

771 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

772 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

773 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

774 
	`EXPECT_STREQ
("chunked", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

775 
	`EXPECT_STREQ
(
mes§ge
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

777 
d–‘e
 
sock‘s
[0];

778 
d–‘e
 
sock‘s
[1];

779 
	}
}

781 
	$TEST
(
H‰pP¬£rTe¡
, 
BodyMuÉ¬tTe¡
)

783 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

785 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

787 
¡d
::
¡ršg
 
£nd_mes§ge
 = 
£nd_mes§ge_muÉ¬t
;

788 
size_t
 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

790 
Ev’tBufãr
 
£nd_bufãr
;

791 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(), s’d_mes§ge.
	`Ëngth
()));

792 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

793 
	`EXPECT_EQ
((
št32_t
)
tÙ®_Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

795 
Ev’tBufãr
 
»cv_bufãr
;

796 
	`EXPECT_EQ
((
št32_t
)
tÙ®_Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

797 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
»cv_bufãr
.
	`G‘L’gth
());

799 
H‰pP¬£r
 
·r£r
;

800 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
));

801 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

802 
	`EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

803 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

804 
	`EXPECT_STREQ
("muÉ¬t/x-mixed-»¶aû;bound¬y=mybound¬y;ty³=\"‹xt/xml\"", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

805 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

806 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

807 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

808 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

810 
d–‘e
 
sock‘s
[0];

811 
d–‘e
 
sock‘s
[1];

812 
	}
}

814 
	$TEST
(
H‰pP¬£rTe¡
, 
S•¬©eBodyMuÉ¬tTe¡
)

816 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

818 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

820 
¡d
::
¡ršg
 
£nd_mes§ge
 = 
£nd_mes§ge_muÉ¬t
;

821 
size_t
 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

822 
size_t
 
off£t
 = 0;

823 
size_t
 
Ëngth
 = 0;

824 
size_t
 
cÚsume_Ëngth
 = 0;

826 
Ev’tBufãr
 
£nd_bufãr
;

827 
Ev’tBufãr
 
»cv_bufãr
;

828 
H‰pP¬£r
 
·r£r
;

830 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_START_LINE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

832 
off£t
 = 0;

833 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
() / 3;

834 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

835 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

836 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

837 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

838 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

839 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

841 
off£t
 +ğ
Ëngth
;

842 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
() / 3;

843 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

844 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

845 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

846 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

847 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

848 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_BODY
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

850 
off£t
 +ğ
Ëngth
;

851 
Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
(è- 
off£t
;

852 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
off£t
, 
Ëngth
));

853 
	`EXPECT_EQ
(
Ëngth
, 
£nd_bufãr
.
	`G‘L’gth
());

854 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

855 
	`EXPECT_EQ
((
št32_t
)
Ëngth
, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

856 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

857 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

859 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

861 
	`EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

862 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

863 
	`EXPECT_STREQ
("muÉ¬t/x-mixed-»¶aû;bound¬y=mybound¬y;ty³=\"‹xt/xml\"", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

864 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

865 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

866 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

867 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

868 
	`EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_body
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

870 
d–‘e
 
sock‘s
[0];

871 
d–‘e
 
sock‘s
[1];

872 
	}
}

874 
	$TEST
(
H‰pP¬£rTe¡
, 
OÃBy‹Te¡
)

876 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

878 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

880 
¡d
::
¡ršg
 
£nd_mes§ge
;

881 
size_t
 
tÙ®_Ëngth
 = 0;

882 
size_t
 
cÚsume_Ëngth
 = 0;

884 
Ev’tBufãr
 
£nd_bufãr
;

885 
Ev’tBufãr
 
»cv_bufãr
;

886 
H‰pP¬£r
 
·r£r
;

889 
¡d
::
¡ršg
 
£nd_body
 = 
£nd_mes§ge_¿w_body
;

890 
£nd_mes§ge
 = 
£nd_mes§ge_¿w
;

891 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

892 
cÚsume_Ëngth
 = 0;

893 
·r£r
.
	`Re£t
();

894 
·r£r
.
	`S‘C®lback
(
C®lbackMes§geRaw
::
C®lback
, 
ÿÎback_¬g1
, 
ÿÎback_¬g2
);

895 
size_t
 
i
 = 0; i < 
tÙ®_Ëngth
; i++)

897 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
i
, 1));

898 
	`EXPECT_EQ
((
ušt32_t
)1, 
£nd_bufãr
.
	`G‘L’gth
());

899 
	`EXPECT_EQ
(1, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

900 
	`EXPECT_EQ
(1, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

901 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

903 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

904 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

905 
	`EXPECT_STREQ
(
£nd_mes§ge_¿w_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

906 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

907 
	`EXPECT_STREQ
("­¶iÿtiÚ/xml; ch¬£t=utf-8", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

908 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

909 
	`EXPECT_STREQ
("177", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

910 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

911 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

912 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("NUUO-SessionID"));

913 
	`EXPECT_STREQ
("0", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-SessiÚID").
	`c_¡r
());

914 
	`EXPECT_STREQ
(
£nd_body
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

915 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘RawD©a
().
	`c_¡r
());

918 
¡d
::
¡ršg
 
mes§ge
 = 
£nd_mes§ge_chunk_¿w
;

919 
£nd_mes§ge
 = 
£nd_mes§ge_chunk
;

920 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

921 
cÚsume_Ëngth
 = 0;

922 
·r£r
.
	`Re£t
();

923 
·r£r
.
	`S‘C®lback
(
C®lbackMes§geChunk
::
C®lback
, 
ÿÎback_¬g1
, 
ÿÎback_¬g2
);

924 
size_t
 
i
 = 0; i < 
tÙ®_Ëngth
; i++)

926 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
i
, 1));

927 
	`EXPECT_EQ
((
ušt32_t
)1, 
£nd_bufãr
.
	`G‘L’gth
());

928 
	`EXPECT_EQ
(1, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

929 
	`EXPECT_EQ
(1, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

930 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

932 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

933 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

934 
	`EXPECT_STREQ
(
£nd_mes§ge_chunk_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

935 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

936 
	`EXPECT_STREQ
("‹xt/¶aš", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

937 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

938 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

939 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

940 
	`EXPECT_STREQ
("chunked", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

941 
	`EXPECT_STREQ
(
mes§ge
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

942 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘RawD©a
().
	`c_¡r
());

945 
£nd_mes§ge
 = 
£nd_mes§ge_muÉ¬t
;

946 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

947 
cÚsume_Ëngth
 = 0;

948 
·r£r
.
	`Re£t
();

949 
·r£r
.
	`S‘C®lback
(
C®lbackMes§geMuÉ¬t
::
C®lback
, 
ÿÎback_¬g1
, 
ÿÎback_¬g2
);

950 
size_t
 
i
 = 0; i < 
tÙ®_Ëngth
; i++)

952 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
i
, 1));

953 
	`EXPECT_EQ
((
ušt32_t
)1, 
£nd_bufãr
.
	`G‘L’gth
());

954 
	`EXPECT_EQ
(1, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

955 
	`EXPECT_EQ
(1, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

956 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

958 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

959 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

960 
	`EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

961 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

962 
	`EXPECT_STREQ
("muÉ¬t/x-mixed-»¶aû;bound¬y=mybound¬y;ty³=\"‹xt/xml\"", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

963 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

964 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

965 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

966 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

967 
	`EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_body
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘Body
().c_str());

968 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘RawD©a
().
	`c_¡r
());

970 
d–‘e
 
sock‘s
[0];

971 
d–‘e
 
sock‘s
[1];

972 
	}
}

974 
	$TEST
(
H‰pP¬£rTe¡
, 
OÃBy‹CacheTe¡
)

976 
A´TıSock‘
 *
sock‘s
[2] = {
NULL
, NULL};

978 
	`EXPECT_TRUE
(
	`C»©eTıSock‘Paœ
(
sock‘s
));

980 
¡d
::
¡ršg
 
£nd_mes§ge
;

981 
size_t
 
tÙ®_Ëngth
 = 0;

982 
size_t
 
cÚsume_Ëngth
 = 0;

984 
Ev’tBufãr
 
£nd_bufãr
;

985 
Ev’tBufãr
 
»cv_bufãr
;

986 
H‰pP¬£r
 
·r£r
;

989 
¡d
::
¡ršg
 
£nd_body
 = 
£nd_mes§ge_¿w_body
;

990 
£nd_mes§ge
 = 
£nd_mes§ge_¿w
;

991 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

992 
cÚsume_Ëngth
 = 0;

993 
·r£r
.
	`Re£t
();

994 
·r£r
.
	`EÇbËCacheRawD©a
(
Œue
);

995 
·r£r
.
	`EÇbËCacheBody
(
çl£
);

996 
·r£r
.
	`S‘C®lback
(
C®lbackMes§geRaw
::
C®lback
, 
NULL
, 
ÿÎback_¬g2
);

997 
size_t
 
i
 = 0; i < 
tÙ®_Ëngth
; i++)

999 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
i
, 1));

1000 
	`EXPECT_EQ
((
ušt32_t
)1, 
£nd_bufãr
.
	`G‘L’gth
());

1001 
	`EXPECT_EQ
(1, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

1002 
	`EXPECT_EQ
(1, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

1003 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

1005 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

1006 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

1007 
	`EXPECT_STREQ
(
£nd_mes§ge_¿w_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

1008 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

1009 
	`EXPECT_STREQ
("­¶iÿtiÚ/xml; ch¬£t=utf-8", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

1010 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

1011 
	`EXPECT_STREQ
("177", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

1012 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

1013 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

1014 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("NUUO-SessionID"));

1015 
	`EXPECT_STREQ
("0", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("NUUO-SessiÚID").
	`c_¡r
());

1016 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘Body
().
	`c_¡r
());

1017 
	`EXPECT_STREQ
(
£nd_mes§ge_¿w
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘RawD©a
().c_str());

1020 
¡d
::
¡ršg
 
mes§ge
 = 
£nd_mes§ge_chunk_¿w
;

1021 
£nd_mes§ge
 = 
£nd_mes§ge_chunk
;

1022 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

1023 
cÚsume_Ëngth
 = 0;

1024 
·r£r
.
	`Re£t
();

1025 
·r£r
.
	`EÇbËCacheRawD©a
(
Œue
);

1026 
·r£r
.
	`EÇbËCacheBody
(
çl£
);

1027 
·r£r
.
	`S‘C®lback
(
C®lbackMes§geChunk
::
C®lback
, 
NULL
, 
ÿÎback_¬g2
);

1028 
size_t
 
i
 = 0; i < 
tÙ®_Ëngth
; i++)

1030 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
i
, 1));

1031 
	`EXPECT_EQ
((
ušt32_t
)1, 
£nd_bufãr
.
	`G‘L’gth
());

1032 
	`EXPECT_EQ
(1, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

1033 
	`EXPECT_EQ
(1, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

1034 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

1036 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

1037 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

1038 
	`EXPECT_STREQ
(
£nd_mes§ge_chunk_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

1039 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

1040 
	`EXPECT_STREQ
("‹xt/¶aš", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

1041 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

1042 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

1043 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

1044 
	`EXPECT_STREQ
("chunked", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

1045 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘Body
().
	`c_¡r
());

1046 
	`EXPECT_STREQ
(
£nd_mes§ge_chunk
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘RawD©a
().c_str());

1049 
£nd_mes§ge
 = 
£nd_mes§ge_muÉ¬t
;

1050 
tÙ®_Ëngth
 = 
£nd_mes§ge
.
	`Ëngth
();

1051 
cÚsume_Ëngth
 = 0;

1052 
·r£r
.
	`Re£t
();

1053 
·r£r
.
	`EÇbËCacheRawD©a
(
Œue
);

1054 
·r£r
.
	`EÇbËCacheBody
(
çl£
);

1055 
·r£r
.
	`S‘C®lback
(
C®lbackMes§geMuÉ¬t
::
C®lback
, 
NULL
, 
ÿÎback_¬g2
);

1056 
size_t
 
i
 = 0; i < 
tÙ®_Ëngth
; i++)

1058 
	`EXPECT_TRUE
(
£nd_bufãr
.
	`Aµ’d
(
£nd_mes§ge
.
	`c_¡r
(è+ 
i
, 1));

1059 
	`EXPECT_EQ
((
ušt32_t
)1, 
£nd_bufãr
.
	`G‘L’gth
());

1060 
	`EXPECT_EQ
(1, 
£nd_bufãr
.
	`Wr™eSock‘
(
sock‘s
[0]));

1061 
	`EXPECT_EQ
(1, 
»cv_bufãr
.
	`R—dSock‘
(
sock‘s
[1]));

1062 
cÚsume_Ëngth
 +ğ
·r£r
.
	`CÚsumeBufãr
(
»cv_bufãr
);

1064 
	`EXPECT_EQ
(
tÙ®_Ëngth
, 
cÚsume_Ëngth
);

1065 
	`EXPECT_EQ
(
H‰pP¬£r
::
S‹
::
READING_DONE
, 
·r£r
.
	`G‘S‹
().
»ad_¡©us
);

1066 
	`EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t_¡¬t_lše
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘S¹Lše
().c_str());

1067 
	`EXPECT_TRUE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("content-type"));

1068 
	`EXPECT_STREQ
("muÉ¬t/x-mixed-»¶aû;bound¬y=mybound¬y;ty³=\"‹xt/xml\"", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("cÚ‹Á-ty³").
	`c_¡r
());

1069 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("CONTENT-LENGTH"));

1070 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("CONTENT-LENGTH").
	`c_¡r
());

1071 
	`EXPECT_FALSE
(
·r£r
.
	`G‘D©a
().
	`HasH—d”F›ld
("TrAnSfEr-EnCoDiNg"));

1072 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘H—d”V®ue
("TrAnSfEr-EnCoDiNg").
	`c_¡r
());

1073 
	`EXPECT_STREQ
("", 
·r£r
.
	`G‘D©a
().
	`G‘Body
().
	`c_¡r
());

1074 
	`EXPECT_STREQ
(
£nd_mes§ge_muÉ¬t
.
	`c_¡r
(), 
·r£r
.
	`G‘D©a
().
	`G‘RawD©a
().c_str());

1076 
d–‘e
 
sock‘s
[0];

1077 
d–‘e
 
sock‘s
[1];

1078 
	}
}

	@../http/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../libevent/apr_event.cpp

1 
	~<as£¹.h
>

2 
	~"libev’t/­r_ev’t.h
"

3 
	~"commÚ/ut™y.h
"

4 
	~"libev’t/ev’t_ut™y.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
DLL_PUBLIC
 
	gA´Ev’t
::
	$A´Ev’t
(
Ev’tBa£
 *
ba£
, 
A´Sock‘
 *
sock‘
, 
wh©
, 
­r_ev’t_ÿÎback_â
 
cb
, *
¬g1
, *
¬g2
)

9 : 
	`Ev’t
(
ba£
, 
	`G‘Ev’tSock‘
(
sock‘
), 
wh©
, 
NULL
, NULL, NULL)

10 , 
	`m_sock‘
(
sock‘
)

11 , 
	`m_cb
(
cb
)

12 , 
	`m_¬g1
(
¬g1
)

13 , 
	$m_¬g2
(
¬g2
)

15 
	}
}

17 
DLL_PUBLIC
 
	gA´Ev’t
::~
	$A´Ev’t
()

19 
m_sock‘
 = 
NULL
;

20 
	}
}

22 
DLL_PUBLIC
 
A´Sock‘
 *
	gA´Ev’t
::
	$sock‘
()

24  
m_sock‘
;

25 
	}
}

27 
DLL_PUBLIC
 
	gA´Ev’t
::
	$C®lback
(
evut_sock‘_t
 
fd
, 
wh©
)

29 
	`IF_NULL_RETURN
(
m_sock‘
);

30 
	`IF_NOT_EQUAL_RETURN
(
fd
, 
	`G‘Ev’tSock‘
(
m_sock‘
));

31 
	`IF_NULL_RETURN
(
m_cb
);

33 
	`m_cb
(
this
, 
m_sock‘
, 
wh©
, 
m_¬g1
, 
m_¬g2
);

34 
	}
}

	@../libevent/apr_event.h

1 #iâdeà
__LIBEVENT_APR_EVENT_H__


2 
	#__LIBEVENT_APR_EVENT_H__


	)

4 
	~"expÜts.h
"

5 
	~"ev’t2/ev’t.h
"

6 
	~"libev’t/ev’t_ba£.h
"

7 
	~"libev’t/ev’t.h
"

8 
	~"­r/­r_sock‘.h
"

10 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

13 
şass
 
	gA´Ev’t
;

23 (*
	g­r_ev’t_ÿÎback_â
)(
	tA´Ev’t
 *
	te
, 
	tA´Sock‘
 *
	tsock‘
, 
	twh©
, *
	t¬g1
, *
	t¬g2
);

28 şas 
	cDLL_PUBLIC
 
	gA´Ev’t
: 
public
 
Ev’t
 {

29 
public
:

46 
A´Ev’t
(
Ev’tBa£
 *
ba£
, 
A´Sock‘
 *
sock‘
, 
wh©
, 
­r_ev’t_ÿÎback_â
 
cb
, *
¬g1
, *
¬g2
);

51 
	gvœtu®
 ~
A´Ev’t
();

57 
A´Sock‘
 *
sock‘
();

59 
	g´iv©e
:

60 
A´Ev’t
();

61 
vœtu®
 
C®lback
(
evut_sock‘_t
 
fd
, 
wh©
);

63 
	g´iv©e
:

64 
A´Sock‘
 *
m_sock‘
;

65 
­r_ev’t_ÿÎback_â
 
	gm_cb
;

66 *
	gm_¬g1
;

67 *
	gm_¬g2
;

	@../libevent/event.cpp

1 
	~<as£¹.h
>

2 
	~"libev’t/ev’t.h
"

3 
	~"commÚ/ut™y.h
"

5 #ifdeà
__lšux__


6 
	~<sys/time.h
>

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
	gEv’t
::
	$Ev’t
(
Ev’tBa£
 *
ba£
, 
evut_sock‘_t
 
fd
, 
wh©
, 
g’”ic_ev’t_ÿÎback_â
 
cb
, *
¬g1
, *
¬g2
)

12 : 
	`m_ba£
(
ba£
)

13 , 
	`m_ev’t
(
NULL
)

14 , 
	`m_fd
(
fd
)

15 , 
	`m_wh©
(
wh©
)

16 , 
	`m_cb
(
cb
)

17 , 
	`m_¬g1
(
¬g1
)

18 , 
	$m_¬g2
(
¬g2
)

20 
	`IF_NULL_RETURN
(
ba£
);

22 
m_ev’t
 = 
	`ev’t_Ãw
(
ba£
->
	`guts
(), 
m_fd
, 
wh©
, 
Ev’t
::
s_ÿÎback
, 
this
);

23 
	}
}

25 
	gEv’t
::~
	$Ev’t
()

27 
	`as£¹
(
m_ba£
);

28 
	`as£¹
(
m_ev’t
);

30 ià(
m_ev’t
 !ğ
NULL
)

32 
	`ev’t_ä“
(
m_ev’t
);

33 
m_ev’t
 = 
NULL
;

35 
	}
}

37 
	gEv’t
::
	$s_ÿÎback
(
evut_sock‘_t
 
fd
, 
wh©
, *
¬g
)

39 
Ev’t
 *
e
 = (Ev’ˆ*)
¬g
;

40 
	`IF_NULL_RETURN
(
e
);

41 
	`IF_EQUAL_RETURN
(
wh©
 & (
e
->
m_wh©
 | 
EV_TIMEOUT
), 0x0);

43 
e
->
	`C®lback
(
fd
, 
wh©
);

44 
	}
}

46 
	gEv’t
::
	$C®lback
(
evut_sock‘_t
 
fd
, 
wh©
)

48 
	`IF_NULL_RETURN
(
m_cb
);

49 
	`as£¹
(
m_fd
 =ğ
fd
);

51 
	`m_cb
(
this
, 
fd
, 
wh©
, 
m_¬g1
, 
m_¬g2
);

52 
	}
}

54 
Ev’tBa£
 *
	gEv’t
::
	$ba£
()

56  
m_ba£
;

57 
	}
}

59 
ev’t
 *
	gEv’t
::
	$guts
()

61  
m_ev’t
;

62 
	}
}

64 
boŞ
 
	gEv’t
::
	$Add
(
ms
 )

66 
	`IF_NULL_RETURN_VALUE
(
m_ev’t
, 
çl£
);

68 
»s
 = -1;

69 ià(
ms
 < 0)

71 
»s
 = 
	`ev’t_add
(
m_ev’t
, 
NULL
);

75 
timev®
 
tv
 = {
ms
 / 1000, (ms % 1000) * 1000};

76 
»s
 = 
	`ev’t_add
(
m_ev’t
, &
tv
);

79  (
»s
 == 0);

80 
	}
}

82 
boŞ
 
	gEv’t
::
	$D–
()

84 
	`IF_NULL_RETURN_VALUE
(
m_ev’t
, 
çl£
);

86 
»s
 = 
	`ev’t_d–
(
m_ev’t
);

88  (
»s
 == 0);

89 
	}
}

91 
boŞ
 
	gEv’t
::
	$S‘PriÜ™y
(
´iÜ™y
)

93 
	`IF_NULL_RETURN_VALUE
(
m_ev’t
, 
çl£
);

95 
»s
 = 
	`ev’t_´iÜ™y_£t
(
m_ev’t
, 
´iÜ™y
);

97  (
»s
 == 0);

98 
	}
}

100 
boŞ
 
	gEv’t
::
	$P’dšg
(*
ms
 )

102 
timev®
 
tv
 = {0, 0};

103 
»s
 = 
	`ev’t_³ndšg
(
m_ev’t
, 
m_wh©
 | 
EV_TIMEOUT
, &
tv
);

104 ià(
ms
 !ğ
NULL
)

106 ià((
»s
 & 
EV_TIMEOUT
) != 0x0)

108 *
ms
 = 
tv
.
tv_£c
 * 1000 +v.
tv_u£c
 / 1000;

112 *
ms
 = -1;

116  ((
»s
 & 
m_wh©
) != 0x0);

117 
	}
}

	@../libevent/event.h

1 #iâdeà
__LIBEVENT_EVENT_H__


2 
	#__LIBEVENT_EVENT_H__


	)

4 
	~"expÜts.h
"

5 
	~"ev’t2/ev’t.h
"

6 
	~"libev’t/ev’t_ba£.h
"

7 
	~"libev’t/ev’t_objeù.h
"

9 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

12 
şass
 
	gEv’t
;

22 (*
	gg’”ic_ev’t_ÿÎback_â
)(
	tEv’t
 *
	te
, 
	tevut_sock‘_t
 
	tfd
, 
	twh©
, *
	t¬g1
, *
	t¬g2
);

27 şas 
	cDLL_PUBLIC
 
	gEv’t
: 
public
 
Ev’tObjeù
 {

28 
public
:

44 
Ev’t
(
Ev’tBa£
 *
ba£
, 
evut_sock‘_t
 
fd
, 
wh©
, 
g’”ic_ev’t_ÿÎback_â
 
cb
, *
¬g1
, *
¬g2
);

49 
	gvœtu®
 ~
Ev’t
();

55 
Ev’tBa£
 *
ba£
();

61 
ev’t
 *
guts
();

68 
boŞ
 
Add
(
ms
=-1);

74 
boŞ
 
D–
();

82 
boŞ
 
S‘PriÜ™y
(
´iÜ™y
);

89 
boŞ
 
P’dšg
(*
ms
=
NULL
);

91 
	g´iv©e
:

92 
Ev’t
();

93 
s_ÿÎback
(
evut_sock‘_t
 
fd
, 
wh©
, *
¬g
);

94 
vœtu®
 
C®lback
(
evut_sock‘_t
 
fd
, 
wh©
);

96 
	g´iv©e
:

97 
Ev’tBa£
 *
m_ba£
;

98 
ev’t
 *
	gm_ev’t
;

99 
evut_sock‘_t
 
	gm_fd
;

100 
	gm_wh©
;

101 
g’”ic_ev’t_ÿÎback_â
 
	gm_cb
;

102 *
	gm_¬g1
;

103 *
	gm_¬g2
;

	@../libevent/event_base.cpp

1 
	~<as£¹.h
>

2 
	~"libev’t/ev’t_ba£.h
"

3 
	~"commÚ/ut™y.h
"

4 
	~"libev’t/ev’t_tim”.h
"

6 #ifdeà
__lšux__


7 
	~<sys/time.h
>

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 
DLL_PUBLIC
 
	gEv’tBa£
::
	$Ev’tBa£
(
ms
 )

13 : 
	`m_ba£
(
NULL
)

14 , 
	`m_tim”
(
NULL
)

15 , 
	$m_timeout
(
ms
)

17 
m_ba£
 = 
	`ev’t_ba£_Ãw
();

21 ià(
ms
 > 0)

23 
m_tim”
 = 
Ãw
 
	`Ev’tTim”
(
this
, 
Œue
, 
NULL
, NULL, NULL);

25 
	}
}

27 
DLL_PUBLIC
 
	gEv’tBa£
::~
	$Ev’tBa£
()

29 
	`as£¹
(
m_ba£
 !ğ
NULL
);

31 ià(
m_tim”
 !ğ
NULL
)

33 
d–‘e
 
m_tim”
;

36 ià(
m_ba£
 !ğ
NULL
)

38 
	`ev’t_ba£_ä“
(
m_ba£
);

40 
	}
}

42 
DLL_PUBLIC
 
ev’t_ba£
 *
	gEv’tBa£
::
	$guts
()

44  
m_ba£
;

45 
	}
}

47 
DLL_PUBLIC
 
boŞ
 
	gEv’tBa£
::
	$Loİ
(
æags
)

49 
	`as£¹
(
m_ba£
 !ğ
NULL
);

50 
	`IF_NULL_RETURN_VALUE
(
m_ba£
, 
çl£
);

52 ià(
m_tim”
 !ğ
NULL
)

54 
	`IF_FALSE_RETURN_VALUE
(
m_tim”
->
	`Add
(
m_timeout
 > 0 ? m_timeouˆ: 1), 
çl£
);

57 
»s
 = 
	`ev’t_ba£_loİ
(
m_ba£
, 
æags
);

59  (
»s
 == 0);

60 
	}
}

62 
DLL_PUBLIC
 
boŞ
 
	gEv’tBa£
::
	$Di¥©ch
()

64 
	`as£¹
(
m_ba£
 !ğ
NULL
);

65 
	`IF_NULL_RETURN_VALUE
(
m_ba£
, 
çl£
);

67 ià(
m_tim”
 !ğ
NULL
)

69 
	`IF_FALSE_RETURN_VALUE
(
m_tim”
->
	`Add
(
m_timeout
 > 0 ? m_timeouˆ: 1), 
çl£
);

72 
»s
 = 
	`ev’t_ba£_di¥©ch
(
m_ba£
);

74  (
»s
 == 0);

75 
	}
}

77 
DLL_PUBLIC
 
boŞ
 
	gEv’tBa£
::
	$LoİEx™
(
ms
 )

79 
	`as£¹
(
m_ba£
 !ğ
NULL
);

80 
	`IF_NULL_RETURN_VALUE
(
m_ba£
, 
çl£
);

82 
»s
 = -1;

83 ià(
ms
 < 0)

85 
»s
 = 
	`ev’t_ba£_loİex™
(
m_ba£
, 
NULL
);

89 
timev®
 
tv
 = {
ms
 / 1000, (ms % 1000) * 1000};

90 
»s
 = 
	`ev’t_ba£_loİex™
(
m_ba£
, &
tv
);

93  (
»s
 == 0);

94 
	}
}

96 
DLL_PUBLIC
 
boŞ
 
	gEv’tBa£
::
	$LoİB»ak
()

98 
	`as£¹
(
m_ba£
 !ğ
NULL
);

99 
	`IF_NULL_RETURN_VALUE
(
m_ba£
, 
çl£
);

101 
»s
 = 
	`ev’t_ba£_loİb»ak
(
m_ba£
);

103  (
»s
 == 0);

104 
	}
}

106 
DLL_PUBLIC
 
boŞ
 
	gEv’tBa£
::
	$GÙEx™
()

108 
	`as£¹
(
m_ba£
 !ğ
NULL
);

109 
	`IF_NULL_RETURN_VALUE
(
m_ba£
, 
çl£
);

111 
»s
 = 
	`ev’t_ba£_gÙ_ex™
(
m_ba£
);

113  (
»s
 != 0);

114 
	}
}

116 
DLL_PUBLIC
 
boŞ
 
	gEv’tBa£
::
	$GÙB»ak
()

118 
	`as£¹
(
m_ba£
 !ğ
NULL
);

119 
	`IF_NULL_RETURN_VALUE
(
m_ba£
, 
çl£
);

121 
»s
 = 
	`ev’t_ba£_gÙ_b»ak
(
m_ba£
);

123  (
»s
 != 0);

124 
	}
}

126 
DLL_PUBLIC
 
boŞ
 
	gEv’tBa£
::
	$In™PriÜ™y
(
´iÜ™›s
)

128 
	`as£¹
(
m_ba£
 !ğ
NULL
);

129 
	`IF_NULL_RETURN_VALUE
(
m_ba£
, 
çl£
);

131 
»s
 = 
	`ev’t_ba£_´iÜ™y_š™
(
m_ba£
, 
´iÜ™›s
);

133  (
»s
 == 0);

134 
	}
}

136 
DLL_PUBLIC
 
boŞ
 
	gEv’tBa£
::
	$Reš™
()

138 
	`as£¹
(
m_ba£
 !ğ
NULL
);

139 
	`IF_NULL_RETURN_VALUE
(
m_ba£
, 
çl£
);

141 
»s
 = 
	`ev’t_»š™
(
m_ba£
);

143  (
»s
 == 0);

144 
	}
}

	@../libevent/event_base.h

1 #iâdeà
__LIBEVENT_EVENT_BASE_H__


2 
	#__LIBEVENT_EVENT_BASE_H__


	)

4 
	~"expÜts.h
"

5 
	~"ev’t2/ev’t.h
"

6 
	~"libev’t/ev’t_objeù.h
"

8 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

10 
şass
 
	gEv’tTim”
;

15 şas 
	cDLL_PUBLIC
 
	gEv’tBa£
: 
public
 
Ev’tObjeù
 {

16 
public
:

21 
Ev’tBa£
(
ms
=0);

26 
	gvœtu®
 ~
Ev’tBa£
();

32 
ev’t_ba£
 *
guts
();

42 
boŞ
 
Loİ
(
æags
);

49 
boŞ
 
Di¥©ch
();

60 
boŞ
 
LoİEx™
(
ms
=-1);

67 
boŞ
 
LoİB»ak
();

73 
boŞ
 
GÙEx™
();

79 
boŞ
 
GÙB»ak
();

86 
boŞ
 
In™PriÜ™y
(
´iÜ™›s
);

93 
boŞ
 
Reš™
();

95 
	g´iv©e
:

96 
ev’t_ba£
 *
m_ba£
;

97 
Ev’tTim”
 *
	gm_tim”
;

98 
	gm_timeout
;

	@../libevent/event_buffer.cpp

1 
	~<as£¹.h
>

2 
	~<memÜy.h
>

3 
	~"libev’t/ev’t_bufãr.h
"

4 
	~"commÚ/ut™y.h
"

5 
	~"libev’t/ev’t_ut™y.h
"

7 
	~<”ºo.h
>

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

14 
DLL_PUBLIC
 
	gEv’tBufãr
::
	$Ev’tBufãr
()

15 : 
	`m_bufãr
(
	$evbufãr_Ãw
())

17 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

18 
	`evbufãr_’abË_lockšg
(
m_bufãr
, 
NULL
);

19 
	}
}

21 
DLL_PUBLIC
 
	gEv’tBufãr
::~
	$Ev’tBufãr
()

23 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

24 ià(
m_bufãr
 !ğ
NULL
)

26 
	`evbufãr_ä“
(
m_bufãr
);

28 
	}
}

30 
DLL_PUBLIC
 
evbufãr
 *
	gEv’tBufãr
::
	$guts
()

32  
m_bufãr
;

33 
	}
}

35 
DLL_PUBLIC
 
	gEv’tBufãr
::
	$Lock
()

37 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

38 
	`IF_NULL_RETURN
(
m_bufãr
);

40 
	`evbufãr_lock
(
m_bufãr
);

43 
	}
}

45 
DLL_PUBLIC
 
	gEv’tBufãr
::
	$UÆock
()

47 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

48 
	`IF_NULL_RETURN
(
m_bufãr
);

50 
	`evbufãr_uÆock
(
m_bufãr
);

53 
	}
}

55 
DLL_PUBLIC
 
ušt32_t
 
	gEv’tBufãr
::
	$G‘L’gth
()

57 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

58 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, 0);

60  
	`evbufãr_g‘_Ëngth
(
m_bufãr
);

61 
	}
}

63 
DLL_PUBLIC
 
boŞ
 
	gEv’tBufãr
::
	$Ex·nd
(
ušt32_t
 
Ën
)

65 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

66 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, 
çl£
);

68 
»s
 = 
	`evbufãr_ex·nd
(
m_bufãr
, 
Ën
);

70  (
»s
 == 0);

71 
	}
}

73 
DLL_PUBLIC
 
boŞ
 
	gEv’tBufãr
::
	$Aµ’d
(cÚ¡ *
d©a
, 
ušt32_t
 
Ën
)

75 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

76 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, 
çl£
);

78 
»s
 = 
	`evbufãr_add
(
m_bufãr
, 
d©a
, 
Ën
);

80  (
»s
 == 0);

81 
	}
}

83 
DLL_PUBLIC
 
boŞ
 
	gEv’tBufãr
::
	$Aµ’dReã»nû
(cÚ¡ *
d©a
, 
ušt32_t
 
Ën
, 
evbufãr_»f_ş—nup_cb
 
ş—nupâ
, *
ş—nupâ_¬g
)

85 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

86 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, 
çl£
);

88 
»s
 = 
	`evbufãr_add_»ã»nû
(
m_bufãr
, 
d©a
, 
Ën
, 
ş—nupâ
, 
ş—nupâ_¬g
);

90  (
»s
 == 0);

91 
	}
}

93 
DLL_PUBLIC
 
ušt8_t
 *
	gEv’tBufãr
::
	$PuÎup
(
št32_t
 
size
 )

95 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

96 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, 
NULL
);

98  
	`evbufãr_puÎup
(
m_bufãr
, 
size
);

99 
	}
}

101 
DLL_PUBLIC
 
boŞ
 
	gEv’tBufãr
::
	$D¿š
(
ušt32_t
 
Ën
)

103 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

104 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, 
çl£
);

106 
»s
 = 
	`evbufãr_d¿š
(
m_bufãr
, 
Ën
);

108  (
»s
 == 0);

109 
	}
}

111 
DLL_PUBLIC
 
boŞ
 
	gEv’tBufãr
::
	$CË¬
()

113 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

114 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, 
çl£
);

116 
»s
 = 
	`evbufãr_d¿š
(
m_bufãr
, 
	`evbufãr_g‘_Ëngth
(m_buffer));

118  (
»s
 == 0);

119 
	}
}

121 
DLL_PUBLIC
 
št32_t
 
	gEv’tBufãr
::
	$Remove
(*
d©a
, 
ušt32_t
 
Ën
)

123 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

124 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, -1);

125 
	`IF_NULL_RETURN_VALUE
(
d©a
, -1);

127  
	`evbufãr_»move
(
m_bufãr
, 
d©a
, 
Ën
);

128 
	}
}

130 
DLL_PUBLIC
 
št32_t
 
	gEv’tBufãr
::
	$RemoveBufãr
(
Ev’tBufãr
 *
d¡
, 
ušt32_t
 
Ën
)

132 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

133 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, -1);

134 
	`IF_NULL_RETURN_VALUE
(
d¡
, -1);

136  
	`evbufãr_»move_bufãr
(
m_bufãr
, 
d¡
->
	`guts
(), 
Ën
);

137 
	}
}

139 
DLL_PUBLIC
 
boŞ
 
	gEv’tBufãr
::
	$MoveBufãr
(
Ev’tBufãr
 *
¤c
, Ev’tBufã¸*
d¡
)

141 
	`IF_NULL_RETURN_VALUE
(
¤c
, 
çl£
);

142 
	`IF_NULL_RETURN_VALUE
(
d¡
, 
çl£
);

144 
»s
 = 
	`evbufãr_add_bufãr
(
d¡
->
	`guts
(), 
¤c
->guts());

146  (
»s
 == 0);

147 
	}
}

149 
DLL_PUBLIC
 
št32_t
 
	gEv’tBufãr
::
	$Cİy
(*
d©a
, 
ušt32_t
 
Ën
)

151 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

152 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, -1);

153 
	`IF_NULL_RETURN_VALUE
(
d©a
, -1);

155  
	`evbufãr_cİyout
(
m_bufãr
, 
d©a
, 
Ën
);

156 
	}
}

158 
DLL_PUBLIC
 *
	gEv’tBufãr
::
	$R—dlše
(
ušt32_t
 *
¶’
, 
evbufãr_eŞ_¡yË
 
eŞ_¡yË
)

160 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

161 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, 
NULL
);

163  
	`evbufãr_»adÊ
(
m_bufãr
, 
¶’
, 
eŞ_¡yË
);

164 
	}
}

166 
DLL_PUBLIC
 
št32_t
 
	gEv’tBufãr
::
	$Fšd
(cÚ¡ *
wh©
, 
ušt32_t
 
Ën
, ušt32_ˆ
pos
 )

168 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

169 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, -1);

170 
	`IF_NULL_RETURN_VALUE
(
wh©
, -1);

171 
	`IF_TRUE_RETURN_VALUE
(
Ën
 == 0, -1);

173 
evbufãr_±r
 
p
;

174 
	`IF_TRUE_RETURN_VALUE
(
	`evbufãr_±r_£t
(
m_bufãr
, &
p
, 
pos
, 
EVBUFFER_PTR_SET
) < 0, -1);

176  
	`evbufãr_£¬ch
(
m_bufãr
, 
wh©
, 
Ën
, &
p
).
pos
;

177 
	}
}

179 
DLL_PUBLIC
 
št32_t
 
	gEv’tBufãr
::
	$Wr™eSock‘
(
A´TıSock‘
 *
sock‘
)

181 
”ºo
 = 0;

182 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

183 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, -1);

184 
	`IF_NULL_RETURN_VALUE
(
sock‘
, -1);

186  
	`evbufãr_wr™e_©mo¡
(
m_bufãr
, 
	`G‘Ev’tSock‘
(
sock‘
), -1);

187 
	}
}

189 
DLL_PUBLIC
 
št32_t
 
	gEv’tBufãr
::
	$R—dSock‘
(
A´TıSock‘
 *
sock‘
)

191 
”ºo
 = 0;

192 
	`as£¹
(
m_bufãr
 !ğ
NULL
);

193 
	`IF_NULL_RETURN_VALUE
(
m_bufãr
, -1);

194 
	`IF_NULL_RETURN_VALUE
(
sock‘
, -1);

196  
	`evbufãr_»ad
(
m_bufãr
, 
	`G‘Ev’tSock‘
(
sock‘
), -1);

197 
	}
}

202 
DLL_PUBLIC
 
	gEv’tBufãrLock
::
	$Ev’tBufãrLock
(
Ev’tBufãr
 *
bufãr
)

203 : 
	$m_bufãr
(
bufãr
)

205 
m_bufãr
->
	`Lock
();

206 
	}
}

208 
DLL_PUBLIC
 
	gEv’tBufãrLock
::~
	$Ev’tBufãrLock
()

210 
m_bufãr
->
	`UÆock
();

211 
	}
}

	@../libevent/event_buffer.h

1 #iâdeà
__LIBEVENT_EVENT_BUFFER_H__


2 
	#__LIBEVENT_EVENT_BUFFER_H__


	)

4 
	~"expÜts.h
"

5 
	~"ev’t2/bufãr.h
"

6 
	~"libev’t/ev’t_ba£.h
"

7 
	~"commÚ/¡dšt.h
"

8 
	~"­r/­r_sock‘.h
"

10 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

15 şas 
	cDLL_PUBLIC
 
	gEv’tBufãr
 {

16 
	gpublic
:

20 
Ev’tBufãr
();

25 
	gvœtu®
 ~
Ev’tBufãr
();

31 
evbufãr
 *
guts
();

36 
Lock
();

41 
UÆock
();

47 
ušt32_t
 
G‘L’gth
();

54 
boŞ
 
Ex·nd
(
ušt32_t
 
Ën
);

62 
boŞ
 
Aµ’d
(cÚ¡ *
d©a
, 
ušt32_t
 
Ën
);

72 
boŞ
 
Aµ’dReã»nû
(cÚ¡ *
d©a
, 
ušt32_t
 
Ën
, 
evbufãr_»f_ş—nup_cb
 
ş—nupâ
, *
ş—nupâ_¬g
);

80 
ušt8_t
 *
PuÎup
(
št32_t
 
size
=-1);

87 
boŞ
 
D¿š
(
ušt32_t
 
Ën
);

93 
boŞ
 
CË¬
();

101 
št32_t
 
Remove
(*
d©a
, 
ušt32_t
 
Ën
);

109 
št32_t
 
RemoveBufãr
(
Ev’tBufãr
 *
d¡
, 
ušt32_t
 
Ën
);

117 
boŞ
 
MoveBufãr
(
Ev’tBufãr
 *
¤c
, Ev’tBufã¸*
d¡
);

125 
št32_t
 
Cİy
(*
d©a
, 
ušt32_t
 
Ën
);

137 *
R—dlše
(
ušt32_t
 *
¶’
, 
evbufãr_eŞ_¡yË
 
eŞ_¡yË
);

146 
št32_t
 
Fšd
(cÚ¡ *
wh©
, 
ušt32_t
 
Ën
, ušt32_ˆ
pos
=0);

153 
št32_t
 
Wr™eSock‘
(
A´TıSock‘
 *
sock‘
);

160 
št32_t
 
R—dSock‘
(
A´TıSock‘
 *
sock‘
);

162 
	g´iv©e
:

163 
evbufãr
 *
m_bufãr
;

169 şas 
	cDLL_PUBLIC
 
	gEv’tBufãrLock
 {

170 
	gpublic
:

171 
Ev’tBufãrLock
(
Ev’tBufãr
 *
bufãr
);

172 
	gvœtu®
 ~
Ev’tBufãrLock
();

173 
	g´iv©e
:

174 
Ev’tBufãrLock
();

175 
Ev’tBufãrLock
(cÚ¡ Ev’tBufãrLock &
rhs
);

176 
	gEv’tBufãrLock
 &
	gİ”©Ü
=(cÚ¡ 
Ev’tBufãrLock
 &
rhs
);

177 
	g´iv©e
:

178 
Ev’tBufãr
 *
m_bufãr
;

	@../libevent/event_debug.h

1 #iâdeà
__LIBEVENT_EVENT_DEBUG_H__


2 
	#__LIBEVENT_EVENT_DEBUG_H__


	)

4 
	~<¡dio.h
>

6 
	#ev’t_´štf
(
fmt
, ...) do { \

7 
	`´štf
(
fmt
, ##
__VA_ARGS__
); \

8 } 0)

	)

	@../libevent/event_loop.cpp

1 
	~<as£¹.h
>

2 
	~"libev’t/ev’t_loİ.h
"

3 
	~"commÚ/ut™y.h
"

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
DLL_PUBLIC
 
	gEv’tLoİ
::
	$Ev’tLoİ
(
ms
 )

8 : 
	$m_ba£
(
ms
)

10 
	}
}

12 
DLL_PUBLIC
 
Ev’tLoİ
::~
	$Ev’tLoİ
()

14 
	}
}

16 
DLL_PUBLIC
 
Ev’tBa£
 *
Ev’tLoİ
::
	$ba£
()

18  &
m_ba£
;

19 
	}
}

21 
DLL_PUBLIC
 
boŞ
 
	gEv’tLoİ
::
	$S¹Loİ
()

23  
	`¡¬t
();

24 
	}
}

26 
DLL_PUBLIC
 
boŞ
 
	gEv’tLoİ
::
	$StİLoİ
()

28 
m_ba£
.
	`LoİB»ak
();

30  
	`wa™
();

31 
	}
}

33 
DLL_PUBLIC
 
	gEv’tLoİ
::
	$run
()

35 
m_ba£
.
	`Di¥©ch
();

36 
	}
}

	@../libevent/event_loop.h

1 #iâdeà
__LIBEVENT_EVENT_LOOP_H__


2 
	#__LIBEVENT_EVENT_LOOP_H__


	)

4 
	~"libev’t/ev’t_´”equis™e.h
"

6 
	~"expÜts.h
"

7 
	~"­r/­r_th»ad.h
"

8 
	~"libev’t/ev’t_ba£.h
"

9 
	~"libev’t/ev’t_objeù.h
"

11 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

16 
şass
 
DLL_PUBLIC
 
	gEv’tLoİ
: 
public
 
Ev’tObjeù
, 
´iv©e
 
	gA´Th»ad
 {

17 
	gpublic
:

22 
Ev’tLoİ
(
ms
=0);

27 
	gvœtu®
 ~
Ev’tLoİ
();

32 
Ev’tBa£
 *
ba£
();

38 
boŞ
 
S¹Loİ
();

44 
boŞ
 
StİLoİ
();

46 
	g´Ùeùed
:

47 
vœtu®
 
run
();

49 
	g´iv©e
:

50 
Ev’tBa£
 
m_ba£
;

	@../libevent/event_object.cpp

1 
	~<as£¹.h
>

2 
	~"libev’t/ev’t_objeù.h
"

3 
	~"commÚ/ut™y.h
"

5 
	~"libev’t/ev’t_roÙ.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
DLL_PUBLIC
 
	gEv’tObjeù
::
	$Ev’tObjeù
()

11 
Ev’tRoÙ
::
	`š¡ªû
();

12 
	}
}

14 
DLL_PUBLIC
 
	gEv’tObjeù
::~
	$Ev’tObjeù
()

16 
	}
}

	@../libevent/event_object.h

1 #iâdeà
__LIBEVENT_EVENT_OBJECT_H__


2 
	#__LIBEVENT_EVENT_OBJECT_H__


	)

4 
	~"expÜts.h
"

6 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

11 şas 
	cDLL_PUBLIC
 
	gEv’tObjeù
 {

12 
	gpublic
:

16 
Ev’tObjeù
();

21 
	gvœtu®
 ~
Ev’tObjeù
();

	@../libevent/event_prerequisite.h

1 #iâdeà
__LIBEVENT_EVENT_PREREQUISITE_H__


2 
	#__LIBEVENT_EVENT_PREREQUISITE_H__


	)

4 #ià
defšed
(
_WIN32
)

5 #iâdeà
_WIN32_WINNT


6 
	#_WIN32_WINNT
 0x0400

	)

8 #iâdeà
WIN32_LEAN_AND_MEAN


9 
	#WIN32_LEAN_AND_MEAN


	)

11 
	~<Wšdows.h
>

12 
	~<WšSock2.h
>

	@../libevent/event_root.cpp

1 
	~<as£¹.h
>

2 
	~"libev’t/ev’t_roÙ.h
"

3 
	~"commÚ/ut™y.h
"

5 
	~<memÜy
>

6 
	~"ev’t2/th»ad.h
"

7 
	~"libev’t/ev’t_debug.h
"

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
DLL_PUBLIC
 
	gEv’tRoÙ
::
	$Ev’tRoÙ
()

13 
	`ev’t_´štf
("EVENT Application Instance initiating ...\n");

15 #ià
	`defšed
(
_WIN32
)

16 
	`evth»ad_u£_wšdows_th»ads
();

17 #–ià
	`defšed
(
__lšux__
)

18 
	`evth»ad_u£_±h»ads
();

23 
	`ev’t_´štf
("EVENT Application Instance init done ...\n");

24 
	}
}

26 
DLL_PUBLIC
 
	gEv’tRoÙ
::~
	$Ev’tRoÙ
()

28 
	`ev’t_´štf
("EVENT Application Instance fini done ...\n");

29 
	}
}

31 
DLL_PUBLIC
 
Ev’tRoÙ
 *
	gEv’tRoÙ
::
	$š¡ªû
()

33 
¡d
::
auto_±r
<
Ev’tRoÙ
> 
	`s_š¡ªû
(
Ãw
 EventRoot);

35  
s_š¡ªû
.
	`g‘
();

36 
	}
}

	@../libevent/event_root.h

1 #iâdeà
__LIBEVENT_EVENT_ROOT_H__


2 
	#__LIBEVENT_EVENT_ROOT_H__


	)

4 
	~"expÜts.h
"

6 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

11 şas 
	cDLL_PUBLIC
 
	gEv’tRoÙ
 {

12 
	g´iv©e
:

13 
Ev’tRoÙ
();

14 
	gpublic
:

15 ~
Ev’tRoÙ
();

16 
Ev’tRoÙ
 *
š¡ªû
();

	@../libevent/event_timer.cpp

1 
	~<as£¹.h
>

2 
	~"libev’t/ev’t_tim”.h
"

3 
	~"commÚ/ut™y.h
"

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
DLL_PUBLIC
 
	gEv’tTim”
::
	$Ev’tTim”
(
Ev’tBa£
 *
ba£
, 
boŞ
 
³rsi¡
, 
ev’t_tim”_ÿÎback_â
 
cb
, *
¬g1
, *
¬g2
)

8 : 
	`Ev’t
(
ba£
, -1, 
³rsi¡
 ? 
EV_PERSIST
 : 0, 
NULL
, NULL, NULL)

9 , 
	`m_cb
(
cb
)

10 , 
	`m_¬g1
(
¬g1
)

11 , 
	$m_¬g2
(
¬g2
)

13 
	}
}

15 
DLL_PUBLIC
 
	gEv’tTim”
::~
	$Ev’tTim”
()

17 
	}
}

19 
DLL_PUBLIC
 
Ev’tTim”
::
	$C®lback
(
evut_sock‘_t
 
fd
, 
wh©
)

21 
	`IF_NULL_RETURN
(
m_cb
);

22 
	`IF_EQUAL_RETURN
(
wh©
 & 
EV_TIMEOUT
, 0x0);

24 
	`m_cb
(
this
, 
m_¬g1
, 
m_¬g2
);

25 
	}
}

	@../libevent/event_timer.h

1 #iâdeà
__LIBEVENT_EVENT_TIMER_H__


2 
	#__LIBEVENT_EVENT_TIMER_H__


	)

4 
	~"expÜts.h
"

5 
	~"ev’t2/ev’t.h
"

6 
	~"libev’t/ev’t_ba£.h
"

7 
	~"libev’t/ev’t.h
"

9 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

17 (*
	gev’t_tim”_ÿÎback_â
)(
	tEv’tTim”
 *
	te
, *
	t¬g1
, *
	t¬g2
);

22 şas 
	cDLL_PUBLIC
 
	gEv’tTim”
: 
public
 
Ev’t
 {

23 
public
:

32 
Ev’tTim”
(
Ev’tBa£
 *
ba£
, 
boŞ
 
³rsi¡
, 
ev’t_tim”_ÿÎback_â
 
cb
, *
¬g1
, *
¬g2
);

37 
	gvœtu®
 ~
Ev’tTim”
();

39 
	g´iv©e
:

40 
Ev’tTim”
();

41 
vœtu®
 
C®lback
(
evut_sock‘_t
 
fd
, 
wh©
);

43 
ev’t_tim”_ÿÎback_â
 
	gm_cb
;

44 *
	gm_¬g1
;

45 *
	gm_¬g2
;

	@../libevent/event_utility.cpp

1 
	~"libev’t/ev’t_ut™y.h
"

3 
	~"­r-1/­r_pÜbË.h
"

5 
	~"commÚ/ut™y.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
DLL_PUBLIC
 
evut_sock‘_t
 
	gSYSUTILS_SPACE
::
	$G‘Ev’tSock‘
(
A´Sock‘
 *
sock‘
)

11 
	`IF_NULL_RETURN_VALUE
(
sock‘
, 0);

12 
­r_sock‘_t
 *
­r_s
 = 
sock‘
->
	`guts
();

13 
	`IF_NULL_RETURN_VALUE
(
­r_s
, 0);

14 
­r_os_sock_t
 
os_s
 = (apr_os_sock_t)0;

15 
	`­r_os_sock_g‘
(&
os_s
, 
­r_s
);

16  (
evut_sock‘_t
)
os_s
;

17 
	}
}

	@../libevent/event_utility.h

1 #iâdeà
__LIBEVENT_EVENT_UTILITY_H__


2 
	#__LIBEVENT_EVENT_UTILITY_H__


	)

4 
	~"libev’t/ev’t_´”equis™e.h
"

6 
	~"expÜts.h
"

7 
	~"­r/­r_sock‘.h
"

8 
	~"ev’t2/ut.h
"

10 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

17 
DLL_PUBLIC
 
evut_sock‘_t
 
G‘Ev’tSock‘
(
A´Sock‘
 *
sock‘
);

	@../libevent/unittest/event_loop_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"ev’t_loİ_‹¡.h
"

4 
	~<queue
>

5 
	~"­r-1/­r_poŞs.h
"

6 
	~"­r/­r_ut™y.h
"

7 
	~"libev’t/ev’t_loİ.h
"

8 
	~"commÚ/mu‹x.h
"

9 
	~"libev’t/­r_ev’t.h
"

10 
	~"commÚ/ut™y.h
"

11 
	~"­r/­r_cÚd.h
"

13 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

15 
Cr™iÿlSeùiÚ
 
	gs_cswÜk”s
;

16 
	g¡d
::
queue
<
A´Th»adWÜk”
 *> 
s_wÜk”s
;

17 
Cr™iÿlSeùiÚ
 
	gs_csch¬s
;

18 
	g¡d
::
queue
<> 
s_ch¬s
;

19 
Ev’tLoİ
 
s_loİ
(500);

20 
A´TıSock‘
 
	gs_li¡’”
;

21 
Cr™iÿlSeùiÚ
 
	gs_cssock‘s
;

22 
	g¡d
::
queue
<
A´Sock‘
 *> 
s_sock‘s
;

23 
	gs_pÜt
 = 3456;

24 
A´CÚd
 
s_cÚd
(
çl£
);

29 
boŞ
 
	$s_ü—‹_»gi¡”
(
A´TıSock‘
 *
sock‘
)

31 
Ev’tRegi¡”
 *
r
 = 
Ãw
 
	`Ev’tRegi¡”
(
sock‘
);

32 
	`IF_FALSE_RETURN_VALUE
(
r
->
	`C»©eTh»ad
(), 
çl£
);

34 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_cswÜk”s
);

35 
s_wÜk”s
.
	`push
(
r
);

37  
Œue
;

38 
	}
}

40 
boŞ
 
	$s_ü—‹_ş›Á
(
id
)

42 
Cl›ÁG’”©Ü
 *
g’”©Ü
 = 
Ãw
 
	`Cl›ÁG’”©Ü
(
id
);

43 
	`IF_FALSE_RETURN_VALUE
(
g’”©Ü
->
	`C»©eTh»ad
(), 
çl£
);

45 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_cswÜk”s
);

46 
s_wÜk”s
.
	`push
(
g’”©Ü
);

48  
Œue
;

49 
	}
}

51 
boŞ
 
	$s_po¡_¡İ_loİ
()

53 
Ev’tT”mš©Ü
 *
‹rmš©Ü
 = 
Ãw
 
	`Ev’tT”mš©Ü
();

54 
	`IF_FALSE_RETURN_VALUE
(
‹rmš©Ü
->
	`C»©eTh»ad
(), 
çl£
);

56 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_cswÜk”s
);

57 
s_wÜk”s
.
	`push
(
‹rmš©Ü
);

59  
Œue
;

60 
	}
}

65 
	$s_»adev’t_ÿÎback
(
A´Ev’t
 *
e
, 
A´Sock‘
 *
sock‘
, 
wh©
, *
¬g1
, *
¬g2
)

67 
d–‘e
 
e
;

69 
A´TıSock‘
 *
ş›Á
 = 
dyÇmic_ÿ¡
<A´TıSock‘ *>(
sock‘
);

70 
	`IF_NULL_RETURN
(
ş›Á
);

72 
dummy_bufãr
[] = {'\0'};

73 
dummy_size
 = (
dummy_bufãr
);

74 
ş›Á
->
	`»cv
(
dummy_bufãr
, (
­r_size_t
 *)&
dummy_size
);

76 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_csch¬s
);

77 
s_ch¬s
.
	`push
(
dummy_bufãr
[0]);

78 
	}
}

80 
	$s_li¡’ev’t_ÿÎback
(
A´Ev’t
 *
e
, 
A´Sock‘
 *
sock‘
, 
wh©
, *
¬g1
, *
¬g2
)

82 
A´TıSock‘
 *
li¡’”
 = 
dyÇmic_ÿ¡
<A´TıSock‘ *>(
sock‘
);

83 
	`IF_NULL_RETURN
(
li¡’”
);

84 
A´TıSock‘
 *
ş›Á
 = 
li¡’”
->
	`acû±
();

86 
	`s_ü—‹_»gi¡”
(
ş›Á
);

88 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_cssock‘s
);

89 
s_sock‘s
.
	`push
(
ş›Á
);

90 
	}
}

92 
	gCl›ÁG’”©Ü
::
	$Cl›ÁG’”©Ü
(
id
)

93 : 
	$m_id
(
id
)

95 
	}
}

97 
Cl›ÁG’”©Ü
::~
	$Cl›ÁG’”©Ü
()

99 
	}
}

101 
Cl›ÁG’”©Ü
::
	$Th»adProc
()

103 
A´TıSock‘
 
ş›Á
;

104 
	`IF_NOT_EQUAL_RETURN
(
ş›Á
.
	`cÚÃù
("127.0.0.1", 
s_pÜt
), 
APR_SUCCESS
);

105 
dummy_bufãr
[] = {
m_id
};

106 
dummy_size
 = (
dummy_bufãr
);

107 
ş›Á
.
	`£nd
(
dummy_bufãr
, (
­r_size_t
 *)&
dummy_size
);

108 
	}
}

110 
	gEv’tRegi¡”
::
	$Ev’tRegi¡”
(
A´TıSock‘
 *
sock‘
)

111 : 
	$m_sock‘
(
sock‘
)

113 
	}
}

115 
Ev’tRegi¡”
::~
	$Ev’tRegi¡”
()

117 
	}
}

119 
Ev’tRegi¡”
::
	$Th»adProc
()

121 
A´Ev’t
 *
e
 = 
Ãw
 
	`A´Ev’t
(
s_loİ
.
	`ba£
(), 
m_sock‘
, 
EV_READ
, 
s_»adev’t_ÿÎback
, 
NULL
, NULL);

122 
e
->
	`Add
();

123 
	}
}

125 
	gEv’tT”mš©Ü
::
	$Ev’tT”mš©Ü
()

127 
	}
}

129 
Ev’tT”mš©Ü
::~
	$Ev’tT”mš©Ü
()

131 
	}
}

133 
Ev’tT”mš©Ü
::
	$Th»adProc
()

135 
s_loİ
.
	`StİLoİ
();

136 
s_cÚd
.
	`£t
();

137 
	}
}

139 
	gmax_ş›Ás
 = 100;

141 
	$TEST
(
Ev’tBa£Te¡
, 
Sequ’tŸlTe¡
)

144 
s_li¡’”
.
	`bšd
(
NULL
, 
s_pÜt
);

145 
s_li¡’”
.
	`li¡’
();

148 
A´Ev’t
 
	`e
(
s_loİ
.
	`ba£
(), &
s_li¡’”
, 
EV_READ
 | 
EV_PERSIST
, 
s_li¡’ev’t_ÿÎback
, 
NULL
, NULL);

149 
	`EXPECT_EQ
(
Œue
, 
e
.
	`Add
());

152 
	`EXPECT_EQ
(
Œue
, 
s_loİ
.
	`S¹Loİ
());

155 
i
 = 0; i < 
max_ş›Ás
; i++)

157 
	`EXPECT_EQ
(
Œue
, 
	`s_ü—‹_ş›Á
(()
i
));

163 
	`¦“p
(1);

164 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_csch¬s
);

165 ià(
s_ch¬s
.
	`size
(è=ğ(
size_t
)
max_ş›Ás
)

172 
	`EXPECT_EQ
(
Œue
, 
	`s_po¡_¡İ_loİ
());

173 
s_cÚd
.
	`wa™
();

177 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_cswÜk”s
);

178 !
s_wÜk”s
.
	`em±y
())

180 
A´Th»adWÜk”
 *
wÜk”
 = 
s_wÜk”s
.
	`äÚt
();

181 
	`EXPECT_NE
((
A´Th»adWÜk”
 *)
NULL
, 
wÜk”
);

182 
d–‘e
 
wÜk”
;

183 
s_wÜk”s
.
	`pİ
();

188 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_cssock‘s
);

189 !
s_sock‘s
.
	`em±y
())

191 
A´Sock‘
 *
sock‘
 = 
s_sock‘s
.
	`äÚt
();

192 
	`EXPECT_NE
((
A´Sock‘
 *)
NULL
, 
sock‘
);

193 
d–‘e
 
sock‘
;

194 
s_sock‘s
.
	`pİ
();

199 
	`EXPECT_EQ
((
size_t
)
max_ş›Ás
, 
s_ch¬s
.
	`size
());

200 !
s_ch¬s
.
	`em±y
())

202 
id
 = 
s_ch¬s
.
	`äÚt
();

203 
	`EXPECT_GT
(()
max_ş›Ás
, 
id
);

204 
s_ch¬s
.
	`pİ
();

206 
	}
}

	@../libevent/unittest/event_loop_test.h

1 #iâdeà
__EVENT_LOOP_TEST_H__


2 
	#__EVENT_LOOP_TEST_H__


	)

4 
	~"­r/­r_th»ad_wÜk”.h
"

5 
	~"­r/­r_sock‘.h
"

7 şas 
	cCl›ÁG’”©Ü
: 
public
 
SYSUTILS_SPACE
::
A´Th»adWÜk”


9 
public
:

10 
Cl›ÁG’”©Ü
(
id
);

11 
	mvœtu®
 ~
Cl›ÁG’”©Ü
();

12 
	m´Ùeùed
:

13 
Th»adProc
();

14 
	m´iv©e
:

15 
m_id
;

18 şas 
	cEv’tRegi¡”
: 
public
 
SYSUTILS_SPACE
::
A´Th»adWÜk”


20 
public
:

21 
Ev’tRegi¡”
(
SYSUTILS_SPACE
::
A´TıSock‘
 *
sock‘
);

22 
	mvœtu®
 ~
Ev’tRegi¡”
();

23 
	m´Ùeùed
:

24 
Th»adProc
();

25 
	m´iv©e
:

26 
SYSUTILS_SPACE
::
A´TıSock‘
 *
m_sock‘
;

29 şas 
	cEv’tT”mš©Ü
: 
public
 
SYSUTILS_SPACE
::
A´Th»adWÜk”


31 
public
:

32 
Ev’tT”mš©Ü
();

33 
	mvœtu®
 ~
Ev’tT”mš©Ü
();

34 
	m´Ùeùed
:

35 
Th»adProc
();

	@../libevent/unittest/event_timer_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"libev’t/ev’t_ba£.h
"

3 
	~"libev’t/ev’t_loİ.h
"

4 
	~"libev’t/ev’t_tim”.h
"

6 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

8 
Ev’tLoİ
 
	gs_loİ
;

10 
	gs_accumuÏtÜ
 = 0;

12 
	$s_tim”_ÿÎback
(
Ev’tTim”
 *
e
, *
¬g1
, *
¬g2
)

14 
s_accumuÏtÜ
++;

15 
	}
}

17 
Ev’tTim”
 
s_tim”
(
s_loİ
.
ba£
(), 
Œue
, 
s_tim”_ÿÎback
, 
NULL
, NULL);

19 
	gs_tim”_š‹rv®
 = 100;

20 
	gs_¦“p_amouÁ
 = 1000;

22 
	$TEST
(
Ev’tBa£Te¡
, 
Tim”Te¡
)

24 
	`EXPECT_EQ
(
Œue
, 
s_tim”
.
	`Add
(
s_tim”_š‹rv®
));

25 
	`EXPECT_EQ
(
Œue
, 
s_loİ
.
	`S¹Loİ
());

26 
	`u¦“p
(
s_¦“p_amouÁ
 * 1000);

27 
	`EXPECT_EQ
(
Œue
, 
s_loİ
.
	`StİLoİ
());

28 
	`EXPECT_LT
((
s_¦“p_amouÁ
 / 
s_tim”_š‹rv®
è/ 2, 
s_accumuÏtÜ
);

29 
	`EXPECT_GE
(
s_¦“p_amouÁ
 / 
s_tim”_š‹rv®
, 
s_accumuÏtÜ
);

30 
	`EXPECT_EQ
(
Œue
, 
s_tim”
.
	`D–
());

31 
	}
}

	@../libevent/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../minizip/crypt.h

30 
	#CRC32
(
c
, 
b
è((*(
püc_32_b
+((()(cè^ (b)è& 0xff))è^ ((cè>> 8))

	)

35 
	$deüy±_by‹
(* 
pkeys
, cÚ¡ * 
püc_32_b
)

37 
‹mp
;

41 
‹mp
 = (()(*(
pkeys
+2)) & 0xffff) | 2;

42  ()(((
‹mp
 * (temp ^ 1)) >> 8) & 0xff);

43 
	}
}

48 
	$upd©e_keys
(* 
pkeys
,cÚ¡ * 
püc_32_b
,
c
)

50 (*(
pkeys
+0)èğ
	`CRC32
((*Õkeys+0)), 
c
);

51 (*(
pkeys
+1)) += (*(pkeys+0)) & 0xff;

52 (*(
pkeys
+1)) = (*(pkeys+1)) * 134775813L + 1;

54 
keyshiá
 = ()((*(
pkeys
+1)) >> 24);

55 (*(
pkeys
+2)èğ
	`CRC32
((*Õkeys+2)), 
keyshiá
);

57  
c
;

58 
	}
}

65 
	$š™_keys
(cÚ¡ * 
·sswd
,* 
pkeys
,cÚ¡ * 
püc_32_b
)

67 *(
pkeys
+0) = 305419896L;

68 *(
pkeys
+1) = 591751049L;

69 *(
pkeys
+2) = 878082192L;

70 *
·sswd
 != '\0') {

71 
	`upd©e_keys
(
pkeys
,
püc_32_b
,()*
·sswd
);

72 
·sswd
++;

74 
	}
}

76 
	#zdecode
(
pkeys
,
püc_32_b
,
c
) \

77 (
	`upd©e_keys
(
pkeys
,
püc_32_b
,
c
 ^ğ
	`deüy±_by‹
Õkeys,püc_32_b)))

	)

79 
	#z’code
(
pkeys
,
püc_32_b
,
c
,
t
) \

80 (
t
=
	`deüy±_by‹
(
pkeys
,
püc_32_b
), 
	`upd©e_keys
Õkeys,püc_32_b,
c
),^(c))

	)

82 #ifdeà
INCLUDECRYPTINGCODE_IFCRYPTALLOWED


84 
	#RAND_HEAD_LEN
 12

	)

86 #iâdeà
ZCR_SEED2


87 
	#ZCR_SEED2
 3141592654UL

	)

90 
	$üy±h—d
(cÚ¡ * 
·sswd
,

91 * 
buf
,

92 
bufSize
,

93 * 
pkeys
,

94 cÚ¡ * 
püc_32_b
,

95 
ücFÜCry±šg
)

97 
n
;

98 
t
;

99 
c
;

100 
h—d”
[
RAND_HEAD_LEN
-2];

101 
ÿÎs
 = 0;

103 ià(
bufSize
<
RAND_HEAD_LEN
)

110 ià(++
ÿÎs
 == 1)

112 
	`¤ªd
(()(
	`time
(
NULL
è^ 
ZCR_SEED2
));

114 
	`š™_keys
(
·sswd
, 
pkeys
, 
püc_32_b
);

115 
n
 = 0;‚ < 
RAND_HEAD_LEN
-2;‚++)

117 
c
 = (
	`¿nd
() >> 7) & 0xff;

118 
h—d”
[
n
] = ()
	`z’code
(
pkeys
, 
püc_32_b
, 
c
, 
t
);

121 
	`š™_keys
(
·sswd
, 
pkeys
, 
püc_32_b
);

122 
n
 = 0;‚ < 
RAND_HEAD_LEN
-2;‚++)

124 
buf
[
n
] = ()
	`z’code
(
pkeys
, 
püc_32_b
, 
h—d”
[n], 
t
);

126 
buf
[
n
++] = ()
	`z’code
(
pkeys
, 
püc_32_b
, ()(
ücFÜCry±šg
 >> 16è& 0xff, 
t
);

127 
buf
[
n
++] = ()
	`z’code
(
pkeys
, 
püc_32_b
, ()(
ücFÜCry±šg
 >> 24è& 0xff, 
t
);

128  
n
;

129 
	}
}

	@../minizip/ioapi.h

21 #iâdeà
_ZLIBIOAPI64_H


22 
	#_ZLIBIOAPI64_H


	)

24 #ià(!
defšed
(
_WIN32
)è&& (!defšed(
WIN32
)è&& (!defšed(
__APPLE__
))

29 #iâdeà
__USE_FILE_OFFSET64


30 
	#__USE_FILE_OFFSET64


	)

32 #iâdeà
__USE_LARGEFILE64


33 
	#__USE_LARGEFILE64


	)

35 #iâdeà
_LARGEFILE64_SOURCE


36 
	#_LARGEFILE64_SOURCE


	)

38 #iâdeà
_FILE_OFFSET_BIT


39 
	#_FILE_OFFSET_BIT
 64

	)

44 
	~<¡dio.h
>

45 
	~<¡dlib.h
>

46 
	~"zlib.h
"

48 #ià
defšed
(
USE_FILE32API
)

49 
	#fİ’64
 
fİ’


	)

50 
	#á–lo64
 
á–l


	)

51 
	#f£eko64
 
f£ek


	)

53 #ifdeà
__F»eBSD__


54 
	#fİ’64
 
fİ’


	)

55 
	#á–lo64
 
á–lo


	)

56 
	#f£eko64
 
f£eko


	)

58 #ifdeà
_MSC_VER


59 
	#fİ’64
 
fİ’


	)

60 #ià(
_MSC_VER
 >ğ1400è&& (!(
defšed
(
NO_MSCVER_FILE64_FUNC
)))

61 
	#á–lo64
 
_á–li64


	)

62 
	#f£eko64
 
_f£eki64


	)

64 
	#á–lo64
 
á–l


	)

65 
	#f£eko64
 
f£ek


	)

81 #ifdeà
HAVE_MINIZIP64_CONF_H


82 
	~"mz64cÚf.h
"

86 #ifdeà
HAVE_64BIT_INT_CUSTOM


87 64B
IT_INT_CUSTOM_TYPE
 
	tZPOS64_T
;

89 #ifdeà
HAS_STDINT_H


90 
	~"¡dšt.h
"

91 
ušt64_t
 
	tZPOS64_T
;

95 
	#MAXU32
 0xffffffff

	)

97 #ià
defšed
(
_MSC_VER
è|| defšed(
__BORLANDC__
)

98 
	t__št64
 
	tZPOS64_T
;

100 
	tZPOS64_T
;

107 #ifdeà
__ılu¥lus


112 
	#ZLIB_FILEFUNC_SEEK_CUR
 (1)

	)

113 
	#ZLIB_FILEFUNC_SEEK_END
 (2)

	)

114 
	#ZLIB_FILEFUNC_SEEK_SET
 (0)

	)

116 
	#ZLIB_FILEFUNC_MODE_READ
 (1)

	)

117 
	#ZLIB_FILEFUNC_MODE_WRITE
 (2)

	)

118 
	#ZLIB_FILEFUNC_MODE_READWRITEFILTER
 (3)

	)

120 
	#ZLIB_FILEFUNC_MODE_EXISTING
 (4)

	)

121 
	#ZLIB_FILEFUNC_MODE_CREATE
 (8)

	)

124 #iâdeà
ZCALLBACK


125 #ià(
defšed
(
WIN32
è|| defšed(
_WIN32
è|| defšed (
WINDOWS
è|| defšed (
_WINDOWS
)è&& defšed(
CALLBACK
è&& defšed (
USEWINDOWS_CALLBACK
)

126 
	#ZCALLBACK
 
CALLBACK


	)

128 
	#ZCALLBACK


	)

135 
voidpf
 (
	tZCALLBACK
 *
	tİ’_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, cÚ¡ * 
	tf’ame
, 
	tmode
));

136 
uLÚg
 (
	tZCALLBACK
 *
	t»ad_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	t¡»am
, * 
	tbuf
, 
	tuLÚg
 
	tsize
));

137 
uLÚg
 (
	tZCALLBACK
 *
	twr™e_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	t¡»am
, cÚ¡ * 
	tbuf
, 
	tuLÚg
 
	tsize
));

138 (
ZCALLBACK
 *
	tşo£_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	t¡»am
));

139 (
ZCALLBACK
 *
	t‹¡”rÜ_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	t¡»am
));

141 (
ZCALLBACK
 *
	t‹Î_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	t¡»am
));

142 (
ZCALLBACK
 *
	t£ek_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	t¡»am
, 
	tuLÚg
 
	toff£t
, 
	tÜigš
));

146 
	szlib_fefunc_def_s


148 
İ’_fe_func
 
zİ’_fe
;

149 
»ad_fe_func
 
z»ad_fe
;

150 
wr™e_fe_func
 
zwr™e_fe
;

151 
‹Î_fe_func
 
z‹Î_fe
;

152 
£ek_fe_func
 
z£ek_fe
;

153 
şo£_fe_func
 
zşo£_fe
;

154 
‹¡”rÜ_fe_func
 
z”rÜ_fe
;

155 
voidpf
 
İaque
;

156 } 
	tzlib_fefunc_def
;

158 
ZPOS64_T
 (
	tZCALLBACK
 *
	t‹Î64_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	t¡»am
));

159 (
ZCALLBACK
 *
	t£ek64_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	t¡»am
, 
	tZPOS64_T
 
	toff£t
, 
	tÜigš
));

160 
voidpf
 (
	tZCALLBACK
 *
	tİ’64_fe_func
è
	tOF
((
	tvoidpf
 
	tİaque
, cÚ¡ * 
	tf’ame
, 
	tmode
));

162 
	szlib_fefunc64_def_s


164 
İ’64_fe_func
 
zİ’64_fe
;

165 
»ad_fe_func
 
z»ad_fe
;

166 
wr™e_fe_func
 
zwr™e_fe
;

167 
‹Î64_fe_func
 
z‹Î64_fe
;

168 
£ek64_fe_func
 
z£ek64_fe
;

169 
şo£_fe_func
 
zşo£_fe
;

170 
‹¡”rÜ_fe_func
 
z”rÜ_fe
;

171 
voidpf
 
İaque
;

172 } 
	tzlib_fefunc64_def
;

174 
fl_fİ’64_fefunc
 
OF
((
zlib_fefunc64_def
* 
pzlib_fefunc_def
));

175 
fl_fİ’_fefunc
 
OF
((
zlib_fefunc_def
* 
pzlib_fefunc_def
));

178 
	szlib_fefunc64_32_def_s


180 
zlib_fefunc64_def
 
zfe_func64
;

181 
İ’_fe_func
 
zİ’32_fe
;

182 
‹Î_fe_func
 
z‹Î32_fe
;

183 
£ek_fe_func
 
z£ek32_fe
;

184 } 
	tzlib_fefunc64_32_def
;

187 
	#ZREAD64
(
fefunc
,
fe¡»am
,
buf
,
size
è((*((fefunc).
zfe_func64
.
z»ad_fe
)è((fefunc).zfe_func64.
İaque
,fe¡»am,buf,size))

	)

188 
	#ZWRITE64
(
fefunc
,
fe¡»am
,
buf
,
size
è((*((fefunc).
zfe_func64
.
zwr™e_fe
)è((fefunc).zfe_func64.
İaque
,fe¡»am,buf,size))

	)

191 
	#ZCLOSE64
(
fefunc
,
fe¡»am
è((*((fefunc).
zfe_func64
.
zşo£_fe
)è((fefunc).zfe_func64.
İaque
,fe¡»am))

	)

192 
	#ZERROR64
(
fefunc
,
fe¡»am
è((*((fefunc).
zfe_func64
.
z”rÜ_fe
)è((fefunc).zfe_func64.
İaque
,fe¡»am))

	)

194 
voidpf
 
ÿÎ_zİ’64
 
OF
((cÚ¡ 
zlib_fefunc64_32_def
* 
pfefunc
,cÚ¡ *
f’ame
,
mode
));

195 
ÿÎ_z£ek64
 
OF
((cÚ¡ 
zlib_fefunc64_32_def
* 
pfefunc
,
voidpf
 
fe¡»am
, 
ZPOS64_T
 
off£t
, 
Üigš
));

196 
ZPOS64_T
 
ÿÎ_z‹Î64
 
OF
((cÚ¡ 
zlib_fefunc64_32_def
* 
pfefunc
,
voidpf
 
fe¡»am
));

198 
fl_zlib_fefunc64_32_def_äom_fefunc32
(
zlib_fefunc64_32_def
* 
p_fefunc64_32
,cÚ¡ 
zlib_fefunc_def
* 
p_fefunc32
);

200 
	#ZOPEN64
(
fefunc
,
f’ame
,
mode
è(
	`ÿÎ_zİ’64
((&(fefunc)),(f’ame),(mode)))

	)

201 
	#ZTELL64
(
fefunc
,
fe¡»am
è(
	`ÿÎ_z‹Î64
((&(fefunc)),(fe¡»am)))

	)

202 
	#ZSEEK64
(
fefunc
,
fe¡»am
,
pos
,
mode
è(
	`ÿÎ_z£ek64
((&(fefunc)),(fe¡»am),Õos),(mode)))

	)

204 #ifdeà
__ılu¥lus


	@../minizip/iowin32.h

13 #ià
defšed
(
_WIN32
)

15 
	~<wšdows.h
>

17 #ifdeà
__ılu¥lus


21 
fl_wš32_fefunc
 
OF
((
zlib_fefunc_def
* 
pzlib_fefunc_def
));

22 
fl_wš32_fefunc64
 
OF
((
zlib_fefunc64_def
* 
pzlib_fefunc_def
));

23 
fl_wš32_fefunc64A
 
OF
((
zlib_fefunc64_def
* 
pzlib_fefunc_def
));

24 
fl_wš32_fefunc64W
 
OF
((
zlib_fefunc64_def
* 
pzlib_fefunc_def
));

26 #ifdeà
__ılu¥lus


	@../minizip/miniunz.cpp

15 #ià(!
defšed
(
_WIN32
)è&& (!defšed(
WIN32
)è&& (!defšed(
__APPLE__
))

16 #iâdeà
__USE_FILE_OFFSET64


17 
	#__USE_FILE_OFFSET64


	)

19 #iâdeà
__USE_LARGEFILE64


20 
	#__USE_LARGEFILE64


	)

22 #iâdeà
_LARGEFILE64_SOURCE


23 
	#_LARGEFILE64_SOURCE


	)

25 #iâdeà
_FILE_OFFSET_BIT


26 
	#_FILE_OFFSET_BIT
 64

	)

30 #ifdeà
__APPLE__


32 
	#FOPEN_FUNC
(
f’ame
, 
mode
è
	`fİ’
(f’ame, mode)

	)

33 
	#FTELLO_FUNC
(
¡»am
è
	`á–lo
(¡»am)

	)

34 
	#FSEEKO_FUNC
(
¡»am
, 
off£t
, 
Üigš
è
	`f£eko
(¡»am, off£t, origš)

	)

36 
	#FOPEN_FUNC
(
f’ame
, 
mode
è
	`fİ’64
(f’ame, mode)

	)

37 
	#FTELLO_FUNC
(
¡»am
è
	`á–lo64
(¡»am)

	)

38 
	#FSEEKO_FUNC
(
¡»am
, 
off£t
, 
Üigš
è
	`f£eko64
(¡»am, off£t, origš)

	)

41 
	~"unz.h
"

43 #ifdeà
_WIN32


44 
	~<dœeù.h
>

45 
	#USEWIN32IOAPI


	)

46 
	~"iowš32.h
"

48 
	~<utime.h
>

51 
	#WRITEBUFFERSIZE
 (8192)

	)

53 
	~"mšizUt™y.h
"

54 
	~"commÚ/fe.h
"

56 
	~"debugMsg/Debug.h
"

58 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

60 
	$chªge_fe_d©e
(cÚ¡ 
¡d
::
¡ršg
& 
f’ame
, 
uLÚg
 
dosd©e
, 
tm_unz
 
tmu_d©e
)

62 #ifdeà
_WIN32


63 
HANDLE
 
hFe
;

64 
FILETIME
 
ám
, 
áLoÿl
, 
áC»©e
, 
áLa¡Acc
, 
áLa¡Wr™e
;

66 
hFe
 = 
	`C»©eFeA
(
f’ame
.
	`c_¡r
(), 
GENERIC_READ
 | 
GENERIC_WRITE
, 0, 
NULL
, 
OPEN_EXISTING
, 0, NULL);

67 
	`G‘FeTime
(
hFe
, &
áC»©e
, &
áLa¡Acc
, &
áLa¡Wr™e
);

68 
	`DosD©eTimeToFeTime
((
WORD
)(
dosd©e
 >> 16), (WORD)dosd©e, &
áLoÿl
);

69 
	`LoÿlFeTimeToFeTime
(&
áLoÿl
, &
ám
);

70 
	`S‘FeTime
(
hFe
, &
ám
, &
áLa¡Acc
, &ftm);

71 
	`Clo£HªdË
(
hFe
);

75 #ià(
	`defšed
(
__lšux__
)è|| (defšed(
__APPLE__
))

76 
utimbuf
 
ut
;

77 
tm
 
Ãwd©e
;

78 
Ãwd©e
.
tm_£c
 = 
tmu_d©e
.tm_sec;

79 
Ãwd©e
.
tm_mš
 = 
tmu_d©e
.tm_min;

80 
Ãwd©e
.
tm_hour
 = 
tmu_d©e
.tm_hour;

81 
Ãwd©e
.
tm_mday
 = 
tmu_d©e
.tm_mday;

82 
Ãwd©e
.
tm_mÚ
 = 
tmu_d©e
.tm_mon;

83 ià(
tmu_d©e
.
tm_y—r
 > 1900)

85 
Ãwd©e
.
tm_y—r
 = 
tmu_d©e
.tm_year - 1900;

89 
Ãwd©e
.
tm_y—r
 = 
tmu_d©e
.tm_year ;

92 
Ãwd©e
.
tm_isd¡
 = -1;

94 
ut
.
aùime
 = ut.
modtime
 = 
	`mktime
(&
Ãwd©e
);

96 
	`utime
(
f’ame
.
	`c_¡r
(), &
ut
);

100 
	}
}

102 
	$do_exŒaù_cu¼’tfe
(
unzFe
 
uf
)

104 
f’ameTmp
[256];

105 
unz_fe_šfo64
 
fe_šfo
;

106 
”r
 = 
	`unzG‘Cu¼’tFeInfo64
(
uf
, &
fe_šfo
, 
f’ameTmp
, (f’ameTmp), 
NULL
, 0, NULL, 0);

107 ià(
”r
 !ğ
UNZ_OK
)

109 
	`TRACE
("”rÜ %d w™h zfš unzG‘Cu¼’tFeInfo\n", 
”r
);

110  
”r
;

112 
¡d
::
¡ršg
 
f’ame_šz
 = 
f’ameTmp
;

114 * 
buf
 = (*)
	`m®loc
(
WRITEBUFFERSIZE
);

115 ià(
buf
 =ğ
NULL
)

117 
	`TRACE
("Error‡llocating memory\n");

118  
UNZ_INTERNALERROR
;

121 
”r
 = 
	`unzO³nCu¼’tFePasswÜd
(
uf
, 
NULL
);

122 ià(
”r
 !ğ
UNZ_OK
)

124 
	`TRACE
("”rÜ %d w™h zfš unzO³nCu¼’tFePasswÜd\n", 
”r
);

127 
FILE
 *
fout
 = 
NULL
;

128 ià(
”r
 =ğ
UNZ_OK
)

130 
S¶™P©hD©a
 
d©a
;

131 
	`S¶™P©h
(
f’ame_šz
, 
d©a
);

132 
	`MakeDœeùÜy
(
d©a
.
·»Á_·th
);

134 
fout
 = 
	`FOPEN_FUNC
(
f’ame_šz
.
	`c_¡r
(), "wb");

136 ià(
fout
 =ğ
NULL
)

138 
	`TRACE
("”rÜ o³nšg %s\n", 
f’ame_šz
.
	`c_¡r
());

142 ià(
fout
 !ğ
NULL
)

144 
	`TRACE
("exŒaùšg: %s\n", 
f’ame_šz
.
	`c_¡r
());

148 
”r
 = 
	`unzR—dCu¼’tFe
(
uf
, 
buf
, 
WRITEBUFFERSIZE
);

149 ià(
”r
 < 0)

151 
	`TRACE
("”rÜ %d w™h zfš unzR—dCu¼’tFe\n", 
”r
);

154 ià(
”r
 > 0)

156 ià(
	`fwr™e
(
buf
, 
”r
, 1, 
fout
) != 1)

158 
	`TRACE
("error in writingƒxtracted file\n");

159 
”r
 = 
UNZ_ERRNO
;

164 
”r
 > 0);

166 ià(
fout
)

168 
	`fşo£
(
fout
);

171 ià(
”r
 == 0)

173 
	`chªge_fe_d©e
(
f’ame_šz
, 
fe_šfo
.
dosD©e
, fe_šfo.
tmu_d©e
);

177 ià(
”r
 =ğ
UNZ_OK
)

179 
”r
 = 
	`unzClo£Cu¼’tFe
(
uf
);

180 ià(
”r
 !ğ
UNZ_OK
)

182 
	`TRACE
("”rÜ %d w™h zfš unzClo£Cu¼’tFe\n",
”r
);

187 
	`unzClo£Cu¼’tFe
(
uf
);

190 
	`ä“
(
buf
);

191  
”r
;

192 
	}
}

194 
boŞ
 
	$do_exŒaù
(
unzFe
 
uf
)

196 
unz_glob®_šfo64
 
gi
;

198 
”r
 = 
	`unzG‘Glob®Info64
(
uf
, &
gi
);

199 ià(
”r
 !ğ
UNZ_OK
)

201 
	`TRACE
("”rÜ %d w™h zfš unzG‘Glob®InfØ\n", 
”r
);

202  
çl£
;

205 
uLÚg
 
i
 = 0; i < 
gi
.
numb”_’Œy
; i++)

207 ià(
	`do_exŒaù_cu¼’tfe
(
uf
è!ğ
UNZ_OK
)

209  
çl£
;

212 ià((
i
 + 1è< 
gi
.
numb”_’Œy
)

214 
”r
 = 
	`unzGoToNextFe
(
uf
);

215 ià(
”r
 !ğ
UNZ_OK
)

217 
	`TRACE
("”rÜ %d w™h zfš unzGoToNextFe\n", 
”r
);

218  
çl£
;

223  
Œue
;

224 
	}
}

226 
boŞ
 
	gSYSUTILS_SPACE
::
	$MšiUnz
(cÚ¡ 
¡d
::
¡ršg
& 
·ckName
, cÚ¡ std::¡ršg& 
de¡š©iÚ
)

228 
unzFe
 
uf
 = 
NULL
;

230 #ifdeà
USEWIN32IOAPI


231 
zlib_fefunc64_def
 
ffunc
;

232 
	`fl_wš32_fefunc64A
(&
ffunc
);

233 
uf
 = 
	`unzO³n2_64
(
·ckName
.
	`c_¡r
(), &
ffunc
);

235 
uf
 = 
	`unzO³n64
(
·ckName
.
	`c_¡r
());

238 ià(
uf
 =ğ
NULL
)

240 
	`TRACE
("CªnÙ o³À%s\n", 
·ckName
.
	`c_¡r
());

241  
Œue
;

243 
	`TRACE
("% İ’ed\n", 
·ckName
.
	`c_¡r
());

245 #ifdeà
_WIN32


246 ià(
	`_chdœ
(
de¡š©iÚ
.
	`c_¡r
()))

248 ià(
	`chdœ
(
de¡š©iÚ
.
	`c_¡r
()))

251 
	`TRACE
("E¼Ü chªgšg iÁØ%s,‡bÜtšg\n", 
de¡š©iÚ
.
	`c_¡r
());

252  
çl£
;

255 
boŞ
 
»tV®
 = 
	`do_exŒaù
(
uf
);

257 
	`unzClo£
(
uf
);

259  
»tV®
;

260 
	}
}

	@../minizip/minizip.cpp

15 #ià(!
defšed
(
_WIN32
)è&& (!defšed(
WIN32
)è&& (!defšed(
__APPLE__
))

16 #iâdeà
__USE_FILE_OFFSET64


17 
	#__USE_FILE_OFFSET64


	)

19 #iâdeà
__USE_LARGEFILE64


20 
	#__USE_LARGEFILE64


	)

22 #iâdeà
_LARGEFILE64_SOURCE


23 
	#_LARGEFILE64_SOURCE


	)

25 #iâdeà
_FILE_OFFSET_BIT


26 
	#_FILE_OFFSET_BIT
 64

	)

30 #ifdeà
__APPLE__


32 
	#FOPEN_FUNC
(
f’ame
, 
mode
è
	`fİ’
(f’ame, mode)

	)

33 
	#FTELLO_FUNC
(
¡»am
è
	`á–lo
(¡»am)

	)

34 
	#FSEEKO_FUNC
(
¡»am
, 
off£t
, 
Üigš
è
	`f£eko
(¡»am, off£t, origš)

	)

36 
	#FOPEN_FUNC
(
f’ame
, 
mode
è
	`fİ’64
(f’ame, mode)

	)

37 
	#FTELLO_FUNC
(
¡»am
è
	`á–lo64
(¡»am)

	)

38 
	#FSEEKO_FUNC
(
¡»am
, 
off£t
, 
Üigš
è
	`f£eko64
(¡»am, off£t, origš)

	)

41 
	~"z.h
"

43 #ifdeà
_WIN32


44 
	#USEWIN32IOAPI


	)

45 
	~"iowš32.h
"

47 
	~<sys/¡©.h
>

50 
	#WRITEBUFFERSIZE
 (16384)

	)

52 
	~"mšizUt™y.h
"

54 
	~"commÚ/fe.h
"

55 
	~"commÚ/dœeùÜy_Œav”£.h
"

57 
	~"debugMsg/Debug.h
"

59 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

61 #ifdeà
_WIN32


63 
uLÚg
 
	$f‘ime
(cÚ¡ 
¡d
::
¡ršg
& 
f
, 
tm_z
* 
tmz
, 
uLÚg
* 
dt
)

65 
»t
 = 0;

67 
FILETIME
 
áLoÿl
;

68 
HANDLE
 
hFšd
;

69 
WIN32_FIND_DATAA
 
ff32
;

71 
hFšd
 = 
	`FšdFœ¡FeA
(
f
.
	`c_¡r
(), &
ff32
);

72 ià(
hFšd
 !ğ
INVALID_HANDLE_VALUE
)

74 
	`FeTimeToLoÿlFeTime
(&(
ff32
.
áLa¡Wr™eTime
), &
áLoÿl
);

75 
	`FeTimeToDosD©eTime
(&
áLoÿl
,((
LPWORD
)
dt
) + 1,((LPWORD)dt) + 0);

76 
	`FšdClo£
(
hFšd
);

77 
»t
 = 1;

80  
»t
;

81 
	}
}

85 #ià(
defšed
(
__lšux__
)è|| (defšed(
__APPLE__
))

86 
uLÚg
 
	$f‘ime
(cÚ¡ 
¡d
::
¡ršg
& 
f
, 
tm_z
* 
tmz
, 
uLÚg
* 
dt
)

88 
»t
 = 0;

89 
¡©
 
s
;

90 
tm
* 
fed©e
;

91 
time_t
 
tm_t
 = 0;

93 ià(
	`¡©
(
f
.
	`c_¡r
(), &
s
) == 0)

95 
tm_t
 = 
s
.
¡_mtime
;

96 
»t
 = 1;

98 
fed©e
 = 
	`loÿÉime
(&
tm_t
);

100 
tmz
->
tm_£c
 = 
fed©e
->tm_sec;

101 
tmz
->
tm_mš
 = 
fed©e
->tm_min;

102 
tmz
->
tm_hour
 = 
fed©e
->tm_hour;

103 
tmz
->
tm_mday
 = 
fed©e
->tm_mday;

104 
tmz
->
tm_mÚ
 = 
fed©e
->tm_mon ;

105 
tmz
->
tm_y—r
 = 
fed©e
->tm_year;

107  
»t
;

108 
	}
}

110 
uLÚg
 
	$f‘ime
(cÚ¡ 
¡d
::
¡ršg
& 
f
, 
tm_z
* 
tmz
, 
uLÚg
* 
dt
)

113 
	}
}

118 
	$isL¬geFe
(cÚ¡ 
¡d
::
¡ršg
& 
f’ame
)

120 ià(
	`G‘FeStÜageSize
(
f’ame
) >= 0xffffffff)

128 
	}
}

130 
ExŒaùAÎFes
(cÚ¡ 
¡d
::
¡ršg
& 
dœeùÜy
, std::
veùÜ
<¡d::¡ršg>& 
fes
)

132 
fes
.
ş—r
();

134 
DœeùÜyT¿v”£
 
dt
(
dœeùÜy
);

136 
	gdt
.
Next
())

138 ià(
	gdt
.
G‘FÏgs
(è& 
	gDœeùÜyT¿v”£
::
FLAG_DIRECTORY
)

140 
¡d
::
veùÜ
<¡d::
¡ršg
> 
s_fes
;

141 
ExŒaùAÎFes
(
dt
.
G‘P©hName
(), 
s_fes
);

142 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
 = 
s_fes
.
begš
(); 
	g™
 !ğs_fes.
’d
(); it++)

144 
	gfes
.
push_back
(*
™
);

147 ià(
	gdt
.
G‘FÏgs
(è& 
	gDœeùÜyT¿v”£
::
FLAG_FILE
)

149 
fes
.
push_back
(
dt
.
G‘P©hName
());

154 
ExŒaùAÎFes
(cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
dœeùÜ›s
, std::veùÜ<¡d::¡ršg>& 
fes
)

156 
fes
.
ş—r
();

158 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
™
 = 
dœeùÜ›s
.
begš
(); 
	g™
 !ğdœeùÜ›s.
’d
(); it++)

160 
DœeùÜyT¿v”£
 
dt
(*
™
);

162 
	gdt
.
Next
())

164 ià(
	gdt
.
G‘FÏgs
(è& 
	gDœeùÜyT¿v”£
::
FLAG_DIRECTORY
)

166 
¡d
::
veùÜ
<¡d::
¡ršg
> 
s_fes
;

167 
ExŒaùAÎFes
(
dt
.
G‘P©hName
(), 
s_fes
);

168 
ušt32_t
 
	gi
 = 0; i < 
	gs_fes
.
size
(); i++)

170 
	gfes
.
push_back
(
s_fes
[
i
]);

173 ià(
	gdt
.
G‘FÏgs
(è& 
	gDœeùÜyT¿v”£
::
FLAG_FILE
)

175 
fes
.
push_back
(
dt
.
G‘P©hName
());

181 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
MšiZ
(cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
dœeùÜ›s
, cÚ¡ std::¡ršg& 
·ckName
)

183 
¡d
::
veùÜ
<¡d::
¡ršg
> 
fes
;

184 
ExŒaùAÎFes
(
dœeùÜ›s
, 
fes
);

186 
	g”r
 = 
ZIP_OK
;

188 
zFe
 
	gzf
;

189 #ifdeà
USEWIN32IOAPI


190 
zlib_fefunc64_def
 
	gffunc
;

191 
fl_wš32_fefunc64A
(&
ffunc
);

192 
	gzf
 = 
zO³n2_64
(
·ckName
.
c_¡r
(), 0, 
NULL
, &
ffunc
);

194 
	gzf
 = 
zO³n64
(
·ckName
.
c_¡r
(), 0);

197 ià(
	gzf
 =ğ
NULL
)

199 
TRACE
("”rÜ o³nšg %s\n", 
·ckName
.
c_¡r
());

200 
	g”r
 = 
ZIP_ERRNO
;

204 
TRACE
("ü—tšg %s\n", 
·ckName
.
c_¡r
());

207 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
™
 = 
fes
.
begš
(); 
	g™
 !ğfes.
’d
(); it++)

209 
FILE
* 
	gfš
 = 
NULL
;

210 
	g¡d
::
¡ršg
 
f’amešz
 = *
™
;

214 
	g¡d
::
¡ršg
 
§vef’amešz
 = *
™
;

215 
	g§vef’amešz
.
©
(0è=ğ'\\' || 
§vef’amešz
.at(0) == '/')

217 
§vef’amešz
 = savef’amešz.
c_¡r
() + 1;

220 
z_fešfo
 
	gzi
;

221 
	gzi
.
	gtmz_d©e
.
	gtm_£c
 = 
zi
.
tmz_d©e
.
tm_mš
 = zi.tmz_d©e.
tm_hour
 =

222 
zi
.
tmz_d©e
.
tm_mday
 = zi.tmz_d©e.
tm_mÚ
 = zi.tmz_d©e.
tm_y—r
 = 0;

223 
	gzi
.
	gdosD©e
 = 0;

224 
	gzi
.
	gš‹º®_ç
 = 0;

225 
	gzi
.
	gex‹º®_ç
 = 0;

226 
f‘ime
(
f’amešz
, &
zi
.
tmz_d©e
, &zi.
dosD©e
);

228 
	gz64
 = 
isL¬geFe
(
f’amešz
);

230 
	g”r
 = 
zO³nNewFeInZ3_64
(
zf
, 
§vef’amešz
.
c_¡r
(), &
zi
, 
NULL
, 0, NULL, 0, NULL, 
Z_DEFLATED
,

231 
Z_DEFAULT_COMPRESSION
, 0, -
MAX_WBITS
, 
DEF_MEM_LEVEL
, 
Z_DEFAULT_STRATEGY
, 
NULL
, 0, 
z64
);

233 ià(
	g”r
 !ğ
ZIP_OK
)

235 
TRACE
("”rÜ iÀİ’šg % š zfe\n", 
f’amešz
.
c_¡r
());

239 
	gfš
 = 
FOPEN_FUNC
(
f’amešz
.
c_¡r
(), "rb");

240 ià(
	gfš
 =ğ
NULL
)

242 
”r
 = 
ZIP_ERRNO
;

243 
TRACE
("”rÜ iÀİ’šg % fÜ„—dšg\n", 
f’amešz
.
c_¡r
());

247 
ušt32_t
 
	gfeSize
 = (ušt32_t)
G‘FeStÜageSize
(
f’amešz
);

248 * 
	gbuf
 = (*)
m®loc
(
feSize
);

250 ià(
	g”r
 =ğ
ZIP_OK
)

252 
ušt32_t
 
size_»ad
 = (ušt32_t)
ä—d
(
buf
, 1, 
feSize
, 
fš
);

253 ià(
	gsize_»ad
 =ğ
feSize
)

255 
”r
 = 
zWr™eInFeInZ
(
zf
, 
buf
, 
size_»ad
);

256 ià(
	g”r
 < 0)

258 
TRACE
("”rÜ iÀwr™šg % šhzfe\n", 
f’amešz
.
c_¡r
());

263 
ä“
(
buf
);

265 ià(
	gfš
)

267 
fşo£
(
fš
);

270 ià(
	g”r
 < 0)

272 
	g”r
 = 
ZIP_ERRNO
;

276 
	g”r
 = 
zClo£FeInZ
(
zf
);

277 ià(
	g”r
 !ğ
ZIP_OK
)

279 
TRACE
("”rÜ iÀşosšg % šhzfe\n", 
f’amešz
.
c_¡r
());

284 ià(
zClo£
(
zf
, 
NULL
è!ğ
ZIP_OK
)

286 
TRACE
("”rÜ iÀşosšg %s\n", 
·ckName
.
c_¡r
());

289  
	gŒue
;

	@../minizip/minizipUtility.h

1 #iâdeà
__SYSUTILS_MINIZIP_UTILITY_H__


2 
	#__SYSUTILS_MINIZIP_UTILITY_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~<¡ršg
>

9 
	~<veùÜ
>

11 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

13 
DLL_PUBLIC
 
boŞ
 
MšiZ
(cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
dœeùÜ›s
, cÚ¡ std::¡ršg& 
·ckName
);

15 
DLL_PUBLIC
 
boŞ
 
MšiUnz
(cÚ¡ 
¡d
::
¡ršg
& 
·ckName
, cÚ¡ std::¡ršg& 
de¡š©iÚ
);

	@../minizip/mztools.h

7 #iâdeà
_z_toŞs_H


8 
	#_z_toŞs_H


	)

10 #ifdeà
__ılu¥lus


14 #iâdeà
_ZLIB_H


15 
	~"zlib.h
"

18 
	~"unz.h
"

25 
ZEXPORT
 
unzR•aœ
(cÚ¡ * 
fe
,

26 cÚ¡ * 
feOut
,

27 cÚ¡ * 
feOutTmp
,

28 
uLÚg
* 
nRecov”ed
,

29 
uLÚg
* 
by‹sRecov”ed
);

32 #ifdeà
__ılu¥lus


	@../minizip/unzip.h

43 #iâdeà
_unz64_H


44 
	#_unz64_H


	)

46 #ifdeà
__ılu¥lus


50 #iâdeà
_ZLIB_H


51 
	~"zlib.h
"

54 #iâdeà 
_ZLIBIOAPI_H


55 
	~"ißpi.h
"

58 #ifdeà
HAVE_BZIP2


59 
	~"bzlib.h
"

62 
	#Z_BZIP2ED
 12

	)

64 #ià
defšed
(
STRICTUNZIP
è|| defšed(
STRICTZIPUNZIP
)

67 
	sTagunzFe__
 { 
unu£d
; } 
	tunzFe__
;

68 
unzFe__
 *
	tunzFe
;

70 
voidp
 
	tunzFe
;

74 
	#UNZ_OK
 (0)

	)

75 
	#UNZ_END_OF_LIST_OF_FILE
 (-100)

	)

76 
	#UNZ_ERRNO
 (
Z_ERRNO
)

	)

77 
	#UNZ_EOF
 (0)

	)

78 
	#UNZ_PARAMERROR
 (-102)

	)

79 
	#UNZ_BADZIPFILE
 (-103)

	)

80 
	#UNZ_INTERNALERROR
 (-104)

	)

81 
	#UNZ_CRCERROR
 (-105)

	)

84 
	stm_unz_s


86 
uIÁ
 
tm_£c
;

87 
uIÁ
 
tm_mš
;

88 
uIÁ
 
tm_hour
;

89 
uIÁ
 
tm_mday
;

90 
uIÁ
 
tm_mÚ
;

91 
uIÁ
 
tm_y—r
;

92 } 
	ttm_unz
;

96 
	sunz_glob®_šfo64_s


98 
ZPOS64_T
 
numb”_’Œy
;

100 
uLÚg
 
size_comm’t
;

101 } 
	tunz_glob®_šfo64
;

103 
	sunz_glob®_šfo_s


105 
uLÚg
 
numb”_’Œy
;

107 
uLÚg
 
size_comm’t
;

108 } 
	tunz_glob®_šfo
;

111 
	sunz_fe_šfo64_s


113 
uLÚg
 
v”siÚ
;

114 
uLÚg
 
v”siÚ_Ãeded
;

115 
uLÚg
 
æag
;

116 
uLÚg
 
com´essiÚ_m‘hod
;

117 
uLÚg
 
dosD©e
;

118 
uLÚg
 
üc
;

119 
ZPOS64_T
 
com´es£d_size
;

120 
ZPOS64_T
 
uncom´es£d_size
;

121 
uLÚg
 
size_f’ame
;

122 
uLÚg
 
size_fe_exŒa
;

123 
uLÚg
 
size_fe_comm’t
;

125 
uLÚg
 
disk_num_¡¬t
;

126 
uLÚg
 
š‹º®_ç
;

127 
uLÚg
 
ex‹º®_ç
;

129 
tm_unz
 
tmu_d©e
;

130 } 
	tunz_fe_šfo64
;

132 
	sunz_fe_šfo_s


134 
uLÚg
 
v”siÚ
;

135 
uLÚg
 
v”siÚ_Ãeded
;

136 
uLÚg
 
æag
;

137 
uLÚg
 
com´essiÚ_m‘hod
;

138 
uLÚg
 
dosD©e
;

139 
uLÚg
 
üc
;

140 
uLÚg
 
com´es£d_size
;

141 
uLÚg
 
uncom´es£d_size
;

142 
uLÚg
 
size_f’ame
;

143 
uLÚg
 
size_fe_exŒa
;

144 
uLÚg
 
size_fe_comm’t
;

146 
uLÚg
 
disk_num_¡¬t
;

147 
uLÚg
 
š‹º®_ç
;

148 
uLÚg
 
ex‹º®_ç
;

150 
tm_unz
 
tmu_d©e
;

151 } 
	tunz_fe_šfo
;

153 
ZEXPORT
 
unzSŒšgFeNameCom·»
 
OF
 ((cÚ¡ * 
feName1
,

154 cÚ¡ * 
feName2
,

155 
iCa£S’s™iv™y
));

166 
unzFe
 
ZEXPORT
 
unzO³n
 
OF
((cÚ¡ *
·th
));

167 
unzFe
 
ZEXPORT
 
unzO³n64
 
OF
((cÚ¡ *
·th
));

184 
unzFe
 
ZEXPORT
 
unzO³n2
 
OF
((cÚ¡ *
·th
,

185 
zlib_fefunc_def
* 
pzlib_fefunc_def
));

191 
unzFe
 
ZEXPORT
 
unzO³n2_64
 
OF
((cÚ¡ *
·th
,

192 
zlib_fefunc64_def
* 
pzlib_fefunc_def
));

198 
ZEXPORT
 
unzClo£
 
OF
((
unzFe
 
fe
));

205 
ZEXPORT
 
unzG‘Glob®Info
 
OF
((
unzFe
 
fe
,

206 
unz_glob®_šfo
 *
pglob®_šfo
));

208 
ZEXPORT
 
unzG‘Glob®Info64
 
OF
((
unzFe
 
fe
,

209 
unz_glob®_šfo64
 *
pglob®_šfo
));

216 
ZEXPORT
 
unzG‘Glob®Comm’t
 
OF
((
unzFe
 
fe
,

217 *
szComm’t
,

218 
uLÚg
 
uSizeBuf
));

229 
ZEXPORT
 
unzGoToFœ¡Fe
 
OF
((
unzFe
 
fe
));

235 
ZEXPORT
 
unzGoToNextFe
 
OF
((
unzFe
 
fe
));

242 
ZEXPORT
 
unzLoÿ‹Fe
 
OF
((
unzFe
 
fe
,

243 cÚ¡ *
szFeName
,

244 
iCa£S’s™iv™y
));

258 
	sunz_fe_pos_s


260 
uLÚg
 
	gpos_š_z_dœeùÜy
;

261 
uLÚg
 
	gnum_of_fe
;

262 } 
	tunz_fe_pos
;

264 
ZEXPORT
 
unzG‘FePos
(

265 
unzFe
 
fe
,

266 
unz_fe_pos
* 
fe_pos
);

268 
ZEXPORT
 
unzGoToFePos
(

269 
unzFe
 
fe
,

270 
unz_fe_pos
* 
fe_pos
);

272 
	sunz64_fe_pos_s


274 
ZPOS64_T
 
	gpos_š_z_dœeùÜy
;

275 
ZPOS64_T
 
	gnum_of_fe
;

276 } 
	tunz64_fe_pos
;

278 
ZEXPORT
 
unzG‘FePos64
(

279 
unzFe
 
fe
,

280 
unz64_fe_pos
* 
fe_pos
);

282 
ZEXPORT
 
unzGoToFePos64
(

283 
unzFe
 
fe
,

284 cÚ¡ 
unz64_fe_pos
* 
fe_pos
);

288 
ZEXPORT
 
unzG‘Cu¼’tFeInfo64
 
OF
((
unzFe
 
fe
,

289 
unz_fe_šfo64
 *
pfe_šfo
,

290 *
szFeName
,

291 
uLÚg
 
feNameBufãrSize
,

292 *
exŒaF›ld
,

293 
uLÚg
 
exŒaF›ldBufãrSize
,

294 *
szComm’t
,

295 
uLÚg
 
comm’tBufãrSize
));

297 
ZEXPORT
 
unzG‘Cu¼’tFeInfo
 
OF
((
unzFe
 
fe
,

298 
unz_fe_šfo
 *
pfe_šfo
,

299 *
szFeName
,

300 
uLÚg
 
feNameBufãrSize
,

301 *
exŒaF›ld
,

302 
uLÚg
 
exŒaF›ldBufãrSize
,

303 *
szComm’t
,

304 
uLÚg
 
comm’tBufãrSize
));

321 
ZPOS64_T
 
ZEXPORT
 
unzG‘Cu¼’tFeZSŒ—mPos64
 
OF
((
unzFe
 
fe
));

331 
ZEXPORT
 
unzO³nCu¼’tFe
 
OF
((
unzFe
 
fe
));

337 
ZEXPORT
 
unzO³nCu¼’tFePasswÜd
 
OF
((
unzFe
 
fe
,

338 cÚ¡ * 
·sswÜd
));

345 
ZEXPORT
 
unzO³nCu¼’tFe2
 
OF
((
unzFe
 
fe
,

346 * 
m‘hod
,

347 * 
Ëv–
,

348 
¿w
));

358 
ZEXPORT
 
unzO³nCu¼’tFe3
 
OF
((
unzFe
 
fe
,

359 * 
m‘hod
,

360 * 
Ëv–
,

361 
¿w
,

362 cÚ¡ * 
·sswÜd
));

373 
ZEXPORT
 
unzClo£Cu¼’tFe
 
OF
((
unzFe
 
fe
));

379 
ZEXPORT
 
unzR—dCu¼’tFe
 
OF
((
unzFe
 
fe
,

380 
voidp
 
buf
,

381 
Ën
));

393 
z_off_t
 
ZEXPORT
 
unz‹Î
 
OF
((
unzFe
 
fe
));

395 
ZPOS64_T
 
ZEXPORT
 
unz‹Î64
 
OF
((
unzFe
 
fe
));

400 
ZEXPORT
 
unzeof
 
OF
((
unzFe
 
fe
));

405 
ZEXPORT
 
unzG‘LoÿlExŒaf›ld
 
OF
((
unzFe
 
fe
,

406 
voidp
 
buf
,

407 
Ën
));

424 
ZPOS64_T
 
ZEXPORT
 
unzG‘Off£t64
 (
unzFe
 
fe
);

425 
uLÚg
 
ZEXPORT
 
unzG‘Off£t
 (
unzFe
 
fe
);

428 
ZEXPORT
 
unzS‘Off£t64
 (
unzFe
 
fe
, 
ZPOS64_T
 
pos
);

429 
ZEXPORT
 
unzS‘Off£t
 (
unzFe
 
fe
, 
uLÚg
 
pos
);

433 #ifdeà
__ılu¥lus


	@../minizip/zip.h

40 #iâdeà
_z12_H


41 
	#_z12_H


	)

43 #ifdeà
__ılu¥lus


49 #iâdeà
_ZLIB_H


50 
	~"zlib.h
"

53 #iâdeà
_ZLIBIOAPI_H


54 
	~"ißpi.h
"

57 #ifdeà
HAVE_BZIP2


58 
	~"bzlib.h
"

61 
	#Z_BZIP2ED
 12

	)

63 #ià
defšed
(
STRICTZIP
è|| defšed(
STRICTZIPUNZIP
)

66 
	sTagzFe__
 { 
unu£d
; } 
	tzFe__
;

67 
zFe__
 *
	tzFe
;

69 
voidp
 
	tzFe
;

72 
	#ZIP_OK
 (0)

	)

73 
	#ZIP_EOF
 (0)

	)

74 
	#ZIP_ERRNO
 (
Z_ERRNO
)

	)

75 
	#ZIP_PARAMERROR
 (-102)

	)

76 
	#ZIP_BADZIPFILE
 (-103)

	)

77 
	#ZIP_INTERNALERROR
 (-104)

	)

79 #iâdeà
DEF_MEM_LEVEL


80 #ià
MAX_MEM_LEVEL
 >= 8

81 
	#DEF_MEM_LEVEL
 8

	)

83 
	#DEF_MEM_LEVEL
 
MAX_MEM_LEVEL


	)

89 
	stm_z_s


91 
uIÁ
 
tm_£c
;

92 
uIÁ
 
tm_mš
;

93 
uIÁ
 
tm_hour
;

94 
uIÁ
 
tm_mday
;

95 
uIÁ
 
tm_mÚ
;

96 
uIÁ
 
tm_y—r
;

97 } 
	ttm_z
;

101 
tm_z
 
tmz_d©e
;

102 
uLÚg
 
dosD©e
;

105 
uLÚg
 
š‹º®_ç
;

106 
uLÚg
 
ex‹º®_ç
;

107 } 
	tz_fešfo
;

109 cÚ¡ * 
	tzch¬pc
;

112 
	#APPEND_STATUS_CREATE
 (0)

	)

113 
	#APPEND_STATUS_CREATEAFTER
 (1)

	)

114 
	#APPEND_STATUS_ADDINZIP
 (2)

	)

116 
zFe
 
ZEXPORT
 
zO³n
 
OF
((cÚ¡ *
·thÇme
, 
­³nd
));

117 
zFe
 
ZEXPORT
 
zO³n64
 
OF
((cÚ¡ *
·thÇme
, 
­³nd
));

137 
zFe
 
ZEXPORT
 
zO³n2
 
OF
((cÚ¡ *
·thÇme
,

138 
­³nd
,

139 
zch¬pc
* 
glob®comm’t
,

140 
zlib_fefunc_def
* 
pzlib_fefunc_def
));

142 
zFe
 
ZEXPORT
 
zO³n2_64
 
OF
((cÚ¡ *
·thÇme
,

143 
­³nd
,

144 
zch¬pc
* 
glob®comm’t
,

145 
zlib_fefunc64_def
* 
pzlib_fefunc_def
));

147 
ZEXPORT
 
zO³nNewFeInZ
 
OF
((
zFe
 
fe
,

148 cÚ¡ * 
f’ame
,

149 cÚ¡ 
z_fešfo
* 
zfi
,

150 cÚ¡ * 
exŒaf›ld_loÿl
,

151 
uIÁ
 
size_exŒaf›ld_loÿl
,

152 cÚ¡ * 
exŒaf›ld_glob®
,

153 
uIÁ
 
size_exŒaf›ld_glob®
,

154 cÚ¡ * 
comm’t
,

155 
m‘hod
,

156 
Ëv–
));

158 
ZEXPORT
 
zO³nNewFeInZ64
 
OF
((
zFe
 
fe
,

159 cÚ¡ * 
f’ame
,

160 cÚ¡ 
z_fešfo
* 
zfi
,

161 cÚ¡ * 
exŒaf›ld_loÿl
,

162 
uIÁ
 
size_exŒaf›ld_loÿl
,

163 cÚ¡ * 
exŒaf›ld_glob®
,

164 
uIÁ
 
size_exŒaf›ld_glob®
,

165 cÚ¡ * 
comm’t
,

166 
m‘hod
,

167 
Ëv–
,

168 
z64
));

187 
ZEXPORT
 
zO³nNewFeInZ2
 
OF
((
zFe
 
fe
,

188 cÚ¡ * 
f’ame
,

189 cÚ¡ 
z_fešfo
* 
zfi
,

190 cÚ¡ * 
exŒaf›ld_loÿl
,

191 
uIÁ
 
size_exŒaf›ld_loÿl
,

192 cÚ¡ * 
exŒaf›ld_glob®
,

193 
uIÁ
 
size_exŒaf›ld_glob®
,

194 cÚ¡ * 
comm’t
,

195 
m‘hod
,

196 
Ëv–
,

197 
¿w
));

200 
ZEXPORT
 
zO³nNewFeInZ2_64
 
OF
((
zFe
 
fe
,

201 cÚ¡ * 
f’ame
,

202 cÚ¡ 
z_fešfo
* 
zfi
,

203 cÚ¡ * 
exŒaf›ld_loÿl
,

204 
uIÁ
 
size_exŒaf›ld_loÿl
,

205 cÚ¡ * 
exŒaf›ld_glob®
,

206 
uIÁ
 
size_exŒaf›ld_glob®
,

207 cÚ¡ * 
comm’t
,

208 
m‘hod
,

209 
Ëv–
,

210 
¿w
,

211 
z64
));

216 
ZEXPORT
 
zO³nNewFeInZ3
 
OF
((
zFe
 
fe
,

217 cÚ¡ * 
f’ame
,

218 cÚ¡ 
z_fešfo
* 
zfi
,

219 cÚ¡ * 
exŒaf›ld_loÿl
,

220 
uIÁ
 
size_exŒaf›ld_loÿl
,

221 cÚ¡ * 
exŒaf›ld_glob®
,

222 
uIÁ
 
size_exŒaf›ld_glob®
,

223 cÚ¡ * 
comm’t
,

224 
m‘hod
,

225 
Ëv–
,

226 
¿w
,

227 
wšdowB™s
,

228 
memLev–
,

229 
¡¿‹gy
,

230 cÚ¡ * 
·sswÜd
,

231 
uLÚg
 
ücFÜCry±šg
));

233 
ZEXPORT
 
zO³nNewFeInZ3_64
 
OF
((
zFe
 
fe
,

234 cÚ¡ * 
f’ame
,

235 cÚ¡ 
z_fešfo
* 
zfi
,

236 cÚ¡ * 
exŒaf›ld_loÿl
,

237 
uIÁ
 
size_exŒaf›ld_loÿl
,

238 cÚ¡ * 
exŒaf›ld_glob®
,

239 
uIÁ
 
size_exŒaf›ld_glob®
,

240 cÚ¡ * 
comm’t
,

241 
m‘hod
,

242 
Ëv–
,

243 
¿w
,

244 
wšdowB™s
,

245 
memLev–
,

246 
¡¿‹gy
,

247 cÚ¡ * 
·sswÜd
,

248 
uLÚg
 
ücFÜCry±šg
,

249 
z64


259 
ZEXPORT
 
zO³nNewFeInZ4
 
OF
((
zFe
 
fe
,

260 cÚ¡ * 
f’ame
,

261 cÚ¡ 
z_fešfo
* 
zfi
,

262 cÚ¡ * 
exŒaf›ld_loÿl
,

263 
uIÁ
 
size_exŒaf›ld_loÿl
,

264 cÚ¡ * 
exŒaf›ld_glob®
,

265 
uIÁ
 
size_exŒaf›ld_glob®
,

266 cÚ¡ * 
comm’t
,

267 
m‘hod
,

268 
Ëv–
,

269 
¿w
,

270 
wšdowB™s
,

271 
memLev–
,

272 
¡¿‹gy
,

273 cÚ¡ * 
·sswÜd
,

274 
uLÚg
 
ücFÜCry±šg
,

275 
uLÚg
 
v”siÚMadeBy
,

276 
uLÚg
 
æagBa£


280 
ZEXPORT
 
zO³nNewFeInZ4_64
 
OF
((
zFe
 
fe
,

281 cÚ¡ * 
f’ame
,

282 cÚ¡ 
z_fešfo
* 
zfi
,

283 cÚ¡ * 
exŒaf›ld_loÿl
,

284 
uIÁ
 
size_exŒaf›ld_loÿl
,

285 cÚ¡ * 
exŒaf›ld_glob®
,

286 
uIÁ
 
size_exŒaf›ld_glob®
,

287 cÚ¡ * 
comm’t
,

288 
m‘hod
,

289 
Ëv–
,

290 
¿w
,

291 
wšdowB™s
,

292 
memLev–
,

293 
¡¿‹gy
,

294 cÚ¡ * 
·sswÜd
,

295 
uLÚg
 
ücFÜCry±šg
,

296 
uLÚg
 
v”siÚMadeBy
,

297 
uLÚg
 
æagBa£
,

298 
z64


307 
ZEXPORT
 
zWr™eInFeInZ
 
OF
((
zFe
 
fe
,

308 cÚ¡ * 
buf
,

309 
Ën
));

314 
ZEXPORT
 
zClo£FeInZ
 
OF
((
zFe
 
fe
));

319 
ZEXPORT
 
zClo£FeInZRaw
 
OF
((
zFe
 
fe
,

320 
uLÚg
 
uncom´es£d_size
,

321 
uLÚg
 
üc32
));

323 
ZEXPORT
 
zClo£FeInZRaw64
 
OF
((
zFe
 
fe
,

324 
ZPOS64_T
 
uncom´es£d_size
,

325 
uLÚg
 
üc32
));

333 
ZEXPORT
 
zClo£
 
OF
((
zFe
 
fe
,

334 cÚ¡ * 
glob®_comm’t
));

340 
ZEXPORT
 
zRemoveExŒaInfoBlock
 
OF
((* 
pD©a
, * 
d©aL’
, 
sH—d”
));

358 #ifdeà
__ılu¥lus


	@../platform/check_utils.cpp

1 
	~"´oc_ıušfo.h
"

2 
	~"sys_dmi.h
"

3 
	~"check_uts.h
"

4 
	~"¶©fÜm_¥ec.h
"

6 
	~<¡dio.h
>

7 
	~<¡ršg.h
>

9 
	#NUUO_PLATFORM_CONF_PATTERN
 "%255[^\t,],%255[^\t,],%255[^\t,],%255[^\t,],%255[^\t,],%d\n"

	)

11 
	#COMPARE_PRODUCT_NAME
(
rg‘
, 
»t
) \

12 ià(0 =ğ
	`¡ºcmp
(
´oduù_Çme
, \

13 
PLATFORM_PRODUCT_NAME_
##
rg‘
, \

14 
	`¡¾’
(
PLATFORM_PRODUCT_NAME_
##
rg‘
))) { \

15  
CRYSTAL_PLATFORM_
##
»t
; \

16 }

	)

18 
	#COMPARE_BOARD_NAME
(
rg‘
, 
»t
) \

19 ià(0 =ğ
	`¡ºcmp
(
bßrd_Çme
, \

20 
PLATFORM_BOARD_NAME_
##
rg‘
, \

21 (
PLATFORM_BOARD_NAME_
##
rg‘
))) { \

22  
CRYSTAL_PLATFORM_
##
»t
; \

23 }

	)

25 
	#COMPARE_CPU_VERSION_NAME
(
rg‘
, 
Ën
, 
»t
) \

26 ià(0 =ğ
	`¡ºcmp
(
ıu_Çme
, 
PLATFORM_CPU_VERSION_
#rg‘, 
Ën
)) { \

27  
CRYSTAL_PLATFORM_
##
»t
; \

28 }

	)

30 
	#COMPARE_SYSTEM_INFO
(
rg‘
) \

31 ià(0 !ğ
	`¡ºcmp
(
šfo
->
rg‘
, 
PLATFORM_INFO_EMPTY
, 
	`¡¾’
(PLATFORM_INFO_EMPTY)) && \

32 0 =ğ
	`¡ºcmp
(
šfo
->
rg‘
, 
šfo_äom_fe
.rg‘, 
	`¡¾’
(info_from_file.target))) { \

33 
	`memıy
(
šfo
, &
šfo_äom_fe
, (
¶©_šfo
)); \

34 
	`fşo£
(
å
); \

35  
šfo_äom_fe
.
¶©_id
; \

36 }

	)

38 
	$CheckPÏtfÜmCÚf
(
¶©_šfo
 *
šfo
)

40 
FILE
 *
å
 = 
	`fİ’
("/lib/udev/.nuuo_platform.conf", "r");

41 
¶©_šfo
 
šfo_äom_fe
;

42 
lše
[1024];

44 ià(
å
 =ğ
NULL
 || 
šfo
 == NULL)

45  
CRYSTAL_PLATFORM_UNKNOWN
;

47 
	`fsÿnf
(
å
, "%1023[^\n]\n", 
lše
è!ğ
EOF
) {

48 ià(
lše
[0] == '#') {

52 
	`ssÿnf
(
lše
, 
NUUO_PLATFORM_CONF_PATTERN
,

53 
šfo_äom_fe
.
mod–_ty³
,

54 
šfo_äom_fe
.
´oduù_Çme
,

55 
šfo_äom_fe
.
bßrd_Çme
,

56 
šfo_äom_fe
.
ıu_Çme
,

57 
šfo_äom_fe
.
¶©_fe_Çme
,

58 &
šfo_äom_fe
.
¶©_id


61 
	`COMPARE_SYSTEM_INFO
(
´oduù_Çme
);

62 
	`COMPARE_SYSTEM_INFO
(
bßrd_Çme
);

63 
	`COMPARE_SYSTEM_INFO
(
ıu_Çme
);

66 
	`fşo£
(
å
);

67  
CRYSTAL_PLATFORM_UNKNOWN
;

68 
	}
}

70 
	$G‘Cry¡®PÏtfÜmInfo
(
¶©_šfo
 *
šfo
)

72 
¶©_šfo
 
loÿl_šfo
;

73 
¶©_šfo
 *
¶oÿl_šfo
 = 
šfo
;

75 ià(
šfo
 =ğ
NULL
) {

76 
¶oÿl_šfo
 = &
loÿl_šfo
;

79 
	`G‘DMIInfoProduùName
(
¶oÿl_šfo
->
´oduù_Çme
, 255);

80 
	`G‘DMIInfoBßrdName
(
¶oÿl_šfo
->
bßrd_Çme
, 255);

81 
	`G‘CPUMod–Name
(
¶oÿl_šfo
->
ıu_Çme
, 255);

83  
	`CheckPÏtfÜmCÚf
(
¶oÿl_šfo
);

84 
	}
}

86 
	$G‘Cry¡®PÏtfÜm
()

88 
¶©_šfo
 
šfo
;

89 
´oduù_Çme
[255];

90 
bßrd_Çme
[255];

91 
ıu_Çme
[255];

93 
	`G‘DMIInfoProduùName
(
´oduù_Çme
, (product_name));

94 
	`COMPARE_PRODUCT_NAME
(
MN525MI
, 
R1
);

95 
	`COMPARE_PRODUCT_NAME
(
MN525RI_SI
, 
R1
);

96 
	`COMPARE_PRODUCT_NAME
(
MZJ19AI
, 
R1_MZJ19AI
);

97 
	`COMPARE_PRODUCT_NAME
(
VMWARE
, 
VM
);

99 
	`G‘DMIInfoBßrdName
(
bßrd_Çme
, (board_name));

100 
	`COMPARE_BOARD_NAME
(
G1SA
, 16BA
Y_G1SA
);

102 ià(0 =ğ
	`¡ºcmp
(
´oduù_Çme
,

103 
PLATFORM_PRODUCT_NAME_AIMB_581
,

104 (
PLATFORM_PRODUCT_NAME_AIMB_581
))) {

105 
	`G‘CPUMod–Name
(
ıu_Çme
, (cpu_name));

106 iàĞ0 =ğ
	`¡ºcmp
(
ıu_Çme
, 
PLATFORM_CPU_VERSION_AIMB_581
, 20)) {

107  
CRYSTAL_PLATFORM_R2_581
;

111 
	`¡ºıy
(
šfo
.
´oduù_Çme
,…roduct_name, 255);

112 
	`¡ºıy
(
šfo
.
bßrd_Çme
, board_name, 255);

113 
	`¡ºıy
(
šfo
.
ıu_Çme
, cpu_name, 255);

114  
	`CheckPÏtfÜmCÚf
(&
šfo
);

115 
	}
}

	@../platform/get_system_info.cpp

1 
	~"g‘_sy¡em_šfo.h
"

2 
	~"¶©fÜm_¥ec.h
"

4 
	~<¡dio.h
>

5 
	~<¡ršg.h
>

7 
	$G‘Sy¡emTem³¿tu»
(
sy¡em_‹mps
 *
¡
)

9 
çncÚŒŞ_¥ec
 
¥ec
;

10 
	`G‘FªcÚŒŞS³c
(&
¥ec
);

12 
¡
->
ıu
 = 0;

13 
¡
->
sy¡em
 = 0;

14 
¡
->
v®id_ıu
 = 
çl£
;

15 
¡
->
v®id_sy¡em
ğ
çl£
;

17 ià(
¥ec
.
devÇme
 != "impi") {

18 
FILE
 *
å
 = 
	`fİ’
(
¥ec
.
ıu‹mps
.
	`c_¡r
(), "r");

19 ià(
NULL
 !ğ
å
) {

20 
	`fsÿnf
(
å
, "%d", &(
¡
->
ıu
));

21 
	`fşo£
(
å
);

22 
å
 = 
NULL
;

23 
¡
->
v®id_ıu
 = 
Œue
;

26 
å
 = 
	`fİ’
(
¥ec
.
fùemps
.
	`c_¡r
(), "r");

27 ià(
NULL
 !ğ
å
) {

28 
	`fsÿnf
(
å
, "%d", &(
¡
->
sy¡em
));

29 
	`fşo£
(
å
);

30 
å
 = 
NULL
;

31 
¡
->
v®id_sy¡em
 = 
Œue
;

36 
	}
}

38 
	$G‘Sy¡emFªS³ed
(
sy¡em_çn_¥“ds
 *
sfs
)

40 
çncÚŒŞ_¥ec
 
¥ec
;

41 
	`G‘FªcÚŒŞS³c
(&
¥ec
);

43 
sfs
->
ıu
 = 0;

44 
sfs
->
v®id_ıu
 = 
çl£
;

45 ià(
¥ec
.
devÇme
 != "impi") {

46 
FILE
 *
å
 = 
	`fİ’
(
¥ec
.
ıuçns
.
	`c_¡r
(), "r");

47 ià(
NULL
 !ğ
å
) {

48 
	`fsÿnf
(
å
, "%d", &(
sfs
->
ıu
));

49 
	`fşo£
(
å
);

50 
å
 = 
NULL
;

51 
sfs
->
v®id_ıu
 = 
Œue
;

57 
sfs
->
sysçn_num
 = 0;

58 
i
 = 0; i < 
¥ec
.
num_fcçns
 && i < 
MAX_SYSTEM_FAN_NUM
; i++) {

59 
sfs
->
sy¡em
[
i
] = 0;

60 
sfs
->
v®id_sy¡em
[
i
] = 
çl£
;

61 
sfs
->
sysçn_num
++;

62 ià(
¥ec
.
devÇme
 != "impi") {

63 
FILE
 *
å
 = 
	`fİ’
(
¥ec
.
fcçns
[
i
].
	`c_¡r
(), "r");

64 ià(
NULL
 !ğ
å
) {

65 
	`fsÿnf
(
å
, "%d", &(
sfs
->
sy¡em
[
i
]));

66 
	`fşo£
(
å
);

67 
å
 = 
NULL
;

68 
sfs
->
v®id_sy¡em
[
i
] = 
Œue
;

74 
	}
}

	@../platform/include/check_utils.h

1 #iâdeà
__CHECK_UTILS_H__


2 
	#__CHECK_UTILS_H__


	)

4 
	~"¶©fÜm_šfo.h
"

6 "C" 
G‘Cry¡®PÏtfÜm
();

7 "C" 
G‘Cry¡®PÏtfÜmInfo
(
¶©_šfo
 *
šfo
);

	@../platform/include/get_system_info.h

1 #iâdeà
__GET_SYSTEM_INFO_H__


2 
	#__GET_SYSTEM_INFO_H__


	)

4 
	#MAX_SYSTEM_FAN_NUM
 16

	)

6 
	ssy¡em_‹mps
 {

7 
	mıu
;

8 
	msy¡em
;

9 
boŞ
 
	mv®id_ıu
;

10 
boŞ
 
	mv®id_sy¡em
;

13 
	ssy¡em_çn_¥“ds
 {

14 
	mıu
;

15 
	msy¡em
[
MAX_SYSTEM_FAN_NUM
];

16 
	msysçn_num
;

17 
boŞ
 
	mv®id_ıu
;

18 
boŞ
 
	mv®id_sy¡em
[
MAX_SYSTEM_FAN_NUM
];

21 
G‘Sy¡emTem³¿tu»
(
sy¡em_‹mps
 *
¡
);

22 
G‘Sy¡emFªS³ed
(
sy¡em_çn_¥“ds
 *
sfs
);

	@../platform/include/platform_info.h

1 #iâdeà
__PLATFORM_INFO_H__


2 
	#__PLATFORM_INFO_H__


	)

4 
	#PLATFORM_INFO_EMPTY
 "TØbfËd by O.E.M."

	)

6 
	#PLATFORM_PRODUCT_NAME_AIMB_581
 
PLATFORM_INFO_EMPTY


7 
	#PLATFORM_PRODUCT_NAME_MN525MI
 "MN525MI"

8 
	#PLATFORM_PRODUCT_NAME_MN525RI_SI
 "MN525RI-SI"

9 
	#PLATFORM_PRODUCT_NAME_MZJ19AI
 "MZJ19AI"

10 
	#PLATFORM_PRODUCT_NAME_VMWARE
 "VMware Virtual Platform"

11 
	#PLATFORM_PRODUCT_NAME_G1SA
 
PLATFORM_INFO_EMPTY


12 

	)

13 
	#PLATFORM_BOARD_NAME_AIMB_581
 
PLATFORM_INFO_EMPTY


	)

14 
	#PLATFORM_BOARD_NAME_MN525MI
 
PLATFORM_PRODUCT_NAME_MN525MI


	)

15 
	#PLATFORM_BOARD_NAME_MZJ19AI
 
PLATFORM_PRODUCT_NAME_MZJ19AI


	)

16 
	#PLATFORM_BOARD_NAME_VMWARE
 "440BX Desktİ Reã»nû PÏtfÜm"

	)

17 
	#PLATFORM_BOARD_NAME_G1SA
 "G1SA"

	)

19 
	#PLATFORM_CPU_VERSION_AIMB_581
 "Intel(R) Core(TM) i5-2400"

20 
	#PLATFORM_CPU_VERSION_MN525MI
 "Intel(R) Atom(TM) CPU D525"

21 
	#PLATFORM_CPU_VERSION_MZJ19AI
 "Intel(R) Celeron(R) CPU J1900"

22 

	)

24 
	mCRYSTAL_PLATFORM_UNKNOWN
 = -1,

25 
	mCRYSTAL_PLATFORM_R1
,

26 
	mCRYSTAL_PLATFORM_R1_MZJ19AI
,

27 
	mCRYSTAL_PLATFORM_R1_MAX
 = 49,

29 
	mCRYSTAL_PLATFORM_R2
,

30 
	mCRYSTAL_PLATFORM_R2_581
,

31 
	mCRYSTAL_PLATFORM_R2_MAX
 = 99,

33 
	mCRYSTAL_PLATFORM_16BAY
,

34 
	mCRYSTAL_PLATFORM_16BAY_G1SA
,

35 
	mCRYSTAL_PLATFORM_16BAY_MAX
 = 149,

37 
	mCRYSTAL_PLATFORM_VM
,

38 
	mCRYSTAL_PLATFORM_MAX


41 
	s¶©_šfo
 {

42 
	mmod–_ty³
[256];

43 
	m´oduù_Çme
[256];

44 
	mbßrd_Çme
[256];

45 
	mıu_Çme
[256];

46 
	m¶©_fe_Çme
[256];

47 
	m¶©_id
;

	@../platform/include/platform_spec.h

1 #iâdeà
__PLATFORM_SPEC_H__


2 
	#__PLATFORM_SPEC_H__


	)

4 
	~<¡ršg
>

6 
usšg
 
Çme¥aû
 
	g¡d
;

8 
	#VOLUME_SPEC_DEFAULT_ESATA_IDX
 1

	)

9 
	#VOLUME_SPEC_DEFAULT_SATA_NUM
 1

	)

10 
	#VOLUME_SPEC_DEFAULT_MAX_VOLUMES
 1

	)

12 
	#FANCONTROL_SPEC_MAX_FCFANS_NUM
 16

	)

13 
	#HWMON_SYS_PATH
 "/sys/şass/hwmÚ"

	)

14 
	#CPU_DEVNAME
 "cÜ‘emp"

	)

16 
	svŞume_¥ec
 {

17 
	me§_idx
;

18 
	m§_num
;

19 
	mmax_vŞumes
;

22 
	sçncÚŒŞ_¥ec
 {

23 
	mš‹rv®
;

24 
¡ršg
 
	mdevÇme
;

26 
¡ršg
 
	mfùemps
;

27 
¡ršg
 
	mfcçns
[16];

28 
	mnum_fcçns
;

29 
	mmš‹mp
;

30 
¡ršg
 
	mmš‹mpName
;

31 
	mmax‹mp
;

32 
¡ršg
 
	mmax‹mpName
;

33 
	mmš¡¬t
;

34 
¡ršg
 
	mmš¡¬tName
;

35 
	mmš¡İ
;

36 
¡ršg
 
	mmš¡İName
;

37 
	mmšpwm
;

38 
¡ršg
 
	mmšpwmName
;

39 
	mmaxpwm
;

40 
¡ršg
 
	mmaxpwmName
;

42 
	mmaxıu‹mp
;

43 
¡ršg
 
	mıu‹mps
;

44 
¡ršg
 
	mıuçns
;

47 
G‘VŞumeS³c
(
vŞume_¥ec
* 
¥ec
);

48 
G‘FªcÚŒŞS³c
(
çncÚŒŞ_¥ec
* 
¥ec
);

	@../platform/include/proc_cpuinfo.h

1 #iâdeà
__PROC_CPUINFO_H__


2 
	#__PROC_CPUINFO_H_


	)

4 
	~<¡ršg.h
>

7 
G‘CPUMod–Name
(*
Çme
, 
size_t
 
s
);

8 
G‘CPUMiüocode
(*
Çme
, 
size_t
 
s
);

9 
G‘CPUMod–
(*
Çme
, 
size_t
 
s
);

	@../platform/include/sys_dmi.h

1 #iâdeà
__SYS_DMI_H__


2 
	#__SYS_DMI_H__


	)

4 
	~<¡ršg.h
>

7 
G‘DMIInfoProduùName
(*
Çme
, 
size_t
 
s
);

8 
G‘DMIInfoBßrdName
(*
Çme
, 
size_t
 
s
);

9 
G‘DMIInfoBßrdV’dÜ
(*
Çme
, 
size_t
 
s
);

	@../platform/platform_spec.cpp

1 
	~"¶©fÜm_šfo.h
"

2 
	~"¶©fÜm_¥ec.h
"

3 
	~"check_uts.h
"

5 
	~"commÚ/¡ršg.h
"

6 
	~"commÚ/fe.h
"

7 
	~"commÚ/dœeùÜy_Œav”£.h
"

8 
	~"sûw/xml_Œ“.h
"

10 
	~<¡dio.h
>

12 
	#CHECK_PLATFORM
(
¶©
) \

13 ià(
¶©fÜm
 >ğ
CRYSTAL_PLATFORM_
##
¶©
 && \

14 
¶©fÜm
 < 
CRYSTAL_PLATFORM_
##
¶©
##
_MAX
) { \

16 }

	)

18 
	#PÏt2SŒ
(
¶©
) \

19 
CRYSTAL_PLATFORM_
##
¶©
: \

21 

	)

22 
	#G‘XMLEËm’tCÚ‹Á2I32
(
Çme
) \

24 
¥ec
->
Çme
 = 
	`¡r_to_i32
(
e
.
	`G‘Chd
(#Çme).
	`G‘CÚ‹Á
()); \

25 } 0);

	)

27 
	#G‘XMLEËm’tCÚ‹Á
(
Çme
) \

29 
¥ec
->
Çme
 = 
e
.
	`G‘Chd
(#Çme).
	`G‘CÚ‹Á
(); \

30 } 0);

	)

32 
	#G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
Çme
, 
·th
) \

34 
	`G‘XMLEËm’tCÚ‹Á
(
Çme
); \

35 ià(!
·th
.
	`em±y
()) \

36 
¥ec
->
Çme
 = 
·th
 + '/' + spec->name; \

37 } 0);

	)

39 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

40 
usšg
 
Çme¥aû
 
	g¡d
;

42 
¡ršg
 
	$G‘Mod–Ty³
()

44 
¶©_šfo
 
šfo
;

45 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜmInfo
(&
šfo
);

47 ià(
¶©fÜm
 =ğ
CRYSTAL_PLATFORM_UNKNOWN
)

50  
šfo
.
mod–_ty³
;

51 
	}
}

53 
¡ršg
 
	$G‘PÏtFeName
()

55 
¶©_šfo
 
šfo
;

56 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜmInfo
(&
šfo
);

58 ià(
¶©fÜm
 =ğ
CRYSTAL_PLATFORM_UNKNOWN
)

61  
šfo
.
¶©_fe_Çme
;

62 
	}
}

64 
boŞ
 
	$FšdHWMONP©h
(cÚ¡ 
¡ršg
 &
devÇme
, sŒšg &
·th
)

66 ià(
devÇme
 == "ipmi")

67  
Œue
;

69 
DœeùÜyT¿v”£
 
	`dt
(
HWMON_SYS_PATH
);

70 
dt
.
	`Next
()) {

71 ià(
	`CheckFeExi¡
(
dt
.
	`G‘P©hName
() + "/name")) {

72 
·th
 = 
dt
.
	`G‘P©hName
();

73 } ià(
	`CheckFeExi¡
(
dt
.
	`G‘P©hName
() + "/device/name")) {

74 
·th
 = 
dt
.
	`G‘P©hName
() + "/device";

76 
devÇme_nÙ_found
;

79 
buf
[64];

80 
FILE
 *
å
 = 
	`fİ’
((
·th
 + "/Çme").
	`c_¡r
(), "r");

81 ià(
å
 !ğ
NULL
) {

82 
	`fsÿnf
(
å
, "%64[^\n]", 
buf
);

83 
	`fşo£
(
å
);

85 ià(
devÇme
 =ğ
buf
) {

86 
dt
.
	`Clo£
();

87  
Œue
;

92 
devÇme_nÙ_found
:

93 
dt
.
	`Clo£
();

94  
çl£
;

95 
	}
}

97 
	$G‘VŞumeS³c
(
vŞume_¥ec
* 
¥ec
)

99 
veùÜ
<
XMLEËm’t
> 
vŞumeS³cs
;

100 
¡ršg
 
¶©fÜm
 = 
	`G‘Mod–Ty³
();

102 ià(
¥ec
 =ğ
NULL
)

105 
¥ec
->
e§_idx
 = 
VOLUME_SPEC_DEFAULT_ESATA_IDX
;

106 
¥ec
->
§_num
 = 
VOLUME_SPEC_DEFAULT_SATA_NUM
;

107 
¥ec
->
max_vŞumes
 = 
VOLUME_SPEC_DEFAULT_MAX_VOLUMES
;

109 
XMLT»e
 
Œ“
;

110 ià(!
	`LßdXMLT»e
("/NU20/‘c/¶©fÜm_¥ec.xml", 
Œ“
)) {

114 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "platformSpec") {

118 
vŞumeS³cs
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd»n
("volumeSpec");

120 
XMLEËm’t
 
e
;

121 
size_t
 
i
 = 0; i < 
vŞumeS³cs
.
	`size
(); i++) {

122 
XMLEËm’t
 
chd
 = 
vŞumeS³cs
[
i
].
	`G‘Chd
("platform");

123 ià(
vŞumeS³cs
[
i
].
	`G‘Chd
("¶©fÜm").
	`G‘CÚ‹Á
(è=ğ
¶©fÜm
) {

124 
e
 = 
vŞumeS³cs
[
i
];

129 
¥ec
->
e§_idx
 = 
	`¡r_to_i32
(
e
.
	`G‘Chd
("e§Idx").
	`G‘CÚ‹Á
());

130 
¥ec
->
§_num
 = 
	`¡r_to_i32
(
e
.
	`G‘Chd
("§Num").
	`G‘CÚ‹Á
());

131 
¥ec
->
max_vŞumes
 = 
	`¡r_to_i32
(
e
.
	`G‘Chd
("maxVŞumes").
	`G‘CÚ‹Á
());

132 
	}
}

134 
	$G‘FªcÚŒŞS³c
(
çncÚŒŞ_¥ec
* 
¥ec
)

136 
veùÜ
<
XMLEËm’t
> 
çncÚŒŞS³cs
;

137 
¡ršg
 
¶©fÜm
 = 
	`G‘PÏtFeName
();

139 ià(
¥ec
 =ğ
NULL
)

142 
XMLT»e
 
Œ“
;

143 ià(!
	`LßdXMLT»e
("/NU20/‘c/¶©fÜm_¥ec.xml", 
Œ“
)) {

147 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "platformSpec") {

151 
çncÚŒŞS³cs
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd»n
("fancontrolSpec");

153 
XMLEËm’t
 
e
;

154 
size_t
 
i
 = 0; i < 
çncÚŒŞS³cs
.
	`size
(); i++) {

155 
XMLEËm’t
 
chd
 = 
çncÚŒŞS³cs
[
i
].
	`G‘Chd
("platform");

156 ià(
çncÚŒŞS³cs
[
i
].
	`G‘Chd
("¶©fÜm").
	`G‘CÚ‹Á
(è=ğ
¶©fÜm
) {

157 
e
 = 
çncÚŒŞS³cs
[
i
];

162 
¡ršg
 
	`·th
("");

164 
	`G‘XMLEËm’tCÚ‹Á2I32
(
š‹rv®
);

165 
	`G‘XMLEËm’tCÚ‹Á
(
devÇme
);

167 
	`FšdHWMONP©h
(
¥ec
->
devÇme
, 
·th
);

168 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
fùemps
, 
·th
);

170 
	`G‘XMLEËm’tCÚ‹Á2I32
(
mš‹mp
);

171 
	`G‘XMLEËm’tCÚ‹Á2I32
(
max‹mp
);

172 
	`G‘XMLEËm’tCÚ‹Á2I32
(
mš¡¬t
);

173 
	`G‘XMLEËm’tCÚ‹Á2I32
(
mš¡İ
);

174 
	`G‘XMLEËm’tCÚ‹Á2I32
(
mšpwm
);

175 
	`G‘XMLEËm’tCÚ‹Á2I32
(
maxpwm
);

177 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
mš‹mpName
, 
·th
);

178 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
max‹mpName
, 
·th
);

179 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
mš¡İName
, 
·th
);

180 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
mš¡¬tName
, 
·th
);

181 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
mšpwmName
, 
·th
);

182 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
maxpwmName
, 
·th
);

184 
veùÜ
<
XMLEËm’t
> 
fcçns
 = 
e
.
	`G‘Chd»n
("fcfans");

185 
¥ec
->
num_fcçns
 = 
fcçns
.
	`size
();

186 
size_t
 
i
 = 0; i < 
fcçns
.
	`size
(); i++) {

187 ià(
·th
.
	`em±y
())

188 
¥ec
->
fcçns
[
i
] = fcçns[i].
	`G‘CÚ‹Á
();

190 
¥ec
->
fcçns
[
i
] = 
·th
 + '/' + fcçns[i].
	`G‘CÚ‹Á
();

192 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
ıuçns
, 
·th
);

194 
	`FšdHWMONP©h
(
CPU_DEVNAME
, 
·th
);

195 
	`G‘XMLEËm’tCÚ‹Á2I32
(
maxıu‹mp
);

197 ià(
¥ec
->
devÇme
 != "ipmi") {

198 
	`G‘XMLEËm’tCÚ‹ÁCÚÿtP©h
(
ıu‹mps
, 
·th
);

200 
¥ec
->
ıu‹mps
 = 
e
.
	`G‘Chd
("ıu‹mps").
	`G‘CÚ‹Á
();

201 
	}
}

	@../platform/proc_cpuinfo.cpp

1 
	~"´oc_ıušfo.h
"

3 
	~<¡dio.h
>

4 
	~<uni¡d.h
>

5 
	~<ùy³.h
>

7 
	#CPUINFO_FILE
 "/´oc/ıušfo"

	)

8 
	#CPUINFO_FORMAT
 "%64[^\t:]\t:%256[^\n]%c"

	)

11 
	mCPUINFO_KEY_MODEL_NAME
 = 0,

12 
	mCPUINFO_KEY_MICROCODE
,

13 
	mCPUINFO_KEY_MODEL
,

14 
	mCPUINFO_KEY_MAX


17 
	$__—t_ıušfo_¥aû
(*
buf
)

20 *
tmp
 = 
buf
 + 
	`¡¾’
(buf) - 1;

21 
tmp
 > 
buf
 && 
	`is¥aû
(*tmp))

22 *
tmp
-- = '\0';

24 
tmp
 = 
buf
;

25 *
tmp
 && 
	`is¥aû
(*tmp))

26 
tmp
++;

27 ià(
tmp
 !ğ
buf
)

28 
	`memmove
(
buf
, 
tmp
, 
	`¡¾’
(tmp)+1);

30 
tmp
 = 
buf
;

31 
tmp
[0] &&mp[1]) {

32 ià(
	`is¥aû
(
tmp
[0]) && isspace(tmp[1])) {

33 
	`memmove
(
tmp
,mp+1, 
	`¡¾’
(tmp));

36 ++
tmp
;

38 
	}
}

40 
	$G‘CPUInfo
(
x
, *
Çme
, 
size_t
 
s
)

42 
FILE
 *
å
 = 
NULL
;

43 cÚ¡ *
´ocšfo_keys
[] = {

49 ià(!(
x
 < 
CPUINFO_KEY_MAX
è|| 
s
 <ğ0 || 
Çme
 =ğ
NULL
)  -1;

51 ià((
å
 = 
	`fİ’
(
CPUINFO_FILE
, "r")è!ğ
NULL
) {

52 
key
[65], 
v®ue
[257], 
eŞ
, *
»t
 = 
NULL
;

54 
	`fsÿnf
(
å
, 
CPUINFO_FORMAT
, 
key
, 
v®ue
, &
eŞ
è!ğ
EOF
) {

55 
	`__—t_ıušfo_¥aû
(
key
);

56 ià(!
	`¡rcmp
(
key
, 
´ocšfo_keys
[
x
])) {

57 
	`__—t_ıušfo_¥aû
(
v®ue
);

58 
»t
 = 
v®ue
;

61 ià(
eŞ
 != '\n') {

66 
	`fsÿnf
(
å
, "%*[^\n]");

67 
	`fsÿnf
(
å
, "\n");

70 
	`fşo£
(
å
);

72 ià(
»t
) {

73 
	`¡ºıy
(
Çme
, 
»t
, 
s
);

79 
	}
}

81 
	$G‘CPUMod–Name
(*
Çme
, 
size_t
 
s
)

83  
	`G‘CPUInfo
(
CPUINFO_KEY_MODEL_NAME
, 
Çme
, 
s
);

84 
	}
}

86 
	$G‘CPUMiüocode
(*
Çme
, 
size_t
 
s
)

88  
	`G‘CPUInfo
(
CPUINFO_KEY_MICROCODE
, 
Çme
, 
s
);

89 
	}
}

91 
	$G‘CPUMod–
(*
Çme
, 
size_t
 
s
)

93  
	`G‘CPUInfo
(
CPUINFO_KEY_MODEL
, 
Çme
, 
s
);

94 
	}
}

	@../platform/sys_dmi.cpp

1 
	~"sys_dmi.h
"

2 
	~<¡dio.h
>

4 
	#SYS_DMI_PATH
 "/sys/şass/dmi/id"

	)

6 
	#SYS_DMI_PRODUCT_NAME_FILE
 "´oduù_Çme"

	)

7 
	#SYS_DMI_BOARD_NAME_FILE
 "bßrd_Çme"

	)

8 
	#SYS_DMI_BOARD_VENDOR_FILE
 "bßrd_v’dÜ"

	)

11 
	mSYS_DMI_PRODUCT_NAME
 = 0,

12 
	mSYS_DMI_BOARD_NAME
,

13 
	mSYS_DMI_BOARD_VENDOR
,

14 
	mSYS_DMI_BOARD_MAX


17 
	$G‘DMIInfo
(
x
, *
Çme
, 
size_t
 
s
)

19 
FILE
 *
å
 = 
NULL
;

20 
buf
[257];

21 
cÚ‹Á
[64];

22 cÚ¡ *
fes
[] = {

23 
SYS_DMI_PRODUCT_NAME_FILE
,

24 
SYS_DMI_BOARD_NAME_FILE
,

25 
SYS_DMI_BOARD_VENDOR_FILE


28 ià(!(
x
 < 
SYS_DMI_BOARD_MAX
è|| 
s
 <ğ0 || 
Çme
 =ğ
NULL
)  -1;

30 
	`¢´štf
(
buf
, 256, "%s/%s", 
SYS_DMI_PATH
, 
fes
[
x
]);

31 ià((
å
 = 
	`fİ’
(
buf
, "r")è!ğ
NULL
) {

33 
	`fsÿnf
(
å
, "%64[^\n]", 
cÚ‹Á
);

34 
	`fşo£
(
å
);

36 
	`¡ºıy
(
Çme
, 
cÚ‹Á
, 
s
);

41 
	}
}

43 
	$G‘DMIInfoProduùName
(*
Çme
, 
size_t
 
s
)

45  
	`G‘DMIInfo
(
SYS_DMI_PRODUCT_NAME
, 
Çme
, 
s
);

46 
	}
}

48 
	$G‘DMIInfoBßrdName
(*
Çme
, 
size_t
 
s
)

50  
	`G‘DMIInfo
(
SYS_DMI_BOARD_NAME
, 
Çme
, 
s
);

51 
	}
}

53 
	$G‘DMIInfoBßrdV’dÜ
(*
Çme
, 
size_t
 
s
)

55  
	`G‘DMIInfo
(
SYS_DMI_BOARD_VENDOR
, 
Çme
, 
s
);

56 
	}
}

	@../platform/unitest.cpp

1 
	~"¶©fÜm_šfo.h
"

2 
	~"´oc_ıušfo.h
"

3 
	~"sys_dmi.h
"

4 
	~"check_uts.h
"

5 
	~"¶©fÜm_¥ec.h
"

6 
	~"cÚ¡/P©hCÚ¡.h
"

7 
	~"g‹¡/g‹¡.h
"

9 
	$TEST
(
G‘CPUInfo
, 
SŒšgBufãrE¼ÜHªdË
) {

10 
	`EXPECT_EQ
(-1, 
	`G‘CPUMod–Name
(
NULL
, 5));

11 
	`EXPECT_EQ
(-1, 
	`G‘CPUMiüocode
(
NULL
, 5));

12 
	`EXPECT_EQ
(-1, 
	`G‘CPUMod–
(
NULL
, 5));

13 
	}
}

15 
	$TEST
(
G‘CPUInfo
, 
BufãrSizeE¼ÜHªdË
) {

16 
Çme
[257];

18 
	`EXPECT_EQ
(-1, 
	`G‘CPUMod–Name
(
Çme
, 0));

19 
	`EXPECT_EQ
(-1, 
	`G‘CPUMiüocode
(
Çme
, 0));

20 
	`EXPECT_EQ
(-1, 
	`G‘CPUMod–
(
Çme
, 0));

21 
	}
}

23 
	$TEST
(
G‘CPUInfo
, 
R‘uºResuÉ
) {

24 
Çme
[257];

26 
	`EXPECT_EQ
(0, 
	`G‘CPUMod–Name
(
Çme
, (name)));

27 
	`EXPECT_EQ
(0, 
	`G‘CPUMiüocode
(
Çme
, (name)));

28 
	`EXPECT_EQ
(0, 
	`G‘CPUMod–
(
Çme
, (name)));

29 
	}
}

31 
	$TEST
(
G‘CPUInfo
, 
CheckMod–Name
) {

32 
buf
[257];

33 
mod–_Çme
[257];

35 
	`G‘CPUMod–Name
(
buf
, (buf));

37 ià(0 =ğ
	`acûss
(
PLATFORM_R2_581_PATH
, 
F_OK
)) {

38 
	`¡ºıy
(
mod–_Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_CPU_VERSION_AIMB_581
));

39 
mod–_Çme
[
	`¡¾’
(
PLATFORM_CPU_VERSION_AIMB_581
)] = '\0';

40 
	`EXPECT_STREQ
(
PLATFORM_CPU_VERSION_AIMB_581
,

41 
mod–_Çme
);

42 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_PATH
, 
F_OK
)) {

43 
	`¡ºıy
(
mod–_Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_CPU_VERSION_MN525MI
));

44 
mod–_Çme
[
	`¡¾’
(
PLATFORM_CPU_VERSION_MN525MI
)] = '\0';

45 
	`EXPECT_STREQ
(
PLATFORM_CPU_VERSION_MN525MI
,

46 
mod–_Çme
);

47 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_MZJ19AI_PATH
, 
F_OK
)) {

48 
	`¡ºıy
(
mod–_Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_CPU_VERSION_MZJ19AI
));

49 
mod–_Çme
[
	`¡¾’
(
PLATFORM_CPU_VERSION_MZJ19AI
)] = '\0';

50 
	`EXPECT_STREQ
(
PLATFORM_CPU_VERSION_MZJ19AI
,

51 
mod–_Çme
);

56 
	}
}

58 
	$TEST
(
G‘CPUInfo
, 
CheckMiüocode
) {

59 
miüocode
[16];

61 
	`G‘CPUMiüocode
(
miüocode
, (microcode));

64 ià(0 =ğ
	`acûss
(
PLATFORM_R2_581_PATH
, 
F_OK
)) {

65 
	`EXPECT_STREQ
("0x14", 
miüocode
);

66 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_PATH
, 
F_OK
)) {

67 
	`EXPECT_STREQ
("0x107", 
miüocode
);

68 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_MZJ19AI_PATH
, 
F_OK
)) {

69 
	`EXPECT_STREQ
("0x82d", 
miüocode
);

71 
	}
}

73 
	$TEST
(
G‘CPUInfo
, 
CheckMod–
) {

74 
mod–
[16];

76 
	`G‘CPUMod–
(
mod–
, (model));

78 ià(0 =ğ
	`acûss
(
PLATFORM_R2_581_PATH
, 
F_OK
)) {

79 
	`EXPECT_STREQ
("42", 
mod–
);

80 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_PATH
, 
F_OK
)) {

81 
	`EXPECT_STREQ
("28", 
mod–
);

82 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_MZJ19AI_PATH
, 
F_OK
)) {

83 
	`EXPECT_STREQ
("55", 
mod–
);

85 
	}
}

87 
	$TEST
(
SysDMI
, 
SŒšgBufãrE¼ÜHªdË
) {

88 
	`EXPECT_EQ
(-1, 
	`G‘DMIInfoProduùName
(
NULL
, 5));

89 
	`EXPECT_EQ
(-1, 
	`G‘DMIInfoBßrdName
(
NULL
, 5));

90 
	`EXPECT_EQ
(-1, 
	`G‘DMIInfoBßrdV’dÜ
(
NULL
, 5));

91 
	}
}

93 
	$TEST
(
SysDMI
, 
BufãrSizeE¼ÜHªdË
) {

94 
Çme
[257];

96 
	`EXPECT_EQ
(-1, 
	`G‘DMIInfoProduùName
(
Çme
, 0));

97 
	`EXPECT_EQ
(-1, 
	`G‘DMIInfoBßrdName
(
Çme
, 0));

98 
	`EXPECT_EQ
(-1, 
	`G‘DMIInfoBßrdV’dÜ
(
Çme
, 0));

99 
	}
}

101 
	$TEST
(
SysDMI
, 
R‘uºResuÉ
) {

102 
Çme
[257];

104 
	`EXPECT_EQ
(0, 
	`G‘DMIInfoProduùName
(
Çme
, (name)));

105 
	`EXPECT_EQ
(0, 
	`G‘DMIInfoBßrdName
(
Çme
, (name)));

106 
	`EXPECT_EQ
(0, 
	`G‘DMIInfoBßrdV’dÜ
(
Çme
, (name)));

107 
	}
}

109 
	$TEST
(
SysDMI
, 
CheckProduùName
) {

110 
buf
[257];

111 
Çme
[257];

113 
	`G‘DMIInfoProduùName
(
buf
, (buf));

115 ià(0 =ğ
	`acûss
(
PLATFORM_R2_581_PATH
, 
F_OK
)) {

116 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_PRODUCT_NAME_AIMB_581
));

117 
Çme
[
	`¡¾’
(
PLATFORM_PRODUCT_NAME_AIMB_581
)] = '\0';

118 
	`EXPECT_STREQ
(
PLATFORM_PRODUCT_NAME_AIMB_581
,

119 
Çme
);

120 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_PATH
, 
F_OK
)) {

121 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_PRODUCT_NAME_MN525MI
));

122 
Çme
[
	`¡¾’
(
PLATFORM_PRODUCT_NAME_MN525MI
)] = '\0';

123 
	`EXPECT_STREQ
(
PLATFORM_PRODUCT_NAME_MN525MI
,

124 
Çme
);

125 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_MZJ19AI_PATH
, 
F_OK
)) {

126 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_PRODUCT_NAME_MZJ19AI
));

127 
Çme
[
	`¡¾’
(
PLATFORM_PRODUCT_NAME_MZJ19AI
)] = '\0';

128 
	`EXPECT_STREQ
(
PLATFORM_PRODUCT_NAME_MZJ19AI
,

129 
Çme
);

130 } ià(0 =ğ
	`acûss
(
PLATFORM_VM_PATH
, 
F_OK
)) {

131 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_PRODUCT_NAME_VMWARE
));

132 
Çme
[
	`¡¾’
(
PLATFORM_PRODUCT_NAME_VMWARE
)] = '\0';

133 
	`EXPECT_STREQ
(
PLATFORM_PRODUCT_NAME_VMWARE
,

134 
Çme
);

135 } ià(0 =ğ
	`acûss
(
PLATFORM_16BAY_G1SA_PATH
, 
F_OK
)) {

136 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_PRODUCT_NAME_G1SA
));

137 
Çme
[
	`¡¾’
(
PLATFORM_PRODUCT_NAME_G1SA
)] = '\0';

138 
	`EXPECT_STREQ
(
PLATFORM_PRODUCT_NAME_G1SA
,

139 
Çme
);

141 
	}
}

143 
	$TEST
(
SysDMI
, 
CheckBßrdName
) {

144 
buf
[257];

145 
Çme
[257];

147 
	`G‘DMIInfoBßrdName
(
buf
, (buf));

149 ià(0 =ğ
	`acûss
(
PLATFORM_R2_581_PATH
, 
F_OK
)) {

150 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_BOARD_NAME_AIMB_581
));

151 
Çme
[
	`¡¾’
(
PLATFORM_BOARD_NAME_AIMB_581
)] = '\0';

152 
	`EXPECT_STREQ
(
PLATFORM_BOARD_NAME_AIMB_581
,

153 
Çme
);

154 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_PATH
, 
F_OK
)) {

155 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_BOARD_NAME_MN525MI
));

156 
Çme
[
	`¡¾’
(
PLATFORM_BOARD_NAME_MN525MI
)] = '\0';

157 
	`EXPECT_STREQ
(
PLATFORM_BOARD_NAME_MN525MI
,

158 
Çme
);

159 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_MZJ19AI_PATH
, 
F_OK
)) {

160 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_BOARD_NAME_MZJ19AI
));

161 
Çme
[
	`¡¾’
(
PLATFORM_BOARD_NAME_MZJ19AI
)] = '\0';

162 
	`EXPECT_STREQ
(
PLATFORM_BOARD_NAME_MZJ19AI
,

163 
Çme
);

164 } ià(0 =ğ
	`acûss
(
PLATFORM_VM_PATH
, 
F_OK
)) {

165 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_BOARD_NAME_VMWARE
));

166 
Çme
[
	`¡¾’
(
PLATFORM_BOARD_NAME_VMWARE
)] = '\0';

167 
	`EXPECT_STREQ
(
PLATFORM_BOARD_NAME_VMWARE
,

168 
Çme
);

169 } ià(0 =ğ
	`acûss
(
PLATFORM_16BAY_G1SA_PATH
, 
F_OK
)) {

170 
	`¡ºıy
(
Çme
, 
buf
, 
	`¡¾’
(
PLATFORM_BOARD_NAME_G1SA
));

171 
Çme
[
	`¡¾’
(
PLATFORM_BOARD_NAME_G1SA
)] = '\0';

172 
	`EXPECT_STREQ
(
PLATFORM_BOARD_NAME_G1SA
,

173 
Çme
);

175 
	}
}

177 
	$TEST
(
CheckUts
, 
G‘Cry¡®PÏtfÜm
) {

178 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜm
();

180 ià(0 =ğ
	`acûss
(
PLATFORM_R2_581_PATH
, 
F_OK
)) {

181 
	`EXPECT_EQ
(
CRYSTAL_PLATFORM_R2_581
,

182 
¶©fÜm
);

183 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_PATH
, 
F_OK
)) {

184 
	`EXPECT_EQ
(
CRYSTAL_PLATFORM_R1
,

185 
¶©fÜm
);

186 } ià(0 =ğ
	`acûss
(
PLATFORM_R1_MZJ19AI_PATH
, 
F_OK
)) {

187 
	`EXPECT_EQ
(
CRYSTAL_PLATFORM_R1_MZJ19AI
,

188 
¶©fÜm
);

189 } ià(0 =ğ
	`acûss
(
PLATFORM_VM_PATH
, 
F_OK
)) {

190 
	`EXPECT_EQ
(
CRYSTAL_PLATFORM_VM
,

191 
¶©fÜm
);

192 } ià(0 =ğ
	`acûss
(
PLATFORM_16BAY_G1SA_PATH
, 
F_OK
)) {

193 
	`EXPECT_EQ
(
CRYSTAL_PLATFORM_16BAY_G1SA
,

194 
¶©fÜm
);

196 
	}
}

198 
	$TEST
(
PÏtfÜmS³c
, 
G‘VŞumeS³c
) {

199 
vŞume_¥ec
 
¥ec
;

200 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜm
();

202 
	`G‘VŞumeS³c
(&
¥ec
);

204 
¶©fÜm
) {

205 
CRYSTAL_PLATFORM_R2_581
:

206 
	`ASSERT_EQ
(8, 
¥ec
.
e§_idx
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

207 
	`ASSERT_EQ
(10, 
¥ec
.
§_num
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

208 
	`ASSERT_EQ
(15, 
¥ec
.
max_vŞumes
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

210 
CRYSTAL_PLATFORM_R1
:

211 
CRYSTAL_PLATFORM_R1_MZJ19AI
:

212 
	`ASSERT_EQ
(4, 
¥ec
.
e§_idx
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

213 
	`ASSERT_EQ
(6, 
¥ec
.
§_num
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

214 
	`ASSERT_EQ
(11, 
¥ec
.
max_vŞumes
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

216 
CRYSTAL_PLATFORM_VM
:

217 
	`ASSERT_EQ
(8, 
¥ec
.
e§_idx
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

218 
	`ASSERT_EQ
(8, 
¥ec
.
§_num
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

219 
	`ASSERT_EQ
(15, 
¥ec
.
max_vŞumes
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

221 
CRYSTAL_PLATFORM_16BAY_G1SA
:

222 
	`ASSERT_EQ
(16, 
¥ec
.
e§_idx
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

223 
	`ASSERT_EQ
(16, 
¥ec
.
§_num
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

224 
	`ASSERT_EQ
(22, 
¥ec
.
max_vŞumes
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

227 
	`ASSERT_EQ
(1, 
¥ec
.
e§_idx
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

228 
	`ASSERT_EQ
(1, 
¥ec
.
§_num
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

229 
	`ASSERT_EQ
(1, 
¥ec
.
max_vŞumes
) << "Missing /NU20/etc/platform_spec.xml orhe…latform file";

231 
	}
}

233 
	$TEST
(
PÏtfÜmS³c
, 
G‘FªcÚŒŞS³c
) {

234 
çncÚŒŞ_¥ec
 
¥ec
;

235 
¶©fÜm
 = 
	`G‘Cry¡®PÏtfÜm
();

237 
	`G‘FªcÚŒŞS³c
(&
¥ec
);

239 
¶©fÜm
) {

240 
CRYSTAL_PLATFORM_R1
:

241 
	`EXPECT_EQ
(10, 
¥ec
.
š‹rv®
);

242 
	`EXPECT_STREQ
("™8721", 
¥ec
.
devÇme
.
	`c_¡r
());

243 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/‹mp2_šput", 
¥ec
.
fùemps
.
	`c_¡r
());

244 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/çn2_šput", 
¥ec
.
fcçns
[0].
	`c_¡r
());

245 
	`EXPECT_EQ
(20, 
¥ec
.
mš‹mp
);

246 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
mš‹mpName
.
	`c_¡r
());

247 
	`EXPECT_EQ
(60, 
¥ec
.
max‹mp
);

248 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
max‹mpName
.
	`c_¡r
());

249 
	`EXPECT_EQ
(50, 
¥ec
.
mš¡¬t
);

250 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
mš¡¬tName
.
	`c_¡r
());

251 
	`EXPECT_EQ
(0, 
¥ec
.
mš¡İ
);

252 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
mš¡İName
.
	`c_¡r
());

253 
	`EXPECT_EQ
(0, 
¥ec
.
mšpwm
);

254 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
mšpwmName
.
	`c_¡r
());

255 
	`EXPECT_EQ
(255, 
¥ec
.
maxpwm
);

256 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
maxpwmName
.
	`c_¡r
());

257 
	`EXPECT_EQ
(58, 
¥ec
.
maxıu‹mp
);

258 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ0/‹mp3_šput", 
¥ec
.
ıu‹mps
.
	`c_¡r
());

259 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/çn1_šput", 
¥ec
.
ıuçns
.
	`c_¡r
());

261 
CRYSTAL_PLATFORM_R1_MZJ19AI
:

262 
	`EXPECT_EQ
(10, 
¥ec
.
š‹rv®
);

263 
	`EXPECT_STREQ
("™8786", 
¥ec
.
devÇme
.
	`c_¡r
());

264 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/‹mp2_šput", 
¥ec
.
fùemps
.
	`c_¡r
());

265 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/çn2_šput", 
¥ec
.
fcçns
[0].
	`c_¡r
());

266 
	`EXPECT_EQ
(20, 
¥ec
.
mš‹mp
);

267 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
mš‹mpName
.
	`c_¡r
());

268 
	`EXPECT_EQ
(60, 
¥ec
.
max‹mp
);

269 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
max‹mpName
.
	`c_¡r
());

270 
	`EXPECT_EQ
(50, 
¥ec
.
mš¡¬t
);

271 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
mš¡¬tName
.
	`c_¡r
());

272 
	`EXPECT_EQ
(0, 
¥ec
.
mš¡İ
);

273 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
mš¡İName
.
	`c_¡r
());

274 
	`EXPECT_EQ
(0, 
¥ec
.
mšpwm
);

275 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
mšpwmName
.
	`c_¡r
());

276 
	`EXPECT_EQ
(255, 
¥ec
.
maxpwm
);

277 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/pwm2", 
¥ec
.
maxpwmName
.
	`c_¡r
());

278 
	`EXPECT_EQ
(58, 
¥ec
.
maxıu‹mp
);

279 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ0/‹mp3_šput", 
¥ec
.
ıu‹mps
.
	`c_¡r
());

280 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/deviû/çn1_šput", 
¥ec
.
ıuçns
.
	`c_¡r
());

282 
CRYSTAL_PLATFORM_R2_581
:

283 
	`EXPECT_EQ
(10, 
¥ec
.
š‹rv®
);

284 
	`EXPECT_STREQ
("nù6776", 
¥ec
.
devÇme
.
	`c_¡r
());

285 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/‹mp1_šput", 
¥ec
.
fùemps
.
	`c_¡r
());

286 
	`EXPECT_EQ
(20, 
¥ec
.
mš‹mp
);

287 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/pwm1", 
¥ec
.
mš‹mpName
.
	`c_¡r
());

288 
	`EXPECT_EQ
(60, 
¥ec
.
max‹mp
);

289 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/pwm1", 
¥ec
.
max‹mpName
.
	`c_¡r
());

290 
	`EXPECT_EQ
(50, 
¥ec
.
mš¡¬t
);

291 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/pwm1", 
¥ec
.
mš¡¬tName
.
	`c_¡r
());

292 
	`EXPECT_EQ
(0, 
¥ec
.
mš¡İ
);

293 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/pwm1", 
¥ec
.
mš¡İName
.
	`c_¡r
());

294 
	`EXPECT_EQ
(0, 
¥ec
.
mšpwm
);

295 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/pwm1", 
¥ec
.
mšpwmName
.
	`c_¡r
());

296 
	`EXPECT_EQ
(255, 
¥ec
.
maxpwm
);

297 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/pwm1", 
¥ec
.
maxpwmName
.
	`c_¡r
());

298 
	`EXPECT_EQ
(58, 
¥ec
.
maxıu‹mp
);

299 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ0/‹mp1_šput", 
¥ec
.
ıu‹mps
.
	`c_¡r
());

300 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/çn2_šput", 
¥ec
.
ıuçns
.
	`c_¡r
());

302 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/çn1_šput", 
¥ec
.
fcçns
[0].
	`c_¡r
());

303 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/çn4_šput", 
¥ec
.
fcçns
[1].
	`c_¡r
());

304 
	`EXPECT_STREQ
(
HWMON_SYS_PATH
"/hwmÚ1/çn5_šput", 
¥ec
.
fcçns
[2].
	`c_¡r
());

306 
CRYSTAL_PLATFORM_16BAY_G1SA
:

307 
	`EXPECT_EQ
(10, 
¥ec
.
š‹rv®
);

308 
	`EXPECT_STREQ
("mi", 
¥ec
.
devÇme
.
	`c_¡r
());

309 
	`EXPECT_STREQ
("Sy¡em Temp", 
¥ec
.
fùemps
.
	`c_¡r
());

310 
	`EXPECT_EQ
(20, 
¥ec
.
mš‹mp
);

311 
	`EXPECT_EQ
(60, 
¥ec
.
max‹mp
);

312 
	`EXPECT_EQ
(50, 
¥ec
.
mš¡¬t
);

313 
	`EXPECT_EQ
(0, 
¥ec
.
mš¡İ
);

314 
	`EXPECT_EQ
(0, 
¥ec
.
mšpwm
);

315 
	`EXPECT_EQ
(255, 
¥ec
.
maxpwm
);

316 
	`EXPECT_EQ
(58, 
¥ec
.
maxıu‹mp
);

317 
	`EXPECT_STREQ
("CPU CÜTemp", 
¥ec
.
ıu‹mps
.
	`c_¡r
());

318 
	`EXPECT_STREQ
("Fª7", 
¥ec
.
ıuçns
.
	`c_¡r
());

320 
	`EXPECT_STREQ
("Fª1", 
¥ec
.
fcçns
[0].
	`c_¡r
());

321 
	`EXPECT_STREQ
("Fª2", 
¥ec
.
fcçns
[1].
	`c_¡r
());

322 
	`EXPECT_STREQ
("Fª3", 
¥ec
.
fcçns
[2].
	`c_¡r
());

323 
	`EXPECT_STREQ
("Fª4", 
¥ec
.
fcçns
[3].
	`c_¡r
());

324 
	`EXPECT_STREQ
("Fª5", 
¥ec
.
fcçns
[4].
	`c_¡r
());

325 
	`EXPECT_STREQ
("Fª6", 
¥ec
.
fcçns
[5].
	`c_¡r
());

326 
	`EXPECT_STREQ
("Fª8", 
¥ec
.
fcçns
[6].
	`c_¡r
());

331 
	}
}

333 
	$maš
(
¬gc
, * 
¬gv
[])

335 
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

336  
	`RUN_ALL_TESTS
();

337 
	}
}

	@../scew/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../scew/unittest/xml_crash_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"sûw/xml_©Œibu‹.h
"

3 
	~"sûw/xml_–em’t.h
"

4 
	~"sûw/xml_Œ“.h
"

5 
	~"sûw/xml_ut™y.h
"

7 
	~<¡dio.h
>

8 
	~<¡dlib.h
>

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 
	$TEST
(
XMLC¿shTe¡
, 
Em±yBufãrTe¡
)

14 
i
 = 0; i < 100; i++)

16 
XMLT»e
 
Œ“
;

17 
XMLEËm’t
 
roÙ
;

19 
¡d
::
¡ršg
 
bufãr
 = "";

20 
	`EXPECT_EQ
(
çl£
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“
));

22 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

23 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

24 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘CÚ‹Á
().
	`c_¡r
());

25 
	`EXPECT_EQ
((
ušt32_t
)0, 
roÙ
.
	`G‘ChdCouÁ
());

27 
i
 = 0; i < 100; i++)

30 
XMLT»e
 
Œ“
;

31 
XMLEËm’t
 
roÙ
;

33 
¡d
::
¡ršg
 
bufãr
 = "";

34 
	`EXPECT_EQ
(
çl£
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“
));

36 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

37 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

38 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘CÚ‹Á
().
	`c_¡r
());

39 
	`EXPECT_EQ
((
ušt32_t
)0, 
roÙ
.
	`G‘ChdCouÁ
());

42 
XMLT»e
 
Œ“
;

43 
XMLEËm’t
 
roÙ
;

45 
¡d
::
¡ršg
 
bufãr
 = "<?xml version=\"1.0\"ƒncoding=\"UTF-8\"?><Register><RecordingServer id=\"1234567890\" version=\"1.2.3.4.5\"/></Register>";

46 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“
));

48 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

49 
	`EXPECT_STREQ
("Regi¡”", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

50 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘CÚ‹Á
().
	`c_¡r
());

51 
	`EXPECT_EQ
((
ušt32_t
)1, 
roÙ
.
	`G‘ChdCouÁ
());

54 
	}
}

56 
	$TEST
(
XMLC¿shTe¡
, 
G¬bageBufãrTe¡
)

58 
i
 = 0; i < 100; i++)

60 
XMLT»e
 
Œ“
;

61 
XMLEËm’t
 
roÙ
;

63 
¡d
::
¡ršg
 
bufãr
 = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";

64 
	`EXPECT_EQ
(
çl£
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“
));

66 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

67 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

68 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘CÚ‹Á
().
	`c_¡r
());

69 
	`EXPECT_EQ
((
ušt32_t
)0, 
roÙ
.
	`G‘ChdCouÁ
());

71 
i
 = 0; i < 100; i++)

74 
XMLT»e
 
Œ“
;

75 
XMLEËm’t
 
roÙ
;

77 
¡d
::
¡ršg
 
bufãr
 = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";

78 
	`EXPECT_EQ
(
çl£
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“
));

80 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

81 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

82 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘CÚ‹Á
().
	`c_¡r
());

83 
	`EXPECT_EQ
((
ušt32_t
)0, 
roÙ
.
	`G‘ChdCouÁ
());

86 
XMLT»e
 
Œ“
;

87 
XMLEËm’t
 
roÙ
;

89 
¡d
::
¡ršg
 
bufãr
 = "<?xml version=\"1.0\"ƒncoding=\"UTF-8\"?><Register><RecordingServer id=\"1234567890\" version=\"1.2.3.4.5\"/></Register>";

90 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“
));

92 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

93 
	`EXPECT_STREQ
("Regi¡”", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

94 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘CÚ‹Á
().
	`c_¡r
());

95 
	`EXPECT_EQ
((
ušt32_t
)1, 
roÙ
.
	`G‘ChdCouÁ
());

98 
	}
}

100 
	$TEST
(
XMLC¿shTe¡
, 
Brok’BufãrTe¡
)

102 
¡d
::
¡ršg
 
Üigš®_bufãr
 = "<?xml version=\"1.0\"ƒncoding=\"UTF-8\"?><Register><RecordingServer id=\"1234567890\" version=\"1.2.3.4.5\"/></Register>";

103 
i
 = 0; i < 100; i++)

105 
size_t
 
Ën
 = 0;†’ <ğ
Üigš®_bufãr
.
	`Ëngth
();†en++)

107 
XMLT»e
 
Œ“
;

108 
XMLEËm’t
 
roÙ
;

110 
¡d
::
¡ršg
 
bufãr
 = 
Üigš®_bufãr
.
	`sub¡r
(0, 
Ën
);

111 ià(
Ën
 !ğ
Üigš®_bufãr
.
	`Ëngth
())

113 
	`EXPECT_EQ
(
çl£
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“
));

114 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

116 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

117 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘CÚ‹Á
().
	`c_¡r
());

118 
	`EXPECT_EQ
((
ušt32_t
)0, 
roÙ
.
	`G‘ChdCouÁ
());

122 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“
));

124 
roÙ
 = 
Œ“
.
	`G‘RoÙ
();

125 
	`EXPECT_STREQ
("Regi¡”", 
roÙ
.
	`G‘Name
().
	`c_¡r
());

126 
	`EXPECT_STREQ
("", 
roÙ
.
	`G‘CÚ‹Á
().
	`c_¡r
());

127 
	`EXPECT_EQ
((
ušt32_t
)1, 
roÙ
.
	`G‘ChdCouÁ
());

131 
	}
}

	@../scew/unittest/xml_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"sûw/xml_©Œibu‹.h
"

3 
	~"sûw/xml_–em’t.h
"

4 
	~"sûw/xml_Œ“.h
"

5 
	~"sûw/xml_ut™y.h
"

7 
	~<¡dio.h
>

8 
	~<¡dlib.h
>

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 
	$TEST
(
XMLTe¡
, 
LßdSaveNÙeTe¡
)

14 
XMLT»e
 
Œ“
;

15 
XMLEËm’t
 
–em’t
;

16 
XMLEËm’t
 
chd_–em’t
;

18 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»e
("nÙe.xml", 
Œ“
));

20 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

21 
	`EXPECT_EQ
((
ušt32_t
)4, 
–em’t
.
	`G‘ChdCouÁ
());

22 
	`EXPECT_TRUE
(
–em’t
.
	`AddChd
("po¡süt", "Somebody."è!ğ
XMLEËm’t
::
em±y_–em’t
);

24 
	`EXPECT_EQ
(
Œue
, 
	`SaveXMLT»e
("nÙe_ouut.xml", 
Œ“
));

25 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»e
("nÙe_ouut.xml", 
Œ“
));

27 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

28 
	`EXPECT_EQ
((
ušt32_t
)5, 
–em’t
.
	`G‘ChdCouÁ
());

29 
	`EXPECT_STREQ
("nÙe", 
–em’t
.
	`G‘Name
().
	`c_¡r
());

30 
	`EXPECT_STREQ
("", 
–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

31 
	`EXPECT_EQ
((
ušt32_t
)0, 
–em’t
.
	`G‘A‰ribu‹CouÁ
());

32 
	`EXPECT_EQ
((
ušt32_t
)0, 
–em’t
.
	`G‘A‰ribu‹s
().
	`size
());

33 
	`EXPECT_TRUE
(
–em’t
 =ğ–em’t.
	`G‘RoÙ
());

34 
	`EXPECT_TRUE
(
–em’t
 !ğ–em’t.
	`G‘P¬’t
());

35 
	`EXPECT_TRUE
(
–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

36 
	`EXPECT_TRUE
(
–em’t
.
	`G‘P¬’t
(è=ğ
XMLEËm’t
::
em±y_–em’t
);

38 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
("to");

39 
	`EXPECT_STREQ
("to", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

40 
	`EXPECT_STREQ
("Tove", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

41 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

42 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹s
().
	`size
());

43 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘RoÙ
());

44 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

45 
	`EXPECT_TRUE
(
chd_–em’t
.
	`G‘Chd
("to"è=ğ
XMLEËm’t
::
em±y_–em’t
);

47 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
("from");

48 
	`EXPECT_STREQ
("äom", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

49 
	`EXPECT_STREQ
("Jªi", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

50 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

51 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹s
().
	`size
());

52 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘RoÙ
());

53 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

54 
	`EXPECT_TRUE
(
chd_–em’t
.
	`G‘Chd
("äom"è=ğ
XMLEËm’t
::
em±y_–em’t
);

56 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
("heading");

57 
	`EXPECT_STREQ
("h—dšg", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

58 
	`EXPECT_STREQ
("Remšd”", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

59 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

60 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹s
().
	`size
());

61 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘RoÙ
());

62 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

63 
	`EXPECT_TRUE
(
chd_–em’t
.
	`G‘Chd
("h—dšg"è=ğ
XMLEËm’t
::
em±y_–em’t
);

65 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
("body");

66 
	`EXPECT_STREQ
("body", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

67 
	`EXPECT_STREQ
("DÚ'ˆfÜg‘ mthi w“k’d!", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

68 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

69 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹s
().
	`size
());

70 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘RoÙ
());

71 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

72 
	`EXPECT_TRUE
(
chd_–em’t
.
	`G‘Chd
("body"è=ğ
XMLEËm’t
::
em±y_–em’t
);

74 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
("postscript");

75 
	`EXPECT_STREQ
("po¡süt", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

76 
	`EXPECT_STREQ
("Somebody.", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

77 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

78 
	`EXPECT_EQ
((
ušt32_t
)0, 
chd_–em’t
.
	`G‘A‰ribu‹s
().
	`size
());

79 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘RoÙ
());

80 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

81 
	`EXPECT_TRUE
(
chd_–em’t
.
	`G‘Chd
("po¡süt"è=ğ
XMLEËm’t
::
em±y_–em’t
);

82 
	}
}

84 
	$TEST
(
XMLTe¡
, 
LßdSaveBooksTe¡
)

86 
XMLT»e
 
Œ“
;

87 
XMLEËm’t
 
–em’t
;

88 
XMLEËm’t
 
chd_–em’t
;

89 
XMLA‰ribu‹
 
©Œibu‹
;

90 
¡d
::
veùÜ
<
XMLEËm’t
> 
chd»n
;

91 
¡d
::
veùÜ
<
XMLA‰ribu‹
> 
©Œibu‹s
;

93 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»e
("books.xml", 
Œ“
));

95 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

96 
	`EXPECT_EQ
((
ušt32_t
)12, 
–em’t
.
	`G‘ChdCouÁ
());

97 
–em’t
.
	`RemoveChd
(11);

98 
–em’t
.
	`RemoveChd
(6);

99 
–em’t
.
	`RemoveChd
(0);

100 
	`EXPECT_EQ
((
ušt32_t
)9, 
–em’t
.
	`G‘ChdCouÁ
());

102 
	`EXPECT_EQ
(
Œue
, 
	`SaveXMLT»e
("books_ouut.xml", 
Œ“
));

103 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»e
("books_ouut.xml", 
Œ“
));

105 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

106 
	`EXPECT_EQ
((
ušt32_t
)9, 
–em’t
.
	`G‘ChdCouÁ
());

107 
	`EXPECT_STREQ
("ÿlog", 
–em’t
.
	`G‘Name
().
	`c_¡r
());

108 
	`EXPECT_STREQ
("", 
–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

109 
	`EXPECT_EQ
((
ušt32_t
)0, 
–em’t
.
	`G‘A‰ribu‹CouÁ
());

110 
	`EXPECT_EQ
((
ušt32_t
)0, 
–em’t
.
	`G‘A‰ribu‹s
().
	`size
());

111 
	`EXPECT_TRUE
(
–em’t
 =ğ–em’t.
	`G‘RoÙ
());

112 
	`EXPECT_TRUE
(
–em’t
 !ğ–em’t.
	`G‘P¬’t
());

113 
	`EXPECT_TRUE
(
–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

114 
	`EXPECT_TRUE
(
–em’t
.
	`G‘P¬’t
(è=ğ
XMLEËm’t
::
em±y_–em’t
);

116 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
("book");

117 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

118 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

119 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

120 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

121 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

122 
	`EXPECT_STREQ
("bk102", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

123 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

124 
©Œibu‹s
 = 
chd_–em’t
.
	`G‘A‰ribu‹s
();

125 
	`EXPECT_EQ
((
ušt32_t
)1, 
©Œibu‹s
.
	`size
());

126 
	`EXPECT_TRUE
(
©Œibu‹
 =ğ
©Œibu‹s
[0]);

127 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘RoÙ
());

128 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

130 
chd»n
 = 
–em’t
.
	`G‘Chd»n
();

131 
	`EXPECT_EQ
((
ušt32_t
)9, 
chd»n
.
	`size
());

133 
chd»n
 = 
–em’t
.
	`G‘Chd»n
("book");

134 
	`EXPECT_EQ
((
ušt32_t
)9, 
chd»n
.
	`size
());

136 
chd_–em’t
 = 
chd»n
[0];

137 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

138 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

139 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

140 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

141 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

142 
	`EXPECT_STREQ
("bk102", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

143 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

144 
	`EXPECT_STREQ
("R®ls, Kim", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

145 
	`EXPECT_STREQ
("MidnighˆRaš", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

146 
	`EXPECT_STREQ
("Fªsy", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

147 
	`EXPECT_STREQ
("5.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

148 
	`EXPECT_STREQ
("2000-12-16", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

149 
	`EXPECT_STREQ
("A fÜm”‡rch™eù b©e cÜpÜ©zomb›s, \À‡Àev sÜû»ss,‡nd h” owÀchdhoodØbecomqu“À\À oàthwÜld.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

151 
chd_–em’t
 = 
chd»n
[1];

152 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

153 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

154 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

155 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

156 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

157 
	`EXPECT_STREQ
("bk103", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

158 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

159 
	`EXPECT_STREQ
("CÜ‘s, Eva", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

160 
	`EXPECT_STREQ
("M«vAsûndªt", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

161 
	`EXPECT_STREQ
("Fªsy", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

162 
	`EXPECT_STREQ
("5.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

163 
	`EXPECT_STREQ
("2000-11-17", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

164 
	`EXPECT_STREQ
("Aá”hcŞÏp£ oà¨ÇnÙechnŞogy \À soc›ty iÀEngÏnd,hyoung survivÜ Ïyh\À found©iÚ fÜ‡‚ew soc›ty.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

166 
chd_–em’t
 = 
chd»n
[2];

167 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

168 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

169 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

170 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

171 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

172 
	`EXPECT_STREQ
("bk104", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

173 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

174 
	`EXPECT_STREQ
("CÜ‘s, Eva", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

175 
	`EXPECT_STREQ
("Ob”Ú' Legacy", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

176 
	`EXPECT_STREQ
("Fªsy", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

177 
	`EXPECT_STREQ
("5.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

178 
	`EXPECT_STREQ
("2001-03-10", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

179 
	`EXPECT_STREQ
("IÀpo¡-­oÿlyp£ EngÏnd,hmy¡”iou \À‡g’ˆknowÀÚly‡ Ob”Ú h–p tØü—‹‡‚ew†iã \À fÜhšhab™ªt oàLÚdÚ. Sequ–ØM«v\À Asûndªt.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

181 
chd_–em’t
 = 
chd»n
[3];

182 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

183 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

184 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

185 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

186 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

187 
	`EXPECT_STREQ
("bk105", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

188 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

189 
	`EXPECT_STREQ
("CÜ‘s, Eva", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

190 
	`EXPECT_STREQ
("ThSund”ed G¿", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

191 
	`EXPECT_STREQ
("Fªsy", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

192 
	`EXPECT_STREQ
("5.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

193 
	`EXPECT_STREQ
("2001-09-10", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

194 
	`EXPECT_STREQ
("ThtwØdaugh‹r oàM«ve, h®f-si¡”s, \À b©ÚªÙh” fÜ cÚŒŞ oàEngÏnd. Sequ–Ø\À Ob”Ú' Legacy.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

196 
chd_–em’t
 = 
chd»n
[4];

197 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

198 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

199 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

200 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

201 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

202 
	`EXPECT_STREQ
("bk106", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

203 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

204 
	`EXPECT_STREQ
("Rªd®l, CyÁhŸ", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

205 
	`EXPECT_STREQ
("Lov” Bœds", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

206 
	`EXPECT_STREQ
("Romªû", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

207 
	`EXPECT_STREQ
("4.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

208 
	`EXPECT_STREQ
("2000-09-02", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

209 
	`EXPECT_STREQ
("Wh’ C¬Ï m“t PauÈ©‡ÀÜn™hŞogy \À cÚã»nû,em³r æy‡ ã©h” g‘„ufæed.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

211 
chd_–em’t
 = 
chd»n
[5];

212 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

213 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

214 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

215 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

216 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

217 
	`EXPECT_STREQ
("bk108", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

218 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

219 
	`EXPECT_STREQ
("KnÜr, S‹çn", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

220 
	`EXPECT_STREQ
("C»•y C¿wl›s", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

221 
	`EXPECT_STREQ
("HÜrÜ", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

222 
	`EXPECT_STREQ
("4.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

223 
	`EXPECT_STREQ
("2000-12-06", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

224 
	`EXPECT_STREQ
("AÀªthŞogy oàhÜrÜ stÜ› abouˆrßches,\À c’tedes, scÜpiÚ ‡nd oth” in£ùs.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

226 
chd_–em’t
 = 
chd»n
[6];

227 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

228 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

229 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

230 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

231 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

232 
	`EXPECT_STREQ
("bk109", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

233 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

234 
	`EXPECT_STREQ
("K»ss, P‘”", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

235 
	`EXPECT_STREQ
("P¬adox Lo¡", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

236 
	`EXPECT_STREQ
("Sc›nû FiùiÚ", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

237 
	`EXPECT_STREQ
("6.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

238 
	`EXPECT_STREQ
("2000-11-02", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

239 
	`EXPECT_STREQ
("Aá”‡Àšadv”Árhrough‡ Hei£nb”g\À Unû¹ašty Deviû, Jame S®way discov” th´obËm \À oàbešg quªtum.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

241 
chd_–em’t
 = 
chd»n
[7];

242 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

243 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

244 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

245 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

246 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

247 
	`EXPECT_STREQ
("bk110", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

248 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

249 
	`EXPECT_STREQ
("O'Br›n, Tim", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

250 
	`EXPECT_STREQ
("Miüosoá .NET: ThProg¿mmšg BibË", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

251 
	`EXPECT_STREQ
("Compu‹r", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

252 
	`EXPECT_STREQ
("36.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

253 
	`EXPECT_STREQ
("2000-12-09", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

254 
	`EXPECT_STREQ
("Miüosoá' .NET in™Ÿtivi ex¶Üed iÀ\À d‘a iÀthi d“°´og¿mm”' »ã»nû.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

256 
chd_–em’t
 = 
chd»n
[8];

257 
	`EXPECT_STREQ
("book", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

258 
	`EXPECT_STREQ
("", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

259 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

260 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

261 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

262 
	`EXPECT_STREQ
("bk111", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

263 
	`EXPECT_EQ
((
ušt32_t
)1, 
chd_–em’t
.
	`G‘A‰ribu‹CouÁ
());

264 
	`EXPECT_STREQ
("O'Br›n, Tim", 
chd_–em’t
.
	`G‘Chd
("authÜ").
	`G‘CÚ‹Á
().
	`c_¡r
());

265 
	`EXPECT_STREQ
("MSXML3: A Com´eh’sivGuide", 
chd_–em’t
.
	`G‘Chd
("t™Ë").
	`G‘CÚ‹Á
().
	`c_¡r
());

266 
	`EXPECT_STREQ
("Compu‹r", 
chd_–em’t
.
	`G‘Chd
("g’»").
	`G‘CÚ‹Á
().
	`c_¡r
());

267 
	`EXPECT_STREQ
("36.95", 
chd_–em’t
.
	`G‘Chd
("´iû").
	`G‘CÚ‹Á
().
	`c_¡r
());

268 
	`EXPECT_STREQ
("2000-12-01", 
chd_–em’t
.
	`G‘Chd
("publish_d©e").
	`G‘CÚ‹Á
().
	`c_¡r
());

269 
	`EXPECT_STREQ
("ThMiüosoá MSXML3…¬£¸i cov”ed iÀ\À d‘a, w™h‡‰’tiÚØXML DOM iÁ”çûs, XSLT…roûssšg, \À SAX‡nd mÜe.", 
chd_–em’t
.
	`G‘Chd
("desütiÚ").
	`G‘CÚ‹Á
().
	`c_¡r
());

270 
	}
}

272 
	$TEST
(
XMLTe¡
, 
LßdSaveBufãrTe¡
)

274 
¡d
::
¡ršg
 
bufãr
 = "<?xml version=\"1.0\"ƒncoding=\"UTF-8\"?><Register><RecordingServer id=\"1234567890\" version=\"1.2.3.4.5\"/></Register>";

275 
XMLT»e
 
Œ“_»que¡
;

276 
XMLT»e
 
Œ“_»¥Ú£
;

277 
XMLT»e
 
Œ“_bufãr
;

278 
XMLT»e
 
Œ“_fe
;

279 
XMLEËm’t
 
–em’t
;

280 
XMLEËm’t
 
chd_–em’t
;

281 
XMLA‰ribu‹
 
©Œibu‹
;

283 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“_»que¡
));

284 
–em’t
 = 
Œ“_»que¡
.
	`G‘RoÙ
();

285 
	`EXPECT_STREQ
("Regi¡”", 
–em’t
.
	`G‘Name
().
	`c_¡r
());

286 
chd_–em’t
 = 
–em’t
.
	`G‘Chd
("RecordingServer");

287 
	`EXPECT_STREQ
("RecÜdšgS”v”", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

288 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("id");

289 
	`EXPECT_STREQ
("id", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

290 
	`EXPECT_STREQ
("1234567890", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

291 
©Œibu‹
 = 
chd_–em’t
.
	`G‘A‰ribu‹
("version");

292 
	`EXPECT_STREQ
("v”siÚ", 
©Œibu‹
.
	`G‘Name
().
	`c_¡r
());

293 
	`EXPECT_STREQ
("1.2.3.4.5", 
©Œibu‹
.
	`G‘V®ue
().
	`c_¡r
());

295 
–em’t
 = 
Œ“_»¥Ú£
.
	`G‘RoÙ
();

296 
	`EXPECT_TRUE
(
–em’t
 =ğ
XMLEËm’t
::
em±y_–em’t
);

297 
–em’t
 = 
Œ“_»¥Ú£
.
	`S‘RoÙ
("Register");

298 
	`EXPECT_TRUE
(
–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

300 
chd_–em’t
 = 
–em’t
.
	`AddChd
("ReturnCode", "12345");

301 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

302 
chd_–em’t
 = 
–em’t
.
	`AddChd
("ManagementServer");

303 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

304 
©Œibu‹
 = 
chd_–em’t
.
	`AddA‰ribu‹
("id", "3456789012");

305 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

306 
©Œibu‹
 = 
chd_–em’t
.
	`AddA‰ribu‹
("version", "3.4.5.6.7");

307 
chd_–em’t
 = 
–em’t
.
	`AddChd
("RecordingServer");

308 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

309 
©Œibu‹
 = 
chd_–em’t
.
	`AddA‰ribu‹
("id", "5678901234");

310 
	`EXPECT_TRUE
(
©Œibu‹
 !ğ
XMLA‰ribu‹
::
em±y_©Œibu‹
);

311 
©Œibu‹
 = 
chd_–em’t
.
	`AddA‰ribu‹
("version", "5.6.7.8.9");

313 
	`EXPECT_TRUE
(
Œ“_»que¡
 !ğ
Œ“_»¥Ú£
);

315 
	`EXPECT_EQ
(
Œue
, 
	`SaveXMLT»eBufãr
(
bufãr
, 
Œ“_»¥Ú£
));

316 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»eBufãr
(
bufãr
, 
Œ“_bufãr
));

317 
	`EXPECT_TRUE
(
Œ“_»¥Ú£
 =ğ
Œ“_bufãr
);

319 
	`EXPECT_EQ
(
Œue
, 
	`SaveXMLT»e
("»gi¡”_»¥Ú£.xml", 
Œ“_»¥Ú£
));

320 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»e
("»gi¡”_»¥Ú£.xml", 
Œ“_fe
));

321 
	`EXPECT_TRUE
(
Œ“_»¥Ú£
 =ğ
Œ“_fe
);

322 
	}
}

324 
	$TEST
(
XMLTe¡
, 
P»viousNextTe¡
)

326 
XMLT»e
 
Œ“
;

327 
XMLEËm’t
 
–em’t
;

328 
XMLEËm’t
 
chd_–em’t
;

330 
	`EXPECT_EQ
(
Œue
, 
	`LßdXMLT»e
("nÙe.xml", 
Œ“
));

332 
–em’t
 = 
Œ“
.
	`G‘RoÙ
();

333 
	`EXPECT_EQ
((
ušt32_t
)4, 
–em’t
.
	`G‘ChdCouÁ
());

334 
	`EXPECT_TRUE
(
–em’t
.
	`G‘P¬’t
(è=ğ
XMLEËm’t
::
em±y_–em’t
);

335 
	`EXPECT_TRUE
(
–em’t
.
	`G‘RoÙ
() ==ƒlement);

336 
	`EXPECT_TRUE
(
–em’t
.
	`G‘P»vious
(è=ğ
XMLEËm’t
::
em±y_–em’t
);

337 
	`EXPECT_TRUE
(
–em’t
.
	`G‘Next
(è=ğ
XMLEËm’t
::
em±y_–em’t
);

339 
chd_–em’t
 = 
–em’t
.
	`G‘Fœ¡Chd
();

340 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

341 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

342 
	`EXPECT_STREQ
("to", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

343 
	`EXPECT_STREQ
("Tove", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

344 
chd_–em’t
 = chd_–em’t.
	`G‘Next
();

345 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

346 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

347 
	`EXPECT_STREQ
("äom", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

348 
	`EXPECT_STREQ
("Jªi", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

349 
chd_–em’t
 = chd_–em’t.
	`G‘Next
();

350 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

351 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

352 
	`EXPECT_STREQ
("h—dšg", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

353 
	`EXPECT_STREQ
("Remšd”", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

354 
chd_–em’t
 = chd_–em’t.
	`G‘Next
();

355 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

356 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

357 
	`EXPECT_STREQ
("body", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

358 
	`EXPECT_STREQ
("DÚ'ˆfÜg‘ mthi w“k’d!", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

359 
chd_–em’t
 = chd_–em’t.
	`G‘Next
();

360 
	`EXPECT_TRUE
(
chd_–em’t
 =ğ
XMLEËm’t
::
em±y_–em’t
);

362 
chd_–em’t
 = 
–em’t
.
	`G‘La¡Chd
();

363 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

364 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

365 
	`EXPECT_STREQ
("body", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

366 
	`EXPECT_STREQ
("DÚ'ˆfÜg‘ mthi w“k’d!", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

367 
chd_–em’t
 = chd_–em’t.
	`G‘P»vious
();

368 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

369 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

370 
	`EXPECT_STREQ
("h—dšg", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

371 
	`EXPECT_STREQ
("Remšd”", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

372 
chd_–em’t
 = chd_–em’t.
	`G‘P»vious
();

373 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

374 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

375 
	`EXPECT_STREQ
("äom", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

376 
	`EXPECT_STREQ
("Jªi", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

377 
chd_–em’t
 = chd_–em’t.
	`G‘P»vious
();

378 
	`EXPECT_TRUE
(
–em’t
 =ğ
chd_–em’t
.
	`G‘P¬’t
());

379 
	`EXPECT_TRUE
(
chd_–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

380 
	`EXPECT_STREQ
("to", 
chd_–em’t
.
	`G‘Name
().
	`c_¡r
());

381 
	`EXPECT_STREQ
("Tove", 
chd_–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

382 
chd_–em’t
 = chd_–em’t.
	`G‘P»vious
();

383 
	`EXPECT_TRUE
(
chd_–em’t
 =ğ
XMLEËm’t
::
em±y_–em’t
);

384 
	}
}

386 
	$TEST
(
XMLTe¡
, 
Esÿ³Te¡
)

388 
d–im™”s
[] = "<>&'\"";

389 
XMLT»e
 
Œ“
;

390 
XMLEËm’t
 
roÙ
;

391 
XMLEËm’t
 
–em’t
;

392 
¡d
::
¡ršg
 
bufãr
;

394 
roÙ
 = 
Œ“
.
	`S‘RoÙ
("Root");

395 
	`EXPECT_TRUE
(
roÙ
 !ğ
XMLEËm’t
::
em±y_–em’t
);

396 
–em’t
 = 
roÙ
.
	`AddChd
("D–im™”", 
d–im™”s
);

397 
	`EXPECT_TRUE
(
–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

398 
–em’t
 = 
roÙ
.
	`G‘Chd
("Delimiter");

399 
	`EXPECT_TRUE
(
–em’t
 !ğ
XMLEËm’t
::
em±y_–em’t
);

400 
	`EXPECT_STREQ
(
d–im™”s
, 
–em’t
.
	`G‘CÚ‹Á
().
	`c_¡r
());

401 
	`EXPECT_TRUE
(
	`SaveXMLT»eBufãr
(
bufãr
, 
Œ“
));

403 
	`EXPECT_TRUE
(
bufãr
.
	`fšd
("&É;"è!ğ
¡d
::
¡ršg
::
Åos
);

404 
	`EXPECT_TRUE
(
bufãr
.
	`fšd
("&gt;"è!ğ
¡d
::
¡ršg
::
Åos
);

405 
	`EXPECT_TRUE
(
bufãr
.
	`fšd
("&amp;"è!ğ
¡d
::
¡ršg
::
Åos
);

406 
	`EXPECT_TRUE
(
bufãr
.
	`fšd
("&­os;"è!ğ
¡d
::
¡ršg
::
Åos
);

407 
	`EXPECT_TRUE
(
bufãr
.
	`fšd
("&quÙ;"è!ğ
¡d
::
¡ršg
::
Åos
);

408 
	}
}

	@../scew/xml_attribute.cpp

1 
	~"xml_©Œibu‹.h
"

3 
	~"sûw/li¡.h
"

5 
	~"commÚ/ut™y.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
DLL_PUBLIC
 cÚ¡ 
XMLA‰ribu‹
 
	gXMLA‰ribu‹
::
em±y_©Œibu‹
 = XMLAttribute();

11 
DLL_PUBLIC
 
	gXMLA‰ribu‹
::
	$XMLA‰ribu‹
()

12 : 
	$m_©Œibu‹
(
NULL
)

14 
	}
}

16 
DLL_PUBLIC
 
XMLA‰ribu‹
::
	$XMLA‰ribu‹
(
sûw_©Œibu‹
 *
©Œibu‹
)

17 : 
	$m_©Œibu‹
(
©Œibu‹
)

19 
	}
}

21 
DLL_PUBLIC
 
XMLA‰ribu‹
::~
	$XMLA‰ribu‹
()

23 
	}
}

25 
DLL_PUBLIC
 
boŞ
 
XMLA‰ribu‹
::
İ”©Ü
==(cÚ¡ XMLA‰ribu‹ &
rhs
)

27  
m_©Œibu‹
 =ğ
rhs
.m_attribute;

30 
DLL_PUBLIC
 
boŞ
 
	gXMLA‰ribu‹
::
İ”©Ü
!=(cÚ¡ 
XMLA‰ribu‹
 &
rhs
)

32  !(*
this
 =ğ
rhs
);

35 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
XMLA‰ribu‹
::
	$G‘Name
() const

37 
	`IF_NULL_RETURN_VALUE
(
m_©Œibu‹
, "");

38 
XML_Ch¬
 cÚ¡ *
Çme
 = 
	`sûw_©Œibu‹_Çme
(
m_©Œibu‹
);

39  (
Çme
 !ğ
NULL
) ?‚ame : "";

40 
	}
}

42 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
XMLA‰ribu‹
::
	$G‘V®ue
() const

44 
	`IF_NULL_RETURN_VALUE
(
m_©Œibu‹
, "");

45 
XML_Ch¬
 cÚ¡ *
v®ue
 = 
	`sûw_©Œibu‹_v®ue
(
m_©Œibu‹
);

46  (
v®ue
 !ğ
NULL
) ? value : "";

47 
	}
}

49 
DLL_PUBLIC
 
boŞ
 
	gXMLA‰ribu‹
::
	$S‘Name
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

51 
	`IF_NULL_RETURN_VALUE
(
m_©Œibu‹
, 
çl£
);

52  
	`sûw_©Œibu‹_£t_Çme
(
m_©Œibu‹
, 
Çme
.
	`c_¡r
()è!ğ
NULL
;

53 
	}
}

55 
DLL_PUBLIC
 
boŞ
 
	gXMLA‰ribu‹
::
	$S‘V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
v®ue
)

57 
	`IF_NULL_RETURN_VALUE
(
m_©Œibu‹
, 
çl£
);

58  
	`sûw_©Œibu‹_£t_v®ue
(
m_©Œibu‹
, 
v®ue
.
	`c_¡r
()è!ğ
NULL
;

59 
	}
}

61 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
XMLA‰ribu‹
::
	$G‘SŒšg
() const

63  
	`G‘V®ue
();

64 
	}
}

66 
DLL_PUBLIC
 
boŞ
 
	gXMLA‰ribu‹
::
	$S‘SŒšg
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

68  
	`S‘V®ue
(
¡r
);

69 
	}
}

	@../scew/xml_attribute.h

1 #iâdeà
__SYSUTILS_XML_ATTRIBUTE_H__


2 
	#__SYSUTILS_XML_ATTRIBUTE_H__


	)

4 
	~"expÜts.h
"

6 
	~"sûw/©Œibu‹.h
"

8 
	~"xml_node.h
"

10 
	~<¡ršg
>

11 
	~<veùÜ
>

13 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

15 şas 
	cDLL_PUBLIC
 
	gXMLA‰ribu‹
: 
public
 
XMLNode


17 
public
:

18 
XMLA‰ribu‹
();

19 
XMLA‰ribu‹
(
sûw_©Œibu‹
 *
©Œibu‹
);

20 ~
XMLA‰ribu‹
();

22 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
XMLA‰ribu‹
 &
rhs
);

23 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
XMLA‰ribu‹
 &
rhs
);

26 
	g¡d
::
¡ršg
 
G‘Name
() const;

27 
	g¡d
::
¡ršg
 
G‘V®ue
() const;

28 
boŞ
 
S‘Name
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

29 
boŞ
 
S‘V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
v®ue
);

31 
	gpublic
:

32 cÚ¡ 
XMLA‰ribu‹
 
em±y_©Œibu‹
;

34 
	g´iv©e
:

35 
vœtu®
 
¡d
::
¡ršg
 
G‘SŒšg
() const;

36 
vœtu®
 
boŞ
 
S‘SŒšg
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

38 
	g´iv©e
:

39 
sûw_©Œibu‹
 *
m_©Œibu‹
;

	@../scew/xml_element.cpp

1 
	~"xml_–em’t.h
"

3 
	~"sûw/li¡.h
"

5 
	~"commÚ/ut™y.h
"

6 
	~"commÚ/¡ršg.h
"

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 
DLL_PUBLIC
 cÚ¡ 
XMLEËm’t
 
	gXMLEËm’t
::
em±y_–em’t
 = XMLElement();

12 
sûw_li¡
 *
	$G‘Siblšgs
(
sûw_–em’t
 *
_–em’t
)

14 
	`IF_NULL_RETURN_VALUE
(
_–em’t
, 
NULL
);

15 
sûw_–em’t
 *
_·»Á
 = 
	`sûw_–em’t_·»Á
(
_–em’t
);

16 
	`IF_NULL_RETURN_VALUE
(
_·»Á
, 
NULL
);

17  
	`sûw_–em’t_chd»n
(
_·»Á
);

18 
	}
}

20 
sûw_li¡
 *
	$G‘Li¡I‹m
(
sûw_–em’t
 *
_–em’t
)

22 
	`IF_NULL_RETURN_VALUE
(
_–em’t
, 
NULL
);

23 
sûw_li¡
 *
_siblšgs
 = 
	`G‘Siblšgs
(
_–em’t
);

24 
	`IF_NULL_RETURN_VALUE
(
_siblšgs
, 
NULL
);

25  
	`sûw_li¡_fšd
(
_siblšgs
, 
_–em’t
);

26 
	}
}

28 
sûw_–em’t
 *
	$G‘P»vious
(
sûw_–em’t
 *
_–em’t
)

30 
	`IF_NULL_RETURN_VALUE
(
_–em’t
, 
NULL
);

31 
sûw_li¡
 *
_this
 = 
	`G‘Li¡I‹m
(
_–em’t
);

32 
	`IF_NULL_RETURN_VALUE
(
_this
, 
NULL
);

33 
sûw_li¡
 *
_´evious
 = 
	`sûw_li¡_´evious
(
_this
);

34 
	`IF_NULL_RETURN_VALUE
(
_´evious
, 
NULL
);

35  (
sûw_–em’t
*)
	`sûw_li¡_d©a
(
_´evious
);

36 
	}
}

38 
sûw_–em’t
 *
	$G‘Next
(
sûw_–em’t
 *
_–em’t
)

40 
	`IF_NULL_RETURN_VALUE
(
_–em’t
, 
NULL
);

41 
sûw_li¡
 *
_this
 = 
	`G‘Li¡I‹m
(
_–em’t
);

42 
	`IF_NULL_RETURN_VALUE
(
_this
, 
NULL
);

43 
sûw_li¡
 *
_Ãxt
 = 
	`sûw_li¡_Ãxt
(
_this
);

44 
	`IF_NULL_RETURN_VALUE
(
_Ãxt
, 
NULL
);

45  (
sûw_–em’t
*)
	`sûw_li¡_d©a
(
_Ãxt
);

46 
	}
}

48 
sûw_–em’t
 *
	$G‘Fœ¡Chd
(
sûw_–em’t
 *
_–em’t
)

50 
	`IF_NULL_RETURN_VALUE
(
_–em’t
, 
NULL
);

51 
sûw_li¡
 *
_chd»n
 = 
	`sûw_–em’t_chd»n
(
_–em’t
);

52 
	`IF_NULL_RETURN_VALUE
(
_chd»n
, 
NULL
);

53 
sûw_li¡
 *
_fœ¡
 = 
	`sûw_li¡_fœ¡
(
_chd»n
);

54 
	`IF_NULL_RETURN_VALUE
(
_fœ¡
, 
NULL
);

55  (
sûw_–em’t
*)
	`sûw_li¡_d©a
(
_fœ¡
);

56 
	}
}

58 
sûw_–em’t
 *
	$G‘La¡Chd
(
sûw_–em’t
 *
_–em’t
)

60 
	`IF_NULL_RETURN_VALUE
(
_–em’t
, 
NULL
);

61 
sûw_li¡
 *
_chd»n
 = 
	`sûw_–em’t_chd»n
(
_–em’t
);

62 
	`IF_NULL_RETURN_VALUE
(
_chd»n
, 
NULL
);

63 
sûw_li¡
 *
_Ï¡
 = 
	`sûw_li¡_Ï¡
(
_chd»n
);

64 
	`IF_NULL_RETURN_VALUE
(
_Ï¡
, 
NULL
);

65  (
sûw_–em’t
*)
	`sûw_li¡_d©a
(
_Ï¡
);

66 
	}
}

68 
	g¡d
::
veùÜ
<
XMLEËm’t
> 
	$G‘EËm’tsFromLi¡
(
sûw_li¡
 *
_li¡
)

70 
¡d
::
veùÜ
<
XMLEËm’t
> 
–em’ts
;

72 ià(
_li¡
 !ğ
NULL
)

74 
sûw_li¡
 *
™
 = 
	`sûw_li¡_fœ¡
(
_li¡
); iˆ!ğ
NULL
; iˆğ
	`sûw_li¡_Ãxt
(it))

76 
–em’ts
.
	`push_back
(
	`XMLEËm’t
((
sûw_–em’t
*)
	`sûw_li¡_d©a
(
™
)));

80  
–em’ts
;

81 
	}
}

83 
	g¡d
::
veùÜ
<
XMLA‰ribu‹
> 
	$G‘A‰ribu‹sFromLi¡
(
sûw_li¡
 *
_li¡
)

85 
¡d
::
veùÜ
<
XMLA‰ribu‹
> 
©Œibu‹s
;

87 ià(
_li¡
 !ğ
NULL
)

89 
sûw_li¡
 *
™
 = 
	`sûw_li¡_fœ¡
(
_li¡
); iˆ!ğ
NULL
; iˆğ
	`sûw_li¡_Ãxt
(it))

91 
©Œibu‹s
.
	`push_back
(
	`XMLA‰ribu‹
((
sûw_©Œibu‹
*)
	`sûw_li¡_d©a
(
™
)));

95  
©Œibu‹s
;

96 
	}
}

98 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$XMLEËm’t
()

99 : 
	$m_–em’t
(
NULL
)

101 
	}
}

103 
DLL_PUBLIC
 
XMLEËm’t
::
	$XMLEËm’t
(
sûw_–em’t
 *
_–em’t
)

104 : 
	$m_–em’t
(
_–em’t
)

106 
	}
}

108 
DLL_PUBLIC
 
XMLEËm’t
::~
	$XMLEËm’t
()

110 
	}
}

112 
DLL_PUBLIC
 
XMLEËm’t
::
	$XMLEËm’t
(cÚ¡ 
XMLEËm’t
 &
rhs
)

113 : 
	$m_–em’t
(
rhs
.
m_–em’t
)

115 
	}
}

117 
DLL_PUBLIC
 
XMLEËm’t
 &XMLEËm’t::
İ”©Ü
=(cÚ¡ XMLEËm’ˆ&
rhs
)

119 ià(&
rhs
 !ğ
this
)

121 
m_–em’t
 = 
rhs
.m_element;

123  *
	gthis
;

126 
DLL_PUBLIC
 
sûw_–em’t
 *
	gXMLEËm’t
::
	$G‘SûwEËm’t
() const

128  
m_–em’t
;

129 
	}
}

131 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$S‘SûwEËm’t
(
sûw_–em’t
 *
_–em’t
)

133 
m_–em’t
 = 
_–em’t
;

134 
	}
}

136 
DLL_PUBLIC
 
boŞ
 
	gXMLEËm’t
::
İ”©Ü
==(cÚ¡ 
XMLEËm’t
 &
rhs
)

138  
m_–em’t
 =ğ
rhs
.m_element;

141 
DLL_PUBLIC
 
boŞ
 
	gXMLEËm’t
::
İ”©Ü
!=(cÚ¡ 
XMLEËm’t
 &
rhs
)

143  !(*
this
 =ğ
rhs
);

146 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$G‘Chd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
) const

148 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

149  
	`XMLEËm’t
(
	`sûw_–em’t_by_Çme
(
m_–em’t
, 
Çme
.
	`c_¡r
()));

150 
	}
}

152 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$G‘Chd
(cÚ¡ 
ušt32_t
 
šdex
) const

154 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

155  
	`XMLEËm’t
(
	`sûw_–em’t_by_šdex
(
m_–em’t
, 
šdex
));

156 
	}
}

158 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
XMLEËm’t
> XMLEËm’t::
	$G‘Chd»n
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
) const

160 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, ::
	`G‘EËm’tsFromLi¡
(
NULL
));

161 
sûw_li¡
 *
li¡
 = 
	`sûw_–em’t_li¡_by_Çme
(
m_–em’t
, 
Çme
.
	`c_¡r
());

162 
¡d
::
veùÜ
<
XMLEËm’t
> 
–em’ts
 = ::
	`G‘EËm’tsFromLi¡
(
li¡
);

163 
	`sûw_li¡_ä“
(
li¡
);

164  
–em’ts
;

165 
	}
}

167 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
XMLEËm’t
::
	$G‘Name
() const

169 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, "");

170 
XML_Ch¬
 cÚ¡ *
Çme
 = 
	`sûw_–em’t_Çme
(
m_–em’t
);

171  (
Çme
 !ğ
NULL
) ?‚ame : "";

172 
	}
}

174 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
XMLEËm’t
::
	$G‘CÚ‹Á
() const

176 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, "");

177 
XML_Ch¬
 cÚ¡ *
v®ue
 = 
	`sûw_–em’t_cÚ‹Ás
(
m_–em’t
);

178  (
v®ue
 !ğ
NULL
) ? value : "";

179 
	}
}

181 
DLL_PUBLIC
 
boŞ
 
	gXMLEËm’t
::
	$S‘Name
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

183 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
çl£
);

184  
	`sûw_–em’t_£t_Çme
(
m_–em’t
, 
Çme
.
	`c_¡r
()è!ğ
NULL
;

185 
	}
}

187 
DLL_PUBLIC
 
boŞ
 
	gXMLEËm’t
::
	$S‘CÚ‹Á
(cÚ¡ 
¡d
::
¡ršg
 &
cÚ‹Á
)

189 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
çl£
);

190  
	`sûw_–em’t_£t_cÚ‹Ás
(
m_–em’t
, 
cÚ‹Á
.
	`c_¡r
()è!ğ
NULL
;

191 
	}
}

193 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$CË¬CÚ‹Á
()

195 
	`IF_NULL_RETURN
(
m_–em’t
);

196 
	`sûw_–em’t_ä“_cÚ‹Ás
(
m_–em’t
);

197 
	}
}

199 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$G‘RoÙ
() const

201 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

202 
XMLEËm’t
 
	`–em’t
(*
this
);

203  
–em’t
.
	`GoToRoÙ
();

204 
	}
}

206 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$G‘P¬’t
() const

208 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

209 
XMLEËm’t
 
	`–em’t
(*
this
);

210  
–em’t
.
	`GoToP¬’t
();

211 
	}
}

213 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$G‘P»vious
() const

215 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

216 
XMLEËm’t
 
	`–em’t
(*
this
);

217  
–em’t
.
	`GoToP»vious
();

218 
	}
}

220 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$G‘Next
() const

222 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

223 
XMLEËm’t
 
	`–em’t
(*
this
);

224  
–em’t
.
	`GoToNext
();

225 
	}
}

227 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$G‘Fœ¡Chd
() const

229 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

230 
XMLEËm’t
 
	`–em’t
(*
this
);

231  
–em’t
.
	`GoToFœ¡Chd
();

232 
	}
}

234 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$G‘La¡Chd
() const

236 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

237 
XMLEËm’t
 
	`–em’t
(*
this
);

238  
–em’t
.
	`GoToLa¡Chd
();

239 
	}
}

241 
DLL_PUBLIC
 
ušt32_t
 
	gXMLEËm’t
::
	$G‘ChdCouÁ
() const

243 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 0);

244  
	`sûw_–em’t_couÁ
(
m_–em’t
);

245 
	}
}

247 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
XMLEËm’t
> XMLEËm’t::
	$G‘Chd»n
() const

249 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, ::
	`G‘EËm’tsFromLi¡
(
NULL
));

250  ::
	`G‘EËm’tsFromLi¡
(
	`sûw_–em’t_chd»n
(
m_–em’t
));

251 
	}
}

253 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

255 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

256  
	`XMLEËm’t
(
	`sûw_–em’t_add
(
m_–em’t
, 
Çme
.
	`c_¡r
()));

257 
	}
}

259 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
cÚ‹Á
)

261 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLEËm’t
::
em±y_–em’t
);

262  
	`XMLEËm’t
(
	`sûw_–em’t_add_·œ
(
m_–em’t
, 
Çme
.
	`c_¡r
(), 
cÚ‹Á
.c_str()));

263 
	}
}

265 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$RemoveAÎChd»n
()

267 
	`IF_NULL_RETURN
(
m_–em’t
);

268 
	`sûw_–em’t_d–‘e_®l
(
m_–em’t
);

269 
	}
}

271 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$RemoveAÎChd»n
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

273 
	`IF_NULL_RETURN
(
m_–em’t
);

274 
	`sûw_–em’t_d–‘e_®l_by_Çme
(
m_–em’t
, 
Çme
.
	`c_¡r
());

275 
	}
}

277 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$RemoveChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

279 
	`IF_NULL_RETURN
(
m_–em’t
);

280 
	`sûw_–em’t_d–‘e_by_Çme
(
m_–em’t
, 
Çme
.
	`c_¡r
());

281 
	}
}

283 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$RemoveChd
(cÚ¡ 
ušt32_t
 
šdex
)

285 
	`IF_NULL_RETURN
(
m_–em’t
);

286 
	`sûw_–em’t_d–‘e_by_šdex
(
m_–em’t
, 
šdex
);

287 
	}
}

289 
DLL_PUBLIC
 
ušt32_t
 
	gXMLEËm’t
::
	$G‘A‰ribu‹CouÁ
() const

291 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 0);

292  
	`sûw_–em’t_©Œibu‹_couÁ
(
m_–em’t
);

293 
	}
}

295 
DLL_PUBLIC
 
	g¡d
::
veùÜ
<
XMLA‰ribu‹
> 
XMLEËm’t
::
	$G‘A‰ribu‹s
() const

297 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, ::
	`G‘A‰ribu‹sFromLi¡
(
NULL
));

298  ::
	`G‘A‰ribu‹sFromLi¡
(
	`sûw_–em’t_©Œibu‹s
(
m_–em’t
));

299 
	}
}

301 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$G‘A‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
) const

303 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLA‰ribu‹
::
em±y_©Œibu‹
);

304  
	`XMLA‰ribu‹
(
	`sûw_–em’t_©Œibu‹_by_Çme
(
m_–em’t
, 
Çme
.
	`c_¡r
()));

305 
	}
}

307 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$G‘A‰ribu‹
(cÚ¡ 
ušt32_t
 
šdex
) const

309 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLA‰ribu‹
::
em±y_©Œibu‹
);

310  
	`XMLA‰ribu‹
(
	`sûw_–em’t_©Œibu‹_by_šdex
(
m_–em’t
, 
šdex
));

311 
	}
}

313 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
)

315 
	`IF_NULL_RETURN_VALUE
(
m_–em’t
, 
XMLA‰ribu‹
::
em±y_©Œibu‹
);

316  
	`XMLA‰ribu‹
(
	`sûw_–em’t_add_©Œibu‹_·œ
(
m_–em’t
, 
Çme
.
	`c_¡r
(), 
v®ue
.c_str()));

317 
	}
}

319 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$RemoveAÎA‰ribu‹s
()

321 
	`IF_NULL_RETURN
(
m_–em’t
);

322 
	`sûw_–em’t_d–‘e_©Œibu‹_®l
(
m_–em’t
);

323 
	}
}

325 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$RemoveA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

327 
	`IF_NULL_RETURN
(
m_–em’t
);

328 
	`sûw_–em’t_d–‘e_©Œibu‹_by_Çme
(
m_–em’t
, 
Çme
.
	`c_¡r
());

329 
	}
}

331 
DLL_PUBLIC
 
	gXMLEËm’t
::
	$RemoveA‰ribu‹
(cÚ¡ 
ušt32_t
 
šdex
)

333 
	`IF_NULL_RETURN
(
m_–em’t
);

334 
	`sûw_–em’t_d–‘e_©Œibu‹_by_šdex
(
m_–em’t
, 
šdex
);

335 
	}
}

337 
DLL_PUBLIC
 
	gXMLEËm’t
 &XMLEËm’t::
	$GoToRoÙ
()

339 
sûw_–em’t
 *
_–em’t
 = 
NULL
;

340 
sûw_–em’t
 *
_·»Á
 = 
m_–em’t
;

341 
_·»Á
 !ğ
NULL
)

343 
_–em’t
 = 
_·»Á
;

344 
_·»Á
 = 
	`sûw_–em’t_·»Á
(
_–em’t
);

346 
m_–em’t
 = 
_–em’t
;

347  *
this
;

348 
	}
}

350 
DLL_PUBLIC
 
	gXMLEËm’t
 &XMLEËm’t::
	$GoToP¬’t
()

352 ià(
m_–em’t
 !ğ
NULL
)

354 
m_–em’t
 = 
	`sûw_–em’t_·»Á
(m_element);

356  *
this
;

357 
	}
}

359 
DLL_PUBLIC
 
	gXMLEËm’t
 &XMLEËm’t::
	$GoToP»vious
()

361 ià(
m_–em’t
 !ğ
NULL
)

363 
m_–em’t
 = ::
	`G‘P»vious
(m_element);

365  *
this
;

366 
	}
}

368 
DLL_PUBLIC
 
	gXMLEËm’t
 &XMLEËm’t::
	$GoToNext
()

370 ià(
m_–em’t
 !ğ
NULL
)

372 
m_–em’t
 = ::
	`G‘Next
(m_element);

374  *
this
;

375 
	}
}

377 
DLL_PUBLIC
 
	gXMLEËm’t
 &XMLEËm’t::
	$GoToChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

379 ià(
m_–em’t
 !ğ
NULL
)

381 
m_–em’t
 = 
	`sûw_–em’t_by_Çme
(m_–em’t, 
Çme
.
	`c_¡r
());

383  *
this
;

384 
	}
}

386 
DLL_PUBLIC
 
	gXMLEËm’t
 &XMLEËm’t::
	$GoToChd
(cÚ¡ 
ušt32_t
 
šdex
)

388 ià(
m_–em’t
 !ğ
NULL
)

390 
m_–em’t
 = 
	`sûw_–em’t_by_šdex
(m_–em’t, 
šdex
);

392  *
this
;

393 
	}
}

395 
DLL_PUBLIC
 
	gXMLEËm’t
 &XMLEËm’t::
	$GoToFœ¡Chd
()

397 ià(
m_–em’t
 !ğ
NULL
)

399 
m_–em’t
 = ::
	`G‘Fœ¡Chd
(m_element);

401  *
this
;

402 
	}
}

404 
DLL_PUBLIC
 
	gXMLEËm’t
 &XMLEËm’t::
	$GoToLa¡Chd
()

406 ià(
m_–em’t
 !ğ
NULL
)

408 
m_–em’t
 = ::
	`G‘La¡Chd
(m_element);

410  *
this
;

411 
	}
}

413 
DLL_PUBLIC
 
	g¡d
::
¡ršg
 
XMLEËm’t
::
	$G‘SŒšg
() const

415  
	`G‘CÚ‹Á
();

416 
	}
}

418 
DLL_PUBLIC
 
boŞ
 
	gXMLEËm’t
::
	$S‘SŒšg
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

420  
	`S‘CÚ‹Á
(
¡r
);

421 
	}
}

423 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ *
cÚ‹Á
)

425  
	`AddChd
(
Çme
, 
¡d
::
	`¡ršg
(
cÚ‹Á
 =ğ
NULL
 ? "" : content));

426 
	}
}

428 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št8_t
 
cÚ‹Á
)

430  
	`AddChd
(
Çme
, 
	`i8_to_¡r
(
cÚ‹Á
));

431 
	}
}

433 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt8_t
 
cÚ‹Á
)

435  
	`AddChd
(
Çme
, 
	`u8_to_¡r
(
cÚ‹Á
));

436 
	}
}

438 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št16_t
 
cÚ‹Á
)

440  
	`AddChd
(
Çme
, 
	`i16_to_¡r
(
cÚ‹Á
));

441 
	}
}

443 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt16_t
 
cÚ‹Á
)

445  
	`AddChd
(
Çme
, 
	`u16_to_¡r
(
cÚ‹Á
));

446 
	}
}

448 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št32_t
 
cÚ‹Á
)

450  
	`AddChd
(
Çme
, 
	`i32_to_¡r
(
cÚ‹Á
));

451 
	}
}

453 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt32_t
 
cÚ‹Á
)

455  
	`AddChd
(
Çme
, 
	`u32_to_¡r
(
cÚ‹Á
));

456 
	}
}

458 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št64_t
 
cÚ‹Á
)

460  
	`AddChd
(
Çme
, 
	`i64_to_¡r
(
cÚ‹Á
));

461 
	}
}

463 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt64_t
 
cÚ‹Á
)

465  
	`AddChd
(
Çme
, 
	`u64_to_¡r
(
cÚ‹Á
));

466 
	}
}

468 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
boŞ
 
cÚ‹Á
)

470  
	`AddChd
(
Çme
, 
	`boŞ_to_¡r
(
cÚ‹Á
));

471 
	}
}

473 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
cÚ‹Á
)

475  
	`AddChd
(
Çme
, 
	`æßt_to_¡r
(
cÚ‹Á
));

476 
	}
}

478 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
cÚ‹Á
)

480  
	`AddChd
(
Çme
, 
	`doubË_to_¡r
(
cÚ‹Á
));

481 
	}
}

483 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLEËm’t
::
	$AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
cÚ‹Á
)

485  
	`AddChd
(
Çme
, 
	`lÚg_doubË_to_¡r
(
cÚ‹Á
));

486 
	}
}

488 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ *
v®ue
)

490  
	`AddA‰ribu‹
(
Çme
, 
¡d
::
	`¡ršg
(
v®ue
 =ğ
NULL
 ? "" : value));

491 
	}
}

493 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št8_t
 
v®ue
)

495  
	`AddA‰ribu‹
(
Çme
, 
	`i8_to_¡r
(
v®ue
));

496 
	}
}

498 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt8_t
 
v®ue
)

500  
	`AddA‰ribu‹
(
Çme
, 
	`u8_to_¡r
(
v®ue
));

501 
	}
}

503 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št16_t
 
v®ue
)

505  
	`AddA‰ribu‹
(
Çme
, 
	`i16_to_¡r
(
v®ue
));

506 
	}
}

508 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt16_t
 
v®ue
)

510  
	`AddA‰ribu‹
(
Çme
, 
	`u16_to_¡r
(
v®ue
));

511 
	}
}

513 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št32_t
 
v®ue
)

515  
	`AddA‰ribu‹
(
Çme
, 
	`i32_to_¡r
(
v®ue
));

516 
	}
}

518 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt32_t
 
v®ue
)

520  
	`AddA‰ribu‹
(
Çme
, 
	`u32_to_¡r
(
v®ue
));

521 
	}
}

523 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št64_t
 
v®ue
)

525  
	`AddA‰ribu‹
(
Çme
, 
	`i64_to_¡r
(
v®ue
));

526 
	}
}

528 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt64_t
 
v®ue
)

530  
	`AddA‰ribu‹
(
Çme
, 
	`u64_to_¡r
(
v®ue
));

531 
	}
}

533 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
boŞ
 
v®ue
)

535  
	`AddA‰ribu‹
(
Çme
, 
	`boŞ_to_¡r
(
v®ue
));

536 
	}
}

538 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
v®ue
)

540  
	`AddA‰ribu‹
(
Çme
, 
	`æßt_to_¡r
(
v®ue
));

541 
	}
}

543 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
v®ue
)

545  
	`AddA‰ribu‹
(
Çme
, 
	`doubË_to_¡r
(
v®ue
));

546 
	}
}

548 
DLL_PUBLIC
 
XMLA‰ribu‹
 
	gXMLEËm’t
::
	$AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
v®ue
)

550  
	`AddA‰ribu‹
(
Çme
, 
	`lÚg_doubË_to_¡r
(
v®ue
));

551 
	}
}

	@../scew/xml_element.h

1 #iâdeà
__SYSUTILS_XML_ELEMENT_H__


2 
	#__SYSUTILS_XML_ELEMENT_H__


	)

4 
	~"expÜts.h
"

6 
	~"sûw/–em’t.h
"

8 
	~"xml_node.h
"

9 
	~"xml_©Œibu‹.h
"

11 
	~"commÚ/¡dšt.h
"

13 
	~<¡ršg
>

14 
	~<veùÜ
>

16 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

19 
şass
 
	gXMLT»e
;

21 şas 
	cDLL_PUBLIC
 
	gXMLEËm’t
: 
public
 
XMLNode


23 
ä›nd
 
şass
 
XMLT»e
;

25 
	gpublic
:

26 
XMLEËm’t
();

27 
XMLEËm’t
(
sûw_–em’t
 *
_–em’t
);

28 ~
XMLEËm’t
();

30 
XMLEËm’t
(cÚ¡ XMLEËm’ˆ&
rhs
);

31 
	gXMLEËm’t
 &
	gİ”©Ü
=(cÚ¡ 
XMLEËm’t
 &
rhs
);

33 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
XMLEËm’t
 &
rhs
);

34 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
XMLEËm’t
 &
rhs
);

37 
XMLEËm’t
 
G‘Chd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
) const;

38 
XMLEËm’t
 
G‘Chd
(cÚ¡ 
ušt32_t
 
šdex
) const;

39 
	g¡d
::
veùÜ
<
XMLEËm’t
> 
G‘Chd»n
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
) const;

42 
	g¡d
::
¡ršg
 
G‘Name
() const;

43 
	g¡d
::
¡ršg
 
G‘CÚ‹Á
() const;

44 
boŞ
 
S‘Name
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

45 
boŞ
 
S‘CÚ‹Á
(cÚ¡ 
¡d
::
¡ršg
 &
cÚ‹Á
);

46 
CË¬CÚ‹Á
();

49 
XMLEËm’t
 
G‘RoÙ
() const;

50 
XMLEËm’t
 
G‘P¬’t
() const;

51 
XMLEËm’t
 
G‘P»vious
() const;

52 
XMLEËm’t
 
G‘Next
() const;

53 
XMLEËm’t
 
G‘Fœ¡Chd
() const;

54 
XMLEËm’t
 
G‘La¡Chd
() const;

55 
ušt32_t
 
G‘ChdCouÁ
() const;

56 
	g¡d
::
veùÜ
<
XMLEËm’t
> 
G‘Chd»n
() const;

57 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

58 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
cÚ‹Á
);

59 
RemoveAÎChd»n
();

60 
RemoveAÎChd»n
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

61 
RemoveChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

62 
RemoveChd
(cÚ¡ 
ušt32_t
 
šdex
);

65 
ušt32_t
 
G‘A‰ribu‹CouÁ
() const;

66 
	g¡d
::
veùÜ
<
XMLA‰ribu‹
> 
G‘A‰ribu‹s
() const;

67 
XMLA‰ribu‹
 
G‘A‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
) const;

68 
XMLA‰ribu‹
 
G‘A‰ribu‹
(cÚ¡ 
ušt32_t
 
šdex
) const;

69 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
);

70 
RemoveAÎA‰ribu‹s
();

71 
RemoveA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

72 
RemoveA‰ribu‹
(cÚ¡ 
ušt32_t
 
šdex
);

75 
	gXMLEËm’t
 &
GoToRoÙ
();

76 
	gXMLEËm’t
 &
GoToP¬’t
();

77 
	gXMLEËm’t
 &
GoToP»vious
();

78 
	gXMLEËm’t
 &
GoToNext
();

79 
	gXMLEËm’t
 &
GoToChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

80 
	gXMLEËm’t
 &
GoToChd
(cÚ¡ 
ušt32_t
 
šdex
);

81 
	gXMLEËm’t
 &
GoToFœ¡Chd
();

82 
	gXMLEËm’t
 &
GoToLa¡Chd
();

85 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ *
cÚ‹Á
);

86 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št8_t
 
cÚ‹Á
);

87 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt8_t
 
cÚ‹Á
);

88 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št16_t
 
cÚ‹Á
);

89 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt16_t
 
cÚ‹Á
);

90 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št32_t
 
cÚ‹Á
);

91 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt32_t
 
cÚ‹Á
);

92 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št64_t
 
cÚ‹Á
);

93 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt64_t
 
cÚ‹Á
);

94 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
boŞ
 
cÚ‹Á
);

95 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
cÚ‹Á
);

96 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
cÚ‹Á
);

97 
XMLEËm’t
 
AddChd
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
cÚ‹Á
);

98 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ *
v®ue
);

99 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št8_t
 
v®ue
);

100 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt8_t
 
v®ue
);

101 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št16_t
 
v®ue
);

102 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt16_t
 
v®ue
);

103 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št32_t
 
v®ue
);

104 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt32_t
 
v®ue
);

105 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
št64_t
 
v®ue
);

106 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
ušt64_t
 
v®ue
);

107 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
boŞ
 
v®ue
);

108 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
v®ue
);

109 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
v®ue
);

110 
XMLA‰ribu‹
 
AddA‰ribu‹
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
v®ue
);

112 
	gpublic
:

113 cÚ¡ 
XMLEËm’t
 
em±y_–em’t
;

115 
	g´iv©e
:

116 
sûw_–em’t
* 
G‘SûwEËm’t
() const;

117 
S‘SûwEËm’t
(
sûw_–em’t
 *
_–em’t
);

119 
	g´iv©e
:

120 
vœtu®
 
¡d
::
¡ršg
 
G‘SŒšg
() const ;

121 
vœtu®
 
boŞ
 
S‘SŒšg
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

123 
	g´iv©e
:

124 
sûw_–em’t
 *
m_–em’t
;

	@../scew/xml_node.cpp

1 
	~"xml_node.h
"

3 
	~"commÚ/¡ršg.h
"

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
DLL_PUBLIC
 
	gXMLNode
::
	$XMLNode
()

9 
	}
}

11 
DLL_PUBLIC
 
XMLNode
::~
	$XMLNode
()

13 
	}
}

15 
DLL_PUBLIC
 
XMLNode
::
İ”©Ü
 
	$št8_t
() const

17  
	`¡r_to_i8
(
	`G‘SŒšg
());

18 
	}
}

20 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 
	$ušt8_t
() const

22  
	`¡r_to_u8
(
	`G‘SŒšg
());

23 
	}
}

25 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 
	$št16_t
() const

27  
	`¡r_to_i16
(
	`G‘SŒšg
());

28 
	}
}

30 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 
	$ušt16_t
() const

32  
	`¡r_to_u16
(
	`G‘SŒšg
());

33 
	}
}

35 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 
	$št32_t
() const

37  
	`¡r_to_i32
(
	`G‘SŒšg
());

38 
	}
}

40 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 
	$ušt32_t
() const

42  
	`¡r_to_u32
(
	`G‘SŒšg
());

43 
	}
}

45 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 
	$št64_t
() const

47  
	`¡r_to_i64
(
	`G‘SŒšg
());

48 
	}
}

50 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 
	$ušt64_t
() const

52  
	`¡r_to_u64
(
	`G‘SŒšg
());

53 
	}
}

55 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 
	$boŞ
() const

57  
	`¡r_to_boŞ
(
	`G‘SŒšg
());

58 
	}
}

60 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 () const

62  
	`¡r_to_æßt
(
	`G‘SŒšg
());

63 
	}
}

65 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 () const

67  
	`¡r_to_doubË
(
	`G‘SŒšg
());

68 
	}
}

70 
DLL_PUBLIC
 
	gXMLNode
::
İ”©Ü
 () const

72  
	`¡r_to_lÚg_doubË
(
	`G‘SŒšg
());

73 
	}
}

75 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ *
d©a
)

77 
S‘SŒšg
(
¡d
::
¡ršg
(
d©a
 =ğ
NULL
 ? "" : data));

78  *
	gthis
;

81 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
¡d
::
¡ršg
 &
d©a
)

83 
S‘SŒšg
(
d©a
);

84  *
	gthis
;

87 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
št8_t
 
d©a
)

89 
S‘SŒšg
(
i8_to_¡r
(
d©a
));

90  *
	gthis
;

93 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
ušt8_t
 
d©a
)

95 
S‘SŒšg
(
u8_to_¡r
(
d©a
));

96  *
	gthis
;

99 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
št16_t
 
d©a
)

101 
S‘SŒšg
(
i16_to_¡r
(
d©a
));

102  *
	gthis
;

105 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
ušt16_t
 
d©a
)

107 
S‘SŒšg
(
u16_to_¡r
(
d©a
));

108  *
	gthis
;

111 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
št32_t
 
d©a
)

113 
S‘SŒšg
(
i32_to_¡r
(
d©a
));

114  *
	gthis
;

117 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
ušt32_t
 
d©a
)

119 
S‘SŒšg
(
u32_to_¡r
(
d©a
));

120  *
	gthis
;

123 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
št64_t
 
d©a
)

125 
S‘SŒšg
(
i64_to_¡r
(
d©a
));

126  *
	gthis
;

129 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
ušt64_t
 
d©a
)

131 
S‘SŒšg
(
u64_to_¡r
(
d©a
));

132  *
	gthis
;

135 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
boŞ
 
d©a
)

137 
S‘SŒšg
(
boŞ_to_¡r
(
d©a
));

138  *
	gthis
;

141 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
d©a
){

142 
S‘SŒšg
(
æßt_to_¡r
(
d©a
));

143  *
	gthis
;

146 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
d©a
)

148 
S‘SŒšg
(
doubË_to_¡r
(
d©a
));

149  *
	gthis
;

152 
DLL_PUBLIC
 
	gXMLNode
 &XMLNode::
İ”©Ü
=(cÚ¡ 
d©a
)

154 
S‘SŒšg
(
lÚg_doubË_to_¡r
(
d©a
));

155  *
	gthis
;

	@../scew/xml_node.h

1 #iâdeà
__SYSUTILS_XML_NODE_H__


2 
	#__SYSUTILS_XML_NODE_H__


	)

4 
	~"expÜts.h
"

6 
	~<¡ršg
>

8 
	~"commÚ/¡dšt.h
"

10 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

12 şas 
	cDLL_PUBLIC
 
	gXMLNode


14 
	gpublic
:

15 
XMLNode
();

16 
	gvœtu®
 ~
XMLNode
() = 0;

18 
vœtu®
 
İ”©Ü
 
št8_t
() const;

19 
vœtu®
 
İ”©Ü
 
ušt8_t
() const;

20 
vœtu®
 
İ”©Ü
 
št16_t
() const;

21 
vœtu®
 
İ”©Ü
 
ušt16_t
() const;

22 
vœtu®
 
İ”©Ü
 
št32_t
() const;

23 
vœtu®
 
İ”©Ü
 
ušt32_t
() const;

24 
vœtu®
 
İ”©Ü
 
št64_t
() const;

25 
vœtu®
 
İ”©Ü
 
ušt64_t
() const;

26 
vœtu®
 
İ”©Ü
 
boŞ
() const;

27 
vœtu®
 
İ”©Ü
 () const;

28 
vœtu®
 
İ”©Ü
 () const;

29 
vœtu®
 
İ”©Ü
 () const;

31 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ *
d©a
);

32 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
¡d
::
¡ršg
 &
d©a
);

33 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
št8_t
 
d©a
);

34 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
ušt8_t
 
d©a
);

35 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
št16_t
 
d©a
);

36 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
ušt16_t
 
d©a
);

37 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
št32_t
 
d©a
);

38 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
ušt32_t
 
d©a
);

39 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
št64_t
 
d©a
);

40 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
ušt64_t
 
d©a
);

41 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
boŞ
 
d©a
);

42 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
d©a
);

43 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
d©a
);

44 
vœtu®
 
	gXMLNode
 &
	gİ”©Ü
=(cÚ¡ 
d©a
);

46 
	g´iv©e
:

47 
vœtu®
 
¡d
::
¡ršg
 
G‘SŒšg
() const = 0;

48 
vœtu®
 
boŞ
 
S‘SŒšg
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
) = 0;

	@../scew/xml_tree.cpp

1 
	~"xml_Œ“.h
"

3 
	~"commÚ/ut™y.h
"

5 
	~"xml_–em’t.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
DLL_PUBLIC
 
	gXMLT»e
::
	$XMLT»e
()

10 : 
	`m_Œ“
(
	$sûw_Œ“_ü—‹
())

12 
	}
}

14 
DLL_PUBLIC
 
XMLT»e
::
	$XMLT»e
(
sûw_Œ“
 *
_Œ“
)

15 : 
	$m_Œ“
(
_Œ“
)

17 ià(
m_Œ“
 =ğ
NULL
)

19 
m_Œ“
 = 
	`sûw_Œ“_ü—‹
();

21 
	}
}

23 
DLL_PUBLIC
 
	gXMLT»e
::~
	$XMLT»e
()

25 
	`sûw_Œ“_ä“
(
m_Œ“
);

26 
	}
}

28 
DLL_PUBLIC
 
	gXMLT»e
::
	$XMLT»e
(cÚ¡ 
XMLT»e
 &
rhs
)

29 : 
	`m_Œ“
(
	$sûw_Œ“_cİy
(
rhs
.
m_Œ“
))

31 
	}
}

33 
DLL_PUBLIC
 
XMLT»e
 &XMLT»e::
İ”©Ü
=(cÚ¡ XMLT»&
rhs
)

35 ià(&
rhs
 !ğ
this
)

37 
sûw_Œ“_ä“
(
m_Œ“
);

38 
	gm_Œ“
 = 
sûw_Œ“_cİy
(
rhs
.
m_Œ“
);

40  *
	gthis
;

43 
DLL_PUBLIC
 
boŞ
 
	gXMLT»e
::
İ”©Ü
==(cÚ¡ 
XMLT»e
 &
rhs
)

45 ià(
m_Œ“
 =ğ
NULL
 && 
rhs
.m_tree == NULL)

47  
Œue
;

49 ià(
	gm_Œ“
 =ğ
NULL
 || 
rhs
.
m_Œ“
 == NULL)

51  
çl£
;

55  
sûw_Œ“_com·»
(
m_Œ“
, 
rhs
.m_Œ“, 
NULL
è=ğ
SCEW_TRUE
;

59 
DLL_PUBLIC
 
boŞ
 
	gXMLT»e
::
İ”©Ü
!=(cÚ¡ 
XMLT»e
 &
rhs
)

61  !(*
this
 =ğ
rhs
);

64 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLT»e
::
	$G‘RoÙ
()

66 
	`IF_NULL_RETURN_VALUE
(
m_Œ“
, 
XMLEËm’t
::
em±y_–em’t
);

67 
sûw_–em’t
 *
_roÙ
 = 
	`sûw_Œ“_roÙ
(
m_Œ“
);

68  
	`XMLEËm’t
(
_roÙ
);

69 
	}
}

71 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLT»e
::
	$S‘RoÙ
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

73 
sûw_–em’t
 *
_roÙ
 = 
	`sûw_Œ“_roÙ
(
m_Œ“
);

74 ià(
_roÙ
 !ğ
NULL
)

76 
	`sûw_–em’t_d‘ach
(
_roÙ
);

78 
	`sûw_–em’t_ä“
(
_roÙ
);

80 
sûw_–em’t
 *
_Ãw_roÙ
 = 
	`sûw_–em’t_ü—‹
(
Çme
.
	`c_¡r
());

82 ià(
_Ãw_roÙ
 !ğ
NULL
)

84  
	`XMLEËm’t
(
	`sûw_Œ“_£t_roÙ_–em’t
(
m_Œ“
, 
_Ãw_roÙ
));

87  
XMLEËm’t
::
em±y_–em’t
;

88 
	}
}

90 
DLL_PUBLIC
 
XMLEËm’t
 
	gXMLT»e
::
	$S‘RoÙ
(cÚ¡ 
XMLEËm’t
 &
–em’t
)

92 
sûw_–em’t
 *
_roÙ
 = 
	`sûw_Œ“_roÙ
(
m_Œ“
);

93 ià(
_roÙ
 !ğ
NULL
)

95 
	`sûw_–em’t_d‘ach
(
_roÙ
);

98 
sûw_–em’t
 *
_–em’t
 = 
–em’t
.
	`G‘SûwEËm’t
();

99 ià(
_–em’t
 !ğ
NULL
)

101 
	`sûw_–em’t_d‘ach
(
_–em’t
);

104 
	`sûw_–em’t_ä“
(
_roÙ
);

106 ià(
_–em’t
 !ğ
NULL
)

108  
	`XMLEËm’t
(
	`sûw_Œ“_£t_roÙ_–em’t
(
m_Œ“
, 
_–em’t
));

111  
XMLEËm’t
::
em±y_–em’t
;

112 
	}
}

114 
DLL_PUBLIC
 
sûw_Œ“
 *
	gXMLT»e
::
	$G‘SûwT»e
() const

116  
m_Œ“
;

117 
	}
}

119 
DLL_PUBLIC
 
	gXMLT»e
::
	$S‘SûwT»e
(
sûw_Œ“
 *
_Œ“
)

121 ià(
m_Œ“
 !ğ
_Œ“
)

123 
	`sûw_Œ“_ä“
(
m_Œ“
);

124 
m_Œ“
 = 
_Œ“
;

126 
	}
}

	@../scew/xml_tree.h

1 #iâdeà
__SYSUTILS_XML_TREE_H__


2 
	#__SYSUTILS_XML_TREE_H__


	)

4 
	~"expÜts.h
"

6 
	~"sûw/Œ“.h
"

8 
	~"xml_–em’t.h
"

10 
	~<¡ršg
>

12 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

15 
şass
 
	gXMLT»e
;

16 
DLL_PUBLIC
 
boŞ
 
LßdXMLT»e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, 
XMLT»e
 &
Œ“
);

17 
DLL_PUBLIC
 
boŞ
 
LßdXMLT»eBufãr
(cÚ¡ 
¡d
::
¡ršg
 &
bufãr
, 
XMLT»e
 &
Œ“
);

18 
DLL_PUBLIC
 
boŞ
 
SaveXMLT»e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, cÚ¡ 
XMLT»e
 &
Œ“
);

19 
DLL_PUBLIC
 
boŞ
 
SaveXMLT»eBufãr
(
¡d
::
¡ršg
 &
bufãr
, cÚ¡ 
XMLT»e
 &
Œ“
);

21 şas 
	cDLL_PUBLIC
 
	gXMLT»e


23 
ä›nd
 
DLL_PUBLIC
 
boŞ
 
LßdXMLT»e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, 
XMLT»e
 &
Œ“
);

24 
ä›nd
 
DLL_PUBLIC
 
boŞ
 
LßdXMLT»eBufãr
(cÚ¡ 
¡d
::
¡ršg
 &
bufãr
, 
XMLT»e
 &
Œ“
);

25 
ä›nd
 
DLL_PUBLIC
 
boŞ
 
SaveXMLT»e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, cÚ¡ 
XMLT»e
 &
Œ“
);

26 
ä›nd
 
DLL_PUBLIC
 
boŞ
 
SaveXMLT»eBufãr
(
¡d
::
¡ršg
 &
bufãr
, cÚ¡ 
XMLT»e
 &
Œ“
);

28 
	gpublic
:

29 
XMLT»e
();

30 
XMLT»e
(
sûw_Œ“
 *
_Œ“
);

31 ~
XMLT»e
();

33 
XMLT»e
(cÚ¡ XMLT»&
rhs
);

34 
	gXMLT»e
 &
	gİ”©Ü
=(cÚ¡ 
XMLT»e
 &
rhs
);

36 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
XMLT»e
 &
rhs
);

37 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
XMLT»e
 &
rhs
);

40 
XMLEËm’t
 
G‘RoÙ
();

41 
XMLEËm’t
 
S‘RoÙ
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

42 
XMLEËm’t
 
S‘RoÙ
(cÚ¡ XMLEËm’ˆ&
–em’t
);

44 
	g´iv©e
:

45 
sûw_Œ“
 *
G‘SûwT»e
() const;

46 
S‘SûwT»e
(
sûw_Œ“
 *
_Œ“
);

48 
	g´iv©e
:

49 
sûw_Œ“
 *
m_Œ“
;

	@../scew/xml_utility.cpp

1 
	~"xml_ut™y.h
"

3 
	~<as£¹.h
>

5 
	~"sûw/boŞ.h
"

6 
	~"sûw/Œ“.h
"

7 
	~"sûw/»ad”.h
"

8 
	~"sûw/»ad”_bufãr.h
"

9 
	~"sûw/»ad”_fe.h
"

10 
	~"sûw/·r£r.h
"

11 
	~"sûw/wr™”.h
"

12 
	~"sûw/wr™”_bufãr.h
"

13 
	~"sûw/wr™”_fe.h
"

14 
	~"sûw/´š‹r.h
"

16 
	~"xml_Œ“.h
"

18 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

19 
	~"commÚ/š‰y³s.h
"

21 
	~<¡dio.h
>

23 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

25 
	gÇme¥aû
 {

26 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

27 şas 
	cAutoA¼ayPoš‹r


29 
	g´iv©e
:

30 
T
 *
m_p
;

31 
	gpublic
:

32 
AutoA¼ayPoš‹r
(è{ 
m_p
 = 
NULL
; };

33 
AutoA¼ayPoš‹r
(cÚ¡ 
T
 *
p
è{ 
	gm_p
 =…; };

34 ~
AutoA¼ayPoš‹r
(è{ 
	gd–‘e
 [] 
	gm_p
; };

35 
T
 *
G‘
(ècÚ¡ {  
	gm_p
; };

36 
T
 *
S‘
(T *
p
è{ ià(
	gm_p
 !ğpè{ 
d–‘e
 [] 
m_p
; m_p =…; }  m_p; };

37 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
T
 *
p
è{  
m_p
 ==…; };

38 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
T
 *
p
è{  
m_p
 !=…; };

39 
İ”©Ü
 
	gT
*(ècÚ¡ {  
G‘
(); };

40 
T
 *
	gİ”©Ü
=(T *
p
è{  
S‘
(p); };

41 
	g´iv©e
:

42 
AutoA¼ayPoš‹r
(cÚ¡ AutoA¼ayPoš‹¸&
rhs
);

43 
	gAutoA¼ayPoš‹r
 &
	gİ”©Ü
=(cÚ¡ 
AutoA¼ayPoš‹r
 &
rhs
);

47 
	#MAX_BUFFER_SIZE
 16777216

48 

	)

49 
Cr™iÿlSeùiÚ
 
	gs_ü™iÿl_£ùiÚ
;

50 
ušt32_t
 
	gs_xml_bufãr_size
 = 2 * 1024 * 1024;

51 
	gAutoA¼ayPoš‹r
<> 
	gs_bufãr
;

53 
DLL_PUBLIC
 
ušt32_t
 
	gSYSUTILS_SPACE
::
	$G‘XMLBufãrSize
()

55 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_ü™iÿl_£ùiÚ
);

56  
s_xml_bufãr_size
;

57 
	}
}

59 
DLL_PUBLIC
 
	gSYSUTILS_SPACE
::
	$S‘XMLBufãrSize
(cÚ¡ 
ušt32_t
 
size
)

61 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_ü™iÿl_£ùiÚ
);

62 
s_bufãr
.
	`S‘
(
NULL
);

64 ià(
size
 <ğ
MAX_BUFFER_SIZE
)

66 
s_xml_bufãr_size
 = 
size
;

68 
	}
}

70 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$LßdXMLT»e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, 
XMLT»e
 &
Œ“
)

72 
boŞ
 
»suÉ
 = 
Œue
;

75 
sûw_·r£r
 *
_·r£r
 = 
	`sûw_·r£r_ü—‹
();

78 
sûw_»ad”
 *
_»ad”
 = 
	`sûw_»ad”_fe_ü—‹
(
f’ame
.
	`c_¡r
());

80 ià(
_·r£r
 !ğ
NULL
 && 
_»ad”
 != NULL)

83 
sûw_Œ“
 *
_Œ“
 = 
	`sûw_·r£r_lßd
(
_·r£r
, 
_»ad”
);

85 ià(
_Œ“
 !ğ
NULL
)

87 
Œ“
.
	`S‘SûwT»e
(
_Œ“
);

91 
»suÉ
 = 
çl£
;

96 
»suÉ
 = 
çl£
;

100 ià(
_»ad”
 !ğ
NULL
 && 
	`sûw_»ad”_şo£
(_»ad”è!ğ
SCEW_TRUE
)

102 
»suÉ
 = 
çl£
;

106 ià(
_»ad”
 !ğ
NULL
)

108 
	`sûw_»ad”_ä“
(
_»ad”
);

112 ià(
_·r£r
 !ğ
NULL
)

114 
	`sûw_·r£r_ä“
(
_·r£r
);

117  
»suÉ
;

118 
	}
}

120 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$LßdXMLT»eBufãr
(cÚ¡ 
¡d
::
¡ršg
 &
bufãr
, 
XMLT»e
 &
Œ“
)

122 ià(
bufãr
.
	`em±y
())

124  
çl£
;

127 
boŞ
 
»suÉ
 = 
Œue
;

130 
sûw_·r£r
 *
_·r£r
 = 
	`sûw_·r£r_ü—‹
();

133 
sûw_»ad”
 *
_»ad”
 = 
	`sûw_»ad”_bufãr_ü—‹
(
bufãr
.
	`c_¡r
(), bufãr.
	`Ëngth
());

135 ià(
_·r£r
 !ğ
NULL
 && 
_»ad”
 != NULL)

138 
sûw_Œ“
 *
_Œ“
 = 
	`sûw_·r£r_lßd
(
_·r£r
, 
_»ad”
);

140 ià(
_Œ“
 !ğ
NULL
)

142 
Œ“
.
	`S‘SûwT»e
(
_Œ“
);

146 
»suÉ
 = 
çl£
;

151 
»suÉ
 = 
çl£
;

155 ià(
_»ad”
 !ğ
NULL
 && 
	`sûw_»ad”_şo£
(_»ad”è!ğ
SCEW_TRUE
)

157 
»suÉ
 = 
çl£
;

161 ià(
_»ad”
 !ğ
NULL
)

163 
	`sûw_»ad”_ä“
(
_»ad”
);

167 ià(
_·r£r
 !ğ
NULL
)

169 
	`sûw_·r£r_ä“
(
_·r£r
);

172  
»suÉ
;

173 
	}
}

175 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$SaveXMLT»e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, cÚ¡ 
XMLT»e
 &
Œ“
)

177 
boŞ
 
»suÉ
 = 
Œue
;

180 
sûw_wr™”
 *
_wr™”
 = 
	`sûw_wr™”_fe_ü—‹
(
f’ame
.
	`c_¡r
());

183 
sûw_´š‹r
 *
_´š‹r
 = 
	`sûw_´š‹r_ü—‹
(
_wr™”
);

185 
sûw_Œ“
 * 
_Œ“
 = 
Œ“
.
	`G‘SûwT»e
();

187 
sûw_–em’t
 *
_–em’t
 = 
	`sûw_Œ“_roÙ
(
_Œ“
);

189 ià(
_wr™”
 !ğ
NULL
 && 
_´š‹r
 !ğNULL && 
_Œ“
 !ğNULL && 
_–em’t
 != NULL)

191 
sûw_boŞ
 
sb
 = 
	`sûw_´š‹r_´št_Œ“
(
_´š‹r
, 
_Œ“
);

193 
»suÉ
 = (
sb
 =ğ
SCEW_TRUE
);

197 
»suÉ
 = 
çl£
;

201 ià(
_´š‹r
 !ğ
NULL
)

203 
	`sûw_´š‹r_ä“
(
_´š‹r
);

207 ià(
_wr™”
 !ğ
NULL
 && 
	`sûw_wr™”_şo£
(_wr™”è!ğ
SCEW_TRUE
)

209 
»suÉ
 = 
çl£
;

213 ià(
_wr™”
 !ğ
NULL
)

215 
	`sûw_wr™”_ä“
(
_wr™”
);

218  
»suÉ
;

219 
	}
}

221 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$SaveXMLT»eBufãr
(
¡d
::
¡ršg
 &
bufãr
, cÚ¡ 
XMLT»e
 &
Œ“
)

224 
Cr™iÿlSeùiÚLock
 
	`c¦
(&
s_ü™iÿl_£ùiÚ
);

225 ià(
s_bufãr
.
	`G‘
(è=ğ
NULL
)

227 
s_bufãr
.
	`S‘
(
Ãw
 [
s_xml_bufãr_size
]);

230 
boŞ
 
»suÉ
 = 
Œue
;

233 
sûw_wr™”
 *
_wr™”
 = 
	`sûw_wr™”_bufãr_ü—‹
(
s_bufãr
.
	`G‘
(), 
s_xml_bufãr_size
);

236 
sûw_´š‹r
 *
_´š‹r
 = 
	`sûw_´š‹r_ü—‹
(
_wr™”
);

238 
sûw_Œ“
 * 
_Œ“
 = 
Œ“
.
	`G‘SûwT»e
();

240 
sûw_–em’t
 *
_–em’t
 = 
	`sûw_Œ“_roÙ
(
_Œ“
);

242 ià(
_wr™”
 !ğ
NULL
 && 
_´š‹r
 !ğNULL && 
_Œ“
 !ğNULL && 
_–em’t
 != NULL)

244 
sûw_boŞ
 
sb
 = 
	`sûw_´š‹r_´št_Œ“
(
_´š‹r
, 
_Œ“
);

246 
»suÉ
 = (
sb
 =ğ
SCEW_TRUE
);

250 
»suÉ
 = 
çl£
;

254 ià(
_´š‹r
 !ğ
NULL
)

256 
	`sûw_´š‹r_ä“
(
_´š‹r
);

260 ià(
_wr™”
 !ğ
NULL
 && 
	`sûw_wr™”_şo£
(_wr™”è!ğ
SCEW_TRUE
)

262 
»suÉ
 = 
çl£
;

266 ià(
_wr™”
 !ğ
NULL
)

268 
	`sûw_wr™”_ä“
(
_wr™”
);

271 ià(
»suÉ
)

273 
bufãr
 = 
s_bufãr
.
	`G‘
();

277 
bufãr
.
	`ş—r
();

280 ià(!
»suÉ
)

282 
ušt32_t
 
ex‹ndedSize
 = 
s_xml_bufãr_size
 * 2;

284 ià(
ex‹ndedSize
 > 
MAX_BUFFER_SIZE
)

286  
çl£
;

290 
	`S‘XMLBufãrSize
(
ex‹ndedSize
);

292  
	`SaveXMLT»eBufãr
(
bufãr
, 
Œ“
);

296  
»suÉ
;

297 
	}
}

	@../scew/xml_utility.h

1 #iâdeà
__SYSUTILS_XML_UTILITY_H__


2 
	#__SYSUTILS_XML_UTILITY_H__


	)

4 
	~"expÜts.h
"

6 
	~<¡ršg
>

8 
	~"commÚ/¡dšt.h
"

10 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

13 
şass
 
	gXMLT»e
;

15 
DLL_PUBLIC
 
ušt32_t
 
G‘XMLBufãrSize
();

17 
DLL_PUBLIC
 
S‘XMLBufãrSize
(cÚ¡ 
ušt32_t
 
size
);

19 
DLL_PUBLIC
 
boŞ
 
LßdXMLT»e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, 
XMLT»e
 &
Œ“
);

21 
DLL_PUBLIC
 
boŞ
 
LßdXMLT»eBufãr
(cÚ¡ 
¡d
::
¡ršg
 &
bufãr
, 
XMLT»e
 &
Œ“
);

23 
DLL_PUBLIC
 
boŞ
 
SaveXMLT»e
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, cÚ¡ 
XMLT»e
 &
Œ“
);

25 
DLL_PUBLIC
 
boŞ
 
SaveXMLT»eBufãr
(
¡d
::
¡ršg
 &
bufãr
, cÚ¡ 
XMLT»e
 &
Œ“
);

	@../sqlite/sqlite_object.cpp

1 
	~"sql™e_objeù.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
DLL_PUBLIC
 
	gSQL™eObjeù
::
	$SQL™eObjeù
()

6 : 
	$m_sql™e3
(
NULL
)

8 
	}
}

10 
DLL_PUBLIC
 
SQL™eObjeù
::~
	$SQL™eObjeù
()

12 
	`Clo£
();

13 
	}
}

15 
DLL_PUBLIC
 
	gSQL™eObjeù
::
	$O³n
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, 
æags
 )

17 
»s
 = 
	`Clo£
();

19 ià(
»s
 !ğ
SQLITE_OK
)

21  
»s
;

24 
»s
 = 
	`sql™e3_İ’_v2
(
f’ame
.
	`c_¡r
(), &
m_sql™e3
, 
æags
, 
NULL
);

26 ià(
»s
 !ğ
SQLITE_OK
)

28 
	`Clo£
();

31  
»s
;

32 
	}
}

34 
DLL_PUBLIC
 
	gSQL™eObjeù
::
	$Clo£
()

36 
»s
 = 
	`sql™e3_şo£
(
m_sql™e3
);

38 
m_sql™e3
 = 
NULL
;

40  
»s
;

41 
	}
}

43 
DLL_PUBLIC
 
	gSQL™eObjeù
::
	$P»·»
(cÚ¡ 
¡d
::
¡ršg
 &
sql
, 
SQL™eStmt
 &
¡mt
, std::¡ršg &

)

45 
sql™e3_¡mt
 *
_¡mt
 = 
NULL
;

46 cÚ¡ *
_
 = 
NULL
;

47 
»s
 = 
	`sql™e3_´•¬e_v2
(
m_sql™e3
, 
sql
.
	`c_¡r
(), sql.
	`Ëngth
(), &
_¡mt
, &
_
);

49 ià(
»s
 =ğ
SQLITE_OK
)

51 
¡mt
.
	`S‘Stmt
(
_¡mt
);

52 

 = 
_
 !ğ
NULL
 ? _tail : "";

55  
»s
;

56 
	}
}

58 
DLL_PUBLIC
 
	gSQL™eObjeù
::
Execu‹
(

59 cÚ¡ 
¡d
::
¡ršg
 &
sql
,

60 (*
ÿÎback
)(*
·¿m
, 
cŞumns
, **
µCŞumnText
, **
µCŞumnName
),

61 *
·¿m
,

62 
¡d
::
¡ršg
 &
”rÜ
)

64 
”rÜ
.
	`ş—r
();

66 *
”rmsg
 = 
NULL
;

68 
»s
 = 
	`sql™e3_exec
(
m_sql™e3
, 
sql
.
	`c_¡r
(), 
ÿÎback
, 
·¿m
, &
”rmsg
);

70 ià(
»s
 !ğ
SQLITE_OK
)

72 
”rÜ
 = 
”rmsg
;

73 
	`sql™e3_ä“
(
”rmsg
);

76  
»s
;

77 
	}
}

79 
DLL_PUBLIC
 
	gSQL™eObjeù
::
	$BegšT¿n§ùiÚ
()

81 
¡d
::
¡ršg
 
sql
 = "BEGIN;";

82 
¡d
::
¡ršg
 
”rÜ
;

84  
	`Execu‹
(
sql
, 
NULL
, NULL, 
”rÜ
);

85 
	}
}

87 
DLL_PUBLIC
 
	gSQL™eObjeù
::
	$EndT¿n§ùiÚ
()

89 
¡d
::
¡ršg
 
sql
 = "END;";

90 
¡d
::
¡ršg
 
”rÜ
;

92  
	`Execu‹
(
sql
, 
NULL
, NULL, 
”rÜ
);

93 
	}
}

95 
DLL_PUBLIC
 
	gSQL™eObjeù
::
	$RŞlbackT¿n§ùiÚ
()

97 
¡d
::
¡ršg
 
sql
 = "ROLLBACK;";

98 
¡d
::
¡ršg
 
”rÜ
;

100  
	`Execu‹
(
sql
, 
NULL
, NULL, 
”rÜ
);

101 
	}
}

	@../sqlite/sqlite_object.h

1 #iâdeà
__SYSUTILS_SQLITE_OBJECT_H__


2 
	#__SYSUTILS_SQLITE_OBJECT_H__


	)

4 
	~"expÜts.h
"

6 
	~"sql™e3.h
"

8 
	~"sql™e/sql™e_¡mt.h
"

10 
	~<¡ršg
>

12 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 şas 
	cDLL_PUBLIC
 
	gSQL™eObjeù


16 
	gpublic
:

17 cÚ¡ 
deçuÉ_æags
 = 
SQLITE_OPEN_READWRITE
 | 
SQLITE_OPEN_FULLMUTEX
 | 
SQLITE_OPEN_CREATE
;

19 
	gpublic
:

20 
SQL™eObjeù
();

21 ~
SQL™eObjeù
();

23 
O³n
(cÚ¡ 
¡d
::
¡ršg
 &
f’ame
, 
æags
=
SQL™eObjeù
::
deçuÉ_æags
);

25 
Clo£
();

27 
P»·»
(cÚ¡ 
¡d
::
¡ršg
 &
sql
, 
SQL™eStmt
 &
¡mt
, std::¡ršg &

);

29 
Execu‹
(

30 cÚ¡ 
¡d
::
¡ršg
 &
sql
,

31 (*
ÿÎback
)(*
·¿m
, 
cŞumns
, **
µCŞumnText
, **
µCŞumnName
),

32 *
·¿m
,

33 
¡d
::
¡ršg
 &
”rÜ
);

35 
BegšT¿n§ùiÚ
();

37 
EndT¿n§ùiÚ
();

39 
RŞlbackT¿n§ùiÚ
();

41 
	g´iv©e
:

42 
SQL™eObjeù
(cÚ¡ SQL™eObjeù &
rhs
);

43 
	gSQL™eObjeù
 &
	gİ”©Ü
=(cÚ¡ 
SQL™eObjeù
 &
rhs
);

45 
	g´iv©e
:

46 
sql™e3
 *
m_sql™e3
;

	@../sqlite/sqlite_stmt.cpp

1 
	~"sql™e_¡mt.h
"

3 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

5 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$SQL™eStmt
()

6 : 
	$m_¡mt
(
NULL
)

8 
	}
}

10 
DLL_PUBLIC
 
SQL™eStmt
::~
	$SQL™eStmt
()

12 
	`S‘Stmt
(
NULL
);

13 
	}
}

15 
DLL_PUBLIC
 
boŞ
 
	gSQL™eStmt
::
	$S‘Stmt
(
sql™e3_¡mt
 *
¡mt
)

17 ià(
m_¡mt
 !ğ
¡mt
)

19 
»s
 = 
	`Fš®ize
();

21 ià(
»s
 !ğ
SQLITE_OK
)

23  
çl£
;

27 
m_¡mt
 = 
¡mt
;

29  
Œue
;

30 
	}
}

32 
DLL_PUBLIC
 
	gSQL™eStmt
::
BšdBlob
(
cŞumn
, cÚ¡ *
blob
, 
Ëngth
, (*
¡¿‹gy
)(*))

34 
»s
 = 
	`sql™e3_bšd_blob
(
m_¡mt
, 
cŞumn
, 
blob
, 
Ëngth
, 
¡¿‹gy
);

36  
»s
;

37 
	}
}

39 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$BšdDoubË
(
cŞumn
, 
v®ue
)

41 
»s
 = 
	`sql™e3_bšd_doubË
(
m_¡mt
, 
cŞumn
, 
v®ue
);

43  
»s
;

44 
	}
}

46 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$BšdIÁ
(
cŞumn
, 
v®ue
)

48 
»s
 = 
	`sql™e3_bšd_št
(
m_¡mt
, 
cŞumn
, 
v®ue
);

50  
»s
;

51 
	}
}

53 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$BšdIÁ64
(
cŞumn
, 
št64_t
 
v®ue
)

55 
»s
 = 
	`sql™e3_bšd_št64
(
m_¡mt
, 
cŞumn
, (
sql™e3_št64
)
v®ue
);

57  
»s
;

58 
	}
}

60 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$BšdNuÎ
(
cŞumn
)

62 
»s
 = 
	`sql™e3_bšd_nuÎ
(
m_¡mt
, 
cŞumn
);

64  
»s
;

65 
	}
}

67 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$BšdText
(
cŞumn
, cÚ¡ 
¡d
::
¡ršg
 &
¡r
)

69 
»s
 = 
	`sql™e3_bšd_‹xt
(
m_¡mt
, 
cŞumn
, 
¡r
.
	`c_¡r
(), sŒ.
	`Ëngth
(), 
SQLITE_TRANSIENT
);

71  
»s
;

72 
	}
}

74 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$BšdZ”oBlob
(
cŞumn
, 
Ëngth
)

76 
»s
 = 
	`sql™e3_bšd_z”oblob
(
m_¡mt
, 
cŞumn
, 
Ëngth
);

78  
»s
;

79 
	}
}

81 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$S‹p
()

83 
»s
 = 
	`sql™e3_¡•
(
m_¡mt
);

85  
»s
;

86 
	}
}

88 
DLL_PUBLIC
 cÚ¡ *
	gSQL™eStmt
::
	$G‘Blob
(
cŞumn
)

90  
	`sql™e3_cŞumn_blob
(
m_¡mt
, 
cŞumn
);

91 
	}
}

93 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$G‘By‹s
(
cŞumn
)

95  
	`sql™e3_cŞumn_by‹s
(
m_¡mt
, 
cŞumn
);

96 
	}
}

98 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$G‘DoubË
(
cŞumn
)

100  
	`sql™e3_cŞumn_doubË
(
m_¡mt
, 
cŞumn
);

101 
	}
}

103 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$G‘IÁ
(
cŞumn
)

105  
	`sql™e3_cŞumn_št
(
m_¡mt
, 
cŞumn
);

106 
	}
}

108 
DLL_PUBLIC
 
št64_t
 
	gSQL™eStmt
::
	$G‘IÁ64
(
cŞumn
)

110  
	`sql™e3_cŞumn_št64
(
m_¡mt
, 
cŞumn
);

111 
	}
}

113 
DLL_PUBLIC
 cÚ¡ 
	g¡d
::
¡ršg
 
SQL™eStmt
::
	$G‘Text
(
cŞumn
)

115  (cÚ¡ *)
	`sql™e3_cŞumn_‹xt
(
m_¡mt
, 
cŞumn
);

116 
	}
}

118 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$G‘Ty³
(
cŞumn
)

120  
	`sql™e3_cŞumn_ty³
(
m_¡mt
, 
cŞumn
);

121 
	}
}

123 
DLL_PUBLIC
 cÚ¡ 
	g¡d
::
¡ršg
 
SQL™eStmt
::
	$G‘Name
(
cŞumn
)

125  
	`sql™e3_cŞumn_Çme
(
m_¡mt
, 
cŞumn
);

126 
	}
}

128 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$Re£t
()

130  
	`sql™e3_»£t
(
m_¡mt
);

131 
	}
}

133 
DLL_PUBLIC
 
	gSQL™eStmt
::
	$Fš®ize
()

135  
	`sql™e3_fš®ize
(
m_¡mt
);

136 
	}
}

	@../sqlite/sqlite_stmt.h

1 #iâdeà
__SYSUTILS_SQLITE_STMT_H__


2 
	#__SYSUTILS_SQLITE_STMT_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

8 
	~"sql™e3.h
"

10 
	~<¡ršg
>

12 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 
şass
 
	gSQL™eObjeù
;

16 şas 
	cDLL_PUBLIC
 
	gSQL™eStmt


18 
ä›nd
 
şass
 
	gSQL™eObjeù
;

20 
	gpublic
:

21 
SQL™eStmt
();

22 ~
SQL™eStmt
();

24 
BšdBlob
(
cŞumn
, cÚ¡ *
blob
, 
Ëngth
, (*
¡¿‹gy
)(*));

25 
BšdDoubË
(
cŞumn
, 
v®ue
);

26 
BšdIÁ
(
cŞumn
, 
v®ue
);

27 
BšdIÁ64
(
cŞumn
, 
št64_t
 
v®ue
);

28 
BšdNuÎ
(
cŞumn
);

29 
BšdText
(
cŞumn
, cÚ¡ 
¡d
::
¡ršg
 &
¡r
);

30 
BšdZ”oBlob
(
cŞumn
, 
Ëngth
);

32 
S‹p
();

34 cÚ¡ *
G‘Blob
(
cŞumn
);

35 
G‘By‹s
(
cŞumn
);

36 
G‘DoubË
(
cŞumn
);

37 
G‘IÁ
(
cŞumn
);

38 
št64_t
 
G‘IÁ64
(
cŞumn
);

39 cÚ¡ 
	g¡d
::
¡ršg
 
G‘Text
(
cŞumn
);

40 
G‘Ty³
(
cŞumn
);

42 cÚ¡ 
	g¡d
::
¡ršg
 
G‘Name
(
cŞumn
);

44 
Re£t
();

46 
Fš®ize
();

48 
	g´iv©e
:

49 
SQL™eStmt
(cÚ¡ SQL™eStmˆ&
rhs
);

50 
	gSQL™eStmt
 &
	gİ”©Ü
=(cÚ¡ 
SQL™eStmt
 &
rhs
);

52 
	g´iv©e
:

53 
boŞ
 
S‘Stmt
(
sql™e3_¡mt
 *
¡mt
);

55 
	g´iv©e
:

56 
sql™e3_¡mt
 *
m_¡mt
;

	@../sqlite/sqlite_utility.cpp

1 
	~"sql™e_ut™y.h
"

3 
	~"sql™e_¡mt.h
"

5 
	~"commÚ/¡ršg.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$CheckSQL™eTabËExi¡
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
)

11 
rc
 = 
SQLITE_OK
;

13 
¡d
::
¡ršg
 
sql
 = 
	`¡ršg_fÜm©
("SELECT‚amFROM sql™e_ma¡” WHEREy³='bË' AND‚ame='%s';", 
bË
.
	`c_¡r
());

14 
¡d
::
¡ršg
 

;

16 
SQL™eStmt
 
¡mt
;

18 
rc
 = 
sql™e
.
	`P»·»
(
sql
, 
¡mt
, 

);

19 ià(
rc
 !ğ
SQLITE_OK
)

21  
çl£
;

24 
rc
 = 
¡mt
.
	`S‹p
();

26  
rc
 =ğ
SQLITE_ROW
;

27 
	}
}

29 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
C»©eSQL™eTabË
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::
veùÜ
<¡d::¡ršg> &
cŞumns
)

31 
rc
 = 
SQLITE_OK
;

33 
	g¡d
::
¡ršg
 
sql
 = 
¡ršg_fÜm©
("CREATE TABLE IF NOT EXISTS %s(", 
bË
.
c_¡r
());

34 
size_t
 
	gi
 = 0; i < 
	gcŞumns
.
size
(); i++)

36 ià(
	gi
 != 0)

38 
sql
 += ", ";

40 
	gsql
 +ğ
cŞumns
[
i
];

42 
	gsql
 += ");";

43 
	g¡d
::
¡ršg
 

;

45 
SQL™eStmt
 
	g¡mt
;

47 
	grc
 = 
sql™e
.
P»·»
(
sql
, 
¡mt
, 

);

48 ià(
	grc
 !ğ
SQLITE_OK
)

50  
çl£
;

53 
	grc
 = 
¡mt
.
S‹p
();

55  
	grc
 =ğ
SQLITE_DONE
;

58 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$D–‘eSQL™eTabË
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
)

60 
rc
 = 
SQLITE_OK
;

62 
¡d
::
¡ršg
 
sql
 = 
	`¡ršg_fÜm©
("DELETE FROM %s;", 
bË
.
	`c_¡r
());

63 
¡d
::
¡ršg
 

;

65 
SQL™eStmt
 
¡mt
;

67 
rc
 = 
sql™e
.
	`P»·»
(
sql
, 
¡mt
, 

);

68 ià(
rc
 !ğ
SQLITE_OK
)

70  
çl£
;

73 
rc
 = 
¡mt
.
	`S‹p
();

75  
rc
 =ğ
SQLITE_DONE
;

76 
	}
}

78 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$DrİSQL™eTabË
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
)

80 
rc
 = 
SQLITE_OK
;

82 
¡d
::
¡ršg
 
sql
 = 
	`¡ršg_fÜm©
("DROP TABLE IF EXISTS %s;", 
bË
.
	`c_¡r
());

83 
¡d
::
¡ršg
 

;

85 
SQL™eStmt
 
¡mt
;

87 
rc
 = 
sql™e
.
	`P»·»
(
sql
, 
¡mt
, 

);

88 ià(
rc
 !ğ
SQLITE_OK
)

90  
çl£
;

93 
rc
 = 
¡mt
.
	`S‹p
();

95  
rc
 =ğ
SQLITE_DONE
;

96 
	}
}

98 
DLL_PUBLIC
 
boŞ
 
	gSYSUTILS_SPACE
::
	$G‘SQL™eMaxV®ue
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
cŞumn
, 
SQL™eStmt
 &
¡mt
)

100 
rc
 = 
SQLITE_OK
;

102 
¡d
::
¡ršg
 
sql
 = 
	`¡ršg_fÜm©
("SELECT max(%sèFROM %s;", 
cŞumn
.
	`c_¡r
(), 
bË
.c_str());

103 
¡d
::
¡ršg
 

;

105 
rc
 = 
sql™e
.
	`P»·»
(
sql
, 
¡mt
, 

);

106 ià(
rc
 !ğ
SQLITE_OK
)

108  
çl£
;

111 
rc
 = 
¡mt
.
	`S‹p
();

113  
rc
 =ğ
SQLITE_ROW
;

114 
	}
}

	@../sqlite/sqlite_utility.h

1 #iâdeà
__SYSUTILS_SQLITE_UTILITY_H__


2 
	#__SYSUTILS_SQLITE_UTILITY_H__


	)

4 
	~"expÜts.h
"

6 
	~"sql™e/sql™e_objeù.h
"

7 
	~"sql™e/sql™e_¡mt.h
"

9 
	~<¡ršg
>

10 
	~<veùÜ
>

12 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 
DLL_PUBLIC
 
boŞ
 
CheckSQL™eTabËExi¡
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
);

16 
DLL_PUBLIC
 
boŞ
 
C»©eSQL™eTabË
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::
veùÜ
<¡d::¡ršg> &
cŞumns
);

18 
DLL_PUBLIC
 
boŞ
 
D–‘eSQL™eTabË
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
);

20 
DLL_PUBLIC
 
boŞ
 
DrİSQL™eTabË
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
);

22 
DLL_PUBLIC
 
boŞ
 
G‘SQL™eMaxV®ue
(
SQL™eObjeù
 &
sql™e
, cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
cŞumn
, 
SQL™eStmt
 &
¡mt
);

	@../sqlite/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../sqlite/unittest/sqlite_read_write_test.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	~"sql™e/sql™e_objeù.h
"

4 
	~"sql™e/sql™e_¡mt.h
"

5 
	~"sql™e/sql™e_ut™y.h
"

7 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

9 
	$TEST
(
SQL™eTe¡
, 
C»©eTe¡
)

11 
SQL™eObjeù
 
sql™e
;

13 
	`EXPECT_EQ
(
SQLITE_OK
, 
sql™e
.
	`O³n
("CreateTest.db"));

15 
¡d
::
veùÜ
<¡d::
¡ršg
> 
cŞumns
;

16 
cŞumns
.
	`push_back
("Id INTEGER");

17 
cŞumns
.
	`push_back
("LogLevel INTEGER");

18 
cŞumns
.
	`push_back
("LogTime INTEGER");

19 
cŞumns
.
	`push_back
("TimeZone INTEGER");

20 
cŞumns
.
	`push_back
("EventID INTEGER");

21 
cŞumns
.
	`push_back
("ServerType INTEGER");

22 
cŞumns
.
	`push_back
("ServerID INTEGER");

23 
cŞumns
.
	`push_back
("DeviceType INTEGER");

24 
cŞumns
.
	`push_back
("DeviceID INTEGER");

25 
cŞumns
.
	`push_back
("DeviceName TEXT");

26 
cŞumns
.
	`push_back
("Description TEXT");

28 
	`EXPECT_TRUE
(
	`C»©eSQL™eTabË
(
sql™e
, "Ev’tLog", 
cŞumns
));

30 
	`EXPECT_TRUE
(
	`D–‘eSQL™eTabË
(
sql™e
, "EventLog"));

32 
	`EXPECT_TRUE
(
	`DrİSQL™eTabË
(
sql™e
, "EventLog"));

34 
	`EXPECT_FALSE
(
	`D–‘eSQL™eTabË
(
sql™e
, "EventLog"));

36 
	`EXPECT_TRUE
(
	`DrİSQL™eTabË
(
sql™e
, "EventLog"));

38 
	`EXPECT_EQ
(
SQLITE_OK
, 
sql™e
.
	`Clo£
());

39 
	}
}

	@../sysstat/nusysstat/common.h

6 #iâdeà
_COMMON_H


7 
	#_COMMON_H


	)

10 
	#MAX_SENSORS_DEV_LEN
 20

	)

12 
	~<time.h
>

13 
	~<sched.h
>

14 
	~"rd_¡©s.h
"

22 
	#FALSE
 0

	)

23 
	#TRUE
 1

	)

25 
	#DISP_HDR
 1

	)

28 
	#SEC_PER_DAY
 3600 * 24

	)

31 #ià
defšed
(
__CPU_SETSIZE
) && __CPU_SETSIZE > 2048

32 
	#NR_CPUS
 
__CPU_SETSIZE


	)

34 
	#NR_CPUS
 2048

	)

38 
	#NR_IRQS
 1024

	)

41 
	#INTERRUPTS_LINE
 128

	)

44 
	#K_ISO
 "ISO"

	)

45 
	#K_ALL
 "ALL"

	)

46 
	#K_UTC
 "UTC"

	)

49 
	#STAT
 "/´oc/¡©"

	)

50 
	#UPTIME
 "/´oc/u±ime"

	)

51 
	#DISKSTATS
 "/´oc/disk¡©s"

	)

52 
	#INTERRUPTS
 "/´oc/š‹¼u±s"

	)

53 
	#MEMINFO
 "/´oc/memšfo"

	)

54 
	#SYSFS_BLOCK
 "/sys/block"

	)

55 
	#SYSFS_DEV_BLOCK
 "/sys/dev/block"

	)

56 
	#SYSFS_DEVCPU
 "/sys/deviûs/sy¡em/ıu"

	)

57 
	#SYSFS_TIME_IN_STATE
 "ıuäeq/¡©s/time_š_¡©e"

	)

58 
	#S_STAT
 "¡©"

	)

59 
	#DEVMAP_DIR
 "/dev/m­³r"

	)

60 
	#DEVICES
 "/´oc/deviûs"

	)

61 
	#SYSFS_USBDEV
 "/sys/bus/usb/deviûs"

	)

62 
	#DEV_DISK_BY
 "/dev/disk/by"

	)

63 
	#SYSFS_IDVENDOR
 "idV’dÜ"

	)

64 
	#SYSFS_IDPRODUCT
 "idProduù"

	)

65 
	#SYSFS_BMAXPOWER
 "bMaxPow”"

	)

66 
	#SYSFS_MANUFACTURER
 "mªuçùu»r"

	)

67 
	#SYSFS_PRODUCT
 "´oduù"

	)

69 
	#MAX_FILE_LEN
 256

	)

70 
	#MAX_PF_NAME
 1024

	)

71 
	#DEFAULT_DEVMAP_MAJOR
 253

	)

72 
	#MAX_NAME_LEN
 72

	)

74 
	#IGNORE_VIRTUAL_DEVICES
 
FALSE


	)

75 
	#ACCEPT_VIRTUAL_DEVICES
 
TRUE


	)

78 
	#ENV_TIME_FMT
 "S_TIME_FORMAT"

	)

79 
	#ENV_TIME_DEFTM
 "S_TIME_DEF_TIME"

	)

81 
	#DIGITS
 "0123456789"

	)

90 
	#SREALLOC
(
S
, 
TYPE
, 
SIZE
) do { \

91 
TYPE
 *
_p_
; \

92 
_p_
 = 
S
; \

93 ià(
SIZE
) { \

94 ià((
S
 = (
TYPE
 *è
	`»®loc
(S, (
SIZE
))è=ğ
NULL
) { \

95 
	`³¼Ü
("realloc"); \

96 
	`ex™
(4); \

99 ià(!
_p_
) \

100 
	`mem£t
(
S
, 0, (
SIZE
)); \

102 } 0)

	)

110 
	#S_VALUE
(
m
,
n
,
p
è(((è(Òè- (m))è/ (pè* 
HZ
)

	)

111 
	#SP_VALUE
(
m
,
n
,
p
è(((è(Òè- (m))è/ (pè* 100)

	)

117 
	#TEST_STDOUT
(
_fd_
) do { \

118 ià(
	`wr™e
(
_fd_
, "", 0) == -1) { \

119 
	`³¼Ü
("stdout"); \

120 
	`ex™
(6); \

122 } 0)

	)

124 
	#MINIMUM
(
a
,
b
è(×è< (bè? (aè: (b))

	)

126 #ifdeà
DEBUG


127 
	#PANIC
(
m
è
	`sys¡©_·nic
(
__FUNCTION__
, m)

	)

129 
	#PANIC
(
m
)

	)

133 
	#HZ
 
hz


	)

134 
hz
;

137 
kb_shiá
;

143 
	#KB_TO_PG
(
k
è((kè>> 
kb_shiá
)

	)

144 
	#PG_TO_KB
(
k
è((kè<< 
kb_shiá
)

	)

147 
³rsi¡’t_Çme_ty³
[
MAX_FILE_LEN
];

156 
	sext_disk_¡©s
 {

157 
	mut
;

158 
	mawa™
;

159 
	msvùm
;

160 
	m¬qsz
;

170 
compu‹_ext_disk_¡©s
(
¡©s_disk
 *, stats_disk *,

171 , 
ext_disk_¡©s
 *);

173 
couÁ_b™s
(*, );

175 
couÁ_csv®ues
(, **);

177 
deviû_Çme
(*);

179 
g‘_HZ
();

181 
g‘_devm­_majÜ
();

183 
g‘_š‹rv®
(, );

185 
g‘_kb_shiá
();

186 
time_t


187 
g‘_loÿÉime
(
tm
 *, );

188 
time_t


189 
g‘_time
(
tm
 *, );

191 
g‘_³r_ıu_š‹rv®
(
¡©s_ıu
 *, stats_cpu *);

193 
g‘_³rsi¡’t_Çme_äom_´‘ty
(*);

195 
g‘_³rsi¡’t_ty³_dœ
(*);

197 
g‘_´‘ty_Çme_äom_³rsi¡’t
(*);

199 
g‘_sysfs_dev_Ä
();

201 
g‘_wš_height
();

203 
š™_Æs
();

205 
is_deviû
(*, );

207 
Î_¥_v®ue
(, , );

209 
´št_g®_h—d”
(
tm
 *, *, *, *, *, );

211 
´št_v”siÚ
();

213 
¡¹Şow”
(*);

214 #ifdeà
DEBUG


216 
sys¡©_·nic
(const *, );

	@../sysstat/nusysstat/count.h

7 #iâdeà
_COUNT_H


8 
	#_COUNT_H


	)

10 
	~"commÚ.h
"

19 
g‘_ıu_Ä
(, );

21 
g‘_œqıu_Ä
(*, , );

23 
g‘_disk¡©s_dev_Ä
(, );

25 
g‘_œq_Ä
();

27 
g‘_£rŸl_Ä
();

29 
g‘_içû_Ä
();

31 
g‘_disk_Ä
();

33 
g‘_äeq_Ä
();

35 
g‘_usb_Ä
();

37 
g‘_fesy¡em_Ä
();

	@../sysstat/nusysstat/prealloc.h

6 #iâdeà
_PREALLOC_H


7 
	#_PREALLOC_H


	)

10 
	#NR_IFACE_PREALLOC
 (2 * 1)

	)

11 
	#NR_SERIAL_PREALLOC
 (2 * 1)

	)

12 
	#NR_DISK_PREALLOC
 (3 * 1)

	)

13 
	#NR_FREQ_PREALLOC
 (0 * 1)

	)

14 
	#NR_USB_PREALLOC
 (5 * 1)

	)

15 
	#NR_FILESYSTEM_PREALLOC
 (3 * 1)

	)

	@../sysstat/nusysstat/rd_sensors.h

6 #iâdeà
_RD_SENSORS_H


7 
	#_RD_SENSORS_H


	)

9 
	~"commÚ.h
"

20 
	s¡©s_pwr_çn
 {

21 
½m
 
__©Œibu‹__
 ((
®igÃd
 (8)));

22 
½m_mš
 
__©Œibu‹__
 ((
®igÃd
 (8)));

23 
	mdeviû
[
MAX_SENSORS_DEV_LEN
] 
__©Œibu‹__
 ((
®igÃd
 (8)));

26 
	#STATS_PWR_FAN_SIZE
 ((
¡©s_pwr_çn
))

	)

31 
	s¡©s_pwr_‹mp
 {

32 
‹mp
 
__©Œibu‹__
 ((
®igÃd
 (8)));

33 
‹mp_mš
 
__©Œibu‹__
 ((
®igÃd
 (8)));

34 
‹mp_max
 
__©Œibu‹__
 ((
®igÃd
 (8)));

35 
	mdeviû
[
MAX_SENSORS_DEV_LEN
] 
__©Œibu‹__
 ((
®igÃd
 (8)));

38 
	#STATS_PWR_TEMP_SIZE
 ((
¡©s_pwr_‹mp
))

	)

43 
	s¡©s_pwr_š
 {

44 
š
 
__©Œibu‹__
 ((
®igÃd
 (8)));

45 
š_mš
 
__©Œibu‹__
 ((
®igÃd
 (8)));

46 
š_max
 
__©Œibu‹__
 ((
®igÃd
 (8)));

47 
	mdeviû
[
MAX_SENSORS_DEV_LEN
] 
__©Œibu‹__
 ((
®igÃd
 (8)));

50 
	#STATS_PWR_IN_SIZE
 ((
¡©s_pwr_š
))

	)

59 
»ad_çn
(
¡©s_pwr_çn
 *, );

61 
»ad_‹mp
(
¡©s_pwr_‹mp
 *, );

63 
»ad_š
(
¡©s_pwr_š
 *, );

72 
g‘_çn_Ä
();

74 
g‘_‹mp_Ä
();

76 
g‘_š_Ä
();

	@../sysstat/nusysstat/rd_stats.h

6 #iâdeà
_RD_STATS_H


7 
	#_RD_STATS_H


	)

9 
	~"commÚ.h
"

19 
	~<Ãt/if.h
>

20 #iâdeà
IFNAMSIZ


21 
	#IFNAMSIZ
 16

	)

25 
	#MAX_IFACE_LEN
 
IFNAMSIZ


	)

27 
	#MAX_MANUF_LEN
 24

	)

29 
	#MAX_PROD_LEN
 48

	)

31 
	#MAX_FS_LEN
 72

	)

33 
	#MAX_MOUNTP_LEN
 128

	)

35 
	#CNT_PART
 1

	)

36 
	#CNT_ALL_DEV
 0

	)

37 
	#CNT_USED_DEV
 1

	)

39 
	#K_DUPLEX_HALF
 "h®f"

	)

40 
	#K_DUPLEX_FULL
 "fuÎ"

	)

42 
	#C_DUPLEX_HALF
 1

	)

43 
	#C_DUPLEX_FULL
 2

	)

52 
	#PROC
 "/´oc"

	)

53 
	#SERIAL
 "/´oc/‰y/driv”/£rŸl"

	)

54 
	#FDENTRY_STATE
 "/´oc/sys/fs/d’Œy-¡©e"

	)

55 
	#FFILE_NR
 "/´oc/sys/fs/fe-Ä"

	)

56 
	#FINODE_STATE
 "/´oc/sys/fs/šode-¡©e"

	)

57 
	#PTY_NR
 "/´oc/sys/k”Ãl/±y/Ä"

	)

58 
	#NET_DEV
 "/´oc/Ãt/dev"

	)

59 
	#NET_SOCKSTAT
 "/´oc/Ãt/sock¡©"

	)

60 
	#NET_SOCKSTAT6
 "/´oc/Ãt/sock¡©6"

	)

61 
	#NET_RPC_NFS
 "/´oc/Ãt/½c/nfs"

	)

62 
	#NET_RPC_NFSD
 "/´oc/Ãt/½c/nfsd"

	)

63 
	#LOADAVG
 "/´oc/lßdavg"

	)

64 
	#VMSTAT
 "/´oc/vm¡©"

	)

65 
	#NET_SNMP
 "/´oc/Ãt/¢mp"

	)

66 
	#NET_SNMP6
 "/´oc/Ãt/¢mp6"

	)

67 
	#CPUINFO
 "/´oc/ıušfo"

	)

68 
	#MTAB
 "/‘c/mb"

	)

69 
	#IF_DUPLEX
 "/sys/şass/Ãt/%s/du¶ex"

	)

70 
	#IF_SPEED
 "/sys/şass/Ãt/%s/¥“d"

	)

84 
	s¡©s_ıu
 {

85 
ıu_u£r
 
__©Œibu‹__
 ((
®igÃd
 (16)));

86 
ıu_niû
 
__©Œibu‹__
 ((
®igÃd
 (16)));

87 
ıu_sys
 
__©Œibu‹__
 ((
®igÃd
 (16)));

88 
ıu_idË
 
__©Œibu‹__
 ((
®igÃd
 (16)));

89 
ıu_iowa™
 
__©Œibu‹__
 ((
®igÃd
 (16)));

90 
ıu_¡—l
 
__©Œibu‹__
 ((
®igÃd
 (16)));

91 
ıu_h¬dœq
 
__©Œibu‹__
 ((
®igÃd
 (16)));

92 
ıu_soáœq
 
__©Œibu‹__
 ((
®igÃd
 (16)));

93 
ıu_gue¡
 
__©Œibu‹__
 ((
®igÃd
 (16)));

94 
ıu_gue¡_niû
 
__©Œibu‹__
 ((
®igÃd
 (16)));

97 
	#STATS_CPU_SIZE
 ((
¡©s_ıu
))

	)

104 
	s¡©s_pcsw
 {

105 
cÚ‹xt_sw™ch
 
__©Œibu‹__
 ((
®igÃd
 (16)));

106 
´oûs£s
 
__©Œibu‹__
 ((
®igÃd
 (16)));

109 
	#STATS_PCSW_SIZE
 ((
¡©s_pcsw
))

	)

119 
	s¡©s_œq
 {

120 
œq_Ä
 
__©Œibu‹__
 ((
®igÃd
 (16)));

123 
	#STATS_IRQ_SIZE
 ((
¡©s_œq
))

	)

126 
	s¡©s_sw­
 {

127 
pswpš
 
__©Œibu‹__
 ((
®igÃd
 (8)));

128 
pswpout
 
__©Œibu‹__
 ((
®igÃd
 (8)));

131 
	#STATS_SWAP_SIZE
 ((
¡©s_sw­
))

	)

134 
	s¡©s_·gšg
 {

135 
pgpgš
 
__©Œibu‹__
 ((
®igÃd
 (8)));

136 
pgpgout
 
__©Œibu‹__
 ((
®igÃd
 (8)));

137 
pgçuÉ
 
__©Œibu‹__
 ((
®igÃd
 (8)));

138 
pgmajçuÉ
 
__©Œibu‹__
 ((
®igÃd
 (8)));

139 
pgä“
 
__©Œibu‹__
 ((
®igÃd
 (8)));

140 
pgsÿn_ksw­d
 
__©Œibu‹__
 ((
®igÃd
 (8)));

141 
pgsÿn_dœeù
 
__©Œibu‹__
 ((
®igÃd
 (8)));

142 
pg¡—l
 
__©Œibu‹__
 ((
®igÃd
 (8)));

145 
	#STATS_PAGING_SIZE
 ((
¡©s_·gšg
))

	)

148 
	s¡©s_io
 {

149 
dk_drive
 
__©Œibu‹__
 ((
®igÃd
 (16)));

150 
dk_drive_rio
 
__©Œibu‹__
 ((
·cked
));

151 
dk_drive_wio
 
__©Œibu‹__
 ((
·cked
));

152 
dk_drive_rblk
 
__©Œibu‹__
 ((
·cked
));

153 
dk_drive_wblk
 
__©Œibu‹__
 ((
·cked
));

156 
	#STATS_IO_SIZE
 ((
¡©s_io
))

	)

159 
	s¡©s_memÜy
 {

160 
ämkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

161 
bufkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

162 
ÿmkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

163 
mkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

164 
äskb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

165 
skb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

166 
ÿskb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

167 
comkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

168 
aùivekb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

169 
šaùkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

170 
dœtykb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

171 
avamkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

174 
	#STATS_MEMORY_SIZE
 ((
¡©s_memÜy
))

	)

177 
	s¡©s_kbËs
 {

178 
fe_u£d
 
__©Œibu‹__
 ((
®igÃd
 (4)));

179 
šode_u£d
 
__©Œibu‹__
 ((
·cked
));

180 
d’Œy_¡©
 
__©Œibu‹__
 ((
·cked
));

181 
±y_Ä
 
__©Œibu‹__
 ((
·cked
));

184 
	#STATS_KTABLES_SIZE
 ((
¡©s_kbËs
))

	)

187 
	s¡©s_queue
 {

188 
Ä_ruÂšg
 
__©Œibu‹__
 ((
®igÃd
 (8)));

189 
´ocs_blocked
 
__©Œibu‹__
 ((
®igÃd
 (8)));

190 
lßd_avg_1
 
__©Œibu‹__
 ((
®igÃd
 (8)));

191 
lßd_avg_5
 
__©Œibu‹__
 ((
·cked
));

192 
lßd_avg_15
 
__©Œibu‹__
 ((
·cked
));

193 
Ä_th»ads
 
__©Œibu‹__
 ((
·cked
));

196 
	#STATS_QUEUE_SIZE
 ((
¡©s_queue
))

	)

199 
	s¡©s_£rŸl
 {

200 
rx
 
__©Œibu‹__
 ((
®igÃd
 (4)));

201 
tx
 
__©Œibu‹__
 ((
·cked
));

202 
äame
 
__©Œibu‹__
 ((
·cked
));

203 
·r™y
 
__©Œibu‹__
 ((
·cked
));

204 
brk
 
__©Œibu‹__
 ((
·cked
));

205 
ov”run
 
__©Œibu‹__
 ((
·cked
));

210 
lše
 
__©Œibu‹__
 ((
·cked
));

213 
	#STATS_SERIAL_SIZE
 ((
¡©s_£rŸl
))

	)

216 
	s¡©s_disk
 {

217 
Ä_ios
 
__©Œibu‹__
 ((
®igÃd
 (16)));

218 
wr_ios
 
__©Œibu‹__
 ((
®igÃd
 (16)));

219 
rd_ios
 
__©Œibu‹__
 ((
®igÃd
 (16)));

220 
wr_blks
 
__©Œibu‹__
 ((
®igÃd
 (16)));

221 
rd_blks
 
__©Œibu‹__
 ((
®igÃd
 (16)));

222 
rd_£ù
 
__©Œibu‹__
 ((
®igÃd
 (16)));

223 
wr_£ù
 
__©Œibu‹__
 ((
®igÃd
 (8)));

224 
rd_ticks
 
__©Œibu‹__
 ((
®igÃd
 (8)));

225 
wr_ticks
 
__©Œibu‹__
 ((
·cked
));

226 
tÙ_ticks
 
__©Œibu‹__
 ((
·cked
));

227 
rq_ticks
 
__©Œibu‹__
 ((
·cked
));

228 
majÜ
 
__©Œibu‹__
 ((
·cked
));

229 
mšÜ
 
__©Œibu‹__
 ((
·cked
));

230 
	mdev_Çme
[
MAX_FS_LEN
];

233 
	#STATS_DISK_SIZE
 ((
¡©s_disk
))

	)

236 
	s¡©s_Ãt_dev
 {

237 
rx_·ck‘s
 
__©Œibu‹__
 ((
®igÃd
 (16)));

238 
tx_·ck‘s
 
__©Œibu‹__
 ((
®igÃd
 (16)));

239 
rx_by‹s
 
__©Œibu‹__
 ((
®igÃd
 (16)));

240 
tx_by‹s
 
__©Œibu‹__
 ((
®igÃd
 (16)));

241 
rx_com´es£d
 
__©Œibu‹__
 ((
®igÃd
 (16)));

242 
tx_com´es£d
 
__©Œibu‹__
 ((
®igÃd
 (16)));

243 
muÉiÿ¡
 
__©Œibu‹__
 ((
®igÃd
 (16)));

244 
¥“d
 
__©Œibu‹__
 ((
®igÃd
 (16)));

245 
	mš‹rçû
[
MAX_IFACE_LEN
] 
__©Œibu‹__
 ((
®igÃd
 (4)));

246 
	mdu¶ex
;

249 
	#STATS_NET_DEV_SIZE
 ((
¡©s_Ãt_dev
))

	)

252 
	s¡©s_Ãt_edev
 {

253 
cŞlisiÚs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

254 
rx_”rÜs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

255 
tx_”rÜs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

256 
rx_drİ³d
 
__©Œibu‹__
 ((
®igÃd
 (16)));

257 
tx_drİ³d
 
__©Œibu‹__
 ((
®igÃd
 (16)));

258 
rx_fifo_”rÜs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

259 
tx_fifo_”rÜs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

260 
rx_äame_”rÜs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

261 
tx_ÿ¼›r_”rÜs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

262 
	mš‹rçû
[
MAX_IFACE_LEN
] 
__©Œibu‹__
 ((
®igÃd
 (16)));

265 
	#STATS_NET_EDEV_SIZE
 ((
¡©s_Ãt_edev
))

	)

268 
	s¡©s_Ãt_nfs
 {

269 
nfs_½cút
 
__©Œibu‹__
 ((
®igÃd
 (4)));

270 
nfs_½ü‘¿ns
 
__©Œibu‹__
 ((
·cked
));

271 
nfs_»adút
 
__©Œibu‹__
 ((
·cked
));

272 
nfs_wr™eút
 
__©Œibu‹__
 ((
·cked
));

273 
nfs_acûssút
 
__©Œibu‹__
 ((
·cked
));

274 
nfs_g‘©tút
 
__©Œibu‹__
 ((
·cked
));

277 
	#STATS_NET_NFS_SIZE
 ((
¡©s_Ãt_nfs
))

	)

280 
	s¡©s_Ãt_nfsd
 {

281 
nfsd_½cút
 
__©Œibu‹__
 ((
®igÃd
 (4)));

282 
nfsd_½cbad
 
__©Œibu‹__
 ((
·cked
));

283 
nfsd_Ãtút
 
__©Œibu‹__
 ((
·cked
));

284 
nfsd_Ãtudpút
 
__©Œibu‹__
 ((
·cked
));

285 
nfsd_Ã‰ıút
 
__©Œibu‹__
 ((
·cked
));

286 
nfsd_rch™s
 
__©Œibu‹__
 ((
·cked
));

287 
nfsd_rcmis£s
 
__©Œibu‹__
 ((
·cked
));

288 
nfsd_»adút
 
__©Œibu‹__
 ((
·cked
));

289 
nfsd_wr™eút
 
__©Œibu‹__
 ((
·cked
));

290 
nfsd_acûssút
 
__©Œibu‹__
 ((
·cked
));

291 
nfsd_g‘©tút
 
__©Œibu‹__
 ((
·cked
));

294 
	#STATS_NET_NFSD_SIZE
 ((
¡©s_Ãt_nfsd
))

	)

297 
	s¡©s_Ãt_sock
 {

298 
sock_šu£
 
__©Œibu‹__
 ((
®igÃd
 (4)));

299 
tı_šu£
 
__©Œibu‹__
 ((
·cked
));

300 
tı_tw
 
__©Œibu‹__
 ((
·cked
));

301 
udp_šu£
 
__©Œibu‹__
 ((
·cked
));

302 
¿w_šu£
 
__©Œibu‹__
 ((
·cked
));

303 
äag_šu£
 
__©Œibu‹__
 ((
·cked
));

306 
	#STATS_NET_SOCK_SIZE
 ((
¡©s_Ãt_sock
))

	)

309 
	s¡©s_Ãt_
 {

310 
InReûives
 
__©Œibu‹__
 ((
®igÃd
 (16)));

311 
FÜwD©ag¿ms
 
__©Œibu‹__
 ((
®igÃd
 (16)));

312 
InD–iv”s
 
__©Œibu‹__
 ((
®igÃd
 (16)));

313 
OutReque¡s
 
__©Œibu‹__
 ((
®igÃd
 (16)));

314 
R—smReqds
 
__©Œibu‹__
 ((
®igÃd
 (16)));

315 
R—smOKs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

316 
F¿gOKs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

317 
F¿gC»©es
 
__©Œibu‹__
 ((
®igÃd
 (16)));

320 
	#STATS_NET_IP_SIZE
 ((
¡©s_Ãt_
))

	)

323 
	s¡©s_Ãt_e
 {

324 
InHdrE¼Üs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

325 
InAddrE¼Üs
 
__©Œibu‹__
 ((
®igÃd
 (16)));

326 
InUnknownPrÙos
 
__©Œibu‹__
 ((
®igÃd
 (16)));

327 
InDisÿrds
 
__©Œibu‹__
 ((
®igÃd
 (16)));

328 
OutDisÿrds
 
__©Œibu‹__
 ((
®igÃd
 (16)));

329 
OutNoRou‹s
 
__©Œibu‹__
 ((
®igÃd
 (16)));

330 
R—smFas
 
__©Œibu‹__
 ((
®igÃd
 (16)));

331 
F¿gFas
 
__©Œibu‹__
 ((
®igÃd
 (16)));

334 
	#STATS_NET_EIP_SIZE
 ((
¡©s_Ãt_e
))

	)

337 
	s¡©s_Ãt_icmp
 {

338 
InMsgs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

339 
OutMsgs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

340 
InEchos
 
__©Œibu‹__
 ((
®igÃd
 (8)));

341 
InEchoR•s
 
__©Œibu‹__
 ((
®igÃd
 (8)));

342 
OutEchos
 
__©Œibu‹__
 ((
®igÃd
 (8)));

343 
OutEchoR•s
 
__©Œibu‹__
 ((
®igÃd
 (8)));

344 
InTime¡amps
 
__©Œibu‹__
 ((
®igÃd
 (8)));

345 
InTime¡ampR•s
 
__©Œibu‹__
 ((
®igÃd
 (8)));

346 
OutTime¡amps
 
__©Œibu‹__
 ((
®igÃd
 (8)));

347 
OutTime¡ampR•s
 
__©Œibu‹__
 ((
®igÃd
 (8)));

348 
InAddrMasks
 
__©Œibu‹__
 ((
®igÃd
 (8)));

349 
InAddrMaskR•s
 
__©Œibu‹__
 ((
®igÃd
 (8)));

350 
OutAddrMasks
 
__©Œibu‹__
 ((
®igÃd
 (8)));

351 
OutAddrMaskR•s
 
__©Œibu‹__
 ((
®igÃd
 (8)));

354 
	#STATS_NET_ICMP_SIZE
 ((
¡©s_Ãt_icmp
))

	)

357 
	s¡©s_Ãt_eicmp
 {

358 
InE¼Üs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

359 
OutE¼Üs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

360 
InDe¡UÄ—chs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

361 
OutDe¡UÄ—chs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

362 
InTimeExcds
 
__©Œibu‹__
 ((
®igÃd
 (8)));

363 
OutTimeExcds
 
__©Œibu‹__
 ((
®igÃd
 (8)));

364 
InP¬mProbs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

365 
OutP¬mProbs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

366 
InSrcQu’chs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

367 
OutSrcQu’chs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

368 
InRedœeùs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

369 
OutRedœeùs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

372 
	#STATS_NET_EICMP_SIZE
 ((
¡©s_Ãt_eicmp
))

	)

375 
	s¡©s_Ãt_tı
 {

376 
AùiveO³ns
 
__©Œibu‹__
 ((
®igÃd
 (8)));

377 
PassiveO³ns
 
__©Œibu‹__
 ((
®igÃd
 (8)));

378 
InSegs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

379 
OutSegs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

382 
	#STATS_NET_TCP_SIZE
 ((
¡©s_Ãt_tı
))

	)

385 
	s¡©s_Ãt_‘ı
 {

386 
A‰em±Fas
 
__©Œibu‹__
 ((
®igÃd
 (8)));

387 
E¡abRe£ts
 
__©Œibu‹__
 ((
®igÃd
 (8)));

388 
R‘¿nsSegs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

389 
InE¼s
 
__©Œibu‹__
 ((
®igÃd
 (8)));

390 
OutR¡s
 
__©Œibu‹__
 ((
®igÃd
 (8)));

393 
	#STATS_NET_ETCP_SIZE
 ((
¡©s_Ãt_‘ı
))

	)

396 
	s¡©s_Ãt_udp
 {

397 
InD©ag¿ms
 
__©Œibu‹__
 ((
®igÃd
 (8)));

398 
OutD©ag¿ms
 
__©Œibu‹__
 ((
®igÃd
 (8)));

399 
NoPÜts
 
__©Œibu‹__
 ((
®igÃd
 (8)));

400 
InE¼Üs
 
__©Œibu‹__
 ((
®igÃd
 (8)));

403 
	#STATS_NET_UDP_SIZE
 ((
¡©s_Ãt_udp
))

	)

406 
	s¡©s_Ãt_6
 {

407 
InReûives6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

408 
OutFÜwD©ag¿ms6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

409 
InD–iv”s6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

410 
OutReque¡s6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

411 
R—smReqds6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

412 
R—smOKs6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

413 
InMÿ¡Pkts6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

414 
OutMÿ¡Pkts6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

415 
F¿gOKs6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

416 
F¿gC»©es6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

419 
	#STATS_NET_IP6_SIZE
 ((
¡©s_Ãt_6
))

	)

422 
	s¡©s_Ãt_e6
 {

423 
InHdrE¼Üs6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

424 
InAddrE¼Üs6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

425 
InUnknownPrÙos6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

426 
InTooBigE¼Üs6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

427 
InDisÿrds6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

428 
OutDisÿrds6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

429 
InNoRou‹s6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

430 
OutNoRou‹s6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

431 
R—smFas6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

432 
F¿gFas6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

433 
InTrunÿ‹dPkts6
 
__©Œibu‹__
 ((
®igÃd
 (16)));

436 
	#STATS_NET_EIP6_SIZE
 ((
¡©s_Ãt_e6
))

	)

439 
	s¡©s_Ãt_icmp6
 {

440 
InMsgs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

441 
OutMsgs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

442 
InEchos6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

443 
InEchoR•l›s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

444 
OutEchoR•l›s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

445 
InGroupMembQu”›s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

446 
InGroupMembRe¥Ú£s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

447 
OutGroupMembRe¥Ú£s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

448 
InGroupMembReduùiÚs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

449 
OutGroupMembReduùiÚs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

450 
InRou‹rSŞic™s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

451 
OutRou‹rSŞic™s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

452 
InRou‹rAdv”ti£m’ts6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

453 
InNeighbÜSŞic™s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

454 
OutNeighbÜSŞic™s6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

455 
InNeighbÜAdv”ti£m’ts6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

456 
OutNeighbÜAdv”ti£m’ts6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

459 
	#STATS_NET_ICMP6_SIZE
 ((
¡©s_Ãt_icmp6
))

	)

462 
	s¡©s_Ãt_eicmp6
 {

463 
InE¼Üs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

464 
InDe¡UÄ—chs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

465 
OutDe¡UÄ—chs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

466 
InTimeExcds6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

467 
OutTimeExcds6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

468 
InP¬mProbËms6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

469 
OutP¬mProbËms6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

470 
InRedœeùs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

471 
OutRedœeùs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

472 
InPktTooBigs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

473 
OutPktTooBigs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

476 
	#STATS_NET_EICMP6_SIZE
 ((
¡©s_Ãt_eicmp6
))

	)

479 
	s¡©s_Ãt_udp6
 {

480 
InD©ag¿ms6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

481 
OutD©ag¿ms6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

482 
NoPÜts6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

483 
InE¼Üs6
 
__©Œibu‹__
 ((
®igÃd
 (8)));

486 
	#STATS_NET_UDP6_SIZE
 ((
¡©s_Ãt_udp6
))

	)

489 
	s¡©s_Ãt_sock6
 {

490 
tı6_šu£
 
__©Œibu‹__
 ((
®igÃd
 (4)));

491 
udp6_šu£
 
__©Œibu‹__
 ((
·cked
));

492 
¿w6_šu£
 
__©Œibu‹__
 ((
·cked
));

493 
äag6_šu£
 
__©Œibu‹__
 ((
·cked
));

496 
	#STATS_NET_SOCK6_SIZE
 ((
¡©s_Ãt_sock6
))

	)

503 
	s¡©s_pwr_ıuäeq
 {

504 
ıuäeq
 
__©Œibu‹__
 ((
®igÃd
 (8)));

507 
	#STATS_PWR_CPUFREQ_SIZE
 ((
¡©s_pwr_ıuäeq
))

	)

510 
	s¡©s_huge
 {

511 
ähkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

512 
hkb
 
__©Œibu‹__
 ((
®igÃd
 (8)));

515 
	#STATS_HUGE_SIZE
 ((
¡©s_memÜy
))

	)

522 
	s¡©s_pwr_wghäeq
 {

523 
time_š_¡©e
 
__©Œibu‹__
 ((
®igÃd
 (16)));

524 
äeq
 
__©Œibu‹__
 ((
®igÃd
 (16)));

527 
	#STATS_PWR_WGHFREQ_SIZE
 ((
¡©s_pwr_wghäeq
))

	)

532 
	s¡©s_pwr_usb
 {

533 
bus_Ä
 
__©Œibu‹__
 ((
®igÃd
 (4)));

534 
v’dÜ_id
 
__©Œibu‹__
 ((
·cked
));

535 
´oduù_id
 
__©Œibu‹__
 ((
·cked
));

536 
bmaxpow”
 
__©Œibu‹__
 ((
·cked
));

537 
	mmªuçùu»r
[
MAX_MANUF_LEN
];

538 
	m´oduù
[
MAX_PROD_LEN
];

541 
	#STATS_PWR_USB_SIZE
 ((
¡©s_pwr_usb
))

	)

544 
	s¡©s_fesy¡em
 {

545 
f_blocks
 
__©Œibu‹__
 ((
®igÃd
 (16)));

546 
f_bä“
 
__©Œibu‹__
 ((
®igÃd
 (16)));

547 
f_bava
 
__©Œibu‹__
 ((
®igÃd
 (16)));

548 
f_fes
 
__©Œibu‹__
 ((
®igÃd
 (16)));

549 
f_fä“
 
__©Œibu‹__
 ((
®igÃd
 (16)));

550 
	mfs_Çme
[
MAX_FS_LEN
] 
__©Œibu‹__
 ((
®igÃd
 (16)));

551 
	mmouÁp
[
MAX_MOUNTP_LEN
];

554 
	#STATS_FILESYSTEM_SIZE
 ((
¡©s_fesy¡em
))

	)

563 
»ad_¡©_ıu
(
¡©s_ıu
 *, ,

566 
»ad_¡©_œq
(
¡©s_œq
 *, );

568 
»ad_memšfo
(
¡©s_memÜy
 *);

570 
»ad_u±ime
(*);

573 
où2chr
(*);

575 
»ad_¡©_pcsw
(
¡©s_pcsw
 *);

577 
»ad_lßdavg
(
¡©s_queue
 *);

579 
»ad_vm¡©_sw­
(
¡©s_sw­
 *);

581 
»ad_vm¡©_·gšg
(
¡©s_·gšg
 *);

583 
»ad_disk¡©s_io
(
¡©s_io
 *);

585 
»ad_disk¡©s_disk
(
¡©s_disk
 *, , );

587 
»ad_‰y_driv”_£rŸl
(
¡©s_£rŸl
 *, );

589 
»ad_k”Ãl_bËs
(
¡©s_kbËs
 *);

591 
»ad_Ãt_dev
(
¡©s_Ãt_dev
 *, );

593 
»ad_if_šfo
(
¡©s_Ãt_dev
 *, );

595 
»ad_Ãt_edev
(
¡©s_Ãt_edev
 *, );

597 
»ad_Ãt_nfs
(
¡©s_Ãt_nfs
 *);

599 
»ad_Ãt_nfsd
(
¡©s_Ãt_nfsd
 *);

601 
»ad_Ãt_sock
(
¡©s_Ãt_sock
 *);

603 
»ad_Ãt_
(
¡©s_Ãt_
 *);

605 
»ad_Ãt_e
(
¡©s_Ãt_e
 *);

607 
»ad_Ãt_icmp
(
¡©s_Ãt_icmp
 *);

609 
»ad_Ãt_eicmp
(
¡©s_Ãt_eicmp
 *);

611 
»ad_Ãt_tı
(
¡©s_Ãt_tı
 *);

613 
»ad_Ãt_‘ı
(
¡©s_Ãt_‘ı
 *);

615 
»ad_Ãt_udp
(
¡©s_Ãt_udp
 *);

617 
»ad_Ãt_sock6
(
¡©s_Ãt_sock6
 *);

619 
»ad_Ãt_6
(
¡©s_Ãt_6
 *);

621 
»ad_Ãt_e6
(
¡©s_Ãt_e6
 *);

623 
»ad_Ãt_icmp6
(
¡©s_Ãt_icmp6
 *);

625 
»ad_Ãt_eicmp6
(
¡©s_Ãt_eicmp6
 *);

627 
»ad_Ãt_udp6
(
¡©s_Ãt_udp6
 *);

629 
»ad_ıušfo
(
¡©s_pwr_ıuäeq
 *, );

631 
»ad_memšfo_huge
(
¡©s_huge
 *);

633 
»ad_time_š_¡©e
(
¡©s_pwr_wghäeq
 *, , );

635 
»ad_bus_usb_dev
(
¡©s_pwr_usb
 *, );

637 
»ad_fesy¡em
(
¡©s_fesy¡em
 *, );

	@../sysstat/nusysstat/sa.h

6 #iâdeà
_SA_H


7 
	#_SA_H


	)

9 
	~<¡dio.h
>

11 
	~"commÚ.h
"

12 
	~"´—Îoc.h
"

13 
	~"rd_¡©s.h
"

14 
	~"rd_£nsÜs.h
"

23 
	#NR_ACT
 37

	)

26 
	#A_CPU
 1

	)

27 
	#A_PCSW
 2

	)

28 
	#A_IRQ
 3

	)

29 
	#A_SWAP
 4

	)

30 
	#A_PAGE
 5

	)

31 
	#A_IO
 6

	)

32 
	#A_MEMORY
 7

	)

33 
	#A_KTABLES
 8

	)

34 
	#A_QUEUE
 9

	)

35 
	#A_SERIAL
 10

	)

36 
	#A_DISK
 11

	)

37 
	#A_NET_DEV
 12

	)

38 
	#A_NET_EDEV
 13

	)

39 
	#A_NET_NFS
 14

	)

40 
	#A_NET_NFSD
 15

	)

41 
	#A_NET_SOCK
 16

	)

42 
	#A_NET_IP
 17

	)

43 
	#A_NET_EIP
 18

	)

44 
	#A_NET_ICMP
 19

	)

45 
	#A_NET_EICMP
 20

	)

46 
	#A_NET_TCP
 21

	)

47 
	#A_NET_ETCP
 22

	)

48 
	#A_NET_UDP
 23

	)

49 
	#A_NET_SOCK6
 24

	)

50 
	#A_NET_IP6
 25

	)

51 
	#A_NET_EIP6
 26

	)

52 
	#A_NET_ICMP6
 27

	)

53 
	#A_NET_EICMP6
 28

	)

54 
	#A_NET_UDP6
 29

	)

55 
	#A_PWR_CPUFREQ
 30

	)

56 
	#A_PWR_FAN
 31

	)

57 
	#A_PWR_TEMP
 32

	)

58 
	#A_PWR_IN
 33

	)

59 
	#A_HUGE
 34

	)

60 
	#A_PWR_WGHFREQ
 35

	)

61 
	#A_PWR_USB
 36

	)

62 
	#A_FILESYSTEM
 37

	)

66 
	#COLLECT_ACTIVITY
(
m
è
aù
[
	`g‘_aùiv™y_pos™iÚ
×ù, m)]->
İtiÚs
 |ğ
AO_COLLECTED


	)

69 
	#SELECT_ACTIVITY
(
m
è
aù
[
	`g‘_aùiv™y_pos™iÚ
×ù, m)]->
İtiÚs
 |ğ
AO_SELECTED


	)

78 
	#S_F_SINCE_BOOT
 0x00000001

	)

79 
	#S_F_SA_ROTAT
 0x00000002

	)

80 
	#S_F_DEV_PRETTY
 0x00000004

	)

81 
	#S_F_FORCE_FILE
 0x00000008

	)

82 
	#S_F_INTERVAL_SET
 0x00000010

	)

83 
	#S_F_TRUE_TIME
 0x00000020

	)

84 
	#S_F_LOCK_FILE
 0x00000040

	)

85 
	#S_F_SEC_EPOCH
 0x00000080

	)

86 
	#S_F_HDR_ONLY
 0x00000100

	)

87 
	#S_F_FILE_LOCKED
 0x00000200

	)

88 
	#S_F_SA_YYYYMMDD
 0x00000400

	)

89 
	#S_F_HORIZONTALLY
 0x00000800

	)

90 
	#S_F_COMMENT
 0x00001000

	)

91 
	#S_F_PERSIST_NAME
 0x00002000

	)

92 
	#S_F_LOCAL_TIME
 0x00004000

	)

94 
	#WANT_SINCE_BOOT
(
m
è(((mè& 
S_F_SINCE_BOOT
è=ğS_F_SINCE_BOOT)

	)

95 
	#WANT_SA_ROTAT
(
m
è(((mè& 
S_F_SA_ROTAT
è=ğS_F_SA_ROTAT)

	)

96 
	#USE_PRETTY_OPTION
(
m
è(((mè& 
S_F_DEV_PRETTY
è=ğS_F_DEV_PRETTY)

	)

97 
	#FORCE_FILE
(
m
è(((mè& 
S_F_FORCE_FILE
è=ğS_F_FORCE_FILE)

	)

98 
	#INTERVAL_SET
(
m
è(((mè& 
S_F_INTERVAL_SET
è=ğS_F_INTERVAL_SET)

	)

99 
	#PRINT_TRUE_TIME
(
m
è(((mè& 
S_F_TRUE_TIME
è=ğS_F_TRUE_TIME)

	)

100 
	#LOCK_FILE
(
m
è(((mè& 
S_F_LOCK_FILE
è=ğS_F_LOCK_FILE)

	)

101 
	#PRINT_SEC_EPOCH
(
m
è(((mè& 
S_F_SEC_EPOCH
è=ğS_F_SEC_EPOCH)

	)

102 
	#DISPLAY_HDR_ONLY
(
m
è(((mè& 
S_F_HDR_ONLY
è=ğS_F_HDR_ONLY)

	)

103 
	#FILE_LOCKED
(
m
è(((mè& 
S_F_FILE_LOCKED
è=ğS_F_FILE_LOCKED)

	)

104 
	#USE_SA_YYYYMMDD
(
m
è(((mè& 
S_F_SA_YYYYMMDD
è=ğS_F_SA_YYYYMMDD)

	)

105 
	#DISPLAY_HORIZONTALLY
(
m
è(((mè& 
S_F_HORIZONTALLY
è=ğS_F_HORIZONTALLY)

	)

106 
	#DISPLAY_COMMENT
(
m
è(((mè& 
S_F_COMMENT
è=ğS_F_COMMENT)

	)

107 
	#DISPLAY_PERSIST_NAME_S
(
m
è(((mè& 
S_F_PERSIST_NAME
è=ğS_F_PERSIST_NAME)

	)

108 
	#PRINT_LOCAL_TIME
(
m
è(((mè& 
S_F_LOCAL_TIME
è=ğS_F_LOCAL_TIME)

	)

110 
	#AO_F_NULL
 0x00000000

	)

113 
	#AO_F_MEM_DIA
 0x00000001

	)

114 
	#AO_F_MEM_AMT
 0x00000002

	)

115 
	#AO_F_MEM_SWAP
 0x00000004

	)

117 
	#DISPLAY_MEMORY
(
m
è(((mè& 
AO_F_MEM_DIA
è=ğAO_F_MEM_DIA)

	)

118 
	#DISPLAY_MEM_AMT
(
m
è(((mè& 
AO_F_MEM_AMT
è=ğAO_F_MEM_AMT)

	)

119 
	#DISPLAY_SWAP
(
m
è(((mè& 
AO_F_MEM_SWAP
è=ğAO_F_MEM_SWAP)

	)

122 
	#AO_F_CPU_DEF
 0x00000001

	)

123 
	#AO_F_CPU_ALL
 0x00000002

	)

125 
	#DISPLAY_CPU_DEF
(
m
è(((mè& 
AO_F_CPU_DEF
è=ğAO_F_CPU_DEF)

	)

126 
	#DISPLAY_CPU_ALL
(
m
è(((mè& 
AO_F_CPU_ALL
è=ğAO_F_CPU_ALL)

	)

129 
	#AO_F_DISK_PART
 0x00000001

	)

131 
	#COLLECT_PARTITIONS
(
m
è(((mè& 
AO_F_DISK_PART
è=ğAO_F_DISK_PART)

	)

140 
	#K_XALL
 "XALL"

	)

141 
	#K_SUM
 "SUM"

	)

142 
	#K_DEV
 "DEV"

	)

143 
	#K_EDEV
 "EDEV"

	)

144 
	#K_NFS
 "NFS"

	)

145 
	#K_NFSD
 "NFSD"

	)

146 
	#K_SOCK
 "SOCK"

	)

147 
	#K_IP
 "IP"

	)

148 
	#K_EIP
 "EIP"

	)

149 
	#K_ICMP
 "ICMP"

	)

150 
	#K_EICMP
 "EICMP"

	)

151 
	#K_TCP
 "TCP"

	)

152 
	#K_ETCP
 "ETCP"

	)

153 
	#K_UDP
 "UDP"

	)

154 
	#K_SOCK6
 "SOCK6"

	)

155 
	#K_IP6
 "IP6"

	)

156 
	#K_EIP6
 "EIP6"

	)

157 
	#K_ICMP6
 "ICMP6"

	)

158 
	#K_EICMP6
 "EICMP6"

	)

159 
	#K_UDP6
 "UDP6"

	)

160 
	#K_CPU
 "CPU"

	)

161 
	#K_FAN
 "FAN"

	)

162 
	#K_TEMP
 "TEMP"

	)

163 
	#K_IN
 "IN"

	)

164 
	#K_FREQ
 "FREQ"

	)

166 
	#K_INT
 "INT"

	)

167 
	#K_DISK
 "DISK"

	)

168 
	#K_XDISK
 "XDISK"

	)

169 
	#K_SNMP
 "SNMP"

	)

170 
	#K_IPV6
 "IPV6"

	)

171 
	#K_POWER
 "POWER"

	)

172 
	#K_USB
 "USB"

	)

175 
	#G_DEFAULT
 0x00

	)

176 
	#G_INT
 0x01

	)

177 
	#G_DISK
 0x02

	)

178 
	#G_SNMP
 0x04

	)

179 
	#G_IPV6
 0x08

	)

180 
	#G_POWER
 0x10

	)

181 
	#G_XDISK
 0x20

	)

184 
	#SADC
 "§dc"

	)

187 
	#DEF_TMSTART
 "08:00:00"

	)

188 
	#DEF_TMEND
 "18:00:00"

	)

195 
	#BITMAP_SIZE
(
m
è((((mè+ 1è/ 8è+ 1)

	)

197 
	#UTSNAME_LEN
 65

	)

198 
	#TIMESTAMP_LEN
 16

	)

199 
	#HEADER_LINE_LEN
 512

	)

202 
	#MAX_ARGV_NR
 32

	)

205 
	#USE_SADC
 0

	)

206 
	#USE_SA_FILE
 1

	)

207 
	#NO_TM_START
 0

	)

208 
	#NO_TM_END
 0

	)

209 
	#NO_RESET
 0

	)

210 
	#NON_FATAL
 0

	)

211 
	#FATAL
 1

	)

212 
	#C_SAR
 0

	)

213 
	#C_SADF
 1

	)

214 
	#ALL_ACTIVITIES
 ~0U

	)

216 
	#SOFT_SIZE
 0

	)

217 
	#HARD_SIZE
 1

	)

219 
	#CLOSE_XML_MARKUP
 0

	)

220 
	#OPEN_XML_MARKUP
 1

	)

222 
	#CLOSE_JSON_MARKUP
 0

	)

223 
	#OPEN_JSON_MARKUP
 1

	)

225 
	#COUNT_ACTIVITIES
 0

	)

226 
	#COUNT_OUTPUTS
 1

	)

236 
	#AO_NULL
 0x00

	)

240 
	#AO_COLLECTED
 0x01

	)

244 
	#AO_SELECTED
 0x02

	)

253 
	#AO_VOLATILE
 0x04

	)

259 
	#AO_GLOBAL_ITV
 0x08

	)

265 
	#AO_CLOSE_MARKUP
 0x10

	)

271 
	#AO_MULTIPLE_OUTPUTS
 0x20

	)

273 
	#IS_COLLECTED
(
m
è(((mè& 
AO_COLLECTED
è=ğAO_COLLECTED)

	)

274 
	#IS_SELECTED
(
m
è(((mè& 
AO_SELECTED
è=ğAO_SELECTED)

	)

275 
	#IS_VOLATILE
(
m
è(((mè& 
AO_VOLATILE
è=ğAO_VOLATILE)

	)

276 
	#NEED_GLOBAL_ITV
(
m
è(((mè& 
AO_GLOBAL_ITV
è=ğAO_GLOBAL_ITV)

	)

277 
	#CLOSE_MARKUP
(
m
è(((mè& 
AO_CLOSE_MARKUP
è=ğAO_CLOSE_MARKUP)

	)

278 
	#HAS_MULTIPLE_OUTPUTS
(
m
è(((mè& 
AO_MULTIPLE_OUTPUTS
è=ğAO_MULTIPLE_OUTPUTS)

	)

281 
	#__Ä_t
 

	)

283 
	#__»ad_funù_t
 

	)

285 
	#__´št_funù_t
 

	)

287 
	#_buf0
 
buf
[0]

	)

290 
	saù_b™m­
 {

295 *
	mb_¬¿y
;

300 
	mb_size
;

307 
	saùiv™y
 {

311 
	mid
;

315 
	mİtiÚs
;

321 
	mmagic
;

326 
	mgroup
;

339 
__Ä_t
 (*
f_couÁ
è(
	maùiv™y
 *);

349 
__Ä_t
 (*
f_couÁ2
è(
	maùiv™y
 *);

354 
__»ad_funù_t
 (*
f_»ad
è(
	maùiv™y
 *);

358 
__´št_funù_t
 (*
f_´št
è(
	maùiv™y
 *, , , );

362 
__´št_funù_t
 (*
f_´št_avg
è(
	maùiv™y
 *, , , );

368 
__´št_funù_t
 (*
f_»nd”
è(
	maùiv™y
 *, , *, , );

372 
__´št_funù_t
 (*
f_xml_´št
è(
	maùiv™y
 *, , , );

376 
__´št_funù_t
 (*
f_jsÚ_´št
è(
	maùiv™y
 *, , , );

380 *
	mhdr_lše
;

384 *
	mÇme
;

393 
__Ä_t
 
	mÄ
;

409 
__Ä_t
 
	mÄ2
;

415 
	mfsize
;

422 
	mmsize
;

427 
	mİt_æags
;

435 *
	mbuf
[3];

440 
aù_b™m­
 *
	mb™m­
;

481 
	#SYSSTAT_MAGIC
 0xd596

	)

488 
	#FORMAT_MAGIC
 0x2173

	)

491 
	sfe_magic
 {

495 
	msys¡©_magic
;

499 
	mfÜm©_magic
;

503 
	msys¡©_v”siÚ
;

504 
	msys¡©_·tchËv–
;

505 
	msys¡©_subËv–
;

506 
	msys¡©_exŒav”siÚ
;

510 
	mh—d”_size
;

514 
	m·d
[64];

517 
	#FILE_MAGIC_SIZE
 ((
fe_magic
))

	)

521 
	sfe_h—d”
 {

525 
§_u¡_time
 
__©Œibu‹__
 ((
®igÃd
 (8)));

529 
§_Ï¡_ıu_Ä
 
__©Œibu‹__
 ((
®igÃd
 (8)));

533 
	m§_aù_Ä
;

538 
	m§_vŞ_aù_Ä
;

544 
	m§_day
;

545 
	m§_mÚth
;

546 
	m§_y—r
;

551 
	m§_sizeof_lÚg
;

555 
	m§_sy¢ame
[
UTSNAME_LEN
];

559 
	m§_nod’ame
[
UTSNAME_LEN
];

563 
	m§_»Ëa£
[
UTSNAME_LEN
];

567 
	m§_machše
[
UTSNAME_LEN
];

570 
	#FILE_HEADER_SIZE
 ((
fe_h—d”
))

	)

576 
	#ACTIVITY_MAGIC_BASE
 0x8a

	)

581 
	#ACTIVITY_MAGIC_UNKNOWN
 0x89

	)

584 
	sfe_aùiv™y
 {

588 
id
 
__©Œibu‹__
 ((
®igÃd
 (4)));

592 
magic
 
__©Œibu‹__
 ((
·cked
));

596 
__Ä_t
 
Ä
 
__©Œibu‹__
 ((
·cked
));

600 
__Ä_t
 
Ä2
 
__©Œibu‹__
 ((
·cked
));

604 
size
 
__©Œibu‹__
 ((
·cked
));

607 
	#FILE_ACTIVITY_SIZE
 ((
fe_aùiv™y
))

	)

614 
	#R_STATS
 1

	)

619 
	#R_RESTART
 2

	)

626 
	#R_LAST_STATS
 3

	)

631 
	#R_COMMENT
 4

	)

634 
	#MAX_COMMENT_LEN
 64

	)

637 
	s»cÜd_h—d”
 {

641 
u±ime
 
__©Œibu‹__
 ((
®igÃd
 (16)));

645 
u±ime0
 
__©Œibu‹__
 ((
®igÃd
 (16)));

649 
u¡_time
 
__©Œibu‹__
 ((
®igÃd
 (16)));

653 
»cÜd_ty³
 
__©Œibu‹__
 ((
®igÃd
 (8)));

658 
	mhour
;

659 
	mmšu‹
;

660 
	m£cÚd
;

663 
	#RECORD_HEADER_SIZE
 ((
»cÜd_h—d”
))

	)

676 
	#CLOSE_ALL
(
_fd_
) do { \

677 
	`şo£
(
_fd_
[0]); \

678 
	`şo£
(
_fd_
[1]); \

679 } 0)

	)

681 
	#CLOSE
(
_fd_
) if (_fd_ >= 0) \

682 
	`şo£
(
_fd_
)

	)

692 
	st¡amp
 {

693 
	mtm_£c
;

694 
	mtm_mš
;

695 
	mtm_hour
;

696 
	mu£
;

707 
__Ä_t


708 
w¿p_g‘_ıu_Ä
(
aùiv™y
 *);

709 
__Ä_t


710 
w¿p_g‘_œq_Ä
(
aùiv™y
 *);

711 
__Ä_t


712 
w¿p_g‘_£rŸl_Ä
(
aùiv™y
 *);

713 
__Ä_t


714 
w¿p_g‘_disk_Ä
(
aùiv™y
 *);

715 
__Ä_t


716 
w¿p_g‘_içû_Ä
(
aùiv™y
 *);

717 
__Ä_t


718 
w¿p_g‘_çn_Ä
(
aùiv™y
 *);

719 
__Ä_t


720 
w¿p_g‘_‹mp_Ä
(
aùiv™y
 *);

721 
__Ä_t


722 
w¿p_g‘_š_Ä
(
aùiv™y
 *);

723 
__Ä_t


724 
w¿p_g‘_äeq_Ä
(
aùiv™y
 *);

725 
__Ä_t


726 
w¿p_g‘_usb_Ä
(
aùiv™y
 *);

727 
__Ä_t


728 
w¿p_g‘_fesy¡em_Ä
(
aùiv™y
 *);

731 
__»ad_funù_t


732 
w¿p_»ad_¡©_ıu
(
aùiv™y
 *);

733 
__»ad_funù_t


734 
w¿p_»ad_¡©_pcsw
(
aùiv™y
 *);

735 
__»ad_funù_t


736 
w¿p_»ad_¡©_œq
(
aùiv™y
 *);

737 
__»ad_funù_t


738 
w¿p_»ad_sw­
(
aùiv™y
 *);

739 
__»ad_funù_t


740 
w¿p_»ad_·gšg
(
aùiv™y
 *);

741 
__»ad_funù_t


742 
w¿p_»ad_io
(
aùiv™y
 *);

743 
__»ad_funù_t


744 
w¿p_»ad_memšfo
(
aùiv™y
 *);

745 
__»ad_funù_t


746 
w¿p_»ad_k”Ãl_bËs
(
aùiv™y
 *);

747 
__»ad_funù_t


748 
w¿p_»ad_lßdavg
(
aùiv™y
 *);

749 
__»ad_funù_t


750 
w¿p_»ad_‰y_driv”_£rŸl
(
aùiv™y
 *);

751 
__»ad_funù_t


752 
w¿p_»ad_disk
(
aùiv™y
 *);

753 
__»ad_funù_t


754 
w¿p_»ad_Ãt_dev
(
aùiv™y
 *);

755 
__»ad_funù_t


756 
w¿p_»ad_Ãt_edev
(
aùiv™y
 *);

757 
__»ad_funù_t


758 
w¿p_»ad_Ãt_nfs
(
aùiv™y
 *);

759 
__»ad_funù_t


760 
w¿p_»ad_Ãt_nfsd
(
aùiv™y
 *);

761 
__»ad_funù_t


762 
w¿p_»ad_Ãt_sock
(
aùiv™y
 *);

763 
__»ad_funù_t


764 
w¿p_»ad_Ãt_
(
aùiv™y
 *);

765 
__»ad_funù_t


766 
w¿p_»ad_Ãt_e
(
aùiv™y
 *);

767 
__»ad_funù_t


768 
w¿p_»ad_Ãt_icmp
(
aùiv™y
 *);

769 
__»ad_funù_t


770 
w¿p_»ad_Ãt_eicmp
(
aùiv™y
 *);

771 
__»ad_funù_t


772 
w¿p_»ad_Ãt_tı
(
aùiv™y
 *);

773 
__»ad_funù_t


774 
w¿p_»ad_Ãt_‘ı
(
aùiv™y
 *);

775 
__»ad_funù_t


776 
w¿p_»ad_Ãt_udp
(
aùiv™y
 *);

777 
__»ad_funù_t


778 
w¿p_»ad_Ãt_sock6
(
aùiv™y
 *);

779 
__»ad_funù_t


780 
w¿p_»ad_Ãt_6
(
aùiv™y
 *);

781 
__»ad_funù_t


782 
w¿p_»ad_Ãt_e6
(
aùiv™y
 *);

783 
__»ad_funù_t


784 
w¿p_»ad_Ãt_icmp6
(
aùiv™y
 *);

785 
__»ad_funù_t


786 
w¿p_»ad_Ãt_eicmp6
(
aùiv™y
 *);

787 
__»ad_funù_t


788 
w¿p_»ad_Ãt_udp6
(
aùiv™y
 *);

789 
__»ad_funù_t


790 
w¿p_»ad_ıušfo
(
aùiv™y
 *);

791 
__»ad_funù_t


792 
w¿p_»ad_çn
(
aùiv™y
 *);

793 
__»ad_funù_t


794 
w¿p_»ad_‹mp
(
aùiv™y
 *);

795 
__»ad_funù_t


796 
w¿p_»ad_š
(
aùiv™y
 *);

797 
__»ad_funù_t


798 
w¿p_»ad_memšfo_huge
(
aùiv™y
 *);

799 
__»ad_funù_t


800 
w¿p_»ad_time_š_¡©e
(
aùiv™y
 *);

801 
__»ad_funù_t


802 
w¿p_»ad_bus_usb_dev
(
aùiv™y
 *);

803 
__»ad_funù_t


804 
w¿p_»ad_fesy¡em
(
aùiv™y
 *);

808 
®loÿ‹_b™m­s
(
aùiv™y
 * []);

810 
®loÿ‹_¡ruùu»s
(
aùiv™y
 * []);

812 
check_®t_§_dœ
(*, , );

814 
check_disk_»g
(
aùiv™y
 *, , , );

816 
check_fe_aùl¡
(*, *, 
aùiv™y
 * [], 
fe_magic
 *,

817 
fe_h—d”
 *, 
fe_aùiv™y
 **,

820 
check_Ãt_dev_»g
(
aùiv™y
 *, , , );

822 
check_Ãt_edev_»g
(
aùiv™y
 *, , , );

824 
compu‹_ifut
(
¡©s_Ãt_dev
 *, , );

826 
cİy_¡ruùu»s
(
aùiv™y
 * [], [],

827 
»cÜd_h—d”
 [], , );

829 
d©ecmp
(
tm
 *, 
t¡amp
 *);

831 
di¥Ïy_§_fe_v”siÚ
(
FILE
 *, 
fe_magic
 *);

833 
ä“_b™m­s
(
aùiv™y
 * []);

835 
ä“_¡ruùu»s
(
aùiv™y
 * []);

837 
g‘_aùiv™y_Ä
(
aùiv™y
 * [], , );

839 
g‘_aùiv™y_pos™iÚ
(
aùiv™y
 * [], );

841 
g‘_devÇme
(, , );

843 
g‘_fe_time¡amp_¡ruù
(, 
tm
 *, 
fe_h—d”
 *);

845 
g‘_™v_v®ue
(
»cÜd_h—d”
 *, record_header *,

848 
hªdË_šv®id_§_fe
(*, 
fe_magic
 *, *, );

850 
Ãxt_¦iû
(, , , );

852 
·r£_§r_İt
(* [], *, 
aùiv™y
 * [], *, );

854 
·r£_§r_I_İt
(* [], *, 
aùiv™y
 * []);

856 
·r£_§_P_İt
(* [], *, *, 
aùiv™y
 * []);

858 
·r£_§r_m_İt
(* [], *, 
aùiv™y
 * []);

860 
·r£_§r_n_İt
(* [], *, 
aùiv™y
 * []);

862 
·r£_time¡amp
(* [], *, 
t¡amp
 *, const *);

864 
´št_»pÜt_hdr
(, 
tm
 *, 
fe_h—d”
 *, );

866 
»ad_fe_¡©_bunch
(
aùiv™y
 * [], , , , 
fe_aùiv™y
 *);

867 
__Ä_t


868 
»ad_vŞ_aù_¡ruùu»s
(, 
aùiv™y
 * [], *, 
fe_magic
 *,

871 
»®loÿ‹_vŞ_aù_¡ruùu»s
(
aùiv™y
 * [], , );

873 
§_ä—d
(, *, , );

875 
£Ëù_®l_aùiv™›s
(
aùiv™y
 * []);

877 
£Ëù_deçuÉ_aùiv™y
(
aùiv™y
 * []);

879 
£t_b™m­
([], , );

881 
£t_deçuÉ_fe
(*, , );

883 
£t_hdr_»ùime
(, 
tm
 *, 
fe_h—d”
 *);

	@../sysstat/statsDef.h

1 #iâdeà
__STATS_DEF__


2 
	#__STATS_DEF__


	)

4 
	~<¡dšt.h
>

5 
	~<¡ršg
>

7 
	sıuSts
 {

8 
	mu£r
;

9 
	mniû
;

10 
	msy¡em
;

11 
	midË
;

12 
	miowa™
;

13 
	m¡—l
;

14 
	mh¬dœq
;

15 
	msoáœq
;

16 
	mgue¡
;

19 
	sdiskSts
 {

20 
	m¡d
::
¡ršg
 
dev_Çme
;

21 
ušt64_t
 
	mio_tÙ®
;

22 
ušt64_t
 
	mio_wr™e
;

23 
ušt64_t
 
	mio_»ad
;

24 
ušt64_t
 
	mblk_wr™e
;

25 
ušt64_t
 
	mblk_»ad
;

27 
	miİs_wr™e
;

28 
	miİs_»ad
;

29 
	miİs_tÙ®
;

30 
	mblkps_wr™e
;

31 
	mblkps_»ad
;

34 
ušt64_t
 
	msize_wr™e
;

35 
ušt64_t
 
	msize_»ad
;

38 
ušt64_t
 
	m¥’t_time_»ad
;

39 
ušt64_t
 
	m¥’t_time_wr™e
;

40 
ušt64_t
 
	m¥’t_time_tÙ®
;

41 
ušt64_t
 
	m¥’t_time_rq
;

43 
	mawa™_time_³r_io
;

44 
	m£rve_time_³r_io
;

53 
	sÃtDevSts
 {

54 
	m¡d
::
¡ršg
 
š‹rçû
;

55 
ušt64_t
 
	mrx_·ck‘s
;

56 
ušt64_t
 
	mtx_·ck‘s
;

57 
ušt64_t
 
	mrx_by‹s
;

58 
ušt64_t
 
	mtx_by‹s
;

59 
ušt64_t
 
	mrx_com´es£d
;

60 
ušt64_t
 
	mtx_com´es£d
;

61 
ušt64_t
 
	mrx_”rs
;

62 
ušt64_t
 
	mtx_”rs
;

63 
ušt64_t
 
	mrx_drİ
;

64 
ušt64_t
 
	mtx_drİ
;

65 
ušt64_t
 
	mmuÉiÿ¡
;

66 
ušt64_t
 
	mcŞlisiÚs
;

67 
ušt64_t
 
	mrx_fifo_”rs
;

68 
ušt64_t
 
	mtx_fifo_”rs
;

69 
ušt64_t
 
	mrx_äame_”rs
;

70 
ušt64_t
 
	mtx_ÿ¼›r_”rs
;

73 
	smemšfoSts
 {

75 
ušt64_t
 
	mmemTÙ®
;

76 
ušt64_t
 
	mmemF»e
;

77 
ušt64_t
 
	mmemAva
;

78 
ušt64_t
 
	mbufãrs
;

79 
ušt64_t
 
	mÿched
;

80 
ušt64_t
 
	msw­Cached
;

81 
ušt64_t
 
	maùive
;

82 
ušt64_t
 
	mšaùive
;

83 
ušt64_t
 
	msw­TÙ®
;

84 
ušt64_t
 
	msw­F»e
;

85 
ušt64_t
 
	mdœty
;

86 
ušt64_t
 
	mcomm™‹dAS
;

90 
	sfesy¡emSts
 {

91 
	m¡d
::
¡ršg
 
Çme
;

92 
	m¡d
::
¡ršg
 
mouÁp
;

94 
ušt64_t
 
	mtÙ®C­ac™y
;

95 
ušt64_t
 
	mä“C­ac™y
;

96 
ušt64_t
 
	mavaC­ac™y
;

97 
ušt64_t
 
	mu£dC­ac™y
;

98 
ušt64_t
 
	mtÙ®FeNodes
;

99 
ušt64_t
 
	mä“FeNodes
;

101 
	mä“P”ûÁ
;

102 
	mavaP”ûÁ
;

103 
	mu£dP”ûÁ
;

106 
	sçnS³ed
 {

107 
ušt32_t
 
	m¥“d
;

110 
	s‹mp
 {

111 
ušt32_t
 
	m‹mp
;

	@../sysstat/sysStatsCollector.cpp

1 
	~"sysStsCŞËùÜ.h
"

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

5 
	~<¡ršg.h
>

7 
aùiv™y
 *
aù
[];

9 
	gCSysStsCŞËùÜ
::
	$CSysStsCŞËùÜ
()

10 : 
	`m_aù
(
NULL
)

11 , 
	$m_´evTimeCouÁ
(0llu)

13 ià(
aù
 =ğ
NULL
) {

14 
	`årštf
(
¡d”r
, "act is‡‚ull…ointer.\n");

16 
m_aù
 = 
aù
;

19 
m_´evTimeCouÁ
 = 
SYSUTILS_SPACE
::
	`G‘TimeCouÁMS
();

20 
¡d
::
veùÜ
<
ıuSts
> 
´evCpuSts
;

21 
¡d
::
veùÜ
<
diskSts
> 
´evDiskSts
;

22 
¡d
::
veùÜ
<
ÃtDevSts
> 
´ev¡©s
;

23 
	`G‘Cu¼’tCPUSts
(
´eCpuSts
);

24 
	}
}

26 
	gCSysStsCŞËùÜ
::~
	$CSysStsCŞËùÜ
()

28 ià(
m_aù
 !ğ
NULL
) {

29 
i
 = 0; i < 
NR_ACT
; i++) {

30 ià(
m_aù
[
i
] !ğ
NULL
) {

31 
	`F»eAùiv™yResourû
(
m_aù
[
i
]);

35 
	}
}

37 
	gCSysStsCŞËùÜ
::
	$In™ŸlAùiv™yResourû
(
aùiv™y
 *
a
)

39 ià(
a
->
f_couÁ
) {

40 
a
->
Ä
 = (*a->
f_couÁ
)(a);

43 ià(
a
->
Ä
 > 0) {

44 ià(
a
->
f_couÁ2
) {

45 
a
->
Ä2
 = (*a->
f_couÁ2
)(a);

48 ià(!
a
->
Ä2
) {

49 
a
->
Ä
 = 0;

53 ià(
a
->
Ä
 > 0) {

54 
	`SREALLOC
(
a
->
_buf0
, ,‡->
msize
 *‡->
Ä
 *‡->
Ä2
);

56 
	}
}

58 
	gCSysStsCŞËùÜ
::
	$F»eAùiv™yResourû
(
aùiv™y
 *
a
)

60 ià(
a
->
Ä
 > 0) {

61 ià(
a
->
_buf0
) {

62 
	`ä“
(
a
->
_buf0
);

63 
a
->
_buf0
 = 
NULL
;

66 
	}
}

68 
	gCSysStsCŞËùÜ
::
	$Re£tAùiv™yBufãr
(
aùiv™y
 *
a
)

70 ià(
a
->
Ä
 > 0 &&‡->
_buf0
) {

71 
	`mem£t
(
a
->
_buf0
, 0,‡->
msize
 *‡->
Ä
 *‡->
Ä2
);

73 
	}
}

75 
boŞ
 
	gCSysStsCŞËùÜ
::
	$G‘StsI‹mCouÁ
(
aù_no
, &
Ä
, &
Ä2
)

77 ià(
m_aù
 =ğ
NULL
)

78  
çl£
;

80 
aùiv™y
 *
a
 = 
NULL
;

81 
i
 = 0; i < 
NR_ACT
; i ++) {

82 ià(
m_aù
[
i
]->
id
 =ğ
aù_no
)

83 
a
 = 
m_aù
[
i
];

85 ià(
a
 =ğ
NULL
)

86  
çl£
;

88 ià(
a
->
f_couÁ
)

89 
Ä
 = (*
a
->
f_couÁ
)(a);

91 
Ä
 = 
a
->nr;

93 ià(
a
->
f_couÁ2
) {

94 
Ä2
 = (*
a
->
f_couÁ2
)(a);

95 ià(
Ä2
 == 0)

96 
Ä
 = 0;

98 
Ä2
 = 
a
->nr2;

101  
Œue
;

102 
	}
}

104 
boŞ
 
	gCSysStsCŞËùÜ
::
	$G‘Sts
(
aù_no
, * 
»suÉ
)

106 ià(
m_aù
 =ğ
NULL
)

107  
çl£
;

109 
aùiv™y
 *
a
 = 
NULL
;

110 
i
 = 0; i < 
NR_ACT
; i ++) {

111 ià(
m_aù
[
i
]->
id
 =ğ
aù_no
)

112 
a
 = 
m_aù
[
i
];

114 ià(
a
 =ğ
NULL
)

115  
çl£
;

117 
	`In™ŸlAùiv™yResourû
(
a
);

119 (*
a
->
f_»ad
)(a);

120 
	`memıy
(
»suÉ
, 
a
->
_buf0
,‡->
msize
 *‡->
Ä
 *‡->
Ä2
);

122 
	`F»eAùiv™yResourû
(
a
);

124  
Œue
;

125 
	}
}

127 
boŞ
 
	gCSysStsCŞËùÜ
::
G‘Cu¼’tCPUSts
(
¡d
::
veùÜ
<
ıuSts
> &
s
)

129 
Ä
 = 0, 
	gÄ2
 = 0;

130 ià(!
G‘StsI‹mCouÁ
(
A_CPU
, 
Ä
, 
Ä2
))

131  
	gçl£
;

133 
¡©s_ıu
 
	g»suÉ
[
Ä
];

134 ià(!
G‘Sts
(
A_CPU
, (*)
»suÉ
)) {

135  
	gçl£
;

137 
	gi
 = 0; i < 
	gÄ
; i++) {

138 
ıuSts
 
	g¡©s
;

139 
	gıu_tÙ®
 = 0;

140 *
	g¡©s_¬¿y
 = (*)&
»suÉ
[
i
];

141 
	gj
 = 0; j < (
	g¡©s_ıu
) / (); j++) {

142 
	gıu_tÙ®
 +ğ
¡©s_¬¿y
[
j
];

145 
	g¡©s
.
	gu£r
 = 
»suÉ
[
i
].
ıu_u£r
 * 100.0à/ 
ıu_tÙ®
;

146 
	g¡©s
.
	gniû
 = 
»suÉ
[
i
].
ıu_niû
 * 100.0à/ 
ıu_tÙ®
;

147 
	g¡©s
.
	gsy¡em
 = 
»suÉ
[
i
].
ıu_sys
 * 100.0à/ 
ıu_tÙ®
;

148 
	g¡©s
.
	gidË
 = 
»suÉ
[
i
].
ıu_idË
 * 100.0f/ 
ıu_tÙ®
;

149 
	g¡©s
.
	giowa™
 = 
»suÉ
[
i
].
ıu_iowa™
 * 100.0à/ 
ıu_tÙ®
;

150 
	g¡©s
.
	g¡—l
 = 
»suÉ
[
i
].
ıu_¡—l
 * 100.0à/ 
ıu_tÙ®
;

151 
	g¡©s
.
	gh¬dœq
 = 
»suÉ
[
i
].
ıu_h¬dœq
 * 100.0à/ 
ıu_tÙ®
;

152 
	g¡©s
.
	gsoáœq
 = 
»suÉ
[
i
].
ıu_soáœq
 * 100.0f/ 
ıu_tÙ®
;

153 
	g¡©s
.
	ggue¡
 = 
»suÉ
[
i
].
ıu_gue¡
 * 100.0à/ 
ıu_tÙ®
;

155 
	gs
.
push_back
(
¡©s
);

159  
	gŒue
;

162 
boŞ
 
	gCSysStsCŞËùÜ
::
G‘Cu¼’tDiskSts
(
¡d
::
veùÜ
<
diskSts
> &
s
)

186 
Ä_disk
 = 0, 
	gÄ2_disk
 = 0;

187 ià(!
G‘StsI‹mCouÁ
(
A_DISK
, 
Ä_disk
, 
Ä2_disk
))

188  
	gçl£
;

190 
¡©s_disk
 
	g»suÉ_disk
[
Ä_disk
];

191 
mem£t
(
»suÉ_disk
, 0, 
Ä_disk
 * (
¡©s_disk
));

192 ià(!
G‘Sts
(
A_DISK
, (*)
»suÉ_disk
)) {

193  
	gçl£
;

195 
	gi
 = 0; i < 
	gÄ_disk
; i ++) {

196 ià(
¡¾’
(
»suÉ_disk
[
i
].
dev_Çme
) != 0) {

197 
diskSts
 
disk
;

198 
	gdisk
.
	gio_tÙ®
 = 
»suÉ_disk
[
i
].
Ä_ios
;

199 
	gdisk
.
	gio_wr™e
 = 
»suÉ_disk
[
i
].
wr_ios
;

200 
	gdisk
.
	gio_»ad
 = 
»suÉ_disk
[
i
].
rd_ios
;

201 
	gdisk
.
	gblk_wr™e
 = 
»suÉ_disk
[
i
].
wr_£ù
;

202 
	gdisk
.
	gblk_»ad
 = 
»suÉ_disk
[
i
].
rd_£ù
;

203 
	gdisk
.
	g¥’t_time_»ad
 = 
»suÉ_disk
[
i
].
rd_ticks
;

204 
	gdisk
.
	g¥’t_time_wr™e
 = 
»suÉ_disk
[
i
].
wr_ticks
;

205 
	gdisk
.
	g¥’t_time_tÙ®
 = 
»suÉ_disk
[
i
].
tÙ_ticks
;

206 
	gdisk
.
	g¥’t_time_rq
 = 
»suÉ_disk
[
i
].
rq_ticks
;

207 
	gdisk
.
	gdev_Çme
 = 
»suÉ_disk
[
i
].
dev_Çme
;

208 
	gs
.
push_back
(
disk
);

214 
boŞ
 
	gCSysStsCŞËùÜ
::
G‘Cu¼’tN‘DevSts
(
¡d
::
veùÜ
<
ÃtDevSts
> &
s
)

216 
Ä
 = 0, 
	gÄ2
 = 0;

217 ià(!
G‘StsI‹mCouÁ
(
A_NET_DEV
, 
Ä
, 
Ä2
))

218  
	gçl£
;

220 
¡©s_Ãt_dev
 
	g»suÉ
[
Ä
];

221 
mem£t
(
»suÉ
, 0, (
¡©s_Ãt_dev
è* 
Ä
);

222 ià(!
G‘Sts
(
A_NET_DEV
, (*)
»suÉ
)) {

223  
	gçl£
;

240 
	gÄ_e
 = 0, 
	gÄ2_e
 = 0;

241 ià(!
G‘StsI‹mCouÁ
(
A_NET_EDEV
, 
Ä_e
, 
Ä2_e
))

242  
	gçl£
;

244 
¡©s_Ãt_edev
 
	g»suÉ_e
[
Ä_e
];

245 
mem£t
(
»suÉ_e
, 0, (
¡©s_Ãt_edev
è* 
Ä_e
);

246 ià(!
G‘Sts
(
A_NET_EDEV
, (*)
»suÉ_e
)) {

247  
	gçl£
;

265 
	gi
 = 0; i < 
	gÄ
; i ++) {

266 
ÃtDevSts
 
	g¡©s
;

268 
	g¡©s
.
	gš‹rçû
 = 
»suÉ
[
i
].
š‹rçû
;

269 
	g¡©s
.
	grx_·ck‘s
 = 
»suÉ
[
i
].
rx_·ck‘s
;

270 
	g¡©s
.
	gtx_·ck‘s
 = 
»suÉ
[
i
].
tx_·ck‘s
;

271 
	g¡©s
.
	grx_by‹s
 = 
»suÉ
[
i
].
rx_by‹s
;

272 
	g¡©s
.
	gtx_by‹s
 = 
»suÉ
[
i
].
tx_by‹s
;

273 
	g¡©s
.
	gtx_com´es£d
 = 
»suÉ
[
i
].
tx_com´es£d
;

274 
	g¡©s
.
	grx_com´es£d
 = 
»suÉ
[
i
].
tx_com´es£d
;

275 
	g¡©s
.
	gmuÉiÿ¡
 = 
»suÉ
[
i
].
muÉiÿ¡
;

277 
	gj
 = 0; j < 
	gÄ_e
 ; j++) {

278 ià(
	g¡©s
.
	gš‹rçû
 =ğ
»suÉ_e
[
j
].
š‹rçû
) {

279 
¡©s
.
rx_”rs
 = 
»suÉ_e
[
j
].
rx_”rÜs
;

280 
	g¡©s
.
	gtx_”rs
 = 
»suÉ_e
[
j
].
tx_”rÜs
;

281 
	g¡©s
.
	grx_drİ
 = 
»suÉ_e
[
j
].
rx_drİ³d
;

282 
	g¡©s
.
	gtx_drİ
 = 
»suÉ_e
[
j
].
tx_drİ³d
;

283 
	g¡©s
.
	grx_fifo_”rs
 = 
»suÉ_e
[
j
].
rx_fifo_”rÜs
;

284 
	g¡©s
.
	gtx_fifo_”rs
 = 
»suÉ_e
[
j
].
tx_fifo_”rÜs
;

286 
	g¡©s
.
	grx_äame_”rs
 = 
»suÉ_e
[
j
].
rx_äame_”rÜs
;

287 
	g¡©s
.
	gtx_ÿ¼›r_”rs
 = 
»suÉ_e
[
j
].
tx_ÿ¼›r_”rÜs
;

288 
	g¡©s
.
	gcŞlisiÚs
 = 
»suÉ_e
[
j
].
cŞlisiÚs
;

293 
	gs
.
push_back
(
¡©s
);

297  
	gŒue
;

300 
boŞ
 
	gCSysStsCŞËùÜ
::
G‘Cu¼’tMemInfoSts
(
¡d
::
veùÜ
<
memšfoSts
> &
s
)

302 
Ä
 = 0, 
	gÄ2
 = 0;

303 ià(!
G‘StsI‹mCouÁ
(
A_MEMORY
, 
Ä
, 
Ä2
))

304  
	gçl£
;

306 
¡©s_memÜy
 
	g»suÉ
[
Ä
];

307 
mem£t
(
»suÉ
, 0, (
¡©s_memÜy
è* 
Ä
);

308 ià(!
G‘Sts
(
A_MEMORY
, (*)
»suÉ
)) {

309  
	gçl£
;

320 
	gi
 = 0; i < 
	gÄ
; i++) {

321 
memšfoSts
 
	g¡©
;

322 
	g¡©
.
	gmemTÙ®
 = 
»suÉ
[
i
].
mkb
;

323 
	g¡©
.
	gmemF»e
 = 
»suÉ
[
i
].
ämkb
;

324 
	g¡©
.
	gmemAva
 = 
»suÉ
[
i
].
avamkb
;

325 
	g¡©
.
	gbufãrs
 = 
»suÉ
[
i
].
bufkb
;

326 
	g¡©
.
	gÿched
 = 
»suÉ
[
i
].
ÿmkb
;

327 
	g¡©
.
	gsw­Cached
 = 
»suÉ
[
i
].
ÿskb
;

328 
	g¡©
.
	gaùive
 = 
»suÉ
[
i
].
aùivekb
;

329 
	g¡©
.
	gšaùive
 = 
»suÉ
[
i
].
šaùkb
;

330 
	g¡©
.
	gsw­TÙ®
 = 
»suÉ
[
i
].
skb
;

331 
	g¡©
.
	gsw­F»e
 = 
»suÉ
[
i
].
äskb
;

332 
	g¡©
.
	gdœty
 = 
»suÉ
[
i
].
dœtykb
;

333 
	g¡©
.
	gcomm™‹dAS
 = 
»suÉ
[
i
].
comkb
;

335 
	gs
.
push_back
(
¡©
);

339  
	gŒue
;

342 
boŞ
 
	gCSysStsCŞËùÜ
::
G‘Cu¼’tFesy¡emSts
(
¡d
::
veùÜ
<
fesy¡emSts
> &
s
)

344 
Ä
 = 0, 
	gÄ2
 = 0;

345 ià(!
G‘StsI‹mCouÁ
(
A_FILESYSTEM
, 
Ä
, 
Ä2
))

346  
	gçl£
;

348 
¡©s_fesy¡em
 
	g»suÉ
[
Ä
];

349 
mem£t
(
»suÉ
, 0, (
¡©s_fesy¡em
è* 
Ä
);

350 ià(!
G‘Sts
(
A_FILESYSTEM
, (*)
»suÉ
)) {

351  
	gçl£
;

354 
	gi
 = 0; i < 
	gÄ
; i++) {

364 ià(
¡¾’
(
»suÉ
[
i
].
fs_Çme
) != 0) {

365 
fesy¡emSts
 
¡©
;

366 
	g¡©
.
	gÇme
 = 
»suÉ
[
i
].
fs_Çme
;

367 
	g¡©
.
	gmouÁp
 = 
»suÉ
[
i
].
mouÁp
;

368 
	g¡©
.
	gtÙ®C­ac™y
 = 
»suÉ
[
i
].
f_blocks
 / 1024;

369 
	g¡©
.
	gä“C­ac™y
 = 
»suÉ
[
i
].
f_bä“
 / 1024;

370 
	g¡©
.
	gavaC­ac™y
 = 
»suÉ
[
i
].
f_bava
 / 1024;

371 
	g¡©
.
	gu£dC­ac™y
 = 
¡©
.
tÙ®C­ac™y
 - st.
avaC­ac™y
;

372 
	g¡©
.
	gtÙ®FeNodes
 = 
»suÉ
[
i
].
f_fes
;

373 
	g¡©
.
	gä“FeNodes
 = 
»suÉ
[
i
].
f_fä“
;

374 
	g¡©
.
	gä“P”ûÁ
 = 
¡©
.
ä“C­ac™y
 * 100.0 / st.
tÙ®C­ac™y
;

375 
	g¡©
.
	gavaP”ûÁ
 = 
¡©
.
avaC­ac™y
 * 100.0 / st.
tÙ®C­ac™y
;

376 
	g¡©
.
	gu£dP”ûÁ
 = 100.0 - 
¡©
.
avaP”ûÁ
;

377 
	gs
.
push_back
(
¡©
);

383  
	gŒue
;

386 
	gCSysStsCŞËùÜ
::
G‘Cu¼’tFª¥“d
(
¡d
::
veùÜ
<
çnS³ed
> &
s
)

390 
CSysStsCŞËùÜ
::
G‘Cu¼’tTem³¿tu»
(
¡d
::
veùÜ
<
‹mp
> &
s
)

394 
CSysStsCŞËùÜ
::
	$SysStsSšgËTim”C®lback
(*
¬g1
, *
¬g2
)

396 
	`´štf
("%s\n",
__func__
);

398 ià(
¬g1
 =ğ
NULL
) {

399 
	`´štf
("%s:‡rg1 i NULL\n",
__func__
);

403 
CSysStsCŞËùÜ
* 
cŞËùÜ
 = (CSysStsCŞËùÜ*)
¬g1
;

405 
¡d
::
veùÜ
<
ıuSts
> 
cu¼CpuSts
;

406 
cŞËùÜ
->
	`G‘Cu¼’tCPUSts
(
cu¼CpuSts
);

409 
	}
}

411 
boŞ
 
	gCSysStsCŞËùÜ
::
	$S¹Tim”
(
ušt32_t
 
š‹rv®_ms
)

413 
SYSUTILS_SPACE
::
SšgËTim”C®lback
 
cb
 = &
SysStsSšgËTim”C®lback
;

414  
m_tim”
.
	`S¹
(
cb
, (*)
this
, 
NULL
, 
š‹rv®_ms
, 0);

415 
	}
}

417 
boŞ
 
	gCSysStsCŞËùÜ
::
	$StİTim”
()

419  
m_tim”
.
	`Stİ
();

420 
	}
}

	@../sysstat/sysStatsCollector.h

1 #iâdeà
__SYSSTATS_COLLECTOR__


2 
	#__SYSSTATS_COLLECTOR__


	)

4 
	~"¡©sDef.h
"

6 
	~<veùÜ
>

8 
	~"nusys¡©/§.h
"

9 
	~"th»ad_objeù/sšgË_tim”.h
"

10 
	~"commÚ/sy¡em.h
"

12 şas 
	cCSysStsCŞËùÜ
 {

13 
	m´iv©e
:

14 
aùiv™y
 **
m_aù
;

15 
	mSYSUTILS_SPACE
::
SšgËTim”
 
m_tim”
;

17 
št64_t
 
	mm_´evTimeCouÁ
;

19 
¡©s_disk
 *
	mm_´evDiskSts
;

20 
¡©s_Ãt_dev
 *
	mm_´evN‘DevSts
;

21 
¡©s_Ãt_edev
 *
	mm_´evN‘EdevSts
;

22 
¡©s_disk
 *
	mm_cu¼DiskSts
;

23 
¡©s_Ãt_edev
 *
	mm_cu¼N‘EdevSts
;

24 
¡©s_Ãt_dev
 *
	mm_cu¼N‘DevSts
;

26 
	m¡d
::
veùÜ
<
diskSts
> 
m_´evAvgDiskSts
;

27 
	m¡d
::
veùÜ
<
ÃtDevSts
> 
m_´evAvgN‘DevSts
;

29 
	m´iv©e
:

30 
In™ŸlAùiv™yResourû
(
aùiv™y
 *
a
);

31 
F»eAùiv™yResourû
(
aùiv™y
 *
a
);

32 
Re£tAùiv™yBufãr
(
aùiv™y
 *
a
);

33 
boŞ
 
G‘Sts
(
aù_no
, * 
»suÉ
);

34 
boŞ
 
G‘StsI‹mCouÁ
(
aù_no
, &
Ä
, &
Ä2
);

36 
	mpublic
:

37 
CSysStsCŞËùÜ
();

38 
	mvœtu®
 ~
CSysStsCŞËùÜ
();

40 
boŞ
 
G‘Cu¼’tCPUSts
(
¡d
::
veùÜ
<
ıuSts
> &
s
);

41 
boŞ
 
G‘Cu¼’tDiskSts
(
¡d
::
veùÜ
<
diskSts
> &
s
);

42 
boŞ
 
G‘Cu¼’tN‘DevSts
(
¡d
::
veùÜ
<
ÃtDevSts
> &
s
);

43 
boŞ
 
G‘Cu¼’tMemInfoSts
(
¡d
::
veùÜ
<
memšfoSts
> &
s
);

44 
boŞ
 
G‘Cu¼’tFesy¡emSts
(
¡d
::
veùÜ
<
fesy¡emSts
> &
s
);

45 
G‘Cu¼’tFª¥“d
(
¡d
::
veùÜ
<
çnS³ed
> &
s
);

46 
G‘Cu¼’tTem³¿tu»
(
¡d
::
veùÜ
<
‹mp
> &
s
);

49 
SysStsSšgËTim”C®lback
(*
¬g1
, *
¬g2
);

50 
boŞ
 
G‘SysStsFÜTim”C®lback
();

51 
C®cuÏ‹AvgStsInP»vIÁ”v®
();

52 
boŞ
 
S¹Tim”
(
ušt32_t
 
š‹rv®_ms
);

53 
boŞ
 
StİTim”
();

	@../sysstat/unitest/test.cpp

1 
	~"sysStsCŞËùÜ.h
"

3 
	~<¡dio.h
>

7 
»cÜd_h—d”
 
	g»cÜd_hdr
[3];

9 
	$maš
(
¬gc
, *
¬gv
[])

11 
CSysStsCŞËùÜ
 
cŞËùÜ
;

12 
¡d
::
veùÜ
<
ıuSts
> 
ıu
;

13 
cŞËùÜ
.
	`S¹Tim”
(5000);

15 
cŞËùÜ
.
	`G‘Cu¼’tCPUSts
(
ıu
);

16 
size_t
 
i
 = 0; i < 
ıu
.
	`size
(); i ++) {

17 
	`´štf
 ("%.3f%% us, %.3f%%‚i, %.3f%% sy, %.3f%% id,"

20 
ıu
[
i
].
u£r
, cpu[i].
niû
, cpu[i].
sy¡em
,

21 
ıu
[
i
].
idË
, cpu[i].
iowa™
, cpu[i].
¡—l
,

22 
ıu
[
i
].
h¬dœq
, cpu[i].
soáœq
, cpu[i].
gue¡
);

26 
¡d
::
veùÜ
<
diskSts
> 
disk
;

27 
cŞËùÜ
.
	`G‘Cu¼’tDiskSts
(
disk
);

29 
size_t
 
i
 = 0; i < 
disk
.
	`size
(); i++) {

30 
	`´štf
("%s: %llu, %llu, %llu\n",

31 
disk
[
i
].
dev_Çme
.
	`c_¡r
(),

32 
disk
[
i
].
io_wr™e
,

33 
disk
[
i
].
io_»ad
,

34 
disk
[
i
].
io_tÙ®
);

37 
¡d
::
veùÜ
<
ÃtDevSts
> 
ÃtDev
;

38 
cŞËùÜ
.
	`G‘Cu¼’tN‘DevSts
(
ÃtDev
);

39 
size_t
 
i
 = 0; i < 
ÃtDev
.
	`size
(); i++) {

40 
	`´štf
("%s: %llu, %llu, %llu, %llu\n",

41 
ÃtDev
[
i
].
š‹rçû
.
	`c_¡r
(),

42 
ÃtDev
[
i
].
rx_·ck‘s
,

43 
ÃtDev
[
i
].
rx_by‹s
,

44 
ÃtDev
[
i
].
rx_com´es£d
,

45 
ÃtDev
[
i
].
rx_”rs


50 
¡d
::
veùÜ
<
memšfoSts
> 
memšfo
;

51 
cŞËùÜ
.
	`G‘Cu¼’tMemInfoSts
(
memšfo
);

52 
	`´štf
("Total Memory %llu\nFree Memory %llu\nAvailable Memory %llu\n"

56 
memšfo
[0].
memTÙ®
,

57 
memšfo
[0].
memF»e
,

58 
memšfo
[0].
memAva
,

59 
memšfo
[0].
bufãrs
,

60 
memšfo
[0].
ÿched
,

61 
memšfo
[0].
sw­Cached
,

62 
memšfo
[0].
aùive
,

63 
memšfo
[0].
šaùive
,

64 
memšfo
[0].
sw­TÙ®
,

65 
memšfo
[0].
sw­F»e
,

66 
memšfo
[0].
dœty
,

67 
memšfo
[0].
comm™‹dAS


70 
¡d
::
veùÜ
<
fesy¡emSts
> 
fs
;

71 
cŞËùÜ
.
	`G‘Cu¼’tFesy¡emSts
(
fs
);

72 
size_t
 
i
 = 0; i < 
fs
.
	`size
(); i++) {

73 
	`´štf
("%s, %s :\n"

81 
fs
[
i
].
Çme
.
	`c_¡r
(),

82 
fs
[
i
].
mouÁp
.
	`c_¡r
(),

83 
fs
[
i
].
tÙ®C­ac™y
,

84 
fs
[
i
].
ä“C­ac™y
,

85 
fs
[
i
].
avaC­ac™y
,

86 
fs
[
i
].
u£dC­ac™y
,

87 
fs
[
i
].
ä“P”ûÁ
,

88 
fs
[
i
].
avaP”ûÁ
,

89 
fs
[
i
].
u£dP”ûÁ


96 
	}
}

	@../thread_object/aggregate_timer.cpp

1 
	~"agg»g©e_tim”.h
"

3 
	~<as£¹.h
>

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
	gs_deçuÉ_tim”_ms
 = 10000;

9 
	gAgg»g©eTim”
::
Tim”P¬am‘”
::
	$Tim”P¬am‘”
()

10 : 
	`m_cb
(
NULL
)

11 , 
	`m_id
(0)

12 , 
	`m_¬g1
(
NULL
)

13 , 
	`m_¬g2
(
NULL
)

14 , 
	$m_³rsi¡
(
çl£
)

16 
	}
}

18 
	gAgg»g©eTim”
::
Tim”P¬am‘”
::~
	$Tim”P¬am‘”
()

20 
	}
}

22 
Agg»g©eTim”
::
Tim”P¬am‘”
::
	$Tim”P¬am‘”
(cÚ¡ 
Tim”P¬am‘”
 &
rhs
)

23 : 
	`m_cb
(
rhs
.
m_cb
)

24 , 
	`m_id
(
rhs
.
m_id
)

25 , 
	`m_¬g1
(
rhs
.
m_¬g1
)

26 , 
	`m_¬g2
(
rhs
.
m_¬g2
)

27 , 
	$m_³rsi¡
(
rhs
.
m_³rsi¡
)

29 
	}
}

31 
	gAgg»g©eTim”
::
Tim”P¬am‘”
 &
Agg»g©eTim”
::Tim”P¬am‘”::
İ”©Ü
=(cÚ¡ Tim”P¬am‘” &
rhs
)

33 ià(&
rhs
 !ğ
this
)

35 
m_cb
 = 
rhs
.m_cb;

36 
	gm_id
 = 
rhs
.
m_id
;

37 
	gm_¬g1
 = 
rhs
.
m_¬g1
;

38 
	gm_¬g2
 = 
rhs
.
m_¬g2
;

39 
	gm_³rsi¡
 = 
rhs
.
m_³rsi¡
;

42  *
	gthis
;

45 
DLL_PUBLIC
 
	gAgg»g©eTim”
::
	$Agg»g©eTim”
()

46 : 
	`m_ev’t_loİ
(
s_deçuÉ_tim”_ms
)

47 , 
	`m_cs
()

48 , 
	$m_tim”s
()

50 
m_ev’t_loİ
.
	`S¹Loİ
();

51 
	}
}

53 
DLL_PUBLIC
 
	gAgg»g©eTim”
::~
	$Agg»g©eTim”
()

55 
m_ev’t_loİ
.
	`StİLoİ
();

57 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

59 
¡d
::
m­
<
ušt32_t
, 
Tim”P¬am‘”
 *>::
™”©Ü
 
™
 = 
m_tim”s
.
	`begš
(); iˆ!ğm_tim”s.
	`’d
(); it++)

61 ((
Ev’tTim”
 *)(
™
->
fœ¡
))->
	`D–
();

62 
	`d–‘e
 ((
Ev’tTim”
 *)(
™
->
fœ¡
));

63 
	`d–‘e
 ((
Tim”P¬am‘”
 *)(
™
->
£cÚd
));

65 
m_tim”s
.
	`ş—r
();

66 
	}
}

68 
DLL_PUBLIC
 
ušt32_t
 
	gAgg»g©eTim”
::
	$C»©eTim”
(
ušt32_t
 
ms
, 
Agg»g©eTim”C®lback
 
cb
, *
¬g1
, *
¬g2
, 
boŞ
 
³rsi¡
 )

70 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

72 
Tim”P¬am‘”
 *
·¿m
 = 
Ãw
 TimerParameter;

73 
Ev’tTim”
 *
tim”
 = 
Ãw
 
	`Ev’tTim”
(
m_ev’t_loİ
.
	`ba£
(), 
³rsi¡
, 
Agg»g©eTim”
::
s_Tim”C®lback
, 
this
, 
·¿m
);

75 ià(
·¿m
 !ğ
NULL
 && 
tim”
 != NULL)

77 
¡d
::
m­
<
ušt32_t
, 
Tim”P¬am‘”
 *>::
™”©Ü
 
™
 = 
m_tim”s
.
	`fšd
((ušt32_t)
tim”
);

78 ià(
™
 !ğ
m_tim”s
.
	`’d
())

80 
	`as£¹
(0);

81 
	`RemoveTim”
((
ušt32_t
)
tim”
);

83 
·¿m
->
m_cb
 = 
cb
;

84 
·¿m
->
m_id
 = (
ušt32_t
)
tim”
;

85 
·¿m
->
m_¬g1
 = 
¬g1
;

86 
·¿m
->
m_¬g2
 = 
¬g2
;

87 
·¿m
->
m_³rsi¡
 = 
³rsi¡
;

88 
tim”
->
	`Add
(
ms
);

89 
m_tim”s
[(
ušt32_t
)
tim”
] = 
·¿m
;

90  (
ušt32_t
)
tim”
;

94 
d–‘e
 
·¿m
;

95 
d–‘e
 
tim”
;

96  (
ušt32_t
)
NULL
;

98 
	}
}

100 
DLL_PUBLIC
 
boŞ
 
	gAgg»g©eTim”
::
	$RemoveTim”
(
ušt32_t
 
id
)

102 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

104 
¡d
::
m­
<
ušt32_t
, 
Tim”P¬am‘”
 *>::
™”©Ü
 
™
 = 
m_tim”s
.
	`fšd
(
id
);

106 ià(
™
 =ğ
m_tim”s
.
	`’d
())

108  
çl£
;

112 ((
Ev’tTim”
 *)(
™
->
fœ¡
))->
	`D–
();

113 
	`d–‘e
 ((
Ev’tTim”
 *)(
™
->
fœ¡
));

114 
	`d–‘e
 ((
Tim”P¬am‘”
 *)(
™
->
£cÚd
));

115 
m_tim”s
.
	`”a£
(
™
);

116  
Œue
;

118 
	}
}

120 
DLL_PUBLIC
 
	gAgg»g©eTim”
::
	$s_Tim”C®lback
(
Ev’tTim”
 *
e
, *
¬g1
, *
¬g2
)

122 
Agg»g©eTim”
 *
pThis
 = (Agg»g©eTim” *)
¬g1
;

123 ià(
pThis
 !ğ
NULL
)

125 
pThis
->
	`Tim”C®lback
((
Tim”P¬am‘”
 *)
¬g2
);

127 
	}
}

129 
DLL_PUBLIC
 
	gAgg»g©eTim”
::
	$Tim”C®lback
(
Tim”P¬am‘”
 *
·¿m
)

131 ià(
·¿m
 !ğ
NULL
 &&…¬am->
m_cb
 != NULL)

133 
·¿m
->
	`m_cb
Õ¬am->
m_id
,…¬am->
m_¬g1
,…¬am->
m_¬g2
);

135 ià(
·¿m
 !ğ
NULL
 && !·¿m->
m_³rsi¡
)

137 
	`RemoveTim”
(
·¿m
->
m_id
);

139 
	}
}

	@../thread_object/aggregate_timer.h

1 #iâdeà
__THREAD_OBJECT_AGGREGATE_TIMER_H__


2 
	#__THREAD_OBJECT_AGGREGATE_TIMER_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

9 
	~"libev’t/ev’t_ba£.h
"

10 
	~"libev’t/ev’t_loİ.h
"

11 
	~"libev’t/ev’t_tim”.h
"

13 
	~<m­
>

15 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

17 #ià
defšed
 (
_WIN32
)

18 #´agm¨
w¬nšg
(
di§bË
:4251)

21 (*
	gAgg»g©eTim”C®lback
)(
	tušt32_t
 
	tid
, *
	t¬g1
, *
	t¬g2
);

23 şas 
	cDLL_PUBLIC
 
	gAgg»g©eTim”


25 
	g´iv©e
:

26 
	sTim”P¬am‘”


28 
Agg»g©eTim”C®lback
 
m_cb
;

29 
ušt32_t
 
	gm_id
;

30 *
	gm_¬g1
;

31 *
	gm_¬g2
;

32 
boŞ
 
	gm_³rsi¡
;

34 
Tim”P¬am‘”
();

35 ~
Tim”P¬am‘”
();

37 
Tim”P¬am‘”
(cÚ¡ Tim”P¬am‘” &
rhs
);

38 
	gTim”P¬am‘”
 &
	gİ”©Ü
=(cÚ¡ 
Tim”P¬am‘”
 &
rhs
);

41 
	gpublic
:

42 
Agg»g©eTim”
();

43 ~
Agg»g©eTim”
();

54 
ušt32_t
 
C»©eTim”
(ušt32_ˆ
ms
, 
Agg»g©eTim”C®lback
 
cb
, *
¬g1
, *
¬g2
, 
boŞ
 
³rsi¡
=
Œue
);

61 
boŞ
 
RemoveTim”
(
ušt32_t
 
id
);

63 
	g´iv©e
:

64 
Agg»g©eTim”
(cÚ¡ Agg»g©eTim” &
rhs
);

65 
	gAgg»g©eTim”
 &
	gİ”©Ü
=(cÚ¡ 
Agg»g©eTim”
 &
rhs
);

67 
s_Tim”C®lback
(
Ev’tTim”
 *
e
, *
¬g1
, *
¬g2
);

68 
Tim”C®lback
(
Tim”P¬am‘”
 *
·¿m
);

70 
	g´iv©e
:

71 
SYSUTILS_SPACE
::
Ev’tLoİ
 
m_ev’t_loİ
;

72 
	gSYSUTILS_SPACE
::
Cr™iÿlSeùiÚ
 
m_cs
;

73 
	g¡d
::
m­
<
ušt32_t
, 
	gTim”P¬am‘”
 *> 
	gm_tim”s
;

	@../thread_object/async_observer.cpp

1 
	~"async_ob£rv”.h
"

3 
	~<as£¹.h
>

5 
	~"commÚ/sy¡em.h
"

6 
	~"commÚ/ut™y.h
"

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 
DLL_PUBLIC
 
	gAsyncOb£rv”NÙifyP¬am‘”
::
	$AsyncOb£rv”NÙifyP¬am‘”
()

12 
	}
}

14 
DLL_PUBLIC
 
AsyncOb£rv”NÙifyP¬am‘”
::~
	$AsyncOb£rv”NÙifyP¬am‘”
()

16 
	}
}

18 
DLL_PUBLIC
 
AsyncOb£rv”
::
	$AsyncOb£rv”
()

20 
	}
}

22 
DLL_PUBLIC
 
AsyncOb£rv”
::~
	$AsyncOb£rv”
()

24 
	}
}

26 
AsyncSubjeù
::
F‹r
::
	$F‹r
()

27 : 
	`ob£rv”
(
NULL
)

28 , 
	$f‹r
(0xFFFFFFFF)

30 
	}
}

32 
	gAsyncSubjeù
::
F‹r
::
	$F‹r
(
AsyncOb£rv”
 *
o
, 
ušt32_t
 
f
)

33 : 
	`ob£rv”
(
o
)

34 , 
	$f‹r
(
f
)

36 
	}
}

38 
	gAsyncSubjeù
::
F‹r
::
	$F‹r
(cÚ¡ 
AsyncSubjeù
::
F‹r
 &
rhs
)

39 : 
	`ob£rv”
(
rhs
.
ob£rv”
)

40 , 
	$f‹r
(
rhs
.
f‹r
)

42 
	}
}

44 
	gAsyncSubjeù
::
F‹r
 &
AsyncSubjeù
::F‹r::
İ”©Ü
=(cÚ¡ AsyncSubjeù::F‹¸&
rhs
)

46 ià(
this
 !ğ&
rhs
)

48 
ob£rv”
 = 
rhs
.observer;

49 
	gf‹r
 = 
rhs
.
f‹r
;

51  *
	gthis
;

54 
	gAsyncSubjeù
::
P¬am‘”
::
	$P¬am‘”
()

55 : 
	`nÙify
(
	`UINT32_C
(0))

56 , 
	`·¿m
(
NULL
)

57 , 
	`f‹r
(
	$UINT32_C
(0))

59 
	}
}

61 
	gAsyncSubjeù
::
P¬am‘”
::P¬am‘”(
ušt32_t
 
nÙify
, cÚ¡ 
sm¬t_±r
<
AsyncOb£rv”NÙifyP¬am‘”
> &
·¿m
, ušt32_ˆ
f‹r
)

62 : 
nÙify
(notify)

63 , 
·¿m
(param)

64 , 
	$f‹r
(
f‹r
)

66 
	}
}

68 
	gAsyncSubjeù
::
P¬am‘”
::
	$P¬am‘”
(cÚ¡ 
P¬am‘”
 &
rhs
)

69 : 
	`nÙify
(
rhs
.
nÙify
)

70 , 
	`·¿m
(
rhs
.
·¿m
)

71 , 
	$f‹r
(
rhs
.
f‹r
)

73 
	}
}

75 
	gAsyncSubjeù
::
P¬am‘”
 &
AsyncSubjeù
::P¬am‘”::
İ”©Ü
=(cÚ¡ AsyncSubjeù::P¬am‘” &
rhs
)

77 ià(
this
 !ğ&
rhs
)

79 
nÙify
 = 
rhs
.notify;

80 
	g·¿m
 = 
rhs
.
·¿m
;

81 
	gf‹r
 = 
rhs
.
f‹r
;

83  *
	gthis
;

86 
	gAsyncSubjeù
::
SubjeùTh»ad
::
	$SubjeùTh»ad
()

87 : 
	`m_subjeù
(
NULL
)

88 , 
	$m_cÚd™iÚ_qu™
(
Œue
)

90 
	}
}

92 
	gAsyncSubjeù
::
SubjeùTh»ad
::~
	$SubjeùTh»ad
()

94 
	}
}

96 
AsyncSubjeù
::
SubjeùTh»ad
::
	$S‘Subjeù
(
AsyncSubjeù
 *
subjeù
)

98 
m_subjeù
 = 
subjeù
;

99 
	}
}

101 
	gAsyncSubjeù
::
SubjeùTh»ad
::
	$P»·»C»©e
()

103 
m_cÚd™iÚ_qu™
.
	`»£t
();

104 
	}
}

106 
	gAsyncSubjeù
::
SubjeùTh»ad
::
	$P»·»Clo£
()

108 
m_cÚd™iÚ_qu™
.
	`£t
();

109 
	}
}

111 
boŞ
 
	gAsyncSubjeù
::
SubjeùTh»ad
::
	$CÚtšue
()

113 
	`IF_NULL_RETURN_VALUE
(
m_subjeù
, 
çl£
);

114  !
m_cÚd™iÚ_qu™
.
	`timedwa™
(0);

115 
	}
}

117 
	gAsyncSubjeù
::
SubjeùTh»ad
::
	$WÜk
()

119 
	`IF_NULL_RETURN
(
m_subjeù
);

121 
boŞ
 
Ãed_nÙify
 = 
çl£
;

122 
P¬am‘”
 
·¿m‘”
;

124 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_subjeù
->
m_cs_·¿m‘”s
);

125 ià(!
m_subjeù
->
m_·¿m‘”s
.
	`em±y
())

127 
Ãed_nÙify
 = 
Œue
;

128 
·¿m‘”
 = 
m_subjeù
->
m_·¿m‘”s
.
	`äÚt
();

129 
m_subjeù
->
m_·¿m‘”s
.
	`pİ_äÚt
();

133 ià(!
Ãed_nÙify
)

135 
	`SË•MS
(100);

140 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_subjeù
->
m_cs_f‹rs
);

141 
¡d
::
li¡
<
F‹r
>::
™”©Ü
 
™
 = 
m_subjeù
->
m_f‹rs
.
	`begš
(); iˆ!ğm_subjeù->m_f‹rs.
	`’d
(); it++)

143 ià((*
™
).
ob£rv”
 !ğ
NULL
 && ((*™).
f‹r
 & 
·¿m‘”
.filter) != 0)

145 (*
™
).
ob£rv”
->
	`Upd©e
(
·¿m‘”
.
nÙify
,…¬am‘”.
·¿m
,…¬am‘”.
f‹r
);

149 
	}
}

151 
DLL_PUBLIC
 
	gAsyncSubjeù
::
	$AsyncSubjeù
()

152 : 
	`m_cs_f‹rs
()

153 , 
	`m_f‹rs
()

154 , 
	`m_cs_·¿m‘”s
()

155 , 
	`m_·¿m‘”s
()

156 , 
	$m_th»ad
()

158 
m_th»ad
.
	`S‘Subjeù
(
this
);

159 
m_th»ad
.
	`C»©eTh»ad
();

160 
	}
}

162 
DLL_PUBLIC
 
	gAsyncSubjeù
::~
	$AsyncSubjeù
()

164 
m_th»ad
.
	`Clo£Th»ad
();

166 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_f‹rs
);

167 
m_f‹rs
.
	`ş—r
();

170 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_·¿m‘”s
);

171 
m_·¿m‘”s
.
	`ş—r
();

173 
	}
}

175 
DLL_PUBLIC
 
boŞ
 
	gAsyncSubjeù
::
	$A‰achOb£rv”
(
AsyncOb£rv”
 *
ob£rv”
, 
ušt32_t
 
f‹r
 )

177 
	`IF_NULL_RETURN_VALUE
(
ob£rv”
, 
çl£
);

179 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_f‹rs
);

180 
F‹r
 
	`nÙifiÿtiÚ_f‹r
(
ob£rv”
, 
f‹r
);

181 
m_f‹rs
.
	`push_back
(
nÙifiÿtiÚ_f‹r
);

183  
Œue
;

184 
	}
}

186 
DLL_PUBLIC
 
boŞ
 
	gAsyncSubjeù
::
	$D‘achOb£rv”
(
AsyncOb£rv”
 *
ob£rv”
)

188 
	`IF_NULL_RETURN_VALUE
(
ob£rv”
, 
çl£
);

190 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_f‹rs
);

191 
¡d
::
li¡
<
F‹r
>::
™”©Ü
 
™
 = 
m_f‹rs
.
	`begš
();

192 
™
 !ğ
m_f‹rs
.
	`’d
())

194 ià((*
™
).
ob£rv”
 == observer)

196 
m_f‹rs
.
	`”a£
(
™
++);

200 
™
++;

204  
Œue
;

205 
	}
}

207 
DLL_PUBLIC
 
	gAsyncSubjeù
::
NÙifyOb£rv”
(
ušt32_t
 
nÙify
, 
sm¬t_±r
<
AsyncOb£rv”NÙifyP¬am‘”
> 
·¿m
, ušt32_ˆ
f‹r
 )

209 
Cr™iÿlSeùiÚLock
 
_l
(&
m_cs_·¿m‘”s
);

210 
P¬am‘”
 
·¿m‘”
(
nÙify
, 
·¿m
, 
f‹r
);

211 
	gm_·¿m‘”s
.
push_back
(
·¿m‘”
);

	@../thread_object/async_observer.h

1 #iâdeà
__THREAD_OBJECT_ASYNCHRONOUS_OBSERVER_H__


2 
	#__THREAD_OBJECT_ASYNCHRONOUS_OBSERVER_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

8 
	~"commÚ/sm¬t_poš‹r.h
"

9 
	~"­r/­r_th»ad_İ”©Ü.h
"

10 
	~"­r/­r_cÚd.h
"

12 
	~<li¡
>

14 #ià
defšed
(
_WIN32
)

16 #´agm¨
w¬nšg
(
di§bË
: 4251)

19 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

21 
DLL_PUBLIC
 
	gAsyncOb£rv”NÙifyP¬am‘”


23 
AsyncOb£rv”NÙifyP¬am‘”
();

24 
	gvœtu®
 ~
AsyncOb£rv”NÙifyP¬am‘”
();

27 şas 
	cDLL_PUBLIC
 
	gAsyncOb£rv”


29 
	gpublic
:

30 
AsyncOb£rv”
();

31 
	gvœtu®
 ~
AsyncOb£rv”
() = 0;

33 
vœtu®
 
Upd©e
(
ušt32_t
 
nÙify
, cÚ¡ 
sm¬t_±r
<
AsyncOb£rv”NÙifyP¬am‘”
> &
·¿m
, ušt32_ˆ
f‹r
) = 0;

35 
	g´iv©e
:

36 
AsyncOb£rv”
(cÚ¡ AsyncOb£rv” &
rhs
);

37 cÚ¡ 
	gAsyncOb£rv”
 &
	gİ”©Ü
=(cÚ¡ 
AsyncOb£rv”
 &
rhs
);

40 şas 
	cDLL_PUBLIC
 
	gAsyncSubjeù


42 
	gpublic
:

43 
AsyncSubjeù
();

44 
	gvœtu®
 ~
AsyncSubjeù
();

46 
boŞ
 
A‰achOb£rv”
(
AsyncOb£rv”
 *
ob£rv”
, 
ušt32_t
 
f‹r
=0xFFFFFFFF);

47 
boŞ
 
D‘achOb£rv”
(
AsyncOb£rv”
 *
ob£rv”
);

48 
NÙifyOb£rv”
(
ušt32_t
 
nÙify
, 
sm¬t_±r
<
AsyncOb£rv”NÙifyP¬am‘”
> 
·¿m
, ušt32_ˆ
f‹r
=0xFFFFFFFF);

50 
	g´iv©e
:

51 
AsyncSubjeù
(cÚ¡ AsyncSubjeù &
rhs
);

52 cÚ¡ 
	gAsyncSubjeù
 &
	gİ”©Ü
=(cÚ¡ 
AsyncSubjeù
 &
rhs
);

54 
	g´iv©e
:

55 
	sF‹r


57 
AsyncOb£rv”
 *
ob£rv”
;

58 
ušt32_t
 
	gf‹r
;

60 
F‹r
();

61 
F‹r
(
AsyncOb£rv”
 *
o
, 
ušt32_t
 
f
);

62 
F‹r
(cÚ¡ F‹¸&
rhs
);

63 
	gF‹r
 &
	gİ”©Ü
=(cÚ¡ 
F‹r
 &
rhs
);

66 
	sP¬am‘”


68 
ušt32_t
 
	gnÙify
;

69 
	gsm¬t_±r
<
	gAsyncOb£rv”NÙifyP¬am‘”
> 
	g·¿m
;

70 
ušt32_t
 
	gf‹r
;

72 
P¬am‘”
();

73 
P¬am‘”
(
ušt32_t
 
nÙify
, cÚ¡ 
sm¬t_±r
<
AsyncOb£rv”NÙifyP¬am‘”
> &
·¿m
, ušt32_ˆ
f‹r
);

74 
P¬am‘”
(cÚ¡ P¬am‘” &
rhs
);

75 
	gP¬am‘”
 &
	gİ”©Ü
=(cÚ¡ 
P¬am‘”
 &
rhs
);

78 şas 
	cSubjeùTh»ad
: 
public
 
A´Th»adO³¿tÜ


80 
public
:

81 
SubjeùTh»ad
();

82 
	gvœtu®
 ~
SubjeùTh»ad
();

83 
S‘Subjeù
(
AsyncSubjeù
 *
subjeù
);

84 
	g´Ùeùed
:

85 
vœtu®
 
P»·»C»©e
();

86 
vœtu®
 
P»·»Clo£
();

87 
vœtu®
 
boŞ
 
CÚtšue
();

88 
vœtu®
 
WÜk
();

89 
	g´iv©e
:

90 
AsyncSubjeù
 *
m_subjeù
;

91 
A´CÚd
 
	gm_cÚd™iÚ_qu™
;

93 
ä›nd
 
şass
 
	gSubjeùTh»ad
;

95 
	g´iv©e
:

96 
Cr™iÿlSeùiÚ
 
m_cs_f‹rs
;

97 
	g¡d
::
li¡
<
F‹r
> 
m_f‹rs
;

98 
Cr™iÿlSeùiÚ
 
	gm_cs_·¿m‘”s
;

99 
	g¡d
::
li¡
<
P¬am‘”
> 
m_·¿m‘”s
;

100 
SubjeùTh»ad
 
	gm_th»ad
;

	@../thread_object/directory_monitor.cpp

1 
	~"dœeùÜy_mÚ™Ü.h
"

3 
	~"commÚ/fe.h
"

4 
	~"commÚ/dœeùÜy_Œav”£.h
"

5 
	~"commÚ/sy¡em.h
"

6 
	~<as£¹.h
>

8 #ià
defšed
(
_WIN32
)

13 #–ià
defšed
(
__lšux__
)

20 
	~<uni¡d.h
>

21 
	~<sys/šÙify.h
>

22 
	~<sys/time.h
>

23 
	~<sys/ty³s.h
>

24 
	~<sys/´ùl.h
>

26 
	#EVENT_SIZE
 ( (
šÙify_ev’t
))

	)

28 
	#BUF_LEN
 (1024 * (
EVENT_SIZE
 + 16))

	)

30 cÚ¡ 
ušt32_t
 
	gs_w©ch_æags
 = 
IN_CREATE
 | 
IN_DELETE
 | 
IN_MODIFY
;

36 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

38 
DLL_PUBLIC
 
	gDœeùÜyMÚ™Ü
::
I‹m
::
	$I‹m
()

39 : 
	`ty³
(
DœeùÜyMÚ™Ü
::
I‹m
::
eUNKNOWN
)

40 , 
	$·thÇme
()

42 
	}
}

44 
DLL_PUBLIC
 
	gDœeùÜyMÚ™Ü
::
I‹m
::~
	$I‹m
()

46 
	}
}

48 
DLL_PUBLIC
 
DœeùÜyMÚ™Ü
::
I‹m
::
	$I‹m
(cÚ¡ 
I‹m
 &
rhs
)

49 : 
	`ty³
(
rhs
.
ty³
)

50 , 
	$·thÇme
(
rhs
.
·thÇme
)

52 
	}
}

54 
DLL_PUBLIC
 
	gDœeùÜyMÚ™Ü
::
I‹m
 &
DœeùÜyMÚ™Ü
::I‹m::
İ”©Ü
=(cÚ¡ I‹m &
rhs
)

56 ià(
this
 !ğ&
rhs
)

58 
ty³
 = 
rhs
.type;

59 
	g·thÇme
 = 
rhs
.
·thÇme
;

61  *
	gthis
;

64 
	gDœeùÜyMÚ™Ü
::
Th»ad
::
	$Th»ad
()

65 : 
	`m_·thÇme
()

66 , 
	`m_ÿÎback
(
NULL
)

67 , 
	`m_·¿m
(
NULL
)

68 , 
	`m_timeout_ms
(0)

69 , 
	$m_»cursive
(
çl£
)

70 #ià
	`defšed
(
_WIN32
)

71 , 
	$m_hªdË
(
NULL
)

72 #–ià
	`defšed
(
__lšux__
)

73 , 
	`m_fd
(-1)

74 , 
	$m_m­_wd
()

79 #ià
	`defšed
(
_WIN32
)

80 
	`mem£t
(&
m_Ş
, 0, (m_ol));

81 #–ià
	`defšed
(
__lšux__
)

85 
	}
}

87 
	gDœeùÜyMÚ™Ü
::
Th»ad
::~
	$Th»ad
()

89 
	`StİMÚ™Ü
();

90 
	}
}

92 
	gDœeùÜyMÚ™Ü
::
Th»ad
::
	$Th»adProc
()

94 #ià
	`defšed
(
__lšux__
)

95 
	`´ùl
(
PR_SET_NAME
, "DirectoryMonitorThread", 0, 0, 0);

97 
	`S¹MÚ™Ü
();

104 
ušt32_t
 
uMes§ge
 = (ušt32_t)
DœeùÜyMÚ™Ü
::
Th»ad
::
eTC_STOP
;

105 ià(
	`CheckReque¡
(&
uMes§ge
))

107 (
Th»adCommªd
)
uMes§ge
)

109 
DœeùÜyMÚ™Ü
::
Th»ad
::
eTC_STOP
:

110 
	`R•ly
(0);

113 
	`R•ly
((
ušt32_t
)-1);

118 ià(
	`Wa™MÚ™Ü
(
m_timeout_ms
))

120 
	`HªdËC®lback
();

123 
	`SË•MS
(3000);

126 
	`StİMÚ™Ü
();

127 
	}
}

129 
boŞ
 
	gDœeùÜyMÚ™Ü
::
Th»ad
::
	$S¹MÚ™Ü
()

131 #ià
	`defšed
(
_WIN32
)

132 
m_hªdË
 = 
	`C»©eFeA
(

133 
m_·thÇme
.
	`c_¡r
(),

134 
FILE_LIST_DIRECTORY
,

135 
FILE_SHARE_READ
 | 
FILE_SHARE_WRITE
 | 
FILE_SHARE_DELETE
,

136 
NULL
,

137 
OPEN_EXISTING
,

138 
FILE_FLAG_BACKUP_SEMANTICS
 | 
FILE_FLAG_OVERLAPPED
,

139 
NULL
);

141 ià(
m_hªdË
 =ğ
INVALID_HANDLE_VALUE
 )

143  
çl£
;

146 
m_Ş
.
hEv’t
 = 
	`C»©eEv’t
(
NULL
, 
TRUE
, 
FALSE
, NULL);

149 #–ià
	`defšed
(
__lšux__
)

150 
m_fd
 = 
	`šÙify_š™
();

153 iàĞ
m_fd
 == -1 )

155 
	`³¼Ü
("inotify_init");

156  
çl£
;

159 
wd
 = -1;

162 
wd
 = 
	`šÙify_add_w©ch
(
m_fd
, 
m_·thÇme
.
	`c_¡r
(), 
s_w©ch_æags
);

164 ià(
wd
 == -1)

166 
	`³¼Ü
("inotify_add_watch");

170 
m_m­_wd
[
wd
] = 
m_·thÇme
;

174 ià(
m_»cursive
)

176 
DœeùÜyT¿v”£
 
	`dt
(
m_·thÇme
, 
m_»cursive
);

177 
dt
.
	`Next
())

179 
¡d
::
¡ršg
 
·thÇme
 = 
dt
.
	`G‘P©hName
();

180 
ušt32_t
 
æags
 = 
dt
.
	`G‘FÏgs
();

181 ià((
æags
 & 
DœeùÜyT¿v”£
::
FLAG_DIRECTORY
) != 0)

183 
wd
 = 
	`šÙify_add_w©ch
(
m_fd
, 
·thÇme
.
	`c_¡r
(), 
s_w©ch_æags
);

185 ià(
wd
 == -1)

187 
	`³¼Ü
("inotify_add_watch");

191 
m_m­_wd
[
wd
] = 
·thÇme
;

197  
Œue
;

201  
çl£
;

202 
	}
}

204 
boŞ
 
	gDœeùÜyMÚ™Ü
::
Th»ad
::
	$StİMÚ™Ü
()

206 #ià
	`defšed
(
_WIN32
)

207 
boŞ
 
»t
 = 
Œue
;

208 
»t
 =„‘ && (
	`Clo£HªdË
(
m_Ş
.
hEv’t
) != 0);

209 
»t
 =„‘ && (
	`Clo£HªdË
(
m_hªdË
) != 0);

210 
m_hªdË
 = 
NULL
;

211 
	`mem£t
(&
m_Ş
, 0, (m_ol));

213  
»t
;

214 #–ià
	`defšed
(
__lšux__
)

215 ià(
m_fd
 == -1)

217  
Œue
;

220 
rc
 = 0;

221 
¡d
::
m­
<, std::
¡ršg
>::
™”©Ü
 
™
 = 
m_m­_wd
.
	`begš
();

222 
™
 !ğ
m_m­_wd
.
	`’d
())

224 
rc
 = 
	`šÙify_rm_w©ch
(
m_fd
, 
™
->
fœ¡
);

225 ià(
rc
 != 0)

227 
	`³¼Ü
("inotify_rm_watch");

228 
™
++;

232 
m_m­_wd
.
	`”a£
(
™
++);

236 
rc
 = 
	`şo£
(
m_fd
);

237 ià(
rc
 != 0)

239 
	`³¼Ü
("close");

240  
çl£
;

243 
m_fd
 = -1;

244 
m_m­_wd
.
	`ş—r
();

246  
Œue
;

250  
çl£
;

251 
	}
}

253 
boŞ
 
	gDœeùÜyMÚ™Ü
::
Th»ad
::
	$Wa™MÚ™Ü
(
ušt32_t
 
ms
)

255 #ià
	`defšed
(
_WIN32
)

257 #–ià
	`defšed
(
__lšux__
)

258 
timev®
 
timeout
;

259 
fd_£t
 
»adfds
;

261 
timeout
.
tv_£c
 = 
ms
 / 1000;

262 
timeout
.
tv_u£c
 = (
ms
 % 1000) * 1000;

264 
	`FD_ZERO
(&
»adfds
);

265 
	`FD_SET
(
m_fd
, &
»adfds
);

267 
»t
 = 
	`£Ëù
(
m_fd
 + 1, &
»adfds
, 
NULL
, NULL, &
timeout
);

269 ià(
»t
 < 0)

271 
	`³¼Ü
("select");

272  
çl£
;

275  (
»t
 > 0è&& 
	`FD_ISSET
(
m_fd
, &
»adfds
);

279  
çl£
;

280 
	}
}

282 
boŞ
 
	gDœeùÜyMÚ™Ü
::
Th»ad
::
	$HªdËC®lback
()

284 
DœeùÜyMÚ™Ü
::
I‹m
 
™em
;

285 #ià
	`defšed
(
_WIN32
)

287 #–ià
	`defšed
(
__lšux__
)

288 
buf
[
BUF_LEN
] = {'\0'};

289 
ssize_t
 
Ën
;

291 
Ën
 = 
	`»ad
(
m_fd
, (*)
buf
, (
size_t
)
BUF_LEN
);

292 ià(
Ën
 < 0)

294 
	`³¼Ü
("read");

295  
çl£
;

297 ià(
Ën
 == 0)

300  
çl£
;

303 
i
 = 0;

304 
i
 < 
Ën
)

306 
šÙify_ev’t
 *
ev’t
;

308 
ev’t
 = (
šÙify_ev’t
 *)&
buf
[
i
];

310 ià(
m_m­_wd
.
	`fšd
(
ev’t
->
wd
è=ğm_m­_wd.
	`’d
())

312 
	`as£¹
(0);

314 ià((
ev’t
->
mask
 & 
IN_IGNORED
 ) != 0)

316 
m_m­_wd
.
	`”a£
(
ev’t
->
wd
);

317 
	`šÙify_rm_w©ch
(
m_fd
, 
ev’t
->
wd
);

319 ià(
ev’t
->
Ën
 <= 0)

321 
	`as£¹
(0);

325 
¡d
::
¡ršg
 
·thÇme
 = 
m_m­_wd
[
ev’t
->
wd
] + "/" +ƒv’t->
Çme
;

326 
I‹m
 
™em
;

327 
™em
.
·thÇme
 = 
m_m­_wd
[
ev’t
->
wd
] + "/" +ƒv’t->
Çme
;

328 ià((
ev’t
->
mask
 & 
IN_CREATE
) != 0)

330 
™em
.
ty³
 = 
I‹m
::
eCREATE
;

331 ià(
m_»cursive
 && 
	`CheckDœeùÜyExi¡
(
™em
.
·thÇme
))

333 
wd
 = 
	`šÙify_add_w©ch
(
m_fd
, 
™em
.
·thÇme
.
	`c_¡r
(), 
s_w©ch_æags
);

335 ià(
wd
 == -1)

337 
	`³¼Ü
("inotify_add_watch");

341 
m_m­_wd
[
wd
] = 
™em
.
·thÇme
;

345 ià((
ev’t
->
mask
 & 
IN_DELETE
) != 0)

347 
™em
.
ty³
 = 
I‹m
::
eDELETE
;

349 ià((
ev’t
->
mask
 & 
IN_MODIFY
) != 0)

351 
™em
.
ty³
 = 
I‹m
::
eMODIFY
;

355 
™em
.
ty³
 = 
I‹m
::
eUNKNOWN
;

357 ià(
m_ÿÎback
 !ğ
NULL
)

360 
	`m_ÿÎback
(
m_·¿m
, 
™em
);

364 
i
 +ğ
EVENT_SIZE
 + 
ev’t
->
Ën
;

366  
Œue
;

370  
çl£
;

371 
	}
}

373 
DLL_PUBLIC
 
	gDœeùÜyMÚ™Ü
::
	$DœeùÜyMÚ™Ü
()

375 
	}
}

377 
DLL_PUBLIC
 
DœeùÜyMÚ™Ü
::~
	$DœeùÜyMÚ™Ü
()

379 
	`Stİ
();

380 
	}
}

382 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyMÚ™Ü
::
	$S¹
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
, 
DœeùÜyMÚ™Ü
::
C®lback
 
ÿÎback
, *
·¿m
, 
ušt32_t
 
timeout_ms
, 
boŞ
 
»cursive
 )

384 
	`Stİ
();

385 
m_th»ad
.
m_·thÇme
 = 
	`ResŞveP©h
(
·thÇme
);

386 
m_th»ad
.
m_ÿÎback
 = 
ÿÎback
;

387 
m_th»ad
.
m_·¿m
 = 
·¿m
;

388 
m_th»ad
.
m_timeout_ms
 = 
timeout_ms
;

389 
m_th»ad
.
m_»cursive
 = 
»cursive
;

390  
m_th»ad
.
	`C»©eTh»ad
();

391 
	}
}

393 
DLL_PUBLIC
 
boŞ
 
	gDœeùÜyMÚ™Ü
::
	$Stİ
()

395 ià(
m_th»ad
.
	`Th»adExi¡s
())

397 
m_th»ad
.
	`C®lWÜk”
(
DœeùÜyMÚ™Ü
::
Th»ad
::
eTC_STOP
, 
NULL
);

398  
m_th»ad
.
	`Clo£Th»ad
();

400  
Œue
;

401 
	}
}

	@../thread_object/directory_monitor.h

1 #iâdeà
__THREAD_OBJECT_DIRECTORY_MONITOR_H__


2 
	#__THREAD_OBJECT_DIRECTORY_MONITOR_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"­r/­r_th»ad_wÜk”.h
"

9 
	~<¡ršg
>

10 
	~<m­
>

12 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

14 #ià
defšed
(
_WIN32
)

16 #´agm¨
w¬nšg
(
di§bË
: 4251)

21 şas 
	cDLL_PUBLIC
 
	gDœeùÜyMÚ™Ü


23 
	gpublic
:

24 
DLL_PUBLIC
 
I‹m


28 
eUNKNOWN
,

29 
	geCREATE
,

30 
	geDELETE
,

31 
	geMODIFY
,

32 } 
	tEv’tTy³
;

34 
Ev’tTy³
 
	gty³
;

35 
	g¡d
::
¡ršg
 
·thÇme
;

37 
I‹m
();

38 ~
I‹m
();

39 
I‹m
(cÚ¡ I‹m &
rhs
);

40 
	gI‹m
 &
	gİ”©Ü
=(cÚ¡ 
I‹m
 &
rhs
);

43 (*
	gC®lback
)(*
	t·¿m
, 
	tDœeùÜyMÚ™Ü
::
	tI‹m
 &
	t™em
);

45 
	g´iv©e
:

46 şas 
	cTh»ad
: 
public
 
A´Th»adWÜk”


48 
ä›nd
 
şass
 
DœeùÜyMÚ™Ü
;

49 
	g´iv©e
:

52 
eTC_STOP


53 } 
	tTh»adCommªd
;

55 
	gpublic
:

56 
Th»ad
();

57 ~
Th»ad
();

59 
	g´Ùeùed
:

60 
vœtu®
 
Th»adProc
();

62 
	g´iv©e
:

63 
boŞ
 
S¹MÚ™Ü
();

64 
boŞ
 
StİMÚ™Ü
();

65 
boŞ
 
Wa™MÚ™Ü
(
ušt32_t
 
ms
);

66 
boŞ
 
HªdËC®lback
();

68 
	g´iv©e
:

69 
Th»ad
(cÚ¡ Th»ad &
rhs
);

70 
	gTh»ad
 &
	gİ”©Ü
=(cÚ¡ 
Th»ad
 &
rhs
);

72 
	g´iv©e
:

73 
¡d
::
¡ršg
 
m_·thÇme
;

74 
	gDœeùÜyMÚ™Ü
::
C®lback
 
m_ÿÎback
;

75 *
	gm_·¿m
;

76 
ušt32_t
 
	gm_timeout_ms
;

77 
boŞ
 
	gm_»cursive
;

78 #ià
defšed
(
_WIN32
)

79 
HANDLE
 
	gm_hªdË
;

80 
OVERLAPPED
 
	gm_Ş
;

81 #–ià
defšed
(
__lšux__
)

82 
	gm_fd
;

83 
	g¡d
::
m­
<, std::
¡ršg
> 
m_m­_wd
;

89 
	gpublic
:

90 
DœeùÜyMÚ™Ü
();

91 ~
DœeùÜyMÚ™Ü
();

93 
boŞ
 
S¹
(cÚ¡ 
¡d
::
¡ršg
 &
·thÇme
, 
DœeùÜyMÚ™Ü
::
C®lback
 
ÿÎback
, *
·¿m
, 
ušt32_t
 
timeout_ms
, boŞ 
»cursive
=
çl£
);

94 
boŞ
 
Stİ
();

96 
	g´iv©e
:

97 
DœeùÜyMÚ™Ü
(cÚ¡ DœeùÜyMÚ™Ü &
rhs
);

98 
	gDœeùÜyMÚ™Ü
 &
	gİ”©Ü
=(cÚ¡ 
DœeùÜyMÚ™Ü
 &
rhs
);

100 
	g´iv©e
:

101 
DœeùÜyMÚ™Ü
::
Th»ad
 
m_th»ad
;

	@../thread_object/single_timer.cpp

1 
	~"sšgË_tim”.h
"

3 
	~"commÚ/sy¡em.h
"

5 #ià
defšed
(
__lšux__
)

6 
	~<sys/´ùl.h
>

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
	gSšgËTim”
::
Tim”Th»ad
::
	$Tim”Th»ad
()

12 : 
	`m_¡¬t_ms
(0)

13 , 
	`m_š‹rv®_ms
(0)

14 , 
	`m_cb
(
NULL
)

15 , 
	`m_¬g1
(
NULL
)

16 , 
	$m_¬g2
(
NULL
)

18 
	}
}

20 
	gSšgËTim”
::
Tim”Th»ad
::~
	$Tim”Th»ad
()

22 
	}
}

24 
SšgËTim”
::
Tim”Th»ad
::
	$S‘Tim”
(
ušt32_t
 
¡¬t_ms
, ušt32_ˆ
š‹rv®_ms
)

26 
m_¡¬t_ms
 = 
¡¬t_ms
;

27 
m_š‹rv®_ms
 = 
š‹rv®_ms
;

28 
	}
}

30 
	gSšgËTim”
::
Tim”Th»ad
::
	$S‘C®lback
(
SšgËTim”C®lback
 
cb
, *
¬g1
, *
¬g2
)

32 
m_cb
 = 
cb
;

33 
m_¬g1
 = 
¬g1
;

34 
m_¬g2
 = 
¬g2
;

35 
	}
}

37 
	gSšgËTim”
::
Tim”Th»ad
::
	$Th»adProc
()

39 #ià
	`defšed
(
__lšux__
)

40 
	`´ùl
(
PR_SET_NAME
, "SingleTimerThread", 0, 0, 0);

46 
	`SË•MS
(
m_¡¬t_ms
);

53 
ušt32_t
 
uMes§ge
 = (ušt32_t)
Tim”Th»ad
::
eTC_STOP
;

54 ià(
	`CheckReque¡
(&
uMes§ge
))

56 (
Th»adCommªd
)
uMes§ge
)

58 
Tim”Th»ad
::
eTC_STOP
:

59 
	`R•ly
(0);

62 
	`R•ly
((
ušt32_t
)-1);

70 
	`SË•MS
(
m_š‹rv®_ms
);

75 ià(
m_cb
 !ğ
NULL
)

77 
	`m_cb
(
m_¬g1
, 
m_¬g2
);

80 
	}
}

82 
DLL_PUBLIC
 
	gSšgËTim”
::
	$SšgËTim”
()

83 : 
	$m_th»ad
()

85 
	}
}

87 
DLL_PUBLIC
 
SšgËTim”
::~
	$SšgËTim”
()

89 
	`Stİ
();

90 
	}
}

92 
DLL_PUBLIC
 
boŞ
 
	gSšgËTim”
::
	$S¹
(
SšgËTim”C®lback
 
cb
, *
¬g1
, *
¬g2
, 
ušt32_t
 
š‹rv®_ms
, ušt32_ˆ
¡¬t_ms
 )

94 
	`Stİ
();

95 
m_th»ad
.
	`S‘Tim”
(
¡¬t_ms
, 
š‹rv®_ms
);

96 
m_th»ad
.
	`S‘C®lback
(
cb
, 
¬g1
, 
¬g2
);

97  
m_th»ad
.
	`C»©eTh»ad
();

98 
	}
}

100 
DLL_PUBLIC
 
boŞ
 
	gSšgËTim”
::
	$Stİ
()

102 ià(
m_th»ad
.
	`Th»adExi¡s
())

104 
m_th»ad
.
	`C®lWÜk”
(
Tim”Th»ad
::
eTC_STOP
, 
NULL
);

105  
m_th»ad
.
	`Clo£Th»ad
();

107  
Œue
;

108 
	}
}

	@../thread_object/single_timer.h

1 #iâdeà
__THREAD_OBJECT_SINGLE_TIMER_H__


2 
	#__THREAD_OBJECT_SINGLE_TIMER_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"­r/­r_th»ad_wÜk”.h
"

9 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

11 #ià
defšed
(
_WIN32
)

13 #´agm¨
w¬nšg
(
di§bË
: 4251)

16 (*
	gSšgËTim”C®lback
)(*
	t¬g1
, *
	t¬g2
);

18 şas 
	cDLL_PUBLIC
 
	gSšgËTim”


20 
	g´iv©e
:

21 şas 
	cTim”Th»ad
: 
public
 
A´Th»adWÜk”


23 
ä›nd
 
şass
 
SšgËTim”
;

24 
	g´iv©e
:

27 
eTC_STOP


28 } 
	tTh»adCommªd
;

30 
	gpublic
:

31 
Tim”Th»ad
();

32 ~
Tim”Th»ad
();

34 
S‘Tim”
(
ušt32_t
 
¡¬t_ms
, ušt32_ˆ
š‹rv®_ms
);

35 
S‘C®lback
(
SšgËTim”C®lback
 
cb
, *
¬g1
, *
¬g2
);

37 
	g´Ùeùed
:

38 
vœtu®
 
Th»adProc
();

40 
	g´iv©e
:

41 
Tim”Th»ad
(cÚ¡ Tim”Th»ad &
rhs
);

42 
	gTim”Th»ad
 &
	gİ”©Ü
=(cÚ¡ 
Tim”Th»ad
 &
rhs
);

44 
	g´iv©e
:

45 
ušt32_t
 
m_¡¬t_ms
;

46 
ušt32_t
 
	gm_š‹rv®_ms
;

47 
SšgËTim”C®lback
 
	gm_cb
;

48 *
	gm_¬g1
;

49 *
	gm_¬g2
;

52 
	gpublic
:

53 
SšgËTim”
();

54 ~
SšgËTim”
();

56 
boŞ
 
S¹
(
SšgËTim”C®lback
 
cb
, *
¬g1
, *
¬g2
, 
ušt32_t
 
š‹rv®_ms
, ušt32_ˆ
¡¬t_ms
=0);

57 
boŞ
 
Stİ
();

59 
	g´iv©e
:

60 
SšgËTim”
(cÚ¡ SšgËTim” &
rhs
);

61 
	gSšgËTim”
 &
	gİ”©Ü
=(cÚ¡ 
SšgËTim”
 &
rhs
);

63 
	g´iv©e
:

64 
Tim”Th»ad
 
m_th»ad
;

	@../thread_object/task_pool.cpp

1 
	~"sk_poŞ.h
"

3 
	~"commÚ/sy¡em.h
"

4 
	~"commÚ/ut™y.h
"

6 
	~<as£¹.h
>

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 #ià
defšed
 (
_WIN32
)

11 #´agm¨
w¬nšg
(
di§bË
:4355)

14 
	gTaskPoŞ
::
TaskTh»ad
::
	$TaskTh»ad
(
TaskPoŞ
 *
poŞ
)

15 : 
	$m_poŞ
(
poŞ
)

17 
	}
}

19 
TaskPoŞ
::
TaskTh»ad
::~
	$TaskTh»ad
()

21 
	}
}

23 
boŞ
 
TaskPoŞ
::
TaskTh»ad
::
	$CÚtšue
()

25 
	`as£¹
(
m_poŞ
 !ğ
NULL
);

26 
	`IF_NULL_RETURN_VALUE
(
m_poŞ
, 
çl£
);

27  !
m_poŞ
->
m_cÚd™iÚ_qu™
.
	`timedwa™
(0);

28 
	}
}

30 
	gTaskPoŞ
::
TaskTh»ad
::
	$WÜk
()

32 
	`as£¹
(
m_poŞ
 !ğ
NULL
);

33 
	`IF_NULL_RETURN
(
m_poŞ
);

35 
sm¬t_±r
<
TaskObjeù
> 
sk
;

37 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_poŞ
->
m_cs_sks
);

38 ià(!
m_poŞ
->
m_queue_sks
.
	`em±y
())

40 
ušt32_t
 
id
 = 
m_poŞ
->
m_queue_sks
.
	`äÚt
();

41 
m_poŞ
->
m_queue_sks
.
	`pİ_äÚt
();

42 
¡d
::
m­
< 
ušt32_t
, 
sm¬t_±r
<
TaskObjeù
> >::
™”©Ü
 
™
 = 
m_poŞ
->
m_m­_sks
.
	`fšd
(
id
);

43 
	`as£¹
(
™
 !ğ
m_poŞ
->
m_m­_sks
.
	`’d
());

44 ià(
™
 !ğ
m_poŞ
->
m_m­_sks
.
	`’d
())

46 
sk
 = 
™
->
£cÚd
;

48 
m_poŞ
->
m_£t_wa™s
.
	`š£¹
(
id
);

51 ià(
sk
.
	`g‘
(è!ğ
NULL
)

53 
sk
.
	`g‘
()->
	`C®lHªdËTask
();

57 
	`SË•MS
(100);

59 
	}
}

61 
	gTaskPoŞ
::
ResuÉTh»ad
::
	$ResuÉTh»ad
(
TaskPoŞ
 *
poŞ
)

62 : 
	$m_poŞ
(
poŞ
)

64 
	}
}

66 
TaskPoŞ
::
ResuÉTh»ad
::~
	$ResuÉTh»ad
()

68 
	}
}

70 
boŞ
 
TaskPoŞ
::
ResuÉTh»ad
::
	$CÚtšue
()

72 
	`as£¹
(
m_poŞ
 !ğ
NULL
);

73 
	`IF_NULL_RETURN_VALUE
(
m_poŞ
, 
çl£
);

74  !
m_poŞ
->
m_cÚd™iÚ_qu™
.
	`timedwa™
(0);

75 
	}
}

77 
	gTaskPoŞ
::
ResuÉTh»ad
::
	$WÜk
()

79 
	`as£¹
(
m_poŞ
 !ğ
NULL
);

80 
	`IF_NULL_RETURN
(
m_poŞ
);

82 
sm¬t_±r
<
TaskObjeù
> 
sk
;

84 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_poŞ
->
m_cs_sks
);

85 ià(!
m_poŞ
->
m_queue_»suÉs
.
	`em±y
())

87 
ušt32_t
 
id
 = 
m_poŞ
->
m_queue_»suÉs
.
	`äÚt
();

88 
m_poŞ
->
m_queue_»suÉs
.
	`pİ_äÚt
();

89 
¡d
::
m­
< 
ušt32_t
, 
sm¬t_±r
<
TaskObjeù
> >::
™”©Ü
 
™
 = 
m_poŞ
->
m_m­_sks
.
	`fšd
(
id
);

90 
	`as£¹
(
™
 !ğ
m_poŞ
->
m_m­_sks
.
	`’d
());

91 ià(
™
 !ğ
m_poŞ
->
m_m­_sks
.
	`’d
())

93 
sk
 = 
™
->
£cÚd
;

94 
m_poŞ
->
m_m­_sks
.
	`”a£
(
™
);

98 ià(
sk
.
	`g‘
(è!ğ
NULL
)

100 
sk
.
	`g‘
()->
	`C®lHªdËResuÉ
();

101 
m_poŞ
->
	`RemoveTask
(
sk
.
	`g‘
()->
	`G‘TaskID
());

105 
	`SË•MS
(100);

107 
	}
}

109 
DLL_PUBLIC
 
	gTaskPoŞ
::
TaskObjeù
::
	$TaskObjeù
()

110 : 
	`m_sk_id
(
TaskPoŞ
::
	`G‘NextTaskID
())

111 , 
	`m_cÚd™iÚ_sk
(
Œue
)

112 , 
	$m_cÚd™iÚ_»suÉ
(
Œue
)

114 
	}
}

116 
DLL_PUBLIC
 
	gTaskPoŞ
::
TaskObjeù
::~
	$TaskObjeù
()

118 
	}
}

120 
DLL_PUBLIC
 
ušt32_t
 
TaskPoŞ
::
TaskObjeù
::
	$G‘TaskID
()

122  
m_sk_id
;

123 
	}
}

125 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
TaskObjeù
::
	$Wa™Task
(
št64_t
 
ms
 )

127 ià(
ms
 < 0)

129  
m_cÚd™iÚ_sk
.
	`wa™
();

133  
m_cÚd™iÚ_sk
.
	`timedwa™
(
ms
);

135 
	}
}

137 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
TaskObjeù
::
	$Wa™ResuÉ
(
št64_t
 
ms
 )

139 ià(
ms
 < 0)

141  
m_cÚd™iÚ_»suÉ
.
	`wa™
();

145  
m_cÚd™iÚ_»suÉ
.
	`timedwa™
(
ms
);

147 
	}
}

149 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
TaskObjeù
::
Wa™AÎTasks
(
¡d
::
veùÜ
< 
sm¬t_±r
<TaskObjeù> > &
sks
, 
št64_t
 
ms
 )

151 
št64_t
 
	g¡¬t_time
 = 
G‘TimeCouÁMS
();

152 
št64_t
 
	g–­£_time
 = 0;

153 
št64_t
 
	g»maš_time
 = 0;

154 
size_t
 
	gi
 = 0; i < 
	gsks
.
size
(); i++)

156 
	g–­£_time
 = 
G‘TimeCouÁMS
(è- 
¡¬t_time
;

157 ià(
	gsks
[
i
].
g‘
(è=ğ
NULL
)

161 ià(
	gms
 <= 0)

163 
»maš_time
 = 
ms
;

167 
	g»maš_time
 = 
ms
 - 
–­£_time
;

168 ià(
	g»maš_time
 < 0)

170  
	gçl£
;

173 ià(!
	gsks
[
i
].
g‘
()->
Wa™Task
(
»maš_time
))

175  
	gçl£
;

178  
	gŒue
;

181 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
TaskObjeù
::
Wa™AÎResuÉs
(
¡d
::
veùÜ
< 
sm¬t_±r
<TaskObjeù> > &
sks
, 
št64_t
 
ms
 )

183 
št64_t
 
	g¡¬t_time
 = 
G‘TimeCouÁMS
();

184 
št64_t
 
	g–­£_time
 = 0;

185 
št64_t
 
	g»maš_time
 = 0;

186 
size_t
 
	gi
 = 0; i < 
	gsks
.
size
(); i++)

188 
	g–­£_time
 = 
G‘TimeCouÁMS
(è- 
¡¬t_time
;

189 ià(
	gsks
[
i
].
g‘
(è=ğ
NULL
)

193 ià(
	gms
 <= 0)

195 
»maš_time
 = 
ms
;

199 
	g»maš_time
 = 
ms
 - 
–­£_time
;

200 ià(
	g»maš_time
 < 0)

202  
	gçl£
;

205 ià(!
	gsks
[
i
].
g‘
()->
Wa™ResuÉ
(
»maš_time
))

207  
	gçl£
;

210  
	gŒue
;

213 
DLL_PUBLIC
 
	gTaskPoŞ
::
TaskObjeù
::
	$C®lHªdËTask
()

215 
	`HªdËTask
();

216 
m_cÚd™iÚ_sk
.
	`£t
();

217 
	}
}

219 
DLL_PUBLIC
 
	gTaskPoŞ
::
TaskObjeù
::
	$C®lHªdËResuÉ
()

221 
	`HªdËResuÉ
();

222 
m_cÚd™iÚ_»suÉ
.
	`£t
();

223 
	}
}

225 
DLL_PUBLIC
 
	gTaskPoŞ
::
	$TaskPoŞ
()

226 : 
	`m_cs_sks
()

227 , 
	`m_queue_sks
()

228 , 
	`m_£t_wa™s
()

229 , 
	`m_queue_»suÉs
()

230 , 
	`m_m­_sks
()

231 , 
	`m_cs_th»ads
()

232 , 
	`m_th»ad_sks
(
this
)

233 , 
	`m_th»ad_»suÉs
(
this
)

234 , 
	$m_cÚd™iÚ_qu™
(
Œue
)

236 
	}
}

238 
DLL_PUBLIC
 
	gTaskPoŞ
::~
	$TaskPoŞ
()

240 
	`StİWÜk
();

241 
	}
}

243 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
	$S¹WÜk
()

245 
m_cÚd™iÚ_qu™
.
	`»£t
();

246 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_th»ads
);

247 
boŞ
 
»t
 = 
Œue
;

248 
»t
 = 
m_th»ad_sks
.
	`C»©eTh»ad
() &&„et;

249 
»t
 = 
m_th»ad_»suÉs
.
	`C»©eTh»ad
() &&„et;

250  
»t
;

251 
	}
}

253 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
	$StİWÜk
()

255 
m_cÚd™iÚ_qu™
.
	`£t
();

256 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_th»ads
);

257 
boŞ
 
»t
 = 
Œue
;

258 
»t
 = 
m_th»ad_sks
.
	`Clo£Th»ad
() &&„et;

259 
»t
 = 
m_th»ad_»suÉs
.
	`Clo£Th»ad
() &&„et;

260  
»t
;

261 
	}
}

263 
DLL_PUBLIC
 
ušt32_t
 
	gTaskPoŞ
::
	$G‘NextTaskID
()

265 
Cr™iÿlSeùiÚ
 
cs_id
;

266 
ušt32_t
 
Ãxt_id
 = 0;

267 
Cr™iÿlSeùiÚLock
 
	`_l
(&
cs_id
);

268 ià(
Ãxt_id
 == 0)

270 
Ãxt_id
++;

272  
Ãxt_id
++;

273 
	}
}

275 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
Aµ’dTask
(
sm¬t_±r
<
TaskObjeù
> 
sk
)

277 ià(
sk
.
g‘
(è=ğ
NULL
)

279  
çl£
;

281 
ušt32_t
 
	gid
 = 
sk
.
g‘
()->
G‘TaskID
();

282 
Cr™iÿlSeùiÚLock
 
_l
(&
m_cs_sks
);

283 
	g¡d
::
m­
< 
ušt32_t
, 
	gsm¬t_±r
<
	gTaskPoŞ
::
TaskObjeù
> >::
™”©Ü
 
™
 = 
m_m­_sks
.
fšd
(
id
);

284 ià(
	g™
 !ğ
m_m­_sks
.
’d
())

286  
çl£
;

288 
	gm_m­_sks
[
id
] = 
sk
;

289 
	gm_queue_sks
.
push_back
(
id
);

290  
	gŒue
;

293 
DLL_PUBLIC
 
	gsm¬t_±r
<
	gTaskPoŞ
::
TaskObjeù
> 
TaskPoŞ
::
	$G‘Task
(
ušt32_t
 
id
)

295 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_sks
);

296 
¡d
::
m­
< 
ušt32_t
, 
sm¬t_±r
<
TaskPoŞ
::
TaskObjeù
> >::
™”©Ü
 
™
 = 
m_m­_sks
.
	`fšd
(
id
);

297 ià(
™
 =ğ
m_m­_sks
.
	`’d
())

299  
NULL
;

301  
™
->
£cÚd
;

302 
	}
}

304 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
	$FšishTask
(
ušt32_t
 
id
)

306 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_sks
);

307 
¡d
::
£t
<
ušt32_t
>::
™”©Ü
 
™
 = 
m_£t_wa™s
.
	`fšd
(
id
);

308 ià(
™
 =ğ
m_£t_wa™s
.
	`’d
())

310  
çl£
;

312 
m_£t_wa™s
.
	`”a£
(
™
);

313 
m_queue_»suÉs
.
	`push_back
(
id
);

314  
Œue
;

315 
	}
}

317 
DLL_PUBLIC
 
boŞ
 
	gTaskPoŞ
::
	$RemoveTask
(
ušt32_t
 
id
)

319 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_sks
);

320 
¡d
::
m­
< 
ušt32_t
, 
sm¬t_±r
<
TaskPoŞ
::
TaskObjeù
> >::
™”©Ü
 
™
 = 
m_m­_sks
.
	`fšd
(
id
);

321 ià(
™
 =ğ
m_m­_sks
.
	`’d
())

323  
çl£
;

325 
m_m­_sks
.
	`”a£
(
™
);

327 
¡d
::
li¡
<
ušt32_t
>::
™”©Ü
 
™_sk
 = 
m_queue_sks
.
	`begš
(); it_sk !ğm_queue_sks.
	`’d
();)

329 ià((*
™_sk
è=ğ
id
)

331 
m_queue_sks
.
	`”a£
(
™_sk
++);

335 
™_sk
++;

339 
¡d
::
£t
<
ušt32_t
>::
™”©Ü
 
™_wa™
 = 
m_£t_wa™s
.
	`fšd
(
id
);

340 ià(
™_wa™
 !ğ
m_£t_wa™s
.
	`’d
())

342 
m_£t_wa™s
.
	`”a£
(
™_wa™
);

345 
¡d
::
li¡
<
ušt32_t
>::
™”©Ü
 
™_»suÉ
 = 
m_queue_»suÉs
.
	`begš
(); it_»suÉ !ğm_queue_»suÉs.
	`’d
();)

347 ià((*
™_»suÉ
è=ğ
id
)

349 
m_queue_»suÉs
.
	`”a£
(
™_»suÉ
++);

353 
™_»suÉ
++;

357  
Œue
;

358 
	}
}

	@../thread_object/task_pool.h

1 #iâdeà
__THREAD_OBJECT_TASK_POOL_H__


2 
	#__THREAD_OBJECT_TASK_POOL_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

8 
	~"commÚ/sm¬t_poš‹r.h
"

9 
	~"­r/­r_cÚd.h
"

10 
	~"­r/­r_th»ad_İ”©Ü.h
"

12 
	~<veùÜ
>

13 
	~<li¡
>

14 
	~<£t
>

15 
	~<m­
>

17 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

19 #ià
defšed
(
_WIN32
)

21 #´agm¨
w¬nšg
(
di§bË
: 4251)

24 şas 
	cDLL_PUBLIC
 
	gTaskPoŞ


26 
	g´iv©e
:

30 şas 
	cTaskTh»ad
: 
public
 
A´Th»adO³¿tÜ


32 
public
:

33 
TaskTh»ad
(
TaskPoŞ
 *
poŞ
);

34 ~
TaskTh»ad
();

36 
vœtu®
 
boŞ
 
CÚtšue
();

37 
vœtu®
 
WÜk
();

39 
	g´iv©e
:

40 
TaskTh»ad
();

41 
TaskTh»ad
(cÚ¡ TaskTh»ad &
rhs
);

42 
	gTaskTh»ad
 &
	gİ”©Ü
=(cÚ¡ 
TaskTh»ad
 &
rhs
);

44 
	g´iv©e
:

45 
TaskPoŞ
 *
m_poŞ
;

51 şas 
	cResuÉTh»ad
: 
public
 
A´Th»adO³¿tÜ


53 
public
:

54 
ResuÉTh»ad
(
TaskPoŞ
 *
poŞ
);

55 ~
ResuÉTh»ad
();

57 
vœtu®
 
boŞ
 
CÚtšue
();

58 
vœtu®
 
WÜk
();

60 
	g´iv©e
:

61 
ResuÉTh»ad
();

62 
ResuÉTh»ad
(cÚ¡ ResuÉTh»ad &
rhs
);

63 
	gResuÉTh»ad
 &
	gİ”©Ü
=(cÚ¡ 
ResuÉTh»ad
 &
rhs
);

65 
	g´iv©e
:

66 
TaskPoŞ
 *
m_poŞ
;

69 
ä›nd
 
şass
 
	gTaskTh»ad
;

70 
ä›nd
 
şass
 
	gResuÉTh»ad
;

72 
	gpublic
:

76 şas 
	cDLL_PUBLIC
 
TaskObjeù


78 
public
:

79 
TaskObjeù
();

80 
	gvœtu®
 ~
TaskObjeù
();

82 
ušt32_t
 
G‘TaskID
();

84 
boŞ
 
Wa™Task
(
št64_t
 
ms
=-1);

85 
boŞ
 
Wa™ResuÉ
(
št64_t
 
ms
=-1);

86 
boŞ
 
Wa™AÎTasks
(
¡d
::
veùÜ
< 
sm¬t_±r
<
TaskObjeù
> > &
sks
, 
št64_t
 
ms
=-1);

87 
boŞ
 
Wa™AÎResuÉs
(
¡d
::
veùÜ
< 
sm¬t_±r
<
TaskObjeù
> > &
sks
, 
št64_t
 
ms
=-1);

89 
C®lHªdËTask
();

90 
C®lHªdËResuÉ
();

92 
	g´iv©e
:

93 
vœtu®
 
HªdËTask
() = 0;

94 
vœtu®
 
HªdËResuÉ
() = 0;

96 
	g´iv©e
:

97 
TaskObjeù
(cÚ¡ TaskObjeù &
rhs
);

98 
	gTaskObjeù
 &
	gİ”©Ü
=(cÚ¡ 
TaskObjeù
 &
rhs
);

100 
	g´iv©e
:

101 
ušt32_t
 
m_sk_id
;

102 
A´CÚd
 
	gm_cÚd™iÚ_sk
;

103 
A´CÚd
 
	gm_cÚd™iÚ_»suÉ
;

106 
	gpublic
:

107 
TaskPoŞ
();

108 ~
TaskPoŞ
();

110 
boŞ
 
S¹WÜk
();

111 
boŞ
 
StİWÜk
();

113 
ušt32_t
 
G‘NextTaskID
();

115 
boŞ
 
Aµ’dTask
(
sm¬t_±r
<
TaskObjeù
> 
sk
);

116 
	gsm¬t_±r
<
	gTaskObjeù
> 
G‘Task
(
ušt32_t
 
id
);

117 
boŞ
 
FšishTask
(
ušt32_t
 
id
);

118 
boŞ
 
RemoveTask
(
ušt32_t
 
id
);

120 
	g´iv©e
:

121 
TaskPoŞ
(cÚ¡ TaskPoŞ &
rhs
);

122 
	gTaskPoŞ
 &
	gİ”©Ü
=(cÚ¡ 
TaskPoŞ
 &
rhs
);

124 
	g´iv©e
:

125 
Cr™iÿlSeùiÚ
 
m_cs_sks
;

126 
	g¡d
::
li¡
<
ušt32_t
> 
m_queue_sks
;

127 
	g¡d
::
£t
<
ušt32_t
> 
m_£t_wa™s
;

128 
	g¡d
::
li¡
<
ušt32_t
> 
m_queue_»suÉs
;

129 
	g¡d
::
m­
< 
ušt32_t
, 
	gsm¬t_±r
<
	gTaskObjeù
> > 
	gm_m­_sks
;

131 
Cr™iÿlSeùiÚ
 
	gm_cs_th»ads
;

132 
TaskTh»ad
 
	gm_th»ad_sks
;

133 
ResuÉTh»ad
 
	gm_th»ad_»suÉs
;

134 
A´CÚd
 
	gm_cÚd™iÚ_qu™
;

	@../thread_object/task_queue.cpp

1 
	~"sk_queue.h
"

3 
	~"commÚ/sy¡em.h
"

4 
	~"commÚ/ut™y.h
"

6 
	~<as£¹.h
>

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 #ià
defšed
 (
_WIN32
)

11 #´agm¨
w¬nšg
(
di§bË
:4355)

14 
	gTaskQueue
::
TaskTh»ad
::
	$TaskTh»ad
(
TaskQueue
 *
queue
)

15 : 
	$m_queue
(
queue
)

17 
	}
}

19 
TaskQueue
::
TaskTh»ad
::~
	$TaskTh»ad
()

21 
	}
}

23 
boŞ
 
TaskQueue
::
TaskTh»ad
::
	$CÚtšue
()

25 
	`as£¹
(
m_queue
 !ğ
NULL
);

26 
	`IF_NULL_RETURN_VALUE
(
m_queue
, 
çl£
);

27  !
m_queue
->
m_cÚd™iÚ_qu™
.
	`timedwa™
(0);

28 
	}
}

30 
	gTaskQueue
::
TaskTh»ad
::
	$WÜk
()

32 
	`as£¹
(
m_queue
 !ğ
NULL
);

33 
	`IF_NULL_RETURN
(
m_queue
);

35 
sm¬t_±r
<
TaskObjeù
> 
sk
;

37 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_queue
->
m_cs_sks
);

38 ià(!
m_queue
->
m_queue_sks
.
	`em±y
())

40 
ušt32_t
 
id
 = 
m_queue
->
m_queue_sks
.
	`äÚt
();

41 
m_queue
->
m_queue_sks
.
	`pİ_äÚt
();

42 
¡d
::
m­
< 
ušt32_t
, 
sm¬t_±r
<
TaskObjeù
> >::
™”©Ü
 
™
 = 
m_queue
->
m_m­_sks
.
	`fšd
(
id
);

43 
	`as£¹
(
™
 !ğ
m_queue
->
m_m­_sks
.
	`’d
());

44 ià(
™
 !ğ
m_queue
->
m_m­_sks
.
	`’d
())

46 
sk
 = 
™
->
£cÚd
;

50 ià(
sk
.
	`g‘
(è!ğ
NULL
)

52 
sk
.
	`g‘
()->
	`C®lHªdËTask
();

53 
m_queue
->
	`RemoveTask
(
sk
.
	`g‘
()->
	`G‘TaskID
());

57 
	`SË•MS
(100);

59 
	}
}

61 
DLL_PUBLIC
 
	gTaskQueue
::
TaskObjeù
::
	$TaskObjeù
()

62 : 
	`m_sk_id
(
TaskQueue
::
	`G‘NextTaskID
())

63 , 
	$m_cÚd™iÚ_sk
(
Œue
)

65 
	}
}

67 
DLL_PUBLIC
 
	gTaskQueue
::
TaskObjeù
::~
	$TaskObjeù
()

69 
	}
}

71 
DLL_PUBLIC
 
ušt32_t
 
TaskQueue
::
TaskObjeù
::
	$G‘TaskID
()

73  
m_sk_id
;

74 
	}
}

76 
DLL_PUBLIC
 
boŞ
 
	gTaskQueue
::
TaskObjeù
::
	$Wa™Task
(
št64_t
 
ms
 )

78 ià(
ms
 < 0)

80  
m_cÚd™iÚ_sk
.
	`wa™
();

84  
m_cÚd™iÚ_sk
.
	`timedwa™
(
ms
);

86 
	}
}

88 
DLL_PUBLIC
 
boŞ
 
	gTaskQueue
::
TaskObjeù
::
Wa™AÎTasks
(
¡d
::
veùÜ
< 
sm¬t_±r
<TaskObjeù> > &
sks
, 
št64_t
 
ms
 )

90 
št64_t
 
	g¡¬t_time
 = 
G‘TimeCouÁMS
();

91 
št64_t
 
	g–­£_time
 = 0;

92 
št64_t
 
	g»maš_time
 = 0;

93 
size_t
 
	gi
 = 0; i < 
	gsks
.
size
(); i++)

95 
	g–­£_time
 = 
G‘TimeCouÁMS
(è- 
¡¬t_time
;

96 ià(
	gsks
[
i
].
g‘
(è=ğ
NULL
)

100 ià(
	gms
 <= 0)

102 
»maš_time
 = 
ms
;

106 
	g»maš_time
 = 
ms
 - 
–­£_time
;

107 ià(
	g»maš_time
 < 0)

109  
	gçl£
;

112 ià(!
	gsks
[
i
].
g‘
()->
Wa™Task
(
»maš_time
))

114  
	gçl£
;

117  
	gŒue
;

120 
DLL_PUBLIC
 
	gTaskQueue
::
TaskObjeù
::
	$C®lHªdËTask
()

122 
	`HªdËTask
();

123 
m_cÚd™iÚ_sk
.
	`£t
();

124 
	}
}

126 
DLL_PUBLIC
 
	gTaskQueue
::
	$TaskQueue
()

127 : 
	`m_cs_sks
()

128 , 
	`m_queue_sks
()

129 , 
	`m_m­_sks
()

130 , 
	`m_cs_th»ads
()

131 , 
	`m_th»ad_sks
(
this
)

132 , 
	$m_cÚd™iÚ_qu™
(
Œue
)

134 
	}
}

136 
DLL_PUBLIC
 
	gTaskQueue
::~
	$TaskQueue
()

138 
	`StİWÜk
();

139 
	}
}

141 
DLL_PUBLIC
 
boŞ
 
	gTaskQueue
::
	$S¹WÜk
()

143 
m_cÚd™iÚ_qu™
.
	`»£t
();

144 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_th»ads
);

145  
m_th»ad_sks
.
	`C»©eTh»ad
();

146 
	}
}

148 
DLL_PUBLIC
 
boŞ
 
	gTaskQueue
::
	$StİWÜk
()

150 
m_cÚd™iÚ_qu™
.
	`£t
();

151 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_th»ads
);

152  
m_th»ad_sks
.
	`Clo£Th»ad
();

153 
	}
}

155 
DLL_PUBLIC
 
ušt32_t
 
	gTaskQueue
::
	$G‘NextTaskID
()

157 
Cr™iÿlSeùiÚ
 
cs_id
;

158 
ušt32_t
 
Ãxt_id
 = 0;

159 
Cr™iÿlSeùiÚLock
 
	`_l
(&
cs_id
);

160  
Ãxt_id
++;

161 
	}
}

163 
DLL_PUBLIC
 
ušt32_t
 
	gTaskQueue
::
	$G‘TaskQueueSize
()

165  
m_m­_sks
.
	`size
();

166 
	}
}

168 
DLL_PUBLIC
 
boŞ
 
	gTaskQueue
::
Aµ’dTask
(
sm¬t_±r
<
TaskObjeù
> 
sk
)

170 ià(
sk
.
g‘
(è=ğ
NULL
)

172  
çl£
;

174 
ušt32_t
 
	gid
 = 
sk
.
g‘
()->
G‘TaskID
();

175 
Cr™iÿlSeùiÚLock
 
_l
(&
m_cs_sks
);

176 
	g¡d
::
m­
< 
ušt32_t
, 
	gsm¬t_±r
<
	gTaskQueue
::
TaskObjeù
> >::
™”©Ü
 
™
 = 
m_m­_sks
.
fšd
(
id
);

177 ià(
	g™
 !ğ
m_m­_sks
.
’d
())

179  
çl£
;

181 
	gm_m­_sks
[
id
] = 
sk
;

182 
	gm_queue_sks
.
push_back
(
id
);

183  
	gŒue
;

186 
DLL_PUBLIC
 
boŞ
 
	gTaskQueue
::
	$RemoveTask
(
ušt32_t
 
id
)

188 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs_sks
);

189 
¡d
::
m­
< 
ušt32_t
, 
sm¬t_±r
<
TaskQueue
::
TaskObjeù
> >::
™”©Ü
 
™
 = 
m_m­_sks
.
	`fšd
(
id
);

190 ià(
™
 =ğ
m_m­_sks
.
	`’d
())

192  
çl£
;

194 
m_m­_sks
.
	`”a£
(
™
);

196 
¡d
::
li¡
<
ušt32_t
>::
™”©Ü
 
™_sk
 = 
m_queue_sks
.
	`begš
(); it_sk !ğm_queue_sks.
	`’d
();)

198 ià((*
™_sk
è=ğ
id
)

200 
m_queue_sks
.
	`”a£
(
™_sk
++);

204 
™_sk
++;

207  
Œue
;

208 
	}
}

	@../thread_object/task_queue.h

1 #iâdeà
__THREAD_OBJECT_TASK_QUEUE_H__


2 
	#__THREAD_OBJECT_TASK_QUEUE_H__


	)

4 
	~"expÜts.h
"

6 
	~"commÚ/¡dšt.h
"

7 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

8 
	~"commÚ/sm¬t_poš‹r.h
"

9 
	~"­r/­r_cÚd.h
"

10 
	~"­r/­r_th»ad_İ”©Ü.h
"

12 
	~<veùÜ
>

13 
	~<li¡
>

14 
	~<m­
>

16 
	#MAX_TASK_QUEUE_SIZE
 40960

	)

18 
Çme¥aû
 
	gSYSUTILS_SPACE
 {

20 #ià
defšed
(
_WIN32
)

22 #´agm¨
w¬nšg
(
di§bË
: 4251)

25 şas 
	cDLL_PUBLIC
 
	gTaskQueue


27 
	g´iv©e
:

31 şas 
	cTaskTh»ad
: 
public
 
A´Th»adO³¿tÜ


33 
public
:

34 
TaskTh»ad
(
TaskQueue
 *
queue
);

35 ~
TaskTh»ad
();

37 
vœtu®
 
boŞ
 
CÚtšue
();

38 
vœtu®
 
WÜk
();

40 
	g´iv©e
:

41 
TaskTh»ad
();

42 
TaskTh»ad
(cÚ¡ TaskTh»ad &
rhs
);

43 
	gTaskTh»ad
 &
	gİ”©Ü
=(cÚ¡ 
TaskTh»ad
 &
rhs
);

45 
	g´iv©e
:

46 
TaskQueue
 *
m_queue
;

49 
ä›nd
 
şass
 
	gTaskTh»ad
;

51 
	gpublic
:

52 şas 
	cDLL_PUBLIC
 
TaskObjeù


54 
public
:

55 
TaskObjeù
();

56 
	gvœtu®
 ~
TaskObjeù
();

58 
ušt32_t
 
G‘TaskID
();

60 
boŞ
 
Wa™Task
(
št64_t
 
ms
=-1);

61 
boŞ
 
Wa™AÎTasks
(
¡d
::
veùÜ
< 
sm¬t_±r
<
TaskObjeù
> > &
sks
, 
št64_t
 
ms
=-1);

63 
C®lHªdËTask
();

65 
	g´iv©e
:

66 
vœtu®
 
HªdËTask
() = 0;

68 
	g´iv©e
:

69 
TaskObjeù
(cÚ¡ TaskObjeù &
rhs
);

70 
	gTaskObjeù
 &
	gİ”©Ü
=(cÚ¡ 
TaskObjeù
 &
rhs
);

72 
	g´iv©e
:

73 
ušt32_t
 
m_sk_id
;

74 
A´CÚd
 
	gm_cÚd™iÚ_sk
;

77 
	gpublic
:

78 
TaskQueue
();

79 ~
TaskQueue
();

81 
boŞ
 
S¹WÜk
();

82 
boŞ
 
StİWÜk
();

84 
ušt32_t
 
G‘NextTaskID
();

86 
boŞ
 
Aµ’dTask
(
sm¬t_±r
<
TaskObjeù
> 
sk
);

87 
boŞ
 
RemoveTask
(
ušt32_t
 
id
);

88 
ušt32_t
 
G‘TaskQueueSize
();

90 
	g´iv©e
:

91 
TaskQueue
(cÚ¡ TaskQueu&
rhs
);

92 
	gTaskQueue
 &
	gİ”©Ü
=(cÚ¡ 
TaskQueue
 &
rhs
);

94 
	g´iv©e
:

95 
Cr™iÿlSeùiÚ
 
m_cs_sks
;

96 
	g¡d
::
li¡
<
ušt32_t
> 
m_queue_sks
;

97 
	g¡d
::
m­
< 
ušt32_t
, 
	gsm¬t_±r
<
	gTaskObjeù
> > 
	gm_m­_sks
;

99 
Cr™iÿlSeùiÚ
 
	gm_cs_th»ads
;

100 
TaskTh»ad
 
	gm_th»ad_sks
;

101 
A´CÚd
 
	gm_cÚd™iÚ_qu™
;

	@../thread_object/unittest/aggregate_timer_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"th»ad_objeù/agg»g©e_tim”.h
"

3 
	~"commÚ/sy¡em.h
"

5 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

7 
	$Tim”Prš‹r
(
ušt32_t
 
id
, *
¬g1
, *
¬g2
)

9 
	`´štf
("0x%08x, %s, %s\n", 
id
, (*)
¬g1
, (*)
¬g2
);

10 
	}
}

12 
	$TEST
(
Agg»g©eTim”
, 
P”si¡Tim”Te¡
)

14 cÚ¡ 
s_´efix_01
[] = "prefix 01";

15 cÚ¡ 
s_¡ršg_01
[] = "string 01";

16 cÚ¡ 
s_´efix_02
[] = "prefix 02";

17 cÚ¡ 
s_¡ršg_02
[] = "string 02";

18 cÚ¡ 
s_´efix_03
[] = "prefix 03";

19 cÚ¡ 
s_¡ršg_03
[] = "string 03";

21 
Agg»g©eTim”
 
©
;

22 
ušt32_t
 
t1
 = 
©
.
	`C»©eTim”
(50, 
Tim”Prš‹r
, (*)
s_´efix_01
, (*)
s_¡ršg_01
);

23 
	`EXPECT_NE
((
ušt32_t
)0, 
t1
);

24 
ušt32_t
 
t2
 = 
©
.
	`C»©eTim”
(100, 
Tim”Prš‹r
, (*)
s_´efix_02
, (*)
s_¡ršg_02
);

25 
	`EXPECT_NE
((
ušt32_t
)0, 
t2
);

26 
ušt32_t
 
t3
 = 
©
.
	`C»©eTim”
(150, 
Tim”Prš‹r
, (*)
s_´efix_03
, (*)
s_¡ršg_03
);

27 
	`EXPECT_NE
((
ušt32_t
)0, 
t3
);

28 
	`SË•MS
(1000);

29 
	`EXPECT_TRUE
(
©
.
	`RemoveTim”
(
t1
));

30 
	`SË•MS
(1000);

31 
	`EXPECT_TRUE
(
©
.
	`RemoveTim”
(
t2
));

32 
	`SË•MS
(1000);

33 
	`EXPECT_TRUE
(
©
.
	`RemoveTim”
(
t3
));

34 
	`SË•MS
(1000);

35 
	}
}

37 
	$TEST
(
Agg»g©eTim”
, 
OÃTimeTim”Te¡
)

39 cÚ¡ 
s_´efix_01
[] = "prefix 01";

40 cÚ¡ 
s_¡ršg_01
[] = "string 01";

41 cÚ¡ 
s_´efix_02
[] = "prefix 02";

42 cÚ¡ 
s_¡ršg_02
[] = "string 02";

43 cÚ¡ 
s_´efix_03
[] = "prefix 03";

44 cÚ¡ 
s_¡ršg_03
[] = "string 03";

46 
Agg»g©eTim”
 
©
;

47 
ušt32_t
 
t1
 = 
©
.
	`C»©eTim”
(50, 
Tim”Prš‹r
, (*)
s_´efix_01
, (*)
s_¡ršg_01
, 
çl£
);

48 
	`EXPECT_NE
((
ušt32_t
)0, 
t1
);

49 
ušt32_t
 
t2
 = 
©
.
	`C»©eTim”
(100, 
Tim”Prš‹r
, (*)
s_´efix_02
, (*)
s_¡ršg_02
, 
çl£
);

50 
	`EXPECT_NE
((
ušt32_t
)0, 
t2
);

51 
ušt32_t
 
t3
 = 
©
.
	`C»©eTim”
(150, 
Tim”Prš‹r
, (*)
s_´efix_03
, (*)
s_¡ršg_03
, 
çl£
);

52 
	`EXPECT_NE
((
ušt32_t
)0, 
t3
);

53 
	`SË•MS
(1000);

54 
	`EXPECT_FALSE
(
©
.
	`RemoveTim”
(
t1
));

55 
	`EXPECT_FALSE
(
©
.
	`RemoveTim”
(
t2
));

56 
	`EXPECT_FALSE
(
©
.
	`RemoveTim”
(
t3
));

57 
	}
}

	@../thread_object/unittest/async_observer_test.cpp

1 
	~"th»ad_objeù/async_ob£rv”.h
"

2 
	~"commÚ/¡dšt.h
"

3 
	~"commÚ/sy¡em.h
"

5 
	~"g‹¡/g‹¡.h
"

7 
	~<veùÜ
>

9 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

11 
	gAsyncP¬am‘”
: 
public
 
AsyncOb£rv”NÙifyP¬am‘”


13 
ušt32_t
 
numb”
;

16 şas 
	cAsyncReûiv”
: 
public
 
AsyncOb£rv”


18 
public
:

19 
	$AsyncReûiv”
(
ušt32_t
 
ba£_numb”
)

20 : 
	$m_ba£_numb”
(
ba£_numb”
)

22 ~
	$AsyncReûiv”
()

23 {
	}
}

24 
Upd©e
(
ušt32_t
 
nÙify
, cÚ¡ 
sm¬t_±r
<
AsyncOb£rv”NÙifyP¬am‘”
> &
·¿m
, ušt32_ˆ
f‹r
)

26 
AsyncP¬am‘”
 *
	g·¿m‘”
 = 
dyÇmic_ÿ¡
<AsyncP¬am‘” *>(
·¿m
.
g‘
());

27 ià(
	g·¿m‘”
 !ğ
NULL
)

29 
s_·¿m‘”
.
push_back
(
m_ba£_numb”
 + 
·¿m‘”
->
numb”
);

32 
	g¡d
::
veùÜ
<
ušt32_t
> 
s_·¿m‘”
;

33 
	g´iv©e
:

34 
ušt32_t
 
m_ba£_numb”
;

37 
	g¡d
::
veùÜ
<
ušt32_t
> 
AsyncReûiv”
::
s_·¿m‘”
;

39 
	$TEST
(
AsyncOb£rv”Tim”
, 
P¬am‘”Te¡
)

41 
AsyncSubjeù
 
brßdÿ¡”
;

42 
¡d
::
veùÜ
<
AsyncReûiv”
 *> 
»ûiv”s
;

44 
i
 = 0; i < 100; i++)

46 
AsyncReûiv”
 *
»ûiv”
 = 
Ãw
 
	`AsyncReûiv”
((
ušt32_t
)
i
);

47 
	`EXPECT_NE
((
AsyncReûiv”
 *)
NULL
, 
»ûiv”
);

48 
»ûiv”s
.
	`push_back
(
»ûiv”
);

49 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`A‰achOb£rv”
(
»ûiv”
));

52 
i
 = 0; i < 100; i++)

54 
AsyncP¬am‘”
 *
·¿m‘”
 = 
Ãw
 
	`AsyncP¬am‘”
();

55 
	`EXPECT_NE
((
AsyncP¬am‘”
 *)
NULL
, 
·¿m‘”
);

56 
·¿m‘”
->
numb”
 = (
ušt32_t
)
i
;

57 
brßdÿ¡”
.
	`NÙifyOb£rv”
(0, 
·¿m‘”
);

60 
	`SË•MS
(1000);

62 
	`EXPECT_EQ
((
size_t
)10000, 
AsyncReûiv”
::
s_·¿m‘”
.
	`size
());

63 
size_t
 
i
 = 0; i < 
AsyncReûiv”
::
s_·¿m‘”
.
	`size
(); i++)

65 
	`EXPECT_EQ
((
ušt32_t
)(
i
 / 100è+ (˜% 100), 
AsyncReûiv”
::
s_·¿m‘”
[i]);

68 
¡d
::
veùÜ
<
AsyncReûiv”
 *>::
™”©Ü
 
™
 = 
»ûiv”s
.
	`begš
(); iˆ!ğ»ûiv”s.
	`’d
(); it++)

70 
	`EXPECT_TRUE
(
brßdÿ¡”
.
	`D‘achOb£rv”
((*
™
)));

71 
	`d–‘e
 (*
™
);

73 
»ûiv”s
.
	`ş—r
();

74 
	}
}

	@../thread_object/unittest/directory_monitor_test.cpp

1 
	~"g‹¡/g‹¡.h
"

2 
	~"commÚ/sy¡em.h
"

3 
	~"th»ad_objeù/dœeùÜy_mÚ™Ü.h
"

5 
	~<¡ršg
>

6 
	~<li¡
>

8 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

10 
	$DœeùÜyMÚ™ÜC®lback
(*
·¿m
, 
DœeùÜyMÚ™Ü
::
I‹m
 &
™em
)

12 
™em
.
ty³
)

15 
DœeùÜyMÚ™Ü
::
I‹m
::
eUNKNOWN
:

16 
	`´štf
("[eUNKNOWN][%s]\n", 
™em
.
·thÇme
.
	`c_¡r
());

18 
DœeùÜyMÚ™Ü
::
I‹m
::
eCREATE
:

19 
	`´štf
("[eCREATE][%s]\n", 
™em
.
·thÇme
.
	`c_¡r
());

21 
DœeùÜyMÚ™Ü
::
I‹m
::
eDELETE
:

22 
	`´štf
("[eDELETE][%s]\n", 
™em
.
·thÇme
.
	`c_¡r
());

24 
DœeùÜyMÚ™Ü
::
I‹m
::
eMODIFY
:

25 
	`´štf
("[eMODIFY][%s]\n", 
™em
.
·thÇme
.
	`c_¡r
());

28 
	}
}

30 
	$TEST
(
DœeùÜyMÚ™Ü
, 
MÚ™ÜTe¡
)

32 
DœeùÜyMÚ™Ü
 
dm
;

33 
dm
.
	`S¹
("..", 
DœeùÜyMÚ™ÜC®lback
, 
NULL
, 3000, 
Œue
);

34 
	`SË•MS
(1000);

39 
dm
.
	`Stİ
();

40 
	}
}

	@../thread_object/unittest/main.cpp

1 
	~"g‹¡/g‹¡.h
"

3 
	$maš
(
¬gc
, *
¬gv
[])

5 ::
‹¡šg
::
	`In™GoogËTe¡
(&
¬gc
, 
¬gv
);

6  
	`RUN_ALL_TESTS
();

7 
	}
}

	@../thread_object/unittest/task_pool_test.cpp

1 
	~"commÚ/¡dšt.h
"

3 
	~"g‹¡/g‹¡.h
"

4 
	~"th»ad_objeù/sk_poŞ.h
"

5 
	~"commÚ/sy¡em.h
"

6 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

7 
	~"­r/­r_cÚd.h
"

8 
	~"­r/­r_th»ad.h
"

10 
	~<veùÜ
>

12 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

14 şas 
	cNÚBlockšgTask
: 
public
 
TaskPoŞ
::
TaskObjeù


16 
public
:

17 
NÚBlockšgTask
(
¡d
::
veùÜ
<> &veùÜ, 
num
, 
off£t
)

18 : 
m_veùÜ
(
veùÜ
)

19 , 
m_num
(
num
)

20 , 
	$m_off£t
(
off£t
)

24 
vœtu®
 ~
	$NÚBlockšgTask
()

26 
	}
}

28 
	$AµlySÿË
(
sÿË
)

30 
m_num
 *ğ
sÿË
;

31 
	}
}

33 
vœtu®
 
	$HªdËTask
()

35 
m_num
 +ğ
m_off£t
;

36 
	}
}

38 
vœtu®
 
	$HªdËResuÉ
()

40 
m_veùÜ
.
	`push_back
(
m_num
);

41 
	}
}

43 
	g´iv©e
:

44 
NÚBlockšgTask
();

45 
NÚBlockšgTask
(cÚ¡ NÚBlockšgTask &
rhs
);

46 
	gNÚBlockšgTask
 &
	gİ”©Ü
=(cÚ¡ 
NÚBlockšgTask
 &
rhs
);

48 
	g´Ùeùed
:

49 
¡d
::
veùÜ
<> &
m_veùÜ
;

50 
	gm_num
;

51 
	gm_off£t
;

54 
	$TEST
(
TaskPoŞ
, 
NÚBlockšgTe¡
)

56 
TaskPoŞ
 
poŞ
;

57 
¡d
::
veùÜ
<
ušt32_t
> 
ids
;

58 
¡d
::
veùÜ
<> 
»suÉs
;

59 
i
 = 0; i < 100; i++)

61 
NÚBlockšgTask
 *
sk
 = 
Ãw
 
	`NÚBlockšgTask
(
»suÉs
, 123, 
i
);

62 
	`EXPECT_NE
((
NÚBlockšgTask
 *)
NULL
, 
sk
);

63 ià(
sk
 !ğ
NULL
)

65 
	`EXPECT_TRUE
(
poŞ
.
	`Aµ’dTask
(
sk
));

66 
ids
.
	`push_back
(
sk
->
	`G‘TaskID
());

69 
	`EXPECT_TRUE
(
poŞ
.
	`S¹WÜk
());

70 
	`SË•MS
(1000);

71 
i
 = 0; i < 100; i++)

73 
NÚBlockšgTask
 *
sk
 = 
dyÇmic_ÿ¡
<NÚBlockšgTask *>(
poŞ
.
	`G‘Task
(
ids
[
i
]).
	`g‘
());

74 
	`EXPECT_NE
((
NÚBlockšgTask
 *)
NULL
, 
sk
);

75 ià(
sk
 !ğ
NULL
)

77 
sk
->
	`AµlySÿË
(
i
);

79 
	`EXPECT_TRUE
(
poŞ
.
	`FšishTask
(
ids
[
i
]));

81 
	`SË•MS
(1000);

82 
	`EXPECT_TRUE
(
poŞ
.
	`StİWÜk
());

83 
	`EXPECT_EQ
((
size_t
)100, 
»suÉs
.
	`size
());

84 
i
 = 0; i < 100; i++)

86 
	`EXPECT_EQ
((123 + 
i
è* i, 
»suÉs
[i]);

88 
i
 = 0; i < 100; i++)

90 
	`EXPECT_FALSE
(
poŞ
.
	`RemoveTask
(
ids
[
i
]));

92 
ids
.
	`ş—r
();

93 
i
 = 0; i < 100; i++)

95 
NÚBlockšgTask
 *
sk
 = 
Ãw
 
	`NÚBlockšgTask
(
»suÉs
, 123, 
i
);

96 
	`EXPECT_NE
((
NÚBlockšgTask
 *)
NULL
, 
sk
);

97 ià(
sk
 !ğ
NULL
)

99 
	`EXPECT_TRUE
(
poŞ
.
	`Aµ’dTask
(
sk
));

100 
ids
.
	`push_back
(
sk
->
	`G‘TaskID
());

103 
i
 = 0; i < 100; i++)

105 
	`EXPECT_TRUE
(
poŞ
.
	`RemoveTask
(
ids
[
i
]));

107 
ids
.
	`ş—r
();

108 
	}
}

110 şas 
	cBlockšgTask
: 
public
 
TaskPoŞ
::
TaskObjeù


112 
public
:

113 
	$BlockšgTask
(
num
, 
off£t
)

114 : 
	`m_num
(
num
)

115 , 
	`m_off£t
(
off£t
)

116 , 
	$m_cd_fšish
(
Œue
)

120 
vœtu®
 ~
	$BlockšgTask
()

122 
	}
}

124 
	$AµlySÿË
(
sÿË
)

126 
m_num
 *ğ
sÿË
;

127 
	}
}

129 
vœtu®
 
	$HªdËTask
()

131 
m_num
 +ğ
m_off£t
;

132 
	}
}

134 
vœtu®
 
	$HªdËResuÉ
()

136 
m_cd_fšish
.
	`£t
();

137 
	}
}

139 
boŞ
 
	$Wa™ResuÉ
(
št32_t
 
ms
)

141  
m_cd_fšish
.
	`timedwa™
(
ms
);

142 
	}
}

144 
	$G‘ResuÉ
()

146  
m_num
;

147 
	}
}

149 
	g´iv©e
:

150 
BlockšgTask
();

151 
BlockšgTask
(cÚ¡ BlockšgTask &
rhs
);

152 
	gBlockšgTask
 &
	gİ”©Ü
=(cÚ¡ 
BlockšgTask
 &
rhs
);

154 
	g´Ùeùed
:

155 
m_num
;

156 
	gm_off£t
;

157 
A´CÚd
 
	gm_cd_fšish
;

160 şas 
	cBlockšgTh»ad
: 
public
 
A´Th»ad


162 
public
:

163 
BlockšgTh»ad
(
TaskPoŞ
 &
poŞ
, 
Cr™iÿlSeùiÚ
 &
cs
, 
¡d
::
veùÜ
<> &veùÜ, 
num
, 
off£t
)

164 : 
m_poŞ
(
poŞ
)

165 , 
m_sk
(
Ãw
 
BlockšgTask
(
m_num
, 
m_off£t
))

166 , 
m_cs
(
cs
)

167 , 
m_veùÜ
(
veùÜ
)

168 , 
m_num
(
num
)

169 , 
	$m_off£t
(
off£t
)

173 ~
	$BlockšgTh»ad
()

175 
	}
}

177 
vœtu®
 
	$run
()

179 
	`EXPECT_NE
((
TaskPoŞ
::
TaskObjeù
 *)
NULL
, 
m_sk
.
	`g‘
());

180 
	`EXPECT_TRUE
(
m_poŞ
.
	`Aµ’dTask
(
m_sk
));

181 
BlockšgTask
 *
p
 = 
dyÇmic_ÿ¡
<BlockšgTask *>(
m_sk
.
	`g‘
());

182 
	`EXPECT_NE
((
BlockšgTask
 *)
NULL
, 
p
);

183 
	`EXPECT_TRUE
(
p
->
	`Wa™ResuÉ
(5000));

184 
Cr™iÿlSeùiÚLock
 
	`_l
(&
m_cs
);

185 
m_veùÜ
.
	`push_back
(
p
->
	`G‘ResuÉ
());

186 
m_sk
 = 
NULL
;

187 
	}
}

189 
	gsm¬t_±r
<
	gTaskPoŞ
::
TaskObjeù
> &
	$G‘Task
()

191  
m_sk
;

192 
	}
}

194 
	g´iv©e
:

195 
BlockšgTh»ad
();

196 
BlockšgTh»ad
(cÚ¡ BlockšgTh»ad &
rhs
);

197 
	gBlockšgTh»ad
 &
	gİ”©Ü
=(cÚ¡ 
BlockšgTh»ad
 &
rhs
);

199 
	g´iv©e
:

200 
TaskPoŞ
 &
m_poŞ
;

201 
	gsm¬t_±r
<
	gTaskPoŞ
::
TaskObjeù
> 
m_sk
;

202 
	gCr™iÿlSeùiÚ
 &
	gm_cs
;

203 
	g¡d
::
veùÜ
<> &
m_veùÜ
;

204 
	gm_num
;

205 
	gm_off£t
;

208 
	$TEST
(
TaskPoŞ
, 
BlockšgTe¡
)

210 
TaskPoŞ
 
poŞ
;

211 
Cr™iÿlSeùiÚ
 
cs
;

212 
¡d
::
veùÜ
<
ušt32_t
> 
ids
;

213 
¡d
::
veùÜ
<> 
»suÉs
;

214 
¡d
::
veùÜ
<
BlockšgTh»ad
 *> 
th»ads
;

215 
	`EXPECT_TRUE
(
poŞ
.
	`S¹WÜk
());

216 
i
 = 0; i < 100; i++)

218 
BlockšgTh»ad
 *
th»ad
 = 
Ãw
 
	`BlockšgTh»ad
(
poŞ
, 
cs
, 
»suÉs
, 123, 
i
);

219 
	`EXPECT_NE
((
BlockšgTh»ad
 *)
NULL
, 
th»ad
);

220 ià(
th»ad
 !ğ
NULL
)

222 
	`EXPECT_TRUE
(
th»ad
->
	`¡¬t
());

223 
sm¬t_±r
<
TaskPoŞ
::
TaskObjeù
> &
sk
 = 
th»ad
->
	`G‘Task
();

224 
	`EXPECT_NE
((
TaskPoŞ
::
TaskObjeù
 *)
NULL
, 
sk
.
	`g‘
());

225 ià(
sk
.
	`g‘
(è!ğ
NULL
)

227 
ids
.
	`push_back
(
sk
.
	`g‘
()->
	`G‘TaskID
());

229 
th»ads
.
	`push_back
(
th»ad
);

232 
	`SË•MS
(1000);

233 
i
 = 0; i < 100; i++)

235 
sm¬t_±r
<
TaskPoŞ
::
TaskObjeù
> 
sk
 = 
poŞ
.
	`G‘Task
(
ids
[
i
]);

236 
BlockšgTask
 *
p
 = 
dyÇmic_ÿ¡
<BlockšgTask *>(
sk
.
	`g‘
());

237 
	`EXPECT_NE
((
BlockšgTask
 *)
NULL
, 
p
);

238 ià(
p
 !ğ
NULL
)

240 
p
->
	`AµlySÿË
(
i
);

242 
	`EXPECT_TRUE
(
poŞ
.
	`FšishTask
(
ids
[
i
]));

244 
	`SË•MS
(1000);

245 
	`EXPECT_TRUE
(
poŞ
.
	`StİWÜk
());

246 
	`EXPECT_EQ
((
size_t
)100, 
»suÉs
.
	`size
());

252 
i
 = 0; i < 100; i++)

254 
	`EXPECT_FALSE
(
poŞ
.
	`RemoveTask
(
ids
[
i
]));

256 
ids
.
	`ş—r
();

257 
i
 = 0; i < 100; i++)

259 
d–‘e
 
th»ads
[
i
];

261 
th»ads
.
	`ş—r
();

262 
	}
}

	@../thread_object/unittest/task_queue_test.cpp

1 
	~"commÚ/¡dšt.h
"

3 
	~"g‹¡/g‹¡.h
"

4 
	~"th»ad_objeù/sk_queue.h
"

6 
	~"commÚ/sy¡em.h
"

8 
	~<li¡
>

10 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

12 şas 
	cTaskLi¡PushBack
: 
public
 
TaskQueue
::
TaskObjeù


14 
public
:

15 
TaskLi¡PushBack
(
¡d
::
li¡
<
ušt32_t
> &list)

16 : 
	$m_li¡
(
li¡
)

20 ~
	$TaskLi¡PushBack
()

22 
	}
}

24 
	$HªdËTask
()

26 
m_li¡
.
	`push_back
(
	`G‘TaskID
());

27 
	}
}

29 
	g´iv©e
:

30 
¡d
::
li¡
<
ušt32_t
> &
m_li¡
;

33 
	$TEST
(
TaskQueue
, 
Aµ’dRemoveTe¡
)

35 
¡d
::
li¡
<
ušt32_t
> 
li¡_id
;

36 
¡d
::
li¡
<
ušt32_t
> 
li¡_sk
;

37 
TaskQueue
 
queue
;

39 
i
 = 0; i < 10; i++)

41 
sm¬t_±r
<
TaskQueue
::
TaskObjeù
> 
sk
 = 
Ãw
 
	`TaskLi¡PushBack
(
li¡_sk
);

42 
	`EXPECT_NE
((
TaskQueue
::
TaskObjeù
 *)
NULL
, 
sk
.
	`g‘
());

43 
ušt32_t
 
id
 = 
sk
.
	`g‘
()->
	`G‘TaskID
();

44 
	`EXPECT_FALSE
(
queue
.
	`RemoveTask
(
id
));

45 
	`EXPECT_TRUE
(
queue
.
	`Aµ’dTask
(
sk
));

46 
li¡_id
.
	`push_back
(
id
);

49 
	`EXPECT_EQ
(
Œue
, 
queue
.
	`S¹WÜk
());

51 
i
 = 0; i < 10; i++)

53 
sm¬t_±r
<
TaskQueue
::
TaskObjeù
> 
sk
 = 
Ãw
 
	`TaskLi¡PushBack
(
li¡_sk
);

54 
	`EXPECT_NE
((
TaskQueue
::
TaskObjeù
 *)
NULL
, 
sk
.
	`g‘
());

55 
ušt32_t
 
id
 = 
sk
.
	`g‘
()->
	`G‘TaskID
();

56 
	`EXPECT_FALSE
(
queue
.
	`RemoveTask
(
id
));

57 
	`EXPECT_TRUE
(
queue
.
	`Aµ’dTask
(
sk
));

58 
li¡_id
.
	`push_back
(
id
);

61 
	`SË•MS
(1000);

63 
queue
.
	`StİWÜk
();

65 
	`EXPECT_EQ
(
li¡_id
.
	`size
(), 
li¡_sk
.size());

67 
¡d
::
li¡
<
ušt32_t
>::
™”©Ü
 
™_id
 = 
li¡_id
.
	`begš
();

68 
¡d
::
li¡
<
ušt32_t
>::
™”©Ü
 
™_sk
 = 
li¡_sk
.
	`begš
();

69 
™_id
 !ğ
li¡_id
.
	`’d
(è&& 
™_sk
 !ğ
li¡_sk
.end())

71 
	`EXPECT_FALSE
(
queue
.
	`RemoveTask
(*
™_id
));

72 
	`EXPECT_FALSE
(
queue
.
	`RemoveTask
(*
™_sk
));

73 
	`EXPECT_EQ
((*
™_id
++), (*
™_sk
++));

76 
i
 = 0; i < 10; i++)

78 
sm¬t_±r
<
TaskQueue
::
TaskObjeù
> 
sk
 = 
Ãw
 
	`TaskLi¡PushBack
(
li¡_sk
);

79 
	`EXPECT_NE
((
TaskQueue
::
TaskObjeù
 *)
NULL
, 
sk
.
	`g‘
());

80 
ušt32_t
 
id
 = 
sk
.
	`g‘
()->
	`G‘TaskID
();

81 
	`EXPECT_FALSE
(
queue
.
	`RemoveTask
(
id
));

82 
	`EXPECT_TRUE
(
queue
.
	`Aµ’dTask
(
sk
));

83 
	`EXPECT_TRUE
(
queue
.
	`RemoveTask
(
id
));

86 
	}
}

	@../visibility.h

1 #iâdeà
__VISIBILITY_H__


2 
	#__VISIBILITY_H__


	)

5 #ià
defšed
 
_WIN32
 || defšed 
__CYGWIN__


6 #ifdeà
BUILDING_LIB


7 
	#DLL_PUBLIC


	)

9 #ifdeà
BUILDING_DLL


10 #ifdeà
__GNUC__


11 
	#DLL_PUBLIC
 
	`__©Œibu‹__
 ((
dÎexpÜt
))

	)

13 
	#DLL_PUBLIC
 
	`__deş¥ec
(
dÎexpÜt
)

15 #–£

	)

16 #ifdeà
__GNUC__


17 
	#DLL_PUBLIC
 
	`__©Œibu‹__
 ((
dÎimpÜt
))

	)

19 
	#DLL_PUBLIC
 
	`__deş¥ec
(
dÎimpÜt
)

22 
	#DLL_LOCAL


	)

25 #ià
__GNUC__
 >= 4

26 
	#DLL_PUBLIC
 
	`__©Œibu‹__
 ((
	`visib™y
 ("deçuÉ")))

	)

27 
	#DLL_LOCAL
 
	`__©Œibu‹__
 ((
	`visib™y
 ("hidd’")))

	)

29 
	#DLL_PUBLIC


	)

30 
	#DLL_LOCAL


	)

34 #ifdeà
__ılu¥lus


35 
	#EXPORT_AS_C
 "C"

	)

37 
	#EXPORT_AS_C


	)

	@../vmbackdoor/backdoor_def.h

42 #iâdeà
_BACKDOOR_DEF_H_


43 
	#_BACKDOOR_DEF_H_


	)

45 
	#INCLUDE_ALLOW_MODULE


	)

46 
	#INCLUDE_ALLOW_USERLEVEL


	)

48 
	#INCLUDE_ALLOW_VMCORE


	)

49 
	#INCLUDE_ALLOW_VMKERNEL


	)

57 
	#BDOOR_MAGIC
 0x564D5868

	)

61 
	#BDOOR_PORT
 0x5658

	)

63 
	#BDOOR_CMD_GETMHZ
 1

	)

76 
	#BDOOR_CMD_APMFUNCTION
 2

	)

77 
	#BDOOR_CMD_GETDISKGEO
 3

	)

78 
	#BDOOR_CMD_GETPTRLOCATION
 4

	)

79 
	#BDOOR_CMD_SETPTRLOCATION
 5

	)

80 
	#BDOOR_CMD_GETSELLENGTH
 6

	)

81 
	#BDOOR_CMD_GETNEXTPIECE
 7

	)

82 
	#BDOOR_CMD_SETSELLENGTH
 8

	)

83 
	#BDOOR_CMD_SETNEXTPIECE
 9

	)

84 
	#BDOOR_CMD_GETVERSION
 10

	)

85 
	#BDOOR_CMD_GETDEVICELISTELEMENT
 11

	)

86 
	#BDOOR_CMD_TOGGLEDEVICE
 12

	)

87 
	#BDOOR_CMD_GETGUIOPTIONS
 13

	)

88 
	#BDOOR_CMD_SETGUIOPTIONS
 14

	)

89 
	#BDOOR_CMD_GETSCREENSIZE
 15

	)

90 
	#BDOOR_CMD_MONITOR_CONTROL
 16

	)

91 
	#BDOOR_CMD_GETHWVERSION
 17

	)

92 
	#BDOOR_CMD_OSNOTFOUND
 18

	)

93 
	#BDOOR_CMD_GETUUID
 19

	)

94 
	#BDOOR_CMD_GETMEMSIZE
 20

	)

95 
	#BDOOR_CMD_HOSTCOPY
 21

	)

97 
	#BDOOR_CMD_GETTIME
 23

	)

98 
	#BDOOR_CMD_STOPCATCHUP
 24

	)

99 
	#BDOOR_CMD_PUTCHR
 25

	)

100 
	#BDOOR_CMD_ENABLE_MSG
 26

	)

101 
	#BDOOR_CMD_GOTO_TCL
 27

	)

102 
	#BDOOR_CMD_INITPCIOPROM
 28

	)

104 
	#BDOOR_CMD_MESSAGE
 30

	)

105 
	#BDOOR_CMD_SIDT
 31

	)

106 
	#BDOOR_CMD_SGDT
 32

	)

107 
	#BDOOR_CMD_SLDT_STR
 33

	)

108 
	#BDOOR_CMD_ISACPIDISABLED
 34

	)

110 
	#BDOOR_CMD_ISMOUSEABSOLUTE
 36

	)

111 
	#BDOOR_CMD_PATCH_SMBIOS_STRUCTS
 37

	)

112 
	#BDOOR_CMD_MAPMEM
 38

	)

113 
	#BDOOR_CMD_ABSPOINTER_DATA
 39

	)

114 
	#BDOOR_CMD_ABSPOINTER_STATUS
 40

	)

115 
	#BDOOR_CMD_ABSPOINTER_COMMAND
 41

	)

117 
	#BDOOR_CMD_PATCH_ACPI_TABLES
 43

	)

119 
	#BDOOR_CMD_GETHZ
 45

	)

120 
	#BDOOR_CMD_GETTIMEFULL
 46

	)

121 
	#BDOOR_CMD_STATELOGGER
 47

	)

122 
	#BDOOR_CMD_CHECKFORCEBIOSSETUP
 48

	)

123 
	#BDOOR_CMD_LAZYTIMEREMULATION
 49

	)

124 
	#BDOOR_CMD_BIOSBBS
 50

	)

126 
	#BDOOR_CMD_ISGOSDARWIN
 52

	)

127 
	#BDOOR_CMD_DEBUGEVENT
 53

	)

128 
	#BDOOR_CMD_OSNOTMACOSXSERVER
 54

	)

129 
	#BDOOR_CMD_GETTIMEFULL_WITH_LAG
 55

	)

130 
	#BDOOR_CMD_ACPI_HOTPLUG_DEVICE
 56

	)

131 
	#BDOOR_CMD_ACPI_HOTPLUG_MEMORY
 57

	)

132 
	#BDOOR_CMD_ACPI_HOTPLUG_CBRET
 58

	)

134 
	#BDOOR_CMD_ACPI_HOTPLUG_CPU
 60

	)

136 
	#BDOOR_CMD_XPMODE
 62

	)

137 
	#BDOOR_CMD_NESTING_CONTROL
 63

	)

138 
	#BDOOR_CMD_FIRMWARE_INIT
 64

	)

139 
	#BDOOR_CMD_FIRMWARE_ACPI_SERVICES
 65

	)

140 
	#BDOOR_CMD_FAS_GET_TABLE_SIZE
 0

	)

141 
	#BDOOR_CMD_FAS_GET_TABLE_DATA
 1

	)

142 
	#BDOOR_CMD_FAS_GET_PLATFORM_NAME
 2

	)

143 
	#BDOOR_CMD_FAS_GET_PCIE_OSC_MASK
 3

	)

144 
	#BDOOR_CMD_FAS_GET_APIC_ROUTING
 4

	)

145 
	#BDOOR_CMD_FAS_GET_TABLE_SKIP
 5

	)

146 
	#BDOOR_CMD_FAS_GET_SLEEP_ENABLES
 6

	)

147 
	#BDOOR_CMD_SENDPSHAREHINTS
 66

	)

148 
	#BDOOR_CMD_ENABLE_USB_MOUSE
 67

	)

149 
	#BDOOR_CMD_GET_VCPU_INFO
 68

	)

150 
	#BDOOR_CMD_VCPU_SLC64
 0

	)

151 
	#BDOOR_CMD_VCPU_SYNC_VTSCS
 1

	)

152 
	#BDOOR_CMD_VCPU_HV_REPLAY_OK
 2

	)

153 
	#BDOOR_CMD_VCPU_RESERVED
 31

	)

154 
	#BDOOR_CMD_EFI_SERIALCON_CONFIG
 69

	)

155 
	#BDOOR_CMD_BUG328986
 70

	)

156 
	#BDOOR_CMD_FIRMWARE_ERROR
 71

	)

157 
	#BDOOR_CMD_FE_INSUFFICIENT_MEM
 0

	)

158 
	#BDOOR_CMD_FE_EXCEPTION
 1

	)

159 
	#BDOOR_CMD_VMK_INFO
 72

	)

160 
	#BDOOR_CMD_EFI_BOOT_CONFIG
 73

	)

161 
	#BDOOR_CMD_EBC_LEGACYBOOT_ENABLED
 0

	)

162 
	#BDOOR_CMD_EBC_GET_ORDER
 1

	)

163 
	#BDOOR_CMD_EBC_SHELL_ACTIVE
 2

	)

164 
	#BDOOR_CMD_GET_HW_MODEL
 74

	)

165 
	#BDOOR_CMD_GET_SVGA_CAPABILITIES
 75

	)

166 
	#BDOOR_CMD_GET_FORCE_X2APIC
 76

	)

167 
	#BDOOR_CMD_SET_PCI_HOLE
 77

	)

168 
	#BDOOR_CMD_GET_PCI_HOLE
 78

	)

169 
	#BDOOR_CMD_GET_PCI_BAR
 79

	)

170 
	#BDOOR_CMD_SHOULD_GENERATE_SYSTEMID
 80

	)

171 
	#BDOOR_CMD_MAX
 81

	)

182 
	#BDOOR_PSHARE_HINTS_ASYNC
 0

	)

183 
	#BDOOR_PSHARE_HINTS_SYNC
 1

	)

185 
	#BDOOR_PSHARE_HINTS_TYPE
(
ecx
è((Ócxè>> 16è& 0x1)

	)

188 
	#BDOOR_PSHARE_HINTS_VERSION
 1

	)

189 
	#BDOOR_PSHARE_HINTS_VER
(
ecx
è((Ócxè>> 17è& 0x7f)

	)

192 
	#BDOOR_PSHARE_HINTS_CMD_SHARE
 0

	)

193 
	#BDOOR_PSHARE_HINTS_CMD_DROP
 1

	)

194 
	#BDOOR_PSHARE_HINTS_CMD_MAX
 2

	)

196 
	#BDOOR_PSHARE_HINTS_CMD
(
ecx
è((Ócxè>> 24è& 0xff)

	)

200 
	#NESTING_CONTROL_RESTRICT_BACKDOOR
 0

	)

201 
	#NESTING_CONTROL_OPEN_BACKDOOR
 1

	)

202 
	#NESTING_CONTROL_QUERY
 2

	)

203 
	#NESTING_CONTROL_MAX
 2

	)

206 
	#EFI_BOOT_ORDER_TYPE_EFI
 0x0

	)

207 
	#EFI_BOOT_ORDER_TYPE_LEGACY
 0x1

	)

208 
	#EFI_BOOT_ORDER_TYPE_NONE
 0xf

	)

212 
	#BDOORHB_PORT
 0x5659

	)

214 
	#BDOORHB_CMD_MESSAGE
 0

	)

215 
	#BDOORHB_CMD_VASSERT
 1

	)

216 
	#BDOORHB_CMD_MAX
 2

	)

224 
	#BDOOR_PMC_HW_TSC
 0x10000

	)

225 
	#BDOOR_PMC_REAL_NS
 0x10001

	)

226 
	#BDOOR_PMC_APPARENT_NS
 0x10002

	)

227 
	#BDOOR_PMC_PSEUDO_TSC
 0x10003

	)

229 
	#IS_BDOOR_PMC
(
šdex
è(((šdexè| 3è=ğ0x10003)

	)

230 
	#BDOOR_CMD
(
ecx
è(Ócxè& 0xffff)

	)

233 
	#BDOOR_CMD_VMK_INFO_ENTRY
 1

	)

235 #ifdeà
VMM


251 
INLINE
 
BoŞ


252 
	$BackdoÜ_CmdRequœesFuÎyV®idVCPU
(
cmd
)

254  
cmd
 =ğ
BDOOR_CMD_SIDT
 ||

255 
cmd
 =ğ
BDOOR_CMD_SGDT
 ||

256 
cmd
 =ğ
BDOOR_CMD_SLDT_STR
;

257 
	}
}

	@../vmbackdoor/vmbackdoor.cpp

3 
	~"backdoÜ_def.h
"

4 
	~"vmbackdoÜ.h
"

5 
	~"commÚ/fe.h
"

6 
	~"commÚ/h¬dw¬e.h
"

7 
	~"sûw/xml_Œ“.h
"

12 
usšg
 
Çme¥aû
 
	g¡d
;

13 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

15 
	#VMWARE_MANUAL_MAC
 "00:50:56"

	)

16 
	#VMWARE_AUTO_MAC
 "00:0C:29"

	)

18 
	$VMBackdoÜG‘Ho¡
()

20 
XMLT»e
 
Œ“
;

21 ià(!
SYSUTILS_SPACE
::
	`LßdXMLT»e
("/v¬/nuuo/.vm_šfo", 
Œ“
)) {

22  
VMX_TYPE_UNSET
;

25 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "vm_info") {

26  
VMX_TYPE_UNSET
;

29 
XMLEËm’t
 
–em
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("hostType");

30  
	`¡r_to_u32
(
–em
.
	`G‘CÚ‹Á
());

31 
	}
}

33 
	$VMBackdoÜG‘BIOSUUID
(
¡ršg
 &
¡rUUID
)

35 
XMLT»e
 
Œ“
;

37 
¡rUUID
 = "";

39 ià(!
SYSUTILS_SPACE
::
	`LßdXMLT»e
("/v¬/nuuo/.vm_šfo", 
Œ“
)) {

43 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "vm_info") {

47 
XMLEËm’t
 
–em
 = 
Œ“
.
	`G‘RoÙ
().
	`G‘Chd
("uuid");

48 
¡rUUID
 = 
–em
.
	`G‘CÚ‹Á
();

49 
	}
}

52 
	$VMBackdoÜ_hªdËr
(
sig
)

54 
	`lÚgjmp
(
jmpBuf
, 1);

55 
	}
}

57 
boŞ
 
	$VMBackdoÜIsVœtu®WÜld
(*
v”siÚ
)

59 
—x
, 
ebx
, 
ecx
, 
edx
;

61 
s_SIGSEGV_hªdËr
 = 
	`sigÇl
(
SIGSEGV
, 
VMBackdoÜ_hªdËr
);

63 ià(!
	`£tjmp
(
jmpBuf
)) {

64 
__asm__
 volatile("inl (%%dx)" :

65 "÷"(
—x
), "=c"(
ecx
), "=d"(
edx
), "=b"(
ebx
) :

66 "0"(
BDOOR_MAGIC
), "1"(
BDOOR_CMD_GETVERSION
),

67 "2"(
BDOOR_PORT
) : "memory");

69 
v”siÚ
[0] = 
—x
;

70 
v”siÚ
[1] = 
ebx
;

71 
v”siÚ
[2] = 
ecx
;

73 
	`sigÇl
(
SIGSEGV
, 
s_SIGSEGV_hªdËr
);

74  
çl£
;

77 ià(
v”siÚ
[1] !ğ
BDOOR_MAGIC
) {

82 
	`sigÇl
(
SIGSEGV
, 
s_SIGSEGV_hªdËr
);

83  
çl£
;

86 
	`sigÇl
(
SIGSEGV
, 
s_SIGSEGV_hªdËr
);

87  
Œue
;

88 
	}
}

91 
boŞ
 
	$VMBackdoÜIsVœtu®WÜld
()

93 
XMLT»e
 
Œ“
;

94 ià(!
SYSUTILS_SPACE
::
	`LßdXMLT»e
("/v¬/nuuo/.vm_šfo", 
Œ“
)) {

95  
çl£
;

98 ià(
Œ“
.
	`G‘RoÙ
().
	`G‘Name
() != "vm_info") {

99  
çl£
;

102  
Œue
;

103 
	}
}

105 
boŞ
 
	$VMBackdoÜIsV®idVMMac
()

107 
veùÜ
<
N‘wÜkAd­‹rInfo
> 
šfos
;

109 
	`G‘N‘wÜkAd­‹rs
(
šfos
);

111 
size_t
 
i
 = 0; i < 
šfos
.
	`size
(); i++) {

112 
¡ršg
 
¡rMac
 = 
	`¡ršg_fÜm©
("%02X:%02X:%02X",

113 
šfos
[
i
].
mac
[0],

114 
šfos
[
i
].
mac
[1],

115 
šfos
[
i
].
mac
[2]

117 ià(
¡rMac
 !ğ
VMWARE_MANUAL_MAC
 && sŒMaø!ğ
VMWARE_AUTO_MAC
)

118  
çl£
;

121  
Œue
;

122 
	}
}

124 
boŞ
 
	$g‘Ho¡Ty³
Ğ
VMX_Ty³
 &
ty³
)

126 ià(
	`VMBackdoÜIsVœtu®WÜld
()) {

127 
ho¡Ty³
 = 
	`VMBackdoÜG‘Ho¡
();

128 
ho¡Ty³
) {

129 
VMX_TYPE_EXPRESS
:

130 
VMX_TYPE_WGS
:

131 
VMX_TYPE_WORKSTATION
:

132 
VMX_TYPE_WORKSTATION_ENTERPRISE
:

133 
VMX_TYPE_SCALABLE_SERVER
:

134 
ty³
 = (
VMX_Ty³
)
ho¡Ty³
;

138  
çl£
;

141  
çl£
;

144  
Œue
;

145 
	}
}

147 
fšg”PrštR‘uºTy³
 
	$g‘Fšg”Pršt
(
¡ršg
 &
¡rFšg”Pršt
)

149 
veùÜ
<
N‘wÜkAd­‹rInfo
> 
šfos
;

151 
¡rFšg”Pršt
 = "";

153 ià(
	`VMBackdoÜIsVœtu®WÜld
()) {

154 
ho¡Ty³
 = 
	`VMBackdoÜG‘Ho¡
();

156 
ho¡Ty³
) {

157 
VMX_TYPE_EXPRESS
:

158 
VMX_TYPE_WGS
:

159 
VMX_TYPE_WORKSTATION
:

160  
FINGERPRINT_INVALID_VM_HOST
;

162 
VMX_TYPE_SCALABLE_SERVER
:

166  
FINGERPRINT_INVALID_VM_HOST
;

169 ià(!
	`VMBackdoÜIsV®idVMMac
())

170  
FINGERPRINT_INVALID_MAC
;

172 
	`VMBackdoÜG‘BIOSUUID
(
¡rFšg”Pršt
);

173 ià(
¡rFšg”Pršt
.
	`em±y
())

174  
FINGERPRINT_INVALID_VM_HOST
;

177 
	`G‘N‘wÜkAd­‹rs
(
šfos
);

178 ià(
šfos
.
	`em±y
()) {

179 
¡rFšg”Pršt
 = "";

180  
FINGERPRINT_INVALID_NO_NIC
;

183 
¡rFšg”Pršt
 +ğ
	`¡ršg_fÜm©
("%02X%02X%02X%02X%02X%02X",

184 
šfos
[0].
mac
[0],

185 
šfos
[0].
mac
[1],

186 
šfos
[0].
mac
[2],

187 
šfos
[0].
mac
[3],

188 
šfos
[0].
mac
[4],

189 
šfos
[0].
mac
[5]

192  
FINGERPRINT_VALID
;

193 
	}
}

	@../vmbackdoor/vmbackdoor.h

1 #iâdeà
__VM_BACKDOOR_H__


2 
	#__VM_BACKDOOR_H__


	)

4 
	~"commÚ/¡ršg.h
"

7 
	mVMX_TYPE_UNSET
,

8 
	mVMX_TYPE_EXPRESS
,

9 
	mVMX_TYPE_SCALABLE_SERVER
,

10 
	mVMX_TYPE_WGS
,

11 
	mVMX_TYPE_WORKSTATION
,

12 
	mVMX_TYPE_WORKSTATION_ENTERPRISE


13 } 
	tVMX_Ty³
;

16 
	mFINGERPRINT_VALID
,

17 
	mFINGERPRINT_INVALID_NO_NIC
,

18 
	mFINGERPRINT_INVALID_MAC
,

19 
	mFINGERPRINT_INVALID_VM_HOST
,

20 } 
	tfšg”PrštR‘uºTy³
;

22 
boŞ
 
VMBackdoÜIsVœtu®WÜld
();

23 
VMBackdoÜG‘Ho¡
();

24 
VMBackdoÜG‘BIOSUUID
(
¡d
::
¡ršg
 &
¡rUUID
);

25 
boŞ
 
VMBackdoÜIsV®idVMMac
();

26 
boŞ
 
g‘Ho¡Ty³
(
VMX_Ty³
 &
ty³
);

27 
fšg”PrštR‘uºTy³
 
g‘Fšg”Pršt
(
¡d
::
¡ršg
 &
¡rFšg”Pršt
);

	@FilesystemManager.cpp

1 
	~"Fesy¡emMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/fe.h
"

5 
	~"commÚ/nusy¦og.h
"

6 
	~"commÚ/¡ršg.h
"

7 
	~"commÚ/sy¡em.h
"

9 
	~"‹¡_uts.h
"

12 
	~<®gÜ™hm
>

13 
	~<sys/mouÁ.h
>

14 
	~<sys/¡©.h
>

15 
	~<”ºo.h
>

17 
	#LOG_LABEL
 "FSMªag”"

	)

19 
	gFesy¡emMªag”
::
	$Fesy¡emMªag”
(cÚ¡ 
¡ršg
& 
dev
)

20 : 
	`m_¡rMouÁPošt
("")

21 , 
	`m_¡rDevNode
(
dev
)

22 , 
	`m_¡rUUID
("")

23 , 
	`m_¡rFSTy³
("")

24 , 
	`m_iVŞumeNum
(-1)

25 , 
	`m_iFÜm©šgS‹
(
WRITE_INODE_TABLES_UNKNOWN
)

26 , 
	`m_iFÜm©Prog»ss
(0)

27 , 
	`m_bFÜm©
(
çl£
)

28 , 
	`m_bMouÁ
(
çl£
)

29 , 
	$m_bIn™Ÿlized
(
çl£
)

31 
	`In™Ÿlize
();

32 
	}
}

34 
	gFesy¡emMªag”
::
	$Fesy¡emMªag”
()

35 : 
	`m_¡rMouÁPošt
("")

36 , 
	`m_¡rDevNode
("")

37 , 
	`m_¡rUUID
("")

38 , 
	`m_¡rFSTy³
("")

39 , 
	`m_iVŞumeNum
(-1)

40 , 
	`m_iFÜm©šgS‹
(
WRITE_INODE_TABLES_UNKNOWN
)

41 , 
	`m_iFÜm©Prog»ss
(0)

42 , 
	`m_bFÜm©
(
çl£
)

43 , 
	`m_bMouÁ
(
çl£
)

44 , 
	$m_bIn™Ÿlized
(
çl£
)

46 
	}
}

48 
	gFesy¡emMªag”
::~
	$Fesy¡emMªag”
()

50 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csIn™Ÿlized
);

51 
m_bIn™Ÿlized
 = 
çl£
;

52 
	}
}

54 
boŞ
 
	gFesy¡emMªag”
::
	$S‘DeviûNode
(cÚ¡ 
¡ršg
 &
dev
)

56 
m_¡rDevNode
 = 
dev
;

57  
	`In™Ÿlize
();

58 
	}
}

60 
boŞ
 
	gFesy¡emMªag”
::
	$In™Ÿlize
()

62 ià(
m_¡rDevNode
.
	`em±y
()) {

63 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

65  
çl£
;

68 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

69 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

71 
m_¡rDevNode
.
	`c_¡r
());

72  
çl£
;

75 ià(
	`blkid
() != 0) {

76 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

78 
m_¡rDevNode
.
	`c_¡r
());

79  
çl£
;

82 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csIn™Ÿlized
);

83 
m_bIn™Ÿlized
 = 
Œue
;

84  
Œue
;

85 
	}
}

87 
boŞ
 
	gFesy¡emMªag”
::
	$IsIn™Ÿlized
()

89 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csIn™Ÿlized
);

90  
m_bIn™Ÿlized
;

91 
	}
}

93 
	gFesy¡emMªag”
::
	$S‘MouÁPošt
(cÚ¡ 
¡ršg
 &
mouÁpošt
)

95 
m_¡rMouÁPošt
 = 
mouÁpošt
;

96 
	}
}

98 #ifdeà
NUUO


99 
	gFesy¡emMªag”
::
	$Th»adProc
()

101 
	`FÜm©
();

112 
	}
}

115 
boŞ
 
	gFesy¡emMªag”
::
	$FÜm©
(
boŞ
 
fÜû
)

117 
»t
 = 0;

119 ià(
m_¡rDevNode
.
	`em±y
()) {

120 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

122  
çl£
;

125 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csFÜm©
);

127 ià(
m_bFÜm©
 && !
fÜû
)

128 
fÜm©_dÚe
;

130 
	`In™ŸlizeMke2fsHªdË
();

131 
»t
 = 
	`mke2fs
(&
m_mkfsHªdË
);

132 ià(0 !ğ
»t
) {

133 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

134 "FaØfÜm© % [%d]\n", 
m_¡rDevNode
.
	`c_¡r
(), 
»t
);

135  
çl£
;

138 
fÜm©_dÚe
:

139 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

140 "FÜm© % sucûssfuÎy.\n", 
m_¡rDevNode
.
	`c_¡r
());

141  
Œue
;

142 
	}
}

144 
boŞ
 
	gFesy¡emMªag”
::
	$MouÁ
()

146  
	`MouÁ
(
m_¡rMouÁPošt
);

147 
	}
}

149 
boŞ
 
	gFesy¡emMªag”
::
	$MouÁ
(cÚ¡ 
¡ršg
& 
¡rMouÁPošt
)

151 
¡ršg
 
¡rE¼ÜLog
;

153 ià(
¡rMouÁPošt
.
	`em±y
()) {

154 
¡rE¼ÜLog
 = "Invalid mount…oint.";

155 
mouÁ_check_”r
;

158 ià(
m_¡rDevNode
.
	`em±y
()) {

159 
¡rE¼ÜLog
 = "Invalid device.";

160 
mouÁ_check_”r
;

163 
m_csFÜm©
.
	`Lock
();

164 ià(!
m_bFÜm©
) {

165 
¡rE¼ÜLog
 = "The device isn't formated.";

166 
m_csFÜm©
.
	`UÆock
();

167 
mouÁ_check_”r
;

169 
m_csFÜm©
.
	`UÆock
();

171 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

172 
¡rE¼ÜLog
 = "The device is‚ot‡ block device.";

173 
mouÁ_check_”r
;

176 
m_csMouÁ
.
	`Lock
();

177 ià(
m_bMouÁ


178 && !
m_¡rMouÁPošt
.
	`em±y
()

179 && 
m_¡rMouÁPošt
 =ğ
¡rMouÁPošt


180 && 
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

181 #ifdeà
NUUO


182 && 
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

185 
mouÁ_ok
;

188 ià(
m_bMouÁ
 &&

189 !
m_¡rMouÁPošt
.
	`em±y
() &&

190 
m_¡rMouÁPošt
 !ğ
¡rMouÁPošt
) {

193 
¡rE¼ÜLog
 = "The device has‡lready be mounted. Why„equesto mount‡gain with‡ different mount…oint?";

194 
mouÁ_”r
;

197 ià(!
	`CheckDœeùÜyExi¡
(
¡rMouÁPošt
)) {

198 ià(!
	`MakeDœeùÜy
(
¡rMouÁPošt
)) {

199 
¡rE¼ÜLog
 = "Failo create mount…oint.";

200 
mouÁ_”r
;

202 } ià(
	`IsMouÁPošt
(
¡rMouÁPošt
)) {

205 
¡rE¼ÜLog
 = "The mount…oint is using by‡nother device..";

206 
mouÁ_”r
;

209 ià(
	`mouÁ
(
m_¡rDevNode
.
	`c_¡r
(), 
¡rMouÁPošt
.c_str(),

210 
m_¡rFSTy³
.
	`c_¡r
(), 0, "") < 0) {

212 
	`SË•MS
(2000);

214 ià(
	`mouÁ
(
m_¡rDevNode
.
	`c_¡r
(), 
¡rMouÁPošt
.c_str(),

215 
m_¡rFSTy³
.
	`c_¡r
(), 0, "") < 0) {

216 
¡rE¼ÜLog
 = 
	`¡ršg_fÜm©
("Failo mount %so %s. (%s)",

217 
m_¡rDevNode
.
	`c_¡r
(),

218 
m_¡rMouÁPošt
.
	`c_¡r
(),

219 
	`¡»¼Ü
(
”ºo
));

220 
mouÁ_”r
;

224 
mouÁ_ok
:

225 
m_bMouÁ
 = 
Œue
;

226 
m_¡rMouÁPošt
 = 
¡rMouÁPošt
;

227 
m_csMouÁ
.
	`UÆock
();

228 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

230 
m_¡rDevNode
.
	`c_¡r
(),

231 
m_¡rMouÁPošt
.
	`c_¡r
());

233  
Œue
;

235 
mouÁ_”r
:

236 
m_csMouÁ
.
	`UÆock
();

237 
mouÁ_check_”r
:

238 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

239 "%s", 
¡rE¼ÜLog
.
	`c_¡r
());

240  
çl£
;

241 
	}
}

243 
boŞ
 
	gFesy¡emMªag”
::
	$UnmouÁ
()

245 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

247 ià(!
m_bMouÁ
)

248 
unmouÁ_dÚe
;

250 ià(
m_¡rMouÁPošt
.
	`em±y
())

251 
unmouÁ_dÚe
;

253 ià(!
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
))

254 
unmouÁ_dÚe
;

256 ià(!
	`IsMouÁPošt
(
m_¡rMouÁPošt
))

257 
unmouÁ_dÚe
;

259 ià(
	`umouÁ2
(
m_¡rMouÁPošt
.
	`c_¡r
(), 
UMOUNT_NOFOLLOW
 | 
MNT_DETACH
) < 0) {

260 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
, "Failo unmount %s (%s)\n",

261 
m_¡rMouÁPošt
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

262  
çl£
;

269 
unmouÁ_dÚe
:

270 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

272 
m_¡rMouÁPošt
.
	`c_¡r
());

273 
m_bMouÁ
 = 
çl£
;

277  
Œue
;

278 
	}
}

280 
boŞ
 
	gFesy¡emMªag”
::
	$IsFÜm©ed
()

282  
m_bFÜm©
;

283 
	}
}

285 
boŞ
 
	gFesy¡emMªag”
::
	$IsFÜm©šg
(& 
´og»ss
, & 
¡©
)

287 
´og»ss
 = 
m_iFÜm©Prog»ss
;

288 
¡©
 = 
m_iFÜm©šgS‹
;

289 ià(
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_WRITING
 ||

290 
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_WRITING_DONE
 ||

291 
m_iFÜm©šgS‹
 =ğ
WRITE_INODE_TABLES_INIT
)

292  
Œue
;

294  
çl£
;

295 
	}
}

297 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁed
(
¡ršg
& 
¡rMouÁPošt
)

299 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

300 
¡rMouÁPošt
 = 
m_¡rMouÁPošt
;

301  
m_bMouÁ
;

302 
	}
}

304 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁed
(& 
num
)

306 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

307 
num
 = 
m_iVŞumeNum
;

308  
m_bMouÁ
;

309 
	}
}

311 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁed
()

313 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

314  
m_bMouÁ
;

315 
	}
}

317 
	gFesy¡emMªag”
::
	$S‘FÜm©Info
(
boŞ
 
fÜm©
, 
´og»ss
, 
¡©
)

319 
m_bFÜm©
 = 
fÜm©
;

320 
m_iFÜm©Prog»ss
 = 
´og»ss
;

321 
m_iFÜm©šgS‹
 = 
¡©
;

322 
	}
}

324 
	gFesy¡emMªag”
::
	$MakeFesy¡emProg»ss
(*
pD©a
, 
¡©
,

325 
cu¼’t
, 
tÙ®
)

327 ià(
pD©a
 =ğ
NULL
)

329 
Fesy¡emMªag”
 *
pFSMgr
 = (Fesy¡emMªag”*è
pD©a
;

331 
¡©
) {

332 
WRITE_INODE_TABLES_INIT
:

333 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, 0, 
¡©
);

335 
WRITE_INODE_TABLES_WRITING
:

336 
WRITE_INODE_TABLES_WRITING_DONE
:

337 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, ()(()
cu¼’t
 / ()
tÙ®
 * 100), 
¡©
);

339 
WRITE_INODE_TABLES_DONE
:

340 
pFSMgr
->
	`S‘FÜm©Info
(
Œue
, 100, 
¡©
);

342 
WRITE_INODE_TABLES_ERROR
:

343 
pFSMgr
->
	`S‘FÜm©Info
(
çl£
, 0, 
¡©
);

346 
	}
}

348 
	gFesy¡emMªag”
::
	$G’”©eUUIDFe
()

350 
Cr™iÿlSeùiÚLock
 
	`cs_mouÁ
(&
m_csMouÁ
);

352 ià(!
m_bMouÁ
 || 
m_¡rMouÁPošt
.
	`em±y
() ||

353 !
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

354 #ifdeà
NUUO


355 || !
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

360 
¡ršg
 
¡rUUIDFeName
 = 
m_¡rMouÁPošt
 + "/uuid";

361 ià(
	`CheckFeExi¡
(
¡rUUIDFeName
) &&

362 
	`G‘FeStÜageSize
(
¡rUUIDFeName
) == 32)

365 
Cr™iÿlSeùiÚLock
 
	`cs_fÜm©
(&
m_csFÜm©
);

367 ià(
m_¡rUUID
.
	`em±y
())

370 
FILE
 *
pf
 = 
	`fİ’
(
¡rUUIDFeName
.
	`c_¡r
(), "w+");

371 ià(
pf
) {

372 
	`årštf
(
pf
, "%s", 
m_¡rUUID
.
	`c_¡r
());

373 
	`fşo£
(
pf
);

375 
	}
}

377 
boŞ
 
	gFesy¡emMªag”
::
	$C»©eDeçuÉFŞd”s
()

379 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

381 ià(!
m_bMouÁ
 || 
m_¡rMouÁPošt
.
	`em±y
() ||

382 !
	`CheckDœeùÜyExi¡
(
m_¡rMouÁPošt
)

383 #ifdeà
NUUO


384 || !
	`ROOTFS_PROTECT
(
m_¡rMouÁPošt
.
	`c_¡r
())

387  
çl£
;

389 
¡ršg
 
¡rFŞd”Name
 = 
m_¡rMouÁPošt
 + "/VIDEODATA";

390 ià(!
	`CheckDœeùÜyExi¡
(
¡rFŞd”Name
)) {

391 ià(!
	`MakeDœeùÜy
(
¡rFŞd”Name
))

392  
çl£
;

395 
¡rFŞd”Name
 = 
m_¡rMouÁPošt
 + "/LOG";

396 ià(!
	`CheckDœeùÜyExi¡
(
¡rFŞd”Name
)) {

397 ià(!
	`MakeDœeùÜy
(
¡rFŞd”Name
))

398  
çl£
;

401  
Œue
;

402 
	}
}

404 
	gFesy¡emMªag”
::
	$blkid
()

406 
blkid_ÿche
 
ÿche
 = 
NULL
;

407 
»tv®
 = 0;

409 ià(
»tv®
 = 
	`blkid_g‘_ÿche
(&
ÿche
, 
NULL
) < 0) {

410 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

411 "[%d] FaØg‘ blkid cache.", 
__LINE__
);

412  
MKE2FS_FAIL_TO_GET_BLKID_CACHE
;

415 
m_csFÜm©
.
	`Lock
();

416 
blkid_dev
 
dev
 = 
	`blkid_g‘_dev
(
ÿche
, 
m_¡rDevNode
.
	`c_¡r
(), 
BLKID_DEV_NORMAL
);

417 cÚ¡ *
devÇme
 = 
	`blkid_dev_devÇme
(
dev
);

418 ià(!
	`CheckBlockDeviû
(
m_¡rDevNode
)) {

419 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

420 "[%d] % i nÙ‡ block deviû.", 
__LINE__
, 
m_¡rDevNode
.
	`c_¡r
());

421 
m_csFÜm©
.
	`UÆock
();

422  
MKE2FS_NOT_BLOCK_DEV
;

425 
blkid_g_™”©e
 
™”
;

426 cÚ¡ * 
ty³
 = 
NULL
;

427 cÚ¡ * 
v®ue
 = 
NULL
;

428 
™”
 = 
	`blkid_g_™”©e_begš
(
dev
);

429 
	`blkid_g_Ãxt
(
™”
, &
ty³
, &
v®ue
) == 0) {

430 ià(!
	`¡rcmp
(
ty³
, "UUID")) {

431 
m_¡rUUID
 = 
v®ue
;

432 
m_¡rUUID
.
	`”a£
(
¡d
::
	`»move
(m_¡rUUID.
	`begš
(), m_¡rUUID.
	`’d
(), '-'), m_strUUID.end());

434 ià(!
	`¡rcmp
(
ty³
, "TYPE")) {

435 
m_¡rFSTy³
 = 
v®ue
;

436 ià(
m_¡rFSTy³
 == "ext4" ||

437 
m_¡rFSTy³
 == "ext3")

438 
m_bFÜm©
 = 
Œue
;

439 } ià(!
	`¡rcmp
(
ty³
, "LABEL"))

442 
	`blkid_g_™”©e_’d
(
™”
);

443 
m_csFÜm©
.
	`UÆock
();

445 
mt
[256];

446 
mouÁ_æags
 = 0;

447 
mt
[0] = '\0';

448 
»tv®
 = 
	`ext2fs_check_mouÁ_pošt
(
m_¡rDevNode
.
	`c_¡r
(), &
mouÁ_æags
,

449 
mt
, (mtpt));

450 ià(
»tv®
 == 0) {

451 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csMouÁ
);

452 
»t
 = 0;

453 
m_¡rMouÁPošt
 = 
mt
;

454 ià(
mouÁ_æags
 & 
EXT2_MF_MOUNTED
) {

455 
m_bMouÁ
 = 
Œue
;

456 } ià(
mouÁ_æags
 & 
EXT2_MF_BUSY
) {

457 
m_bMouÁ
 = 
Œue
;

459 
m_bMouÁ
 = 
çl£
;

466 ià(
m_bMouÁ
) {

467 
»t
 = 
	`ssÿnf
(
mt
, "/mÁ/VOLUME%d", &
m_iVŞumeNum
);

468 ià(
»t
 < 0 ||„‘ =ğ
EOF
 || 
m_iVŞumeNum
 > 128 ||

469 
m_iVŞumeNum
 < 1) {

470 
m_iVŞumeNum
 = -1;

471 ià(
	`umouÁ2
(
m_¡rMouÁPošt
.
	`c_¡r
(),

472 
UMOUNT_NOFOLLOW
 | 
MNT_DETACH
) < 0) {

473 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
, "Failo unmount %s (%s)\n",

474 
m_¡rMouÁPošt
.
	`c_¡r
(),

475 
	`¡»¼Ü
(
”ºo
));

477 
m_bMouÁ
 = 
çl£
;

478 
m_¡rMouÁPošt
 = "";

485 
m_iVŞumeNum
--;

489 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_ERR
, 
LOG_LABEL
,

490 "[%d] FaØcheck mouÁ…ošt.", 
__LINE__
);

491  
MKE2FS_CHECK_MOUNT_POINT_FAIL
;

495 
	}
}

497 
	gFesy¡emMªag”
::
	$Dump
()

499 
	`årštf
(
¡dout
, "\tMount Point: %s(%s), Filesystem: %s(%s)\n"

501 
m_¡rMouÁPošt
.
	`c_¡r
(), 
m_bMouÁ
?"Mounted":"Not mounted",

502 
m_¡rFSTy³
.
	`c_¡r
(), 
m_bFÜm©
?"Formated":"Not Formated",

503 
m_¡rUUID
.
	`c_¡r
());

504 
	}
}

506 
boŞ
 
	gFesy¡emMªag”
::
	$do¡©
(cÚ¡ 
¡ršg
& 
·th
, 
¡©
 *
¡
,

507 
do_l¡©
, 
qu›t
)

509 
n
 = 0;

511 ià(
do_l¡©
)

512 
n
 = 
	`l¡©
(
·th
.
	`c_¡r
(), 
¡
);

514 
n
 = 
	`¡©
(
·th
.
	`c_¡r
(), 
¡
);

516 ià(
n
 != 0) {

517 ià(!
qu›t
)

518 
	`årštf
(
¡d”r
, "mountpoint: %s: %s\n",

519 
·th
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

520  
çl£
;

523  
Œue
;

524 
	}
}

526 
boŞ
 
	gFesy¡emMªag”
::
	$IsMouÁPošt
(cÚ¡ 
¡ršg
& 
·th
)

528 
¡©
 
¡
, 
¡2
;

529 ià(!
	`do¡©
(
·th
, &
¡
, 1, 0))

530  
çl£
;

532 ià(!
	`do¡©
(
·th
 + "/..", &
¡2
, 1, 0))

533  
çl£
;

535 ià((
¡
.
¡_dev
 !ğ
¡2
.st_dev) ||

536 (
¡
.
¡_dev
 =ğ
¡2
.¡_dev && st.
¡_šo
 == st2.st_ino)) {

537  
Œue
;

540  
çl£
;

541 
	}
}

543 
	gFesy¡emMªag”
::
	$In™ŸlizeMke2fsHªdË
()

545 
	`mem£t
(&
m_mkfsHªdË
.
cfg
, 0x00, (
e2fs_cfg
));

546 
	`¡ºıy
(
m_mkfsHªdË
.
deviû_Çme
, 
m_¡rDevNode
.
	`c_¡r
(),

547 (
m_mkfsHªdË
.
deviû_Çme
));

548 
m_mkfsHªdË
.
cb_func
 = 
MakeFesy¡emProg»ss
;

549 
m_mkfsHªdË
.
buf
 = 
NULL
;

550 
m_mkfsHªdË
.
pD©a
 = 
this
;

552 
m_mkfsHªdË
.
cfg
.
blocksize
 = 4096;

553 
m_mkfsHªdË
.
cfg
.
»£rved_¿tio
 = 1;

554 
m_mkfsHªdË
.
cfg
.
r_İt
 = -1;

555 
m_mkfsHªdË
.
cfg
.
fÜû
 = 1;

556 
m_mkfsHªdË
.
cfg
.
qu›t
 = 1;

557 #ifdeà
DEBUG


558 
m_mkfsHªdË
.
cfg
.
v”bo£
 = 1;

560 
m_mkfsHªdË
.
cfg
.
v”bo£
 = 0;

562 
m_mkfsHªdË
.
cfg
.
ü—tÜ_os
 = 
EXT2_OS_LINUX
;

563 
	`¡ºıy
(
m_mkfsHªdË
.
cfg
.
fs_ty³
, "ext4", 
	`¡¾’
("ext4"));

564 
	}
}

566 
	gFesy¡emMªag”
::
	$S‘VŞumeNum
(cÚ¡ &
num
)

568 
m_iVŞumeNum
 = 
num
;

569 
m_¡rMouÁPošt
 = 
	`¡ršg_fÜm©
("/mÁ/VOLUME%d", 
m_iVŞumeNum
 + 1);

570 
	}
}

572 
	gFesy¡emMªag”
::
	$G‘VŞumeNum
()

574  
m_iVŞumeNum
;

575 
	}
}

577 
¡ršg
 
	gFesy¡emMªag”
::
	$G‘MouÁPošt
()

579  
m_¡rMouÁPošt
;

580 
	}
}

582 
¡ršg
 
	gFesy¡emMªag”
::
	$G‘MouÁPošt
(cÚ¡ & 
num
)

584 
	`S‘VŞumeNum
(
num
);

585  
m_¡rMouÁPošt
;

586 
	}
}

	@FilesystemManager.h

1 #iâdeà
__FILESYSTEM_MANAGER_H__


2 
	#__FILESYSTEM_MANAGER_H__


	)

4 #ifdeà
__ılu¥lus


8 
	~"libmke2fs/mke2fs.h
"

11 
	~"blkid/blkid.h
"

12 #ifdeà
__ılu¥lus


16 
	~<¡ršg
>

18 
usšg
 
Çme¥aû
 
¡d
;

20 #ifdeà
NUUO


21 
	~"­r/­r_th»ad_wÜk”.h
"

22 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

23 
usšg
 
Çme¥aû
 
	gSYSUTILS_SPACE
;

25 
şass
 
	gFesy¡emMªag”
: 
public
 
A´Th»adWÜk”


27 
	~"‹¡_uts.h
"

29 
şass
 
Fesy¡emMªag”


32 
´iv©e
:

33 
Cr™iÿlSeùiÚ
 
m_csFÜm©
;

34 
Cr™iÿlSeùiÚ
 
	gm_csMouÁ
;

35 
Cr™iÿlSeùiÚ
 
	gm_csIn™Ÿlized
;

36 
mke2fs_hªdË
 
	gm_mkfsHªdË
;

39 
¡ršg
 
	gm_¡rMouÁPošt
;

40 
¡ršg
 
	gm_¡rDevNode
;

41 
¡ršg
 
	gm_¡rUUID
;

42 
¡ršg
 
	gm_¡rFSTy³
;

43 
	gm_iVŞumeNum
;

44 
	gm_iFÜm©šgS‹
;

45 
	gm_iFÜm©Prog»ss
;

46 
boŞ
 
	gm_bFÜm©
;

47 
boŞ
 
	gm_bMouÁ
;

48 
boŞ
 
	gm_bIn™Ÿlized
;

50 
	g´Ùeùed
:

51 #ifdeà
NUUO


52 
Th»adProc
();

55 
	g´iv©e
:

56 
In™ŸlizeMke2fsHªdË
();

57 
blkid
();

59 
	gpublic
:

60 
Fesy¡emMªag”
();

61 
Fesy¡emMªag”
(cÚ¡ 
¡ršg
& 
dev
);

62 
	gvœtu®
 ~
Fesy¡emMªag”
();

64 
MakeFesy¡emProg»ss
(*
pD©a
, 
¡©
,

65 
cu¼’t
, 
tÙ®
);

67 
boŞ
 
In™Ÿlize
();

69 
boŞ
 
FÜm©
(boŞ 
fÜû
 = 
Œue
);

74 
boŞ
 
S‘DeviûNode
(cÚ¡ 
¡ršg
 &
dev
);

75 
S‘MouÁPošt
(cÚ¡ 
¡ršg
 &
mouÁpošt
);

76 
S‘VŞumeNum
(cÚ¡ &
num
);

77 
G‘VŞumeNum
();

78 
¡ršg
 
G‘MouÁPošt
();

79 
¡ršg
 
G‘MouÁPošt
(cÚ¡ &
num
);

81 
boŞ
 
MouÁ
(cÚ¡ 
¡ršg
& 
¡rMouÁPošt
);

82 
boŞ
 
MouÁ
();

83 
boŞ
 
UnmouÁ
();

85 
boŞ
 
IsFÜm©ed
();

86 
boŞ
 
IsFÜm©šg
(& 
´og»ss
, & 
¡©
);

87 
boŞ
 
IsMouÁed
(
¡ršg
& 
¡rMouÁPošt
);

88 
boŞ
 
IsMouÁed
(& 
num
);

89 
boŞ
 
IsMouÁed
();

90 
boŞ
 
IsIn™Ÿlized
();

91 
S‘FÜm©Info
(
boŞ
 
fÜm©
, 
´og»ss
,

92 
¡©
);

94 
G’”©eUUIDFe
();

95 
boŞ
 
C»©eDeçuÉFŞd”s
();

97 
Dump
();

99 
boŞ
 
do¡©
(cÚ¡ 
¡ršg
& 
·th
, 
¡©
 *
¡
,

100 
do_l¡©
, 
qu›t
);

101 
boŞ
 
IsMouÁPošt
(cÚ¡ 
¡ršg
& 
·th
);

	@RAIDManager.cpp

1 
	~"RAIDMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/fe.h
"

5 
	~"commÚ/¡ršg.h
"

6 
	~"commÚ/sy¡em.h
"

7 
	~"commÚ/time.h
"

8 
	~"debugMsg/Debug.h
"

11 
	#LOG_LABEL
 "RAIDMªag”"

	)

12 
	#RAIDMANAGER_MONITOR_INTERVAL
 10000

	)

14 
	gRAIDMªag”
::
	$RAIDMªag”
()

16 
i
 = 0; i < 128; i++)

17 
m_bU£dMD
[
i
] = 
çl£
;

18 
i
 = 0; i < 128; i++)

19 
m_bU£dVŞume
[
i
] = 
çl£
;

21 
Cr™iÿlSeùiÚLock
 
	`cs_DiskProfes
(&
m_csDiskProfes
);

22 
Cr™iÿlSeùiÚLock
 
	`cs_MDProfes
(&
m_csMDProfes
);

23 
	`In™Ÿlize
();

25 
m_£mAs£mbË
.
	`Po¡
();

27 
Cr™iÿlSeùiÚLock
 
	`cs_NÙifyChªge
(&
m_csNÙifyChªge
);

28 
Œy
 {

29 
m_pNÙifyChªge
 = 
Ãw
 
	`A´CÚd
(
çl£
);

30 
	`C»©eTh»ad
();

31 } 
	`ÿtch
 (
bad_®loc
&) {

32 
m_pNÙifyChªge
 = 
NULL
;

33 
	`S‘La¡E¼Ü
("Allocate memory failed.");

35 
	}
}

37 
	gRAIDMªag”
::~
	$RAIDMªag”
()

39 ià(
	`Th»adExi¡s
()) {

40 
ušt32_t
 
»suÉ
;

41 
	`C®lWÜk”
(
eTC_STOP
, &
»suÉ
);

42 ià(
»suÉ
 == 0) {

43 
Cr™iÿlSeùiÚLock
 
	`cs_NÙifyChªge
(&
m_csNÙifyChªge
);

44 
d–‘e
 
m_pNÙifyChªge
;

45 
m_pNÙifyChªge
 = 
NULL
;

48 
	}
}

50 
boŞ
 
	gRAIDMªag”
::
	$In™Ÿlize
()

52 
udev
 *udev;

53 
udev_’um”©e
 *
’um”©e
;

54 
udev_li¡_’Œy
 *
deviûs
, *
dev_li¡_’Œy
;

55 
udev_deviû
 *
dev
;

57 
udev
 = 
	`udev_Ãw
();

58 ià(!
udev
) {

59 
	`´štf
("can't create udev\n");

60  
çl£
;

63 
’um”©e
 = 
	`udev_’um”©e_Ãw
(
udev
);

64 
	`udev_’um”©e_add_m©ch_subsy¡em
(
’um”©e
, "block");

65 
	`udev_’um”©e_sÿn_deviûs
(
’um”©e
);

66 
deviûs
 = 
	`udev_’um”©e_g‘_li¡_’Œy
(
’um”©e
);

67 
	`udev_li¡_’Œy_fÜ—ch
(
dev_li¡_’Œy
, 
deviûs
) {

68 
¡ršg
 
¡rSysName
;

69 
¡ršg
 
¡rMajÜ
;

70 
iMajÜ
 = 0;

71 cÚ¡ *
·th
 = 
NULL
;

73 
·th
 = 
	`udev_li¡_’Œy_g‘_Çme
(
dev_li¡_’Œy
);

74 
dev
 = 
	`udev_deviû_Ãw_äom_sy¥©h
(
udev
, 
·th
);

76 
¡rSysName
 = 
	`udev_deviû_g‘_sy¢ame
(
dev
);

77 
¡rMajÜ
 = 
	`udev_deviû_g‘_´İ”ty_v®ue
(
dev
, "MAJOR");

79 
iMajÜ
 = 
	`¡r_to_i32
(
¡rMajÜ
);

80 
iMajÜ
) {

83 
DiskProfe
 
	`´ofe
(
¡rSysName
);

84 ià(
´ofe
.
m_¡rSymLšk
 != "nuuo_satadom")

85 
m_m­DiskProfes
[
¡rSysName
] = 
´ofe
;

90 
MDProfe
 
	`´ofe
(
¡rSysName
);

92 ià(!
´ofe
.
m_bInMDSt
) {

93 
	`´štf
("%s:‚on-functional MD device.\n",

94 
¡rSysName
.
	`c_¡r
());

98 
m_m­MDProfes
[
¡rSysName
] = 
´ofe
;

99 
	`S‘MDNum
(
m_m­MDProfes
[
¡rSysName
].
m_iMDNum
);

101 ià(
NULL
 =ğ
m_m­MDProfes
[
¡rSysName
].
m_fsMgr
.
	`g‘
())

102 
m_m­MDProfes
[
¡rSysName
].
	`In™ŸlizeFSMªag”
();

104 ià(
m_m­MDProfes
[
¡rSysName
].
m_fsMgr
.
	`g‘
()) {

105 ià(!
m_m­MDProfes
[
¡rSysName
].
m_fsMgr
->
	`IsIn™Ÿlized
()) {

106 ià(!
m_m­MDProfes
[
¡rSysName
].
m_fsMgr
->
	`In™Ÿlize
())

110 
num
 = 
m_m­MDProfes
[
¡rSysName
].
m_fsMgr
->
	`G‘VŞumeNum
();

111 ià(
num
 < 0) {

113 
m_m­MDProfes
[
¡rSysName
].
m_fsMgr
->
	`S‘VŞumeNum
(
	`G‘F»eVŞumeNum
());

115 
	`S‘VŞumeNum
(
m_m­MDProfes
[
¡rSysName
].
m_fsMgr
->
	`G‘VŞumeNum
());

117 
	`´štf
("[%s] FilesystemManager initialization„etried failed.\n",

118 
¡rSysName
.
	`c_¡r
());

125 
	`udev_deviû_uÄef
(
dev
);

127 
	`udev_’um”©e_uÄef
(
’um”©e
);

128 
	`udev_uÄef
(
udev
);

135 
	}
}

137 
	gRAIDMªag”
::
	$G‘F»eMDNum
()

139 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

140 
i
 = 0 ; i < 128; i++) {

141 ià(!
m_bU£dMD
[
i
]) {

142 
m_bU£dMD
[
i
] = 
Œue
;

143  
i
;

147 
	`S‘La¡E¼Ü
("No free MD‚umber for creating RAID.\n");

149 
	}
}

151 
	gRAIDMªag”
::
	$F»eMDNum
(
n
)

153 ià(
n
 < 0 ||‚ > 127)

156 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

157 
m_bU£dMD
[
n
] = 
çl£
;

158 
	}
}

160 
	gRAIDMªag”
::
	$S‘MDNum
(
n
)

162 ià(
n
 < 0 ||‚ > 127)

165 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dMD
);

166 
m_bU£dMD
[
n
] = 
Œue
;

167 
	}
}

169 
	gRAIDMªag”
::
	$G‘F»eVŞumeNum
()

171 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

172 
i
 = 0 ; i < 128; i++) {

173 ià(!
m_bU£dVŞume
[
i
]) {

174 
m_bU£dVŞume
[
i
] = 
Œue
;

175  
i
;

179 
	`S‘La¡E¼Ü
("Exceed maximal volume†imitation.\n");

181 
	}
}

183 
	gRAIDMªag”
::
	$F»eVŞumeNum
(
n
)

185 ià(
n
 < 0 ||‚ > 127)

188 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

189 
m_bU£dVŞume
[
n
] = 
çl£
;

190 
	}
}

192 
	gRAIDMªag”
::
	$S‘VŞumeNum
(
n
)

194 ià(
n
 < 0 ||‚ > 127)

197 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csU£dVŞume
);

198 
m_bU£dVŞume
[
n
] = 
Œue
;

199 
	}
}

201 
	gRAIDMªag”
::
	$Qu”yMDSu³rBlockInDisk
(cÚ¡ 
¡ršg
& 
dev_·th
, 
examše_»suÉ
 &
»suÉ
)

203 
veùÜ
<
¡ršg
> 
vDevLi¡
;

204 
mddev_dev
* 
devli¡
 = 
NULL
;

205 
cÚ‹xt
 
c
;

206 
”r
 = 0;

208 
vDevLi¡
.
	`push_back
(
dev_·th
);

209 ià(
NULL
 =ğ(
devli¡
 = 
	`In™ŸlizeDevLi¡
(
vDevLi¡
))) {

210 
”r
 = 
EXAMINE_MEM_ALLOC_FAIL
;

211  
”r
;

214 
	`In™ŸlizeCÚ‹xt
(
c
);

215 
”r
 = 
	`Examše_ToResuÉ
(
devli¡
, &
c
, 
NULL
, &
»suÉ
);

216 
	`F»eDevLi¡
(
devli¡
);

218  
”r
;

219 
	}
}

221 
	gRAIDMªag”
::
	$NÙifyChªge
()

223 
Cr™iÿlSeùiÚLock
 
	`cs_NÙifyChªge
(&
m_csNÙifyChªge
);

224 ià(
NULL
 =ğ
m_pNÙifyChªge
)

225 
m_pNÙifyChªge
->
	`£t
();

226 
	}
}

228 
boŞ
 
	gRAIDMªag”
::
	$AddDisk
(cÚ¡ 
¡ršg
& 
dev
)

230 ià(
dev
.
	`em±y
())

231  
çl£
;

233 
m_csDiskProfes
.
	`Lock
();

234 
DiskProfe
 
	`´ofe
(
dev
);

235 
m_m­DiskProfes
[
dev
] = 
´ofe
;

236 
m_csDiskProfes
.
	`UÆock
();

237 
m_£mAs£mbË
.
	`Po¡
();

238 
	`NÙifyChªge
();

240  
Œue
;

241 
	}
}

243 
boŞ
 
	gRAIDMªag”
::
	$RemoveDisk
(cÚ¡ 
¡ršg
& 
dev
)

245 ià(
dev
.
	`em±y
())

246  
çl£
;

248 
m_csDiskProfes
.
	`Lock
();

249 
m­
<
¡ršg
, 
DiskProfe
>::
™”©Ü
 
™
;

250 
™
 = 
m_m­DiskProfes
.
	`fšd
(
dev
);

251 
m_m­DiskProfes
.
	`”a£
(
™
);

252 
m_csDiskProfes
.
	`UÆock
();

253 
	`NÙifyChªge
();

255  
Œue
;

256 
	}
}

258 
boŞ
 
	gRAIDMªag”
::
	$Qu”yMDD‘a
(cÚ¡ 
¡ršg
& 
mddev_·th
,

259 
¬¿y_d‘a
 &
ad
)

261 
cÚ‹xt
 
c
;

262 
»t
 = 
SUCCESS
;

264 
	`In™ŸlizeCÚ‹xt
(
c
);

265 
»t
 = 
	`D‘a_ToA¼ayD‘a
(
mddev_·th
.
	`c_¡r
(), &
c
, &
ad
);

266 ià(
»t
 !ğ
SUCCESS
) {

267 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

269 
__LINE__
, 
mddev_·th
.
	`c_¡r
(), 
»t
);

270  
çl£
;

273  
Œue
;

274 
	}
}

276 
	gRAIDMªag”
::
	$In™ŸlizeSh­e
(
sh­e
& 
s
, 
¿iddisks
, 
Ëv–
, 
chunk
, 
b™m­_chunk
, * 
b™m­_fe
)

278 
	`mem£t
(&
s
, 0x00, (
sh­e
));

279 
s
.
¿iddisks
 =„aiddisks;

280 
s
.
Ëv–
 =†evel;

281 
s
.
Ïyout
 = 
UnS‘
;

282 
s
.
b™m­_chunk
 = bitmap_chunk;

283 
s
.
chunk
 = chunk;

284 
s
.
assume_ş—n
 = 0;

285 
s
.
b™m­_fe
 = bitmap_file;

286 
	}
}

288 
	gRAIDMªag”
::
	$In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
, 
run¡İ
, 
v”bo£
)

290 
	`mem£t
(&
c
, 0x00, (
cÚ‹xt
));

291 
c
.
fÜû
 = force;

292 
c
.
d–ay
 = 
DEFAULT_BITMAP_DELAY
;

293 
c
.
run¡İ
 =„unstop;

294 
c
.
v”bo£
 = verbose;

295 
c
.
br›f
 = 0;

296 
	}
}

298 
	gRAIDMªag”
::
	$In™ŸlizeMDDevId’t
(
mddev_id’t
& 
id’t
, 
uuid_£t
, cÚ¡ 
uuid
[4], 
b™m­_fd
, * 
b™m­_fe
)

300 
	`mem£t
(&
id’t
, 0x00, (
mddev_id’t
));

301 
id’t
.
uuid_£t
 = uuid_set;

302 
id’t
.
su³r_mšÜ
 = 
UnS‘
;

303 
id’t
.
Ëv–
 = 
UnS‘
;

304 
id’t
.
¿id_disks
 = 
UnS‘
;

305 
id’t
.
¥¬e_disks
 = 
UnS‘
;

306 
id’t
.
b™m­_fd
 = bitmap_fd;

307 
id’t
.
b™m­_fe
 = bitmap_file;

308 ià(
uuid_£t
) {

309 
	`memıy
(
id’t
.
uuid
, uuid, () * 4);

310 
i
 = 0; i < 4; i++) {

311 
id’t
.
uuid
[
i
] = 
	`__be32_to_ıu
(ident.uuid[i]);

314 
	}
}

316 
mddev_dev
* 
	gRAIDMªag”
::
	$In™ŸlizeDevLi¡
(cÚ¡ 
¡ršg
& 
»¶aû
, cÚ¡ sŒšg& 
w™h
)

318 
mddev_dev
* 
devli¡
 = 
NULL
;

319 
mddev_dev
** 
devli¡’d
 = &
devli¡
;

320 
mddev_dev
* 
dv
 = 
NULL
;

322 ià(
»¶aû
.
	`em±y
(è|| 
w™h
.empty())

323  
NULL
;

325 
devli¡
 = 
NULL
;

326 
dv
 = (
mddev_dev
*)
	`m®loc
((mddev_dev));

327 ià(
dv
 =ğ
NULL
) {

328 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

329 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

330  
NULL
;

332 
dv
->
devÇme
 = (*)
»¶aû
.
	`c_¡r
();

333 
dv
->
di¥os™iÚ
 = 'R';

334 
dv
->
wr™emo¡ly
 = 0;

335 
dv
->
u£d
 = 0;

336 
dv
->
Ãxt
 = 
NULL
;

337 *
devli¡’d
 = 
dv
;

338 
devli¡’d
 = &
dv
->
Ãxt
;

340 
dv
 = (
mddev_dev
*)
	`m®loc
((mddev_dev));

341 ià(
dv
 =ğ
NULL
) {

342 
	`F»eDevLi¡
(
devli¡
);

343 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

344 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

345  
NULL
;

347 
dv
->
devÇme
 = (*)
w™h
.
	`c_¡r
();

348 
dv
->
di¥os™iÚ
 = 'w';

349 
dv
->
wr™emo¡ly
 = 0;

350 
dv
->
u£d
 = 0;

351 
dv
->
Ãxt
 = 
NULL
;

352 *
devli¡’d
 = 
dv
;

353 
devli¡’d
 = &
dv
->
Ãxt
;

355  
devli¡
;

356 
	}
}

358 
mddev_dev
* 
	gRAIDMªag”
::
In™ŸlizeDevLi¡
(
veùÜ
<
¡ršg
>& 
devNameLi¡
, 
di¥os™iÚ
)

360 
mddev_dev
* 
	gdevli¡
 = 
NULL
;

361 
mddev_dev
** 
	gdevli¡’d
 = &
devli¡
;

362 
mddev_dev
* 
	gdv
 = 
NULL
;

364 ià(
	gdevNameLi¡
.
em±y
())

365  
	gNULL
;

367 
size_t
 
	gi
 = 0; i < 
	gdevNameLi¡
.
size
(); i ++) {

368 
	gdv
 = (
mddev_dev
*)
m®loc
((mddev_dev));

369 ià(
	gdv
 =ğ
NULL
) {

370 
F»eDevLi¡
(
devli¡
);

371 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

372 "[%d] FaØ®loÿ‹ memÜy.\n", 
__LINE__
);

373  
	gNULL
;

375 
	gdv
->
	gdevÇme
 = (*)
devNameLi¡
[
i
].
c_¡r
();

376 
	gdv
->
	gdi¥os™iÚ
 = 
di¥os™iÚ
;

377 
	gdv
->
	gwr™emo¡ly
 = 0;

378 
	gdv
->
	gu£d
 = 0;

379 
	gdv
->
	gÃxt
 = 
NULL
;

380 *
	gdevli¡’d
 = 
dv
;

381 
	gdevli¡’d
 = &
dv
->
Ãxt
;

384  
	gdevli¡
;

387 
	gRAIDMªag”
::
	$F»eDevLi¡
(
mddev_dev
* 
devli¡
)

389 
mddev_dev
* 
dv
 = 
NULL
;

390 
dv
 = 
devli¡
; dv; dv = dv->
Ãxt
) {

391 
	`ä“
(
dv
);

393 
devli¡
 = 
NULL
;

394 
	}
}

396 
	gRAIDMªag”
::
	$O³nMDDev
(cÚ¡ 
¡ršg
& 
mddev_·th
)

398 
fd
 = 
	`İ’_mddev
((*)
mddev_·th
.
	`c_¡r
(), 1);

399 ià(
fd
 < 0) {

400 
	`S‘La¡E¼Ü
("FaØİ’ MD deviû %s\n", 
mddev_·th
.
	`c_¡r
());

403  
fd
;

404 
	}
}

406 
¡ršg
 
	gRAIDMªag”
::
	$G’”©eMDSysName
(
num
)

408  
	`¡ršg_fÜm©
("md%d", 
num
);

409 
	}
}

411 
boŞ
 
	gRAIDMªag”
::
C»©eRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, 
Ëv–
)

413 
	g»t
 = 
SUCCESS
;

414 
boŞ
 
	gbR‘ry
 = 
çl£
;

415 
	gä“MD
 = 
G‘F»eMDNum
();

416 ià(
	gä“MD
 < 0è 
	gçl£
;

426 
Cr™iÿlSeùiÚLock
 
cs_md
(&
m_csMDProfes
);

427 
	g»t
 = 
C»©eRAID
(
G’”©eMDSysName
(
ä“MD
), 
vDevLi¡
, 
Ëv–
);

428 ià(
	g»t
 =ğ
SUCCESS
) {

429 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

431 
G’”©eMDSysName
(
ä“MD
).
c_¡r
());

433 
MDProfe
 
´ofe
(
G’”©eMDSysName
(
ä“MD
));

435 ià(
	g´ofe
.
	gm_fsMgr
.
g‘
(è!ğ
NULL
)

436 
´ofe
.
m_fsMgr
->
C»©eTh»ad
();

438 
	gm_m­MDProfes
[
G’”©eMDSysName
(
ä“MD
)] = 
´ofe
;

439 
NÙifyChªge
();

440  
	gŒue
;

441 } ià(
	g»t
 =ğ
CREATE_MDDEV_INUSE
) {

443 
ä“MD
 = 
G‘F»eMDNum
();

444 ià(
	gä“MD
 < 0è 
	gçl£
;

447 ià(
	gbR‘ry
) {

448 
S‘La¡E¼Ü
("Retryo create %s failed.\n",

449 
G’”©eMDSysName
(
ä“MD
).
c_¡r
());

450 
F»eMDNum
(
ä“MD
);

451 
	gbR‘ry
 = 
çl£
;

453 
	gbR‘ry
 = 
Œue
;

455 } 
	g»t
 =ğ
CREATE_MDDEV_INUSE
 || 
bR‘ry
);

457 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

458 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

459  
	gçl£
;

462 
	gRAIDMªag”
::
C»©eRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
)

464 ià(
	gmddev
.
em±y
())

465  
	gCREATE_MDDEV_UNSET
;

467 ià(
	gvDevLi¡
.
em±y
())

468  
	gCREATE_RAID_DEVS_NOT_ENOUGH
;

470 
	gm­
<
	g¡ršg
, 
	gMDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
fšd
(
mddev
);

471 ià(
	g™
 !ğ
m_m­MDProfes
.
’d
()) {

472 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

473 "[%d] C»©E¼Ü Code: (%d)\n", 
__LINE__
,

474 
CREATE_MDDEV_INUSE
);

476  
	gCREATE_MDDEV_INUSE
;

479 
sh­e
 
	gs
;

480 
In™ŸlizeSh­e
(
s
, 
vDevLi¡
.
size
(), 
Ëv–
, 512);

482 
cÚ‹xt
 
	gc
;

483 
In™ŸlizeCÚ‹xt
(
c
);

485 
	gveùÜ
<
	g¡ršg
> 
	gvDevP©hLi¡
;

486 
size_t
 
	gi
 = 0; i < 
	gvDevLi¡
.
size
(); i++) {

487 
	gvDevP©hLi¡
.
push_back
(
G‘DeviûNodeBySymLšk
("/dev/" + 
vDevLi¡
[
i
]));

490 
mddev_dev
* 
	gdevli¡
 = 
In™ŸlizeDevLi¡
(
vDevP©hLi¡
);

491 ià(
	gdevli¡
 =ğ
NULL
)

492  
çl£
;

494 
	g»t
 = 
C»©e
(
NULL
, (*)
¡ršg_fÜm©
("/dev/%s", 
mddev
.
c_¡r
()).c_str(),

495 
NULL
, NULL, 
vDevP©hLi¡
.
size
(), 
devli¡
, &
s
, &
c
, 
INVALID_SECTORS
);

496 ià(
	g»t
 !ğ
SUCCESS
) {

497 
S‘La¡E¼Ü
("Failo create volume %s: (%d)\n",

498 
mddev
.
c_¡r
(), 
»t
);

499  
	g»t
;

502 
F»eDevLi¡
(
devli¡
);

503  
	gSUCCESS
;

506 
boŞ
 
	gRAIDMªag”
::
	$As£mbËRAID
(cÚ¡ 
uuid
[4], 
¡ršg
& 
mddev
)

508 
»t
 = 
SUCCESS
;

509 
boŞ
 
bR‘ry
 = 
çl£
;

510 
ä“MD
 = 
	`G‘F»eMDNum
();

511 ià(
ä“MD
 < 0)

512  
çl£
;

515 
mddev
 = 
	`G’”©eMDSysName
(
ä“MD
);

516 
»t
 = 
	`As£mbËRAID
(
mddev
, 
uuid
);

517 ià(
»t
 =ğ
SUCCESS
) {

518 * 
p_uuid
 = (*è
uuid
;

519 
¡ršg
 
	`¡rUUID
("");

520 
i
 = 0; i < 16; i++) {

521 
¡rUUID
 +ğ
	`¡ršg_fÜm©
("%02X ", 
p_uuid
[
i
]);

523 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

524 "%swa as£mbËdØ%s.\n", 
¡rUUID
.
	`c_¡r
(), 
mddev
.c_str());

526 
MDProfe
 
	`´ofe
(
mddev
);

527 
m_m­MDProfes
[
mddev
] = 
´ofe
;

528  
Œue
;

529 } ià(
»t
 =ğ
ASSEMBLE_MD_ALREADY_ACTIVE
) {

530  
Œue
;

531 } ià(
»t
 =ğ
ASSEMBLE_MDDEV_INUSE
) {

532 
ä“MD
 = 
	`G‘F»eMDNum
();

533 ià(
ä“MD
 < 0)

534  
çl£
;

536 } ià(
»t
 !ğ
ASSEMBLE_RAID_DEVS_NOT_ENOUGH
) {

537 ià(
bR‘ry
) {

538 * 
p_uuid
 = (*è
uuid
;

539 
¡ršg
 
	`¡rUUID
("");

540 
i
 = 0; i < 16; i++) {

541 
¡rUUID
 +ğ
	`¡ršg_fÜm©
("%02X ", 
p_uuid
[
i
]);

543 
	`S‘La¡E¼Ü
("Retryo‡ssemble %s failed.\n",

544 
¡rUUID
.
	`c_¡r
());

545 
	`F»eMDNum
(
ä“MD
);

546 
bR‘ry
 = 
çl£
;

548 
bR‘ry
 = 
Œue
;

550 } 
»t
 =ğ
ASSEMBLE_MDDEV_INUSE
 || 
bR‘ry
);

552 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

553 "[%d] As£mbË E¼Ü Code: (%d)\n", 
__LINE__
, 
»t
);

554  
çl£
;

555 
	}
}

557 
	gRAIDMªag”
::
	$As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4])

559 ià(
mddev
.
	`em±y
())

560  
ASSEMBLE_MDDEV_UNSET
;

562 ià(
uuid
 =ğ
NULL
)

563  
ASSEMBLE_INVALID_UUID
;

565 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

566 ià(
™
 !ğ
m_m­MDProfes
.
	`’d
()) {

567 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

569 
__LINE__
, 
ASSEMBLE_MDDEV_INUSE
);

570  
ASSEMBLE_MDDEV_INUSE
;

573 
mddev_id’t
 
id’t
;

574 
	`In™ŸlizeMDDevId’t
(
id’t
, 1, 
uuid
);

576 
cÚ‹xt
 
c
;

577 
	`In™ŸlizeCÚ‹xt
(
c
);

578 
»t
 = 
	`As£mbË
(
NULL
, (*)
	`¡ršg_fÜm©
("/dev/%s", 
mddev
.
	`c_¡r
()).c_str(),

579 &
id’t
, 
NULL
, &
c
);

580 ià(
»t
 !ğ
SUCCESS
) {

581 * 
p_uuid
 = (*è
uuid
;

582 
¡ršg
 
	`¡rUUID
("");

583 
i
 = 0; i < 16; i++) {

584 
¡rUUID
 +ğ
	`¡ršg_fÜm©
("%02X ", 
p_uuid
[
i
]);

586 
	`S‘La¡E¼Ü
("Failo‡ssemble volume %so %s: (%d)\n",

587 
¡rUUID
.
	`c_¡r
(), 
mddev
.c_¡r(), 
»t
);

590  
»t
;

591 
	}
}

593 
boŞ
 
	gRAIDMªag”
::
MªageRAIDSubdevs
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
İ”©iÚ
)

595 ià(
	gmddev
.
em±y
())

596  
	gçl£
;

598 ià(
	gvDevLi¡
.
em±y
())

599  
	gçl£
;

601 
Cr™iÿlSeùiÚLock
 
cs_md
(&
m_csMDProfes
);

602 
	gm­
<
	g¡ršg
, 
	gMDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
fšd
(
mddev
);

603 ià(
	g™
 =ğ
m_m­MDProfes
.
’d
()) {

604 
S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
c_¡r
());

605  
	gçl£
;

608 
	gfd
 = 
O³nMDDev
(
™
->
£cÚd
.
m_¡rDevP©h
.
c_¡r
());

609 ià(
	gfd
 < 0)

610  
	gçl£
;

621 
mddev_dev
* 
	gdevli¡
 = 
NULL
;

623 
	gveùÜ
<
	g¡ršg
> 
	gvDevP©hLi¡
;

624 
size_t
 
	gi
 = 0; i < 
	gvDevLi¡
.
size
(); i++) {

625 
	gvDevP©hLi¡
.
push_back
(
G‘DeviûNodeBySymLšk
("/dev/" + 
vDevLi¡
[
i
]));

626 
´štf
("%s.\n", 
vDevP©hLi¡
[
i
].
c_¡r
());

629 
	gİ”©iÚ
) {

631 ià(
vDevP©hLi¡
.
size
() != 2) {

632 
şo£
(
fd
);

633 
Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

635  
	gçl£
;

638 ià(
	gNULL
 =ğ(
devli¡
 = 
In™ŸlizeDevLi¡
(
vDevP©hLi¡
[0], vDevPathList[1]))) {

639  
	gçl£
;

643 ià(
NULL
 =ğ(
devli¡
 = 
In™ŸlizeDevLi¡
(
vDevP©hLi¡
, 
İ”©iÚ
))) {

644  
	gçl£
;

648 
cÚ‹xt
 
	gc
;

649 
In™ŸlizeCÚ‹xt
(
c
);

650 
	g»t
 = 
Mªage_subdevs
((*)
™
->
£cÚd
.
m_¡rDevP©h
.
c_¡r
(), 
fd
, 
devli¡
, 
c
.
v”bo£
, 0, 
NULL
, c.
fÜû
);

651 
şo£
(
fd
);

652 
F»eDevLi¡
(
devli¡
);

654 ià(
	g»t
 != 0) {

655 
S‘La¡E¼Ü
("FaØmªagvŞum%s: (%d)\n", 
mddev
.
c_¡r
(), 
»t
);

656  
	gçl£
;

659 
NÙifyChªge
();

661  
	gŒue
;

664 
boŞ
 
	gRAIDMªag”
::
RemoveMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

666  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'r');

669 
boŞ
 
	gRAIDMªag”
::
M¬kFauÉyMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

671  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'f');

674 
boŞ
 
	gRAIDMªag”
::
AddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

676  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'a');

679 
boŞ
 
	gRAIDMªag”
::
R—ddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
)

681  
MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'A');

684 
boŞ
 
	gRAIDMªag”
::
	$R•ÏûMDDisk
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ sŒšg& 
»¶aû
, cÚ¡ sŒšg& 
w™h
)

686 ià(
»¶aû
.
	`em±y
(è|| 
w™h
.empty())

687  
çl£
;

689 
veùÜ
<
¡ršg
> 
vDevLi¡
;

690 
vDevLi¡
.
	`push_back
(
»¶aû
);

691 
vDevLi¡
.
	`push_back
(
w™h
);

693  
	`MªageRAIDSubdevs
(
mddev
, 
vDevLi¡
, 'R');

694 
	}
}

696 
boŞ
 
	gRAIDMªag”
::
	$StİRAID
(cÚ¡ 
¡ršg
& 
mddev
)

698 ià(
mddev
.
	`em±y
())

699  
çl£
;

701 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csMDProfes
);

702 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

703 ià(
™
 =ğ
m_m­MDProfes
.
	`’d
()) {

704 
	`S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

705  
Œue
;

709 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
, 
´og»ss
 = -1;

710 ià(
™
->
£cÚd
.
m_fsMgr
.
	`g‘
(è&& it->£cÚd.m_fsMgr->
	`IsFÜm©šg
(
´og»ss
, 
¡©
)) {

711 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_INFO
, 
LOG_LABEL
,

713 
mddev
.
	`c_¡r
(), 
¡©
, 
´og»ss
);

714  
çl£
;

717 
™
->
£cÚd
.
m_fsMgr
->
	`UnmouÁ
();

718 
	`F»eVŞumeNum
(
™
->
£cÚd
.
m_fsMgr
->
	`G‘VŞumeNum
());

720 
fd
 = 
	`O³nMDDev
(
™
->
£cÚd
.
m_¡rDevP©h
.
	`c_¡r
());

721 ià(
fd
 < 0)

722  
çl£
;

724 
cÚ‹xt
 
c
;

725 
»t
 = 
SUCCESS
;

727 
	`In™ŸlizeCÚ‹xt
(
c
);

728 
»t
 = 
	`Mªage_¡İ
((*)
™
->
£cÚd
.
m_¡rDevP©h
.
	`c_¡r
(), 
fd
, 
c
.
v”bo£
, 0);

729 
	`şo£
(
fd
);

731 ià(
»t
 !ğ
SUCCESS
) {

732 
	`S‘La¡E¼Ü
("FaØ¡İ RAID %s: %d\n", 
mddev
.
	`c_¡r
(), 
»t
);

733  
çl£
;

736 
	`F»eMDNum
(
™
->
£cÚd
.
m_iMDNum
);

737 
m_m­MDProfes
.
	`”a£
(
™
);

739  
Œue
;

740 
	}
}

742 
boŞ
 
	gRAIDMªag”
::
	$D–‘eRAID
(cÚ¡ 
¡ršg
& 
mddev
)

744 
¬¿y_d‘a
 
ad
;

745 
cÚ‹xt
 
c
;

746 
boŞ
 
bQu”yD‘aOK
 = 
çl£
;

747 
»t
 = 
SUCCESS
;

748 
	`In™ŸlizeCÚ‹xt
(
c
);

751 
bQu”yD‘aOK
 = 
	`Qu”yMDD‘a
("/dev/" + 
mddev
, 
ad
);

753 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csDiskProfes
);

754 ià(!
	`StİRAID
(
mddev
))

755  
çl£
;

757 
m­
<
¡ršg
, 
DiskProfe
>::
™”©Ü
 
™
 = 
m_m­DiskProfes
.
	`begš
();

758 
™
 !ğ
m_m­DiskProfes
.
	`’d
()) {

759 
examše_»suÉ
 
”
;

760 
»t
 = 
	`Qu”yMDSu³rBlockInDisk
(
™
->
£cÚd
.
m_¡rDevP©h
, 
”
);

762 ià(
mddev
 =ğ
™
->
£cÚd
.
m_¡rMDDev
 ||

763 (
»t
 =ğ
SUCCESS
 && 
bQu”yD‘aOK
 &&

764 0 =ğ
	`memcmp
(
ad
.
uuid
, 
”
.
¬¿yUUID
, (ad.uuid))))

766 
™
->
£cÚd
.
	`R—dMDSt
();

767 
»t
 = 
	`Kl
((*)
™
->
£cÚd
.
m_¡rDevP©h
.
	`c_¡r
(), 
NULL
, 
c
.
fÜû
, c.
v”bo£
, 0);

768 ià(
»t
 !ğ
SUCCESS
) {

769 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

771 
™
->
fœ¡
.
	`c_¡r
(), 
»t
);

775 ià((
»t
 = 
	`Qu”yMDSu³rBlockInDisk
(
™
->
£cÚd
.
m_¡rDevP©h
, 
”
)è!ğ
EXAMINE_NO_MD_SUPERBLOCK
) {

776 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_WARNING
, 
LOG_LABEL
,

778 
™
->
fœ¡
.
	`c_¡r
(), 
»t
);

780 
¡ršg
 
cmd
 = 
	`¡ršg_fÜm©
("dd if=/dev/zero of=%s bs=512 count=1",

781 
™
->
£cÚd
.
m_¡rDevP©h
.
	`c_¡r
());

782 
	`sy¡em
(
cmd
.
	`c_¡r
());

784 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_WARNING
, 
LOG_LABEL
,

786 
™
->
fœ¡
.
	`c_¡r
());

789 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_WARNING
, 
LOG_LABEL
,

791 
™
->
fœ¡
.
	`c_¡r
());

792 
™
++;

795  
Œue
;

796 
	}
}

798 
boŞ
 
	gRAIDMªag”
::
	$G’”©eRAIDInfo
(cÚ¡ 
MDProfe
 &
´ofe
, 
RAIDInfo
& 
šfo
)

800 
¬¿y_d‘a
 
ad
;

801 ià(!
	`Qu”yMDD‘a
(
´ofe
.
m_¡rDevP©h
, 
ad
))

802  
çl£
;

804 
šfo
 = 
ad
;

805 
šfo
.
m_¡rSysName
 = 
´ofe
.m_strSysName;

806 ià(
´ofe
.
m_fsMgr
.
	`g‘
()) {

807 
šfo
.
m_bMouÁ
 = 
´ofe
.
m_fsMgr
->
	`IsMouÁed
();

808 
šfo
.
m_bFÜm©
 = 
´ofe
.
m_fsMgr
->
	`IsFÜm©ed
();

810 ià(!
´ofe
.
m_fsMgr
->
	`IsFÜm©šg
(
šfo
.
m_iFÜm©šgS‹
, info.
m_iFÜm©Prog»ss
)) {

811 
šfo
.
m_iFÜm©Prog»ss
 = -1;

814 
šfo
.
m_¡rMouÁPošt
 = 
´ofe
.
m_fsMgr
->
	`G‘MouÁPošt
();

817 
size_t
 
i
 = 0; i < 
šfo
.
m_vDiskLi¡
.
	`size
(); i++) {

818 
csDiskSysName
[8];

819 
	`ssÿnf
(
šfo
.
m_vDiskLi¡
[
i
].
m_¡rDevP©h
.
	`c_¡r
(),

820 "/dev/%7[^/\n\ˆ]", 
csDiskSysName
);

821 
	`´štf
("S—rch fÜ disk %s' ´ofe.\n", 
csDiskSysName
);

822 
m­
<
¡ršg
, 
DiskProfe
>::
™”©Ü
 
™_disk
 = 
m_m­DiskProfes
.
	`fšd
(
csDiskSysName
);

823 ià(
™_disk
 !ğ
m_m­DiskProfes
.
	`’d
()) {

824 
šfo
.
m_vDiskLi¡
[
i
].
m_diskProfe
 = 
™_disk
->
£cÚd
;

828  
Œue
;

829 
	}
}

831 
boŞ
 
	gRAIDMªag”
::
	$G‘RAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
RAIDInfo
& 
šfo
)

833 ià(
mddev
.
	`em±y
())

834  
çl£
;

836 
Cr™iÿlSeùiÚLock
 
	`cs_disk
(&
m_csDiskProfes
);

837 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csMDProfes
);

838 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

839 ià(
™
 =ğ
m_m­MDProfes
.
	`’d
()) {

840 
	`S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

841  
çl£
;

844 ià(!
	`G’”©eRAIDInfo
(
™
->
£cÚd
, 
šfo
))

845  
çl£
;

847  
Œue
;

848 
	}
}

850 
	gRAIDMªag”
::
G‘RAIDInfo
(
veùÜ
<
RAIDInfo
>& 
li¡
)

852 
li¡
.
ş—r
();

854 
Cr™iÿlSeùiÚLock
 
cs_disk
(&
m_csDiskProfes
);

855 
Cr™iÿlSeùiÚLock
 
cs_md
(&
m_csMDProfes
);

856 
	gm­
<
	g¡ršg
, 
	gMDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
begš
();

857 
	g™
 !ğ
m_m­MDProfes
.
’d
()) {

858 
RAIDInfo
 
šfo
;

859 ià(
G’”©eRAIDInfo
(
™
->
£cÚd
, 
šfo
))

860 
	gli¡
.
push_back
(
šfo
);

861 
	g™
++;

865 
	gRAIDMªag”
::
G‘F»eDisksInfo
(
veùÜ
<
RAIDDiskInfo
> &
li¡
)

867 
li¡
.
ş—r
();

869 
Cr™iÿlSeùiÚLock
 
cs
(&
m_csDiskProfes
);

870 
	gm­
<
	g¡ršg
, 
	gDiskProfe
>::
™”©Ü
 
™
 = 
m_m­DiskProfes
.
begš
();

871 
	g™
 !ğ
m_m­DiskProfes
.
’d
()) {

872 ià(
™
->
£cÚd
.
m_¡rMDDev
.
em±y
()) {

873 
RAIDDiskInfo
 
šfo
;

874 
	gšfo
.
	gm_¡rDevP©h
 = 
™
->
£cÚd
.
m_¡rDevP©h
;

875 
	gšfo
.
	gm_diskProfe
 = 
™
->
£cÚd
;

876 
	gli¡
.
push_back
(
šfo
);

878 
	g™
++;

882 
boŞ
 
	gRAIDMªag”
::
	$FÜm©
(cÚ¡ 
¡ršg
& 
mddev
)

884 ià(
mddev
.
	`em±y
()) {

885 
	`S‘La¡E¼Ü
("Unknown MD device.\n");

886  
çl£
;

889 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csMDProfes
);

890 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

891 ià(
™
 =ğ
m_m­MDProfes
.
	`’d
()) {

892 
	`S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

893  
çl£
;

896 ià(
™
->
£cÚd
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

897 
	`S‘La¡E¼Ü
("FilesystemManager is‚ot initialized for %s\n",

898 
mddev
.
	`c_¡r
());

899  
çl£
;

902 ià(
™
->
£cÚd
.
m_fsMgr
->
	`G‘VŞumeNum
() < 0) {

903 
num
 = 
	`G‘F»eVŞumeNum
();

904 
™
->
£cÚd
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

907 #ifdeà
NUUO


908 
™
->
£cÚd
.
m_fsMgr
->
	`C»©eTh»ad
();

911  
Œue
;

912 
	}
}

914 
boŞ
 
	gRAIDMªag”
::
	$MouÁ
(cÚ¡ 
¡ršg
& 
mddev
)

916 ià(
mddev
.
	`em±y
()) {

917 
	`S‘La¡E¼Ü
("Unknown MD device.\n");

918  
çl£
;

921 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csMDProfes
);

922 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

923 ià(
™
 =ğ
m_m­MDProfes
.
	`’d
()) {

924 
	`S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

925  
çl£
;

928 ià(
™
->
£cÚd
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

929 
	`S‘La¡E¼Ü
("FilesystemManager is‚ot initialized for %s\n",

930 
mddev
.
	`c_¡r
());

931  
çl£
;

934 ià(!
™
->
£cÚd
.
m_fsMgr
->
	`IsFÜm©ed
()) {

935 
	`S‘La¡E¼Ü
("%s is‚ot formated.\n",

936 
mddev
.
	`c_¡r
());

937  
çl£
;

940 
num
 = -1;

941 ià(!
™
->
£cÚd
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

942 ià(
num
 < 0) {

943 
num
 = 
	`G‘F»eVŞumeNum
();

944 ià(
num
 < 0è 
çl£
;

946 
™
->
£cÚd
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

947 ià(!
™
->
£cÚd
.
m_fsMgr
->
	`MouÁ
()) {

948  
çl£
;

954 
™
->
£cÚd
.
m_fsMgr
->
	`G’”©eUUIDFe
();

955 
™
->
£cÚd
.
m_fsMgr
->
	`C»©eDeçuÉFŞd”s
();

957  
Œue
;

958 
	}
}

960 
boŞ
 
	gRAIDMªag”
::
	$UnmouÁ
(cÚ¡ 
¡ršg
& 
mddev
)

962 ià(
mddev
.
	`em±y
()) {

963 
	`S‘La¡E¼Ü
("Unknown MD device.\n");

964  
çl£
;

967 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csMDProfes
);

968 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

969 ià(
™
 =ğ
m_m­MDProfes
.
	`’d
()) {

970 
	`S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

971  
çl£
;

974 ià(
™
->
£cÚd
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

975 
	`S‘La¡E¼Ü
("FilesystemManager is‚ot initialized for %s\n",

976 
mddev
.
	`c_¡r
());

977  
çl£
;

980 ià(
™
->
£cÚd
.
m_fsMgr
->
	`IsMouÁed
()) {

981 ià(!
™
->
£cÚd
.
m_fsMgr
->
	`UnmouÁ
()) {

982  
çl£
;

986  
Œue
;

987 
	}
}

989 
boŞ
 
	gRAIDMªag”
::
	$G‘FÜm©Prog»ss
(cÚ¡ 
¡ršg
& 
mddev
,

990 & 
¡©
, & 
´og»ss
)

992 ià(
mddev
.
	`em±y
()) {

993 
	`S‘La¡E¼Ü
("Unknown MD device.\n");

994  
çl£
;

997 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csMDProfes
);

998 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

999 ià(
™
 =ğ
m_m­MDProfes
.
	`’d
()) {

1000 
	`S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1001  
çl£
;

1004 ià(
™
->
£cÚd
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1005 
	`S‘La¡E¼Ü
("FilesystemManager is‚ot initialized for %s\n",

1006 
mddev
.
	`c_¡r
());

1007  
çl£
;

1010  
™
->
£cÚd
.
m_fsMgr
->
	`IsFÜm©šg
(
´og»ss
, 
¡©
);

1011 
	}
}

1013 
boŞ
 
	gRAIDMªag”
::
	$IsMouÁed
(cÚ¡ 
¡ršg
& 
mddev
, &
num
)

1015 ià(
mddev
.
	`em±y
()) {

1016 
	`S‘La¡E¼Ü
("Unknown MD device.\n");

1017  
çl£
;

1020 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csMDProfes
);

1021 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

1022 ià(
™
 =ğ
m_m­MDProfes
.
	`’d
()) {

1023 
	`S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1024  
çl£
;

1027 ià(
™
->
£cÚd
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1028 
	`S‘La¡E¼Ü
("FilesystemManager is‚ot initialized for %s\n",

1029 
mddev
.
	`c_¡r
());

1030  
çl£
;

1033  
™
->
£cÚd
.
m_fsMgr
->
	`IsMouÁed
(
num
);

1034 
	}
}

1036 
boŞ
 
	gRAIDMªag”
::
	$IsFÜm©ed
(cÚ¡ 
¡ršg
& 
mddev
)

1038 ià(
mddev
.
	`em±y
()) {

1039 
	`S‘La¡E¼Ü
("Unknown MD device.\n");

1040  
çl£
;

1043 
Cr™iÿlSeùiÚLock
 
	`cs_md
(&
m_csMDProfes
);

1044 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`fšd
(
mddev
);

1045 ià(
™
 =ğ
m_m­MDProfes
.
	`’d
()) {

1046 
	`S‘La¡E¼Ü
("% dÛ¢'ˆexi¡.\n", 
mddev
.
	`c_¡r
());

1047  
çl£
;

1050 ià(
™
->
£cÚd
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1051 
	`S‘La¡E¼Ü
("FilesystemManager is‚ot initialized for %s\n",

1052 
mddev
.
	`c_¡r
());

1053  
çl£
;

1056  
™
->
£cÚd
.
m_fsMgr
->
	`IsFÜm©ed
();

1057 
	}
}

1059 
	gRAIDMªag”
::
	$Dump
()

1061 
	`´štf
("Used MD Number: ");

1062 
i
 = 0; i < 128; i ++)

1063 ià(
m_bU£dMD
[
i
])

1064 
	`´štf
("%d ", 
i
);

1065 
	`´štf
("\n");

1067 
	`´štf
("Used Volume Number: ");

1068 
i
 = 0; i < 128; i ++)

1069 ià(
m_bU£dVŞume
[
i
])

1070 
	`´štf
("%d ", 
i
 + 1);

1071 
	`´štf
("\n");

1073 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™
 = 
m_m­MDProfes
.
	`begš
();

1074 ià(
™
 !ğ
m_m­MDProfes
.
	`’d
()) {

1075 
™
->
£cÚd
.
	`Dump
();

1077 
	}
}

1079 
	gRAIDMªag”
::
	$Th»adProc
()

1081 
ušt32_t
 
uMes§ge
 = (ušt32_tè
eTC_STOP
;

1084 ià(
	`CheckReque¡
(&
uMes§ge
)) {

1085 
uMes§ge
) {

1086 
eTC_STOP
:

1087 
	`R•ly
(0);

1090 
	`R•ly
(-1);

1102 
m_csDiskProfes
.
	`Lock
();

1103 
m­
<
¡ršg
, 
DiskProfe
>::
™”©Ü
 
™_disk
 = 
m_m­DiskProfes
.
	`begš
();

1104 
™_disk
 !ğ
m_m­DiskProfes
.
	`’d
()) {

1105 
udev
 *udev = 
NULL
;

1106 
udev_deviû
 *
dev
 = 
NULL
;

1107 
udev
 = 
	`udev_Ãw
();

1108 ià(!
udev
) {

1109 
	`´štf
("can't create udev\n");

1110 
™_disk
++;

1114 
dev
 = 
	`udev_deviû_Ãw_äom_subsy¡em_sy¢ame
(
udev
, "block", 
™_disk
->
fœ¡
.
	`c_¡r
());

1115 ià(
NULL
 =ğ
dev
) {

1116 
m_m­DiskProfes
.
	`”a£
(
™_disk
++);

1118 
DiskProfe
 
	`´ofe
(
™_disk
->
fœ¡
);

1119 ià(!(
´ofe
 =ğ
™_disk
->
£cÚd
)) {

1120 
	`ASSERT2
(0, "[%s] Sy¡em‚ami th§me, buˆÙh” disk infÜm©iÚ i difã»Á.\n", 
™_disk
->
fœ¡
.
	`c_¡r
());

1124 
™_disk
->
£cÚd
 = 
´ofe
;

1125 
™_disk
++;

1128 
	`udev_deviû_uÄef
(
dev
);

1129 
	`udev_uÄef
(
udev
);

1132 
m_csMDProfes
.
	`Lock
();

1134 
m­
<
¡ršg
, 
MDProfe
>::
™”©Ü
 
™_md
 = 
m_m­MDProfes
.
	`begš
();

1135 
™_md
 !ğ
m_m­MDProfes
.
	`’d
()) {

1139 
veùÜ
<
¡ršg
>::
™”©Ü
 
™_memb”
;;

1140 
udev
 *udev = 
NULL
;

1141 
udev_deviû
 *
dev
 = 
NULL
;

1142 
¬¿y_d‘a
 
ad
;

1143 
ava
[128];

1144 
disk_’ough
 = 0;

1146 
	`mem£t
(
ava
, 0x00, (avail));

1148 
udev
 = 
	`udev_Ãw
();

1149 ià(!
udev
) {

1150 
	`´štf
("can't create udev\n");

1151 
md_check_dÚe
;

1154 
dev
 = 
	`udev_deviû_Ãw_äom_subsy¡em_sy¢ame
(
udev
, "block", 
™_md
->
fœ¡
.
	`c_¡r
());

1155 ià(
NULL
 =ğ
dev
) {

1156 
	`F»eMDNum
(
™_md
->
£cÚd
.
m_iMDNum
);

1158 ià(
™_md
->
£cÚd
.
m_fsMgr
.
	`g‘
()) {

1159 
™_md
->
£cÚd
.
m_fsMgr
->
	`UnmouÁ
();

1160 
	`F»eVŞumeNum
(
™_md
->
£cÚd
.
m_fsMgr
->
	`G‘VŞumeNum
());

1168 
m_m­MDProfes
.
	`”a£
(
™_md
++);

1169 
	`udev_uÄef
(
udev
);

1173 
	`udev_deviû_uÄef
(
dev
);

1174 
	`udev_uÄef
(
udev
);

1176 
™_md
->
£cÚd
.
	`R—dMDSt
();

1178 
™_memb”
 = 
™_md
->
£cÚd
.
m_vMemb”s
.
	`begš
();

1179 
™_memb”
 !ğ
™_md
->
£cÚd
.
m_vMemb”s
.
	`’d
()) {

1191 
™_disk
 = 
m_m­DiskProfes
.
	`fšd
(*
™_memb”
);

1192 ià(
™_disk
 =ğ
m_m­DiskProfes
.
	`’d
()) {

1193 
™_memb”
 = 
™_md
->
£cÚd
.
m_vMemb”s
.
	`”a£
(it_member);

1195 
™_memb”
++;

1205 
™_md
->
£cÚd
.
m_iDevCouÁ
 = it_md->£cÚd.
m_vMemb”s
.
	`size
();

1207 ià(!
	`Qu”yMDD‘a
(
™_md
->
£cÚd
.
m_¡rDevP©h
, 
ad
)) {

1208 
	`ASSERT2
(0, "CªnÙ qu”y %s' d‘a infÜm©iÚ.", 
™_md
->
fœ¡
.
	`c_¡r
());

1209 
md_check_dÚe
;

1219 
i
 = 0; i < 
ad
.
uDiskCouÁ”
; i++) {

1220 
boŞ
 
bFound
 = 
çl£
;

1221 
ava
[
i
] = 0;

1224 ià(
	`¡¾’
(
ad
.
¬¿yDisks
[
i
].
¡rDevName
) == 0) {

1225 
	`´štf
("MD device %s has disks without‡ny information.\n",

1226 
ad
.
¡rA¼ayDevName
);

1230 
size_t
 
j
 = 0; j < 
™_md
->
£cÚd
.
m_vMemb”s
.
	`size
(); j++) {

1231 
¡ršg
 
¡rMemb”Name
 = "/dev/" + 
™_md
->
£cÚd
.
m_vMemb”s
[
j
];

1232 ià(
¡rMemb”Name
 =ğ
ad
.
¬¿yDisks
[
i
].
¡rDevName
) {

1233 
bFound
 = 
Œue
;

1239 ià(!
bFound
) {

1243 ià(
ad
.
¬¿yDisks
[
i
].
diskInfo
.
¡©e
 & (1 << 
MD_DISK_SYNC
)) {

1244 
ava
[
i
] = 1;

1254 
disk_’ough
 = 
	`’ough
(
ad
.
¬¿yInfo
.
Ëv–
,

1255 
ad
.
¬¿yInfo
.
¿id_disks
,

1256 
ad
.
¬¿yInfo
.
Ïyout
,

1257 1, 
ava
);

1259 ià(
™_md
->
£cÚd
.
m_iDevCouÁ
 =ğ
ad
.
¬¿yInfo
.
¿id_disks
 ||

1260 
disk_’ough
 == 1) {

1262 
num
 = -1;

1264 ià(
™_md
->
£cÚd
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1265 if(!
™_md
->
£cÚd
.
	`In™ŸlizeFSMªag”
()) {

1266 
	`´štf
("%s has‚o valid filesystem manager.\n",

1267 
™_md
->
£cÚd
.
m_¡rSysName
.
	`c_¡r
());

1268 
md_check_dÚe
;

1272 ià(
™_md
->
£cÚd
.
m_fsMgr
->
	`IsFÜm©ed
()) {

1273 ià(!
™_md
->
£cÚd
.
m_fsMgr
->
	`IsMouÁed
(
num
)) {

1274 ià(
num
 == -1) {

1275 
num
 = 
	`G‘F»eVŞumeNum
();

1276 ià(
num
 == -1) {

1277 
md_check_dÚe
;

1283 
™_md
->
£cÚd
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

1287 ià(
™_md
->
£cÚd
.
m_fsMgr
->
	`MouÁ
()) {

1288 
™_md
->
£cÚd
.
m_fsMgr
->
	`G’”©eUUIDFe
();

1289 
™_md
->
£cÚd
.
m_fsMgr
->
	`C»©eDeçuÉFŞd”s
();

1293 
num
 = 
™_md
->
£cÚd
.
m_fsMgr
->
	`G‘VŞumeNum
();

1294 ià(
num
 == -1) {

1300 
num
 = 
	`G‘F»eVŞumeNum
();

1301 
™_md
->
£cÚd
.
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

1305 
md_check_dÚe
;

1306 } ià(0 =ğ
disk_’ough
) {

1313 ià(
™_md
->
£cÚd
.
m_fsMgr
.
	`g‘
(è=ğ
NULL
)

1314 
md_check_dÚe
;

1316 ià(
™_md
->
£cÚd
.
m_fsMgr
->
	`IsMouÁed
()) {

1317 ià(
™_md
->
£cÚd
.
m_fsMgr
->
	`UnmouÁ
()) {

1318 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1320 
™_md
->
fœ¡
.
	`c_¡r
());

1325 
md_check_dÚe
:

1326 
™_md
++;

1329 ià(
m_£mAs£mbË
.
	`Wa™
(0)) {

1330 
™_disk
 = 
m_m­DiskProfes
.
	`begš
();

1331 
™_disk
 !ğ
m_m­DiskProfes
.
	`’d
()) {

1334 
™_disk
->
£cÚd
.
	`R—dMDSt
();

1335 ià(
™_disk
->
£cÚd
.
m_¡rMDDev
.
	`em±y
()) {

1336 
examše_»suÉ
 
”
;

1337 
”r
 = 0;

1338 ià((
”r
 = 
	`Qu”yMDSu³rBlockInDisk
(
™_disk
->
£cÚd
.
m_¡rDevP©h
, 
”
)è=ğ
SUCCESS
) {

1340 
¡ršg
 
mddev
;

1341 ià(
	`As£mbËRAID
(
”
.
¬¿yUUID
, 
mddev
)) {

1342 ià(
m_m­MDProfes
[
mddev
].
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1343 
m_m­MDProfes
[
mddev
].
	`In™ŸlizeFSMªag”
();

1344 ià(
m_m­MDProfes
[
mddev
].
m_fsMgr
.
	`g‘
(è=ğ
NULL
) {

1345 
™_disk
++;

1350 
num
 = -1;

1351 ià(
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`IsFÜm©ed
()) {

1352 ià(!
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`IsMouÁed
(
num
)) {

1353 ià(
num
 == -1) {

1354 
num
 = 
	`G‘F»eVŞumeNum
();

1355 ià(
num
 == -1) {

1358 
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

1359 ià(
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`MouÁ
()) {

1360 
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`G’”©eUUIDFe
();

1361 
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`C»©eDeçuÉFŞd”s
();

1365 ià(
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`MouÁ
()) {

1366 
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`G’”©eUUIDFe
();

1367 
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`C»©eDeçuÉFŞd”s
();

1372 
num
 = 
	`G‘F»eVŞumeNum
();

1373 
m_m­MDProfes
[
mddev
].
m_fsMgr
->
	`S‘VŞumeNum
(
num
);

1376 
™_disk
->
£cÚd
.
	`R—dMDSt
();

1378 } ià(
”r
 !ğ
EXAMINE_NO_MD_SUPERBLOCK
) {

1379 
	`Wr™eHWLog
(
LOG_LOCAL1
, 
LOG_DEBUG
, 
LOG_LABEL
,

1380 "[%d] FaØexamš%s.\n", 
__LINE__
,

1381 
™_disk
->
fœ¡
.
	`c_¡r
());

1385 
™_disk
++;

1389 
m_csMDProfes
.
	`UÆock
();

1390 
m_csDiskProfes
.
	`UÆock
();

1392 
SYSTEMTIME
 
time
;

1393 ià(
m_pNÙifyChªge
 =ğ
NULL
) {

1394 
	`SË•MS
(
RAIDMANAGER_MONITOR_INTERVAL
);

1395 
time
 = 
UTCTime
::
	`G‘Cu¼’tSy¡emTime
();

1396 
	`´štf
("[%u:%u:%u.%u]Timeout for‚ext„ound check.\n",

1397 
time
.
wHour
,ime.
wMšu‹
,ime.
wSecÚd
,ime.
wMli£cÚds
);

1399 
m_pNÙifyChªge
->
	`timedwa™
(
RAIDMANAGER_MONITOR_INTERVAL
);

1400 
time
 = 
UTCTime
::
	`G‘Cu¼’tSy¡emTime
();

1401 
	`´štf
("[%u:%u:%u.%u]Got‚otification orimeout for‚ext„ound check.\n",

1402 
time
.
wHour
,ime.
wMšu‹
,ime.
wSecÚd
,ime.
wMli£cÚds
);

1405 
	}
}

1407 
	gRAIDMªag”
::
	$G‘La¡E¼Ü
(
¡ršg
 &
log
)

1409 
Cr™iÿlSeùiÚLock
 
	`cs
(&
m_csLa¡E¼Ü
);

1410 
log
 = 
m_¡rLa¡E¼Ü
;

1411 
	}
}

1413 
¡ršg
 
	gRAIDMªag”
::
	$G‘DeviûNodeBySymLšk
(cÚ¡ 
¡ršg
& 
symlšk
)

1415 
¡©
 
s
;

1416 ià(
	`l¡©
(
symlšk
.
	`c_¡r
(), &
s
) >= 0) {

1417 ià(
	`S_ISLNK
(
s
.
¡_mode
) == 1) {

1418 
buf
[128];

1419 
Ën
 = 0;

1420 ià((
Ën
 = 
	`»adlšk
(
symlšk
.
	`c_¡r
(), 
buf
, (buf) - 1)) >= 0) {

1421 
¡ršg
 
¡rDevNode
 = "/dev/";

1422 
buf
[
Ën
] = '\0';

1423 
¡rDevNode
 +ğ
buf
;

1424  
¡rDevNode
;

1429  
symlšk
;

1430 
	}
}

1432 
	gRAIDMªag”
::
	$S‘La¡E¼Ü
(cÚ¡ 
¡ršg
 &
fmt
, ...)

1434 
va_li¡
 
¬gs
;

1435 
	`va_¡¬t
(
¬gs
, 
fmt
.
	`c_¡r
());

1436 
	`Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, 
LOG_LABEL
,

1437 
fmt
.
	`c_¡r
(), 
¬gs
);

1438 
m_¡rLa¡E¼Ü
 = 
	`¡ršg_fÜm©
(
fmt
.
	`c_¡r
(), 
¬gs
);

1439 
	`va_’d
(
¬gs
);

1440 
	}
}

	@RAIDManager.h

1 #iâdeà
__RAIDMANAGER_H__


2 
	#__RAIDMANAGER_H__


	)

4 #ifdeà
__ılu¥lus


7 
	~"libmdadm/mdadm.h
"

8 #ifdeà
__ılu¥lus


12 
	~"Fesy¡emMªag”.h
"

14 #ifdeà
NUUO


15 
	~"commÚ/ü™iÿl_£ùiÚ.h
"

16 
	~"commÚ/nusy¦og.h
"

17 
	~"commÚ/sm¬t_poš‹r.h
"

18 
	~"commÚ/£m­hÜe.h
"

19 
	~"­r/­r_th»ad_wÜk”.h
"

20 
usšg
 
Çme¥aû
 
SYSUTILS_SPACE
;

22 
	~"‹¡_uts.h
"

25 
	~<¡ršg
>

26 
	~<veùÜ
>

27 
	~<™”©Ü
>

28 
	~<memÜy
>

29 
	~<m­
>

31 
	~<¡dšt.h
>

32 
	~<sys/¡©.h
>

33 
	~<uni¡d.h
>

34 
	~<scsi/sg_cmds.h
>

35 
	~<scsi/sg_uÇligÃd.h
>

36 
	~<libudev.h
>

37 
	~<¡d¬g.h
>

39 
usšg
 
Çme¥aû
 
	g¡d
;

41 
	eeDiskTy³
 {

42 
	mDISK_TYPE_UNKNOWN
 = -1,

43 
	mDISK_TYPE_SATA
,

44 
	mDISK_TYPE_ESATA
,

45 
	mDISK_TYPE_ISCSI
,

46 
	mDISK_TYPE_NFS


49 
	sSGS”ŸlNoPage
 {

50 
ušt8_t
 
	mm_by‹PQPDT
;

51 
ušt8_t
 
	mm_by‹PageCode
;

52 
ušt8_t
 
	mm_by‹Re£rv›d
;

53 
ušt8_t
 
	mm_by‹PageL’gth
;

54 
ušt8_t
 
	mm_by‹PageSN
[32];

57 
	sSGR—dC­ac™y10
 {

58 
ušt8_t
 
	mm_LogiÿlBlockAddr
[4];

59 
ušt8_t
 
	mm_BlockL’gth
[4];

62 
	sDiskProfe
 {

63 
¡ršg
 
	mm_¡rSysName
;

64 
¡ršg
 
	mm_¡rDevP©h
;

65 
¡ršg
 
	mm_¡rSymLšk
;

66 
¡ršg
 
	mm_¡rMDDev
;

67 
¡ršg
 
	mm_¡rV’dÜ
;

68 
¡ršg
 
	mm_¡rMod–
;

69 
¡ršg
 
	mm_¡rFWV”
;

70 
¡ršg
 
	mm_¡rS”ŸlNum
;

71 
št64_t
 
	mm_ÎC­ac™y
;

72 
eDiskTy³
 
	mm_diskTy³
;

73 
	mm_iBay
;

75 
DiskProfe
()

76 : 
m_¡rSysName
("")

77 , 
m_¡rDevP©h
("")

78 , 
m_¡rSymLšk
("")

79 , 
m_¡rMDDev
("")

80 , 
m_¡rV’dÜ
("")

81 , 
m_¡rMod–
("")

82 , 
m_¡rFWV”
("")

83 , 
m_¡rS”ŸlNum
("")

84 , 
m_ÎC­ac™y
(0ull)

85 , 
m_diskTy³
(
DISK_TYPE_UNKNOWN
)

86 , 
m_iBay
(-1)

90 
DiskProfe
(
¡ršg
 
dev
)

91 : 
m_¡rSysName
(
dev
)

92 , 
m_¡rDevP©h
("")

93 , 
m_¡rSymLšk
("")

94 , 
m_¡rMDDev
("")

95 , 
m_¡rV’dÜ
("")

96 , 
m_¡rMod–
("")

97 , 
m_¡rFWV”
("")

98 , 
m_¡rS”ŸlNum
("")

99 , 
m_ÎC­ac™y
(0ull)

100 , 
m_diskTy³
(
DISK_TYPE_UNKNOWN
)

101 , 
m_iBay
(-1)

103 
S‘UDEVInfÜm©iÚ
();

104 
S‘DiskV’dÜInfom©iÚ
();

105 
R—dMDSt
();

106 
Dump
();

109 ~
DiskProfe
()

113 
	mDiskProfe
& 
	mİ”©Ü
=(cÚ¡ 
DiskProfe
& 
rhs
)

115 ià(
this
 =ğ&
rhs
)

116  *
this
;

117 
	mm_¡rSysName
 = 
rhs
.
m_¡rSysName
;

118 
	mm_¡rDevP©h
 = 
rhs
.
m_¡rDevP©h
;

119 
	mm_¡rSymLšk
 = 
rhs
.
m_¡rSymLšk
;

120 
	mm_diskTy³
 = 
rhs
.
m_diskTy³
;

121 
	mm_¡rMDDev
 = 
rhs
.
m_¡rMDDev
;

122 
	mm_iBay
 = 
rhs
.
m_iBay
;

123 
	mm_¡rV’dÜ
 = 
rhs
.
m_¡rV’dÜ
;

124 
	mm_¡rMod–
 = 
rhs
.
m_¡rMod–
;

125 
	mm_¡rFWV”
 = 
rhs
.
m_¡rFWV”
;

126 
	mm_¡rS”ŸlNum
 = 
rhs
.
m_¡rS”ŸlNum
;

127 
	mm_ÎC­ac™y
 = 
rhs
.
m_ÎC­ac™y
;

128  *
	mthis
;

131 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
DiskProfe
& 
rhs
)

133  (
m_¡rSysName
 =ğ
rhs
.m_strSysName &&

134 
m_¡rDevP©h
 =ğ
rhs
.m_strDevPath &&

135 
m_¡rSymLšk
 =ğ
rhs
.m_strSymLink);

138 
S‘UDEVInfÜm©iÚ
()

140 ià(
	mm_¡rSysName
.
em±y
())

143 
udev
 *
	mudev
;

144 
udev_deviû
 *
	mdev
;

145 
	mudev
 = 
udev_Ãw
();

146 ià(!
	mudev
) {

147 
´štf
("can't create udev\n");

151 
	mdev
 = 
udev_deviû_Ãw_äom_subsy¡em_sy¢ame
(
udev
, "block", 
m_¡rSysName
.
c_¡r
());

152 ià(
	mdev
) {

153 
	m»t
 = 0;

155 
	mm_¡rDevP©h
 = 
udev_deviû_g‘_devnode
(
dev
);

156 
	mm_¡rSymLšk
 = 
udev_deviû_g‘_´İ”ty_v®ue
(
dev
, "ID_SYMLINK");

158 ià(!
	mm_¡rSymLšk
.
em±y
()) {

159 ià(
	mm_¡rSymLšk
.
fšd
("nuuo_§"è!ğ
¡ršg
::
Åos
) {

160 
m_diskTy³
 = 
DISK_TYPE_SATA
;

161 
	m»t
 = 
ssÿnf
(
m_¡rSymLšk
.
c_¡r
(), "nuuo_§%d", &
m_iBay
);

162 ià(
	m»t
 < 1 ||„‘ =ğ
EOF
 || 
m_iBay
 > 127 || m_iBay < 0) {

163 
m_iBay
 = -1;

165 } ià(
	mm_¡rSymLšk
.
fšd
("nuuo_e§"è!ğ
¡ršg
::
Åos
) {

166 
m_diskTy³
 = 
DISK_TYPE_ESATA
;

167 
	m»t
 = 
ssÿnf
(
m_¡rSymLšk
.
c_¡r
(), "nuuo_e§%d", &
m_iBay
);

168 ià(
	m»t
 < 1 ||„‘ =ğ
EOF
 || 
m_iBay
 > 127 || m_iBay < 0) {

169 
m_iBay
 = -1;

171 } ià(
	mm_¡rSymLšk
.
fšd
("nuuo_iscsi"è!ğ
¡ršg
::
Åos
) {

172 
m_diskTy³
 = 
DISK_TYPE_ISCSI
;

173 
	m»t
 = 
ssÿnf
(
m_¡rSymLšk
.
c_¡r
(), "nuuo_iscsi%d", &
m_iBay
);

174 ià(
	m»t
 < 1 ||„‘ =ğ
EOF
) {

175 
m_iBay
 = -1;

178 
´štf
("Unknown SYMLINK\n");

182 
´štf
("ÿn'ˆfound block deviû %s.\n", 
m_¡rSysName
.
c_¡r
());

185 
udev_deviû_uÄef
(
dev
);

186 
udev_uÄef
(
udev
);

190 
S‘DiskV’dÜInfom©iÚ
()

192 ià(
	mm_¡rDevP©h
.
em±y
())

195 
sg_sim¶e_šquœy_»¥
 
	m»¥
;

196 
SGS”ŸlNoPage
 
	msg_¢_»¥
;

197 
SGR—dC­ac™y10
 
	msg_»adÿp10_»¥
;

198 
	msg_fd
 = 
sg_cmds_İ’_deviû
(
m_¡rDevP©h
.
c_¡r
(), 1, 1);

200 ià(
	msg_fd
 < 0)

203 ià(0 =ğ
sg_sim¶e_šquœy
(
sg_fd
, &
»¥
, 0, 0)) {

204 
	mm_¡rV’dÜ
 = 
»¥
.
v’dÜ
;

205 
	mm_¡rMod–
 = 
»¥
.
´oduù
;

206 
	mm_¡rFWV”
 = 
»¥
.
»visiÚ
;

213 ià(0 =ğ
sg_Î_šquœy
(
sg_fd
, 0 ,1 , 0x80,

214 (*)&
sg_¢_»¥
,

215 (
SGS”ŸlNoPage
),

217 
	mm_¡rS”ŸlNum
 = (*)
sg_¢_»¥
.
m_by‹PageSN
;

224 ià(0 =ğ
sg_Î_»adÿp_10
(
sg_fd
, 0, 1,

225 &
sg_»adÿp10_»¥
,

226 (
SGR—dC­ac™y10
),

228 
ušt32_t
 
	mÏ¡_blk_addr
 = 0, 
	mblock_size
 = 0;

229 
	mÏ¡_blk_addr
 = 
sg_g‘_uÇligÃd_be32
(&(
sg_»adÿp10_»¥
.
m_LogiÿlBlockAddr
));

230 ià(0xfffffffà!ğ
Ï¡_blk_addr
) {

231 
block_size
 = 
sg_g‘_uÇligÃd_be32
(&(
sg_»adÿp10_»¥
.
m_BlockL’gth
));

232 
	mm_ÎC­ac™y
 = (
Ï¡_blk_addr
 + 1è* 
block_size
;

240 
sg_cmds_şo£_deviû
(
sg_fd
);

243 
R—dMDSt
()

245 
md¡©_’t
 *
	mms
 = 
md¡©_»ad
(0, 0);

246 
md¡©_’t
 *
	me
 = 
ms
;

247 
	me
 = 
md¡©_by_compÚ’t
((*)
m_¡rSysName
.
c_¡r
());

248 ià(
	me
)

249 
	mm_¡rMDDev
 = 
e
->
dev
;

251 
	mm_¡rMDDev
 = "";

253 
ä“_md¡©
(
e
);

256 
Dump
()

258 
´štf
("Soft Link: %s, In RAID: %s",

259 
m_¡rSymLšk
.
c_¡r
(), 
m_¡rMDDev
.c_str());

260 
	mm_diskTy³
) {

261 
	mDISK_TYPE_UNKNOWN
:

262 
´štf
(", Type: Unknown\n");

264 
	mDISK_TYPE_SATA
:

265 
´štf
(", Type: SATA\n");

267 
	mDISK_TYPE_ESATA
:

268 
´štf
(", Type: ESATA\n");

270 
	mDISK_TYPE_ISCSI
:

271 
´štf
(", Type: iSCSI\n");

273 
	mDISK_TYPE_NFS
:

274 
´štf
(", Type: NFS\n");

280 
	sRAIDDiskInfo
 {

281 
DiskProfe
 
	mm_diskProfe
;

282 
¡ršg
 
	mm_¡rS‹
;

283 
¡ršg
 
	mm_¡rDevP©h
;

284 
št32_t
 
	mm_RaidUUID
[4];

285 
št32_t
 
	mm_iS‹
;

286 
št32_t
 
	mm_iRaidDiskNum
;

287 
št32_t
 
	mm_iMajÜ
;

288 
št32_t
 
	mm_iMšÜ
;

289 
boŞ
 
	mm_bHasMDSB
;

291 
RAIDDiskInfo
()

292 : 
m_¡rS‹
("")

293 , 
m_¡rDevP©h
("")

294 , 
m_iS‹
(0)

295 , 
m_iRaidDiskNum
(0)

296 , 
m_iMajÜ
(0)

297 , 
m_iMšÜ
(0)

298 , 
m_bHasMDSB
(
çl£
)

300 
mem£t
(
m_RaidUUID
, 0x00, (m_RaidUUID));

303 ~
RAIDDiskInfo
() {}

305 
	mRAIDDiskInfo
& 
	mİ”©Ü
=(cÚ¡ 
¬¿y_disk_šfo
& 
rhs
)

307 
m_¡rS‹
 = 
rhs
.
¡rS‹
;

308 
	mm_¡rDevP©h
 = 
rhs
.
¡rDevName
;

309 
	mm_iS‹
 = 
rhs
.
diskInfo
.
¡©e
;

310 
	mm_iRaidDiskNum
 = 
rhs
.
diskInfo
.
¿id_disk
;

311 
	mm_iMajÜ
 = 
rhs
.
diskInfo
.
majÜ
;

312 
	mm_iMšÜ
 = 
rhs
.
diskInfo
.
mšÜ
;

313  *
	mthis
;

316 
Dump
()

318 
´štf
("Device: %s, State: %s, MD Super Block: %s, Major: %d, Minor: %d\n\t",

319 
m_¡rDevP©h
.
c_¡r
(), 
m_¡rS‹
.c_¡r(), 
m_bHasMDSB
 ? "Yes" : "No",

320 
m_iMajÜ
, 
m_iMšÜ
);

321 
	mm_diskProfe
.
Dump
();

324 
	mRAIDDiskInfo
& 
	mİ”©Ü
=(cÚ¡ 
RAIDDiskInfo
& 
rhs
)

326 ià(
this
 =ğ&
rhs
)

327  *
this
;

328 
	mm_diskProfe
 = 
rhs
.
m_diskProfe
;

329 
	mm_¡rS‹
 = 
rhs
.
m_¡rS‹
;

330 
	mm_¡rDevP©h
 = 
rhs
.
m_¡rDevP©h
;

331 
	mm_iS‹
 = 
rhs
.
m_iS‹
;

332 
	mm_iRaidDiskNum
 = 
rhs
.
m_iRaidDiskNum
;

333 
	mm_bHasMDSB
 = 
rhs
.
m_bHasMDSB
;

334 
	mm_iMajÜ
 = 
rhs
.
m_iMajÜ
;

335 
	mm_iMšÜ
 = 
rhs
.
m_iMšÜ
;

336  *
	mthis
;

339 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
RAIDDiskInfo
& 
rhs
) const

341  (
m_¡rDevP©h
 =ğ
rhs
.m_strDevPath);

344 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
¡ršg
& 
rhs
) const

346  (
rhs
 =ğ
m_¡rDevP©h
);

349 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
DiskProfe
& 
´ofe
) const

351  (
m_¡rDevP©h
 =ğ
´ofe
.m_strDevPath);

355 
	sMDProfe
 {

356 #ifdeà
NUUO


357 
	msm¬t_±r
<
	mFesy¡emMªag”
> 
	mm_fsMgr
;

359 
	msh¬ed_±r
<
	mFesy¡emMªag”
> 
	mm_fsMgr
;

361 
	mveùÜ
<
	m¡ršg
> 
	mm_vMemb”s
;

362 
¡ršg
 
	mm_¡rSysName
;

363 
¡ršg
 
	mm_¡rDevP©h
;

364 
	mm_iRaidDisks
;

365 
	mm_iDevCouÁ
;

366 
	mm_iMDNum
;

367 
boŞ
 
	mm_bInMDSt
;

369 
MDProfe
()

370 : 
m_fsMgr
(
NULL
)

371 , 
m_¡rSysName
("")

372 , 
m_¡rDevP©h
("")

373 , 
m_iRaidDisks
(0)

374 , 
m_iDevCouÁ
(0)

375 , 
m_iMDNum
(-1)

376 , 
m_bInMDSt
(
çl£
)

378 
	mm_vMemb”s
.
ş—r
();

381 
MDProfe
(
¡ršg
 
dev
)

382 : 
m_fsMgr
(
NULL
)

383 , 
m_¡rSysName
(
dev
)

384 , 
m_¡rDevP©h
("")

385 , 
m_iRaidDisks
(0)

386 , 
m_iDevCouÁ
(0)

387 , 
m_iMDNum
(-1)

388 , 
m_bInMDSt
(
çl£
)

390 
	mm_vMemb”s
.
ş—r
();

391 
S‘UDEVInfÜm©iÚ
();

392 
R—dMDSt
();

393 
In™ŸlizeFSMªag”
();

396 ~
MDProfe
()

398 
	mm_vMemb”s
.
ş—r
();

399 
	mm_fsMgr
 = 
NULL
;

402 
	mMDProfe
& 
	mİ”©Ü
=(
MDProfe
& 
rhs
)

404 ià(
this
 =ğ&
rhs
)

405  *
this
;

407 
	mm_vMemb”s
.
ş—r
();

408 
size_t
 
	mi
 = 0; i < 
	mrhs
.
	mm_vMemb”s
.
size
(); i++)

409 
	mm_vMemb”s
.
push_back
(
rhs
.
m_vMemb”s
[
i
]);

410 
	mm_¡rSysName
 = 
rhs
.
m_¡rSysName
;

411 
	mm_¡rDevP©h
 = 
rhs
.
m_¡rDevP©h
;

412 
	mm_iRaidDisks
 = 
rhs
.
m_iRaidDisks
;

413 
	mm_iDevCouÁ
 = 
rhs
.
m_iDevCouÁ
;

414 
	mm_iMDNum
 = 
rhs
.
m_iMDNum
;

415 
	mm_fsMgr
 = 
rhs
.
m_fsMgr
;

416  *
	mthis
;

419 
boŞ
 
	mİ”©Ü
==(
MDProfe
& 
rhs
)

421  (
m_¡rSysName
 =ğ
rhs
.m_strSysName);

424 
S‘UDEVInfÜm©iÚ
()

426 ià(
	mm_¡rSysName
.
em±y
())

429 
udev
 *
	mudev
;

430 
udev_deviû
 *
	mdev
;

431 
	mudev
 = 
udev_Ãw
();

432 ià(!
	mudev
) {

433 
´štf
("can't create udev\n");

437 
	mdev
 = 
udev_deviû_Ãw_äom_subsy¡em_sy¢ame
(
udev
, "block", 
m_¡rSysName
.
c_¡r
());

438 ià(
	mdev
) {

439 
	m»t
 = 0;

441 
	mm_¡rDevP©h
 = 
udev_deviû_g‘_devnode
(
dev
);

443 ià(!
	mm_¡rDevP©h
.
em±y
()) {

444 
	m»t
 = 
ssÿnf
(
m_¡rDevP©h
.
c_¡r
(), "/dev/md%d", &
m_iMDNum
);

445 ià(
	m»t
 < 1 ||„‘ =ğ
EOF
 || 
m_iMDNum
 > 127 || m_iMDNum < 0) {

446 
m_iMDNum
 = -1;

451 
udev_deviû_uÄef
(
dev
);

452 
udev_uÄef
(
udev
);

456 
R—dMDSt
()

458 
md¡©_’t
 *
	mms
 = 
md¡©_»ad
(0, 0);

459 
md¡©_’t
 *
	me
 = 
ms
;

460 
	mm_vMemb”s
.
ş—r
();

461 ; 
	me
;ƒ = 
e
->
Ãxt
) {

462 ià(
m_¡rSysName
 =ğ
e
->
dev
) {

463 
md¡©_’t
::
dev_memb”
 *
dev
 = 
e
->
memb”s
;

464 ; 
	mdev
; dev = 
dev
->
Ãxt
) {

465 
m_vMemb”s
.
push_back
(
dev
->
Çme
);

468 
	mm_iRaidDisks
 = 
e
->
¿id_disks
;

469 
	mm_iDevCouÁ
 = 
e
->
devút
;

470 
	mm_bInMDSt
 = 
Œue
;

474 
ä“_md¡©
(
ms
);

477 
boŞ
 
In™ŸlizeFSMªag”
() {

478 
	mŒy
 {

479 #ifdeà
NUUO


480 
	mm_fsMgr
 = 
Ãw
 
Fesy¡emMªag”
(
m_¡rDevP©h
);

482 
	mm_fsMgr
 = 
sh¬ed_±r
<
Fesy¡emMªag”
>(
Ãw
 Fesy¡emMªag”(
m_¡rDevP©h
));

484 ià(!
	mm_fsMgr
->
IsIn™Ÿlized
()) {

485 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, "RAIDInfo",

487  
	mçl£
;

489 } 
ÿtch
 (
bad_®loc
&) {

490 
	mm_fsMgr
 = 
NULL
;

491 
Wr™eHWLog
(
LOG_LOCAL0
, 
LOG_ERR
, "RAIDInfo",

493  
	mçl£
;

496  
	mŒue
;

499 
Dump
() {

500 
´štf
("MD Name: %s\n\tDev Node: %s, RAID Disks: (%d/%d)\n\t",

501 
m_¡rSysName
.
c_¡r
(), 
m_¡rDevP©h
.c_¡r(), 
m_iDevCouÁ
, 
m_iRaidDisks
);

502 ià(
	mm_fsMgr
.
g‘
()) {

503 
´štf
("Status: Format(%s), Mount(%s on %s)",

504 
m_fsMgr
->
IsFÜm©ed
()?"Yes":"No",

505 
m_fsMgr
->
IsMouÁed
()?"Yes":"No", m_fsMgr->
G‘MouÁPošt
().
c_¡r
());

510 
	sRAIDInfo
 {

511 
	mveùÜ
<
	mRAIDDiskInfo
> 
	mm_vDiskLi¡
;

512 
¡ršg
 
	mm_¡rSysName
;

513 
¡ršg
 
	mm_¡rDevP©h
;

514 
¡ršg
 
	mm_¡rS‹
;

515 
¡ršg
 
	mm_¡rLayout
;

516 
¡ršg
 
	mm_¡rRebudšgO³¿tiÚ
;

517 
¡ršg
 
	mm_¡rMouÁPošt
;

518 
time_t
 
	mm_C»©iÚTime
;

519 
time_t
 
	mm_Upd©eTime
;

520 
ušt32_t
 
	mm_UUID
[4];

521 
št64_t
 
	mm_uÎTÙ®C­ac™y
;

522 
št64_t
 
	mm_uÎU£dSize
;

523 
št32_t
 
	mm_iRAIDLev–
;

524 
št32_t
 
	mm_iTÙ®DiskNum
;

525 
št32_t
 
	mm_iRAIDDiskNum
;

526 
št32_t
 
	mm_iAùiveDiskNum
;

527 
št32_t
 
	mm_iWÜkšgDiskNum
;

528 
št32_t
 
	mm_iFaedDiskNum
;

529 
št32_t
 
	mm_iS·»DiskNum
;

530 
št32_t
 
	mm_iS‹
;

531 
št32_t
 
	mm_iChunkSize
;

532 
št32_t
 
	mm_iRebudšgProg»ss
;

533 
št32_t
 
	mm_iMDNum
;

534 
št32_t
 
	mm_iFÜm©šgS‹
;

535 
št32_t
 
	mm_iFÜm©Prog»ss
;

536 
boŞ
 
	mm_bFÜm©
;

537 
boŞ
 
	mm_bMouÁ
;

538 
boŞ
 
	mm_bSu³rBlockP”si¡’t
;

539 
boŞ
 
	mm_bIÇùive
;

540 
boŞ
 
	mm_bRebudšg
;

542 
RAIDInfo
()

543 : 
m_¡rSysName
("")

544 , 
m_¡rDevP©h
("")

545 , 
m_¡rS‹
("")

546 , 
m_¡rLayout
("")

547 , 
m_¡rRebudšgO³¿tiÚ
("")

548 , 
m_¡rMouÁPošt
("")

549 , 
m_C»©iÚTime
(0)

550 , 
m_Upd©eTime
(0)

551 , 
m_uÎTÙ®C­ac™y
(0ull)

552 , 
m_uÎU£dSize
(0ull)

553 , 
m_iRAIDLev–
(
UnS‘
)

554 , 
m_iTÙ®DiskNum
(0)

555 , 
m_iRAIDDiskNum
(0)

556 , 
m_iAùiveDiskNum
(0)

557 , 
m_iWÜkšgDiskNum
(0)

558 , 
m_iFaedDiskNum
(0)

559 , 
m_iS·»DiskNum
(0)

560 , 
m_iS‹
(0)

561 , 
m_iChunkSize
(512)

562 , 
m_iRebudšgProg»ss
(-1)

563 , 
m_iMDNum
(-1)

564 , 
m_iFÜm©šgS‹
(-1)

565 , 
m_iFÜm©Prog»ss
(-1)

566 , 
m_bFÜm©
(
çl£
)

567 , 
m_bMouÁ
(
çl£
)

568 , 
m_bSu³rBlockP”si¡’t
(
çl£
)

569 , 
m_bIÇùive
(
çl£
)

570 , 
m_bRebudšg
(
çl£
)

572 
	mi
 = 0; i < 4; i ++)

573 
	mm_UUID
[
i
] = 0;

576 ~
RAIDInfo
() {

579 
	mRAIDInfo
& 
	mİ”©Ü
=(cÚ¡ 
¬¿y_d‘a
& 
rhs
)

581 
m_vDiskLi¡
.
ş—r
();

582 
	mi
 = 0; i < 
	mrhs
.
	muDiskCouÁ”
; i++) {

583 
RAIDDiskInfo
 
	mšfo
;

584 ià(
	mrhs
.
	m¬¿yDisks
[
i
].
	mdiskInfo
.
	mmajÜ
 != 8)

587 
´štf
("%s, %s\n", 
rhs
.
¡rA¼ayDevName
,„hs.
¬¿yDisks
[
i
].
¡rDevName
);

588 
	mšfo
 = 
rhs
.
¬¿yDisks
[
i
];

589 
	mm_vDiskLi¡
.
push_back
(
šfo
);

592 
	mm_¡rS‹
 = 
rhs
.
¡rA¼ayS‹
;

593 
	mm_¡rLayout
 = 
rhs
.
¡rRaidLayout
;

594 
	mm_¡rRebudšgO³¿tiÚ
 = 
rhs
.
¡rRebudO³¿tiÚ
;

595 
	mm_¡rDevP©h
 = 
rhs
.
¡rA¼ayDevName
;

596 
memıy
(
m_UUID
, 
rhs
.
uuid
, (m_UUID));

597 
	mm_uÎTÙ®C­ac™y
 = 
rhs
.
uÎA¼aySize
;

598 
	mm_uÎU£dSize
 = 
rhs
.
uÎU£dSize
;

599 
	mm_iRAIDLev–
 = 
rhs
.
¬¿yInfo
.
Ëv–
;

600 
	mm_iTÙ®DiskNum
 = 
rhs
.
¬¿yInfo
.
Ä_disks
;

601 
	mm_iRAIDDiskNum
 = 
rhs
.
¬¿yInfo
.
¿id_disks
;

602 
	mm_iAùiveDiskNum
 = 
rhs
.
¬¿yInfo
.
aùive_disks
;

603 
	mm_iWÜkšgDiskNum
 = 
rhs
.
¬¿yInfo
.
wÜkšg_disks
;

604 
	mm_iFaedDiskNum
 = 
rhs
.
¬¿yInfo
.
çed_disks
;

605 
	mm_iS·»DiskNum
 = 
rhs
.
¬¿yInfo
.
¥¬e_disks
;

606 
	mm_iS‹
 = 
rhs
.
¬¿yInfo
.
¡©e
;

607 
	mm_iChunkSize
 = 
rhs
.
¬¿yInfo
.
chunk_size
;

608 
	mm_iRebudšgProg»ss
 = 
rhs
.
iRebudProg»ss
;

609 
	mm_bRebudšg
 = 
rhs
.
bIsRebudšg
 =ğ1 ? 
Œue
 : 
çl£
;

610 
	mm_bIÇùive
 = 
rhs
.
bIÇùive
 =ğ1 ? 
Œue
 : 
çl£
;

611 
	mm_bSu³rBlockP”si¡’t
 = 
rhs
.
bIsSu³rBlockP”si¡’t
 =ğ1 ? 
Œue
 : 
çl£
;

612 
	mm_C»©iÚTime
 = 
rhs
.
¬¿yInfo
.
ùime
;

613 
	mm_Upd©eTime
 = 
rhs
.
¬¿yInfo
.
utime
;

615  *
	mthis
;

618 
	mRAIDInfo
& 
	mİ”©Ü
=(cÚ¡ 
RAIDInfo
& 
rhs
)

620 ià(
this
 =ğ&
rhs
)

621  *
this
;

623 
	mm_vDiskLi¡
.
ş—r
();

624 
size_t
 
	mi
 = 0; i < 
	mrhs
.
	mm_vDiskLi¡
.
size
(); i++) {

625 
	mm_vDiskLi¡
.
push_back
(
rhs
.
m_vDiskLi¡
[
i
]);

628 
	mm_¡rSysName
 = 
rhs
.
m_¡rSysName
;

629 
	mm_¡rS‹
 = 
rhs
.
m_¡rS‹
;

630 
	mm_¡rLayout
 = 
rhs
.
m_¡rLayout
;

631 
	mm_¡rRebudšgO³¿tiÚ
 = 
rhs
.
m_¡rRebudšgO³¿tiÚ
;

632 
	mm_¡rDevP©h
 = 
rhs
.
m_¡rDevP©h
;

633 
	mm_¡rMouÁPošt
 = 
rhs
.
m_¡rMouÁPošt
;

634 
memıy
(
m_UUID
, 
rhs
.m_UUID, (m_UUID));

635 
	mm_uÎTÙ®C­ac™y
 = 
rhs
.
m_uÎTÙ®C­ac™y
;

636 
	mm_uÎU£dSize
 = 
rhs
.
m_uÎU£dSize
;

637 
	mm_iRAIDLev–
 = 
rhs
.
m_iRAIDLev–
;

638 
	mm_iTÙ®DiskNum
 = 
rhs
.
m_iTÙ®DiskNum
;

639 
	mm_iRAIDDiskNum
 = 
rhs
.
m_iRAIDDiskNum
;

640 
	mm_iAùiveDiskNum
 = 
rhs
.
m_iAùiveDiskNum
;

641 
	mm_iWÜkšgDiskNum
 = 
rhs
.
m_iWÜkšgDiskNum
;

642 
	mm_iFaedDiskNum
 = 
rhs
.
m_iFaedDiskNum
;

643 
	mm_iS·»DiskNum
 = 
rhs
.
m_iS·»DiskNum
;

644 
	mm_iS‹
 = 
rhs
.
m_iS‹
;

645 
	mm_iChunkSize
 = 
rhs
.
m_iChunkSize
;

646 
	mm_iRebudšgProg»ss
 = 
rhs
.
m_iRebudšgProg»ss
;

647 
	mm_bRebudšg
 = 
rhs
.
m_bRebudšg
;

648 
	mm_bIÇùive
 = 
rhs
.
m_bIÇùive
;

649 
	mm_bSu³rBlockP”si¡’t
 = 
rhs
.
m_bSu³rBlockP”si¡’t
;

650 
	mm_C»©iÚTime
 = 
rhs
.
m_C»©iÚTime
;

651 
	mm_Upd©eTime
 = 
rhs
.
m_Upd©eTime
;

652 
	mm_iMDNum
 = 
rhs
.
m_iMDNum
;

653 
	mm_iFÜm©Prog»ss
 = 
rhs
.
m_iFÜm©Prog»ss
;

654 
	mm_iFÜm©šgS‹
 = 
rhs
.
m_iFÜm©šgS‹
;

655 
	mm_bMouÁ
 = 
rhs
.
m_bMouÁ
;

656 
	mm_bFÜm©
 = 
rhs
.
m_bFÜm©
;

658  *
	mthis
;

661 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
RAIDInfo
& 
rhs
) const

663  (
m_¡rSysName
 =ğ
rhs
.m_strSysName &&

664 0 =ğ
memcmp
(
rhs
.
m_UUID
, m_UUID, (m_UUID)));

667 
boŞ
 
	mİ”©Ü
==(cÚ¡ 
¡ršg
& 
rhs
) const

669  (
m_¡rSysName
 =ğ
rhs
);

672 
boŞ
 
IsRAIDStusChªged
(cÚ¡ 
RAIDInfo
& 
´evious
) {

673  !(
	mm_Upd©eTime
 =ğ
´evious
.
m_Upd©eTime
 &&

674 
m_iFaedDiskNum
 =ğ
´evious
.m_iFailedDiskNum &&

675 
m_iWÜkšgDiskNum
 =ğ
´evious
.m_iWorkingDiskNum &&

676 
m_iS·»DiskNum
 =ğ
´evious
.m_iSpareDiskNum);

679 
Dump
()

681 
´štf
("Device: %s\n"

688 
m_¡rDevP©h
.
c_¡r
(), 
m_¡rS‹
.c_str(),

689 
m_iRAIDLev–
, 
m_iChunkSize
,

690 
m_uÎTÙ®C­ac™y
, 
m_uÎU£dSize
,

691 
m_iTÙ®DiskNum
, 
m_iRAIDDiskNum
, 
m_iAùiveDiskNum
,

692 
m_iWÜkšgDiskNum
, 
m_iFaedDiskNum
, 
m_iS·»DiskNum
,

693 
ùime
(&
m_C»©iÚTime
), ctime(&
m_Upd©eTime
),

694 
m_bRebudšg
?"Yes":"No", (
m_iRebudšgProg»ss
 < 0)?100:m_iRebuildingProgress,

695 
m_bMouÁ
?"Yes":"No", 
m_bFÜm©
?"Yes":"No",

696 
m_iFÜm©šgS‹


699 
size_t
 
	mi
 =0 ; i < 
	mm_vDiskLi¡
.
size
(); i++) {

700 
´štf
("\t");

701 
	mm_vDiskLi¡
[
i
].
Dump
();

703 
´štf
("\n");

707 şas 
	cRAIDMªag”
 : 
public
 
A´Th»adWÜk”
 {

708 
´iv©e
:

710 
eTC_STOP
,

713 
	g´iv©e
:

714 
m­
<
¡ršg
, 
	gMDProfe
> 
	gm_m­MDProfes
;

715 
	gm­
<
	g¡ršg
, 
	gDiskProfe
> 
	gm_m­DiskProfes
;

716 
¡ršg
 
	gm_¡rLa¡E¼Ü
;

717 
boŞ
 
	gm_bU£dMD
[128];

718 
boŞ
 
	gm_bU£dVŞume
[128];

720 
Cr™iÿlSeùiÚ
 
	gm_csMDProfes
;

721 
Cr™iÿlSeùiÚ
 
	gm_csDiskProfes
;

722 
Cr™iÿlSeùiÚ
 
	gm_csNÙifyChªge
;

723 
Cr™iÿlSeùiÚ
 
	gm_csU£dMD
;

724 
Cr™iÿlSeùiÚ
 
	gm_csU£dVŞume
;

725 
Cr™iÿlSeùiÚ
 
	gm_csLa¡E¼Ü
;

726 
Sem­hÜe
 
	gm_£mAs£mbË
;

727 
A´CÚd
 *
	gm_pNÙifyChªge
;

729 
	g´iv©e
:

730 
veùÜ
<
RAIDInfo
>::
™”©Ü
 
S—rchDiskB–Úg2RAID
(
RAIDDiskInfo
& 
devInfo
);

732 
boŞ
 
In™Ÿlize
();

734 
In™ŸlizeSh­e
(
sh­e
& 
s
, 
¿iddisks
, 
Ëv–
, 
chunk
 = 512, 
b™m­_chunk
 = 
UnS‘
, * 
b™m­_fe
 = 
NULL
);

735 #ifdeà
DEBUG


736 
In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
 = 1, 
run¡İ
 = 1, 
v”bo£
 = 1);

738 
In™ŸlizeCÚ‹xt
(
cÚ‹xt
& 
c
, 
fÜû
 = 1, 
run¡İ
 = 1, 
v”bo£
 = 0);

740 
In™ŸlizeMDDevId’t
(
mddev_id’t
& 
id’t
, 
uuid_£t
, cÚ¡ 
uuid
[4], 
b™m­_fd
 = -1, * 
b™m­_fe
 = 
NULL
);

741 
mddev_dev
* 
In™ŸlizeDevLi¡
(
veùÜ
<
¡ršg
>& 
devNameLi¡
, 
di¥os™iÚ
 = 0);

742 
mddev_dev
* 
In™ŸlizeDevLi¡
(cÚ¡ 
¡ršg
& 
»¶aû
, cÚ¡ sŒšg& 
w™h
);

743 
F»eDevLi¡
(
mddev_dev
* 
devli¡
);

744 
O³nMDDev
(cÚ¡ 
¡ršg
& 
mddev_·th
);

746 
C»©eRAID
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
Ëv–
);

748 
boŞ
 
As£mbËRAID
(cÚ¡ 
uuid
[4], 
¡ršg
 &
mddev
);

749 
As£mbËRAID
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ 
uuid
[4]);

751 
G‘F»eMDNum
();

752 
F»eMDNum
(
n
);

753 
S‘MDNum
(
n
);

755 
G‘F»eVŞumeNum
();

756 
F»eVŞumeNum
(
n
);

757 
S‘VŞumeNum
(
n
);

759 
Upd©eRAIDDiskLi¡
(
veùÜ
<
RAIDDiskInfo
>& 
vRAIDDiskInfoLi¡
, cÚ¡ 
¡ršg
& 
mddev
);

760 
boŞ
 
MªageRAIDSubdevs
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
, 
İ”©iÚ
);

761 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
);

762 
	gveùÜ
<
	gRAIDInfo
>::
™”©Ü
 
IsMDDevInRAIDInfoLi¡
(cÚ¡ 
¡ršg
 &
mddev
, 
RAIDInfo
& 
šfo
);

763 
boŞ
 
IsDiskExi¡InRAIDDiskLi¡
(cÚ¡ 
¡ršg
& 
dev
);

764 
boŞ
 
IsDiskExi¡InRAIDDiskLi¡
(
veùÜ
<
¡ršg
>& 
vDevLi¡
);

765 
¡ršg
 
G’”©eMDSysName
(
num
);

767 
boŞ
 
StİRAID
(cÚ¡ 
¡ršg
& 
mddev
);

769 
Qu”yMDSu³rBlockInDisk
(cÚ¡ 
¡ršg
& 
dev_·th
, 
examše_»suÉ
 &
»suÉ
);

770 
boŞ
 
Qu”yMDD‘a
(cÚ¡ 
¡ršg
& 
mddev_·th
, 
¬¿y_d‘a
 &
ad
);

771 
boŞ
 
G’”©eRAIDInfo
(cÚ¡ 
MDProfe
 &
´ofe
, 
RAIDInfo
& 
šfo
);

772 
¡ršg
 
G‘DeviûNodeBySymLšk
(cÚ¡ sŒšg& 
symlšk
);

774 
NÙifyChªge
();

776 
	g´Ùeùed
:

777 
Th»adProc
();

779 
	gpublic
:

780 
RAIDMªag”
();

781 ~
RAIDMªag”
();

783 
boŞ
 
AddDisk
(cÚ¡ 
¡ršg
& 
dev
);

784 
boŞ
 
RemoveDisk
(cÚ¡ 
¡ršg
& 
dev
);

786 
boŞ
 
C»©eRAID
(
veùÜ
<
¡ršg
>& 
vDevLi¡
, 
Ëv–
);

788 
boŞ
 
RemoveMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

789 
boŞ
 
M¬kFauÉyMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

790 
boŞ
 
AddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

791 
boŞ
 
R—ddMDDisks
(cÚ¡ 
¡ršg
& 
mddev
, 
veùÜ
<¡ršg>& 
vDevLi¡
);

792 
boŞ
 
R•ÏûMDDisk
(cÚ¡ 
¡ršg
& 
mddev
, cÚ¡ sŒšg& 
»¶aû
, cÚ¡ sŒšg& 
w™h
);

794 
boŞ
 
D–‘eRAID
(cÚ¡ 
¡ršg
& 
mddev
);

796 
boŞ
 
G‘RAIDInfo
(cÚ¡ 
¡ršg
& 
mddev
, 
RAIDInfo
& 
šfo
);

797 
G‘RAIDInfo
(
veùÜ
<
RAIDInfo
>& 
li¡
);

798 
G‘F»eDisksInfo
(
veùÜ
<
RAIDDiskInfo
> &
li¡
);

800 
S‘La¡E¼Ü
(cÚ¡ 
¡ršg
 &
fmt
, ...);

801 
G‘La¡E¼Ü
(
¡ršg
 &
log
);

803 
boŞ
 
CheckFeSy¡em
();

804 
boŞ
 
DoFeSy¡emRecov”y
();

805 
boŞ
 
G‘FeSy¡emStus
();

807 
boŞ
 
FÜm©
(cÚ¡ 
¡ršg
& 
mddev
);

808 
boŞ
 
MouÁ
(cÚ¡ 
¡ršg
& 
mddev
);

809 
boŞ
 
UnmouÁ
(cÚ¡ 
¡ršg
& 
mddev
);

810 
boŞ
 
G‘FÜm©Prog»ss
(cÚ¡ 
¡ršg
& 
mddev
,

811 & 
¡©
, & 
´og»ss
);

812 
boŞ
 
IsMouÁed
(cÚ¡ 
¡ršg
& 
mddev
, &
num
);

813 
boŞ
 
IsFÜm©ed
(cÚ¡ 
¡ršg
& 
mddev
);

815 
Dump
();

	@libmdadm/bitmap.h

6 #iâdeà
BITMAP_H


7 
	#BITMAP_H
 1

	)

9 
	#BITMAP_MAJOR_LO
 3

	)

13 
	#BITMAP_MAJOR_HI
 4

	)

14 
	#BITMAP_MAJOR_HOSTENDIAN
 3

	)

16 
	#BITMAP_MINOR
 39

	)

80 #ifdeà
__KERNEL__


82 
	#PAGE_BITS
 (
PAGE_SIZE
 << 3)

	)

83 
	#PAGE_BIT_SHIFT
 (
PAGE_SHIFT
 + 3)

	)

85 
__u16
 
	tb™m­_couÁ”_t
;

86 
	#COUNTER_BITS
 16

	)

87 
	#COUNTER_BIT_SHIFT
 4

	)

88 
	#COUNTER_BYTE_RATIO
 (
COUNTER_BITS
 / 8)

	)

89 
	#COUNTER_BYTE_SHIFT
 (
COUNTER_BIT_SHIFT
 - 3)

	)

91 
	#NEEDED_MASK
 ((
b™m­_couÁ”_t
è(1 << (
COUNTER_BITS
 - 1)))

	)

92 
	#RESYNC_MASK
 ((
b™m­_couÁ”_t
è(1 << (
COUNTER_BITS
 - 2)))

	)

93 
	#COUNTER_MAX
 ((
b™m­_couÁ”_t
è
RESYNC_MASK
 - 1)

	)

94 
	#NEEDED
(
x
è(((
b™m­_couÁ”_t
èxè& 
NEEDED_MASK
)

	)

95 
	#RESYNC
(
x
è(((
b™m­_couÁ”_t
èxè& 
RESYNC_MASK
)

	)

96 
	#COUNTER
(
x
è(((
b™m­_couÁ”_t
èxè& 
COUNTER_MAX
)

	)

99 
	#PAGE_COUNTER_RATIO
 (
PAGE_BITS
 / 
COUNTER_BITS
)

	)

101 
	#PAGE_COUNTER_SHIFT
 (
PAGE_BIT_SHIFT
 - 
COUNTER_BIT_SHIFT
)

	)

103 
	#PAGE_COUNTER_MASK
 (
PAGE_COUNTER_RATIO
 - 1)

	)

105 
	#BITMAP_BLOCK_SIZE
 512

	)

106 
	#BITMAP_BLOCK_SHIFT
 9

	)

109 
	#CHUNK_BLOCK_RATIO
(
b™m­
è((b™m­)->
chunksize
 >> 
BITMAP_BLOCK_SHIFT
)

	)

110 
	#CHUNK_BLOCK_SHIFT
(
b™m­
è((b™m­)->
chunkshiá
 - 
BITMAP_BLOCK_SHIFT
)

	)

111 
	#CHUNK_BLOCK_MASK
(
b™m­
è(
	`CHUNK_BLOCK_RATIO
(b™m­è- 1)

	)

115 
	#PAGEPTR_BLOCK_RATIO
(
b™m­
) \

116 (
	`CHUNK_BLOCK_RATIO
(
b™m­
è<< 
PAGE_COUNTER_SHIFT
 >> 1)

	)

117 
	#PAGEPTR_BLOCK_SHIFT
(
b™m­
) \

118 (
	`CHUNK_BLOCK_SHIFT
(
b™m­
è+ 
PAGE_COUNTER_SHIFT
 - 1)

	)

119 
	#PAGEPTR_BLOCK_MASK
(
b™m­
è(
	`PAGEPTR_BLOCK_RATIO
(b™m­è- 1)

	)

129 
	#CHUNK_BIT_OFFSET
(
chunk
è((chunkè+ ((
b™m­_su³r_t
è<< 3))

	)

137 
	#BITMAP_MAGIC
 0x6d746962

	)

140 
	eb™m­_¡©e
 {

141 
	mBITMAP_ACTIVE
 = 0x001,

142 
	mBITMAP_STALE
 = 0x002

146 
	sb™m­_su³r_s
 {

147 
__u32
 
	mmagic
;

148 
__u32
 
	mv”siÚ
;

149 
__u8
 
	muuid
[16];

150 
__u64
 
	mev’ts
;

151 
__u64
 
	mev’ts_ş—»d
;

152 
__u64
 
	msync_size
;

153 
__u32
 
	m¡©e
;

154 
__u32
 
	mchunksize
;

155 
__u32
 
	md«mÚ_¦“p
;

156 
__u32
 
	mwr™e_behšd
;

158 
__u8
 
	m·d
[256 - 64];

159 } 
	tb™m­_su³r_t
;

175 #ifdeà
__KERNEL__


178 
	sb™m­_·ge
 {

182 *
	mm­
;

187 
	mhijacked
;

191 
	mcouÁ
;

195 
	s·ge_li¡
 {

196 
li¡_h—d
 
	mli¡
;

197 
·ge
 *
	m·ge
;

201 
	sb™m­
 {

202 
b™m­_·ge
 *
	mbp
;

203 
	m·ges
;

204 
	mmissšg_·ges
;

206 
mddev_t
 *
	mmddev
;

208 
	mcouÁ”_b™s
;

211 
	mchunksize
;

212 
	mchunkshiá
;

213 
	mchunks
;

220 
	msyncchunk
;

222 
__u64
 
	mev’ts_ş—»d
;

225 
¥šlock_t
 
	mlock
;

227 
fe
 *
	mfe
;

228 
·ge
 *
	msb_·ge
;

229 
·ge
 **
	mfem­
;

230 *
	mfem­_©Œ
;

231 
	mfe_·ges
;

233 
	mæags
;

239 
mdk_th»ad_t
 *
	md«mÚ
;

240 
	md«mÚ_¦“p
;

251 
mdk_th»ad_t
 *
	mwr™e_d«mÚ
;

252 
mdk_th»ad_t
 *
	mwr™eback_d«mÚ
;

253 
¥šlock_t
 
	mwr™e_lock
;

254 
£m­hÜe
 
	mwr™e_»ady
;

255 
£m­hÜe
 
	mwr™e_dÚe
;

256 
	mwr™es_³ndšg
;

257 
wa™_queue_h—d_t
 
	mwr™e_wa™
;

258 
li¡_h—d
 
	mwr™e_·ges
;

259 
li¡_h—d
 
	mcom¶‘e_·ges
;

260 
mempoŞ_t
 *
	mwr™e_poŞ
;

266 
b™m­_ü—‹
(
mddev_t
 *
mddev
);

267 
b™m­_de¡roy
(
mddev_t
 *
mddev
);

268 
b™m­_aùive
(
b™m­
 *bitmap);

270 *
fe_·th
(
fe
 *fe, *
buf
, 
couÁ
);

271 
b™m­_´št_sb
(
b™m­
 *bitmap);

272 
b™m­_upd©e_sb
(
b™m­
 *bitmap);

274 
b™m­_£Îb™s
(
b™m­
 *bitmap);

277 
b™m­_¡¬twr™e
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, 
£ùÜs
);

278 
b™m­_’dwr™e
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, 
£ùÜs
,

279 
sucûss
);

280 
b™m­_¡¬t_sync
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, *
blocks
);

281 
b™m­_’d_sync
(
b™m­
 *b™m­, 
£ùÜ_t
 
off£t
, *
blocks
, 
abÜ‹d
);

282 
b™m­_şo£_sync
(
b™m­
 *bitmap);

284 
b™m­_uÅlug
(
b™m­
 *bitmap);

	@libmdadm/crc32.h

5 
loÿl
 cÚ¡ 
FAR
 
	güc_bË
[
TBLS
][256] =

60 #ifdeà
BYFOUR


	@libmdadm/dlink.h

5 
	s__dl_h—d


7 * 
	mdh_´ev
;

8 * 
	mdh_Ãxt
;

11 
	#dl_®loc
(
size
è((*)(((*)
	`xÿÎoc
(1,(size)+(
__dl_h—d
)))+(__dl_h—d)))

	)

12 
	#dl_Ãw
(
t
è(Ñ*)
	`dl_®loc
(Ñ)))

	)

13 
	#dl_Ãwv
(
t
,
n
è(Ñ*)
	`dl_®loc
(Ñ)*n))

	)

15 
	#dl_Ãxt
(
p
è*(&(((
__dl_h—d
*)Õ))[-1].
dh_Ãxt
))

	)

16 
	#dl_´ev
(
p
è*(&(((
__dl_h—d
*)Õ))[-1].
dh_´ev
))

	)

18 *
dl_h—d
();

19 *
dl_¡rdup
(*);

20 *
dl_¡ºdup
(*, );

21 
dl_š£¹
(*, *);

22 
dl_add
(*, *);

23 
dl_d–
(*);

24 
dl_ä“
(*);

25 
dl_š™
(*);

	@libmdadm/md_p.h

15 #iâdeà
_MD_P_H


16 
	#_MD_P_H


	)

44 
	#MD_RESERVED_BYTES
 (64 * 1024)

	)

45 
	#MD_RESERVED_SECTORS
 (
MD_RESERVED_BYTES
 / 512)

	)

46 
	#MD_RESERVED_BLOCKS
 (
MD_RESERVED_BYTES
 / 
BLOCK_SIZE
)

	)

48 
	#MD_NEW_SIZE_SECTORS
(
x
è((x & ~(
MD_RESERVED_SECTORS
 - 1)è- MD_RESERVED_SECTORS)

	)

49 
	#MD_NEW_SIZE_BLOCKS
(
x
è((x & ~(
MD_RESERVED_BLOCKS
 - 1)è- MD_RESERVED_BLOCKS)

	)

51 
	#MD_SB_BYTES
 4096

	)

52 
	#MD_SB_WORDS
 (
MD_SB_BYTES
 / 4)

	)

53 
	#MD_SB_BLOCKS
 (
MD_SB_BYTES
 / 
BLOCK_SIZE
)

	)

54 
	#MD_SB_SECTORS
 (
MD_SB_BYTES
 / 512)

	)

59 
	#MD_SB_GENERIC_OFFSET
 0

	)

60 
	#MD_SB_PERSONALITY_OFFSET
 64

	)

61 
	#MD_SB_DISKS_OFFSET
 128

	)

62 
	#MD_SB_DESCRIPTOR_OFFSET
 992

	)

64 
	#MD_SB_GENERIC_CONSTANT_WORDS
 32

	)

65 
	#MD_SB_GENERIC_STATE_WORDS
 32

	)

66 
	#MD_SB_GENERIC_WORDS
 (
MD_SB_GENERIC_CONSTANT_WORDS
 + 
MD_SB_GENERIC_STATE_WORDS
)

	)

67 
	#MD_SB_PERSONALITY_WORDS
 64

	)

68 
	#MD_SB_DESCRIPTOR_WORDS
 32

	)

69 
	#MD_SB_DISKS
 27

	)

70 
	#MD_SB_DISKS_WORDS
 (
MD_SB_DISKS
*
MD_SB_DESCRIPTOR_WORDS
)

	)

71 
	#MD_SB_RESERVED_WORDS
 (1024 - 
MD_SB_GENERIC_WORDS
 - 
MD_SB_PERSONALITY_WORDS
 - 
MD_SB_DISKS_WORDS
 - 
MD_SB_DESCRIPTOR_WORDS
)

	)

72 
	#MD_SB_EQUAL_WORDS
 (
MD_SB_GENERIC_WORDS
 + 
MD_SB_PERSONALITY_WORDS
 + 
MD_SB_DISKS_WORDS
)

	)

77 
	#MD_DISK_FAULTY
 0

	)

78 
	#MD_DISK_ACTIVE
 1

	)

79 
	#MD_DISK_SYNC
 2

	)

80 
	#MD_DISK_REMOVED
 3

	)

82 
	#MD_DISK_WRITEMOSTLY
 9

	)

87 
	#MD_DISK_REPLACEMENT
 17

	)

89 
	smdp_deviû_desütÜ_s
 {

90 
__u32
 
	mnumb”
;

91 
__u32
 
	mmajÜ
;

92 
__u32
 
	mmšÜ
;

93 
__u32
 
	m¿id_disk
;

94 
__u32
 
	m¡©e
;

95 
__u32
 
	m»£rved
[
MD_SB_DESCRIPTOR_WORDS
 - 5];

96 } 
	tmdp_disk_t
;

98 
	#MD_SB_MAGIC
 0xa92b4efc

	)

103 
	#MD_SB_CLEAN
 0

	)

104 
	#MD_SB_ERRORS
 1

	)

105 
	#MD_SB_BBM_ERRORS
 2

	)

106 
	#MD_SB_BLOCK_CONTAINER_RESHAPE
 3

	)

107 
	#MD_SB_BLOCK_VOLUME
 4

	)

109 
	#MD_SB_BITMAP_PRESENT
 8

	)

111 
	smdp_su³rblock_s
 {

115 
__u32
 
	mmd_magic
;

116 
__u32
 
	mmajÜ_v”siÚ
;

117 
__u32
 
	mmšÜ_v”siÚ
;

118 
__u32
 
	m·tch_v”siÚ
;

119 
__u32
 
	mgv®id_wÜds
;

120 
__u32
 
	m£t_uuid0
;

121 
__u32
 
	mùime
;

122 
__u32
 
	mËv–
;

123 
__u32
 
	msize
;

124 
__u32
 
	mÄ_disks
;

125 
__u32
 
	m¿id_disks
;

126 
__u32
 
	mmd_mšÜ
;

127 
__u32
 
	mnÙ_³rsi¡’t
;

128 
__u32
 
	m£t_uuid1
;

129 
__u32
 
	m£t_uuid2
;

130 
__u32
 
	m£t_uuid3
;

131 
__u32
 
	mg¡©e_üe£rved
[
MD_SB_GENERIC_CONSTANT_WORDS
 - 16];

136 
__u32
 
	mutime
;

137 
__u32
 
	m¡©e
;

138 
__u32
 
	maùive_disks
;

139 
__u32
 
	mwÜkšg_disks
;

140 
__u32
 
	mçed_disks
;

141 
__u32
 
	m¥¬e_disks
;

142 
__u32
 
	msb_csum
;

143 #ià 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


144 
__u32
 
	mev’ts_hi
;

145 
__u32
 
	mev’ts_lo
;

146 
__u32
 
	mı_ev’ts_hi
;

147 
__u32
 
	mı_ev’ts_lo
;

149 
__u32
 
	mev’ts_lo
;

150 
__u32
 
	mev’ts_hi
;

151 
__u32
 
	mı_ev’ts_lo
;

152 
__u32
 
	mı_ev’ts_hi
;

154 
__u32
 
	m»cov”y_ı
;

156 
__u64
 
	m»sh­e_pos™iÚ
;

157 
__u32
 
	mÃw_Ëv–
;

158 
__u32
 
	md–_disks
;

159 
__u32
 
	mÃw_Ïyout
;

160 
__u32
 
	mÃw_chunk
;

161 
__u32
 
	mg¡©e_¤e£rved
[
MD_SB_GENERIC_STATE_WORDS
 - 18];

166 
__u32
 
	mÏyout
;

167 
__u32
 
	mchunk_size
;

168 
__u32
 
	mroÙ_pv
;

169 
__u32
 
	mroÙ_block
;

170 
__u32
 
	mp¡©e_»£rved
[
MD_SB_PERSONALITY_WORDS
 - 4];

175 
mdp_disk_t
 
	mdisks
[
MD_SB_DISKS
];

180 
__u32
 
	m»£rved
[
MD_SB_RESERVED_WORDS
];

185 
mdp_disk_t
 
	mthis_disk
;

187 } 
	tmdp_su³r_t
;

189 #ifdeà
__TINYC__


190 
	t__u64
;

193 
šlše
 
__u64
 
	$md_ev’t
(
mdp_su³r_t
 *
sb
) {

194 
__u64
 
ev
 = 
sb
->
ev’ts_hi
;

195  (
ev
<<32)| 
sb
->
ev’ts_lo
;

196 
	}
}

	@libmdadm/md_u.h

15 #iâdeà
_MD_U_H


16 
	#_MD_U_H


	)

21 
	#RAID_VERSION
 
	`_IOR
 (
MD_MAJOR
, 0x10, 
mdu_v”siÚ_t
)

	)

22 
	#GET_ARRAY_INFO
 
	`_IOR
 (
MD_MAJOR
, 0x11, 
mdu_¬¿y_šfo_t
)

	)

23 
	#GET_DISK_INFO
 
	`_IOR
 (
MD_MAJOR
, 0x12, 
mdu_disk_šfo_t
)

	)

24 
	#PRINT_RAID_DEBUG
 
	`_IO
 (
MD_MAJOR
, 0x13)

	)

25 
	#RAID_AUTORUN
 
	`_IO
 (
MD_MAJOR
, 0x14)

	)

26 
	#GET_BITMAP_FILE
 
	`_IOR
 (
MD_MAJOR
, 0x15, 
mdu_b™m­_fe_t
)

	)

29 
	#CLEAR_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x20)

	)

30 
	#ADD_NEW_DISK
 
	`_IOW
 (
MD_MAJOR
, 0x21, 
mdu_disk_šfo_t
)

	)

31 
	#HOT_REMOVE_DISK
 
	`_IO
 (
MD_MAJOR
, 0x22)

	)

32 
	#SET_ARRAY_INFO
 
	`_IOW
 (
MD_MAJOR
, 0x23, 
mdu_¬¿y_šfo_t
)

	)

33 
	#SET_DISK_INFO
 
	`_IO
 (
MD_MAJOR
, 0x24)

	)

34 
	#WRITE_RAID_INFO
 
	`_IO
 (
MD_MAJOR
, 0x25)

	)

35 
	#UNPROTECT_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x26)

	)

36 
	#PROTECT_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x27)

	)

37 
	#HOT_ADD_DISK
 
	`_IO
 (
MD_MAJOR
, 0x28)

	)

38 
	#SET_DISK_FAULTY
 
	`_IO
 (
MD_MAJOR
, 0x29)

	)

39 
	#SET_BITMAP_FILE
 
	`_IOW
 (
MD_MAJOR
, 0x2b, )

	)

42 
	#RUN_ARRAY
 
	`_IOW
 (
MD_MAJOR
, 0x30, 
mdu_·¿m_t
)

	)

43 
	#START_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x31)

	)

44 
	#STOP_ARRAY
 
	`_IO
 (
MD_MAJOR
, 0x32)

	)

45 
	#STOP_ARRAY_RO
 
	`_IO
 (
MD_MAJOR
, 0x33)

	)

46 
	#RESTART_ARRAY_RW
 
	`_IO
 (
MD_MAJOR
, 0x34)

	)

48 
	smdu_v”siÚ_s
 {

49 
	mmajÜ
;

50 
	mmšÜ
;

51 
	m·tchËv–
;

52 } 
	tmdu_v”siÚ_t
;

54 
	smdu_¬¿y_šfo_s
 {

58 
	mmajÜ_v”siÚ
;

59 
	mmšÜ_v”siÚ
;

60 
	m·tch_v”siÚ
;

61 
	mùime
;

62 
	mËv–
;

63 
	msize
;

64 
	mÄ_disks
;

65 
	m¿id_disks
;

66 
	mmd_mšÜ
;

67 
	mnÙ_³rsi¡’t
;

72 
	mutime
;

73 
	m¡©e
;

74 
	maùive_disks
;

75 
	mwÜkšg_disks
;

76 
	mçed_disks
;

77 
	m¥¬e_disks
;

82 
	mÏyout
;

83 
	mchunk_size
;

85 } 
	tmdu_¬¿y_šfo_t
;

87 
	smdu_disk_šfo_s
 {

91 
	mnumb”
;

92 
	mmajÜ
;

93 
	mmšÜ
;

94 
	m¿id_disk
;

95 
	m¡©e
;

97 } 
	tmdu_disk_šfo_t
;

99 
	smdu_¡¬t_šfo_s
 {

103 
	mmajÜ
;

104 
	mmšÜ
;

105 
	m¿id_disk
;

106 
	m¡©e
;

108 } 
	tmdu_¡¬t_šfo_t
;

110 
	smdu_b™m­_fe_s


112 
	m·thÇme
[4096];

113 } 
	tmdu_b™m­_fe_t
;

115 
	smdu_·¿m_s


117 
	m³rsÚ®™y
;

118 
	mchunk_size
;

119 
	mmax_çuÉ
;

120 } 
	tmdu_·¿m_t
;

	@libmdadm/mdadm.h

25 
	#_GNU_SOURCE


	)

26 
	#_FILE_OFFSET_BITS
 64

	)

27 
	~<uni¡d.h
>

28 #ifdeà
__GLIBC__


29 
__off64_t
 
l£ek64
 
__P
 ((
__fd
, __off64_ˆ
__off£t
, 
__wh’û
));

30 #–ià!
defšed
(
l£ek64
)

31 #ià
defšed
(
__NO_STAT64
è|| 
__WORDSIZE
 != 32

32 
	#l£ek64
 
l£ek


	)

36 
	~<sys/ty³s.h
>

37 
	~<sys/¡©.h
>

38 
	~<¡dlib.h
>

39 
	~<time.h
>

40 
	~<sys/time.h
>

41 
	~<g‘İt.h
>

42 
	~<fú.h
>

43 
	~<¡dio.h
>

44 
	~<”ºo.h
>

45 
	~<¡ršg.h
>

46 
	~<sy¦og.h
>

47 #ifdeà
__d›ibc__


48 
	~<¡ršgs.h
>

50 
	#¿ndom
 
¿nd


	)

51 
	#¤ªdom
 
¤ªd


	)

54 
	~<lšux/kdev_t.h
>

56 
	~<sys/mouÁ.h
>

57 
	~<asm/ty³s.h
>

58 
	~<sys/ioùl.h
>

59 
	#MD_MAJOR
 9

	)

60 
	#MdpMšÜShiá
 6

	)

62 #iâdeà
BLKGETSIZE64


63 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
è

	)

66 
	#DEFAULT_CHUNK
 512

	)

67 
	#DEFAULT_BITMAP_CHUNK
 4096

	)

68 
	#DEFAULT_BITMAP_DELAY
 5

	)

69 
	#DEFAULT_MAX_WRITE_BEHIND
 256

	)

75 #iâdeà
MAP_DIR


76 
	#MAP_DIR
 "/run/mdadm"

	)

81 #iâdeà
MAP_FILE


82 
	#MAP_FILE
 "m­"

	)

92 #iâdeà
MDMON_DIR


93 
	#MDMON_DIR
 "/run/mdadm"

	)

100 #iâdeà
FAILED_SLOTS_DIR


101 
	#FAILED_SLOTS_DIR
 "/run/mdadm/çed-¦Ùs"

	)

104 
	~"md_u.h
"

105 
	~"md_p.h
"

106 
	~"b™m­.h
"

107 
	~"msg.h
"

108 
	~"mdadm_”rcode.h
"

109 
	~"mdadm_Ùh”.h
"

111 
	~<’dŸn.h
>

117 
	#bsw­_16
(
x
) (((x) & 0x00ffU) << 8 | \

118 ((
x
è& 0xff00Uè>> 8)

	)

119 
	#bsw­_32
(
x
) (((x) & 0x000000ffU) << 24 | \

120 ((
x
) & 0xff000000U) >> 24 | \

121 ((
x
) & 0x0000ff00U) << 8 | \

122 ((
x
è& 0x00ff0000Uè>> 8)

	)

123 
	#bsw­_64
(
x
) (((x) & 0x00000000000000ffULL) << 56 | \

124 ((
x
) & 0xff00000000000000ULL) >> 56 | \

125 ((
x
) & 0x000000000000ff00ULL) << 40 | \

126 ((
x
) & 0x00ff000000000000ULL) >> 40 | \

127 ((
x
) & 0x0000000000ff0000ULL) << 24 | \

128 ((
x
) & 0x0000ff0000000000ULL) >> 24 | \

129 ((
x
) & 0x00000000ff000000ULL) << 8 | \

130 ((
x
è& 0x000000ff00000000ULLè>> 8)

	)

132 #ià!
defšed
(
__KLIBC__
)

133 #ià
BYTE_ORDER
 =ğ
LITTLE_ENDIAN


134 
	#__ıu_to_Ë16
(
_x
è()(_x)

	)

135 
	#__ıu_to_Ë32
(
_x
è()(_x)

	)

136 
	#__ıu_to_Ë64
(
_x
è()(_x)

	)

137 
	#__Ë16_to_ıu
(
_x
è()(_x)

	)

138 
	#__Ë32_to_ıu
(
_x
è()(_x)

	)

139 
	#__Ë64_to_ıu
(
_x
è()(_x)

	)

141 
	#__ıu_to_be16
(
_x
è
	`bsw­_16
(_x)

	)

142 
	#__ıu_to_be32
(
_x
è
	`bsw­_32
(_x)

	)

143 
	#__ıu_to_be64
(
_x
è
	`bsw­_64
(_x)

	)

144 
	#__be16_to_ıu
(
_x
è
	`bsw­_16
(_x)

	)

145 
	#__be32_to_ıu
(
_x
è
	`bsw­_32
(_x)

	)

146 
	#__be64_to_ıu
(
_x
è
	`bsw­_64
(_x)

	)

147 #–ià
BYTE_ORDER
 =ğ
BIG_ENDIAN


148 
	#__ıu_to_Ë16
(
_x
è
	`bsw­_16
(_x)

	)

149 
	#__ıu_to_Ë32
(
_x
è
	`bsw­_32
(_x)

	)

150 
	#__ıu_to_Ë64
(
_x
è
	`bsw­_64
(_x)

	)

151 
	#__Ë16_to_ıu
(
_x
è
	`bsw­_16
(_x)

	)

152 
	#__Ë32_to_ıu
(
_x
è
	`bsw­_32
(_x)

	)

153 
	#__Ë64_to_ıu
(
_x
è
	`bsw­_64
(_x)

	)

155 
	#__ıu_to_be16
(
_x
è()(_x)

	)

156 
	#__ıu_to_be32
(
_x
è()(_x)

	)

157 
	#__ıu_to_be64
(
_x
è()(_x)

	)

158 
	#__be16_to_ıu
(
_x
è()(_x)

	)

159 
	#__be32_to_ıu
(
_x
è()(_x)

	)

160 
	#__be64_to_ıu
(
_x
è()(_x)

	)

171 
	#mš
(
x
, 
y
) ({ \

172 
	`ty³of
(
x
è
_mš1
 = (x); \

173 
	`ty³of
(
y
è
_mš2
 = (y); \

174 (è(&
_mš1
 =ğ&
_mš2
); \

175 
_mš1
 < 
_mš2
 ? _mš1 : _mš2; })

	)

177 
	#max
(
x
, 
y
) ({ \

178 
	`ty³of
(
x
è
_max1
 = (x); \

179 
	`ty³of
(
y
è
_max2
 = (y); \

180 (è(&
_max1
 =ğ&
_max2
); \

181 
_max1
 > 
_max2
 ? _max1 : _max2; })

	)

183 
	#ARRAY_SIZE
(
x
è((x)/(x[0]))

	)

186 
	smdšfo
 {

187 
mdu_¬¿y_šfo_t
 
	m¬¿y
;

188 
mdu_disk_šfo_t
 
	mdisk
;

189 
__u64
 
	mev’ts
;

190 
	muuid
[4];

191 
	mÇme
[33];

192 
	md©a_off£t
;

193 
	mÃw_d©a_off£t
;

194 
	mcompÚ’t_size
;

197 
	mcu¡om_¬¿y_size
;

200 
	#NO_RESHAPE
 0

	)

201 
	#VOLUME_RESHAPE
 1

	)

202 
	#CONTAINER_RESHAPE
 2

	)

203 
	#RESHAPE_NO_BACKUP
 16

	)

204 
	m»sh­e_aùive
;

205 
	m»sh­e_´og»ss
;

206 
	m»cov”y_blocked
;

218 
	m¥aû_befÜe
, 
	m¥aû_aá”
;

220 
	m»sync_¡¬t
;

221 
	m»cov”y_¡¬t
;

222 
	#MaxSeùÜ
 (~0ULLè

	)

224 
	mb™m­_off£t
;

225 
	m§ã_mode_d–ay
;

226 
	mÃw_Ëv–
, 
	md–_disks
, 
	mÃw_Ïyout
, 
	mÃw_chunk
;

227 
	m”rÜs
;

228 
	mÿche_size
;

229 
	mmism©ch_út
;

230 
	m‹xt_v”siÚ
[50];

232 
	mcÚš”_memb”
;

235 
	mcÚš”_’ough
;

238 
	msys_Çme
[20];

239 
mdšfo
 *
	mdevs
;

240 
mdšfo
 *
	mÃxt
;

243 
	m»cov”y_fd
;

244 
	m¡©e_fd
;

245 
	#DS_FAULTY
 1

	)

246 
	#DS_INSYNC
 2

	)

247 
	#DS_WRITE_MOSTLY
 4

	)

248 
	#DS_SPARE
 8

	)

249 
	#DS_BLOCKED
 16

	)

250 
	#DS_REMOVE
 1024

	)

251 
	#DS_UNBLOCK
 2048

	)

252 
	m´ev_¡©e
, 
	mcu¼_¡©e
, 
	mÃxt_¡©e
;

256 
	sü—‹šfo
 {

257 
	muid
;

258 
	mgid
;

259 
	mautof
;

260 
	mmode
;

261 
	msymlšks
;

262 
	mÇmes
;

263 
	mbbli¡
;

264 
su³¹y³
 *
	msu³¹y³
;

267 
	#Name
 "mdadm"

	)

269 
	emode
 {

270 
	mASSEMBLE
=1,

271 
	mBUILD
,

272 
	mCREATE
,

273 
	mMANAGE
,

274 
	mMISC
,

275 
	mMONITOR
,

276 
	mGROW
,

277 
	mINCREMENTAL
,

278 
	mAUTODETECT
,

279 
	mmode_couÁ


282 
	e´efix_¡ªd¬d
 {

283 
	mJEDEC
,

284 
	mIEC


297 
	#UnS‘
 (0xffã)

	)

298 
	smddev_id’t
 {

299 *
	mdevÇme
;

301 
	muuid_£t
;

302 
	muuid
[4];

303 
	mÇme
[33];

305 
	msu³r_mšÜ
;

307 *
	mdeviûs
;

310 
	mËv–
;

311 
	m¿id_disks
;

312 
	m¥¬e_disks
;

313 
su³¹y³
 *
	m¡
;

314 
	mautof
;

315 *
	m¥¬e_group
;

316 *
	mb™m­_fe
;

317 
	mb™m­_fd
;

319 *
	mcÚš”
;

324 *
	mmemb”
;

326 
mddev_id’t
 *
	mÃxt
;

329 
	mas£mbËd
;

333 
	scÚ‹xt
 {

334 
	m»adÚly
;

335 
	mrun¡İ
;

336 
	mv”bo£
;

337 
	mbr›f
;

338 
	mfÜû
;

339 *
	mhomeho¡
;

340 
	m»quœe_homeho¡
;

341 *
	m´eãr
;

342 
	m_expÜt
;

343 
	m‹¡
;

344 *
	msub¬¿y
;

345 *
	mupd©e
;

346 
	msÿn
;

347 
	mS·rcAdju¡
;

348 
	mautof
;

349 
	md–ay
;

350 
	mä“ze_»sh­e
;

351 *
	mbackup_fe
;

352 
	mšv®id_backup
;

353 *
	maùiÚ
;

356 
	ssh­e
 {

357 
	m¿iddisks
;

358 
	m¥¬edisks
;

359 
	mËv–
;

360 
	mÏyout
;

361 *
	mÏyout_¡r
;

362 
	mchunk
;

363 
	mb™m­_chunk
;

364 *
	mb™m­_fe
;

365 
	massume_ş—n
;

366 
	mwr™e_behšd
;

367 
	msize
;

371 
	smddev_dev
 {

372 *
	mdevÇme
;

373 
	mdi¥os™iÚ
;

377 
	mwr™emo¡ly
;

378 
	mu£d
;

379 
	md©a_off£t
;

380 
mddev_dev
 *
	mÃxt
;

383 
	sm­pšg
 {

384 *
	mÇme
;

385 
	mnum
;

386 } 
	tm­pšg_t
;

388 
	smd¡©_’t
 {

389 *
	mdev
;

390 
	mdevnm
[32];

391 
	maùive
;

392 *
	mËv–
;

393 *
	m·‰”n
;

394 
	m³rûÁ
;

395 
	m»sync
;

396 
	mdevút
;

397 
	m¿id_disks
;

398 * 
	mm‘ad©a_v”siÚ
;

399 
	sdev_memb”
 {

400 *
	mÇme
;

401 
dev_memb”
 *
	mÃxt
;

402 } *
	mmemb”s
;

403 
md¡©_’t
 *
	mÃxt
;

406 
md¡©_’t
 *
md¡©_»ad
(
hŞd
, 
¡¬t
);

407 
md¡©_şo£
();

408 
ä“_md¡©
(
md¡©_’t
 *
ms
);

409 
md¡©_wa™
(
£cÚds
);

410 
md¡©_wa™_fd
(
fd
, cÚ¡ 
sig£t_t
 *
sigmask
);

411 
mddev_busy
(*
devnm
);

412 
md¡©_’t
 *
md¡©_by_compÚ’t
(*
Çme
);

413 
md¡©_’t
 *
md¡©_by_subdev
(*
subdev
, *
cÚš”
);

415 
	sm­_’t
 {

416 
m­_’t
 *
	mÃxt
;

417 
	mdevnm
[32];

418 
	mm‘ad©a
[20];

419 
	muuid
[4];

420 
	mbad
;

421 *
	m·th
;

423 
m­_upd©e
(
m­_’t
 **
mµ
, *
devnm
, *
m‘ad©a
,

424 
uuid
[4], *
·th
);

425 
m­_»move
(
m­_’t
 **
m­
, *
devnm
);

426 
m­_’t
 *
m­_by_uuid
(m­_’ˆ**
m­
, 
uuid
[4]);

427 #ifdeà
MDASSEMBLE


428 
šlše
 
m­_’t
 *
	$m­_by_devnm
(
m­_’t
 **
m­
, *
Çme
)

430  
NULL
;

431 
	}
}

432 
šlše
 
	$m­_ä“
(
m­_’t
 *
m­
)

434 
	}
}

436 
m­_’t
 *
m­_by_devnm
(m­_’ˆ**
m­
, *
devnm
);

437 
m­_ä“
(
m­_’t
 *
m­
);

439 
m­_’t
 *
m­_by_Çme
(m­_’ˆ**
m­
, *
Çme
);

440 
m­_»ad
(
m­_’t
 **
m–p
);

441 
m­_wr™e
(
m­_’t
 *
m–
);

442 
m­_d–‘e
(
m­_’t
 **
m­p
, *
devnm
);

443 
m­_add
(
m­_’t
 **
m–p
,

444 *
devnm
, *
m‘ad©a
, 
uuid
[4], *
·th
);

445 
m­_lock
(
m­_’t
 **
m–p
);

446 
m­_uÆock
(
m­_’t
 **
m–p
);

447 
m­_fÜk
();

450 
	esysfs_»ad_æags
 {

451 
	mGET_LEVEL
 = (1 << 0),

452 
	mGET_LAYOUT
 = (1 << 1),

453 
	mGET_COMPONENT
 = (1 << 2),

454 
	mGET_CHUNK
 = (1 << 3),

455 
	mGET_CACHE
 = (1 << 4),

456 
	mGET_MISMATCH
 = (1 << 5),

457 
	mGET_VERSION
 = (1 << 6),

458 
	mGET_DISKS
 = (1 << 7),

459 
	mGET_DEGRADED
 = (1 << 8),

460 
	mGET_SAFEMODE
 = (1 << 9),

461 
	mGET_BITMAP_LOCATION
 = (1 << 10),

463 
	mGET_DEVS
 = (1 << 20),

464 
	mGET_OFFSET
 = (1 << 21),

465 
	mGET_SIZE
 = (1 << 22),

466 
	mGET_STATE
 = (1 << 23),

467 
	mGET_ERROR
 = (1 << 24),

473 
sysfs_İ’
(*
devnm
, *
devÇme
, *
©Œ
);

474 
sysfs_š™
(
mdšfo
 *
mdi
, 
fd
, *
devnm
);

475 
sysfs_ä“
(
mdšfo
 *
¤a
);

476 
mdšfo
 *
sysfs_»ad
(
fd
, *
devnm
, 
İtiÚs
);

477 
sysfs_©Œ_m©ch
(cÚ¡ *
©Œ
, cÚ¡ *
¡r
);

478 
sysfs_m©ch_wÜd
(cÚ¡ *
wÜd
, **
li¡
);

479 
sysfs_£t_¡r
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

480 *
Çme
, *
v®
);

481 
sysfs_£t_num
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

482 *
Çme
, 
v®
);

483 
sysfs_£t_num_sigÃd
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

484 *
Çme
, 
v®
);

485 
sysfs_uev’t
(
mdšfo
 *
¤a
, *
ev’t
);

486 
sysfs_g‘_fd
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

487 *
Çme
);

488 
sysfs_fd_g‘_Î
(
fd
, *
v®
);

489 
sysfs_g‘_Î
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

490 *
Çme
, *
v®
);

491 
sysfs_fd_g‘_two
(
fd
, *
v1
, *
v2
);

492 
sysfs_g‘_two
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

493 *
Çme
, *
v1
, *
v2
);

494 
sysfs_fd_g‘_¡r
(
fd
, *
v®
, 
size
);

495 
sysfs_©Œibu‹_avaabË
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

496 *
Çme
);

497 
sysfs_g‘_¡r
(
mdšfo
 *
¤a
, mdšfØ*
dev
,

498 *
Çme
, *
v®
, 
size
);

499 
sysfs_£t_§ãmode
(
mdšfo
 *
¤a
, 
ms
);

500 
sysfs_£t_¬¿y
(
mdšfo
 *
šfo
, 
v”s
);

501 
sysfs_add_disk
(
mdšfo
 *
¤a
, mdšfØ*
sd
, 
»sume
);

502 
sysfs_disk_to_scsi_id
(
fd
, 
__u32
 *
id
);

503 
sysfs_unique_hŞd”
(*
devnm
, 
rdev
);

504 
sysfs_ä“ze_¬¿y
(
mdšfo
 *
¤a
);

505 
sysfs_wa™
(
fd
, *
m£c
);

506 
lßd_sys
(*
·th
, *
buf
);

507 
»sh­e_´•¬e_fdli¡
(*
devÇme
,

508 
mdšfo
 *
¤a
,

509 
¿id_disks
,

510 
Ädisks
,

511 
blocks
,

512 *
backup_fe
,

513 *
fdli¡
,

514 *
off£ts
);

515 
»sh­e_ä“_fdli¡
(*
fdli¡
,

516 *
off£ts
,

517 
size
);

518 
»sh­e_İ’_backup_fe
(*
backup
,

519 
fd
,

520 *
devÇme
,

521 
blocks
,

522 *
fdli¡
,

523 *
off£ts
,

524 *
sysfs_Çme
,

525 
»¡¬t
);

526 
compu‹_backup_blocks
(
nchunk
, 
ochunk
,

527 
nd©a
, 
od©a
);

528 *
loÿ‹_backup
(*
Çme
);

529 *
make_backup
(*
Çme
);

531 
§ve_¡res
(*
sourû
, *
off£ts
,

532 
¿id_disks
, 
chunk_size
, 
Ëv–
, 
Ïyout
,

533 
nwr™es
, *
de¡
,

534 
¡¬t
, 
Ëngth
,

535 *
buf
);

536 
»¡Üe_¡res
(*
de¡
, *
off£ts
,

537 
¿id_disks
, 
chunk_size
, 
Ëv–
, 
Ïyout
,

538 
sourû
, 
»ad_off£t
,

539 
¡¬t
, 
Ëngth
,

540 *
¤c_buf
);

542 #iâdeà
S’dma


543 
	#S’dma
 "/u¤/lib/£ndma -t"

	)

546 
	#SYSLOG_FACILITY
 
LOG_DAEMON


	)

548 *
m­_num
(
m­pšg_t
 *
m­
, 
num
);

549 
m­_Çme
(
m­pšg_t
 *
m­
, *
Çme
);

550 
m­pšg_t
 
r5Ïyout
[], 
r6Ïyout
[], 
³rs
[], 
modes
[], 
çuÉyÏyout
[];

552 *
m­_dev_´eã¼ed
(
majÜ
, 
mšÜ
, 
ü—‹
,

553 *
´eãr
);

554 
šlše
 *
	$m­_dev
(
majÜ
, 
mšÜ
, 
ü—‹
)

556  
	`m­_dev_´eã¼ed
(
majÜ
, 
mšÜ
, 
ü—‹
, 
NULL
);

557 
	}
}

559 
	gaùive_¬¿y
;

560 
	gm‘ad©a_upd©e
;

578 
	s»sh­e
 {

579 
	mËv–
;

580 
	m·r™y
;

582 
	mÏyout
;

583 
	md©a_disks
;

584 } 
	mbefÜe
, 
	maá”
;

585 
	mbackup_blocks
;

586 
	mmš_off£t_chªge
;

587 
	m¡res
;

588 
	mÃw_size
;

618 
	ssu³rsw™ch
 {

623 (*
examše_su³r
)(
su³¹y³
 *
¡
, *
homeho¡
);

624 (*
examše_su³r_»suÉ
)(
su³¹y³
 *
¡
, *
homeho¡
, 
examše_»suÉ
 *
»suÉli¡
);

625 (*
br›f_examše_su³r
)(
su³¹y³
 *
¡
, 
v”bo£
);

626 (*
br›f_examše_sub¬¿ys
)(
su³¹y³
 *
¡
, 
v”bo£
);

627 (*
expÜt_examše_su³r
)(
su³¹y³
 *
¡
);

628 (*
examše_badblocks
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

629 (*
cİy_m‘ad©a
)(
su³¹y³
 *
¡
, 
äom
, 
to
);

634 (*
d‘a_su³r
)(
su³¹y³
 *
¡
, *
homeho¡
);

635 (*
br›f_d‘a_su³r
)(
su³¹y³
 *
¡
);

636 (*
expÜt_d‘a_su³r
)(
su³¹y³
 *
¡
);

639 (*
d‘a_¶©fÜm
)(
v”bo£
, 
’um”©e_Úly
, *
cÚŒŞËr_·th
);

640 (*
expÜt_d‘a_¶©fÜm
)(
v”bo£
, *
cÚŒŞËr_·th
);

647 (*
uuid_äom_su³r
)(
su³¹y³
 *
¡
, 
uuid
[4]);

664 (*
g‘šfo_su³r
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
, *
m­
);

665 
mdšfo
 *(*
g‘šfo_su³r_disks
)(
su³¹y³
 *
¡
);

669 (*
m©ch_home
)(
su³¹y³
 *
¡
, *
homeho¡
);

699 (*
upd©e_su³r
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
,

700 *
upd©e
,

701 *
devÇme
, 
v”bo£
,

702 
uuid_£t
, *
homeho¡
);

709 (*
š™_su³r
)(
su³¹y³
 *
¡
, 
mdu_¬¿y_šfo_t
 *
šfo
,

710 
size
, *
Çme
,

711 *
homeho¡
, *
uuid
,

712 
d©a_off£t
);

717 (*
add_to_su³r
)(
su³¹y³
 *
¡
, 
mdu_disk_šfo_t
 *
dšfo
,

718 
fd
, *
devÇme
,

719 
d©a_off£t
);

723 (*
»move_äom_su³r
)(
su³¹y³
 *
¡
, 
mdu_disk_šfo_t
 *
dšfo
);

728 (*
¡Üe_su³r
)(
su³¹y³
 *
¡
, 
fd
);

732 (*
wr™e_š™_su³r
)(
su³¹y³
 *
¡
);

740 (*
com·»_su³r
)(
su³¹y³
 *
¡
, su³¹y³ *
t¡
);

743 (*
lßd_su³r
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

747 (*
lßd_cÚš”
)(
su³¹y³
 *
¡
, 
fd
, *
devÇme
);

750 
su³¹y³
 * (*
m©ch_m‘ad©a_desc
)(*
¬g
);

759 
__u64
 (*
ava_size
)(
su³¹y³
 *
¡
, __u64 
size
,

760 
d©a_off£t
);

765 (*
mš_acû±abË_¥¬e_size
)(
su³¹y³
 *
¡
);

772 (*
add_š‹º®_b™m­
)(
su³¹y³
 *
¡
, *
chunkp
,

773 
d–ay
, 
wr™e_behšd
,

774 
size
, 
may_chªge
, 
majÜ
);

778 (*
loÿ‹_b™m­
)(
su³¹y³
 *
¡
, 
fd
);

782 (*
wr™e_b™m­
)(
su³¹y³
 *
¡
, 
fd
);

784 (*
ä“_su³r
)(
su³¹y³
 *
¡
);

801 (*
v®id©e_geom‘ry
)(
su³¹y³
 *
¡
, 
Ëv–
, 
Ïyout
,

802 
¿iddisks
,

803 *
chunk
, 
size
,

804 
d©a_off£t
,

805 *
subdev
, *
ä“size
,

806 
v”bo£
);

811 
mdšfo
 *(*
cÚš”_cÚ‹Á
)(
su³¹y³
 *
¡
, *
sub¬¿y
);

813 (*
deçuÉ_geom‘ry
)(
su³¹y³
 *
¡
, *
Ëv–
, *
Ïyout
, *
chunk
);

815 (*
kl_sub¬¿y
)(
su³¹y³
 *
¡
);

817 (*
upd©e_sub¬¿y
)(
su³¹y³
 *
¡
, *
sub¬¿y
,

818 *
upd©e
, 
mddev_id’t
 *
id’t
);

824 
	#APPLY_METADATA_CHANGES
 1

	)

825 
	#ROLLBACK_METADATA_CHANGES
 0

	)

827 (*
»sh­e_su³r
)(
su³¹y³
 *
¡
,

828 
size
, 
Ëv–
,

829 
Ïyout
, 
chunksize
, 
¿id_disks
,

830 
d–_disks
, *
backup
, *
dev
,

831 
dœeùiÚ
,

832 
v”bo£
);

833 (*
mªage_»sh­e
)(

834 
afd
, 
mdšfo
 *
¤a
, 
»sh­e
 *reshape,

835 
su³¹y³
 *
¡
, 
blocks
,

836 *
fds
, *
off£ts
,

837 
de¡s
, *
de¡fd
, *
de¡off£ts
);

840 (*
İ’_Ãw
)(
su³¹y³
 *
c
, 
aùive_¬¿y
 *
a
,

841 *
š¡
);

854 (*
£t_¬¿y_¡©e
)(
aùive_¬¿y
 *
a
, 
cÚsi¡’t
);

863 (*
£t_disk
)(
aùive_¬¿y
 *
a
, 
n
, 
¡©e
);

864 (*
sync_m‘ad©a
)(
su³¹y³
 *
¡
);

865 (*
´oûss_upd©e
)(
su³¹y³
 *
¡
,

866 
m‘ad©a_upd©e
 *
upd©e
);

870 (*
´•¬e_upd©e
)(
su³¹y³
 *
¡
,

871 
m‘ad©a_upd©e
 *
upd©e
);

880 
mdšfo
 *(*
aùiv©e_¥¬e
)(
aùive_¬¿y
 *
a
,

881 
m‘ad©a_upd©e
 **
upd©es
);

896 cÚ¡ *(*
g‘_disk_cÚŒŞËr_domaš
)(cÚ¡ *
·th
);

899 (*
»cov”_backup
)(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
);

902 (*
v®id©e_cÚš”
)(
mdšfo
 *
šfo
);

904 
sw­uuid
;

905 
ex‹º®
;

906 cÚ¡ *
Çme
;

907 } *
su³¾i¡
[];

909 
su³rsw™ch
 
su³r0
, 
su³r1
;

910 
su³rsw™ch
 
su³r_imsm
, 
su³r_ddf
;

911 
su³rsw™ch
 
mbr
, 
g±
;

913 
	sm‘ad©a_upd©e
 {

914 
	mËn
;

915 *
	mbuf
;

916 *
	m¥aû
;

917 **
	m¥aû_li¡
;

920 
m‘ad©a_upd©e
 *
	mÃxt
;

940 
	ssu³¹y³
 {

941 
su³rsw™ch
 *
	mss
;

942 
	mmšÜ_v”siÚ
;

943 
	mmax_devs
;

944 
	mcÚš”_devnm
[32];

945 *
	msb
;

946 *
	mšfo
;

947 *
	mÙh”
;

948 
	mdevsize
;

949 
	md©a_off£t
;

950 
	mignÜe_hw_com·t
;

955 
m‘ad©a_upd©e
 *
	mupd©es
;

956 
m‘ad©a_upd©e
 **
	mupd©e_
;

959 
aùive_¬¿y
 *
	m¬¿ys
;

960 
	msock
;

961 
	mdevnm
[32];

964 
	mdevút
;

965 
	m»Œy_soÚ
;

967 
mdšfo
 *
	mdevs
;

971 
su³¹y³
 *
su³r_by_fd
(
fd
, **
sub¬¿y
);

972 
	eguess_ty³s
 { 
	mguess_ªy
, 
	mguess_¬¿y
, 
	mguess_·¹™iÚs
 };

973 
su³¹y³
 *
guess_su³r_ty³
(
fd
, 
guess_ty³s
 
guess_ty³
);

974 
šlše
 
su³¹y³
 *
	$guess_su³r
(
fd
) {

975  
	`guess_su³r_ty³
(
fd
, 
guess_ªy
);

976 
	}
}

977 
su³¹y³
 *
dup_su³r
(su³¹y³ *
¡
);

978 
g‘_dev_size
(
fd
, *
dÇme
, *
siz•
);

979 
mu¡_be_cÚš”
(
fd
);

980 
dev_size_äom_id
(
dev_t
 
id
, *
size
);

981 
wa™_fÜ
(*
dev
, 
fd
);

989 
	sdev_pŞicy
 {

990 
dev_pŞicy
 *
	mÃxt
;

991 *
	mÇme
;

996 cÚ¡ *
	mm‘ad©a
;

997 cÚ¡ *
	mv®ue
;

1000 
pŞ_aù
[], 
pŞ_domaš
[], 
pŞ_m‘ad©a
[], 
pŞ_auto
[];

1006 
	#pŞ_fÜ_—ch
(
™em
, 
li¡
, 
_m‘ad©a
) \

1007 
™em
 = 
li¡
; \

1008 
™em
 && i‹m->
Çme
 =ğ
li¡
->name; \

1009 
™em
 = i‹m->
Ãxt
) \

1010 ià(!(!
_m‘ad©a
 || !
™em
->
m‘ad©a
 || _metadata == item->metadata)) \

1011 ; 

	)

1017 
	spŞ_ruË
 {

1018 
pŞ_ruË
 *
	mÃxt
;

1019 *
	mty³
;

1020 
	sruË
 {

1021 
ruË
 *
	mÃxt
;

1022 *
	mÇme
;

1023 *
	mv®ue
;

1024 *
	mdups
;

1025 } *
	mruË
;

1028 
ruË_pŞicy
[], 
ruË_·¹
[];

1029 
ruË_·th
[], 
ruË_ty³
[];

1030 
ty³_·¹
[], 
ty³_disk
[];

1032 
pŞicylše
(*
lše
, *
ty³
);

1033 
pŞicy_add
(*
ty³
, ...);

1034 
pŞicy_ä“
();

1036 
dev_pŞicy
 *
·th_pŞicy
(*
·th
, *
ty³
);

1037 
dev_pŞicy
 *
disk_pŞicy
(
mdšfo
 *
disk
);

1038 
dev_pŞicy
 *
devid_pŞicy
(
devid
);

1039 
dev_pŞicy_ä“
(
dev_pŞicy
 *
p
);

1042 
pŞ_add
(
dev_pŞicy
 **
pŞ
, *
Çme
, *
v®
, *
m‘ad©a
);

1043 
dev_pŞicy
 *
pŞ_fšd
(dev_pŞicy *
pŞ
, *
Çme
);

1045 
	epŞicy_aùiÚ
 {

1046 
	maù_deçuÉ
,

1047 
	maù_šşude
,

1048 
	maù_»_add
,

1049 
	maù_¥¬e
,

1050 
	maù_¥¬e_§me_¦Ù
,

1052 
	maù_fÜû_¥¬e
,

1053 
	maù_”r


1056 
pŞicy_aùiÚ_®lows
(
dev_pŞicy
 *
¶i¡
, cÚ¡ *
m‘ad©a
,

1057 
pŞicy_aùiÚ
 
wªt
);

1058 
disk_aùiÚ_®lows
(
mdšfo
 *
disk
, cÚ¡ *
m‘ad©a
,

1059 
pŞicy_aùiÚ
 
wªt
);

1061 
	sdomašli¡
 {

1062 
domašli¡
 *
	mÃxt
;

1063 cÚ¡ *
	mdom
;

1066 
domaš_‹¡
(
domašli¡
 *
dom
, 
dev_pŞicy
 *
pŞ
,

1067 cÚ¡ *
m‘ad©a
);

1068 
domašli¡
 *
domaš_äom_¬¿y
(
mdšfo
 *
mdi
,

1069 cÚ¡ *
m‘ad©a
);

1070 
domašli¡_add_dev
(
domašli¡
 **
dom
, 
devid
,

1071 cÚ¡ *
m‘ad©a
);

1072 
domaš_ä“
(
domašli¡
 *
dl
);

1073 
domaš_m”ge
(
domašli¡
 **
domp
, 
dev_pŞicy
 *
pŞ
,

1074 cÚ¡ *
m‘ad©a
);

1075 
domaš_add
(
domašli¡
 **
domp
, *
domaš
);

1077 
pŞicy_§ve_·th
(*
id_·th
, 
m­_’t
 *
¬¿y
);

1078 
pŞicy_check_·th
(
mdšfo
 *
disk
, 
m­_’t
 *
¬¿y
);

1080 #ià
__GNUC__
 < 3

1081 
	g¡©64
;

1084 
	#HAVE_NFTW
 
we
 
assume


	)

1085 
	#HAVE_FTW


	)

1087 #ifdeà
__UCLIBC__


1088 
	~<ã©u»s.h
>

1089 #iâdeà
__UCLIBC_HAS_LFS__


1090 
	#l£ek64
 
l£ek


	)

1092 #iâdeà 
__UCLIBC_HAS_FTW__


1093 #undeà
HAVE_FTW


1094 #undeà
HAVE_NFTW


1098 #ifdeà
__d›ibc__


1099 #undeà
HAVE_NFTW


1102 #ià
defšed
(
__KLIBC__
)

1103 #undeà
HAVE_NFTW


1104 #undeà
HAVE_FTW


1107 #iâdeà
HAVE_NFTW


1108 
	#FTW_PHYS
 1

	)

1109 #iâdeà
HAVE_FTW


1110 
	sFTW
 {};

1114 #ifdeà
HAVE_FTW


1115 
	~<áw.h
>

1118 
add_dev
(cÚ¡ *
Çme
, cÚ¡ 
¡©
 *
¡b
, 
æag
, 
FTW
 *
s
);

1120 
Mªage_ro
(*
devÇme
, 
fd
, 
»adÚly
);

1121 
Mªage_run
(*
devÇme
, 
fd
, 
cÚ‹xt
 *
c
);

1122 
Mªage_¡İ
(*
devÇme
, 
fd
, 
qu›t
,

1123 
wl_»Œy
);

1124 
Mªage_subdevs
(*
devÇme
, 
fd
,

1125 
mddev_dev
 *
devli¡
, 
v”bo£
, 
‹¡
,

1126 *
upd©e
, 
fÜû
);

1127 
autod‘eù
();

1128 
Grow_Add_deviû
(*
devÇme
, 
fd
, *
Ãwdev
);

1129 
Grow_addb™m­
(*
devÇme
, 
fd
,

1130 
cÚ‹xt
 *
c
, 
sh­e
 *
s
);

1131 
Grow_»sh­e
(*
devÇme
, 
fd
,

1132 
mddev_dev
 *
devli¡
,

1133 
d©a_off£t
,

1134 
cÚ‹xt
 *
c
, 
sh­e
 *
s
);

1135 
Grow_»¡¬t
(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
,

1136 *
fdli¡
, 
út
, *
backup_fe
, 
v”bo£
);

1137 
Grow_cÚtšue
(
mdfd
, 
su³¹y³
 *
¡
,

1138 
mdšfo
 *
šfo
, *
backup_fe
,

1139 
fÜked
, 
ä“ze_»sh­e
);

1141 
»¡Üe_backup
(
su³¹y³
 *
¡
,

1142 
mdšfo
 *
cÚ‹Á
,

1143 
wÜkšg_disks
,

1144 
¥¬es
,

1145 **
backup_f•
,

1146 
v”bo£
);

1147 
Grow_cÚtšue_commªd
(*
devÇme
, 
fd
,

1148 *
backup_fe
, 
v”bo£
);

1150 
As£mbË
(
su³¹y³
 *
¡
, *
mddev
,

1151 
mddev_id’t
 *
id’t
,

1152 
mddev_dev
 *
devli¡
,

1153 
cÚ‹xt
 *
c
);

1155 
Bud
(*
mddev
, 
mddev_dev
 *
devli¡
,

1156 
sh­e
 *
s
, 
cÚ‹xt
 *
c
);

1158 
C»©e
(
su³¹y³
 *
¡
, *
mddev
,

1159 *
Çme
, *
uuid
,

1160 
subdevs
, 
mddev_dev
 *
devli¡
,

1161 
sh­e
 *
s
,

1162 
cÚ‹xt
 *
c
,

1163 
d©a_off£t
);

1165 
D‘a
(*
dev
, 
cÚ‹xt
 *
c
);

1166 
D‘a_PÏtfÜm
(
su³rsw™ch
 *
ss
, 
sÿn
, 
v”bo£
, 
_expÜt
, *
cÚŒŞËr_·th
);

1167 
D‘a_ToA¼ayD‘a
(cÚ¡ *
dev
, 
cÚ‹xt
 *
c
, 
¬¿y_d‘a
 *
ad
);

1168 
Qu”y
(*
dev
);

1169 
ExamšeBadblocks
(*
devÇme
, 
br›f
, 
su³¹y³
 *
fÜû¡
);

1170 
Examše
(
mddev_dev
 *
devli¡
, 
cÚ‹xt
 *
c
,

1171 
su³¹y³
 *
fÜû¡
);

1172 
Examše_ToResuÉ
(
mddev_dev
 *
devli¡
,

1173 
cÚ‹xt
 *
c
,

1174 
su³¹y³
 *
fÜû¡
,

1175 
examše_»suÉ
 *
»suÉ
);

1176 
MÚ™Ü
(
mddev_dev
 *
devli¡
,

1177 *
maaddr
, *
®”t_cmd
,

1178 
cÚ‹xt
 *
c
,

1179 
d«mÚi£
, 
ÚeshÙ
,

1180 
dosy¦og
, *
pidfe
, 
šüem’ts
,

1181 
sh¬e
);

1183 
Kl
(*
dev
, 
su³¹y³
 *
¡
, 
fÜû
, 
v”bo£
, 
nÛxş
);

1184 
Kl_sub¬¿y
(*
dev
, *
sub¬¿y
, 
v”bo£
);

1185 
Upd©e_sub¬¿y
(*
dev
, *
sub¬¿y
, *
upd©e
, 
mddev_id’t
 *
id’t
, 
qu›t
);

1186 
Wa™
(*
dev
);

1187 
Wa™CËª
(*
dev
, 
sock
, 
v”bo£
);

1188 
S‘AùiÚ
(*
dev
, *
aùiÚ
);

1190 
Inüem’l
(
mddev_dev
 *
devli¡
, 
cÚ‹xt
 *
c
,

1191 
su³¹y³
 *
¡
);

1192 
RebudM­
();

1193 
Inüem’lSÿn
(
cÚ‹xt
 *
c
, *
devnm
);

1194 
Inüem’lRemove
(*
devÇme
, *
·th
, 
v”bo£
);

1195 
C»©eB™m­
(*
f’ame
, 
fÜû
, 
uuid
[16],

1196 
chunksize
, 
d«mÚ_¦“p
,

1197 
wr™e_behšd
,

1198 
¬¿y_size
,

1199 
majÜ
);

1200 
ExamšeB™m­
(*
f’ame
, 
br›f
, 
su³¹y³
 *
¡
);

1201 
Wr™e_ruËs
(*
ruË_Çme
);

1202 
b™m­_upd©e_uuid
(
fd
, *
uuid
, 
sw­
);

1203 
b™m­_£ùÜs
(
b™m­_su³r_s
 *
bsb
);

1204 
Dump_m‘ad©a
(*
dev
, *
dœ
, 
cÚ‹xt
 *
c
,

1205 
su³¹y³
 *
¡
);

1206 
Re¡Üe_m‘ad©a
(*
dev
, *
dœ
, 
cÚ‹xt
 *
c
,

1207 
su³¹y³
 *
¡
, 
Úly
);

1209 
md_g‘_v”siÚ
(
fd
);

1210 
g‘_lšux_v”siÚ
();

1211 
mdadm_v”siÚ
(*
v”siÚ
);

1212 
·r£_size
(*
size
);

1213 
·r£_uuid
(*
¡r
, 
uuid
[4]);

1214 
·r£_Ïyout_10
(*
Ïyout
);

1215 
·r£_Ïyout_çuÉy
(*
Ïyout
);

1216 
·r£_num
(*
num
);

1217 
check_ext2
(
fd
, *
Çme
);

1218 
check_»i£r
(
fd
, *
Çme
);

1219 
check_¿id
(
fd
, *
Çme
);

1220 
check_·¹™iÚs
(
fd
, *
dÇme
,

1221 
ä“size
,

1222 
size
);

1224 
g‘_mdp_majÜ
();

1225 
g‘_maj_mš
(*
dev
, *
majÜ
, *
mšÜ
);

1226 
dev_İ’
(*
dev
, 
æags
);

1227 
İ’_dev
(*
devnm
);

1228 
»İ’_mddev
(
mdfd
);

1229 
İ’_dev_æags
(*
devnm
, 
æags
);

1230 
İ’_dev_exş
(*
devnm
);

1231 
is_¡ªd¬d
(*
dev
, *
nump
);

1232 
§me_dev
(*
Úe
, *
two
);

1233 
com·»_·ths
 (* 
·th1
,* 
·th2
);

1234 
’abË_fds
(
deviûs
);

1236 
·r£_auto
(*
¡r
, *
msg
, 
cÚfig
);

1237 
mddev_id’t
 *
cÚf_g‘_id’t
(*
dev
);

1238 
mddev_dev
 *
cÚf_g‘_devs
();

1239 
cÚf_‹¡_dev
(*
devÇme
);

1240 
cÚf_‹¡_m‘ad©a
(cÚ¡ *
v”siÚ
, 
dev_pŞicy
 *
pŞ
, 
is_homeho¡
);

1241 
ü—‹šfo
 *
cÚf_g‘_ü—‹_šfo
();

1242 
£t_cÚffe
(*
fe
);

1243 *
cÚf_g‘_maaddr
();

1244 *
cÚf_g‘_maäom
();

1245 *
cÚf_g‘_´og¿m
();

1246 *
cÚf_g‘_homeho¡
(*
»quœe_homeho¡p
);

1247 *
cÚf_lše
(
FILE
 *
fe
);

1248 *
cÚf_wÜd
(
FILE
 *
fe
, 
®low_key
);

1249 
´št_quÙed
(*
¡r
);

1250 
´št_esÿ³
(*
¡r
);

1251 
u£_udev
();

1252 
GCD
(
a
, 
b
);

1253 
cÚf_Çme_is_ä“
(*
Çme
);

1254 
cÚf_v”ify_devÇmes
(
mddev_id’t
 *
¬¿y_li¡
);

1255 
devÇme_m©ches
(*
Çme
, *
m©ch
);

1256 
mddev_id’t
 *
cÚf_m©ch
(
su³¹y³
 *
¡
,

1257 
mdšfo
 *
šfo
,

1258 *
devÇme
,

1259 
v”bo£
, *
rvp
);

1260 
ex³rim’l
();

1262 
ä“_lše
(*
lše
);

1263 
m©ch_Úeof
(*
deviûs
, *
devÇme
);

1264 
uuid_äom_su³r
(
uuid
[4], 
mdp_su³r_t
 *
su³r
);

1265 cÚ¡ 
uuid_z”o
[4];

1266 
§me_uuid
(
a
[4], 
b
[4], 
sw­uuid
);

1267 
cİy_uuid
(*
a
, 
b
[4], 
sw­uuid
);

1268 *
__âame_äom_uuid
(
id
[4], 
sw­
, *
buf
, 
£p
);

1269 *
âame_äom_uuid
(
su³¹y³
 *
¡
,

1270 
mdšfo
 *
šfo
, *
buf
, 
£p
);

1271 
ÿlc_csum
(*
su³r
, 
by‹s
);

1272 
’ough
(
Ëv–
, 
¿id_disks
, 
Ïyout
, 
ş—n
,

1273 *
ava
);

1274 
’ough_fd
(
fd
);

1275 
ask
(*
mesg
);

1276 
g‘_compÚ’t_size
(
fd
);

1277 
»move_·¹™iÚs
(
fd
);

1278 
‹¡_·¹™iÚ
(
fd
);

1279 
‹¡_·¹™iÚ_äom_id
(
dev_t
 
id
);

1280 
g‘_d©a_disks
(
Ëv–
, 
Ïyout
, 
¿id_disks
);

1281 
ÿlc_¬¿y_size
(
Ëv–
, 
¿id_disks
, 
Ïyout
,

1282 
chunksize
, 
devsize
);

1283 
æush_m‘ad©a_upd©es
(
su³¹y³
 *
¡
);

1284 
­³nd_m‘ad©a_upd©e
(
su³¹y³
 *
¡
, *
buf
, 
Ën
);

1285 
as£mbË_cÚš”_cÚ‹Á
(
su³¹y³
 *
¡
, 
mdfd
,

1286 
mdšfo
 *
cÚ‹Á
,

1287 
cÚ‹xt
 *
c
,

1288 *
cho£n_Çme
, *
»suÉ
);

1289 
	#INCR_NO
 1

	)

1290 
	#INCR_UNSAFE
 2

	)

1291 
	#INCR_ALREADY
 4

	)

1292 
	#INCR_YES
 8

	)

1293 
mdšfo
 *
cÚš”_choo£_¥¬es
(
su³¹y³
 *
¡
,

1294 
mš_size
,

1295 
domašli¡
 *
domli¡
,

1296 *
¥¬e_group
,

1297 cÚ¡ *
m‘ad©a
, 
g‘_Úe
);

1298 
move_¥¬e
(*
äom_devÇme
, *
to_devÇme
, 
dev_t
 
devid
);

1299 
add_disk
(
mdfd
, 
su³¹y³
 *
¡
,

1300 
mdšfo
 *
¤a
, mdšfØ*
šfo
);

1301 
»move_disk
(
mdfd
, 
su³¹y³
 *
¡
,

1302 
mdšfo
 *
¤a
, mdšfØ*
šfo
);

1303 
£t_¬¿y_šfo
(
mdfd
, 
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
);

1304 
mš_»cov”y_¡¬t
(
mdšfo
 *
¬¿y
);

1306 *
humª_size
(
by‹s
);

1307 *
humª_size_br›f
(
by‹s
, 
´efix
);

1308 
´št_r10_Ïyout
(
Ïyout
);

1310 *
fšd_ä“_devnm
(
u£_·¹™iÚs
);

1312 
put_md_Çme
(*
Çme
);

1313 *
devid2kÇme
(
devid
);

1314 *
devid2devnm
(
devid
);

1315 
devnm2devid
(*
devnm
);

1316 *
g‘_md_Çme
(*
devnm
);

1318 
DeçuÉCÚfFe
[];

1320 
ü—‹_mddev
(*
dev
, *
Çme
, 
autof
, 
Œu¡wÜthy
,

1321 *
cho£n
);

1323 
	#LOCAL
 1

	)

1324 
	#LOCAL_ANY
 10

	)

1325 
	#FOREIGN
 2

	)

1326 
	#METADATA
 3

	)

1327 
İ’_mddev
(*
dev
, 
»pÜt_”rÜs
);

1328 
İ’_cÚš”
(
fd
);

1329 
m‘ad©a_cÚš”_m©ches
(*
m‘ad©a
, *
devnm
);

1330 
m‘ad©a_subdev_m©ches
(*
m‘ad©a
, *
devnm
);

1331 
is_cÚš”_memb”
(
md¡©_’t
 *
’t
, *
devÇme
);

1332 
is_sub¬¿y_aùive
(*
sub¬¿y
, *
devÇme
);

1333 
İ’_sub¬¿y
(*
dev
, *
sub¬¿y
, 
su³¹y³
 *
¡
, 
qu›t
);

1334 
su³rsw™ch
 *
v”siÚ_to_su³rsw™ch
(*
v”s
);

1336 
mdmÚ_ruÂšg
(*
devnm
);

1337 
mdmÚ_pid
(*
devnm
);

1338 
check_’v
(*
Çme
);

1339 
__u32
 
¿ndom32
();

1340 
¡¬t_mdmÚ
(*
devnm
);

1342 
chd_mÚ™Ü
(
afd
, 
mdšfo
 *
¤a
, 
»sh­e
 *reshape,

1343 
su³¹y³
 *
¡
, 
¡res
,

1344 *
fds
, *
off£ts
,

1345 
de¡s
, *
de¡fd
, *
de¡off£ts
);

1346 
abÜt_»sh­e
(
mdšfo
 *
¤a
);

1348 *
su³r1_make_v0
(
su³¹y³
 *
¡
, 
mdšfo
 *
šfo
, 
mdp_su³r_t
 *
sb0
);

1350 
fmt_devÇme
(*
Çme
, 
num
);

1351 *
¡©2devnm
(
¡©
 *
¡
);

1352 *
fd2devnm
(
fd
);

1354 
š_š™rd
();

1356 
	#_ROUND_UP
(
v®
, 
ba£
è(((v®è+ (ba£è- 1è& ~(ba£ - 1))

	)

1357 
	#ROUND_UP
(
v®
, 
ba£
è
	`_ROUND_UP
(v®, (
	`ty³of
(v®))(ba£))

	)

1358 
	#ROUND_UP_PTR
(
±r
, 
ba£
è((
	`ty³of
(ptr)) \

1359 (
	`ROUND_UP
(()(
±r
), 
ba£
)))

	)

1361 
šlše
 
	$is_sub¬¿y
(*
v”s
)

1372  (*
v”s
 == '/' || *vers == '-');

1373 
	}
}

1375 
šlše
 *
	$to_sub¬¿y
(
md¡©_’t
 *
’t
, *
cÚš”
)

1377  &
’t
->
m‘ad©a_v”siÚ
[10+
	`¡¾’
(
cÚš”
)+1];

1378 
	}
}

1380 #ifdeà
DEBUG


1381 
	#d´štf
(
fmt
, 
¬g
...) \

1382 
	`årštf
(
¡d”r
, 
fmt
, ##
¬g
)

	)

1384 
	#d´štf
(
fmt
, 
¬g
...) \

1385 ({ ià(0è
	`årštf
(
¡d”r
, 
fmt
, ##
¬g
); 0; })

	)

1387 
	~<as£¹.h
>

1388 
	~<¡d¬g.h
>

1389 
šlše
 
	$xa¥rštf
(**
¡½
, cÚ¡ *
fmt
, ...) {

1390 
va_li¡
 
­
;

1391 
»t
;

1392 
	`va_¡¬t
(
­
, 
fmt
);

1393 
»t
 = 
	`va¥rštf
(
¡½
, 
fmt
, 
­
);

1394 
	`va_’d
(
­
);

1395 
	`as£¹
(
»t
 >= 0);

1396  
»t
;

1397 
	}
}

1399 #ifdeà
DEBUG


1400 
	#´_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, 
Name
 ": " fmt)

	)

1401 
	#cÚt_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, " " fmt)

	)

1403 
	#´_”r
(
fmt
 ...è({ ià(0è
	`årštf
(
¡d”r
, 
Name
 ": " fmt); })

	)

1404 
	#cÚt_”r
(
fmt
 ...è({ ià(0è
	`årštf
(
¡d”r
, " " fmt); })

	)

1407 *
xm®loc
(
size_t
 
Ën
);

1408 *
x»®loc
(*
±r
, 
size_t
 
Ën
);

1409 *
xÿÎoc
(
size_t
 
num
, size_ˆ
size
);

1410 *
x¡rdup
(cÚ¡ *
¡r
);

1412 
	#LEVEL_MULTIPATH
 (-4)

	)

1413 
	#LEVEL_LINEAR
 (-1)

	)

1414 
	#LEVEL_FAULTY
 (-5)

	)

1417 
	#LEVEL_CONTAINER
 (-100)

	)

1418 
	#LEVEL_UNSUPPORTED
 (-200)

	)

1421 
	#LEVEL_NONE
 (-1000000)

	)

1425 
	#Wr™eT¿ns›Á
 0

	)

1426 
	#R—dT¿ns›Á
 1

	)

1427 
	#Wr™eP”si¡’t
 2

	)

1428 
	#R—dP”si¡’t
 3

	)

1429 
	#Wr™eAÎ
 4

	)

1430 
	#R—dFixabË
 5

	)

1431 
	#Modes
 6

	)

1433 
	#CË¬E¼Üs
 31

	)

1434 
	#CË¬FauÉs
 30

	)

1436 
	#AÎP”si¡
 100

	)

1437 
	#NoP”si¡
 101

	)

1439 
	#ModeMask
 0x1f

	)

1440 
	#ModeShiá
 5

	)

1442 #ifdeà
__TINYC__


1443 #undeà
mšÜ


1444 #undeà
majÜ


1445 #undeà
makedev


1446 
	#mšÜ
(
x
è((x)&0xff)

	)

1447 
	#majÜ
(
x
è(((x)>>8)&0xff)

	)

1448 
	#makedev
(
M
,
m
è(((M)<<8è| (m))

	)

1452 
	#ALGORITHM_LEFT_ASYMMETRIC
 0

	)

1453 
	#ALGORITHM_RIGHT_ASYMMETRIC
 1

	)

1454 
	#ALGORITHM_LEFT_SYMMETRIC
 2

	)

1455 
	#ALGORITHM_RIGHT_SYMMETRIC
 3

	)

1460 
	#ALGORITHM_PARITY_0
 4

	)

1461 
	#ALGORITHM_PARITY_N
 5

	)

1475 
	#ALGORITHM_ROTATING_ZERO_RESTART
 8

	)

1476 
	#ALGORITHM_ROTATING_N_RESTART
 9

	)

1477 
	#ALGORITHM_ROTATING_N_CONTINUE
 10

	)

1484 
	#ALGORITHM_LEFT_ASYMMETRIC_6
 16

	)

1485 
	#ALGORITHM_RIGHT_ASYMMETRIC_6
 17

	)

1486 
	#ALGORITHM_LEFT_SYMMETRIC_6
 18

	)

1487 
	#ALGORITHM_RIGHT_SYMMETRIC_6
 19

	)

1488 
	#ALGORITHM_PARITY_0_6
 20

	)

1489 
	#ALGORITHM_PARITY_N_6
 
ALGORITHM_PARITY_N


	)

1494 #iâdeà
PATH_MAX


1495 
	#PATH_MAX
 4096

	)

1498 
	#RESYNC_NONE
 -1

	)

1499 
	#RESYNC_DELAYED
 -2

	)

1500 
	#RESYNC_PENDING
 -3

	)

1501 
	#RESYNC_UNKNOWN
 -4

	)

1509 
	#MAX_DISKS
 4096

	)

1514 
	#MAX_SIZE
 1

	)

1519 
	#INVALID_SECTORS
 1

	)

1521 
	#VARIABLE_OFFSET
 3

	)

1523 
	#V”siÚ
 "NUUO"

	)

	@libmdadm/mdadm_errcode.h

1 #iâdeà
__MDADM_ERRORCODE__


2 
	#__MDADM_ERRORCODE__


	)

5 
	mSUCCESS
 = 0,

7 
	mCREATE_RAID_LEVEL_UNSET
 = 1,

8 
	mCREATE_RAID_DEVS_NOT_ENOUGH
,

9 
	mCREATE_RAID_DEVS_OVER_256
,

10 
	mCREATE_RAID_DEVS_NOT_EXIST_IN_LIST
,

11 
	mCREATE_SPARE_DEVS_NOT_SUPPORT
,

12 
	mCREATE_LIST_DEVS_MORE_THAN_ARRAY_NEEDED
,

13 
	mCREATE_BITMAP_NOT_MEANINGFUL
,

14 
	mCREATE_RAID_LEVEL_UNKNOWN
,

15 
	mCREATE_GEOMETRY_INVALID
,

16 
	mCREATE_RAID_DEV_CANNOT_OPEN
,

17 
	mCREATE_NOT_BLOCK_DEVICE
,

18 
	mCREATE_UNSUITABLE_STYLE
,

19 
	mCREATE_TOO_MANY_DEVS
,

20 
	mCREATE_NO_FREE_SPACE
,

21 
	mCREATE_FREE_SPACE_SMALL_THAN_GIVEN
,

22 
	mCREATE_WITHOUT_GIVEN_SIZE_DRIVES
,

23 
	mCREATE_DEVS_TOO_LARGE
,

24 
	mCREATE_ABORTED
,

25 
	mCREATE_MISSING_DEVS_NOT_SUPPORT
,

26 
	mCREATE_MDDEV_FAIL
,

27 
	mCREATE_MDDEV_INUSE
,

28 
	mCREATE_MDDEV_UNSET
,

29 
	mCREATE_MDNUM_ILLEGAL
,

30 
	mCREATE_REQUIRE_NEWER_VERSION
,

31 
	mCREATE_INIT_SUPER_FAIL
,

32 
	mCREATE_BITMAP_NOT_SUPPORT
,

33 
	mCREATE_BITMAP_CHUNK_NOT_SUPPORT
,

34 
	mCREATE_OPEN_CONTAINER_FAIL
,

35 
	mCREATE_SET_ARRAY_INFO_FAIL
,

36 
	mCREATE_BITMAP_FAIL
,

37 
	mCREATE_OPEN_BITMAP_FILE_FAIL
,

38 
	mCREATE_SET_BITMAP_FILE_FAIL
,

39 
	mCREATE_ADD_TO_SUPER_FAIL
,

40 
	mCREATE_ADD_NEW_DISK_FAIL
,

41 
	mCREATE_FREE_SUPER_TYPE_OBJ_FAIL
,

42 
	mCREATE_RAID_ACTIVATION_FAIL
,

44 
	mDETAIL_MDDEV_OPEN_FAIL
 = 101,

45 
	mDETAIL_MDDEV_ILLEGAL
,

46 
	mDETAIL_MDDEV_REQUIRE_NEWER_DRIVER
,

47 
	mDETAIL_MDDEV_CANNOT_GET_DETAIL
,

48 
	mDETAIL_NULL_POINTER
,

50 
	mMANAGE_STOP_MD_FAIL
 = 201,

51 
	mMANAGE_MD_IN_USE
,

52 
	mMANAGE_DEVICE_BUSY
,

53 
	mMANAGE_STOP_CONTAINER_FAIL
,

54 
	mMANAGE_GET_ARRAY_INFO_FAIL
,

55 
	mMANAGE_UNSUPPORTED_ARRAY
,

56 
	mMANAGE_NEED_MEANINGFUL_DISPOSITION
,

57 
	mMANAGE_NOT_MEANINGFUL_FOR_R10
,

58 
	mMANAGE_NOT_MEANINGFUL_FOR_ARRAY
,

59 
	mMANAGE_OPEN_SYSFD_FAIL
,

60 
	mMANAGE_CANNOT_FIND_DEV
,

61 
	mMANAGE_NOT_BLOCK_DEV
,

62 
	mMANAGE_CANNOT_OPEN_DEV
,

63 
	mMANAGE_CANNOT_ADD_DISKS_TO_MEMBER_ARRAY
,

64 
	mMANAGE_SET_FAULTY_FAIL
,

65 
	mMANAGE_NO_MATCHING_DEV
,

66 
	mMANAGE_WITH_ARG_FAIL
,

67 
	mMANAGE_CANNOT_REMOVE_DISKS_FROM_MEMBER_ARRAY
,

68 
	mMANAGE_ADD_GET_DEV_SIZE_FAIL
 = 251,

69 
	mMANAGE_ADD_WASTED_DEV_SIZE
,

70 
	mMANAGE_ADD_HOT_ADD_FAIL
,

71 
	mMANAGE_ADD_CANNOT_LOAD_ARRAY_METADATA
,

72 
	mMANAGE_ADD_DEV_SIZE_NOT_LARGE_ENOUGH
,

73 
	mMANAGE_ADD_READD_IMPOSSIBLE
,

74 
	mMANAGE_ADD_ARRAY_FAILED
,

75 
	mMANAGE_ADD_UPDATE_SUPERBLOCK_FAIL
,

76 
	mMANAGE_ADD_WRITE_INIT_SUPERBLOCK_FAIL
,

77 
	mMANAGE_ADD_CANNOT_GET_EXCLUSIVE_ACCESS
,

78 
	mMANAGE_ADD_READ_SYSFS_FAIL
,

79 
	mMANAGE_ADD_ADD_NEW_DEVS_FAIL
,

80 
	mMANAGE_REMOVE_CANNOT_GET_EXCLUSIVE_ACCESS
 = 271,

81 
	mMANAGE_REMOVE_NOT_MEMBER
,

82 
	mMANAGE_REMOVE_IN_USE
,

83 
	mMANAGE_REMOVE_HOT_REMOVE_FAIL
,

84 
	mMANAGE_REMOVE_GET_CONTAINER_NAME_FAIL
,

85 
	mMANAGE_REPLACE_UNSUPPORTED_METADATA_VER
 = 291,

86 
	mMANAGE_REPLACE_CANNOT_FIND_MD_INFO
,

87 
	mMANAGE_REPLACE_DISK_NOT_ACTIVE
,

88 
	mMANAGE_REPLACE_REQUEST_REPLACEMENT_FAIL
,

89 
	mMANAGE_REPLACE_MD_NOT_FOUND
,

90 
	mMANAGE_WITH_CANNOT_FOUND_MD_INFO
 = 311,

91 
	mMANAGE_WITH_FAULTY_DISK
,

92 
	mMANAGE_WITH_ACTIVE_DISK
,

93 
	mMANAGE_WITH_PREFER_REPLACEMENT_FAIL
,

94 
	mMANAGE_WITH_MD_NOT_FOUND
,

97 
	mASSEMBLE_NO_IDENTITY_INFO
 = 401,

98 
	mASSEMBLE_RAID_DEVS_NOT_ENOUGH
,

99 
	mASSEMBLE_NEGATIVE_NUM_DEVICES
,

100 
	mASSEMBLE_SUPER_INFO_IS_NULL
,

101 
	mASSEMBLE_DRIVE_IS_ACTIVE
,

102 
	mASSEMBLE_INVALID_MDFD
,

103 
	mASSEMBLE_KERNEL_UNSUPPORT
,

104 
	mASSEMBLE_MD_ALREADY_ACTIVE
,

105 
	mASSEMBLE_CONTAINER_CONTENT_FAIL
,

106 
	mASSEMBLE_NEGATIVE_DEV_CNT
,

107 
	mASSEMBLE_NO_DEVS_FOR_MD
,

108 
	mASSEMBLE_OPEN_DEV_FAIL
,

109 
	mASSEMBLE_SUPERBLOCK_DISAPPEARED
,

110 
	mASSEMBLE_NO_SUITABLE_DRIVES
,

111 
	mASSEMBLE_REWRITE_SUPERBLOCK_FAIL
,

112 
	mASSEMBLE_FAIL
,

113 
	mASSEMBLE_MDDEV_UNSET
,

114 
	mASSEMBLE_RAID_DEVS_NOT_EXIST_IN_LIST
,

115 
	mASSEMBLE_INVALID_UUID
,

116 
	mASSEMBLE_MDDEV_INUSE
,

117 
	mASSEMBLE_MDNUM_ILLEGAL
,

118 
	mASSEMBLE_INITIALIZE_DEV_LIST_FAIL
,

119 
	mASSEMBLE_FAIL_TO_SET_ARRAY_INFO
,

120 
	mASSEMBLE_FAIL_TO_SET_BITMAP_FILE
,

121 
	mASSEMBLE_FAIL_TO_OPEN_BITMAP_FILE
,

122 
	mASSEMBLE_NEED_BACKUP_FILE
,

123 
	mASSEMBLE_UNDEFINED_ERROR
,

125 
	mKILL_OPEN_DEV_FAIL
 = 501,

126 
	mKILL_NOT_MD_COMPONENT
,

127 
	mKILL_ZERO_SUPERBLOCK_FAIL
,

129 
	mQUERY_OPEN_DEV_FAIL
 = 551,

130 
	mQUERY_NULL_POINTER
,

131 
	mEXAMINE_OPEN_DEV_FAIL
 = 601,

132 
	mEXAMINE_NO_MD_SUPERBLOCK
,

133 
	mEXAMINE_MEM_ALLOC_FAIL
,

134 
	mEXAMINE_NULL_POINTER


	@libmdadm/mdadm_other.h

1 #iâdeà
__MDADM_OTHER_H__


2 
	#__MDAMM_OTHER_H__


	)

4 
	#MAX_DISK_NUM
 64

	)

8 
	mRAID_STATUS_BIT_FUNCTIONAL
 = 0,

9 
	mRAID_STATUS_BIT_DEGRADE
,

10 
	mRAID_STATUS_BIT_FAILED
,

11 
	mRAID_STATUS_BIT_RECOVERING
,

12 
	mRAID_STATUS_BIT_UNMOUNTED
,

13 
	mRAID_STATUS_BIT_UNFORMATED
,

14 
	mRAID_STATUS_BIT_FILESYS_ERR
,

17 
	s¬¿y_disk_šfo
 {

18 
mdu_disk_šfo_t
 
	mdiskInfo
;

19 
	m¡rS‹
[256];

20 
	m¡rDevName
[64];

23 
	s¬¿y_d‘a
 {

24 
mdu_¬¿y_šfo_t
 
	m¬¿yInfo
;

25 
¬¿y_disk_šfo
 
	m¬¿yDisks
[
MAX_DISK_NUM
];

27 
	m¡rA¼ayS‹
[128];

28 
	m¡rA¼ayDevName
[32];

29 
	m¡rRaidLev–
[16];

30 
	m¡rRaidLayout
[32];

31 
	m¡rA¼aySize
[32];

32 
	m¡rU£dSize
[32];

33 
	m¡rRebudO³¿tiÚ
[16];

34 
	muÎA¼aySize
;

35 
	muÎU£dSize
;

36 
	muuid
[4];

37 
	mbIsSu³rBlockP”si¡’t
;

38 
	mbIÇùive
;

39 
	mbIsRebudšg
;

40 
	miRebudProg»ss
;

41 
	miEnough
;

42 
	miLayout
;

43 
	muDiskCouÁ”
;

45 
	m¡rCÚš”
[32];

46 
	m¡rMemb”
[32];

49 
	mbResh­eAùive
;

50 
	miD–Disks
;

51 
	miRaidNewLev–
;

52 
	miNewChunkSize
;

53 
	muÎResh­eProg»ss
;

54 
	m¡rRaidNewLayout
[32];

57 
	squ”y_»suÉ
 {

58 
	mbIsMD
;

59 
	mbIsMDAùive
;

60 
	mbHasMDD‘a
;

61 
	mbHasMDE¼Ü
;

62 
	miMDRaidDiskNum
;

63 
	miMDS·»DiskNum
;

64 
	miMDRaidLev–
;

65 
	m¡rMDSize
[32];

66 
	m¡rMDLev–
[16];

67 
	m¡rMDDevName
[32];

68 
	m¡rMDE¼Ü
[128];

70 
	miDiskNumb”
;

71 
	m¡rDiskAùiv™y
[32];

72 
	m¡rDiskDevName
[32];

75 
	sexamše_»suÉ
 {

76 
	mcS‹
;

77 
	m¡rDevName
[32];

78 
	m¬¿yUUID
[4];

79 
	muRaidLev–
;

80 
	muRaidDiskNum
;

81 
	mbHasBadblock
;

82 
	mbSBChkSumE¼Ü
;

83 
	mbIsV®id
;

84 
	muChkSum
;

85 
	muEx³ùedChkSum
;

86 
	muDevRŞe
;

87 
examše_»suÉ
* 
	mÃxt
;

	@libmdadm/mdmon.h

21 #undeà
´_”r


22 
	#´_”r
(
fmt
 ...è
	`årštf
(
¡d”r
, "mdmÚ: " fmt)

	)

24 
	e¬¿y_¡©e
 { 
	mş—r
, 
	mšaùive
, 
	msu¥’ded
, 
	m»adÚly
, 
	m»ad_auto
,

25 
	mş—n
, 
	maùive
, 
	mwr™e_³ndšg
, 
	maùive_idË
, 
	mbad_wÜd
};

27 
	esync_aùiÚ
 { 
	midË
, 
	m»sh­e
, 
	m»sync
, 
	m»cov”
, 
	mcheck
, 
	m»·œ
, 
	mbad_aùiÚ
 };

29 
	saùive_¬¿y
 {

30 
mdšfo
 
	mšfo
;

31 
su³¹y³
 *
	mcÚš”
;

32 
aùive_¬¿y
 *
	mÃxt
, *
	m»¶aûs
;

33 
	mto_»move
;

35 
	maùiÚ_fd
;

36 
	m»sync_¡¬t_fd
;

37 
	mm‘ad©a_fd
;

38 
	msync_com¶‘ed_fd
;

39 
	mÏ¡_checkpošt
;

48 
¬¿y_¡©e
 
	m´ev_¡©e
, 
	mcu¼_¡©e
, 
	mÃxt_¡©e
;

49 
sync_aùiÚ
 
	m´ev_aùiÚ
, 
	mcu¼_aùiÚ
, 
	mÃxt_aùiÚ
;

51 
	mcheck_deg¿ded
;

52 
	mcheck_»sh­e
;

66 
m‘ad©a_upd©e
 *
upd©e_queue
, *
upd©e_queue_hªdËd
;

68 
	#MD_MAJOR
 9

	)

70 
aùive_¬¿y
 *
cÚš”
;

71 
aùive_¬¿y
 *
disÿrd_this
;

72 
aùive_¬¿y
 *
³ndšg_disÿrd
;

73 
md_g’”ic_cmd
 *
aùive_cmd
;

75 
»move_pidfe
(*
devÇme
);

76 
do_mÚ™Ü
(
su³¹y³
 *
cÚš”
);

77 
do_mªag”
(
su³¹y³
 *
cÚš”
);

78 
sig‹rm
;

80 
»ad_dev_¡©e
(
fd
);

81 
is_cÚš”_memb”
(
md¡©_’t
 *
md¡©
, *
cÚš”
);

83 
md¡©_’t
 *
md¡©_»ad
(
hŞd
, 
¡¬t
);

85 
ex™_now
, 
mªag”_»ady
;

86 
mÚ_tid
, 
mgr_tid
;

87 
mÚ™Ü_loİ_út
;

92 
šlše
 
	$is_»sync_com¶‘e
(
mdšfo
 *
¬¿y
)

94 
sync_size
 = 0;

95 
ncİ›s
, 
l
;

96 
¬¿y
->¬¿y.
Ëv–
) {

101 
sync_size
 = 
¬¿y
->
compÚ’t_size
;

104 
l
 = 
¬¿y
->¬¿y.
Ïyout
;

105 
ncİ›s
 = (
l
 & 0xff) * ((l >> 8) && 0xff);

106 
sync_size
 = 
¬¿y
->
compÚ’t_size
 *‡¼ay->¬¿y.
¿id_disks
;

107 
sync_size
 /ğ
ncİ›s
;

110  
¬¿y
->
»sync_¡¬t
 >ğ
sync_size
;

111 
	}
}

	@libmdadm/msg.h

20 
	gmdšfo
;

21 
	gm‘ad©a_upd©e
;

23 
»ûive_mes§ge
(
fd
, 
m‘ad©a_upd©e
 *
msg
, 
tmo
);

24 
£nd_mes§ge
(
fd
, 
m‘ad©a_upd©e
 *
msg
, 
tmo
);

25 
ack
(
fd
, 
tmo
);

26 
wa™_»¶y
(
fd
, 
tmo
);

27 
cÚÃù_mÚ™Ü
(*
devÇme
);

28 
pšg_mÚ™Ü
(*
devÇme
);

29 
block_sub¬¿y
(
mdšfo
 *
¤a
);

30 
unblock_sub¬¿y
(
mdšfo
 *
¤a
, cÚ¡ 
unä“ze
);

31 
block_mÚ™Ü
(*
cÚš”
, cÚ¡ 
ä“ze
);

32 
unblock_mÚ™Ü
(*
cÚš”
, cÚ¡ 
unä“ze
);

33 
åšg_mÚ™Ü
(
sock
);

34 
pšg_mªag”
(*
devÇme
);

35 
æush_mdmÚ
(*
cÚš”
);

37 
	#MSG_MAX_LEN
 (4*1024*1024)

	)

	@libmdadm/part.h

29 
	#MBR_SIGNATURE_MAGIC
 
	`__ıu_to_Ë16
(0xAA55)

	)

30 
	#MBR_PARTITIONS
 4

	)

32 
	sMBR_·¹_»cÜd
 {

33 
__u8
 
	mboÙabË
;

34 
__u8
 
	mfœ¡_h—d
;

35 
__u8
 
	mfœ¡_£ùÜ
;

36 
__u8
 
	mfœ¡_cyl
;

37 
__u8
 
	m·¹_ty³
;

38 
__u8
 
	mÏ¡_h—d
;

39 
__u8
 
	mÏ¡_£ùÜ
;

40 
__u8
 
	mÏ¡_cyl
;

41 
__u32
 
	mfœ¡_£ù_lba
;

42 
__u32
 
	mblocks_num
;

45 
	sMBR
 {

46 
__u8
 
	m·d
[446];

47 
MBR_·¹_»cÜd
 
	m·¹s
[
MBR_PARTITIONS
];

48 
__u16
 
	mmagic
;

49 } 
__©Œibu‹__
((
·cked
));

51 
	#GPT_SIGNATURE_MAGIC
 
	`__ıu_to_Ë64
(0x5452415020494645ULL)

	)

52 
	#MBR_GPT_PARTITION_TYPE
 0xEE

	)

54 
	sGPT_·¹_’Œy
 {

55 
	mty³_guid
[16];

56 
	m·¹™iÚ_guid
[16];

57 
__u64
 
	m¡¬tšg_lba
;

58 
__u64
 
	m’dšg_lba
;

59 
	m©Œ_b™s
[8];

60 
	mÇme
[72];

61 } 
__©Œibu‹__
((
·cked
));

63 
	sGPT
 {

64 
__u64
 
	mmagic
;

65 
__u32
 
	m»visiÚ
;

66 
__u32
 
	mh—d”_size
;

67 
__u32
 
	müc
;

68 
__u32
 
	m·d1
;

69 
__u64
 
	mcu¼’t_lba
;

70 
__u64
 
	mbackup_lba
;

71 
__u64
 
	mfœ¡_lba
;

72 
__u64
 
	mÏ¡_lba
;

73 
__u8
 
	mguid
[16];

74 
__u64
 
	m·¹_¡¬t
;

75 
__u32
 
	m·¹_út
;

76 
__u32
 
	m·¹_size
;

77 
__u32
 
	m·¹_üc
;

78 
__u8
 
	m·d2
[420];

79 } 
__©Œibu‹__
((
·cked
));

	@libmdadm/platform-intel.h

19 
	~<asm/ty³s.h
>

20 
	~<¡ršgs.h
>

23 
	simsm_Üom
 {

24 
__u8
 
	msigÇtu»
[4];

25 
__u8
 
	mbË_v”_majÜ
;

26 
__u8
 
	mbË_v”_mšÜ
;

27 
__u16
 
	mmajÜ_v”
;

28 
__u16
 
	mmšÜ_v”
;

29 
__u16
 
	mhÙfix_v”
;

30 
__u16
 
	mbud
;

31 
__u8
 
	mËn
;

32 
__u8
 
	mchecksum
;

33 
__u16
 
	m¾c
;

37 
	#IMSM_OROM_RLC_RAID0
 (1 << 0)

	)

38 
	#IMSM_OROM_RLC_RAID1
 (1 << 1)

	)

39 
	#IMSM_OROM_RLC_RAID10
 (1 << 2)

	)

40 
	#IMSM_OROM_RLC_RAID1E
 (1 << 3)

	)

41 
	#IMSM_OROM_RLC_RAID5
 (1 << 4)

	)

42 
	#IMSM_OROM_RLC_RAID_CNG
 (1 << 5)

	)

43 
__u16
 
	msss
;

44 
	#IMSM_OROM_SSS_2kB
 (1 << 0)

	)

45 
	#IMSM_OROM_SSS_4kB
 (1 << 1)

	)

46 
	#IMSM_OROM_SSS_8kB
 (1 << 2)

	)

47 
	#IMSM_OROM_SSS_16kB
 (1 << 3)

	)

48 
	#IMSM_OROM_SSS_32kB
 (1 << 4)

	)

49 
	#IMSM_OROM_SSS_64kB
 (1 << 5)

	)

50 
	#IMSM_OROM_SSS_128kB
 (1 << 6)

	)

51 
	#IMSM_OROM_SSS_256kB
 (1 << 7)

	)

52 
	#IMSM_OROM_SSS_512kB
 (1 << 8)

	)

53 
	#IMSM_OROM_SSS_1MB
 (1 << 9)

	)

54 
	#IMSM_OROM_SSS_2MB
 (1 << 10)

	)

55 
	#IMSM_OROM_SSS_4MB
 (1 << 11)

	)

56 
	#IMSM_OROM_SSS_8MB
 (1 << 12)

	)

57 
	#IMSM_OROM_SSS_16MB
 (1 << 13)

	)

58 
	#IMSM_OROM_SSS_32MB
 (1 << 14)

	)

59 
	#IMSM_OROM_SSS_64MB
 (1 << 15)

	)

60 
__u16
 
	md·
;

61 
	#IMSM_OROM_DISKS_PER_ARRAY
 6

	)

62 
__u16
 
	mtds
;

63 
	#IMSM_OROM_TOTAL_DISKS
 6

	)

64 
__u8
 
	mv·
;

65 
	#IMSM_OROM_VOLUMES_PER_ARRAY
 2

	)

66 
__u8
 
	mvphba
;

67 
	#IMSM_OROM_VOLUMES_PER_HBA
 4

	)

72 
__u32
 
	m©Œ
;

73 
	#IMSM_OROM_ATTR_RAID0
 
IMSM_OROM_RLC_RAID0


	)

74 
	#IMSM_OROM_ATTR_RAID1
 
IMSM_OROM_RLC_RAID1


	)

75 
	#IMSM_OROM_ATTR_RAID10
 
IMSM_OROM_RLC_RAID10


	)

76 
	#IMSM_OROM_ATTR_RAID1E
 
IMSM_OROM_RLC_RAID1E


	)

77 
	#IMSM_OROM_ATTR_RAID5
 
IMSM_OROM_RLC_RAID5


	)

78 
	#IMSM_OROM_ATTR_RAID_CNG
 
IMSM_OROM_RLC_RAID_CNG


	)

79 
	#IMSM_OROM_ATTR_2TB_DISK
 (1 << 26)

	)

80 
	#IMSM_OROM_ATTR_2TB
 (1 << 29)

	)

81 
	#IMSM_OROM_ATTR_PM
 (1 << 30)

	)

82 
	#IMSM_OROM_ATTR_ChecksumV”ify
 (1 << 31)

	)

83 
__u32
 
	mÿ·b™›s
;

84 
	#IMSM_OROM_CAPABILITIES_Ext_SATA
 (1 << 0)

	)

85 
	#IMSM_OROM_CAPABILITIES_TurboMemÜy
 (1 << 1)

	)

86 
	#IMSM_OROM_CAPABILITIES_HddPasswÜd
 (1 << 2)

	)

87 
	#IMSM_OROM_CAPABILITIES_DiskCÛrciÚ
 (1 << 3)

	)

88 
__u32
 
	mdriv”_ã©u»s
;

89 
	#IMSM_OROM_CAPABILITIES_HDDUÆock
 (1 << 0)

	)

90 
	#IMSM_OROM_CAPABILITIES_LEDLoc
 (1 << 1)

	)

91 
	#IMSM_OROM_CAPABILITIES_EÁ”´i£Sy¡em
 (1 << 2)

	)

92 
	#IMSM_OROM_CAPABILITIES_Zpodd
 (1 << 3)

	)

93 
	#IMSM_OROM_CAPABILITIES_L¬geD¿mCache
 (1 << 4)

	)

94 
	#IMSM_OROM_CAPABILITIES_Rohi
 (1 << 5)

	)

95 
	#IMSM_OROM_CAPABILITIES_R—dP©rŞ
 (1 << 6)

	)

96 
	#IMSM_OROM_CAPABILITIES_XÜHw
 (1 << 7)

	)

97 } 
__©Œibu‹__
((
·cked
));

99 
šlše
 
	$imsm_Üom_has_¿id0
(cÚ¡ 
imsm_Üom
 *
Üom
)

101  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID0
);

102 
	}
}

103 
šlše
 
	$imsm_Üom_has_¿id1
(cÚ¡ 
imsm_Üom
 *
Üom
)

105  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID1
);

106 
	}
}

107 
šlše
 
	$imsm_Üom_has_¿id1e
(cÚ¡ 
imsm_Üom
 *
Üom
)

109  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID1E
);

110 
	}
}

111 
šlše
 
	$imsm_Üom_has_¿id10
(cÚ¡ 
imsm_Üom
 *
Üom
)

113  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID10
);

114 
	}
}

115 
šlše
 
	$imsm_Üom_has_¿id5
(cÚ¡ 
imsm_Üom
 *
Üom
)

117  !!(
Üom
->
¾c
 & 
IMSM_OROM_RLC_RAID5
);

118 
	}
}

125 
šlše
 
	$imsm_Üom_has_chunk
(cÚ¡ 
imsm_Üom
 *
Üom
, 
chunk
)

127 
fs
 = 
	`ffs
(
chunk
);

128 ià(!
fs
)

130 
fs
--;

131 ià(
chunk
 & (chunk-1))

133  !!(
Üom
->
sss
 & (1 << (
fs
 - 1)));

134 
	}
}

142 
šlše
 
	$æs
(
x
)

144 
r
 = 32;

146 ià(!
x
)

148 ià(!(
x
 & 0xffff0000u)) {

149 
x
 <<= 16;

150 
r
 -= 16;

152 ià(!(
x
 & 0xff000000u)) {

153 
x
 <<= 8;

154 
r
 -= 8;

156 ià(!(
x
 & 0xf0000000u)) {

157 
x
 <<= 4;

158 
r
 -= 4;

160 ià(!(
x
 & 0xc0000000u)) {

161 
x
 <<= 2;

162 
r
 -= 2;

164 ià(!(
x
 & 0x80000000u)) {

165 
x
 <<= 1;

166 
r
 -= 1;

168  
r
;

169 
	}
}

171 
	esys_dev_ty³
 {

172 
	mSYS_DEV_UNKNOWN
 = 0,

173 
	mSYS_DEV_SAS
,

174 
	mSYS_DEV_SATA
,

175 
	mSYS_DEV_MAX


178 
	ssys_dev
 {

179 
sys_dev_ty³
 
	mty³
;

180 *
	m·th
;

181 *
	mpci_id
;

182 
__u16
 
	mdev_id
;

183 
sys_dev
 *
	mÃxt
;

186 
	sefi_guid
 {

187 
__u8
 
	mb
[16];

190 
šlše
 *
	$guid_¡r
(*
buf
, 
efi_guid
 
guid
)

192 
	`¥rštf
(
buf
, "%02x%02x%02x%02x-%02x%02x-%02x%02x-"

194 
guid
.
b
[3], guid.b[2], guid.b[1], guid.b[0],

195 
guid
.
b
[5], guid.b[4], guid.b[7], guid.b[6],

196 
guid
.
b
[8], guid.b[9], guid.b[10], guid.b[11],

197 
guid
.
b
[12], guid.b[13], guid.b[14], guid.b[15]);

198  
buf
;

199 
	}
}

201 *
diskfd_to_dev·th
(
fd
);

202 
sys_dev
 *
fšd_driv”_deviûs
(cÚ¡ *
bus
, cÚ¡ *
driv”
);

203 
sys_dev
 *
fšd_š‹l_deviûs
();

204 cÚ¡ 
imsm_Üom
 *
fšd_imsm_ÿ·b™y
(
sys_dev_ty³
 
hba_id
);

205 cÚ¡ 
imsm_Üom
 *
fšd_imsm_Üom
();

206 
disk_©ched_to_hba
(
fd
, cÚ¡ *
hba_·th
);

207 
devt_©ched_to_hba
(
dev_t
 
dev
, cÚ¡ *
hba_·th
);

208 *
devt_to_dev·th
(
dev_t
 
dev
);

209 
·th_©ched_to_hba
(cÚ¡ *
disk_·th
, cÚ¡ *
hba_·th
);

210 cÚ¡ *
g‘_sys_dev_ty³
(
sys_dev_ty³
);

	@libmdadm/probe_roms.h

20 
´obe_roms_ex™
();

21 
´obe_roms_š™
(
®ign
);

22 (*
	tsÿn_â
)(cÚ¡ *
	t¡¬t
, cÚ¡ *
	t’d
, cÚ¡ *
	td©a
);

23 
	`sÿn_ad­‹r_roms
(
sÿn_â
 
â
);

24 
	`´obe_roms
();

	@libmdadm/sha1.h

20 #iâdeà
SHA1_H


21 
	#SHA1_H
 1

	)

23 
	~<¡dio.h
>

25 #ià
defšed
 
HAVE_LIMITS_H
 || 
_LIBC


26 
	~<lim™s.h
>

36 #ifdeà
_LIBC


37 
	~<sys/ty³s.h
>

38 
u_št32_t
 
	tsha1_ušt32
;

39 
ušŒ_t
 
	tsha1_ušŒ
;

41 
	#INT_MAX_32_BITS
 2147483647

	)

48 #iâdeà
INT_MAX


49 
	#INT_MAX
 
INT_MAX_32_BITS


	)

52 #ià
INT_MAX
 =ğ
INT_MAX_32_BITS


53 
	tsha1_ušt32
;

55 #ià
SHRT_MAX
 =ğ
INT_MAX_32_BITS


56 
	tsha1_ušt32
;

58 #ià
LONG_MAX
 =ğ
INT_MAX_32_BITS


59 
	tsha1_ušt32
;

69 #ifdeà
__ılu¥lus


74 
	ssha1_ùx


76 
sha1_ušt32
 
A
;

77 
sha1_ušt32
 
B
;

78 
sha1_ušt32
 
C
;

79 
sha1_ušt32
 
D
;

80 
sha1_ušt32
 
E
;

82 
sha1_ušt32
 
tÙ®
[2];

83 
sha1_ušt32
 
buæ’
;

84 
sha1_ušt32
 
bufãr
[32];

88 
sha1_š™_ùx
 (
sha1_ùx
 *
ùx
);

94 
sha1_´oûss_block
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
,

95 
sha1_ùx
 *
ùx
);

101 
sha1_´oûss_by‹s
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
,

102 
sha1_ùx
 *
ùx
);

111 *
sha1_fšish_ùx
 (
sha1_ùx
 *
ùx
, *
»sbuf
);

119 *
sha1_»ad_ùx
 (cÚ¡ 
sha1_ùx
 *
ùx
, *
»sbuf
);

124 
sha1_¡»am
 (
FILE
 *
¡»am
, *
»sblock
);

130 *
sha1_bufãr
 (cÚ¡ *
bufãr
, 
size_t
 
Ën
, *
»sblock
);

132 #ifdeà
__ılu¥lus


	@libmke2fs/ext2fs.h

12 #iâdeà
_EXT2FS_EXT2FS_H


13 
	#_EXT2FS_EXT2FS_H


	)

15 #ifdeà
__GNUC__


16 
	#EXT2FS_ATTR
(
x
è
	`__©Œibu‹__
(x)

	)

18 
	#EXT2FS_ATTR
(
x
)

	)

21 #ifdeà
__ılu¥lus


28 #ià(!
defšed
(
__GNUC__
è&& !defšed(
__WATCOMC__
))

29 
	#NO_INLINE_FUNCS


	)

39 
	#SUPERBLOCK_OFFSET
 1024

	)

40 
	#SUPERBLOCK_SIZE
 1024

	)

46 
	#EXT2_LIB_CURRENT_REV
 
EXT2_DYNAMIC_REV


	)

48 #ifdeà
HAVE_SYS_TYPES_H


49 
	~<sys/ty³s.h
>

52 
	~<¡dio.h
>

53 
	~<¡dlib.h
>

54 
	~<¡ršg.h
>

55 
	~<”ºo.h
>

57 #ià
EXT2_FLAT_INCLUDES


58 
	~"e2_ty³s.h
"

59 
	~"ext2_fs.h
"

60 
	~"ext3_ex‹Ás.h
"

62 
	~<ext2fs/ext2_ty³s.h
>

63 
	~<ext2fs/ext2_fs.h
>

64 
	~<ext2fs/ext3_ex‹Ás.h
>

67 #ifdeà
__CHECK_ENDIAN__


68 
	#__b™wi£
 
	`__©Œibu‹__
((
b™wi£
))

	)

70 
	#__b™wi£


	)

73 
__u32
 
	t__b™wi£
 
	text2_šo_t
;

74 
__u32
 
	t__b™wi£
 
	tblk_t
;

75 
__u64
 
	t__b™wi£
 
	tblk64_t
;

76 
__u32
 
	t__b™wi£
 
	tdg½_t
;

77 
__u32
 
	t__b™wi£
 
	text2_off_t
;

78 
__u64
 
	t__b™wi£
 
	text2_off64_t
;

79 
__s64
 
	t__b™wi£
 
	te2_blkút_t
;

80 
__u32
 
	t__b™wi£
 
	text2_dœhash_t
;

82 #ià
EXT2_FLAT_INCLUDES


83 
	~"com_”r.h
"

84 
	~"ext2_io.h
"

85 
	~"ext2_”r.h
"

86 
	~"ext2_ext_©Œ.h
"

88 
	~<‘/com_”r.h
>

89 
	~<ext2fs/ext2_io.h
>

90 
	~<ext2fs/ext2_”r.h
>

91 
	~<ext2fs/ext2_ext_©Œ.h
>

97 #ifdeà
_MSC_VER


98 
	#EXT2_QSORT_TYPE
 
__cdeş


	)

100 
	#EXT2_QSORT_TYPE
 

	)

103 
¡ruù_ext2_fsys
 *
	text2_fsys
;

105 
	#EXT2FS_MARK_ERROR
 0

	)

106 
	#EXT2FS_UNMARK_ERROR
 1

	)

107 
	#EXT2FS_TEST_ERROR
 2

	)

109 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_g’”ic_b™m­
;

110 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_šode_b™m­
;

111 
ext2fs_¡ruù_g’”ic_b™m­
 *
	text2fs_block_b™m­
;

113 
	#EXT2_FIRST_INODE
(
s
è
	`EXT2_FIRST_INO
(s)

	)

120 
ext2_¡ruù_u32_li¡
 *
	text2_badblocks_li¡
;

121 
ext2_¡ruù_u32_™”©e
 *
	text2_badblocks_™”©e
;

123 
ext2_¡ruù_u32_li¡
 *
	text2_u32_li¡
;

124 
ext2_¡ruù_u32_™”©e
 *
	text2_u32_™”©e
;

127 
ext2_¡ruù_u32_li¡
 *
	tbadblocks_li¡
;

128 
ext2_¡ruù_u32_™”©e
 *
	tbadblocks_™”©e
;

130 
	#BADBLOCKS_FLAG_DIRTY
 1

	)

135 
	sext2_db_’Œy2
 {

136 
ext2_šo_t
 
šo
;

137 
blk64_t
 
blk
;

138 
e2_blkút_t
 
blockút
;

142 
	sext2_db_’Œy
 {

143 
ext2_šo_t
 
šo
;

144 
blk_t
 
blk
;

145 
blockút
;

148 
ext2_¡ruù_dbli¡
 *
	text2_dbli¡
;

150 
	#DBLIST_ABORT
 1

	)

156 
	#EXT2_FILE_WRITE
 0x0001

	)

157 
	#EXT2_FILE_CREATE
 0x0002

	)

159 
	#EXT2_FILE_MASK
 0x00FF

	)

161 
	#EXT2_FILE_BUF_DIRTY
 0x4000

	)

162 
	#EXT2_FILE_BUF_VALID
 0x2000

	)

164 
ext2_fe
 *
	text2_fe_t
;

166 
	#EXT2_SEEK_SET
 0

	)

167 
	#EXT2_SEEK_CUR
 1

	)

168 
	#EXT2_SEEK_END
 2

	)

173 
	#EXT2_FLAG_RW
 0x01

	)

174 
	#EXT2_FLAG_CHANGED
 0x02

	)

175 
	#EXT2_FLAG_DIRTY
 0x04

	)

176 
	#EXT2_FLAG_VALID
 0x08

	)

177 
	#EXT2_FLAG_IB_DIRTY
 0x10

	)

178 
	#EXT2_FLAG_BB_DIRTY
 0x20

	)

179 
	#EXT2_FLAG_SWAP_BYTES
 0x40

	)

180 
	#EXT2_FLAG_SWAP_BYTES_READ
 0x80

	)

181 
	#EXT2_FLAG_SWAP_BYTES_WRITE
 0x100

	)

182 
	#EXT2_FLAG_MASTER_SB_ONLY
 0x200

	)

183 
	#EXT2_FLAG_FORCE
 0x400

	)

184 
	#EXT2_FLAG_SUPER_ONLY
 0x800

	)

185 
	#EXT2_FLAG_JOURNAL_DEV_OK
 0x1000

	)

186 
	#EXT2_FLAG_IMAGE_FILE
 0x2000

	)

187 
	#EXT2_FLAG_EXCLUSIVE
 0x4000

	)

188 
	#EXT2_FLAG_SOFTSUPP_FEATURES
 0x8000

	)

189 
	#EXT2_FLAG_NOFREE_ON_ERROR
 0x10000

	)

190 
	#EXT2_FLAG_64BITS
 0x20000

	)

191 
	#EXT2_FLAG_PRINT_PROGRESS
 0x40000

	)

192 
	#EXT2_FLAG_DIRECT_IO
 0x80000

	)

193 
	#EXT2_FLAG_SKIP_MMP
 0x100000

	)

199 
	#EXT2_NEW_INODE_FL
 0x80000000

	)

204 
	#EXT2_MKJOURNAL_V1_SUPER
 0x0000001

	)

205 
	#EXT2_MKJOURNAL_LAZYINIT
 0x0000002

	)

206 
	#EXT2_MKJOURNAL_NO_MNT_CHECK
 0x0000004

	)

208 
İaque_ext2_group_desc
;

210 
	s¡ruù_ext2_fsys
 {

211 
”rcode_t
 
magic
;

212 
io_chªÃl
 
io
;

213 
æags
;

214 * 
deviû_Çme
;

215 
ext2_su³r_block
 * 
su³r
;

216 
blocksize
;

217 
äagsize
;

218 
dg½_t
 
group_desc_couÁ
;

219 
desc_blocks
;

220 
İaque_ext2_group_desc
 * 
group_desc
;

221 
šode_blocks_³r_group
;

222 
ext2fs_šode_b™m­
 
šode_m­
;

223 
ext2fs_block_b™m­
 
block_m­
;

225 
”rcode_t
 (*
g‘_blocks
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
blk_t
 *
blocks
);

226 
”rcode_t
 (*
check_dœeùÜy
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

227 
”rcode_t
 (*
wr™e_b™m­s
)(
ext2_fsys
 
fs
);

228 
”rcode_t
 (*
»ad_šode
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

229 
ext2_šode
 *
šode
);

230 
”rcode_t
 (*
wr™e_šode
)(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

231 
ext2_šode
 *
šode
);

232 
ext2_badblocks_li¡
 
badblocks
;

233 
ext2_dbli¡
 
dbli¡
;

234 
__u32
 
¡ride
;

235 
ext2_su³r_block
 * 
Üig_su³r
;

236 
ext2_image_hdr
 * 
image_h—d”
;

237 
__u32
 
umask
;

238 
time_t
 
now
;

239 
şu¡”_¿tio_b™s
;

240 
__u16
 
deçuÉ_b™m­_ty³
;

241 
__u16
 
·d
;

245 
__u32
 
»£rved
[5];

250 * 
´iv_d©a
;

255 
ext2_šode_ÿche
 *
iÿche
;

256 
io_chªÃl
 
image_io
;

261 
”rcode_t
 (*
g‘_®loc_block
)(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

262 
blk64_t
 *
»t
);

263 (*
block_®loc_¡©s
)(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
šu£
);

268 *
mmp_buf
;

269 *
mmp_cmp
;

270 
mmp_fd
;

275 
mmp_Ï¡_wr™‹n
;

278 #ià
EXT2_FLAT_INCLUDES


279 
	~"e2_b™İs.h
"

281 
	~<ext2fs/b™İs.h
>

287 
	#EXT2FS_BMAP64_BITARRAY
 1

	)

288 
	#EXT2FS_BMAP64_RBTREE
 2

	)

289 
	#EXT2FS_BMAP64_AUTODIR
 3

	)

294 
	#BLOCK_CHANGED
 1

	)

295 
	#BLOCK_ABORT
 2

	)

296 
	#BLOCK_ERROR
 4

	)

322 
	#BLOCK_FLAG_APPEND
 1

	)

323 
	#BLOCK_FLAG_HOLE
 1

	)

324 
	#BLOCK_FLAG_DEPTH_TRAVERSE
 2

	)

325 
	#BLOCK_FLAG_DATA_ONLY
 4

	)

326 
	#BLOCK_FLAG_READ_ONLY
 8

	)

328 
	#BLOCK_FLAG_NO_LARGE
 0x1000

	)

333 
	#BLOCK_COUNT_IND
 (-1)

	)

334 
	#BLOCK_COUNT_DIND
 (-2)

	)

335 
	#BLOCK_COUNT_TIND
 (-3)

	)

336 
	#BLOCK_COUNT_TRANSLATOR
 (-4)

	)

342 
	#EXT2_BMOVE_GET_DBLIST
 0x0001

	)

343 
	#EXT2_BMOVE_DEBUG
 0x0002

	)

350 
	#EXT2_EXTENT_FLAGS_LEAF
 0x0001

	)

351 
	#EXT2_EXTENT_FLAGS_UNINIT
 0x0002

	)

352 
	#EXT2_EXTENT_FLAGS_SECOND_VISIT
 0x0004

	)

354 
	sext2fs_ex‹Á
 {

355 
blk64_t
 
e_pblk
;

356 
blk64_t
 
e_lblk
;

357 
__u32
 
e_Ën
;

358 
__u32
 
e_æags
;

361 
ext2_ex‹Á_hªdË
 *
	text2_ex‹Á_hªdË_t
;

362 
ext2_ex‹Á_·th
 *
	text2_ex‹Á_·th_t
;

367 
	#EXT2_EXTENT_CURRENT
 0x0000

	)

368 
	#EXT2_EXTENT_MOVE_MASK
 0x000F

	)

369 
	#EXT2_EXTENT_ROOT
 0x0001

	)

370 
	#EXT2_EXTENT_LAST_LEAF
 0x0002

	)

371 
	#EXT2_EXTENT_FIRST_SIB
 0x0003

	)

372 
	#EXT2_EXTENT_LAST_SIB
 0x0004

	)

373 
	#EXT2_EXTENT_NEXT_SIB
 0x0005

	)

374 
	#EXT2_EXTENT_PREV_SIB
 0x0006

	)

375 
	#EXT2_EXTENT_NEXT_LEAF
 0x0007

	)

376 
	#EXT2_EXTENT_PREV_LEAF
 0x0008

	)

377 
	#EXT2_EXTENT_NEXT
 0x0009

	)

378 
	#EXT2_EXTENT_PREV
 0x000A

	)

379 
	#EXT2_EXTENT_UP
 0x000B

	)

380 
	#EXT2_EXTENT_DOWN
 0x000C

	)

381 
	#EXT2_EXTENT_DOWN_AND_LAST
 0x000D

	)

386 
	#EXT2_EXTENT_INSERT_AFTER
 0x0001

	)

387 
	#EXT2_EXTENT_INSERT_NOSPLIT
 0x0002

	)

392 
	#EXT2_EXTENT_DELETE_KEEP_EMPTY
 0x001

	)

397 
	#EXT2_EXTENT_SET_BMAP_UNINIT
 0x0001

	)

402 
	sext2_ex‹Á_šfo
 {

403 
cu¼_’Œy
;

404 
cu¼_Ëv–
;

405 
num_’Œ›s
;

406 
max_’Œ›s
;

407 
max_d•th
;

408 
by‹s_ava
;

409 
blk64_t
 
max_lblk
;

410 
blk64_t
 
max_pblk
;

411 
__u32
 
max_Ën
;

412 
__u32
 
max_unš™_Ën
;

418 
	#EXT2_DIRBLOCK_V2_STRUCT
 0x0001

	)

423 
	#DIRENT_CHANGED
 1

	)

424 
	#DIRENT_ABORT
 2

	)

425 
	#DIRENT_ERROR
 3

	)

431 
	#DIRENT_FLAG_INCLUDE_EMPTY
 1

	)

432 
	#DIRENT_FLAG_INCLUDE_REMOVED
 2

	)

434 
	#DIRENT_DOT_FILE
 1

	)

435 
	#DIRENT_DOT_DOT_FILE
 2

	)

436 
	#DIRENT_OTHER_FILE
 3

	)

437 
	#DIRENT_DELETED_FILE
 4

	)

442 
ext2_¡ruù_šode_sÿn
 *
	text2_šode_sÿn
;

447 
	#EXT2_SF_CHK_BADBLOCKS
 0x0001

	)

448 
	#EXT2_SF_BAD_INODE_BLK
 0x0002

	)

449 
	#EXT2_SF_BAD_EXTRA_BYTES
 0x0004

	)

450 
	#EXT2_SF_SKIP_MISSING_ITABLE
 0x0008

	)

451 
	#EXT2_SF_DO_LAZY
 0x0010

	)

456 
	#EXT2_MF_MOUNTED
 1

	)

457 
	#EXT2_MF_ISROOT
 2

	)

458 
	#EXT2_MF_READONLY
 4

	)

459 
	#EXT2_MF_SWAP
 8

	)

460 
	#EXT2_MF_BUSY
 16

	)

467 
	#LINUX_S_IFMT
 00170000

	)

468 
	#LINUX_S_IFSOCK
 0140000

	)

469 
	#LINUX_S_IFLNK
 0120000

	)

470 
	#LINUX_S_IFREG
 0100000

	)

471 
	#LINUX_S_IFBLK
 0060000

	)

472 
	#LINUX_S_IFDIR
 0040000

	)

473 
	#LINUX_S_IFCHR
 0020000

	)

474 
	#LINUX_S_IFIFO
 0010000

	)

475 
	#LINUX_S_ISUID
 0004000

	)

476 
	#LINUX_S_ISGID
 0002000

	)

477 
	#LINUX_S_ISVTX
 0001000

	)

479 
	#LINUX_S_IRWXU
 00700

	)

480 
	#LINUX_S_IRUSR
 00400

	)

481 
	#LINUX_S_IWUSR
 00200

	)

482 
	#LINUX_S_IXUSR
 00100

	)

484 
	#LINUX_S_IRWXG
 00070

	)

485 
	#LINUX_S_IRGRP
 00040

	)

486 
	#LINUX_S_IWGRP
 00020

	)

487 
	#LINUX_S_IXGRP
 00010

	)

489 
	#LINUX_S_IRWXO
 00007

	)

490 
	#LINUX_S_IROTH
 00004

	)

491 
	#LINUX_S_IWOTH
 00002

	)

492 
	#LINUX_S_IXOTH
 00001

	)

494 
	#LINUX_S_ISLNK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFLNK
)

	)

495 
	#LINUX_S_ISREG
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFREG
)

	)

496 
	#LINUX_S_ISDIR
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFDIR
)

	)

497 
	#LINUX_S_ISCHR
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFCHR
)

	)

498 
	#LINUX_S_ISBLK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFBLK
)

	)

499 
	#LINUX_S_ISFIFO
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFIFO
)

	)

500 
	#LINUX_S_ISSOCK
(
m
è(((mè& 
LINUX_S_IFMT
è=ğ
LINUX_S_IFSOCK
)

	)

505 
	#EXT2_I_SIZE
(
i
è((i)->
i_size
 | ((
__u64
è(i)->
i_size_high
 << 32))

	)

510 
	#EXT2_ICOUNT_OPT_INCREMENT
 0x01

	)

512 
ext2_icouÁ
 *
	text2_icouÁ_t
;

517 
	#BMAP_ALLOC
 0x0001

	)

518 
	#BMAP_SET
 0x0002

	)

523 
	#BMAP_RET_UNINIT
 0x0001

	)

528 
	#IMAGER_FLAG_INODEMAP
 1

	)

529 
	#IMAGER_FLAG_SPARSEWRITE
 2

	)

535 
	#EXT2_CHECK_MAGIC
(, 
code
) \

536 ià(()->
magic
 !ğ(
code
)è (code)

	)

542 
	#EXT2FS_COMPRESSED_BLKADDR
 ((
blk_t
è-1)

	)

543 
	#HOLE_BLKADDR
(
_b
è((_bè=ğ0 || (_bè=ğ
EXT2FS_COMPRESSED_BLKADDR
)

	)

548 
	#EXT2_LIB_FEATURE_COMPAT_SUPP
 (
EXT2_FEATURE_COMPAT_DIR_PREALLOC
|\

549 
EXT2_FEATURE_COMPAT_IMAGIC_INODES
|\

550 
EXT3_FEATURE_COMPAT_HAS_JOURNAL
|\

551 
EXT2_FEATURE_COMPAT_RESIZE_INODE
|\

552 
EXT2_FEATURE_COMPAT_DIR_INDEX
|\

553 
EXT2_FEATURE_COMPAT_EXT_ATTR
)

	)

556 #ifdeà
ENABLE_COMPRESSION


557 #iâdeà
I_KNOW_THAT_COMPRESSION_IS_EXPERIMENTAL


563 
	#EXT2_LIB_FEATURE_INCOMPAT_SUPP
 (
EXT2_FEATURE_INCOMPAT_FILETYPE
|\

564 
EXT2_FEATURE_INCOMPAT_COMPRESSION
|\

565 
EXT3_FEATURE_INCOMPAT_JOURNAL_DEV
|\

566 
EXT2_FEATURE_INCOMPAT_META_BG
|\

567 
EXT3_FEATURE_INCOMPAT_RECOVER
|\

568 
EXT3_FEATURE_INCOMPAT_EXTENTS
|\

569 
EXT4_FEATURE_INCOMPAT_FLEX_BG
|\

570 
EXT4_FEATURE_INCOMPAT_MMP
|\

571 
EXT4_FEATURE_INCOMPAT_64BIT
)

	)

573 
	#EXT2_LIB_FEATURE_INCOMPAT_SUPP
 (
EXT2_FEATURE_INCOMPAT_FILETYPE
|\

574 
EXT3_FEATURE_INCOMPAT_JOURNAL_DEV
|\

575 
EXT2_FEATURE_INCOMPAT_META_BG
|\

576 
EXT3_FEATURE_INCOMPAT_RECOVER
|\

577 
EXT3_FEATURE_INCOMPAT_EXTENTS
|\

578 
EXT4_FEATURE_INCOMPAT_FLEX_BG
|\

579 
EXT4_FEATURE_INCOMPAT_MMP
|\

580 
EXT4_FEATURE_INCOMPAT_64BIT
)

	)

582 #ifdeà
CONFIG_QUOTA


583 
	#EXT2_LIB_FEATURE_RO_COMPAT_SUPP
 (
EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER
|\

584 
EXT4_FEATURE_RO_COMPAT_HUGE_FILE
|\

585 
EXT2_FEATURE_RO_COMPAT_LARGE_FILE
|\

586 
EXT4_FEATURE_RO_COMPAT_DIR_NLINK
|\

587 
EXT4_FEATURE_RO_COMPAT_EXTRA_ISIZE
|\

588 
EXT4_FEATURE_RO_COMPAT_GDT_CSUM
|\

589 
EXT4_FEATURE_RO_COMPAT_BIGALLOC
|\

590 
EXT4_FEATURE_RO_COMPAT_QUOTA
)

	)

592 
	#EXT2_LIB_FEATURE_RO_COMPAT_SUPP
 (
EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER
|\

593 
EXT4_FEATURE_RO_COMPAT_HUGE_FILE
|\

594 
EXT2_FEATURE_RO_COMPAT_LARGE_FILE
|\

595 
EXT4_FEATURE_RO_COMPAT_DIR_NLINK
|\

596 
EXT4_FEATURE_RO_COMPAT_EXTRA_ISIZE
|\

597 
EXT4_FEATURE_RO_COMPAT_GDT_CSUM
|\

598 
EXT4_FEATURE_RO_COMPAT_BIGALLOC
)

	)

605 
	#EXT2_LIB_SOFTSUPP_INCOMPAT
 (0)

	)

606 
	#EXT2_LIB_SOFTSUPP_RO_COMPAT
 (
EXT4_FEATURE_RO_COMPAT_REPLICA
)

	)

610 
	#EXT2FS_CLUSTER_RATIO
(
fs
è(1 << (fs)->
şu¡”_¿tio_b™s
)

	)

611 
	#EXT2FS_CLUSTER_MASK
(
fs
è(
	`EXT2FS_CLUSTER_RATIO
(fsè- 1)

	)

612 
	#EXT2FS_B2C
(
fs
, 
blk
è((blkè>> (fs)->
şu¡”_¿tio_b™s
)

	)

614 
	#EXT2FS_C2B
(
fs
, 
şu¡”
è((şu¡”è<< (fs)->
şu¡”_¿tio_b™s
)

	)

616 
	#EXT2FS_NUM_B2C
(
fs
, 
blks
è(((blksè+ 
	`EXT2FS_CLUSTER_MASK
(fs)) >> \

617 (
fs
)->
şu¡”_¿tio_b™s
)

	)

619 #ià
defšed
(
HAVE_FSTAT64
è&& !defšed(
__OSX_AVAILABLE_BUT_DEPRECATED
)

620 
¡©64
 
	text2fs_¡ruù_¡©
;

622 
¡©
 
	text2fs_¡ruù_¡©
;

629 
	#EXT2_FLAG_FLUSH_NO_SYNC
 1

	)

636 
šlše
 
ext2fs_Ãeds_Ïrge_fe_ã©u»
(
fe_size
)

638  
fe_size
 >= 0x80000000ULL;

642 
”rcode_t
 
ext2fs_Ãw_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, 
mode
,

643 
ext2fs_šode_b™m­
 
m­
, 
ext2_šo_t
 *
»t
);

644 
”rcode_t
 
ext2fs_Ãw_block
(
ext2_fsys
 
fs
, 
blk_t
 
gßl
,

645 
ext2fs_block_b™m­
 
m­
, 
blk_t
 *
»t
);

646 
”rcode_t
 
ext2fs_Ãw_block2
(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

647 
ext2fs_block_b™m­
 
m­
, 
blk64_t
 *
»t
);

648 
”rcode_t
 
ext2fs_g‘_ä“_blocks
(
ext2_fsys
 
fs
, 
blk_t
 
¡¬t
,

649 
blk_t
 
fšish
, 
num
,

650 
ext2fs_block_b™m­
 
m­
,

651 
blk_t
 *
»t
);

652 
”rcode_t
 
ext2fs_g‘_ä“_blocks2
(
ext2_fsys
 
fs
, 
blk64_t
 
¡¬t
,

653 
blk64_t
 
fšish
, 
num
,

654 
ext2fs_block_b™m­
 
m­
,

655 
blk64_t
 *
»t
);

656 
”rcode_t
 
ext2fs_®loc_block
(
ext2_fsys
 
fs
, 
blk_t
 
gßl
,

657 *
block_buf
, 
blk_t
 *
»t
);

658 
”rcode_t
 
ext2fs_®loc_block2
(
ext2_fsys
 
fs
, 
blk64_t
 
gßl
,

659 *
block_buf
, 
blk64_t
 *
»t
);

660 
ext2fs_£t_®loc_block_ÿÎback
(
ext2_fsys
 
fs
,

661 
”rcode_t
 (*
func
)(
ext2_fsys
 
fs
,

662 
blk64_t
 
gßl
,

663 
blk64_t
 *
»t
),

664 
”rcode_t
 (**
Şd
)(
ext2_fsys
 
fs
,

665 
blk64_t
 
gßl
,

666 
blk64_t
 *
»t
));

669 
ext2fs_»£rve_su³r_ªd_bgd
(
ext2_fsys
 
fs
,

670 
dg½_t
 
group
,

671 
ext2fs_block_b™m­
 
bm­
);

672 
ext2fs_£t_block_®loc_¡©s_ÿÎback
(
ext2_fsys
 
fs
,

673 (*
func
)(
ext2_fsys
 
fs
,

674 
blk64_t
 
blk
,

675 
šu£
),

676 (**
Şd
)(
ext2_fsys
 
fs
,

677 
blk64_t
 
blk
,

678 
šu£
));

681 
ext2fs_šode_®loc_¡©s
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
šu£
);

682 
ext2fs_šode_®loc_¡©s2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

683 
šu£
, 
isdœ
);

684 
ext2fs_block_®loc_¡©s
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, 
šu£
);

685 
ext2fs_block_®loc_¡©s2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
šu£
);

688 
”rcode_t
 
ext2fs_®loÿ‹_bËs
(
ext2_fsys
 
fs
);

689 
”rcode_t
 
ext2fs_®loÿ‹_group_bË
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

690 
ext2fs_block_b™m­
 
bm­
);

693 
”rcode_t
 
ext2fs_u32_li¡_ü—‹
(
ext2_u32_li¡
 *
»t
, 
size
);

694 
”rcode_t
 
ext2fs_u32_li¡_add
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

695 
ext2fs_u32_li¡_fšd
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

696 
ext2fs_u32_li¡_‹¡
(
ext2_u32_li¡
 
bb
, 
blk_t
 
blk
);

697 
”rcode_t
 
ext2fs_u32_li¡_™”©e_begš
(
ext2_u32_li¡
 
bb
,

698 
ext2_u32_™”©e
 *
»t
);

699 
ext2fs_u32_li¡_™”©e
(
ext2_u32_™”©e
 
™”
, 
blk_t
 *
blk
);

700 
ext2fs_u32_li¡_™”©e_’d
(
ext2_u32_™”©e
 
™”
);

701 
”rcode_t
 
ext2fs_u32_cİy
(
ext2_u32_li¡
 
¤c
,ƒxt2_u32_li¡ *
de¡
);

702 
ext2fs_u32_li¡_equ®
(
ext2_u32_li¡
 
bb1
,ƒxt2_u32_li¡ 
bb2
);

704 
”rcode_t
 
ext2fs_badblocks_li¡_ü—‹
(
ext2_badblocks_li¡
 *
»t
,

705 
size
);

706 
”rcode_t
 
ext2fs_badblocks_li¡_add
(
ext2_badblocks_li¡
 
bb
,

707 
blk_t
 
blk
);

708 
ext2fs_badblocks_li¡_‹¡
(
ext2_badblocks_li¡
 
bb
,

709 
blk_t
 
blk
);

710 
ext2fs_u32_li¡_d–
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

711 
ext2fs_badblocks_li¡_d–
(
ext2_u32_li¡
 
bb
, 
__u32
 
blk
);

712 
”rcode_t


713 
ext2fs_badblocks_li¡_™”©e_begš
(
ext2_badblocks_li¡
 
bb
,

714 
ext2_badblocks_™”©e
 *
»t
);

715 
ext2fs_badblocks_li¡_™”©e
(
ext2_badblocks_™”©e
 
™”
,

716 
blk_t
 *
blk
);

717 
ext2fs_badblocks_li¡_™”©e_’d
(
ext2_badblocks_™”©e
 
™”
);

718 
”rcode_t
 
ext2fs_badblocks_cİy
(
ext2_badblocks_li¡
 
¤c
,

719 
ext2_badblocks_li¡
 *
de¡
);

720 
ext2fs_badblocks_equ®
(
ext2_badblocks_li¡
 
bb1
,

721 
ext2_badblocks_li¡
 
bb2
);

722 
ext2fs_u32_li¡_couÁ
(
ext2_u32_li¡
 
bb
);

725 
”rcode_t
 
badblocks_li¡_ü—‹
(
badblocks_li¡
 *
»t
, 
size
);

726 
”rcode_t
 
badblocks_li¡_add
(
badblocks_li¡
 
bb
, 
blk_t
 
blk
);

727 
badblocks_li¡_‹¡
(
badblocks_li¡
 
bb
, 
blk_t
 
blk
);

728 
”rcode_t
 
badblocks_li¡_™”©e_begš
(
badblocks_li¡
 
bb
,

729 
badblocks_™”©e
 *
»t
);

730 
badblocks_li¡_™”©e
(
badblocks_™”©e
 
™”
, 
blk_t
 *
blk
);

731 
badblocks_li¡_™”©e_’d
(
badblocks_™”©e
 
™”
);

732 
badblocks_li¡_ä“
(
badblocks_li¡
 
bb
);

735 
”rcode_t
 
ext2fs_upd©e_bb_šode
(
ext2_fsys
 
fs
,

736 
ext2_badblocks_li¡
 
bb_li¡
);

739 
ext2fs_ä“_block_b™m­
(
ext2fs_block_b™m­
 
b™m­
);

740 
ext2fs_ä“_šode_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

741 
”rcode_t
 
ext2fs_cİy_b™m­
(
ext2fs_g’”ic_b™m­
 
¤c
,

742 
ext2fs_g’”ic_b™m­
 *
de¡
);

743 
”rcode_t
 
ext2fs_wr™e_šode_b™m­
(
ext2_fsys
 
fs
);

744 
”rcode_t
 
ext2fs_wr™e_block_b™m­
 (
ext2_fsys
 
fs
);

745 
”rcode_t
 
ext2fs_»ad_šode_b™m­
 (
ext2_fsys
 
fs
);

746 
”rcode_t
 
ext2fs_»ad_block_b™m­
(
ext2_fsys
 
fs
);

747 
”rcode_t
 
ext2fs_®loÿ‹_block_b™m­
(
ext2_fsys
 
fs
,

748 cÚ¡ *
desü
,

749 
ext2fs_block_b™m­
 *
»t
);

750 
”rcode_t
 
ext2fs_®loÿ‹_subşu¡”_b™m­
(
ext2_fsys
 
fs
,

751 cÚ¡ *
desü
,

752 
ext2fs_block_b™m­
 *
»t
);

753 
ext2fs_g‘_b™m­_g¿nuÏr™y
(
ext2fs_block_b™m­
 
b™m­
);

754 
”rcode_t
 
ext2fs_®loÿ‹_šode_b™m­
(
ext2_fsys
 
fs
,

755 cÚ¡ *
desü
,

756 
ext2fs_šode_b™m­
 *
»t
);

757 
”rcode_t
 
ext2fs_fudge_šode_b™m­_’d
(
ext2fs_šode_b™m­
 
b™m­
,

758 
ext2_šo_t
 
’d
,ƒxt2_šo_ˆ*
Ûnd
);

759 
”rcode_t
 
ext2fs_fudge_block_b™m­_’d
(
ext2fs_block_b™m­
 
b™m­
,

760 
blk_t
 
’d
, blk_ˆ*
Ûnd
);

761 
”rcode_t
 
ext2fs_fudge_block_b™m­_’d2
(
ext2fs_block_b™m­
 
b™m­
,

762 
blk64_t
 
’d
, blk64_ˆ*
Ûnd
);

763 
ext2fs_ş—r_šode_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

764 
ext2fs_ş—r_block_b™m­
(
ext2fs_block_b™m­
 
b™m­
);

765 
”rcode_t
 
ext2fs_»ad_b™m­s
(
ext2_fsys
 
fs
);

766 
”rcode_t
 
ext2fs_wr™e_b™m­s
(
ext2_fsys
 
fs
);

767 
”rcode_t
 
ext2fs_»size_šode_b™m­
(
__u32
 
Ãw_’d
, __u32 
Ãw_»®_’d
,

768 
ext2fs_šode_b™m­
 
bm­
);

769 
”rcode_t
 
ext2fs_»size_šode_b™m­2
(
__u64
 
Ãw_’d
,

770 
__u64
 
Ãw_»®_’d
,

771 
ext2fs_šode_b™m­
 
bm­
);

772 
”rcode_t
 
ext2fs_»size_block_b™m­
(
__u32
 
Ãw_’d
, __u32 
Ãw_»®_’d
,

773 
ext2fs_block_b™m­
 
bm­
);

774 
”rcode_t
 
ext2fs_»size_block_b™m­2
(
__u64
 
Ãw_’d
,

775 
__u64
 
Ãw_»®_’d
,

776 
ext2fs_block_b™m­
 
bm­
);

777 
”rcode_t
 
ext2fs_com·»_block_b™m­
(
ext2fs_block_b™m­
 
bm1
,

778 
ext2fs_block_b™m­
 
bm2
);

779 
”rcode_t
 
ext2fs_com·»_šode_b™m­
(
ext2fs_šode_b™m­
 
bm1
,

780 
ext2fs_šode_b™m­
 
bm2
);

781 
”rcode_t
 
ext2fs_£t_šode_b™m­_¿nge
(
ext2fs_šode_b™m­
 
bm­
,

782 
ext2_šo_t
 
¡¬t
, 
num
,

783 *
š
);

784 
”rcode_t
 
ext2fs_£t_šode_b™m­_¿nge2
(
ext2fs_šode_b™m­
 
bm­
,

785 
__u64
 
¡¬t
, 
size_t
 
num
,

786 *
š
);

787 
”rcode_t
 
ext2fs_g‘_šode_b™m­_¿nge
(
ext2fs_šode_b™m­
 
bm­
,

788 
ext2_šo_t
 
¡¬t
, 
num
,

789 *
out
);

790 
”rcode_t
 
ext2fs_g‘_šode_b™m­_¿nge2
(
ext2fs_šode_b™m­
 
bm­
,

791 
__u64
 
¡¬t
, 
size_t
 
num
,

792 *
out
);

793 
”rcode_t
 
ext2fs_£t_block_b™m­_¿nge
(
ext2fs_block_b™m­
 
bm­
,

794 
blk_t
 
¡¬t
, 
num
,

795 *
š
);

796 
”rcode_t
 
ext2fs_£t_block_b™m­_¿nge2
(
ext2fs_block_b™m­
 
bm­
,

797 
blk64_t
 
¡¬t
, 
size_t
 
num
,

798 *
š
);

799 
”rcode_t
 
ext2fs_g‘_block_b™m­_¿nge
(
ext2fs_block_b™m­
 
bm­
,

800 
blk_t
 
¡¬t
, 
num
,

801 *
out
);

802 
”rcode_t
 
ext2fs_g‘_block_b™m­_¿nge2
(
ext2fs_block_b™m­
 
bm­
,

803 
blk64_t
 
¡¬t
, 
size_t
 
num
,

804 *
out
);

807 
dg½_t
 
ext2fs_group_of_blk2
(
ext2_fsys
 
fs
, 
blk64_t
);

808 
blk64_t
 
ext2fs_group_fœ¡_block2
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

809 
blk64_t
 
ext2fs_group_Ï¡_block2
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

810 
ext2fs_group_blocks_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

811 
blk64_t
 
ext2fs_šode_d©a_blocks2
(
ext2_fsys
 
fs
,

812 
ext2_šode
 *
šode
);

813 
blk64_t
 
ext2fs_šode_i_blocks
(
ext2_fsys
 
fs
,

814 
ext2_šode
 *
šode
);

815 
blk64_t
 
ext2fs_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

816 
ext2fs_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

817 
blk64_t
 
blk
);

818 
ext2fs_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

819 
blk64_t
 
blk
);

820 
blk64_t
 
ext2fs_r_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

821 
ext2fs_r_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

822 
blk64_t
 
blk
);

823 
ext2fs_r_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

824 
blk64_t
 
blk
);

825 
blk64_t
 
ext2fs_ä“_blocks_couÁ
(
ext2_su³r_block
 *
su³r
);

826 
ext2fs_ä“_blocks_couÁ_£t
(
ext2_su³r_block
 *
su³r
,

827 
blk64_t
 
blk
);

828 
ext2fs_ä“_blocks_couÁ_add
(
ext2_su³r_block
 *
su³r
,

829 
blk64_t
 
blk
);

831 
ext2_group_desc
 *
ext2fs_group_desc
(
ext2_fsys
 
fs
,

832 
İaque_ext2_group_desc
 *
gdp
,

833 
dg½_t
 
group
);

834 
blk64_t
 
ext2fs_block_b™m­_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

835 
ext2fs_block_b™m­_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

836 
blk64_t
 
blk
);

837 
blk64_t
 
ext2fs_šode_b™m­_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

838 
ext2fs_šode_b™m­_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

839 
blk64_t
 
blk
);

840 
blk64_t
 
ext2fs_šode_bË_loc
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

841 
ext2fs_šode_bË_loc_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

842 
blk64_t
 
blk
);

843 
__u32
 
ext2fs_bg_ä“_blocks_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

844 
ext2fs_bg_ä“_blocks_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

845 
__u32
 
n
);

846 
__u32
 
ext2fs_bg_ä“_šodes_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

847 
ext2fs_bg_ä“_šodes_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

848 
__u32
 
n
);

849 
__u32
 
ext2fs_bg_u£d_dœs_couÁ
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

850 
ext2fs_bg_u£d_dœs_couÁ_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

851 
__u32
 
n
);

852 
__u32
 
ext2fs_bg_™abË_unu£d
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

853 
ext2fs_bg_™abË_unu£d_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
,

854 
__u32
 
n
);

855 
__u16
 
ext2fs_bg_æags
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

856 
ext2fs_bg_æags_z­
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

857 
ext2fs_bg_æags_‹¡
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æag
);

858 
ext2fs_bg_æags_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æags
);

859 
ext2fs_bg_æags_ş—r
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
bg_æags
);

860 
__u16
 
ext2fs_bg_checksum
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

861 
ext2fs_bg_checksum_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
, 
__u16
 
checksum
);

862 
blk64_t
 
ext2fs_fe_aş_block
(
ext2_fsys
 
fs
,

863 cÚ¡ 
ext2_šode
 *
šode
);

864 
ext2fs_fe_aş_block_£t
(
ext2_fsys
 
fs
,

865 
ext2_šode
 *
šode
, 
blk64_t
 
blk
);

868 
”rcode_t
 
ext2fs_block_™”©e
(
ext2_fsys
 
fs
,

869 
ext2_šo_t
 
šo
,

870 
æags
,

871 *
block_buf
,

872 (*
func
)(
ext2_fsys
 
fs
,

873 
blk_t
 *
blockÄ
,

874 
blockút
,

875 *
´iv_d©a
),

876 *
´iv_d©a
);

877 
”rcode_t
 
ext2fs_block_™”©e2
(
ext2_fsys
 
fs
,

878 
ext2_šo_t
 
šo
,

879 
æags
,

880 *
block_buf
,

881 (*
func
)(
ext2_fsys
 
fs
,

882 
blk_t
 *
blockÄ
,

883 
e2_blkút_t
 
blockút
,

884 
blk_t
 
»f_blk
,

885 
»f_off£t
,

886 *
´iv_d©a
),

887 *
´iv_d©a
);

888 
”rcode_t
 
ext2fs_block_™”©e3
(
ext2_fsys
 
fs
,

889 
ext2_šo_t
 
šo
,

890 
æags
,

891 *
block_buf
,

892 (*
func
)(
ext2_fsys
 
fs
,

893 
blk64_t
 *
blockÄ
,

894 
e2_blkút_t
 
blockút
,

895 
blk64_t
 
»f_blk
,

896 
»f_off£t
,

897 *
´iv_d©a
),

898 *
´iv_d©a
);

901 
”rcode_t
 
ext2fs_bm­
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

902 
ext2_šode
 *
šode
,

903 *
block_buf
, 
bm­_æags
,

904 
blk_t
 
block
, blk_ˆ*
phys_blk
);

905 
”rcode_t
 
ext2fs_bm­2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

906 
ext2_šode
 *
šode
,

907 *
block_buf
, 
bm­_æags
, 
blk64_t
 
block
,

908 *
»t_æags
, 
blk64_t
 *
phys_blk
);

909 
”rcode_t
 
ext2fs_m­_şu¡”_block
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

910 
ext2_šode
 *
šode
, 
blk64_t
 
lblk
,

911 
blk64_t
 *
pblk
);

915 
”rcode_t
 
ext2fs_move_blocks
(
ext2_fsys
 
fs
,

916 
ext2fs_block_b™m­
 
»£rve
,

917 
ext2fs_block_b™m­
 
®loc_m­
,

918 
æags
);

922 
”rcode_t
 
ext2fs_check_desc
(
ext2_fsys
 
fs
);

925 
”rcode_t
 
ext2fs_şo£
(
ext2_fsys
 
fs
);

926 
”rcode_t
 
ext2fs_şo£2
(
ext2_fsys
 
fs
, 
æags
);

927 
”rcode_t
 
ext2fs_æush
(
ext2_fsys
 
fs
);

928 
”rcode_t
 
ext2fs_æush2
(
ext2_fsys
 
fs
, 
æags
);

929 
ext2fs_bg_has_su³r
(
ext2_fsys
 
fs
, 
dg½_t
 
group_block
);

930 
”rcode_t
 
ext2fs_su³r_ªd_bgd_loc2
(
ext2_fsys
 
fs
,

931 
dg½_t
 
group
,

932 
blk64_t
 *
»t_su³r_blk
,

933 
blk64_t
 *
»t_Şd_desc_blk
,

934 
blk64_t
 *
»t_Ãw_desc_blk
,

935 
blk_t
 *
»t_u£d_blks
);

936 
ext2fs_su³r_ªd_bgd_loc
(
ext2_fsys
 
fs
,

937 
dg½_t
 
group
,

938 
blk_t
 *
»t_su³r_blk
,

939 
blk_t
 *
»t_Şd_desc_blk
,

940 
blk_t
 *
»t_Ãw_desc_blk
,

941 *
»t_m‘a_bg
);

942 
ext2fs_upd©e_dyÇmic_»v
(
ext2_fsys
 
fs
);

945 
__u32
 
ext2fs_üc32c_be
(__u32 
üc
, cÚ¡ *
p
, 
size_t
 
Ën
);

946 
__u32
 
ext2fs_üc32c_Ë
(__u32 
üc
, cÚ¡ *
p
, 
size_t
 
Ën
);

949 
ext2fs_group_desc_csum_£t
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

950 
ext2fs_group_desc_csum_v”ify
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

951 
”rcode_t
 
ext2fs_£t_gdt_csum
(
ext2_fsys
 
fs
);

952 
__u16
 
ext2fs_group_desc_csum
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

956 
”rcode_t
 
ext2fs_g‘_num_dœs
(
ext2_fsys
 
fs
, 
ext2_šo_t
 *
»t_num_dœs
);

957 
”rcode_t
 
ext2fs_š™_dbli¡
(
ext2_fsys
 
fs
, 
ext2_dbli¡
 *
»t_dbli¡
);

958 
”rcode_t
 
ext2fs_add_dœ_block
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

959 
blk_t
 
blk
, 
blockút
);

960 
”rcode_t
 
ext2fs_add_dœ_block2
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

961 
blk64_t
 
blk
, 
e2_blkút_t
 
blockút
);

962 
ext2fs_dbli¡_sÜt
(
ext2_dbli¡
 
dbli¡
,

963 
EXT2_QSORT_TYPE
 (*
sÜtfunc
)(const *,

965 
ext2fs_dbli¡_sÜt2
(
ext2_dbli¡
 
dbli¡
,

966 
EXT2_QSORT_TYPE
 (*
sÜtfunc
)(const *,

968 
”rcode_t
 
ext2fs_dbli¡_™”©e
(
ext2_dbli¡
 
dbli¡
,

969 (*
func
)(
ext2_fsys
 
fs
, 
ext2_db_’Œy
 *
db_šfo
,

970 *
´iv_d©a
),

971 *
´iv_d©a
);

972 
”rcode_t
 
ext2fs_dbli¡_™”©e2
(
ext2_dbli¡
 
dbli¡
,

973 (*
func
)(
ext2_fsys
 
fs
, 
ext2_db_’Œy2
 *
db_šfo
,

974 *
´iv_d©a
),

975 *
´iv_d©a
);

976 
”rcode_t
 
ext2fs_£t_dœ_block
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

977 
blk_t
 
blk
, 
blockút
);

978 
”rcode_t
 
ext2fs_£t_dœ_block2
(
ext2_dbli¡
 
dbli¡
, 
ext2_šo_t
 
šo
,

979 
blk64_t
 
blk
, 
e2_blkút_t
 
blockút
);

980 
”rcode_t
 
ext2fs_cİy_dbli¡
(
ext2_dbli¡
 
¤c
,

981 
ext2_dbli¡
 *
de¡
);

982 
ext2fs_dbli¡_couÁ
(
ext2_dbli¡
 
dbli¡
);

983 
blk64_t
 
ext2fs_dbli¡_couÁ2
(
ext2_dbli¡
 
dbli¡
);

984 
”rcode_t
 
ext2fs_dbli¡_g‘_Ï¡
(
ext2_dbli¡
 
dbli¡
,

985 
ext2_db_’Œy
 **
’Œy
);

986 
”rcode_t
 
ext2fs_dbli¡_g‘_Ï¡2
(
ext2_dbli¡
 
dbli¡
,

987 
ext2_db_’Œy2
 **
’Œy
);

988 
”rcode_t
 
ext2fs_dbli¡_drİ_Ï¡
(
ext2_dbli¡
 
dbli¡
);

991 
”rcode_t


992 
ext2fs_dbli¡_dœ_™”©e
(
ext2_dbli¡
 
dbli¡
,

993 
æags
,

994 *
block_buf
,

995 (*
func
)(
ext2_šo_t
 
dœ
,

996 
’Œy
,

997 
ext2_dœ_’Œy
 *
dœ’t
,

998 
off£t
,

999 
blocksize
,

1000 *
buf
,

1001 *
´iv_d©a
),

1002 *
´iv_d©a
);

1005 
”rcode_t
 
ext2fs_»ad_dœ_block
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1006 *
buf
);

1007 
”rcode_t
 
ext2fs_»ad_dœ_block2
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1008 *
buf
, 
æags
);

1009 
”rcode_t
 
ext2fs_»ad_dœ_block3
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1010 *
buf
, 
æags
);

1011 
”rcode_t
 
ext2fs_wr™e_dœ_block
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1012 *
buf
);

1013 
”rcode_t
 
ext2fs_wr™e_dœ_block2
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1014 *
buf
, 
æags
);

1015 
”rcode_t
 
ext2fs_wr™e_dœ_block3
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1016 *
buf
, 
æags
);

1019 
”rcode_t
 
ext2fs_dœhash
(
v”siÚ
, cÚ¡ *
Çme
, 
Ën
,

1020 cÚ¡ 
__u32
 *
£ed
,

1021 
ext2_dœhash_t
 *
»t_hash
,

1022 
ext2_dœhash_t
 *
»t_mšÜ_hash
);

1026 
”rcode_t
 
ext2fs_g‘_»c_Ën
(
ext2_fsys
 
fs
,

1027 
ext2_dœ_’Œy
 *
dœ’t
,

1028 *
»c_Ën
);

1029 
”rcode_t
 
ext2fs_£t_»c_Ën
(
ext2_fsys
 
fs
,

1030 
Ën
,

1031 
ext2_dœ_’Œy
 *
dœ’t
);

1032 
”rcode_t
 
ext2fs_dœ_™”©e
(
ext2_fsys
 
fs
,

1033 
ext2_šo_t
 
dœ
,

1034 
æags
,

1035 *
block_buf
,

1036 (*
func
)(
ext2_dœ_’Œy
 *
dœ’t
,

1037 
off£t
,

1038 
blocksize
,

1039 *
buf
,

1040 *
´iv_d©a
),

1041 *
´iv_d©a
);

1042 
”rcode_t
 
ext2fs_dœ_™”©e2
(
ext2_fsys
 
fs
,

1043 
ext2_šo_t
 
dœ
,

1044 
æags
,

1045 *
block_buf
,

1046 (*
func
)(
ext2_šo_t
 
dœ
,

1047 
’Œy
,

1048 
ext2_dœ_’Œy
 *
dœ’t
,

1049 
off£t
,

1050 
blocksize
,

1051 *
buf
,

1052 *
´iv_d©a
),

1053 *
´iv_d©a
);

1056 
”rcode_t
 
ext2fs_dup_hªdË
(
ext2_fsys
 
¤c
,ƒxt2_fsy *
de¡
);

1059 
”rcode_t
 
ext2fs_ex·nd_dœ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
);

1062 
__u32
 
ext2fs_ext_©Œ_hash_’Œy
(
ext2_ext_©Œ_’Œy
 *
’Œy
,

1063 *
d©a
);

1064 
”rcode_t
 
ext2fs_»ad_ext_©Œ
(
ext2_fsys
 
fs
, 
blk_t
 
block
, *
buf
);

1065 
”rcode_t
 
ext2fs_»ad_ext_©Œ2
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1066 *
buf
);

1067 
”rcode_t
 
ext2fs_wr™e_ext_©Œ
(
ext2_fsys
 
fs
, 
blk_t
 
block
,

1068 *
buf
);

1069 
”rcode_t
 
ext2fs_wr™e_ext_©Œ2
(
ext2_fsys
 
fs
, 
blk64_t
 
block
,

1070 *
buf
);

1071 
”rcode_t
 
ext2fs_adju¡_—_»fcouÁ
(
ext2_fsys
 
fs
, 
blk_t
 
blk
,

1072 *
block_buf
,

1073 
adju¡
, 
__u32
 *
ÃwcouÁ
);

1074 
”rcode_t
 
ext2fs_adju¡_—_»fcouÁ2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
,

1075 *
block_buf
,

1076 
adju¡
, 
__u32
 *
ÃwcouÁ
);

1079 
”rcode_t
 
ext2fs_ex‹Á_h—d”_v”ify
(*
±r
, 
size
);

1080 
”rcode_t
 
ext2fs_ex‹Á_İ’
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1081 
ext2_ex‹Á_hªdË_t
 *
hªdË
);

1082 
”rcode_t
 
ext2fs_ex‹Á_İ’2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1083 
ext2_šode
 *
šode
,

1084 
ext2_ex‹Á_hªdË_t
 *
»t_hªdË
);

1085 
ext2fs_ex‹Á_ä“
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1086 
”rcode_t
 
ext2fs_ex‹Á_g‘
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1087 
æags
, 
ext2fs_ex‹Á
 *
ex‹Á
);

1088 
”rcode_t
 
ext2fs_ex‹Á_node_¥l™
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1089 
”rcode_t
 
ext2fs_ex‹Á_»¶aû
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
,

1090 
ext2fs_ex‹Á
 *
ex‹Á
);

1091 
”rcode_t
 
ext2fs_ex‹Á_š£¹
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
,

1092 
ext2fs_ex‹Á
 *
ex‹Á
);

1093 
”rcode_t
 
ext2fs_ex‹Á_£t_bm­
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1094 
blk64_t
 
logiÿl
, blk64_ˆ
physiÿl
,

1095 
æags
);

1096 
”rcode_t
 
ext2fs_ex‹Á_d–‘e
(
ext2_ex‹Á_hªdË_t
 
hªdË
, 
æags
);

1097 
”rcode_t
 
ext2fs_ex‹Á_g‘_šfo
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1098 
ext2_ex‹Á_šfo
 *
šfo
);

1099 
”rcode_t
 
ext2fs_ex‹Á_gÙo
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1100 
blk64_t
 
blk
);

1101 
”rcode_t
 
ext2fs_ex‹Á_gÙo2
(
ext2_ex‹Á_hªdË_t
 
hªdË
,

1102 
Ëaf_Ëv–
, 
blk64_t
 
blk
);

1103 
”rcode_t
 
ext2fs_ex‹Á_fix_·»Ás
(
ext2_ex‹Á_hªdË_t
 
hªdË
);

1106 
”rcode_t
 
ext2fs_fe_İ’2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1107 
ext2_šode
 *
šode
,

1108 
æags
, 
ext2_fe_t
 *
»t
);

1109 
”rcode_t
 
ext2fs_fe_İ’
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1110 
æags
, 
ext2_fe_t
 *
»t
);

1111 
ext2_fsys
 
ext2fs_fe_g‘_fs
(
ext2_fe_t
 
fe
);

1112 
ext2_šode
 *
ext2fs_fe_g‘_šode
(
ext2_fe_t
 
fe
);

1113 
ext2_šo_t
 
ext2fs_fe_g‘_šode_num
(
ext2_fe_t
 
fe
);

1114 
”rcode_t
 
ext2fs_fe_şo£
(
ext2_fe_t
 
fe
);

1115 
”rcode_t
 
ext2fs_fe_æush
(
ext2_fe_t
 
fe
);

1116 
”rcode_t
 
ext2fs_fe_»ad
(
ext2_fe_t
 
fe
, *
buf
,

1117 
wª‹d
, *
gÙ
);

1118 
”rcode_t
 
ext2fs_fe_wr™e
(
ext2_fe_t
 
fe
, cÚ¡ *
buf
,

1119 
nby‹s
, *
wr™‹n
);

1120 
”rcode_t
 
ext2fs_fe_Î£ek
(
ext2_fe_t
 
fe
, 
__u64
 
off£t
,

1121 
wh’û
, 
__u64
 *
»t_pos
);

1122 
”rcode_t
 
ext2fs_fe_l£ek
(
ext2_fe_t
 
fe
, 
ext2_off_t
 
off£t
,

1123 
wh’û
, 
ext2_off_t
 *
»t_pos
);

1124 
”rcode_t
 
ext2fs_fe_g‘_lsize
(
ext2_fe_t
 
fe
, 
__u64
 *
»t_size
);

1125 
ext2_off_t
 
ext2fs_fe_g‘_size
(
ext2_fe_t
 
fe
);

1126 
”rcode_t
 
ext2fs_fe_£t_size
(
ext2_fe_t
 
fe
, 
ext2_off_t
 
size
);

1127 
”rcode_t
 
ext2fs_fe_£t_size2
(
ext2_fe_t
 
fe
, 
ext2_off64_t
 
size
);

1130 *
ext2fs_fšd_block_deviû
(
dev_t
 
deviû
);

1133 
”rcode_t
 
ext2fs_sync_deviû
(
fd
, 
æushb
);

1136 
ext2fs_ä“
(
ext2_fsys
 
fs
);

1137 
ext2fs_ä“_dbli¡
(
ext2_dbli¡
 
dbli¡
);

1138 
ext2fs_badblocks_li¡_ä“
(
ext2_badblocks_li¡
 
bb
);

1139 
ext2fs_u32_li¡_ä“
(
ext2_u32_li¡
 
bb
);

1142 
ext2fs_ä“_g’”ic_b™m­
(
ext2fs_šode_b™m­
 
b™m­
);

1143 
”rcode_t
 
ext2fs_make_g’”ic_b™m­
Ó¼code_ˆ
magic
, 
ext2_fsys
 
fs
,

1144 
__u32
 
¡¬t
, __u32 
’d
,

1145 
__u32
 
»®_’d
,

1146 cÚ¡ *
desü
, *
š™_m­
,

1147 
ext2fs_g’”ic_b™m­
 *
»t
);

1148 
”rcode_t
 
ext2fs_®loÿ‹_g’”ic_b™m­
(
__u32
 
¡¬t
,

1149 
__u32
 
’d
,

1150 
__u32
 
»®_’d
,

1151 cÚ¡ *
desü
,

1152 
ext2fs_g’”ic_b™m­
 *
»t
);

1153 
”rcode_t
 
ext2fs_cİy_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
¤c
,

1154 
ext2fs_g’”ic_b™m­
 *
de¡
);

1155 
ext2fs_ş—r_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
b™m­
);

1156 
”rcode_t
 
ext2fs_fudge_g’”ic_b™m­_’d
(
ext2fs_šode_b™m­
 
b™m­
,

1157 
”rcode_t
 
magic
,

1158 
”rcode_t
 
Ãq
,

1159 
ext2_šo_t
 
’d
,

1160 
ext2_šo_t
 *
Ûnd
);

1161 
ext2fs_£t_g’”ic_b™m­_·ddšg
(
ext2fs_g’”ic_b™m­
 
m­
);

1162 
”rcode_t
 
ext2fs_»size_g’”ic_b™m­
Ó¼code_ˆ
magic
,

1163 
__u32
 
Ãw_’d
,

1164 
__u32
 
Ãw_»®_’d
,

1165 
ext2fs_g’”ic_b™m­
 
bm­
);

1166 
”rcode_t
 
ext2fs_com·»_g’”ic_b™m­
Ó¼code_ˆ
magic
,ƒ¼code_ˆ
Ãq
,

1167 
ext2fs_g’”ic_b™m­
 
bm1
,

1168 
ext2fs_g’”ic_b™m­
 
bm2
);

1169 
”rcode_t
 
ext2fs_g‘_g’”ic_b™m­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1170 
”rcode_t
 
magic
,

1171 
__u32
 
¡¬t
, __u32 
num
,

1172 *
out
);

1173 
”rcode_t
 
ext2fs_£t_g’”ic_b™m­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1174 
”rcode_t
 
magic
,

1175 
__u32
 
¡¬t
, __u32 
num
,

1176 *
š
);

1177 
”rcode_t
 
ext2fs_fšd_fœ¡_z”o_g’”ic_b™m­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

1178 
__u32
 
¡¬t
, __u32 
’d
,

1179 
__u32
 *
out
);

1184 
	#BMAP_STATS


	)

1186 
ext2fs_ä“_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
);

1187 
”rcode_t
 
ext2fs_®loc_g’”ic_bm­
(
ext2_fsys
 
fs
,ƒ¼code_ˆ
magic
,

1188 
ty³
, 
__u64
 
¡¬t
, __u64 
’d
,

1189 
__u64
 
»®_’d
,

1190 cÚ¡ *
desü
,

1191 
ext2fs_g’”ic_b™m­
 *
»t
);

1192 
”rcode_t
 
ext2fs_cİy_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
¤c
,

1193 
ext2fs_g’”ic_b™m­
 *
de¡
);

1194 
ext2fs_ş—r_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
);

1195 
”rcode_t
 
ext2fs_fudge_g’”ic_bm­_’d
(
ext2fs_g’”ic_b™m­
 
b™m­
,

1196 
”rcode_t
 
Ãq
,

1197 
__u64
 
’d
, __u64 *
Ûnd
);

1198 
ext2fs_£t_g’”ic_bm­_·ddšg
(
ext2fs_g’”ic_b™m­
 
bm­
);

1199 
”rcode_t
 
ext2fs_»size_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
,

1200 
__u64
 
Ãw_’d
,

1201 
__u64
 
Ãw_»®_’d
);

1202 
”rcode_t
 
ext2fs_com·»_g’”ic_bm­
Ó¼code_ˆ
Ãq
,

1203 
ext2fs_g’”ic_b™m­
 
bm1
,

1204 
ext2fs_g’”ic_b™m­
 
bm2
);

1205 
”rcode_t
 
ext2fs_g‘_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1206 
__u64
 
¡¬t
, 
num
,

1207 *
out
);

1208 
”rcode_t
 
ext2fs_£t_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
bm­
,

1209 
__u64
 
¡¬t
, 
num
,

1210 *
š
);

1211 
”rcode_t
 
ext2fs_cÚv”t_subşu¡”_b™m­
(
ext2_fsys
 
fs
,

1212 
ext2fs_block_b™m­
 *
b™m­
);

1215 
”rcode_t
 
ext2fs_g‘_deviû_size
(cÚ¡ *
fe
, 
blocksize
,

1216 
blk_t
 *
»tblocks
);

1217 
”rcode_t
 
ext2fs_g‘_deviû_size2
(cÚ¡ *
fe
, 
blocksize
,

1218 
blk64_t
 *
»tblocks
);

1221 
ext2fs_g‘_dio_®ignm’t
(
fd
);

1222 
”rcode_t
 
ext2fs_g‘_deviû_£ùsize
(cÚ¡ *
fe
, *
£ùsize
);

1223 
”rcode_t
 
ext2fs_g‘_deviû_phys_£ùsize
(cÚ¡ *
fe
, *
£ùsize
);

1226 
”rcode_t
 
ext2fs_iblk_add_blocks
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
,

1227 
blk64_t
 
num_blocks
);

1228 
”rcode_t
 
ext2fs_iblk_sub_blocks
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
,

1229 
blk64_t
 
num_blocks
);

1230 
”rcode_t
 
ext2fs_iblk_£t
(
ext2_fsys
 
fs
, 
ext2_šode
 *
šode
, 
blk64_t
 
b
);

1233 
”rcode_t
 
ext2fs_image_šode_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1234 
”rcode_t
 
ext2fs_image_šode_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1235 
”rcode_t
 
ext2fs_image_su³r_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1236 
”rcode_t
 
ext2fs_image_su³r_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1237 
”rcode_t
 
ext2fs_image_b™m­_wr™e
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1238 
”rcode_t
 
ext2fs_image_b™m­_»ad
(
ext2_fsys
 
fs
, 
fd
, 
æags
);

1241 
”rcode_t
 
ext2fs_»ad_šd_block
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, *
buf
);

1242 
”rcode_t
 
ext2fs_wr™e_šd_block
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, *
buf
);

1245 
”rcode_t
 
ext2fs_š™Ÿlize
(cÚ¡ *
Çme
, 
æags
,

1246 
ext2_su³r_block
 *
·¿m
,

1247 
io_mªag”
 
mªag”
, 
ext2_fsys
 *
»t_fs
);

1250 
ext2fs_ä“_icouÁ
(
ext2_icouÁ_t
 
icouÁ
);

1251 
”rcode_t
 
ext2fs_ü—‹_icouÁ_tdb
(
ext2_fsys
 
fs
, *
tdb_dœ
,

1252 
æags
, 
ext2_icouÁ_t
 *
»t
);

1253 
”rcode_t
 
ext2fs_ü—‹_icouÁ2
(
ext2_fsys
 
fs
, 
æags
,

1254 
size
,

1255 
ext2_icouÁ_t
 
hšt
,ƒxt2_icouÁ_ˆ*
»t
);

1256 
”rcode_t
 
ext2fs_ü—‹_icouÁ
(
ext2_fsys
 
fs
, 
æags
,

1257 
size
,

1258 
ext2_icouÁ_t
 *
»t
);

1259 
”rcode_t
 
ext2fs_icouÁ_ãtch
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1260 
__u16
 *
»t
);

1261 
”rcode_t
 
ext2fs_icouÁ_šüem’t
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1262 
__u16
 *
»t
);

1263 
”rcode_t
 
ext2fs_icouÁ_deüem’t
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1264 
__u16
 *
»t
);

1265 
”rcode_t
 
ext2fs_icouÁ_¡Üe
(
ext2_icouÁ_t
 
icouÁ
, 
ext2_šo_t
 
šo
,

1266 
__u16
 
couÁ
);

1267 
ext2_šo_t
 
ext2fs_g‘_icouÁ_size
(
ext2_icouÁ_t
 
icouÁ
);

1268 
”rcode_t
 
ext2fs_icouÁ_v®id©e
(
ext2_icouÁ_t
 
icouÁ
, 
FILE
 *);

1272 
”rcode_t
 
ext2fs_g‘_mem®ign
(
size
,

1273 
®ign
, *
±r
);

1276 
”rcode_t
 
ext2fs_æush_iÿche
(
ext2_fsys
 
fs
);

1277 
”rcode_t
 
ext2fs_g‘_Ãxt_šode_fuÎ
(
ext2_šode_sÿn
 
sÿn
,

1278 
ext2_šo_t
 *
šo
,

1279 
ext2_šode
 *
šode
,

1280 
bufsize
);

1281 
”rcode_t
 
ext2fs_İ’_šode_sÿn
(
ext2_fsys
 
fs
, 
bufãr_blocks
,

1282 
ext2_šode_sÿn
 *
»t_sÿn
);

1283 
ext2fs_şo£_šode_sÿn
(
ext2_šode_sÿn
 
sÿn
);

1284 
”rcode_t
 
ext2fs_g‘_Ãxt_šode
(
ext2_šode_sÿn
 
sÿn
, 
ext2_šo_t
 *
šo
,

1285 
ext2_šode
 *
šode
);

1286 
”rcode_t
 
ext2fs_šode_sÿn_gÙo_blockgroup
(
ext2_šode_sÿn
 
sÿn
,

1287 
group
);

1288 
ext2fs_£t_šode_ÿÎback


1289 (
ext2_šode_sÿn
 
sÿn
,

1290 
”rcode_t
 (*
dÚe_group
)(
ext2_fsys
 
fs
,

1291 
ext2_šode_sÿn
 
sÿn
,

1292 
dg½_t
 
group
,

1293 * 
´iv_d©a
),

1294 *
dÚe_group_d©a
);

1295 
ext2fs_šode_sÿn_æags
(
ext2_šode_sÿn
 
sÿn
, 
£t_æags
,

1296 
ş—r_æags
);

1297 
”rcode_t
 
ext2fs_»ad_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1298 
ext2_šode
 * 
šode
,

1299 
bufsize
);

1300 
”rcode_t
 
ext2fs_»ad_šode
 (
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1301 
ext2_šode
 * 
šode
);

1302 
”rcode_t
 
ext2fs_wr™e_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1303 
ext2_šode
 * 
šode
,

1304 
bufsize
);

1305 
”rcode_t
 
ext2fs_wr™e_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1306 
ext2_šode
 * 
šode
);

1307 
”rcode_t
 
ext2fs_wr™e_Ãw_šode
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1308 
ext2_šode
 * 
šode
);

1309 
”rcode_t
 
ext2fs_g‘_blocks
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
, 
blk_t
 *
blocks
);

1310 
”rcode_t
 
ext2fs_check_dœeùÜy
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

1313 
io_mªag”
 
šode_io_mªag”
;

1314 
”rcode_t
 
ext2fs_šode_io_š‹º
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1315 **
Çme
);

1316 
”rcode_t
 
ext2fs_šode_io_š‹º2
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1317 
ext2_šode
 *
šode
,

1318 **
Çme
);

1321 
”rcode_t
 
ext2fs_check_if_mouÁed
(cÚ¡ *
fe
, *
mouÁ_æags
);

1322 
”rcode_t
 
ext2fs_check_mouÁ_pošt
(cÚ¡ *
deviû
, *
mouÁ_æags
,

1323 *
mt
, 
m’
);

1330 
”rcode_t
 
ext2fs_punch
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
,

1331 
ext2_šode
 *
šode
,

1332 *
block_buf
, 
blk64_t
 
¡¬t
,

1333 
blk64_t
 
’d
);

1336 
”rcode_t
 
ext2fs_lookup
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1337 
Çm–’
, *
buf
, 
ext2_šo_t
 *
šode
);

1338 
”rcode_t
 
ext2fs_Çmei
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1339 cÚ¡ *
Çme
, 
ext2_šo_t
 *
šode
);

1340 
”rcode_t
 
ext2fs_Çmei_fŞlow
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1341 cÚ¡ *
Çme
, 
ext2_šo_t
 *
šode
);

1342 
”rcode_t
 
ext2fs_fŞlow_lšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
roÙ
,ƒxt2_šo_ˆ
cwd
,

1343 
ext2_šo_t
 
šode
,ƒxt2_šo_ˆ*
»s_šode
);

1346 
ext2fs_Çtive_æag
();

1349 
”rcode_t
 
ext2fs_Ãw_dœ_block
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ_šo
,

1350 
ext2_šo_t
 
·»Á_šo
, **
block
);

1353 
”rcode_t
 
ext2fs_mkdœ
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
·»Á
,ƒxt2_šo_ˆ
šum
,

1354 cÚ¡ *
Çme
);

1357 
”rcode_t
 
ext2fs_z”o_blocks
(
ext2_fsys
 
fs
, 
blk_t
 
blk
, 
num
,

1358 
blk_t
 *
»t_blk
, *
»t_couÁ
);

1359 
”rcode_t
 
ext2fs_z”o_blocks2
(
ext2_fsys
 
fs
, 
blk64_t
 
blk
, 
num
,

1360 
blk64_t
 *
»t_blk
, *
»t_couÁ
);

1361 
”rcode_t
 
ext2fs_ü—‹_jouº®_su³rblock
(
ext2_fsys
 
fs
,

1362 
__u32
 
num_blocks
, 
æags
,

1363 **
»t_jsb
);

1364 
”rcode_t
 
ext2fs_add_jouº®_deviû
(
ext2_fsys
 
fs
,

1365 
ext2_fsys
 
jouº®_dev
);

1366 
”rcode_t
 
ext2fs_add_jouº®_šode
(
ext2_fsys
 
fs
, 
blk_t
 
num_blocks
,

1367 
æags
);

1368 
ext2fs_deçuÉ_jouº®_size
(
__u64
 
num_blocks
);

1371 
”rcode_t
 
ext2fs_İ’
(cÚ¡ *
Çme
, 
æags
, 
su³rblock
,

1372 
block_size
, 
io_mªag”
 
mªag”
,

1373 
ext2_fsys
 *
»t_fs
);

1374 
”rcode_t
 
ext2fs_İ’2
(cÚ¡ *
Çme
, cÚ¡ *
io_İtiÚs
,

1375 
æags
, 
su³rblock
,

1376 
block_size
, 
io_mªag”
 
mªag”
,

1377 
ext2_fsys
 *
»t_fs
);

1378 
blk64_t
 
ext2fs_desütÜ_block_loc2
(
ext2_fsys
 
fs
,

1379 
blk64_t
 
group_block
, 
dg½_t
 
i
);

1380 
blk_t
 
ext2fs_desütÜ_block_loc
(
ext2_fsys
 
fs
, blk_ˆ
group_block
,

1381 
dg½_t
 
i
);

1382 
”rcode_t
 
ext2fs_g‘_d©a_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 *
Şd_io
);

1383 
”rcode_t
 
ext2fs_£t_d©a_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 
Ãw_io
);

1384 
”rcode_t
 
ext2fs_»wr™e_to_io
(
ext2_fsys
 
fs
, 
io_chªÃl
 
Ãw_io
);

1387 
”rcode_t
 
ext2fs_g‘_·thÇme
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
,ƒxt2_šo_ˆ
šo
,

1388 **
Çme
);

1391 
”rcode_t
 
ext2fs_lšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1392 
ext2_šo_t
 
šo
, 
æags
);

1393 
”rcode_t
 
ext2fs_uÆšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
dœ
, cÚ¡ *
Çme
,

1394 
ext2_šo_t
 
šo
, 
æags
);

1397 
”rcode_t
 
ext2fs_symlšk
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
·»Á
,ƒxt2_šo_ˆ
šo
,

1398 cÚ¡ *
Çme
, *
rg‘
);

1401 
”rcode_t
 
ext2fs_mmp_»ad
(
ext2_fsys
 
fs
, 
blk64_t
 
mmp_blk
, *
buf
);

1402 
”rcode_t
 
ext2fs_mmp_wr™e
(
ext2_fsys
 
fs
, 
blk64_t
 
mmp_blk
, *
buf
);

1403 
”rcode_t
 
ext2fs_mmp_ş—r
(
ext2_fsys
 
fs
);

1404 
”rcode_t
 
ext2fs_mmp_š™
(
ext2_fsys
 
fs
);

1405 
”rcode_t
 
ext2fs_mmp_¡¬t
(
ext2_fsys
 
fs
);

1406 
”rcode_t
 
ext2fs_mmp_upd©e
(
ext2_fsys
 
fs
);

1407 
”rcode_t
 
ext2fs_mmp_¡İ
(
ext2_fsys
 
fs
);

1408 
ext2fs_mmp_Ãw_£q
();

1411 
”rcode_t
 
ext2fs_»ad_bb_šode
(
ext2_fsys
 
fs
,

1412 
ext2_badblocks_li¡
 *
bb_li¡
);

1415 
”rcode_t
 
ext2fs_»ad_bb_FILE2
(
ext2_fsys
 
fs
, 
FILE
 *
f
,

1416 
ext2_badblocks_li¡
 *
bb_li¡
,

1417 *
´iv_d©a
,

1418 (*
šv®id
)(
ext2_fsys
 
fs
,

1419 
blk_t
 
blk
,

1420 *
bad¡r
,

1421 *
´iv_d©a
));

1422 
”rcode_t
 
ext2fs_»ad_bb_FILE
(
ext2_fsys
 
fs
, 
FILE
 *
f
,

1423 
ext2_badblocks_li¡
 *
bb_li¡
,

1424 (*
šv®id
)(
ext2_fsys
 
fs
,

1425 
blk_t
 
blk
));

1428 
”rcode_t
 
ext2fs_ü—‹_»size_šode
(
ext2_fsys
 
fs
);

1431 
ext2fs_sw­_ext_©Œ
(*
to
, *
äom
, 
bufsize
,

1432 
has_h—d”
);

1433 
ext2fs_sw­_ext_©Œ_h—d”
(
ext2_ext_©Œ_h—d”
 *
to_h—d”
,

1434 
ext2_ext_©Œ_h—d”
 *
äom_hdr
);

1435 
ext2fs_sw­_ext_©Œ_’Œy
(
ext2_ext_©Œ_’Œy
 *
to_’Œy
,

1436 
ext2_ext_©Œ_’Œy
 *
äom_’Œy
);

1437 
ext2fs_sw­_su³r
(
ext2_su³r_block
 * 
su³r
);

1438 
ext2fs_sw­_group_desc
(
ext2_group_desc
 *
gdp
);

1439 
ext2fs_sw­_group_desc2
(
ext2_fsys
, 
ext2_group_desc
 *
gdp
);

1440 
ext2fs_sw­_šode_fuÎ
(
ext2_fsys
 
fs
, 
ext2_šode_Ïrge
 *
t
,

1441 
ext2_šode_Ïrge
 *
f
, 
ho¡Üd”
,

1442 
bufsize
);

1443 
ext2fs_sw­_šode
(
ext2_fsys
 
fs
,
ext2_šode
 *
t
,

1444 
ext2_šode
 *
f
, 
ho¡Üd”
);

1445 
ext2fs_sw­_mmp
(
mmp_¡ruù
 *
mmp
);

1448 
ext2fs_İ’_fe
(cÚ¡ *
·thÇme
, 
æags
, 
mode_t
 
mode
);

1449 
ext2fs_¡©
(cÚ¡ *
·th
, 
ext2fs_¡ruù_¡©
 *
buf
);

1450 
ext2fs_f¡©
(
fd
, 
ext2fs_¡ruù_¡©
 *
buf
);

1453 
ext2fs_šode_has_v®id_blocks
(
ext2_šode
 *
šode
);

1454 
ext2fs_šode_has_v®id_blocks2
(
ext2_fsys
 
fs
,

1455 
ext2_šode
 *
šode
);

1458 
ext2fs_·r£_v”siÚ_¡ršg
(cÚ¡ *
v”_¡ršg
);

1459 
ext2fs_g‘_lib¿ry_v”siÚ
(cÚ¡ **
v”_¡ršg
,

1460 cÚ¡ **
d©e_¡ršg
);

1463 
”rcode_t
 
ext2fs_wr™e_bb_FILE
(
ext2_badblocks_li¡
 
bb_li¡
,

1464 
æags
,

1465 
FILE
 *
f
);

1469 #ifdeà
NO_INLINE_FUNCS


1470 
”rcode_t
 
ext2fs_g‘_mem
(
size
, *
±r
);

1471 
”rcode_t
 
ext2fs_g‘_memz”o
(
size
, *
±r
);

1472 
”rcode_t
 
ext2fs_g‘_¬¿y
(
couÁ
,

1473 
size
, *
±r
);

1474 
”rcode_t
 
ext2fs_g‘_¬¿yz”o
(
couÁ
,

1475 
size
, *
±r
);

1476 
”rcode_t
 
ext2fs_ä“_mem
(*
±r
);

1477 
”rcode_t
 
ext2fs_»size_mem
(
Şd_size
,

1478 
size
, *
±r
);

1479 
ext2fs_m¬k_su³r_dœty
(
ext2_fsys
 
fs
);

1480 
ext2fs_m¬k_chªged
(
ext2_fsys
 
fs
);

1481 
ext2fs_‹¡_chªged
(
ext2_fsys
 
fs
);

1482 
ext2fs_m¬k_v®id
(
ext2_fsys
 
fs
);

1483 
ext2fs_unm¬k_v®id
(
ext2_fsys
 
fs
);

1484 
ext2fs_‹¡_v®id
(
ext2_fsys
 
fs
);

1485 
ext2fs_m¬k_ib_dœty
(
ext2_fsys
 
fs
);

1486 
ext2fs_m¬k_bb_dœty
(
ext2_fsys
 
fs
);

1487 
ext2fs_‹¡_ib_dœty
(
ext2_fsys
 
fs
);

1488 
ext2fs_‹¡_bb_dœty
(
ext2_fsys
 
fs
);

1489 
dg½_t
 
ext2fs_group_of_blk
(
ext2_fsys
 
fs
, 
blk_t
 
blk
);

1490 
dg½_t
 
ext2fs_group_of_šo
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
);

1491 
blk_t
 
ext2fs_group_fœ¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

1492 
blk_t
 
ext2fs_group_Ï¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
);

1493 
blk_t
 
ext2fs_šode_d©a_blocks
(
ext2_fsys
 
fs
,

1494 
ext2_šode
 *
šode
);

1495 
ext2fs_div_û
(
a
, 
b
);

1496 
__u64
 
ext2fs_div64_û
(__u64 
a
, __u64 
b
);

1505 #ià(
defšed
(
INCLUDE_INLINE_FUNCS
è|| !defšed(
NO_INLINE_FUNCS
))

1506 #ifdeà
INCLUDE_INLINE_FUNCS


1507 
	#_INLINE_
 

	)

1509 #ià(
__STDC_VERSION__
 >= 199901L)

1510 
	#_INLINE_
 
šlše


	)

1512 #ifdeà
__GNUC__


1513 
	#_INLINE_
 
__šlše__


	)

1515 
	#_INLINE_
 
šlše


	)

1520 #iâdeà
EXT2_CUSTOM_MEMORY_ROUTINES


1521 
	~<¡ršg.h
>

1525 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_mem
(
size
, *
±r
)

1527 *
µ
;

1529 
µ
 = 
m®loc
(
size
);

1530 ià(!
µ
)

1531  
EXT2_ET_NO_MEMORY
;

1532 
memıy
(
±r
, &
µ
,  (pp));

1536 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_memz”o
(
size
, *
±r
)

1538 *
µ
;

1540 
µ
 = 
m®loc
(
size
);

1541 ià(!
µ
)

1542  
EXT2_ET_NO_MEMORY
;

1543 
mem£t
(
µ
, 0, 
size
);

1544 
memıy
(
±r
, &
µ
, (pp));

1548 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_¬¿y
(
couÁ
, 
size
, *
±r
)

1550 ià(
couÁ
 && (-1UL)/couÁ<
size
)

1551  
EXT2_ET_NO_MEMORY
;

1552  
ext2fs_g‘_mem
(
couÁ
*
size
, 
±r
);

1555 
_INLINE_
 
”rcode_t
 
ext2fs_g‘_¬¿yz”o
(
couÁ
,

1556 
size
, *
±r
)

1558 *
µ
;

1560 ià(
couÁ
 && (-1UL)/couÁ<
size
)

1561  
EXT2_ET_NO_MEMORY
;

1562 
µ
 = 
ÿÎoc
(
couÁ
, 
size
);

1563 ià(!
µ
)

1564  
EXT2_ET_NO_MEMORY
;

1565 
memıy
(
±r
, &
µ
, (pp));

1572 
_INLINE_
 
”rcode_t
 
ext2fs_ä“_mem
(*
±r
)

1574 *
p
;

1576 
memıy
(&
p
, 
±r
, (p));

1577 
ä“
(
p
);

1578 
p
 = 0;

1579 
memıy
(
±r
, &
p
, (p));

1586 
_INLINE_
 
”rcode_t
 
ext2fs_»size_mem
(
EXT2FS_ATTR
((
unu£d
)è
Şd_size
,

1587 
size
, *
±r
)

1589 *
p
;

1593 
memıy
(&
p
, 
±r
, (p));

1594 
p
 = 
»®loc
Õ, 
size
);

1595 ià(!
p
)

1596  
EXT2_ET_NO_MEMORY
;

1597 
memıy
(
±r
, &
p
, (p));

1605 
_INLINE_
 
ext2fs_m¬k_su³r_dœty
(
ext2_fsys
 
fs
)

1607 
fs
->
æags
 |ğ
EXT2_FLAG_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1613 
_INLINE_
 
ext2fs_m¬k_chªged
(
ext2_fsys
 
fs
)

1615 
fs
->
æags
 |ğ
EXT2_FLAG_CHANGED
;

1621 
_INLINE_
 
ext2fs_‹¡_chªged
(
ext2_fsys
 
fs
)

1623  (
fs
->
æags
 & 
EXT2_FLAG_CHANGED
);

1629 
_INLINE_
 
ext2fs_m¬k_v®id
(
ext2_fsys
 
fs
)

1631 
fs
->
æags
 |ğ
EXT2_FLAG_VALID
;

1637 
_INLINE_
 
ext2fs_unm¬k_v®id
(
ext2_fsys
 
fs
)

1639 
fs
->
æags
 &ğ~
EXT2_FLAG_VALID
;

1645 
_INLINE_
 
ext2fs_‹¡_v®id
(
ext2_fsys
 
fs
)

1647  (
fs
->
æags
 & 
EXT2_FLAG_VALID
);

1653 
_INLINE_
 
ext2fs_m¬k_ib_dœty
(
ext2_fsys
 
fs
)

1655 
fs
->
æags
 |ğ
EXT2_FLAG_IB_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1661 
_INLINE_
 
ext2fs_m¬k_bb_dœty
(
ext2_fsys
 
fs
)

1663 
fs
->
æags
 |ğ
EXT2_FLAG_BB_DIRTY
 | 
EXT2_FLAG_CHANGED
;

1669 
_INLINE_
 
ext2fs_‹¡_ib_dœty
(
ext2_fsys
 
fs
)

1671  (
fs
->
æags
 & 
EXT2_FLAG_IB_DIRTY
);

1677 
_INLINE_
 
ext2fs_‹¡_bb_dœty
(
ext2_fsys
 
fs
)

1679  (
fs
->
æags
 & 
EXT2_FLAG_BB_DIRTY
);

1685 
_INLINE_
 
dg½_t
 
ext2fs_group_of_blk
(
ext2_fsys
 
fs
, 
blk_t
 
blk
)

1687  
ext2fs_group_of_blk2
(
fs
, 
blk
);

1692 
_INLINE_
 
dg½_t
 
ext2fs_group_of_šo
(
ext2_fsys
 
fs
, 
ext2_šo_t
 
šo
)

1694  (
šo
 - 1è/ 
fs
->
su³r
->
s_šodes_³r_group
;

1700 
_INLINE_
 
blk_t
 
ext2fs_group_fœ¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
)

1702  (
blk_t
è
ext2fs_group_fœ¡_block2
(
fs
, 
group
);

1708 
_INLINE_
 
blk_t
 
ext2fs_group_Ï¡_block
(
ext2_fsys
 
fs
, 
dg½_t
 
group
)

1710  (
blk_t
è
ext2fs_group_Ï¡_block2
(
fs
, 
group
);

1713 
_INLINE_
 
blk_t
 
ext2fs_šode_d©a_blocks
(
ext2_fsys
 
fs
,

1714 
ext2_šode
 *
šode
)

1716  (
blk_t
è
ext2fs_šode_d©a_blocks2
(
fs
, 
šode
);

1722 
_INLINE_
 
ext2fs_div_û
(
a
, 
b
)

1724 ià(!
a
)

1726  ((
a
 - 1è/ 
b
) + 1;

1729 
_INLINE_
 
__u64
 
ext2fs_div64_û
(__u64 
a
, __u64 
b
)

1731 ià(!
a
)

1733  ((
a
 - 1è/ 
b
) + 1;

1736 #undeà
_INLINE_


1739 #ifdeà
__ılu¥lus


	@libmke2fs/ext2fsP.h

12 
	~"ext2fs.h
"

14 
	#EXT2FS_MAX_NESTED_LINKS
 8

	)

19 
	sext2_¡ruù_u32_li¡
 {

20 
	mmagic
;

21 
	mnum
;

22 
	msize
;

23 
__u32
 *
	mli¡
;

24 
	mbadblocks_æags
;

27 
	sext2_¡ruù_u32_™”©e
 {

28 
	mmagic
;

29 
ext2_u32_li¡
 
	mbb
;

30 
	m±r
;

37 
	sext2_¡ruù_dbli¡
 {

38 
	mmagic
;

39 
ext2_fsys
 
	mfs
;

40 
	msize
;

41 
	mcouÁ
;

42 
	msÜ‹d
;

43 
ext2_db_’Œy2
 * 
	mli¡
;

49 
	sdœ_cÚ‹xt
 {

50 
ext2_šo_t
 
	mdœ
;

51 
	mæags
;

52 *
	mbuf
;

53 (*
	mfunc
)(
ext2_šo_t
 
	mdœ
,

54 
	m’Œy
,

55 
ext2_dœ_’Œy
 *
	mdœ’t
,

56 
	moff£t
,

57 
	mblocksize
,

58 *
	mbuf
,

59 *
	m´iv_d©a
);

60 *
	m´iv_d©a
;

61 
”rcode_t
 
	m”rcode
;

67 
	sext2_šode_ÿche
 {

68 * 
	mbufãr
;

69 
blk64_t
 
	mbufãr_blk
;

70 
	mÿche_Ï¡
;

71 
	mÿche_size
;

72 
	m»fcouÁ
;

73 
ext2_šode_ÿche_’t
 *
	mÿche
;

76 
	sext2_šode_ÿche_’t
 {

77 
ext2_šo_t
 
	mšo
;

78 
ext2_šode
 
	mšode
;

83 
ext2fs_´oûss_dœ_block
(
ext2_fsys
 
fs
,

84 
blk64_t
 *
blockÄ
,

85 
e2_blkút_t
 
blockút
,

86 
blk64_t
 
»f_block
,

87 
»f_off£t
,

88 *
´iv_d©a
);

92 
	sext2fs_num”ic_´og»ss_¡ruù
 {

93 
__u64
 
	mmax
;

94 
	mlog_max
;

95 
	msk_´og»ss
;

98 
ext2fs_num”ic_´og»ss_š™
(
ext2_fsys
 
fs
,

99 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

100 cÚ¡ *
Ïb–
, 
__u64
 
max
);

101 
ext2fs_num”ic_´og»ss_upd©e
(
ext2_fsys
 
fs
,

102 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

103 
__u64
 
v®
);

104 
ext2fs_num”ic_´og»ss_şo£
(
ext2_fsys
 
fs
,

105 
ext2fs_num”ic_´og»ss_¡ruù
 * 
´og»ss
,

106 cÚ¡ *
mes§ge
);

112 
”rcode_t
 
ext2fs_®loc_g’”ic_bm­
(
ext2_fsys
 
fs
,ƒ¼code_ˆ
magic
,

113 
ty³
, 
__u64
 
¡¬t
, __u64 
’d
,

114 
__u64
 
»®_’d
,

115 cÚ¡ * 
desütiÚ
,

116 
ext2fs_g’”ic_b™m­
 *
bm­
);

118 
ext2fs_ä“_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
);

120 
”rcode_t
 
ext2fs_cİy_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
¤c
,

121 
ext2fs_g’”ic_b™m­
 *
de¡
);

123 
”rcode_t
 
ext2fs_»size_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
bm­
,

124 
__u64
 
Ãw_’d
,

125 
__u64
 
Ãw_»®_’d
);

126 
”rcode_t
 
ext2fs_fudge_g’”ic_bm­_’d
(
ext2fs_g’”ic_b™m­
 
b™m­
,

127 
”rcode_t
 
Ãq
,

128 
__u64
 
’d
, __u64 *
Ûnd
);

129 
ext2fs_m¬k_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

130 
__u64
 
¬g
);

131 
ext2fs_unm¬k_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

132 
__u64
 
¬g
);

133 
ext2fs_‹¡_g’”ic_bm­
(
ext2fs_g’”ic_b™m­
 
b™m­
,

134 
__u64
 
¬g
);

135 
”rcode_t
 
ext2fs_£t_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
b™m­
,

136 
__u64
 
¡¬t
, 
num
,

137 *
š
);

138 
”rcode_t
 
ext2fs_g‘_g’”ic_bm­_¿nge
(
ext2fs_g’”ic_b™m­
 
b™m­
,

139 
__u64
 
¡¬t
, 
num
,

140 *
out
);

141 
ext2fs_w¬n_b™m­32
(
ext2fs_g’”ic_b™m­
 
b™m­
,cÚ¡ *
func
);

143 
ext2fs_mem_is_z”o
(cÚ¡ *
mem
, 
size_t
 
Ën
);

145 
ext2fs_fe_block_off£t_too_big
(
ext2_fsys
 
fs
,

146 
ext2_šode
 *
šode
,

147 
blk64_t
 
off£t
);

	@libmke2fs/mke2fs.h

1 #iâdeà
__MKE2FS_H__


2 
	#__MKE2FS_H__


	)

4 
	~"ext2fs/ext2fs.h
"

5 
	~"mke2fs_”r.h
"

8 
	mWRITE_INODE_TABLES_UNKNOWN
 = 0,

9 
	mWRITE_INODE_TABLES_INIT
,

10 
	mWRITE_INODE_TABLES_WRITING
,

11 
	mWRITE_INODE_TABLES_WRITING_DONE
,

12 
	mWRITE_INODE_TABLES_DONE
,

13 
	mWRITE_INODE_TABLES_ERROR
,

16 
	sex‹nded_İt
 {

17 
__u16
 
	m¡ride
;

18 
__u32
 
	m¡re_width
;

19 
__u16
 
	mdesc_size
;

20 
__u16
 
	mmmp_upd©e_š‹rv®
;

21 
	m‹¡_fs
;

22 
	mdisÿrd
;

25 
	se2fs_cfg
 {

26 
	m»£rved_¿tio
;

27 
	mnum_šodes
;

28 
	mæex_bg_size
;

29 
__u32
 
	mblocks_³r_group
;

30 
__u32
 
	mü—tÜ_os
;

31 
	mblocksize
;

32 
	mşu¡”_size
;

33 
	mdœeù_io
;

34 
	mfÜû
;

35 
	mcæag
;

36 
	mv”bo£
;

37 
	mqu›t
;

38 
	mr_İt
;

39 
	msu³r_Úly
;

40 
	mšode_¿tio
;

41 
	mšode_size
;

42 
	mjouº®_size
;

43 
	mnßùiÚ
;

44 
	mbad_blocks_f’ame
[512];

45 
	mfs_ã©u»s
[256];

46 
	mu§ge_ty³s
[256];

47 
	mmouÁ_dœ
[64];

48 
	mfs_uuid
[64];

49 
	mfs_ty³
[16];

50 
	mvŞume_Ïb–
[16];

52 
ex‹nded_İt
 
	mext_İts
;

55 (*
	tmke2fs_cb_func
)(*
	tpD©a
, 
	t¡©
, 
	tcu¼’t
, 
	ttÙ®
);

57 
	smke2fs_hªdË
 {

59 
e2fs_cfg
 
cfg
;

60 
deviû_Çme
[32];

61 *
buf
;

62 *
pD©a
;

63 
mke2fs_cb_func
 
cb_func
;

66 
	`mke2fs
(
mke2fs_hªdË
 *
hªdË
);

	@libmke2fs/mke2fs_err.h

1 #iâdeà
__MKE2FS_ERR_H__


2 
	#__MKE2FS_ERR_H__


	)

5 
	mMKE2FS_INVALID_HANDLE
 = 1001,

6 
	mMKE2FS_FAIL_TO_ALLOCATE_MEMORY
,

7 
	mMKE2FS_PROFILE_ERROR
,

8 
	mMKE2FS_UNAME_ERROR
,

9 
	mMKE2FS_INVALID_BLOCK_SIZE
,

10 
	mMKE2FS_INVALID_CLUSTER_SIZE
,

11 
	mMKE2FS_ILLEGAL_BLOCKS_PER_GROUP
,

12 
	mMKE2FS_BLOCKS_PER_GROUP_NOT_MULTIPLE_OF_8
,

13 
	mMKE2FS_FLEX_BG_SIZE_NOT_POWER_OF_2
,

14 
	mMKE2FS_INVALID_INODE_RATIO
,

15 
	mMKE2FS_INVALID_INODE_SIZE
,

16 
	mMKE2FS_INVALID_RESERVED_RATIO
,

17 
	mMKE2FS_FAIL_TO_PARSE_FSTYPE
,

18 
	mMKE2FS_FAIL_TO_DETERMINE_HW_SECTOR_SIZE
,

19 
	mMKE2FS_FAIL_TO_DETERMINE_PHY_SECTOR_SIZE
,

20 
	mMKE2FS_FAIL_TO_DETERMINE_FS_SIZE
,

21 
	mMKE2FS_FAIL_TO_DETERMINE_MOUNT_STATUS
,

22 
	mMKE2FS_BLOCKSIZE_TOO_SMALL
,

23 
	mMKE2FS_UNSUITABLE_BLOCKSIZE_FOR_32BIT
,

24 
	mMKE2FS_FS_FEATURE_NOT_SUPPORT
,

25 
	mMKE2FS_NOT_SUPPORT_SPARSE_SB
,

26 
	mMKE2FS_NOT_SUPPORT_JOURNAL
,

27 
	mMKE2FS_EXTENTS_ENABLED_FOR_64BIT_FS_NOLY
,

28 
	mMKE2FS_CLUSTER_SIZE_SMALLER_THAN_BLOCK_SIZE
,

29 
	mMKE2FS_UNSUITABLE_CLUSTER_SIZE
,

30 
	mMKE2FS_NEED_EXTENTS_FEATURE
,

31 
	mMKE2FS_FEATURES_CANNOT_ENABLED_SIMULTANEOUSLY
,

32 
	mMKE2FS_NOT_SUPPORT_RESERVED_ONLINE_RESIZE
,

33 
	mMKE2FS_BLOCK_PER_GROUP_OUT_OF_RANGE
,

34 
	mMKE2FS_FLEX_BG_FEATURE_NOT_ENABLED
,

35 
	mMKE2FS_TOO_MANY_INODES
,

36 
	mMKE2FS_UNSUITABLE_INODE_CONFIG
,

37 
	mMKE2FS_SETUP_TDB_ERROR
,

38 
	mMKE2FS_FAIL_TO_INITIALIZE_SUPERBLOCK
,

39 
	mMKE2FS_COULD_NOT_PARSE_UUID
,

40 
	mMKE2FS_UNKNOWN_OS
,

41 
	mMKE2FS_EXT2FS_CLOSE_ERROR
,

42 
	mMKE2FS_FAIL_TO_ALLOCATE_FS_TABLES
,

43 
	mMKE2FS_FAIL_TO_CONVERT_SUBCLUSTER_BITMAP
,

44 
	mMKE2FS_RESERVING_BLOCKS_FOR_ONLINE_RESIZE_ERROR
,

45 
	mMKE2FS_FAIL_TO_OPEN_JOURNAL_DEV
,

46 
	mMKE2FS_FAIL_TO_ADD_JOURNAL
,

47 
	mMKE2FS_FAIL_TO_CREATE_JOURNAL
,

48 
	mMKE2FS_FAIL_TO_INITIALIZE_JOURNAL_SUPERBLOCK
,

49 
	mMKE2FS_FAIL_TO_ZERO_JOURNAL_DEV
,

50 
	mMKE2FS_FAIL_TO_WRITE_JOURNAL_SB
,

51 
	mMKE2FS_ENABLE_MULTIPLE_MOUNT_PROTECTION_ERROR
,

52 
	mMKE2FS_INVALID_BB_LIST
,

53 
	mMKE2FS_BAD_PRIMARY_SB_GROUP_DESCRIPTOR
,

54 
	mMKE2FS_MARK_BAD_BLOCKS_ERROR
,

55 
	mMKE2FS_COULD_NOT_WRITE_BLOCKS_IN_INODE_TABLES
,

56 
	mMKE2FS_FAIL_TO_CREATE_ROOT_DIR
,

57 
	mMKE2FS_FAIL_TO_READ_ROOT_INODE
,

58 
	mMKE2FS_FAIL_TO_SET_ROOT_INODE_OWNERSHIP
,

59 
	mMKE2FS_OOM_ERASING_SECTORS
,

60 
	mMKE2FS_FAIL_TO_OPEN_BB_FILE
,

61 
	mMKE2FS_FAIL_TO_READ_BB_FILE
,

62 
	mMKE2FS_EMPTY_STRING
,

63 
	mMKE2FS_INVALID_FS_OPTIONS
,

64 
	mMKE2FS_INVALID_MOUNT_OPTIONS
,

65 
	mMKE2FS_ABORT_CHECK_PROFILE
,

66 
	mMKE2FS_JOURNAL_BLOCKSIZE_SMALLER_THAN_MINIMUM_BLOCKSIZE
,

67 
	mMKE2FS_COULD_NOT_DETERMINE_DEV_SIZE
,

68 
	mMKE2FS_DEVICE_SIZE_REPORT_TO_BE_0
,

69 
	mMKE2FS_NOT_BLOCK_DEV
,

70 
	mMKE2FS_FAIL_TO_GET_BLKID_CACHE
,

71 
	mMKE2FS_CHECK_MOUNT_POINT_FAIL
,

72 
	mMKE2FS_MOUNTED
,

	@libmke2fs/prof_err.h

6 
	~<‘/com_”r.h
>

8 
	#PROF_VERSION
 (-1429577728L)

	)

9 
	#PROF_MAGIC_NODE
 (-1429577727L)

	)

10 
	#PROF_NO_SECTION
 (-1429577726L)

	)

11 
	#PROF_NO_RELATION
 (-1429577725L)

	)

12 
	#PROF_ADD_NOT_SECTION
 (-1429577724L)

	)

13 
	#PROF_SECTION_WITH_VALUE
 (-1429577723L)

	)

14 
	#PROF_BAD_LINK_LIST
 (-1429577722L)

	)

15 
	#PROF_BAD_GROUP_LVL
 (-1429577721L)

	)

16 
	#PROF_BAD_PARENT_PTR
 (-1429577720L)

	)

17 
	#PROF_MAGIC_ITERATOR
 (-1429577719L)

	)

18 
	#PROF_SET_SECTION_VALUE
 (-1429577718L)

	)

19 
	#PROF_EINVAL
 (-1429577717L)

	)

20 
	#PROF_READ_ONLY
 (-1429577716L)

	)

21 
	#PROF_SECTION_NOTOP
 (-1429577715L)

	)

22 
	#PROF_SECTION_SYNTAX
 (-1429577714L)

	)

23 
	#PROF_RELATION_SYNTAX
 (-1429577713L)

	)

24 
	#PROF_EXTRA_CBRACE
 (-1429577712L)

	)

25 
	#PROF_MISSING_OBRACE
 (-1429577711L)

	)

26 
	#PROF_MAGIC_PROFILE
 (-1429577710L)

	)

27 
	#PROF_MAGIC_SECTION
 (-1429577709L)

	)

28 
	#PROF_TOPSECTION_ITER_NOSUPP
 (-1429577708L)

	)

29 
	#PROF_INVALID_SECTION
 (-1429577707L)

	)

30 
	#PROF_END_OF_SECTIONS
 (-1429577706L)

	)

31 
	#PROF_BAD_NAMESET
 (-1429577705L)

	)

32 
	#PROF_NO_PROFILE
 (-1429577704L)

	)

33 
	#PROF_MAGIC_FILE
 (-1429577703L)

	)

34 
	#PROF_FAIL_OPEN
 (-1429577702L)

	)

35 
	#PROF_EXISTS
 (-1429577701L)

	)

36 
	#PROF_BAD_BOOLEAN
 (-1429577700L)

	)

37 
	#PROF_BAD_INTEGER
 (-1429577699L)

	)

38 
	#PROF_MAGIC_FILE_DATA
 (-1429577698L)

	)

39 cÚ¡ 
”rÜ_bË
 
‘_´of_”rÜ_bË
;

40 
š™Ÿlize_´of_”rÜ_bË
();

43 
š™Ÿlize_´of_”rÜ_bË_r
(
‘_li¡
 **
li¡
);

45 
	#ERROR_TABLE_BASE_´of
 (-1429577728L)

	)

48 
	#š™_´of_”r_tbl
 
š™Ÿlize_´of_”rÜ_bË


	)

49 
	#´of_”r_ba£
 
ERROR_TABLE_BASE_´of


	)

	@libmke2fs/profile.h

39 #iâdeà
_PROFILE_H


40 
	#_PROFILE_H


	)

42 
_´ofe_t
 *
	t´ofe_t
;

44 (*
	t´ofe_syÁax_”r_cb_t
)(cÚ¡ *
	tfe
, 
	t”r
,

45 
	tlše_num
);

50 
	#PROFILE_ITER_LIST_SECTION
 0x0001

	)

51 
	#PROFILE_ITER_SECTIONS_ONLY
 0x0002

	)

52 
	#PROFILE_ITER_RELATIONS_ONLY
 0x0004

	)

54 #ifdeà
__ılu¥lus


58 
´ofe_š™


59 (cÚ¡ * *
fes
, 
´ofe_t
 *
»t_´ofe
);

61 
´ofe_»Ëa£


62 (
´ofe_t
 
´ofe
);

64 
´ofe_£t_deçuÉ


65 (
´ofe_t
 
´ofe
, cÚ¡ *
def_¡ršg
);

67 
´ofe_g‘_¡ršg


68 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

69 cÚ¡ *
subsubÇme
, cÚ¡ *
def_v®
,

70 **
»t_¡ršg
);

71 
´ofe_g‘_š‹g”


72 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

73 cÚ¡ *
subsubÇme
, 
def_v®
,

74 *
»t_deçuÉ
);

76 
´ofe_g‘_ušt


77 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

78 cÚ¡ *
subsubÇme
, 
def_v®
,

79 *
»t_št
);

81 
´ofe_g‘_doubË


82 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

83 cÚ¡ *
subsubÇme
, 
def_v®
,

84 *
»t_æßt
);

86 
´ofe_g‘_boŞ—n


87 (
´ofe_t
 
´ofe
, cÚ¡ *
Çme
, cÚ¡ *
subÇme
,

88 cÚ¡ *
subsubÇme
, 
def_v®
,

89 *
»t_deçuÉ
);

91 
´ofe_™”©Ü_ü—‹


92 (
´ofe_t
 
´ofe
, cÚ¡ *cÚ¡ *
Çmes
,

93 
æags
, **
»t_™”
);

95 
´ofe_™”©Ü_ä“


96 (**
™”_p
);

98 
´ofe_™”©Ü


99 (**
™”_p
, **
»t_Çme
, **
»t_v®ue
);

101 
´ofe_syÁax_”r_cb_t
 
	`´ofe_£t_syÁax_”r_cb
Õrofe_syÁax_”r_cb_ˆ
hook
);

103 #ifdeà
__ılu¥lus


104 
	}
}

	@libmke2fs/util.h

13 
jouº®_size
;

14 
jouº®_æags
;

15 *
jouº®_deviû
;

17 *
g‘_´ogÇme
(*
¬gv_z”o
);

18 
´oûed_que¡iÚ
();

19 
check_¶ausib™y
(cÚ¡ *
deviû
);

20 
·r£_jouº®_İts
(cÚ¡ *
İts
);

21 
check_mouÁ
(cÚ¡ *
deviû
, 
fÜû
, cÚ¡ *
ty³
);

22 
figu»_jouº®_size
(
size
, 
ext2_fsys
 
fs
);

23 
´št_check_mes§ge
(, );

24 
dump_mmp_msg
(
mmp_¡ruù
 *
mmp
, cÚ¡ *
msg
);

	@macro_def.h

1 #iâdeà
__MACRO_DEF_H__


2 
	#__MACRO_DEF_H__


	)

4 #ifdeà
NUUO


5 
	#_LOCK
(
l
è\

	)

7 
	gnuuo_æag
 = 
NUUO_FLAG
; \

8 ià(
	gnuuo_æag
è
	gm_cs
##
	gl
.
Lock
(); \

11 
	#_UNLOCK
(
l
è\

	)

13 
	gnuuo_æag
 = 
NUUO_FLAG
; \

14 ià(
	gnuuo_æag
è
	gm_cs
##
	gl
.
UÆock
(); \

17 
	#_CS
(
l
è\

	)

18 
Cr™iÿlSeùiÚLock
 
	g_cs
##
l
(&
m_cs
##l)

	@test_utils.cpp

1 
	~"‹¡_uts.h
"

3 
	~<sys/ty³s.h
>

4 
	~<sys/¡©.h
>

5 
	~<uni¡d.h
>

6 
	~<¡ršg.h
>

7 
	~<”ºo.h
>

9 #iâdeà
NUUO


10 
¡ršg
 
	$¡ršg_fÜm©
(cÚ¡ * 
fmt
, ...)

12 
va_li¡
 
¬gs
;

13 
buf
[64];

14 
	`va_¡¬t
(
¬gs
, 
fmt
);

15 
	`v¢´štf
(
buf
, 63, 
fmt
, 
¬gs
);

16 
	`va_’d
(
¬gs
);

17  
buf
;

18 
	}
}

20 
boŞ
 
	$CheckBlockDeviû
(cÚ¡ 
¡ršg
& 
dev
)

22 
¡©
 
sb
;

23 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

24 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

25  
çl£
;

28 ià(
	`S_ISBLK
(
sb
.
¡_mode
)) {

29  
Œue
;

32  
çl£
;

33 
	}
}

35 
boŞ
 
	$CheckDœeùÜyExi¡
(cÚ¡ 
¡ršg
& 
dev
)

37 
¡©
 
sb
;

38 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

39 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

40  
çl£
;

43 ià(
	`S_ISDIR
(
sb
.
¡_mode
)) {

44  
Œue
;

47  
çl£
;

48 
	}
}

50 
boŞ
 
	$CheckFeExi¡
(cÚ¡ 
¡ršg
& 
dev
)

52 
¡©
 
sb
;

53 ià(0 !ğ
	`¡©
(
dev
.
	`c_¡r
(), &
sb
)) {

54 
	`årštf
(
¡d”r
, "%s: %s, %s\À", 
__func__
, 
dev
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

55  
çl£
;

58 ià(
	`S_ISREG
(
sb
.
¡_mode
)) {

59  
Œue
;

62  
çl£
;

63 
	}
}

65 
boŞ
 
	$MakeDœeùÜy
(cÚ¡ 
¡ršg
& 
·thÇme
)

67 
¡©us
 = 
	`mkdœ
(
·thÇme
.
	`c_¡r
(), 0666);

68 ià(
¡©us
 < 0) {

69 
	`årštf
(
¡d”r
, "%s: %s, %s\n", 
__func__
, 
·thÇme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

70  
çl£
;

73  
Œue
;

74 
	}
}

76 
off_t
 
	$G‘FeStÜageSize
(cÚ¡ 
¡ršg
& 
·thÇme
)

78 
¡©
 
¡
;

79 ià(
	`¡©
(
·thÇme
.
	`c_¡r
(), &
¡
) == 0)

80  
¡
.
¡_size
;

82 
	`årštf
(
¡d”r
, "%s: %s, %s\n", 
__func__
, 
·thÇme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

84 
	}
}

	@test_utils.h

1 #iâdeà
__TEST_UTILS_H__


2 
	#__TEST_UTILS_H__


	)

4 #iâdeà
NUUO


5 
	~<¡ršg
>

7 
	~<¡dio.h
>

8 
	~<sy¦og.h
>

9 
	~<¡d¬g.h
>

11 
usšg
 
Çme¥aû
 
	g¡d
;

13 
	#Wr™eHWLog
(
çc™y
, 
Ëv–
, 
Ïb–
, 
fmt
, ...) \

15 
	`´štf
("[%d][%s][%s][%s] " 
fmt
, 
__LINE__
, #çc™y, #Ëv–, 
Ïb–
, ##
__VA_ARGS__
); \

16 } 0);

	)

18 
¡ršg
 
¡ršg_fÜm©
(cÚ¡ * 
fmt
, ...);

19 
boŞ
 
CheckBlockDeviû
(cÚ¡ 
¡ršg
& 
dev
);

20 
boŞ
 
CheckDœeùÜyExi¡
(cÚ¡ 
¡ršg
& 
dev
);

21 
boŞ
 
MakeDœeùÜy
(cÚ¡ 
¡ršg
& 
·thÇme
);

22 
boŞ
 
CheckFeExi¡
(cÚ¡ 
¡ršg
& 
dev
);

23 
off_t
 
G‘FeStÜageSize
(cÚ¡ 
¡ršg
& 
·thÇme
);

25 şas 
	cCr™iÿlSeùiÚ
 {

26 
	m´iv©e
:

27 
m_iLock
;

29 
	mpublic
:

30 
	$Cr™iÿlSeùiÚ
()

31 : 
	$m_iLock
(0)

34 ~
	$Cr™iÿlSeùiÚ
(è{ 
m_iLock
 = 0; 
	}
}

36 
	$Lock
() {

37 
m_iLock
++;

38 
	}
}

40 
	$UÆock
() {

41 
m_iLock
--;

42 
	}
}

45 şas 
	cCr™iÿlSeùiÚLock
 {

46 
	m´iv©e
:

47 
Cr™iÿlSeùiÚ
 *
m_cs
;

48 
Cr™iÿlSeùiÚLock
();

49 
	mpublic
:

50 
	$Cr™iÿlSeùiÚLock
(
Cr™iÿlSeùiÚ
 *
cs
)

51 : 
	$m_cs
(
cs
)

53 ià(
m_cs
)

54 
m_cs
->
	`Lock
();

56 ~
	$Cr™iÿlSeùiÚLock
() {

57 ià(
m_cs
)

58 
m_cs
->
	`UÆock
();

59 
	}
}

	@unitest/FilesystemManager_test.cpp

1 
	~"Fesy¡emMªag”.h
"

3 #ifdeà
NUUO


4 
	~"commÚ/sy¡em.h
"

7 
	$maš
(
¬gc
, *
¬gv
[])

9 
Fesy¡emMªag”
 
	`fs_mgr
("/dev/md0");

10 
fs_mgr
.
	`S‘MouÁPošt
("/mnt/VOLUME0");

11 #ifdeà
NUUO


12 
fs_mgr
.
	`C»©eTh»ad
();

15 
	`´štf
("Progress: ");

16 
´og»ss
 = 0, 
¡©
 = 
WRITE_INODE_TABLES_UNKNOWN
;

17 
FILE
 *
pf
 = 
	`fİ’
("fs_test.log", "w+");

18 #ifdeà
NUUO


19 
fs_mgr
.
	`Th»adExi¡s
()) {

21 ià(
fs_mgr
.
	`IsFÜm©šg
(
´og»ss
, 
¡©
)) {

22 
	`årštf
(
pf
, "%3d%%\n", 
´og»ss
);

23 
	`fæush
(
pf
);

25 #ifdeà
NUUO


26 
	`SË•MS
(100);

29 ià(!
fs_mgr
.
	`IsFÜm©šg
(
´og»ss
, 
¡©
è&& sˆ=ğ
WRITE_INODE_TABLES_DONE
) {

30 
	`årštf
(
pf
, "DÚe:%3d%%\n", 
´og»ss
);

32 
	`fşo£
(
pf
);

49 
	}
}

	@unitest/RAIDManager_test.cpp

1 
	~"RAIDMªag”.h
"

3 
	~<uni¡d.h
>

4 
	~<¡dlib.h
>

5 
	~<¡dio.h
>

6 
	~<sigÇl.h
>

8 
boŞ
 
	gg_bLoİ
 = 
Œue
;

10 
Te¡šgLoİ
(cÚ¡ * 
cfg
, 
RAIDMªag”
& 
¿id_mgr
);

12 
	$sig_hªdËr
(
sig
)

14 ià(
sig
 =ğ
SIGINT
) {

15 
g_bLoİ
 = 
çl£
;

16 
	`´štf
("received SIGINT\n");

18 
	}
}

20 
	$maš
(
¬gc
, * 
¬gv
[])

22 
İt
;

23 
RAIDMªag”
 
¿id_mgr
;

24 
Ëv–
 = -1;

25 
¡ršg
 
¡rMDName
;

26 
boŞ
 
bC»©e
 = 
çl£
;

27 
boŞ
 
bAddDisk
 = 
çl£
;

28 
boŞ
 
bRemove
 = 
çl£
;

29 
boŞ
 
bFe
 = 
çl£
;

30 
veùÜ
<
¡ršg
> 
vDevLi¡
;

31 
veùÜ
<
RAIDInfo
> 
li¡
;

32 
‹¡šg_sûÇrio_fe
[256];

34 
	`sigÇl
(
SIGINT
, 
sig_hªdËr
);

35 
	`sigÇl
(
SIGTERM
, 
sig_hªdËr
);

37 (
İt
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "arcl:f:")) != -1) {

38 
İt
) {

40 
bAddDisk
 = 
Œue
;

43 
bRemove
 = 
Œue
;

46 
bC»©e
 = 
Œue
;

49 
Ëv–
 = 
	`©oi
(
İrg
);

52 
bFe
 = 
Œue
;

53 
	`¡ºıy
(
‹¡šg_sûÇrio_fe
, 
İrg
, (testing_scenario_file) - 1);

58 ià(
bFe
) {

59 
	`Te¡šgLoİ
(
‹¡šg_sûÇrio_fe
, 
¿id_mgr
);

63 ià(
¬gc
 > 
İtšd
) {

64 
i
 = 
İtšd
; i < 
¬gc
; i++) {

65 
vDevLi¡
.
	`push_back
(
¬gv
[
i
]);

69 ià(
bAddDisk
) {

70 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++) {

71 
¿id_mgr
.
	`AddDisk
(
vDevLi¡
[
i
]);

75 ià(
bRemove
) {

76 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++)

77 
¿id_mgr
.
	`RemoveDisk
(
vDevLi¡
[
i
]);

80 ià(
bC»©e
) {

81 ià(
Ëv–
 < 0)  1;

82 ià(
vDevLi¡
.
	`em±y
())  1;

83 
¿id_mgr
.
	`C»©eRAID
(
vDevLi¡
, 
Ëv–
);

86 
g_bLoİ
) {

87 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

89 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++) {

90 
li¡
[
i
].
	`Dump
();

93 
	`¦“p
(10);

96 
i
 = 0; i < 
vDevLi¡
.
	`size
(); i++) {

97 
¿id_mgr
.
	`RemoveDisk
(
vDevLi¡
[
i
]);

101 
	}
}

	@unitest/TestingLoop.cpp

1 
	~"RAIDMªag”.h
"

3 
	~<¡dio.h
>

4 
	~<¡ršg.h
>

6 
	~<¡ršg
>

7 
	~<veùÜ
>

10 
	mOP_ADDDISK
 = 'a',

11 
	mOP_REMDISK
 = 'r',

12 
	mOP_CREATERAID
 = 'C',

13 
	mOP_STOPRAID
 = 'S',

14 
	mOP_DELETERAID
 = 'D',

15 
	mOP_ASSEMBLERAID
 = 'A',

16 
	mOP_MANAGEMDDISK
 = 'M',

22 
	mOP_DONOTHING
 = 'N',

26 
	mMANAGE_M¬kFauÉy
 = 'f',

27 
	mMANAGE_Remove
 = 'r',

28 
	mMANAGE_Add
 = 'a',

29 
	mMANAGE_R—dd
 = 'A',

30 
	mMANAGE_R•Ïû
 = 'R',

33 
	#OPERATION_CASE
(
İ
) \

34 
OP_
##
İ
: \

35 
	`´štf
("%s\n", #op); \

36 
HªdË
##
	`İ
(
cÚ‹Á
, 
¿id_mgr
); \

37 ;

	)

39 
	#MANAGE_CASE
(
İ
) \

40 
MANAGE_
##
İ
: \

41 
	`´štf
("İ”©iÚ = %c\n", 
İ”©iÚ
); \

42 
¿id_mgr
.
İ
##
	`MDDisks
(
mddev
, 
vdisks
); \

43 ;

	)

46 
boŞ
 
g_bLoİ
;

48 
usšg
 
Çme¥aû
 
	g¡d
;

50 
tok’ize
(* 
rg‘
, 
veùÜ
<
¡ršg
>& 
tok’s
)

52 *
	g§v•Œ
 = 
NULL
;

53 *
	gp
 = 
¡¹ok_r
(
rg‘
, ",", &
§v•Œ
);

55 
	gtok’s
.
ş—r
();

56 
	gp
) {

57 
´štf
 ("Tok’: %s\n", 
p
);

58 
	gtok’s
.
push_back
(
p
);

59 
	gp
 = 
¡¹ok_r
(
NULL
, ",", &
§v•Œ
);

63 
	$HªdËADDDISK
 (* 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

65 
veùÜ
<
¡ršg
> 
disks
;

66 
	`tok’ize
(
cÚ‹Á
, 
disks
);

67 
size_t
 
i
 = 0; i < 
disks
.
	`size
(); i++) {

68 
¿id_mgr
.
	`AddDisk
(
disks
[
i
]);

70 
	}
}

72 
	$HªdËREMDISK
 (* 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

74 
veùÜ
<
¡ršg
> 
disks
;

75 
	`tok’ize
(
cÚ‹Á
, 
disks
);

76 
size_t
 
i
 = 0; i < 
disks
.
	`size
(); i++) {

77 
¿id_mgr
.
	`RemoveDisk
(
disks
[
i
]);

79 
	}
}

81 
	$HªdËCREATERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

83 
lv
 = 0;

84 
disks
[1024];

85 
veùÜ
<
¡ršg
> 
vdisks
;

86 
¡ršg
 
¡rMDName
;

87 
	`ssÿnf
(
cÚ‹Á
, "%d,%1023s", &
lv
, 
disks
);

88 
	`tok’ize
(
disks
, 
vdisks
);

89 
	`´štf
("lv = %d\n", 
lv
);

90 
¿id_mgr
.
	`C»©eRAID
(
vdisks
, 
lv
);

91 
¿id_mgr
.
	`FÜm©
(
¡rMDName
);

92 
	}
}

94 
	$HªdËMANAGEMDDISK
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

96 
İ”©iÚ
;

97 
disks
[1024];

98 
mddev
[16];

99 
veùÜ
<
¡ršg
> 
vdisks
;

100 
	`ssÿnf
(
cÚ‹Á
, "%c,%15[^,],%1023s", &
İ”©iÚ
, 
mddev
, 
disks
);

101 
	`tok’ize
(
disks
, 
vdisks
);

102 
	`´štf
("mddev = %s\n", 
mddev
);

104 
İ”©iÚ
) {

105 
	`MANAGE_CASE
(
M¬kFauÉy
)

106 
	`MANAGE_CASE
(
Remove
)

107 
	`MANAGE_CASE
(
Add
)

108 
	`MANAGE_CASE
(
R—dd
)

109 
MANAGE_R•Ïû
:

110 
	`´štf
("Replace\n");

111 ià(
vdisks
.
	`size
() == 2) {

112 
¿id_mgr
.
	`R•ÏûMDDisk
(
mddev
, 
vdisks
[0], vdisks[1]);

114 
	`´štf
("Disk‚umber is‚ot‡ccepted\n");

119 
	}
}

121 
	$HªdËSTOPRAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

123 ià(
	`¡ºcmp
("®l", 
cÚ‹Á
, ("all")) == 0) {

124 
veùÜ
<
RAIDInfo
> 
li¡
;

125 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

126 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++) {

127 
¡©
 = 0, 
´og»ss
 = 0;

138 
	}
}

140 
	$HªdËDELETERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

142 ià(
	`¡ºcmp
("®l", 
cÚ‹Á
, ("all")) == 0) {

143 
veùÜ
<
RAIDInfo
> 
li¡
;

144 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

145 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i ++)

146 
¿id_mgr
.
	`D–‘eRAID
(
li¡
[
i
].
m_¡rDevP©h
);

148 
¿id_mgr
.
	`D–‘eRAID
(
cÚ‹Á
);

150 
	}
}

152 
	$HªdËFAULTYDISK
 (cÚ¡ * 
cÚ‹Á
)

154 
	}
}

156 
	$HªdËREMMDDISK
 (cÚ¡ * 
cÚ‹Á
)

158 
	}
}

160 
	$HªdËADDMDDISK
 (cÚ¡ * 
cÚ‹Á
)

162 
	}
}

164 
	$HªdËREADDMDDISK
 (cÚ¡ * 
cÚ‹Á
)

166 
	}
}

168 
	$HªdËREPLACEMDDISK
 (cÚ¡ * 
cÚ‹Á
)

170 
	}
}

172 
	$HªdËASSEMBLERAID
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

174 
ty³
[5];

175 
šfo
[1024];

176 
	`ssÿnf
(
cÚ‹Á
, "%4[^,],%1023s", 
ty³
, 
šfo
);

178 
	`´štf
("ty³ = %s\n", 
ty³
);

179 ià(
	`¡ºcmp
("disk", 
ty³
, 
	`¡¾’
("disk")) == 0) {

180 
veùÜ
<
¡ršg
> 
vdisks
;

181 
¡ršg
 
¡rMDName
;

182 
	`tok’ize
(
šfo
, 
vdisks
);

184 } ià(
	`¡ºcmp
("uuid", 
ty³
, 
	`¡¾’
("uuid")) == 0) {

187 
	}
}

189 
	$HªdËDONOTHING
 (cÚ¡ * 
cÚ‹Á
, 
RAIDMªag”
& 
¿id_mgr
)

191 
veùÜ
<
RAIDInfo
> 
li¡
;

192 
¿id_mgr
.
	`G‘RAIDInfo
(
li¡
);

193 
size_t
 
i
 = 0; i < 
li¡
.
	`size
(); i++) {

194 
li¡
[
i
].
	`Dump
();

196 
¿id_mgr
.
	`Dump
();

197 
	}
}

199 
	$Te¡šgLoİ
(cÚ¡ * 
cfg
, 
RAIDMªag”
& 
¿id_mgr
)

201 
FILE
 *
pFe
 = 
	`fİ’
(
cfg
, "r");

202 
lše
[1024];

203 
cÚ‹Á
[1024];

204 
o
 = 
OP_DONOTHING
;

206 ià(
pFe
 =ğ
NULL
) {

207 
	`´štf
("Failo open file\n");

212 
	`fg‘s
(
lše
, 1023, 
pFe
è!ğ
NULL
 && 
g_bLoİ
) {

213 ià(
lše
[0] == '#')

215 
	`´štf
("\nRun: %s", 
lše
);

216 
	`ssÿnf
(
lše
, "%c:%1023[^:\n]", &
o
, 
cÚ‹Á
);

218 
o
) {

219 
	`OPERATION_CASE
(
ADDDISK
)

220 
	`OPERATION_CASE
(
REMDISK
)

221 
	`OPERATION_CASE
(
CREATERAID
)

222 
	`OPERATION_CASE
(
STOPRAID
)

223 
	`OPERATION_CASE
(
DELETERAID
)

229 
	`OPERATION_CASE
(
ASSEMBLERAID
)

230 
	`OPERATION_CASE
(
MANAGEMDDISK
)

231 
	`OPERATION_CASE
(
DONOTHING
)

236 
	`¦“p
(10);

240 
	`fşo£
(
pFe
);

241 
	}
}

	@../../sysutils/common/stdint.h

1 #iâdeà
__SYSUTILS_STDINT_H__


2 
	#__SYSUTILS_STDINT_H__


	)

4 #iâdeà
__STDC_LIMIT_MACROS


5 
	#__STDC_LIMIT_MACROS


	)

8 #iâdeà
__STDC_CONSTANT_MACROS


9 
	#__STDC_CONSTANT_MACROS


	)

12 #ià
defšed
(
__GNUC__
)

13 
	~<¡dšt.h
>

14 #–ià
defšed
(
_MSC_VER
)

15 
	~"msš‰y³s/¡dšt.h
"

18 #”rÜ 
UnsuµÜ‹d
 
comp”


	@
1
.
0
367
13478
../../titanutils/EventAction/ActionModel.cpp
../../titanutils/EventAction/ActionModel.h
../../titanutils/EventAction/ActionParameter.cpp
../../titanutils/EventAction/ActionParameter.h
../../titanutils/EventAction/EventActionManager.cpp
../../titanutils/EventAction/EventActionManager.h
../../titanutils/EventAction/EventModel.cpp
../../titanutils/EventAction/EventModel.h
../../titanutils/EventAction/EventParameter.cpp
../../titanutils/EventAction/EventParameter.h
../../titanutils/EventAction/EventUtility.cpp
../../titanutils/EventAction/EventUtility.h
../../titanutils/EventAction/SystemEventCtrl.cpp
../../titanutils/EventAction/SystemEventCtrl.h
../../titanutils/MsClient/Handler/MsClientDataSessionHandler.cpp
../../titanutils/MsClient/Handler/MsClientDataSessionHandler.h
../../titanutils/MsClient/Handler/MsClientEventSessionHandler.cpp
../../titanutils/MsClient/Handler/MsClientEventSessionHandler.h
../../titanutils/MsClient/LoginCtrl/MSConfigManager.cpp
../../titanutils/MsClient/LoginCtrl/MSConfigManager.h
../../titanutils/MsClient/LoginCtrl/SessionKeyCtrlMgr.cpp
../../titanutils/MsClient/LoginCtrl/SessionKeyCtrlMgr.h
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigBase.cpp
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigBase.h
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigGroup.cpp
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigGroup.h
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigRole.cpp
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigRole.h
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigSchedule.cpp
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigSchedule.h
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigUser.cpp
../../titanutils/MsClient/LoginCtrl/SyncMSConfig/MSConfigUser.h
../../titanutils/MsClient/LoginCtrl/SyncMSConfigUtility.cpp
../../titanutils/MsClient/LoginCtrl/SyncMSConfigUtility.h
../../titanutils/MsClient/MsClient.cpp
../../titanutils/MsClient/MsClient.h
../../titanutils/MsClient/MsClientParameters.h
../../titanutils/MsClient/ProtocolDefine/MsClientCommandDefine.h
../../titanutils/MsClient/ProtocolDefine/MsClientCommonDefine.h
../../titanutils/MsClient/ProtocolDefine/MsClientDataSessionDefine.h
../../titanutils/MsClient/ProtocolDefine/MsClientEventSessionDefine.h
../../titanutils/MsClient/ProtocolOperation/MsClientCommandGenerate.cpp
../../titanutils/MsClient/ProtocolOperation/MsClientCommandGenerate.h
../../titanutils/MsClient/ProtocolOperation/MsClientCommandParser.cpp
../../titanutils/MsClient/ProtocolOperation/MsClientCommandParser.h
../../titanutils/MsClient/ProtocolOperation/MsClientDataSessionGenerate.cpp
../../titanutils/MsClient/ProtocolOperation/MsClientDataSessionGenerate.h
../../titanutils/MsClient/ProtocolOperation/MsClientDataSessionParser.cpp
../../titanutils/MsClient/ProtocolOperation/MsClientDataSessionParser.h
../../titanutils/MsClient/ProtocolOperation/MsClientEventSessionGenerate.cpp
../../titanutils/MsClient/ProtocolOperation/MsClientEventSessionGenerate.h
../../titanutils/MsClient/ProtocolOperation/MsClientEventSessionParser.cpp
../../titanutils/MsClient/ProtocolOperation/MsClientEventSessionParser.h
../../titanutils/MsClient/RequestWorker/RequestWorker.cpp
../../titanutils/MsClient/RequestWorker/RequestWorker.h
../../titanutils/MsClient/UpgradeThread/UpgradeThread.cpp
../../titanutils/MsClient/UpgradeThread/UpgradeThread.h
../../titanutils/RecordingHeader/RL_packet_header.h
../../titanutils/TitanCommon/CommonDeviceIDDefine.h
../../titanutils/TitanCommon/CommonString.cpp
../../titanutils/TitanCommon/CommonString.h
../../titanutils/TitanCommon/CommonUtility.cpp
../../titanutils/TitanCommon/CommonUtility.h
../../titanutils/const/PathConst.cpp
../../titanutils/const/PathConst.h
../../titanutils/const/ServerProtocolDefinition.h
../../titanutils/const/unittest/main.cpp
../../titanutils/debugMsg/Debug.h
../../titanutils/debugMsg/Debug_old.h
../../titanutils/log/DataBaseManager.cpp
../../titanutils/log/DataBaseManager.h
../../titanutils/log/EventLog.cpp
../../titanutils/log/EventLog.h
../../titanutils/log/EventLogDBManager.cpp
../../titanutils/log/EventLogDBManager.h
../../titanutils/log/EventLogDBManager2.cpp
../../titanutils/log/EventLogDBManager2.h
../../titanutils/log/EventLogItem.h
../../titanutils/log/EventLogQuery.cpp
../../titanutils/log/EventLogQuery.h
../../titanutils/log/EventLogRecycler.cpp
../../titanutils/log/EventLogRecycler.h
../../titanutils/log/EventLogRecycler2.cpp
../../titanutils/log/EventLogRecycler2.h
../../titanutils/log/Log.h
../../titanutils/log/unittest/main.cpp
../../titanutils/schedule/ActiveTable.h
../../titanutils/schedule/ScheduleBricks.cpp
../../titanutils/schedule/ScheduleBricks.h
../../titanutils/schedule/ScheduleProfile.cpp
../../titanutils/schedule/ScheduleProfile.h
../../titanutils/schedule/ScheduleProfileManager.cpp
../../titanutils/schedule/ScheduleProfileManager.h
../../titanutils/schedule/ScheduleProfileShareImp.cpp
../../titanutils/schedule/ScheduleProfileShareImp.h
../../titanutils/schedule/ScheduleProfileSourceImp.cpp
../../titanutils/schedule/ScheduleProfileSourceImp.h
../../titanutils/schedule/unittest/main.cpp
../../titanutils/schedule/unittest/uni_scheduler.cpp
../../titanutils/server/AprIPFilter.cpp
../../titanutils/server/AprIPFilter.h
../../titanutils/server/AprTcpResponderPool.cpp
../../titanutils/server/AprTcpResponderPool.h
../../titanutils/server/AprTcpServer.cpp
../../titanutils/server/AprTcpServer.h
../../titanutils/server/AprTcpSocketPool.cpp
../../titanutils/server/AprTcpSocketPool.h
../../titanutils/server/AprTcpSocketPoolResponder.cpp
../../titanutils/server/AprTcpSocketPoolResponder.h
../../titanutils/server/SessionHandler.cpp
../../titanutils/server/SessionHandler.h
../../titanutils/server/SessionManager.cpp
../../titanutils/server/SessionManager.h
../../titanutils/server/SocketHandler.cpp
../../titanutils/server/SocketHandler.h
../../titanutils/server/unittest/apr_tcp_responder_pool_test.cpp
../../titanutils/server/unittest/apr_tcp_server_test.cpp
../../titanutils/server/unittest/apr_tcp_socket_pool_test.cpp
../../titanutils/server/unittest/main.cpp
../../titanutils/server/unittest/session_handler_test.cpp
../../titanutils/serverConfig/AssociateDeviceItem.cpp
../../titanutils/serverConfig/AssociateDeviceItem.h
../../titanutils/serverConfig/AutoBackupConfig.cpp
../../titanutils/serverConfig/AutoBackupConfig.h
../../titanutils/serverConfig/ClientQueryEventSessionParser.cpp
../../titanutils/serverConfig/ClientQueryEventSessionParser.h
../../titanutils/serverConfig/HNAConfig.cpp
../../titanutils/serverConfig/HNAConfig.h
../../titanutils/serverConfig/MSConfigFile.cpp
../../titanutils/serverConfig/MSConfigFile.h
../../titanutils/serverConfig/MSXmlTagDef.h
../../titanutils/serverConfig/MsUserDataItem.cpp
../../titanutils/serverConfig/MsUserDataItem.h
../../titanutils/serverConfig/NTPConfig.cpp
../../titanutils/serverConfig/NTPConfig.h
../../titanutils/serverConfig/NetworkServiceConfig.cpp
../../titanutils/serverConfig/NetworkServiceConfig.h
../../titanutils/serverConfig/NetworkSettingConfig.cpp
../../titanutils/serverConfig/NetworkSettingConfig.h
../../titanutils/serverConfig/NetworkSettingXmlTagDef.h
../../titanutils/serverConfig/ServerProtocolDataStruct.cpp
../../titanutils/serverConfig/ServerProtocolDataStruct.h
../../titanutils/serverConfig/TimeInfoHelper.cpp
../../titanutils/serverConfig/TimeInfoHelper.h
../../titanutils/titanminihelper/DiskHelper.cpp
../../titanutils/titanminihelper/DiskHelper.h
../../titanutils/titanminihelper/NuFNVHash.cpp
../../titanutils/titanminihelper/NuFNVHash.h
../../titanutils/titanminihelper/md5.cpp
../../titanutils/titanminihelper/md5.h
../../titanutils/titanminihelper/titanutils.cpp
../../titanutils/titanminihelper/titanutils.h
../apr/apr_cond.cpp
../apr/apr_cond.h
../apr/apr_debug.h
../apr/apr_object.cpp
../apr/apr_object.h
../apr/apr_pollset.cpp
../apr/apr_pollset.h
../apr/apr_pool.cpp
../apr/apr_pool.h
../apr/apr_root.cpp
../apr/apr_root.h
../apr/apr_socket.cpp
../apr/apr_socket.h
../apr/apr_thread.cpp
../apr/apr_thread.h
../apr/apr_thread_operator.cpp
../apr/apr_thread_operator.h
../apr/apr_thread_worker.cpp
../apr/apr_thread_worker.h
../apr/apr_utility.cpp
../apr/apr_utility.h
../apr/unittest/apr_resource_test.cpp
../apr/unittest/apr_root_test.cpp
../apr/unittest/apr_server_client_test.cpp
../apr/unittest/apr_socket_pair_test.cpp
../apr/unittest/apr_thread_worker_test.cpp
../apr/unittest/apr_thread_worker_test.h
../apr/unittest/main.cpp
../common/critical_section.cpp
../common/critical_section.h
../common/directory_traverse.cpp
../common/directory_traverse.h
../common/file.cpp
../common/file.h
../common/fsusage.cpp
../common/fsusage.h
../common/fsusage64.cpp
../common/fsusage64.h
../common/hardware.cpp
../common/hardware.h
../common/inttypes.h
../common/mutex.cpp
../common/mutex.h
../common/nusyslog.cpp
../common/nusyslog.h
../common/observer.cpp
../common/observer.h
../common/read_write_lock.cpp
../common/read_write_lock.h
../common/semaphore.cpp
../common/semaphore.h
../common/smart_pointer.h
../common/stdint.h
../common/string.cpp
../common/string.h
../common/system.cpp
../common/system.h
../common/time.cpp
../common/time.h
../common/unittest/directory_traverse_test.cpp
../common/unittest/file_test.cpp
../common/unittest/hardware_test.cpp
../common/unittest/main.cpp
../common/unittest/observer_test.cpp
../common/unittest/semaphore_test.cpp
../common/unittest/smart_pointer_test.cpp
../common/unittest/string_test.cpp
../common/unittest/time_test.cpp
../common/unittest/timespan_test.cpp
../common/utility.h
../curl/FtpClient.cpp
../curl/FtpClient.h
../curl/NetClient.cpp
../curl/NetClient.h
../curl/SmtpClient.cpp
../curl/SmtpClient.h
../curl/unittest/curl_test.cpp
../curl/unittest/main.cpp
../exports.h
../http/http_header_define.h
../http/http_parser.cpp
../http/http_parser.h
../http/http_status_define.h
../http/unittest/http_parser_test.cpp
../http/unittest/main.cpp
../libevent/apr_event.cpp
../libevent/apr_event.h
../libevent/event.cpp
../libevent/event.h
../libevent/event_base.cpp
../libevent/event_base.h
../libevent/event_buffer.cpp
../libevent/event_buffer.h
../libevent/event_debug.h
../libevent/event_loop.cpp
../libevent/event_loop.h
../libevent/event_object.cpp
../libevent/event_object.h
../libevent/event_prerequisite.h
../libevent/event_root.cpp
../libevent/event_root.h
../libevent/event_timer.cpp
../libevent/event_timer.h
../libevent/event_utility.cpp
../libevent/event_utility.h
../libevent/unittest/event_loop_test.cpp
../libevent/unittest/event_loop_test.h
../libevent/unittest/event_timer_test.cpp
../libevent/unittest/main.cpp
../minizip/crypt.h
../minizip/ioapi.h
../minizip/iowin32.h
../minizip/miniunz.cpp
../minizip/minizip.cpp
../minizip/minizipUtility.h
../minizip/mztools.h
../minizip/unzip.h
../minizip/zip.h
../platform/check_utils.cpp
../platform/get_system_info.cpp
../platform/include/check_utils.h
../platform/include/get_system_info.h
../platform/include/platform_info.h
../platform/include/platform_spec.h
../platform/include/proc_cpuinfo.h
../platform/include/sys_dmi.h
../platform/platform_spec.cpp
../platform/proc_cpuinfo.cpp
../platform/sys_dmi.cpp
../platform/unitest.cpp
../scew/unittest/main.cpp
../scew/unittest/xml_crash_test.cpp
../scew/unittest/xml_test.cpp
../scew/xml_attribute.cpp
../scew/xml_attribute.h
../scew/xml_element.cpp
../scew/xml_element.h
../scew/xml_node.cpp
../scew/xml_node.h
../scew/xml_tree.cpp
../scew/xml_tree.h
../scew/xml_utility.cpp
../scew/xml_utility.h
../sqlite/sqlite_object.cpp
../sqlite/sqlite_object.h
../sqlite/sqlite_stmt.cpp
../sqlite/sqlite_stmt.h
../sqlite/sqlite_utility.cpp
../sqlite/sqlite_utility.h
../sqlite/unittest/main.cpp
../sqlite/unittest/sqlite_read_write_test.cpp
../sysstat/nusysstat/common.h
../sysstat/nusysstat/count.h
../sysstat/nusysstat/prealloc.h
../sysstat/nusysstat/rd_sensors.h
../sysstat/nusysstat/rd_stats.h
../sysstat/nusysstat/sa.h
../sysstat/statsDef.h
../sysstat/sysStatsCollector.cpp
../sysstat/sysStatsCollector.h
../sysstat/unitest/test.cpp
../thread_object/aggregate_timer.cpp
../thread_object/aggregate_timer.h
../thread_object/async_observer.cpp
../thread_object/async_observer.h
../thread_object/directory_monitor.cpp
../thread_object/directory_monitor.h
../thread_object/single_timer.cpp
../thread_object/single_timer.h
../thread_object/task_pool.cpp
../thread_object/task_pool.h
../thread_object/task_queue.cpp
../thread_object/task_queue.h
../thread_object/unittest/aggregate_timer_test.cpp
../thread_object/unittest/async_observer_test.cpp
../thread_object/unittest/directory_monitor_test.cpp
../thread_object/unittest/main.cpp
../thread_object/unittest/task_pool_test.cpp
../thread_object/unittest/task_queue_test.cpp
../visibility.h
../vmbackdoor/backdoor_def.h
../vmbackdoor/vmbackdoor.cpp
../vmbackdoor/vmbackdoor.h
FilesystemManager.cpp
FilesystemManager.h
RAIDManager.cpp
RAIDManager.h
libmdadm/bitmap.h
libmdadm/crc32.h
libmdadm/dlink.h
libmdadm/md_p.h
libmdadm/md_u.h
libmdadm/mdadm.h
libmdadm/mdadm_errcode.h
libmdadm/mdadm_other.h
libmdadm/mdmon.h
libmdadm/msg.h
libmdadm/part.h
libmdadm/platform-intel.h
libmdadm/probe_roms.h
libmdadm/sha1.h
libmke2fs/ext2fs.h
libmke2fs/ext2fsP.h
libmke2fs/mke2fs.h
libmke2fs/mke2fs_err.h
libmke2fs/prof_err.h
libmke2fs/profile.h
libmke2fs/util.h
macro_def.h
test_utils.cpp
test_utils.h
unitest/FilesystemManager_test.cpp
unitest/RAIDManager_test.cpp
unitest/TestingLoop.cpp
../../sysutils/common/stdint.h
